<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Формы циклов</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-19 16:08:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 6258--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse43.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse41.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse41.html#tailclmse41.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse42.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse42.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">7.8   </span> <a 
href="clm.html#QQ2-54-124" id="x54-1170007.8">Формы циклов</a></h3>
<a 
 id="dx54-117001"></a>
<!--l. 6261--><p class="noindent" >Common Lisp предоставляет некоторые конструкции для циклов.
Конструкция <a 
href="#x54-118002r90">loop</a> предоставляет простую функциональность. Она слегка
больше, чем <a 
href="clmse38.html#x50-96002r71">progn</a>, и имеет ветку для переноса управления снизу вверх.
Конструкции <a 
href="clmse137.html#x168-342002r838">do</a> и <a 
href="#x54-120004r92">do*</a> предоставляют общую функциональность для
управления на каждом цикле изменением нескольких переменных. Для
специализированных циклов над элементами списка или <i>n</i> последовательных
чисел предоставляются формы <a 
href="#x54-122002r93">dolist</a> и <a 
href="#x54-123002r94">dotimes</a>. Конструкция <a 
href="#x54-126002r101">tagbody</a>
наиболее общая конструкция, которая внутри себя позволяет использование
выражений <a 
href="#x54-128002r104">go</a>. (Традиционная конструкция <a 
href="#x54-127002r102">prog</a> — это синтез <a 
href="#x54-126002r101">tagbody</a>, <a 
href="clmse41.html#x53-113002r87">block</a>
и <a 
href="clmse39.html#x51-100002r74">let</a>.) Большинство конструкций циклов позволяют определённые статически
нелокальные выходы (смотрите <a 
href="clmse41.html#x53-114002r88">return-from</a> и <a 
href="clmse137.html#x168-343002r840">return</a>).
<!--l. 6274--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.1   </span> <a 
href="clmli1.html#QQ2-54-125" id="x54-1180007.8.1">Бесконечный цикл</a></h4>
<!--l. 6276--><p class="noindent" >Конструкция <a 
href="#x54-118002r90">loop</a> является наипростейшей функциональностью для
итераций. Она не управляет переменными, и просто циклично выполняет
своё тело.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> loop </b><a 
 id="dx54-118001"></a><a 
 id="x54-118002r90"></a> { form}*
</td></tr></table>
<!--l. 6281--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 6281--><p class="noindent" ><span class="paragraphHead"><a 
href="#x54-1190007.8.1" id="x54-1190007.8.1"></a></span>
   Каждая форма <i>form</i> выполняется последовательно слева направо. Когда
вычислена последняя форма, тогда вычисляется первая форма и так далее, в
безостановочном цикле. Конструкция <a 
href="#x54-118002r90">loop</a> никогда не возвращает значение.
Её выполнение может быть остановлено явно, с помощью <a 
href="clmse137.html#x168-343002r840">return</a> или <a 
href="clmse44.html#x56-141002r116">throw</a>,
например.
<!--l. 6288--><p class="indent" >   <a 
href="#x54-118002r90">loop</a>, как и многие конструкции циклов, устанавливает неявный блок с
именем <a 
href="clmse31.html#x42-74002r18">nil</a>. Таким образом, <a 
href="clmse137.html#x168-343002r840">return</a> с заданным результатом может
использоваться для выхода и <a 
href="#x54-118002r90">loop</a>.
</div>
<!--l. 6294--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.2   </span> <a 
href="clmli1.html#QQ2-54-127" id="x54-1200007.8.2">Базовые формы циклов</a></h4>
<!--l. 6296--><p class="noindent" >В отличие от <a 
href="#x54-118002r90">loop</a>, <a 
href="clmse137.html#x168-342002r838">do</a> и <a 
href="#x54-120004r92">do*</a> предоставляют мощный механизм для повторных
вычислений большого количества переменных.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> do </b><a 
 id="dx54-120001"></a><a 
 id="x54-120002r91"></a> ( {var | (var [init [step]])}* )
</td></tr></table>
<!--l. 6302--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(end-test  {result}* )</td></tr></table>
<!--l. 6303--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6303--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Макрос]</i><b> do* </b><a 
 id="dx54-120003"></a><a 
 id="x54-120004r92"></a> ( {var | (var [init [step]])}* )</td></tr></table>
<!--l. 6305--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(end-test  {result}* )</td></tr></table>
<!--l. 6306--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6307--><p class="indent" >
</div>
<!--l. 6307--><p class="noindent" ><span class="paragraphHead"><a 
href="#x54-1210007.8.2" id="x54-1210007.8.2"></a></span>
   Специальная форма <a 
href="clmse137.html#x168-342002r838">do</a> представляет общую функциональность цикла, с
произвольным количеством «переменных-индексов». Эти переменные
связываются при входе в цикл и параллельно наращиваются, как это было
задано. Они могут быть использованы, как для генерации необходимых
                                                                          

                                                                          
последовательных чисел (как, например, последовательные целые
числа), так и для накопления результата. Когда условие окончания
цикла успешно выполнилось, тогда цикл завершается с заданным
значением.
<!--l. 6317--><p class="indent" >   В общем виде <a 
href="clmse137.html#x168-342002r838">do</a> выглядит так: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((<i>var1</i> <i>init1</i> <i>step1</i>)
</td></tr></table>
<!--l. 6319--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (<i>var2</i> <i>init2</i> <i>step2</i>)</td></tr></table>
<!--l. 6320--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ...</td></tr></table>
<!--l. 6321--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (<i>varn</i> <i>initn</i> <i>stepn</i>))</td></tr></table>
<!--l. 6322--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (<i>end-test</i> . <i>result</i>)</td></tr></table>
<!--l. 6323--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   {<i><i>declaration</i></i>}* </td></tr></table>
<!--l. 6324--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  . <i>tagbody</i>)</td></tr></table>
<!--l. 6326--><p class="indent" >
</div>
</div>
<!--l. 6327--><p class="noindent" >Цикл <a 
href="#x54-120004r92">do*</a> выглядит также, кроме изменения имени с <a 
href="clmse137.html#x168-342002r838">do</a> на <a 
href="#x54-120004r92">do*</a>.
<!--l. 6329--><p class="indent" >   Первый элемент формы является списком нуля и более спецификаторов
переменных-индексов. Каждый спецификатор является списком из имени
переменной <i>var</i>, первоначального значения <i>init</i>, и форма приращения <i>step</i>.
Если <i>init</i> опущен, используется первоначальное значение <a 
href="clmse31.html#x42-74002r18">nil</a>. Если <i>step</i>
опущен, <i>var</i> не изменяется на итерациях цикла (но может изменяться в теле
цикла с помощью формы <a 
href="clmse35.html#x47-87002r59">setq</a>).
<!--l. 6337--><p class="indent" >   Спецификатор переменной-индекса может также быть просто именем
переменной. В этом случае переменная будет иметь первоначальное
значение <a 
href="clmse31.html#x42-74002r18">nil</a> и не будет изменяться при итерациях цикла. В целях
стиля, использовать просто имя переменной рекомендуется, только
если перед первым использованием для неё устанавливается значение
с помощью <a 
href="clmse35.html#x47-87002r59">setq</a>. Если необходимо чтобы первоначальное значение
было <a 
href="clmse31.html#x42-74002r18">nil</a>, а не неопределённое, то лучше указывать это явно, если
нужна ложь так: (<i>varj</i> <a 
href="clmse31.html#x42-74002r18">nil</a>) или если нужен пустой список так: (<i>varj</i>
&#x2019;()).
<!--l. 6348--><p class="indent" >   Перед первой итерацией вычисляются все формы <i>init</i>, и каждая
переменная <i>var</i> связывается с соответствующим результатом вычислений
<i>init</i>. Используется именно связывание, а не присвоение. Когда цикл
                                                                          

                                                                          
завершается, старые значения этих переменных восстанавливаются. Для <a 
href="clmse137.html#x168-342002r838">do</a>,
<i>все</i> формы <i>init</i> вычисляется перед тем, как будут связаны переменные <i>var</i>.
Таким образом все формы могут ссылаться на старые связывания этих
переменных (то есть на значения, которые были видимы до начала
выполнения конструкции <a 
href="clmse137.html#x168-342002r838">do</a>). Для <a 
href="#x54-120004r92">do*</a> вычисляется первая форма <i>init</i>, затем
первая переменная связывается с результатом этих вычислений. Затем
вычисляется вторая форма <i>init</i> и вторая переменная <i>var</i> связывается с этим
значением, и так далее. В целом, форма <i>initj</i> может ссылаться на <i>новые</i>
связывания <i>vark</i>, если <span class="math">k &#x003C; j</span>, иначе ссылка происходит на <i>старое</i>
связывание.
<!--l. 6364--><p class="indent" >   Второй элемент конструкции цикла это список из формы предиката-выхода
<i>end-test</i> и нуля и более форм результата <i>result</i>. Этот элемент напоминает
подвыражение <a 
href="clmse40.html#x52-109002r84">cond</a>. В начале каждой итерации, после обработки всех
переменных, вычисляется форма <i>end-test</i>. Если результат <a 
href="clmse31.html#x42-74002r18">nil</a>, выполняется
тело формы <a 
href="clmse137.html#x168-342002r838">do</a> (или <a 
href="#x54-120004r92">do*</a>). Если результат не <a 
href="clmse31.html#x42-74002r18">nil</a>, последовательно
вычисляются формы <i>result</i>, как неявный <a 
href="clmse38.html#x50-96002r71">progn</a>, и затем <a 
href="clmse137.html#x168-342002r838">do</a> возвращает
управление. <a 
href="clmse137.html#x168-342002r838">do</a> возвращает результаты вычисления последней формы <i>result</i>.
Если таких форм не быть, значением <a 
href="clmse137.html#x168-342002r838">do</a> становиться <a 
href="clmse31.html#x42-74002r18">nil</a>. Следует отметить,
что аналогия с подвыражениями <a 
href="clmse40.html#x52-109002r84">cond</a> не полная, так как <a 
href="clmse40.html#x52-109002r84">cond</a> в этом случае
возвращает результат формы условия.
<!--l. 6378--><p class="indent" >   Переменные-индексы изменяются в начале каждой непервой итерации
так, как написано далее. Слева направо вычисляются все формы <i>step</i>, и
затем результаты присваиваются переменным-индексам. Если такой формы
<i>step</i> для переменной указано не было, то переменная и не изменяется. Для
<a 
href="clmse137.html#x168-342002r838">do</a>, все формы <i>step</i> вычисляются перед там, как будут изменены переменные.
Присваивания переменным осуществляются параллельно, как в <a 
href="clmse35.html#x47-88002r60">psetq</a>. Так
как <i>все</i> формы <i>step</i> вычисляются перед тем, как будет изменена хоть одна
переменных, форма <i>step</i> при вычислении всегда ссылается на старые
значения <i>всех</i> переменных-индексов, даже если другие формы <i>step</i>
были выполнены. Для <a 
href="#x54-120004r92">do*</a>, вычисляется первая форма <i>step</i>, затем
полученное значение присваивается первой переменной-индексом, затем
вычисляется вторая форма <i>step</i>, и полученное значение присваивается второй
переменной, и так далее. Присваивание происходит последовательно, как в
<a 
href="clmse35.html#x47-87002r59">setq</a>. И для <a 
href="clmse137.html#x168-342002r838">do</a>, и для <a 
href="#x54-120004r92">do*</a> после того как переменные были изменены,
вычисляется <i>end-test</i> так, как уже было описано выше. Затем продолжаются
итерации.
<!--l. 6398--><p class="indent" >   Если <i>end-test</i> формы <a 
href="clmse137.html#x168-342002r838">do</a> равен <a 
href="clmse31.html#x42-74002r18">nil</a>, тогда предикат всегда ложен. Таким
образом получается «бесконечный цикл»: тело <i>body</i> <a 
href="clmse137.html#x168-342002r838">do</a> выполняется
                                                                          

                                                                          
циклично, переменные-индексы изменяются как обычно. (Конструкция <a 
href="#x54-118002r90">loop</a>
также является «бесконечным циклом», только без переменных-индексов.)
Бесконечный цикл может быть остановлен использованием <a 
href="clmse137.html#x168-343002r840">return</a>,
<a 
href="clmse41.html#x53-114002r88">return-from</a>, <a 
href="#x54-128002r104">go</a> на более высокий уровень или <a 
href="clmse44.html#x56-141002r116">throw</a>. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((j 0 (+ j 1)))
</td></tr></table>
<!--l. 6408--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (<a 
href="clmse31.html#x42-74002r18">nil</a>)                        ;Выполнять вечно</td></tr></table>
<!--l. 6409--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format t &#x0022;~%Input ~D:&#x0022; j)</td></tr></table>
<!--l. 6410--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((item (read)))</td></tr></table>
<!--l. 6411--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (if (null item) (return)     ;Обрабатывать элементы пока не найден <a 
href="clmse31.html#x42-74002r18">nil</a></td></tr></table>
<!--l. 6412--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (format t &#x0022;~&#x0026;Output ~D: ~S&#x0022; j (process item)))))</td></tr></table>
<!--l. 6414--><p class="indent" >
</div>
</div>
<!--l. 6416--><p class="indent" >   Оставшаяся часть <a 
href="clmse137.html#x168-342002r838">do</a> оборачивается в неявный <a 
href="#x54-126002r101">tagbody</a>. Теги могут
использоваться внутри тела цикла <a 
href="clmse137.html#x168-342002r838">do</a> для того, чтобы затем использовать
выражения <a 
href="#x54-128002r104">go</a>. На такие выражения <a 
href="#x54-128002r104">go</a> не могут использоваться в
спецификаторах переменных-индексов, в предикате <i>end-test</i> и в формах
результата <i>result</i>. Когда управление достигает конца тела цикла <a 
href="clmse137.html#x168-342002r838">do</a>,
наступает следующая цикл итерации (начинающийся с вычисления форм
<i>step</i>).
<!--l. 6424--><p class="indent" >   Неявный <a 
href="clmse41.html#x53-113002r87">block</a> с именем <a 
href="clmse31.html#x42-74002r18">nil</a> окружает всю форму <a 
href="clmse137.html#x168-342002r838">do</a>. Выражение <a 
href="clmse137.html#x168-343002r840">return</a>
может использоваться в любом месте для немедленного выхода из
цикла.
<!--l. 6428--><p class="indent" >   Формы <a 
href="clmse48.html#x62-150003r123">declare</a> могут использоваться в начала тела <a 
href="clmse137.html#x168-342002r838">do</a>. Они применяются
к коду внутри тела <a 
href="clmse137.html#x168-342002r838">do</a>, для связываний переменных-индексов, для форм
<i>init</i>, для форм <i>step</i>, для предиката <i>end-test</i> и для форм результата
<i>result</i>.
<!--l. 6433--><p class="indent" >   Вот парочка примеров использования <a 
href="clmse137.html#x168-342002r838">do</a>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((i 0 (+ i 1))     ;Sets every null element of a-vector to zero
</td></tr></table>
<!--l. 6435--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (n (length a-vector)))</td></tr></table>
<!--l. 6436--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ((= i n))</td></tr></table>
<!--l. 6437--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (when (null (aref a-vector i))</td></tr></table>
                                                                          

                                                                          
<!--l. 6438--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (setf (aref a-vector i) 0)))</td></tr></table>
<!--l. 6440--><p class="indent" >
</div>
</div>
<!--l. 6441--><p class="noindent" >Конструкция <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((x e (cdr x))
</td></tr></table>
<!--l. 6443--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (oldx x x))</td></tr></table>
<!--l. 6444--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ((null x))</td></tr></table>
<!--l. 6445--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body</i>)</td></tr></table>
<!--l. 6447--><p class="indent" >
</div>
</div>
<!--l. 6448--><p class="noindent" >использует параллельное присваивание переменным-индексам. На первой
итерации значение oldx получает значение x, которое было до входа в цикл.
При выходе из цикла oldx будет содержать значение x, которое было на
предыдущей итерации.
<!--l. 6453--><p class="indent" >   Очень часто алгоритм цикла может быть по большей части выражен в
формах <i>step</i> и тело при этом останется пустым. Например, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((x foo (cdr x))
</td></tr></table>
<!--l. 6457--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (y bar (cdr y))</td></tr></table>
<!--l. 6458--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (z &#x2019;() (cons (f (car x) (car y)) z)))</td></tr></table>
<!--l. 6459--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ((or (null x) (null y))</td></tr></table>
<!--l. 6460--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (nreverse z)))</td></tr></table>
<!--l. 6462--><p class="indent" >
</div>
</div>
<!--l. 6463--><p class="noindent" >делает то же, что и (mapcar #&#x2019;f foo bar). Следует отметить, что вычисление <i>step</i>
для z использует тот факт, что переменные переприсваиваются параллельно.
Тело функции пустое. Наконец, использование <a 
href="clmse76.html#x95-196012r367">nreverse</a> в форме возврата
результата, переставляет элементы списка для правильного результата.
Другой пример: <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun list-reverse (list)
</td></tr></table>
<!--l. 6470--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (do ((x list (cdr x))</td></tr></table>
<!--l. 6471--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (y &#x2019;() (cons (car x) y)))</td></tr></table>
<!--l. 6472--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           ((endp x) y)))</td></tr></table>
<!--l. 6474--><p class="indent" >
</div>
</div>
<!--l. 6475--><p class="noindent" >Нужно заметить, что используется <a 
href="clmse82.html#x102-203002r439">endp</a> вместо <a 
href="clmse32.html#x43-77002r22">null</a> или <a 
href="clmse32.html#x43-77006r24">atom</a> для проверки
конца списка. Это даёт более надёжный алгоритм.
<!--l. 6478--><p class="indent" >   В качестве примера вложенных циклов, предположим что env содержит
список cons-ячеек. <i>car</i> элемента каждой cons-ячейки является списком
символов, и <i>cdr</i> каждой cons-ячейки является списком такой же длины с
соответствующими значениями. Такая структура данных похожа на
ассоциативный список, но она в отличие разделена на «кадры». Общая
структура напоминает грудную клетку. Функция поиска по такой структуре
может быть такой: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun ribcage-lookup (sym ribcage)
</td></tr></table>
<!--l. 6487--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (do ((r ribcage (cdr r)))</td></tr></table>
<!--l. 6488--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           ((null r) <a 
href="clmse31.html#x42-74002r18">nil</a>)</td></tr></table>
<!--l. 6489--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (do ((s (caar r) (cdr s))</td></tr></table>
<!--l. 6490--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              (v (cdar r) (cdr v)))</td></tr></table>
<!--l. 6491--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             ((null s))</td></tr></table>
<!--l. 6492--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           (when (eq (car s) sym)</td></tr></table>
<!--l. 6493--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (return-from ribcage-lookup (car v))))))</td></tr></table>
<!--l. 6495--><p class="indent" >
</div>
</div>
<!--l. 6496--><p class="noindent" >(Примечание, использование отступов в примере выше выделяет тела
вложенных циклов.)
<!--l. 6499--><p class="indent" >   Цикл <a 
href="clmse137.html#x168-342002r838">do</a> может быть выражен в терминах более примитивных
конструкций <a 
href="clmse41.html#x53-113002r87">block</a>, <a 
href="clmse137.html#x168-343002r840">return</a>, <a 
href="clmse39.html#x51-100002r74">let</a>, <a 
href="#x54-118002r90">loop</a>, <a 
href="#x54-126002r101">tagbody</a> и <a 
href="clmse35.html#x47-88002r60">psetq</a>: <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(block nil
</td></tr></table>
<!--l. 6503--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((<i>var1</i> <i>init1</i>)</td></tr></table>
<!--l. 6504--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (<i>var2</i> <i>init2</i>)</td></tr></table>
<!--l. 6505--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        ...</td></tr></table>
<!--l. 6506--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (<i>varn</i> <i>initn</i>))</td></tr></table>
<!--l. 6507--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     {<i><i>declaration</i></i>}* </td></tr></table>
<!--l. 6508--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (loop (when <i>end-test</i> (return (progn . <i>result</i>)))</td></tr></table>
<!--l. 6509--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (tagbody . <i>tagbody</i>)</td></tr></table>
<!--l. 6510--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (psetq <i>var1</i> <i>step1</i></td></tr></table>
<!--l. 6511--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 <i>var2</i> <i>step2</i></td></tr></table>
<!--l. 6512--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 ...</td></tr></table>
<!--l. 6513--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 <i>varn</i> <i>stepn</i>))))</td></tr></table>
<!--l. 6515--><p class="indent" >
</div>
</div>
<!--l. 6516--><p class="noindent" ><a 
href="#x54-120004r92">do*</a> почти то же, что и <a 
href="clmse137.html#x168-342002r838">do</a> за исключением того, что связывание и наращение
переменных происходит последовательно, а не параллельно. Таким образом,
в вышеприведённой конструкции, <a 
href="clmse39.html#x51-100002r74">let</a> будет заменена на <a 
href="clmse39.html#x51-101002r75">let*</a> и <a 
href="clmse35.html#x47-88002r60">psetq</a> на
<a 
href="clmse35.html#x47-87002r59">setq</a>.
</div>
<!--l. 6522--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.3   </span> <a 
href="clmli1.html#QQ2-54-129" id="x54-1220007.8.3">Простые формы циклов</a></h4>
<!--l. 6524--><p class="noindent" >Конструкции <a 
href="#x54-122002r93">dolist</a> и <a 
href="#x54-123002r94">dotimes</a> для каждого значения взятого для одной
переменной выполняют тело один раз. Они хоть и выражаются в терминах
<a 
href="clmse137.html#x168-342002r838">do</a>, но захватывают очень простые шаблоны использования.
<!--l. 6528--><p class="indent" >   И <a 
href="#x54-122002r93">dolist</a> и <a 
href="#x54-123002r94">dotimes</a> циклично выполняют тело. На каждой итерации заданная
переменная связывается с элементом, которая затем может использоваться в
теле. <a 
href="#x54-122002r93">dolist</a> использует элементы списка, и <a 
href="#x54-123002r94">dotimes</a> использует целые
числа от 0 по <span class="math">n − 1</span>, при некотором указанном положительном целом
<i>n</i>.
<!--l. 6533--><p class="indent" >   Результат двух этих конструкций может быть указан с помощью
необязательной формы результата. Если эта форма опущена результат равен
<a 
href="clmse31.html#x42-74002r18">nil</a>.
                                                                          

                                                                          
<!--l. 6536--><p class="indent" >   Выражение <a 
href="clmse137.html#x168-343002r840">return</a> может быть использовано для немедленного возврата
из форм <a 
href="#x54-122002r93">dolist</a> или <a 
href="#x54-123002r94">dotimes</a>, игнорируя все оставшиеся итерации, которые
должны были быть выполнены. <a 
href="clmse41.html#x53-113002r87">block</a> с именем <a 
href="clmse31.html#x42-74002r18">nil</a> окружает конструкцию.
Тело цикла неявно обернуто конструкцией <a 
href="#x54-126002r101">tagbody</a>. Таким образом тело
может содержать теги и <a 
href="#x54-128002r104">go</a> выражения. Декларации могут быть указаны
перед телом цикла.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> dolist </b><a 
 id="dx54-122001"></a><a 
 id="x54-122002r93"></a> (var listform [resultform])
</td></tr></table>
<!--l. 6545--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6546--><p class="indent" >
</div>
<!--l. 6546--><p class="noindent" ><span class="paragraphHead"><a 
href="#x54-1230007.8.3" id="x54-1230007.8.3"></a></span>
   <a 
href="#x54-122002r93">dolist</a> предоставляет прямой цикл по списку элементов. Сначала <a 
href="#x54-122002r93">dolist</a>
вычисляет форму <i>listform</i>, которая должна вернуть список. Затем для
каждого элемента вычисляется тело цикла. Данный элемент на каждой
итерации связывается с переменной <i>var</i>. Затем вычисляется <i>resultform</i> (одна
форма, <i>не</i> неявный <a 
href="clmse38.html#x50-96002r71">progn</a>). (Когда вычисляется <i>resultform</i>, переменная <i>var</i>
все ещё связана, и имеет значение <a 
href="clmse31.html#x42-74002r18">nil</a>.) Если <i>resultform</i> опущена, то результат
равен <a 
href="clmse31.html#x42-74002r18">nil</a>. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(dolist (x &#x2019;(a b c d)) (prin1 x) (princ &#x0022; &#x0022;)) <span class="math"> ⇒</span> <a 
href="clmse31.html#x42-74002r18">nil</a>
</td></tr></table>
<!--l. 6557--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   вывод «a b c d » (в том числе пробел в конце)</td></tr></table>
<!--l. 6559--><p class="indent" >
</div>
</div>
<!--l. 6560--><p class="noindent" >Для завершения цикла и возврата заданного значения может использоваться
явное выражение <a 
href="clmse137.html#x168-343002r840">return</a>.
</div>
                                                                          

                                                                          
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> dotimes </b><a 
 id="dx54-123001"></a><a 
 id="x54-123002r94"></a> (var countform [resultform])
</td></tr></table>
<!--l. 6566--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6567--><p class="indent" >
</div>
<!--l. 6567--><p class="noindent" ><span class="paragraphHead"><a 
href="#x54-1240007.8.3" id="x54-1240007.8.3"></a></span>
   <a 
href="#x54-123002r94">dotimes</a> предоставляет цикл над последовательностью целых чисел.
Выражение (dotimes (<i>var</i> <i>countform</i> <i>resultform</i>) . <i>progbody</i>) вычисляет
форму <i>countform</i>, которая должна вернуть целое число. Затем тело
цикла выполняется по порядку один раз для каждого число от нуля
(включительно) до <i>count</i> (исключая). При этом переменная <i>var</i> связывается
с текущим целым числом. Если значение <i>countform</i> отрицательно
или равно нулю, тогда <i>progbody</i> не выполняется ни разу. Наконец
выполняется <i>resultform</i> (одна форма, <i>не</i> неявный <a 
href="clmse38.html#x50-96002r71">progn</a>), и полученный
результат возвращается из формы цикла. (Когда <i>result</i> вычисляется,
переменная-индекс <i>var</i> все ещё связана и содержит количество выполненных
итераций.) Если <i>resultform</i> опущена, то результат равен <a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 6582--><p class="indent" >   Для завершения цикла и возврата заданного значения может использоваться
выражение <a 
href="clmse137.html#x168-343002r840">return</a>.
<!--l. 6585--><p class="indent" >   Пример использования <a 
href="#x54-123002r94">dotimes</a> для обработки строк: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; True if the speciﬁed subsequence of the string is a
</td></tr></table>
<!--l. 6587--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; palindrome (reads the same forwards and backwards).</td></tr></table>
<!--l. 6588--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6589--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun palindromep (string &#x0026;optional</td></tr></table>
<!--l. 6590--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                           (start 0)</td></tr></table>
<!--l. 6591--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                           (end (length string)))</td></tr></table>
<!--l. 6592--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (dotimes (k (ﬂoor (- end start) 2) <a 
href="clmse31.html#x42-74004r19">t</a>)</td></tr></table>
<!--l. 6593--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (unless (char-equal (char string (+ start k))</td></tr></table>
                                                                          

                                                                          
<!--l. 6594--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                        (char string (- end k 1)))</td></tr></table>
<!--l. 6595--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (return <a 
href="clmse31.html#x42-74002r18">nil</a>))))</td></tr></table>
<!--l. 6596--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6597--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep &#x0022;Able was I ere I saw Elba&#x0022;) <span class="math"> ⇒</span> <a 
href="clmse31.html#x42-74004r19">t</a></td></tr></table>
<!--l. 6598--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6599--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep &#x0022;A man, a plan, a canal–Panama!&#x0022;) <span class="math"> ⇒</span> <a 
href="clmse31.html#x42-74002r18">nil</a></td></tr></table>
<!--l. 6600--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6601--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remove-if-not #&#x2019;alpha-char-p     ;Удалить знаки препинания</td></tr></table>
<!--l. 6602--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               &#x0022;A man, a plan, a canal–Panama!&#x0022;)</td></tr></table>
<!--l. 6603--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> &#x0022;AmanaplanacanalPanama&#x0022;</td></tr></table>
<!--l. 6604--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6605--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep</td></tr></table>
<!--l. 6606--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> (remove-if-not #&#x2019;alpha-char-p</td></tr></table>
<!--l. 6607--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                &#x0022;A man, a plan, a canal–Panama!&#x0022;)) <span class="math"> ⇒</span> <a 
href="clmse31.html#x42-74004r19">t</a></td></tr></table>
<!--l. 6608--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6609--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep</td></tr></table>
<!--l. 6610--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> (remove-if-not</td></tr></table>
<!--l. 6611--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   #&#x2019;alpha-char-p</td></tr></table>
<!--l. 6612--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   &#x0022;Unremarkable was I ere I saw Elba Kramer, nu?&#x0022;)) <span class="math"> ⇒</span> <a 
href="clmse31.html#x42-74004r19">t</a></td></tr></table>
<!--l. 6613--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6614--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep</td></tr></table>
<!--l. 6615--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> (remove-if-not</td></tr></table>
<!--l. 6616--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   #&#x2019;alpha-char-p</td></tr></table>
<!--l. 6617--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   &#x0022;A man, a plan, a cat, a ham, a yak,</td></tr></table>
<!--l. 6618--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   a yam, a hat, a canal–Panama!&#x0022;)) <span class="math"> ⇒</span> <a 
href="clmse31.html#x42-74004r19">t</a></td></tr></table>
<!--l. 6620--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep</td></tr></table>
<!--l. 6621--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> (remove-if-not</td></tr></table>
<!--l. 6622--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   #&#x2019;alpha-char-p</td></tr></table>
<!--l. 6623--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   &#x0022;Ja-da, ja-da, ja-da ja-da jing jing jing&#x0022;)) <span class="math"> ⇒</span> <a 
href="clmse31.html#x42-74002r18">nil</a></td></tr></table>
<!--l. 6625--><p class="indent" >
</div>
</div>
<!--l. 6627--><p class="indent" >   Изменение значения переменной <i>var</i> в теле цикла (с помощью <a 
href="clmse35.html#x47-87002r59">setq</a>
например) будет иметь непредсказуемые последствия, возможно зависящие
от реализации. Компилятор Common Lisp&#x2019;а может вывести предупреждение о
том, что переменная-индекс используется в <a 
href="clmse35.html#x47-87002r59">setq</a>.
</div>
                                                                          

                                                                          
<!--l. 6633--><p class="indent" >   Смотрите также <a 
href="clmse60.html#x76-170004r165">do-symbols</a>, <a 
href="clmse60.html#x76-171002r166">do-external-symbols</a> и <a 
href="clmse60.html#x76-172002r167">do-all-symbols</a>.
<!--l. 6636--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.4   </span> <a 
href="clmli1.html#QQ2-54-132" id="x54-1250007.8.4">Отображение</a></h4>
<a 
 id="dx54-125001"></a>
<!--l. 6639--><p class="noindent" >Отображение — это тип цикла, в котором заданная функция применяется к
частям одной или более последовательностей. Результатом цикла является
последовательность, полученная из результатов выполнения это функции.
Существует несколько опции для указания того, какие части списка будут
использоваться в цикле, и что будет происходить с результатом применения
функции.
<!--l. 6646--><p class="indent" >   Функция <a 
href="clmse77.html#x96-197005r370">map</a> может быть использована для отображения любого
типа последовательности. Следующие же функции оперируют только
списками.
<div class=defun>
<!--l. 6650--><p class="noindent" ><i>[Функция]</i><a 
 id="dx54-125002"></a><a 
 id="x54-125003r95"></a><b> mapcar</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx54-125004"></a><a 
 id="x54-125005r96"></a><b> maplist</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx54-125006"></a><a 
 id="x54-125007r97"></a><b> mapc</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx54-125008"></a><a 
 id="x54-125009r98"></a><b> mapl</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx54-125010"></a><a 
 id="x54-125011r99"></a><b> mapcan</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx54-125012"></a><a 
 id="x54-125013r100"></a><b> mapcon</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i>
<!--l. 6657--><p class="noindent" >Для каждой из этих функций отображения, первый аргумент является
функцией и оставшиеся аргументы должны быть списками. Функция в
первом аргументе должно принимать столько аргументов, сколько было
передано списков в функцию отображения.
<!--l. 6663--><p class="indent" >   <a 
href="#x54-125003r95">mapcar</a> последовательно обрабатывает элементы списков. Сначала
функция применяется к <i>car</i> элементу каждого списка, затем к <i>cadr</i> элементу,
и так далее. (Лучше всего, чтобы все переданные списки имели одинаковую
длину. Если это не так, то цикл завершиться, как только закончится самый
короткий список, и все оставшиеся элементы в других списках будут
проигнорированы.) Значение, возвращаемое <a 
href="#x54-125003r95">mapcar</a>, является списком
результатов последовательных вызовов функции из первого параметра.
Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mapcar #&#x2019;abs &#x2019;(3 -4 2 -5 -6)) <span class="math"> ⇒</span> (3 4 2 5 6)
</td></tr></table>
                                                                          

                                                                          
<!--l. 6673--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mapcar #&#x2019;cons &#x2019;(a b c) &#x2019;(1 2 3)) <span class="math"> ⇒</span> ((a . 1) (b . 2) (c . 3))</td></tr></table>
<!--l. 6675--><p class="indent" >
</div>
</div>
<!--l. 6677--><p class="indent" >   <a 
href="#x54-125005r96">maplist</a> похожа на <a 
href="#x54-125003r95">mapcar</a> за исключением того, что функция применяется
к спискам и последующим <i>cdr</i> элементам этих списков, а не последовательно
к элементам спискам. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(maplist #&#x2019;(lambda (x) (cons &#x2019;foo x))
</td></tr></table>
<!--l. 6682--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         &#x2019;(a b c d))</td></tr></table>
<!--l. 6683--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> ((foo a b c d) (foo b c d) (foo c d) (foo d))</td></tr></table>
<!--l. 6685--><p class="indent" >
</div>
</div>
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(maplist #&#x2019;(lambda (x) (if (member (car x) (cdr x)) 0 1)))
</td></tr></table>
<!--l. 6688--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         &#x2019;(a b a c d b c))</td></tr></table>
<!--l. 6689--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> (0 0 1 0 1 1 1)</td></tr></table>
<!--l. 6690--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   ;Возвращается 1, если соответствующий элемент входящего списка</td></tr></table>
<!--l. 6691--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   ;  появлялся последний раз в данном списке.</td></tr></table>
<!--l. 6693--><p class="indent" >
</div>
</div>
<!--l. 6695--><p class="indent" >   <a 
href="#x54-125009r98">mapl</a> и <a 
href="#x54-125007r97">mapc</a> похожи на <a 
href="#x54-125005r96">maplist</a> и <a 
href="#x54-125003r95">mapcar</a>, соответственно, за исключением
того, что они не накапливают результаты вызова функций.
<!--l. 6698--><p class="indent" >   Эти функции используются, когда функция в первом параметре
предназначена для побочных эффектов, а не для возвращаемого значения.
Значение возвращаемое <a 
href="#x54-125009r98">mapl</a> или <a 
href="#x54-125007r97">mapc</a> является вторым аргументом, то есть
первой последовательностью для отображения.
                                                                          

                                                                          
<!--l. 6703--><p class="indent" >   <a 
href="#x54-125011r99">mapcan</a> и <a 
href="#x54-125013r100">mapcon</a> похожи на <a 
href="#x54-125003r95">mapcar</a> и <a 
href="#x54-125005r96">maplist</a> соответственно, за
исключением того, что результат создаётся с помощью функции <a 
href="clmse134.html#x165-333006r824">nconc</a>, а не
<a 
href="clmse82.html#x102-203038r456">list</a>. То есть, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mapcon <i>f </i> <i>x1</i> ... <i>xn</i>)
</td></tr></table>
<!--l. 6707--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (apply #&#x2019;nconc (maplist <i>f </i> <i>x1</i> ... <i>xn</i>))</td></tr></table>
<!--l. 6709--><p class="indent" >
</div>
</div>
<!--l. 6710--><p class="noindent" >Такое же различие между <a 
href="#x54-125011r99">mapcan</a> и <a 
href="#x54-125003r95">mapcar</a>. Концептуально, эти функции
позволяют функции отображения возвращать переменное количество
элементов. Таким образом длина результата может быть не равна длине
входного списка. Это, в частности, полезно для возврата нуля или одного
элемента: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mapcan #&#x2019;(lambda (x) (and (numberp x) (list x)))
</td></tr></table>
<!--l. 6716--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x2019;(a 1 b c 3 4 d 5))</td></tr></table>
<!--l. 6717--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> (1 3 4 5)</td></tr></table>
<!--l. 6719--><p class="indent" >
</div>
</div>
<!--l. 6720--><p class="noindent" >В этом случае функция действует, как фильтр. Это стандартная Lisp&#x2019;овая
идиома использования <a 
href="#x54-125011r99">mapcan</a>. (Однако, в этом контексте функция
<a 
href="clmse78.html#x97-198010r381">remove-if-not</a> также может быть полезна.) Помните, что <a 
href="clmse134.html#x165-333006r824">nconc</a> деструктивная
операция, следовательно и <a 
href="#x54-125011r99">mapcan</a> и <a 
href="#x54-125013r100">mapcon</a> также деструктивны. Список
возвращаемый функцией <i>function</i> изменяется для соединения и возврата
результата.
<!--l. 6727--><p class="indent" >   Иногда <a 
href="clmse137.html#x168-342002r838">do</a> или прямая последовательная рекурсия удобнее, чем функции
отображения. Однако, функции отображения должны быть использованы
везде, где они действительно необходимы, так как они увеличивают ясность
кода.
<!--l. 6731--><p class="indent" >   Функциональный аргумент функции отображения должен быть
подходящим для функции <a 
href="clmse37.html#x49-95002r68">apply</a>. Он не может быть макросов или
                                                                          

                                                                          
именем специальной формы. Кроме того, в качестве функционального
аргумента можно использовать функцию, имеющую &#x0026;optional и &#x0026;rest
параметры.
</div>
<!--l. 6737--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.5   </span> <a 
href="clmli1.html#QQ2-54-133" id="x54-1260007.8.5">Использование «GOTO»</a></h4>
<!--l. 6739--><p class="noindent" >Реализации Lisp&#x2019;а начиная с Lisp&#x2019;а 1.5 содержат то, что изначально
называлось «the program feature», как будто без этого невозможно писать
программы! Конструкция <a 
href="#x54-127002r102">prog</a> позволяет писать в Algol- или Fortran-
императивном стиле, используя выражения <a 
href="#x54-128002r104">go</a>, которые могут ссылаться на
теги в теле <a 
href="#x54-127002r102">prog</a>. Современный стиль программирования на Lisp&#x2019;е стремится
снизить использование <a 
href="#x54-127002r102">prog</a>. Различные конструкции циклов, как <a 
href="clmse137.html#x168-342002r838">do</a>, имеют
тела с характеристиками <a 
href="#x54-127002r102">prog</a>. (Тем не менее, возможность использовать
выражения <a 
href="#x54-128002r104">go</a> внутри конструкции цикла очень редко используется на
практике.)
<!--l. 6749--><p class="indent" >   <a 
href="#x54-127002r102">prog</a> предоставляет три различные операции: связывание локальный
переменных, использование выражения <a 
href="clmse137.html#x168-343002r840">return</a> и использование выражения
<a 
href="#x54-128002r104">go</a>. В Common Lisp&#x2019;е эти три операции были разделены на три конструкции:
<a 
href="clmse39.html#x51-100002r74">let</a>, <a 
href="clmse41.html#x53-113002r87">block</a> и <a 
href="#x54-126002r101">tagbody</a>. Эти три конструкции могут использоваться независимо,
как строительные кирпичики для других типов конструкций.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> tagbody </b><a 
 id="dx54-126001"></a><a 
 id="x54-126002r101"></a> {tag | statement}*
</td></tr></table>
<!--l. 6760--><p class="indent" >
</div>
<!--l. 6760--><p class="noindent" ><span class="paragraphHead"><a 
href="#x54-1270007.8.5" id="x54-1270007.8.5"></a></span>
   Часть <a 
href="#x54-126002r101">tagbody</a> после списка переменные называется <i>телом</i>. Элемент тела
может быть символов или целым числом, и называться в этом случае <i>тег</i>.
Также элемент тела может быть списком, и называться в этом случае
                                                                          

                                                                          
<i>выражением</i>.
<!--l. 6766--><p class="indent" >   Каждый элемент тела обрабатывается слева направо. <i>Теги</i> игнорируются.
<i>Выражения</i> вычисляются и их результаты игнорируются. Если управление
достигает конца тела, <a 
href="#x54-126002r101">tagbody</a> возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 6771--><p class="indent" >   Если вычисляется форма (go <i>tag</i>), управление перемещается на часть
тела, обозначенную <i>тегом</i>.
<!--l. 6774--><p class="indent" >   Область видимости тегов, устанавливаемых в <a 
href="#x54-126002r101">tagbody</a>, является
лексической. Продолжительность видимости тегов динамическая. Когда
управление вышло из конструкции <a 
href="#x54-126002r101">tagbody</a>, ссылка <a 
href="#x54-128002r104">go</a> на теги в её теле
невозможны. Существует возможность для <a 
href="#x54-128002r104">go</a> прыжка в <a 
href="#x54-126002r101">tagbody</a>,
которая не находится внутри конструкции <a 
href="#x54-126002r101">tagbody</a>, которая и содержала
этот <a 
href="#x54-128002r104">go</a>. То есть возможны прыжки в родительский <a 
href="#x54-126002r101">tagbody</a>. Теги
устанавливаемые <a 
href="#x54-126002r101">tagbody</a> будут только скрывать другие одноимённые
теги.
<!--l. 6783--><p class="indent" >   Лексическая область видимости для тегов (целей <a 
href="#x54-128002r104">go</a>) полностью
полноправно и последствия могут быть сюрпризом для пользователей и
разработчиков других Lisp систем. Например, <a 
href="#x54-128002r104">go</a> в следующем примере,
работает в Common Lisp так, как это и ожидается: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(tagbody
</td></tr></table>
<!--l. 6789--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (catch &#x2019;stuﬀ</td></tr></table>
<!--l. 6790--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (mapcar #&#x2019;(lambda (x) (if (numberp x)</td></tr></table>
<!--l. 6791--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                (hairyfun x)</td></tr></table>
<!--l. 6792--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                (go lose)))</td></tr></table>
<!--l. 6793--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              items))</td></tr></table>
<!--l. 6794--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (return)</td></tr></table>
<!--l. 6795--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> lose</td></tr></table>
<!--l. 6796--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (error &#x0022;I lost big!&#x0022;))</td></tr></table>
<!--l. 6798--><p class="indent" >
</div>
</div>
<!--l. 6799--><p class="noindent" >В зависимости от ситуации, <a 
href="#x54-128002r104">go</a> в Common Lisp&#x2019;е не обязательно похож на
простую машинную инструкцию «jump». Если необходимо, <a 
href="#x54-128002r104">go</a> может
перепрыгивать ловушки исключений. Возможно так, что «замыкание»,
созданное с помощью <a 
href="clmse35.html#x47-85002r52">function</a>, для лямбда-выражения ссылается на тег (цель
                                                                          

                                                                          
<a 
href="#x54-128002r104">go</a>) так долго, сколько лексически доступен данный тег. Смотрите <a 
href="clmch3.html#x25-430003">3<!--tex4ht:ref: SCOPE --></a> для
понимания этого примера.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> prog </b><a 
 id="dx54-127001"></a><a 
 id="x54-127002r102"></a> ( {var | (var [init])}* )  {declaration}*  {tag | statement}*
</td></tr></table>
<!--l. 6808--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Макрос]</i><b> prog* </b><a 
 id="dx54-127003"></a><a 
 id="x54-127004r103"></a> ( {var | (var [init])}* )  {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6810--><p class="indent" >
</div>
<!--l. 6810--><p class="noindent" ><span class="paragraphHead"><a 
href="#x54-1280007.8.5" id="x54-1280007.8.5"></a></span>
   Конструкция <a 
href="#x54-127002r102">prog</a> является синтезом <a 
href="clmse39.html#x51-100002r74">let</a>, <a 
href="clmse41.html#x53-113002r87">block</a> и <a 
href="#x54-126002r101">tagbody</a>, позволяющая
связывать переменные, использовать <a 
href="clmse137.html#x168-343002r840">return</a> и <a 
href="#x54-128002r104">go</a> в одной конструкции.
Обычно конструкция <a 
href="#x54-127002r102">prog</a> выглядит так: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(prog (<i>var1</i> <i>var2</i> (<i>var3</i> <i>init3</i>) <i>var4</i> (<i>var5</i> <i>init5</i>))
</td></tr></table>
<!--l. 6815--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       {<i><i>declaration</i></i>}* </td></tr></table>
<!--l. 6816--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement1</i></td></tr></table>
<!--l. 6817--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>tag1</i></td></tr></table>
<!--l. 6818--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement2</i></td></tr></table>
<!--l. 6819--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement3</i></td></tr></table>
<!--l. 6820--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement4</i></td></tr></table>
<!--l. 6821--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>tag2</i></td></tr></table>
<!--l. 6822--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement5</i></td></tr></table>
<!--l. 6823--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 6824--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      )</td></tr></table>
<!--l. 6826--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 6827--><p class="noindent" >Список после ключевого символа <a 
href="#x54-127002r102">prog</a> является множеством спецификаторов
для связывания переменных <i>var1</i>, <i>var2</i>. Этот список обрабатывается так же,
как и в выражении <a 
href="clmse39.html#x51-100002r74">let</a>: сначала слева направо выполняются все формы <i>init</i>
(если формы нет, берётся значение <a 
href="clmse31.html#x42-74002r18">nil</a>), и затем переменные параллельно
связываются с полученными ранее значениями. Возможно использовать
<i>декларации</i> в начале дела <a 
href="#x54-127002r102">prog</a> так же, как и в <a 
href="clmse39.html#x51-100002r74">let</a>.
<!--l. 6836--><p class="indent" >   Тело <a 
href="#x54-127002r102">prog</a> выполняется, как обернутое в <a 
href="#x54-126002r101">tagbody</a>. Таким образом, для
перемещения управления к <i>тегу</i> могут использоваться выражения
<a 
href="#x54-128002r104">go</a>.
<!--l. 6839--><p class="indent" >   <a 
href="#x54-127002r102">prog</a> неявно устанавливает вокруг тела <a 
href="clmse41.html#x53-113002r87">block</a> с именем <a 
href="clmse31.html#x42-74002r18">nil</a>. Это значит,
можно в любое время использовать <a 
href="clmse137.html#x168-343002r840">return</a> для выхода из конструкции
<a 
href="#x54-127002r102">prog</a>.
<!--l. 6842--><p class="indent" >   Вот небольшой пример того, что можно сделать с помощью <a 
href="#x54-127002r102">prog</a>:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun king-of-confusion (w)
</td></tr></table>
<!--l. 6844--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  &#x0022;Take a cons of two lists and make a list of conses.</td></tr></table>
<!--l. 6845--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   Think of this function as being like a zipper.&#x0022;</td></tr></table>
<!--l. 6846--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (prog (x y z)     ;Инициализировать x, y, z в <a 
href="clmse31.html#x42-74002r18">nil</a></td></tr></table>
<!--l. 6847--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq y (car w) z (cdr w))</td></tr></table>
<!--l. 6848--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   loop</td></tr></table>
<!--l. 6849--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (cond ((null y) (return x))</td></tr></table>
<!--l. 6850--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              ((null z) (go err)))</td></tr></table>
<!--l. 6851--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   rejoin</td></tr></table>
<!--l. 6852--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq x (cons (cons (car y) (car z)) x))</td></tr></table>
<!--l. 6853--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq y (cdr y) z (cdr z))</td></tr></table>
<!--l. 6854--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (go loop)</td></tr></table>
<!--l. 6855--><p class="indent" >                                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   err</td></tr></table>
<!--l. 6856--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (cerror &#x0022;Will self-pair extraneous items&#x0022;</td></tr></table>
<!--l. 6857--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                &#x0022;Mismatch - gleep!  S&#x0022; y)</td></tr></table>
<!--l. 6858--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq z y)</td></tr></table>
<!--l. 6859--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (go rejoin)))</td></tr></table>
<!--l. 6861--><p class="indent" >
</div>
</div>
<!--l. 6862--><p class="noindent" >которые делает то же, что и: <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun prince-of-clarity (w)
</td></tr></table>
<!--l. 6864--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  &#x0022;Take a cons of two lists and make a list of conses.</td></tr></table>
<!--l. 6865--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   Think of this function as being like a zipper.&#x0022;</td></tr></table>
<!--l. 6866--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (do ((y (car w) (cdr y))</td></tr></table>
<!--l. 6867--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (z (cdr w) (cdr z))</td></tr></table>
<!--l. 6868--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (x &#x2019;() (cons (cons (car y) (car z)) x)))</td></tr></table>
<!--l. 6869--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ((null y) x)</td></tr></table>
<!--l. 6870--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (when (null z)</td></tr></table>
<!--l. 6871--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (cerror &#x0022;Will self-pair extraneous items&#x0022;</td></tr></table>
<!--l. 6872--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              &#x0022;Mismatch - gleep!  S&#x0022; y)</td></tr></table>
<!--l. 6873--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (setq z y))))</td></tr></table>
<!--l. 6875--><p class="indent" >
</div>
</div>
<!--l. 6877--><p class="indent" >   Конструкция <a 
href="#x54-127002r102">prog</a> может быть выражена в терминах более простых
конструкций <a 
href="clmse41.html#x53-113002r87">block</a>, <a 
href="clmse39.html#x51-100002r74">let</a> и <a 
href="#x54-126002r101">tagbody</a>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(prog <i>variable-list</i> {<i><i>declaration</i></i>}*  . <i>body</i>)
</td></tr></table>
<!--l. 6880--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (block nil (let <i>variable-list</i> {<i><i>declaration</i></i>}*  (tagbody . <i>body</i>)))</td></tr></table>
<!--l. 6882--><p class="indent" >
</div>
</div>
<!--l. 6884--><p class="indent" >   Специальная форма <a 
href="#x54-127004r103">prog*</a> очень похожа на <a 
href="#x54-127002r102">prog</a>. Одно отличие в
том, что связывание и инициализация переменных осуществляется
<i>последовательно</i>, тем самым форма <i>init</i> использовать значения ранее
связанных переменных. Таким образом <a 
href="#x54-127004r103">prog*</a> относится к <a 
href="#x54-127002r102">prog</a>, как <a 
href="clmse39.html#x51-101002r75">let*</a> к <a 
href="clmse39.html#x51-100002r74">let</a>.
Например, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(prog* ((y z) (x (car y)))
</td></tr></table>
<!--l. 6890--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (return x))</td></tr></table>
<!--l. 6892--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 6893--><p class="noindent" >возвращает <i>car</i> элемент значения z.
</div>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> go </b><a 
 id="dx54-128001"></a><a 
 id="x54-128002r104"></a> tag
</td></tr></table>
<!--l. 6898--><p class="indent" >
</div>
<!--l. 6898--><p class="noindent" ><span class="paragraphHead"><a 
href="#x54-1290007.8.5" id="x54-1290007.8.5"></a></span>
   Специальная форма (go <i>tag</i>) используется для применения «goto»
внутри конструкции <a 
href="#x54-126002r101">tagbody</a>. <i>tag</i> должен быть символов или целым
числом. <i>tag</i> не вычисляется. <a 
href="#x54-128002r104">go</a> переносит управление на точку тела,
которая была помечена тегом равным <a 
href="clmse33.html#x44-78004r45">eql</a> заданному. Если такого тега в
теле нет, поиск осуществляется в лексически доступном теле другой
конструкции <a 
href="#x54-126002r101">tagbody</a>. Использоваться <a 
href="#x54-128002r104">go</a> с тегом, которого нет, является
ошибкой.
<!--l. 6907--><p class="indent" >   Форма <a 
href="#x54-128002r104">go</a> никогда не возвращает значение.
<!--l. 6909--><p class="indent" >   В целях стиля, рекомендуется дважды подумать, прежде чем использовать
<a 
href="#x54-128002r104">go</a>. Большинство функций <a 
href="#x54-128002r104">go</a> могут быть заменены циклами, вложенными
условными формами или <a 
href="clmse41.html#x53-114002r88">return-from</a>. Если использование <a 
href="#x54-128002r104">go</a> неизбежно,
рекомендуется управляющую структуру реализованную с помощью <a 
href="#x54-128002r104">go</a>
«упаковать» в определении макроса.
</div>
                                                                          

                                                                          
   <!--l. 6916--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse43.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse41.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse41.html#tailclmse41.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse42.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse42.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 6916--><p class="indent" >   <a 
 id="tailclmse42.html"></a>   
</body></html> 
