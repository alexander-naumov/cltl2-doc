<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Обобщённые переменные</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-28 14:08:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 5116--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse37.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse35.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse35.html#tailclmse35.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse36.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse36.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">7.2   </span> <a 
href="clm.html#QQ2-48-97" id="x48-900007.2">Обобщённые переменные</a></h3>
<!--l. 5119--><p class="noindent" >В Lisp&#x2019;е, переменная может запомнить одну часть данных, а точнее, один
Lisp объект. Главные операции над переменной это получить её значение и
задать ей другое значение. Их часто называют операциями <i>доступа</i> и
<i>изменения</i>. Концепция переменных с именем в виде символа может быть
обобщена до того, что любое место может сохранять в себе части данных вне
зависимости от того, как данное место именуется. Примерами таких мест
хранения являются <i>car</i> и <i>cdr</i> элементы cons-ячейки, элементы массива, и
компоненты структуры.
<!--l. 5129--><p class="indent" >   Для каждого вида обобщённых переменных существуют две функции,
которые реализуют операции <i>доступа</i> и <i>изменения</i>. Для переменных это имя
переменной для доступа, а для изменения специальная форма <a 
href="clmse35.html#x47-87002r59">setq</a>. Функция
<a 
href="clmse80.html#x100-201002r393">car</a> получает доступ к <i>car</i> элементу cons-ячейки, а функция <a 
href="clmse82.html#x102-206002r457">rplaca</a> изменяет
этот элемент ячейки. Функция <a 
href="clmse35.html#x47-86004r53">symbol-value</a> получает динамическое значение
переменной именованной некоторым символом, а функция <a 
href="clmse35.html#x47-89002r61">set</a> изменяет эту
переменную.
<!--l. 5137--><p class="indent" >   Вместо того, чтобы думать о двух разных функциях, которые
соответственно получают доступ и изменяют некоторое место хранения в
зависимости от своих аргументов, мы может думать просто о вызове
функции доступа с некоторыми аргументами, как о <i>имени</i> данного места
хранения. Таким образом, просто x является именем места хранения
(переменной), (car x) имя для <i>car</i> элементы для некоторой cons-ячейки
(которая в свою очередь именуется символом x). Теперь вместо того, чтобы
запоминать по две функции для каждого вида обобщённых переменных
(например <a 
href="clmse82.html#x102-206002r457">rplaca</a> для <a 
href="clmse80.html#x100-201002r393">car</a>), мы адаптировали единый синтаксис для изменения
некоторого места хранения с помощью макроса <a 
href="#x48-90002r64">setf</a>. Это аналогично способу,
где мы используем специальную форму <a 
href="clmse35.html#x47-87002r59">setq</a> для преобразования имени
переменной (которая является также формой для доступа к ней) в форму,
которая изменяет переменную FIXME. Эта универсальной отображения в
следующей таблице.
                                                                          

                                                                          
<div class="flushleft" 
>
<!--l. 5151--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" >Функция доступа </td><td align="left" >Функция изменения</td><td align="left" >Изменения с помощью <a 
href="#x48-90002r64">setf</a>   </td>
</tr><tr><td align="left" >x                        </td><td align="left" >(setq x datum)        </td><td align="left" >(setf x datum)                    </td>
</tr><tr><td align="left" >(car x)                </td><td align="left" >(rplaca x datum)     </td><td align="left" >(setf (car x) datum)             </td>
</tr><tr><td align="left" >(symbol-value x)   </td><td align="left" >(set x datum)          </td><td align="left" >(setf (symbol-value x) datum)</td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr><td align="left" >  </td></tr></table>
</div></div>
<!--l. 5161--><p class="noindent" ><a 
href="#x48-90002r64">setf</a> это макрос, который анализирует форму доступа, и производит вызов
соответствующей функции изменения.
<!--l. 5164--><p class="indent" >   С появление в Common Lisp&#x2019;е <a 
href="#x48-90002r64">setf</a>, необходимость в <a 
href="clmse35.html#x47-87002r59">setq</a>, <a 
href="clmse82.html#x102-206002r457">rplaca</a> и <a 
href="clmse35.html#x47-89002r61">set</a>
отпала. Они оставлены в Common Lisp из-за их исторической важности в
Lisp&#x2019;е. Однако, большинство других функций изменения (например
putprop, функция изменения для <a 
href="clmse51.html#x66-157002r127">get</a>) были устранены из Common
Lisp&#x2019;а в расчёте на то, что везде на их месте будет использоваться
<a 
href="#x48-90002r64">setf</a>.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> setf </b><a 
 id="dx48-90001"></a><a 
 id="x48-90002r64"></a> {place newvalue}*
</td></tr></table>
<!--l. 5173--><p class="indent" >
</div>
<!--l. 5173--><p class="noindent" ><span class="paragraphHead"><a 
href="#x48-910007.2" id="x48-910007.2"></a></span>
   (setf <i>place</i> <i>newvalue</i>) принимает форму <i>place</i>, которая при своём
вычислении получает доступ к объекту в некотором месте хранения и
«инвертирует» эту форму в соответствующую форму <i>изменения</i>. Таким
образом вызов макроса <a 
href="#x48-90002r64">setf</a> разворачивается в форму изменения, которая
сохраняет результат вычисления формы <i>newvalue</i> в место хранения, на
которое ссылалась форма доступа.
<!--l. 5181--><p class="indent" >   Если пар <i>place</i>-<i>newvalue</i> указано более одной, эти пары обрабатываются
последовательно. Таким образом: <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf <i>place1</i> <i>newvalue1</i>
</td></tr></table>
<!--l. 5184--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>place2</i> <i>newvalue2</i>)</td></tr></table>
<!--l. 5185--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 5186--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>placen</i> <i>newvaluen</i>)</td></tr></table>
<!--l. 5188--><p class="indent" >
</div>
</div>
<!--l. 5189--><p class="noindent" >эквивалентно <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf <i>place1</i> <i>newvalue1</i>
</td></tr></table>
<!--l. 5191--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>place2</i> <i>newvalue2</i>)</td></tr></table>
<!--l. 5192--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 5193--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>placen</i> <i>newvaluen</i>)</td></tr></table>
<!--l. 5195--><p class="indent" >
</div>
</div>
<!--l. 5196--><p class="noindent" >Следует отметить, что запись (setf) является корректной и возвращает
<a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 5198--><p class="indent" >   Форма <i>place</i> может быть одной из следующих:
      <ul class="itemize1">
      <li class="itemize">Имя переменной (лексической и динамической).
      </li>
      <li class="itemize">Формой вызова функции, у которой первый элемент принадлежит
      множеству указанному в следующей таблице:
      <div class="flushleft" 
>
<!--l. 5208--><p class="noindent" >
                                                                          

                                                                          
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" ><a 
href="clmse89.html#x111-215002r506">aref</a>     </td><td align="left" ><a 
href="clmse80.html#x100-201002r393">car</a>    </td><td align="left" ><a 
href="clmse89.html#x111-215004r507">svref</a>             </td><td align="left" >                     </td></tr><tr><td align="left" ><a 
href="clmse81.html#x101-202006r427">nth</a> </td> <td align="left" ><a 
href="clmse80.html#x100-201004r394">cdr</a> </td> <td align="left" ><a 
href="clmse51.html#x66-157002r127">get</a> </td> <td align="left" ></td>
</tr><tr><td align="left" ><a 
href="clmse75.html#x94-195002r348">elt</a>      </td><td align="left" ><a 
href="clmse80.html#x100-201006r395">caar</a>  </td><td align="left" ><a 
href="clmse51.html#x66-157008r130">getf</a>               </td><td align="left" ><a 
href="clmse35.html#x47-86004r53">symbol-value</a>    </td>
</tr><tr><td align="left" ><a 
href="clmse81.html#x101-202028r438">rest</a>     </td><td align="left" ><a 
href="clmse80.html#x100-201008r396">cadr</a>  </td><td align="left" ><a 
href="clmse86.html#x107-211006r491">gethash</a>         </td><td align="left" ><a 
href="clmse35.html#x47-86006r54">symbol-function</a></td>
</tr><tr><td align="left" ><a 
href="clmse81.html#x101-202008r428">ﬁrst</a>     </td><td align="left" ><a 
href="clmse80.html#x100-201010r397">cdar</a>  </td><td align="left" ><a 
href="clmse144.html#x177-415017r857">documentation</a></td><td align="left" ><a 
href="clmse51.html#x66-157006r129">symbol-plist</a>     </td>
</tr><tr><td align="left" ><a 
href="clmse81.html#x101-202010r429">second</a> </td><td align="left" ><a 
href="clmse80.html#x100-201012r398">cddr</a>  </td><td align="left" ><a 
href="clmse92.html#x114-218004r531">ﬁll-pointer</a>      </td><td align="left" ><a 
href="clmse45.html#x58-144002r117">macro-function</a> </td>
</tr><tr><td align="left" ><a 
href="clmse81.html#x101-202012r430">third</a>   </td><td align="left" ><a 
href="clmse80.html#x100-201014r399">caaar</a> </td><td align="left" ><a 
href="clmse80.html#x100-201030r407">caaaar</a>           </td><td align="left" ><a 
href="clmse80.html#x100-201046r415">cdaaar</a>            </td></tr><tr><td align="left" ><a 
href="clmse81.html#x101-202014r431">fourth</a> </td> <td align="left" ><a 
href="clmse80.html#x100-201016r400">caadr</a></td> <td align="left" ><a 
href="clmse80.html#x100-201032r408">caaadr</a> </td> <td align="left" ><a 
href="clmse80.html#x100-201048r416">cdaadr</a></td>
</tr><tr><td align="left" ><a 
href="clmse81.html#x101-202016r432">ﬁfth</a>    </td><td align="left" ><a 
href="clmse80.html#x100-201018r401">cadar</a></td><td align="left" ><a 
href="clmse80.html#x100-201034r409">caadar</a>           </td><td align="left" ><a 
href="clmse80.html#x100-201050r417">cdadar</a>            </td></tr><tr><td align="left" ><a 
href="clmse81.html#x101-202018r433">sixth</a> </td> <td align="left" ><a 
href="clmse80.html#x100-201020r402">caddr</a></td> <td align="left" ><a 
href="clmse80.html#x100-201036r410">caaddr</a> </td> <td align="left" ><a 
href="clmse80.html#x100-201052r418">cdaddr</a></td>
</tr><tr><td align="left" ><a 
href="clmse81.html#x101-202020r434">seventh</a></td><td align="left" ><a 
href="clmse80.html#x100-201022r403">cdaar</a></td><td align="left" ><a 
href="clmse80.html#x100-201038r411">cadaar</a>           </td><td align="left" ><a 
href="clmse80.html#x100-201054r419">cddaar</a>            </td></tr><tr><td align="left" ><a 
href="clmse81.html#x101-202022r435">eighth</a> </td> <td align="left" ><a 
href="clmse80.html#x100-201024r404">cdadr</a></td> <td align="left" ><a 
href="clmse80.html#x100-201040r412">cadadr</a> </td> <td align="left" ><a 
href="clmse80.html#x100-201056r420">cddadr</a></td>
</tr><tr><td align="left" ><a 
href="clmse81.html#x101-202024r436">ninth</a>   </td><td align="left" ><a 
href="clmse80.html#x100-201026r405">cddar</a></td><td align="left" ><a 
href="clmse80.html#x100-201042r413">caddar</a>           </td><td align="left" ><a 
href="clmse80.html#x100-201058r421">cdddar</a>            </td></tr><tr><td align="left" ><a 
href="clmse81.html#x101-202026r437">tenth</a> </td> <td align="left" ><a 
href="clmse80.html#x100-201028r406">cdddr</a></td> <td align="left" ><a 
href="clmse80.html#x100-201044r414">cadddr</a> </td> <td align="left" ><a 
href="clmse80.html#x100-201060r422">cddddr</a></td>
</tr></table></div></div>
      </li>
      <li class="itemize">Формой вызова функции, у которой первый элемент является именем
      функции-селектора созданной с помощью <a 
href="clmse98.html#x122-226002r561">defstruct</a>.
      </li>
      <li class="itemize">Форма вызова функции, первый элемент которой является именем
      одной из следующих функций при условии, что указанный аргумент
      этой функции в свою очередь является формой <i>place</i>. in this case the
      new <i>place</i> has stored back into it the result of applying the speciﬁed
      “update” function (which is in each of these cases not a true update
      function): FIXME
      <div class="flushleft" 
>
<!--l. 5239--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" >Имя функции</td><td align="left" >Аргумент являющийся <i>местом</i></td><td align="left" >Функция изменения</td>
</tr><tr><td align="left" >char-bit         </td><td align="left" >ﬁrst                                       </td><td align="left" >set-char-bit             </td></tr><tr><td align="left" ><a 
href="clmse68.html#x85-186008r275">ldb</a> </td> <td align="left" >second </td> <td align="left" ><a 
href="clmse68.html#x85-186014r278">dpb</a></td>
</tr><tr><td align="left" ><a 
href="clmse68.html#x85-186012r277">mask-ﬁeld</a>      </td><td align="left" >second                                   </td><td align="left" ><a 
href="clmse68.html#x85-186016r279">deposit-ﬁeld</a>            </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr><td align="left" > </td></tr></table>
</div></div>
      </li>
      <li class="itemize">Форма декларации типа <a 
href="clmse50.html#x64-154002r126">the</a>, в таком случае декларация переносится на
      форму <i>newvalue</i>, и анализируется результирующая <a 
href="#x48-90002r64">setf</a> форма.
      Например: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setf (the integer (cadr x)) (+ y 3))
</td></tr></table>
                                                                          

                                                                          
      <!--l. 5255--><p class="noindent" >
</div>
</div>
      <!--l. 5256--><p class="noindent" >будет обработана как <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setf (cadr x) (the integer (+ y 3)))
</td></tr></table>
      <!--l. 5259--><p class="noindent" >
</div>
</div>
      </li>
      <li class="itemize">Вызов функции <a 
href="clmse37.html#x49-95002r68">apply</a>, в которой первый аргумент является функцией,
      которая может является <i>местом</i> для <a 
href="#x48-90002r64">setf</a>.
      </li>
      <li class="itemize">Макровызов, в случае чего <a 
href="#x48-90002r64">setf</a> разворачивает макровызов и затем
      анализирует полученную форму.
      </li>
      <li class="itemize">Любая форма, для которой было сделано определение с помощью defsetf
      или deﬁne-setf-method.</li></ul>
<!--l. 5274--><p class="indent" >   <a 
href="#x48-90002r64">setf</a> тщательно сохраняет обычный порядок выполнения подформ
слева направо. С другой стороны, точное раскрытие для какой-нибудь
частной формы не гарантируется и может зависеть от реализации. Все,
что гарантируется, это раскрытие <a 
href="#x48-90002r64">setf</a> формы в некоторую функцию
изменения, используемую данной реализацией, и выполнение подформ слева
направо.
<!--l. 5281--><p class="indent" >   Конечным результатом вычисления формы <a 
href="#x48-90002r64">setf</a> является значение
<i>newvalue</i>. Таким образом (setf (car x) y) раскрывается не прямо в (rplaca x y),
а в что-то вроде <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((G1 x) (G2 y)) (rplaca G1 G2) G2)
</td></tr></table>
<!--l. 5286--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 5287--><p class="noindent" >точное раскрытие зависит от реализации.
<!--l. 5289--><p class="indent" >   Пользователь может определить новое раскрытие для <a 
href="#x48-90002r64">setf</a> используя
defsetf.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> psetf </b><a 
 id="dx48-91001"></a><a 
 id="x48-91002r65"></a> {place newvalue}*
</td></tr></table>
<!--l. 5295--><p class="indent" >
</div>
<!--l. 5295--><p class="noindent" ><span class="paragraphHead"><a 
href="#x48-920007.2" id="x48-920007.2"></a></span>
   <a 
href="#x48-91002r65">psetf</a> похожа на <a 
href="#x48-90002r64">setf</a> за исключением того, что если указано более одной
пары <i>place</i>-<i>newvalue</i> , то присваивание местам новых значений происходит
параллельно. Если говорить точнее, то все подформы, которые должны
быть вычислены, вычисляются слева направо. После выполнения всех
вычислений, выполняются все присваивания в неопределённом порядке.
(Неопределённый порядок влияет на поведение в случае, если более одной
формы <i>place</i> ссылаются на одно и то же место.) <a 
href="#x48-91002r65">psetf</a> всегда возвращает
<a 
href="clmse31.html#x42-74002r18">nil</a>.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> shiftf </b><a 
 id="dx48-92001"></a><a 
 id="x48-92002r66"></a> {place}+  newvalue
</td></tr></table>
<!--l. 5309--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 5309--><p class="noindent" ><span class="paragraphHead"><a 
href="#x48-930007.2" id="x48-930007.2"></a></span>
   Каждая форма <i>place</i> может быть любой обобщённой переменной, как для
<a 
href="#x48-90002r64">setf</a>. В форме (shiftf <i>place1</i> <i>place2</i> ... <i>placen</i> <i>newvalue</i>), вычисляются и
сохраняются значения с <i>place1</i> по <i>placen</i> и вычисляется <i>newvalue</i>, как
значение с номером <span class="math"><i>n</i> + 1</span>. Значения с 2-го по <span class="math"><i>n</i> + 1</span> сохраняются в интервале с
<i>place1</i> по <i>placen</i> и возвращается 1-ое значение (оригинальное значение
<i>place1</i>). Механизм работает как сдвиг регистров. <i>newvalue</i> сдвигается с
правой стороны, все значения сдвигаются влево на одну позицию, и
возвращается сдвигаемое самое левое значение <i>place1</i>. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x (list &#x2019;a &#x2019;b &#x2019;c)) <span class="math"> ⇒</span> (a b c)
</td></tr></table>
<!--l. 5321--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 5322--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(shiftf (cadr x) &#x2019;z) <span class="math"> ⇒</span> b</td></tr></table>
<!--l. 5323--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   and now x <span class="math"> ⇒</span> (a z c)</td></tr></table>
<!--l. 5324--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 5325--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(shiftf (cadr x) (cddr x) &#x2019;q) <span class="math"> ⇒</span> z</td></tr></table>
<!--l. 5326--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   and now x <span class="math"> ⇒</span> (a (c) . q)</td></tr></table>
<!--l. 5328--><p class="indent" >
</div>
</div>
<!--l. 5329--><p class="noindent" >Эффект от (shiftf <i>place1</i> <i>place2</i> ... <i>placen</i> <i>newvalue</i>) эквивалентен <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((<i>var1</i> <i>place1</i>)
</td></tr></table>
<!--l. 5332--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>var2</i> <i>place2</i>)</td></tr></table>
<!--l. 5333--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 5334--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>varn</i> <i>placen</i>))</td></tr></table>
<!--l. 5335--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setf <i>place1</i> <i>var2</i>)</td></tr></table>
<!--l. 5336--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setf <i>place2</i> <i>var3</i>)</td></tr></table>
<!--l. 5337--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 5338--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setf <i>placen</i> <i>newvalue</i>)</td></tr></table>
<!--l. 5339--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>var1</i>)</td></tr></table>
<!--l. 5341--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 5342--><p class="noindent" >за исключением того, что последний вариант выполняет все подформы для
каждого <i>place</i> дважды, тогда как <a 
href="#x48-92002r66">shiftf</a> выполняет только единожды.
Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq n 0)
</td></tr></table>
<!--l. 5346--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x &#x2019;(a b c d))</td></tr></table>
<!--l. 5347--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(shiftf (nth (setq n (+ n 1)) x) &#x2019;z) <span class="math"> ⇒</span> b</td></tr></table>
<!--l. 5348--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   теперь x <span class="math"> ⇒</span> (a z c d)</td></tr></table>
<!--l. 5349--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>but</i>
</td></tr></table>
<!--l. 5350--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq n 0)
</td></tr></table>
<!--l. 5351--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x &#x2019;(a b c d))</td></tr></table>
<!--l. 5352--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(prog1 (nth (setq n (+ n 1)) x)</td></tr></table>
<!--l. 5353--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (setf (nth (setq n (+ n 1)) x) &#x2019;z)) <span class="math"> ⇒</span> b</td></tr></table>
<!--l. 5354--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   и теперь x <span class="math"> ⇒</span> (a b z d)</td></tr></table>
<!--l. 5356--><p class="indent" >
</div>
</div>
<!--l. 5357--><p class="noindent" >Более того, для заданных форм <i>place</i> <a 
href="#x48-92002r66">shiftf</a> может быть более производительной,
чем версия с <a 
href="clmse38.html#x50-97002r72">prog1</a>.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> rotatef </b><a 
 id="dx48-93001"></a><a 
 id="x48-93002r67"></a> {place}*
</td></tr></table>
<!--l. 5363--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 5363--><p class="noindent" ><span class="paragraphHead"><a 
href="#x48-940007.2" id="x48-940007.2"></a></span>
   Каждая <i>place</i> может быть обобщённой переменной, как для <a 
href="#x48-90002r64">setf</a>. В
форме (rotatef <i>place1</i> <i>place2</i> ... <i>placen</i>), вычисляются и сохраняются
значения c <i>place1</i> по <i>placen</i>. Механизм действует как круговой сдвиг
регистров влево, и значение <i>place1</i> сдвигается в конец на <i>placen</i>. Следует
отметить, что (rotatef <i>place1</i> <i>place2</i>) меняет значения между <i>place1</i> и
<i>place2</i>.
<!--l. 5372--><p class="indent" >   Эффект от использования (rotatef <i>place1</i> <i>place2</i> ... <i>placen</i>) эквивалентен
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(psetf <i>place1</i> <i>place2</i>
</td></tr></table>
<!--l. 5375--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       <i>place2</i> <i>place3</i></td></tr></table>
<!--l. 5376--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       ...</td></tr></table>
<!--l. 5377--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       <i>placen</i> <i>place1</i>)</td></tr></table>
<!--l. 5379--><p class="indent" >
</div>
</div>
<!--l. 5380--><p class="noindent" >за исключением того, что в последнем вычисление форм происходит дважды,
тогда как <a 
href="#x48-93002r67">rotatef</a> выполняет только единожды. Более того, для заданных
форм <i>place</i> <a 
href="#x48-93002r67">rotatef</a> может быть более производительной, чем версия с
<a 
href="clmse38.html#x50-97002r72">prog1</a>.
<!--l. 5384--><p class="indent" >   <a 
href="#x48-93002r67">rotatef</a> всегда возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>.
</div>
<!--l. 5387--><p class="indent" >   Другие макрос, которые управляют обобщёнными переменными,
включают <a 
href="clmse51.html#x66-157008r130">getf</a>, <a 
href="clmse51.html#x66-157010r131">remf</a>, <a 
href="clmse64.html#x81-178014r187">incf</a>, <a 
href="clmse64.html#x81-178016r188">decf</a>, <a 
href="clmse81.html#x101-202054r451">push</a>, <a 
href="clmse81.html#x101-204002r453">pop</a>, <a 
href="clmse148.html#x182-447002r920">assert</a>, <a 
href="clmse148.html#x182-450002r922">ctypecase</a> и <a 
href="clmse148.html#x182-452002r924">ccase</a>.
<!--l. 5392--><p class="indent" >   Макросы, которые управляют обобщёнными переменными, должны
гарантировать «явную» семантику: подформы обобщённых переменных
вычисляются точно столько раз, сколько они встречаются в выражении, и в
том же порядке, в котором встречаются.
<!--l. 5397--><p class="indent" >   В ссылках на обобщённые переменные, как в <a 
href="#x48-92002r66">shiftf</a>, <a 
href="clmse64.html#x81-178014r187">incf</a>, <a 
href="clmse81.html#x101-202054r451">push</a> и <a 
href="#x48-90002r64">setf</a> или
<a 
href="clmse68.html#x85-186008r275">ldb</a>, обобщённые переменные считываются и записываются в одну и ту же
ссылку. Сохранение порядка выполнения исходной программы и количества
выполнений чрезвычайно важно.
<b>
<!--l. 5402--><p class="indent" >   Остаток раздела далее не переведён</b>
                                                                          

                                                                          
   <!--l. 5404--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse37.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse35.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse35.html#tailclmse35.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse36.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse36.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 5404--><p class="indent" >   <a 
 id="tailclmse36.html"></a>  
</body></html> 
