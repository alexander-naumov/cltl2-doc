<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Random Numbers Случаные числа</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-04 00:46:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 4626--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse69.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse67.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse67.html#tailclmse67.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse68.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch12.html#clmse68.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">12.9   </span> <a 
href="clm.html#QQ2-85-213" id="x85-18600012.9">Random Numbers Случаные числа</a></h3>
<!--l. 4629--><p class="noindent" >The Common Lisp facility for generating pseudo-random numbers has been
carefully deﬁned to make its use reasonably portable. While two implementations
may produce diﬀerent series of pseudo-random numbers, the distribution of values
should be relatively independent of such machine-dependent aspects as word
size.
<!--l. 4636--><p class="indent" >   Функциональность Common Lisp&#x2019;а для генерации псевдослучайных чисел
была аккуратно проработана, чтобы быть портируемой. Тогда как две
реализации могут создавать различные ряды псевдослучайных чисел,
распределение значений должно быть независимо от таких характеристик
компьютера как размер слова.
<div class=defun>
<!--l. 4641--><p class="noindent" ><i>[Function]</i><a 
 id="dx85-186001"></a><a 
 id="x85-186002r280"></a><b> random</b>  <i>number</i> &#x0026;optional  <i>state</i>
<!--l. 4643--><p class="noindent" ><tt>(random <i>n</i>)</tt> accepts a positive number <i>n</i> and returns a number of the same kind
between zero (inclusive) and <i>n</i> (exclusive). The number <i>n</i> may be an integer or a
ﬂoating-point number. An approximately uniform choice distribution is used. If
<i>n</i> is an integer, each of the possible results occurs with (approximate)
probability 1/<i>n</i>. (The qualiﬁer “approximate” is used because of implementation
considerations; in practice, the deviation from uniformity should be quite
small.)
<!--l. 4654--><p class="indent" >   The argument <i>state</i> must be an object of type <tt>random-state</tt>; it defaults to
the value of the variable <tt><a 
href="#x85-186004r281">*random-state*</a></tt>. This object is used to maintain the
state of the pseudo-random-number generator and is altered as a side eﬀect of the
<tt><a 
href="#x85-186002r280">random</a></tt> operation.
<tt>
<!--l. 4659--><p class="indent" >   (random <i>n</i>)</tt> принимает положительное число <i>n</i> и возвращает число такого
же типа между нулем (включительно) и <i>n</i> (невключительно). Число <i>n</i>
может быть целым или с плавающей точкой. При этом используется
приблизительно равномерное распределения. FIXME Если <i>n</i> целое
число, каждый из возможных результатов встречается с (примерной)
вероятностью 1/<i>n</i>. (Слово «примерно» используется из-за различий
                                                                          

                                                                          
реализаций. На практике отклонение от однородности должно быть весьма
мало.)
<!--l. 4668--><p class="indent" >   Аргумент <i>state</i> должен быть объектом типа <tt>random-state</tt>. По-умолчанию
он равен значению переменной <tt><a 
href="#x85-186004r281">*random-state*</a></tt>. Объект используется для
сохранения состояния псевдослучаночислового генератора и изменяется как
побочное действие от операции <tt><a 
href="#x85-186002r280">random</a></tt>.
<div class=implementation>
<!--l. 4674--><p class="noindent" ><b>Заметка для реализации:</b> In general, even if <tt><a 
href="#x85-186002r280">random</a></tt> of zero arguments were deﬁned
as in MacLisp, it is not adequate to deﬁne <tt>(random <i>n</i>)</tt> for integral <i>n</i> to be simply <tt>(mod
(random) <i>n</i>)</tt>; this fails to be uniformly distributed if <i>n</i> is larger than the largest number
produced by <tt><a 
href="#x85-186002r280">random</a></tt>, or even if <i>n</i> merely approaches this number. This is another reason
for omitting <tt><a 
href="#x85-186002r280">random</a></tt> of zero arguments in Common Lisp. Assuming that the underlying
mechanism produces “random bits” (possibly in chunks such as ﬁxnums), the best
approach is to produce enough random bits to construct an integer <i>k</i> some number
<i>d</i> of bits larger than <tt>(integer-length <i>n</i>)</tt> (see <tt><a 
href="clmse66.html#x83-184066r271">integer-length</a></tt>), and then
compute <tt>(mod <i>k</i> <i>n</i>)</tt>. The quantity <i>d</i> should be at least 7, and preferably 10 or
more.
<!--l. 4689--><p class="indent" >   To produce random ﬂoating-point numbers in the half-open range <span class="math">[<i>A</i>,<i>B</i>)</span>, accepted
practice (as determined by a look through the <i>Collected Algorithms from the ACM</i>,
particularly algorithms 133, 266, 294, and 370) is to compute <span class="math"><i>X</i> ⋅ (<i>B</i> −<i>A</i>) + <i>A</i></span>,
where <i>X</i> is a ﬂoating-point number uniformly distributed over <span class="math">[0.0,1.0)</span> and
computed by calculating a random integer <span class="math"><i>N</i></span> in the range <span class="math">[0,<i>M</i>)</span> (typically by a
multiplicative-congruential or linear-congruential method mod <span class="math"><i>M</i></span>) and then setting
<span class="math"><i>X</i> = <i>N</i>∕<i>M</i></span>. See also <span class="cite">[<a 
href="clmli5.html#XKNUTH-VOLUME-2">27</a>]</span>. If one takes <span class="math"><i>M</i> = 2<sup>f</sup></span>, where <span class="math"><i>f</i></span> is the length of the signiﬁcand of a
ﬂoating-point number (and it is in fact common to choose <span class="math"><i>M</i></span> to be a power of
2), then this method is equivalent to the following assembly-language-level
procedure. Assume the representation has no hidden bit. Take a ﬂoating-point 0.5,
and clobber its entire signiﬁcand with random bits. Normalize the result if
necessary.
<!--l. 4708--><p class="indent" >   For example, on the DEC PDP-10, assume that accumulator <tt>T</tt> is completely random
(all 36 bits are random). Then the code sequence <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">LSH T,-9                 ;Clear high 9 bits; low 27 are random
</td></tr></table>
<!--l. 4711--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">FSC T,128.               ;Install exponent and normalize</td></tr></table>
<!--l. 4713--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 4714--><p class="noindent" >will produce in <tt>T</tt> a random ﬂoating-point number uniformly distributed over <span class="math">[0.0,1.0)</span>.
(Instead of the <tt>LSH</tt> instruction, one could do <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">TLZ T,777000             ;That&#x2019;s 777000 octal
</td></tr></table>
<!--l. 4719--><p class="indent" >
</div>
</div>
<!--l. 4720--><p class="noindent" >but if the 36 random bits came from a congruential random-number generator, the
high-order bits tend to be “more random” than the low-order ones, and so the <tt>LSH</tt> would
be better for uniform distribution. Ideally all the bits would be the result of high-quality
randomness.)
<!--l. 4725--><p class="indent" >   With a hidden-bit representation, normalization is not a problem, but dealing with
the hidden bit is. The method can be adapted as follows. Take a ﬂoating-point 1.0 and
clobber the explicit signiﬁcand bits with random bits; this produces a random
ﬂoating-point number in the range <span class="math">[1.0,2.0)</span>. Then simply subtract 1.0. In eﬀect, we let
the hidden bit creep in and then subtract it away again.
<!--l. 4732--><p class="indent" >   For example, on the DEC VAX, assume that register <tt>T</tt> is completely random (but a
little less random than on the PDP-10, as it has only 32 random bits). Then the code
sequence <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">INSV #̂X81,#7,#9,T     ;Install correct sign bit and exponent
</td></tr></table>
<!--l. 4736--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">SUBF #̂F1.0,T          ;Subtract 1.0</td></tr></table>
<!--l. 4738--><p class="indent" >
</div>
</div>
<!--l. 4739--><p class="noindent" >will produce in <tt>T</tt> a random ﬂoating-point number uniformly distributed over <span class="math">[0.0,1.0)</span>.
Again, if the low-order bits are not random enough, then the instruction <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">ROTL #7,T
</td></tr></table>
<!--l. 4744--><p class="indent" >
</div>
</div>
<!--l. 4745--><p class="noindent" >should be performed ﬁrst.
                                                                          

                                                                          
<!--l. 4747--><p class="indent" >   Implementors may wish to consult reference <span class="cite">[<a 
href="clmli5.html#XADDITIVE-RANDOMS">41</a>]</span> for a discussion of some eﬃcient
methods of generating pseudo-random numbers.
</div>
</div>
<div class=defun>
<!--l. 4753--><p class="noindent" ><i>[Variable]</i><a 
 id="dx85-186003"></a><a 
 id="x85-186004r281"></a><b> *random-state*</b>
<!--l. 4755--><p class="noindent" >This variable holds a data structure, an object of type <tt>random-state</tt>, that
encodes the internal state of the random-number generator that <tt><a 
href="#x85-186002r280">random</a></tt> uses by
default. The nature of this data structure is implementation-dependent. It may be
printed out and successfully read back in, but may or may not function correctly
as a random-number state object in another implementation. A call to <tt><a 
href="#x85-186002r280">random</a></tt> will
perform a side eﬀect on this data structure. Lambda-binding this variable to a
diﬀerent random-number state object will correctly save and restore the old state
object.
<!--l. 4767--><p class="indent" >   Данная переменная содержит объект типа <tt>random-state</tt>, который хранит
состояние для генератора случайных чисел, которое используется по
умолчанию функцией <tt><a 
href="#x85-186002r280">random</a></tt>. Природа этой структуры данных зависит от
реализации. Она может быть выведена на печать и считана обработно, но не
обязательно это может быть сделано между реализациями. Вызов <tt><a 
href="#x85-186002r280">random</a></tt>
изменяет этот объект. Связывание этой переменной с другим значением будет
корректно сохраняться и восстанавиливаться.
</div>
<div class=defun>
<!--l. 4778--><p class="noindent" ><i>[Function]</i><a 
 id="dx85-186005"></a><a 
 id="x85-186006r282"></a><b> make-random-state</b>  &#x0026;optional  <i>state</i>
<!--l. 4780--><p class="noindent" >This function returns a new object of type <tt>random-state</tt>, suitable for use as
the value of the variable <tt><a 
href="#x85-186004r281">*random-state*</a></tt>. If <i>state</i> is <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> or omitted,
<tt><a 
href="#x85-186006r282">make-random-state</a></tt> returns a <i>copy</i> of the current random-number state object
(the value of the variable <tt><a 
href="#x85-186004r281">*random-state*</a></tt>). If <i>state</i> is a state object, a copy of
that state object is returned. If <i>state</i> is <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>, then a new state object is returned that
has been “randomly” initialized by some means (such as by a time-of-day
clock).
<!--l. 4790--><p class="indent" >   Данная функция возвращает новый объект типа <tt>random-state</tt>, подходящий
для использования в качестве значения переменной <tt><a 
href="#x85-186004r281">*random-state*</a></tt>. Если
<i>state</i> не указано или равно <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда <tt><a 
href="#x85-186006r282">make-random-state</a></tt> возвращает <i>копию</i>
текущего объекта состояния случаночислового генератора (значение
переменной <tt><a 
href="#x85-186004r281">*random-state*</a></tt>). Если <i>state</i> является объектом состояния, то
возвращается копия данного объекта. Если <i>state</i> равен <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>, тогда новый
возвращается новый объект состояния, который в некотором смысле
                                                                          

                                                                          
«случайно» инициализирован (текущим временем например).
<div class=rationale>
<!--l. 4801--><p class="noindent" ><b>Обоснование:</b> Common Lisp purposely provides no way to initialize a <tt>random-state</tt>
object from a user-speciﬁed “seed.” The reason for this is that the number of bits of state
information in a <tt>random-state</tt> object may vary widely from one implementation to
another, and there is no simple way to guarantee that any user-speciﬁed seed
value will be “random enough.” Instead, the initialization of <tt>random-state</tt>
objects is left to the implementor in the case where the argument <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> is given to
<tt><a 
href="#x85-186006r282">make-random-state</a></tt>.
<!--l. 4811--><p class="indent" >   To handle the common situation of executing the same program many times in a
reproducible manner, where that program uses <tt><a 
href="#x85-186002r280">random</a></tt>, the following procedure may be
used:
      <ol  class="enumerate1" >
      <li 
  class="enumerate" id="x85-186008x1">Evaluate <tt>(make-random-state t)</tt> to create a <tt>random-state</tt> object.
      </li>
      <li 
  class="enumerate" id="x85-186010x2">Write that object to a ﬁle, using <tt><a 
href="clmse110.html#x137-258008r650">print</a></tt>, for later use.
      </li>
      <li 
  class="enumerate" id="x85-186012x3">Whenever the program is to be run, ﬁrst use <tt><a 
href="clmse109.html#x136-255003r634">read</a></tt> to create a copy of the
      <tt>random-state</tt> object from the printed representation in the ﬁle. Then use
      the <tt>random-state</tt> object newly created by the <tt><a 
href="clmse109.html#x136-255003r634">read</a></tt> operation to initialize
      the random-number generator for the program.</li></ol>
<!--l. 4828--><p class="noindent" >It is for the sake of this procedure for reproducible execution that implementations are
required to provide a read/print syntax for objects of type <tt>random-state</tt>.
<!--l. 4832--><p class="indent" >   It is also possible to make copies of a <tt>random-state</tt> object directly without going
through the print/read process, simply by using the <tt><a 
href="#x85-186006r282">make-random-state</a></tt> function to
copy the object; this allows the same sequence of random numbers to be generated many
times within a single program.
</div>
<div class=implementation>
<!--l. 4839--><p class="noindent" ><b>Заметка для реализации:</b> A recommended way to implement the type
<tt>random-state</tt> is eﬀectively to use the machinery for <tt><a 
href="clmse97.html#x121-225002r561">defstruct</a></tt>. The usual structure
syntax may then be used for printing <tt>random-state</tt> objects; one might look something
like <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#S(RANDOM-STATE DATA #(14 49 98436589 786345 8734658324 ...))
</td></tr></table>
<!--l. 4846--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 4847--><p class="noindent" >where the components are of course completely implementation-dependent.
</div>
</div>
<div class=defun>
<!--l. 4852--><p class="noindent" ><i>[Function]</i><a 
 id="dx85-186013"></a><a 
 id="x85-186014r283"></a><b> random-state-p</b>  <i>object</i>
<!--l. 4854--><p class="noindent" ><tt><a 
href="#x85-186014r283">random-state-p</a></tt> is true if its argument is a random-state object, and otherwise is
false. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(random-state-p <i>x</i>) <span class="math"> ≡</span> (typep <i>x</i> &#x2019;random-state)
</td></tr></table>
<!--l. 4859--><p class="indent" >
</div>
</div>
<tt>
<!--l. 4861--><p class="indent" >   <a 
href="#x85-186014r283">random-state-p</a></tt> истинен, если аргумент является объектом состояния
генератора случайных чисел, иначе — ложен. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(random-state-p <i>x</i>) <span class="math"> ≡</span> (typep <i>x</i> &#x2019;random-state)
</td></tr></table>
<!--l. 4865--><p class="indent" >
</div>
</div>
</div>
                                                                          

                                                                          
   <!--l. 4868--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse69.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse67.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse67.html#tailclmse67.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse68.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch12.html#clmse68.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 4868--><p class="indent" >   <a 
 id="tailclmse68.html"></a>  
</body></html> 
