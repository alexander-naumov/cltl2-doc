<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Parsing Loop Clauses</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-18 01:47:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 101--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse130.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse128.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse128.html#tailclmse128.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse129.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch26.html#clmse129.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">26.3   </span> <a 
 id="x160-31300026.3"></a>Parsing Loop Clauses</h3>
<!--l. 103--><p class="noindent" >The syntactic parts of a loop construct are called <i>clauses</i>; the scope of each clause
is determined by the top-level parsing of that clause&#x2019;s keyword. The following
example shows a loop construct with six clauses:
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(loop for i from 1 to (compute-top-value)         ;First clause
</td></tr></table>
<!--l. 109--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      while (not (unacceptable i))                ;Second clause</td></tr></table>
<!--l. 110--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      collect (square i)                          ;Third clause</td></tr></table>
<!--l. 111--><p class="indent" >      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      do (format t &#x0022;Working on ~D now&#x0022; i)         ;Fourth clause</td></tr></table>
<!--l. 112--><p class="indent" >     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      when (evenp i)                              ;Fifth clause</td></tr></table>
<!--l. 113--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        do (format t &#x0022;~D is a non-odd number&#x0022; i)</td></tr></table>
<!--l. 114--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ﬁnally (format t &#x0022;About to exit!&#x0022;))        ;Sixth clause</td></tr></table>
<!--l. 116--><p class="indent" >
</div>
</div>
<!--l. 119--><p class="indent" >   Each loop keyword introduces either a compound loop clause or a simple
loop clause that can consist of a loop keyword followed by a single Lisp
form. The number of forms in a clause is determined by the loop keyword
that begins the clause and by the auxiliary keywords in the clause. The
keywords <a 
href="clmse137.html#x168-342002r838">do</a>, <a 
href="clmse138.html#x169-347002r841">initially</a>, and <a 
href="clmse138.html#x169-347006r843">ﬁnally</a> are the only loop keywords that can
take any number of Lisp forms and group them as if in a single <a 
href="clmse38.html#x50-96002r71">progn</a>
form.
<!--l. 128--><p class="indent" >   Loop clauses can contain auxiliary keywords, which are sometimes called
<i>prepositions</i>. For example, the ﬁrst clause in the preceding code includes the
prepositions from and to, which mark the value from which stepping begins and
the value at which stepping ends.
                                                                          

                                                                          
<!--l. 134--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">26.3.1   </span> <a 
 id="x160-31400026.3.1"></a>Order of Execution</h4>
<!--l. 136--><p class="noindent" >With the exceptions listed below, clauses are executed in the loop body in the
order in which they appear in the source. Execution is repeated until a clause
terminates the loop or until a Common Lisp <a 
href="clmse137.html#x168-343002r840">return</a>, <a 
href="clmse42.html#x54-128002r104">go</a>, or <a 
href="clmse44.html#x56-141002r116">throw</a> form is
encountered. The following actions are exceptions to the linear order of
execution:
      <ul class="itemize1">
      <li class="itemize">All variables are initialized ﬁrst, regardless of where the establishing
      clauses appear in the source. The order of initialization follows the order
      of these clauses.
      </li>
      <li class="itemize">The code for any <a 
href="clmse138.html#x169-347002r841">initially</a> clauses is collected into one <a 
href="clmse38.html#x50-96002r71">progn</a> in the order
      in which the clauses appear in the source. The collected code is executed
      once in the loop prologue after any implicit variable initializations.
      </li>
      <li class="itemize">The  code  for  any  <a 
href="clmse138.html#x169-347006r843">ﬁnally</a>  clauses  is  collected  into  one  <a 
href="clmse38.html#x50-96002r71">progn</a>  in  the
      order in which the clauses appear in the source. The collected code is
      executed once in the loop epilogue before any implicit values from the
      accumulation clauses are returned. Explicit returns anywhere in the
      source, however, will exit the loop without executing the epilogue code.
      </li>
      <li class="itemize">A <a 
href="clmse135.html#x166-338002r834">with</a> clause introduces a variable binding and an optional initial
      value. The initial values are calculated in the order in which the <a 
href="clmse135.html#x166-338002r834">with</a>
      clauses occur.
      </li>
      <li class="itemize">Iteration control clauses implicitly perform the following actions:
           <ul class="itemize2">
           <li class="itemize">initializing variables
                                                                          

                                                                          
           </li>
           <li class="itemize">stepping variables, generally between each execution of the loop
           body
           </li>
           <li class="itemize">performing termination tests, generally just before the execution
           of the loop body</li></ul>
      </li></ul>
<!--l. 184--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">26.3.2   </span> <a 
 id="x160-31500026.3.2"></a>Kinds of Loop Clauses</h4>
<!--l. 187--><p class="noindent" >Loop clauses fall into one of the following categories:
      <ul class="itemize1">
      <li class="itemize">variable initialization and stepping
           <ul class="itemize2">
           <li class="itemize">The <a 
href="clmse132.html#x163-325002r811">for</a> and <a 
href="clmse132.html#x163-325004r812">as</a> constructs provide iteration control clauses that
           establish a variable to be initialized. You can combine <a 
href="clmse132.html#x163-325002r811">for</a> and <a 
href="clmse132.html#x163-325004r812">as</a>
           clauses with the loop keyword <a 
href="clmse34.html#x45-79004r49">and</a> to get parallel initialization and
           stepping.
           </li>
           <li class="itemize">The  <a 
href="clmse135.html#x166-338002r834">with</a>  construct  is  similar  to  a  single  <a 
href="clmse39.html#x51-100002r74">let</a>  clause.  You  can
           combine <a 
href="clmse135.html#x166-338002r834">with</a> clauses using <a 
href="clmse34.html#x45-79004r49">and</a> to get parallel initialization.
           </li>
           <li class="itemize">The <a 
href="clmse132.html#x163-326002r813">repeat</a> construct causes iteration to terminate after a speciﬁed
           number of times. It uses an internal variable to keep track of the
           number of iterations.</li></ul>
      <!--l. 212--><p class="noindent" >You can specify data types for loop variables (see section <a 
href="clmse138.html#x169-34600026.12.1">26.12.1<!--tex4ht:ref: LOOP-TYPES-SECTION --></a>). It is an
      error to bind the same variable twice in any variable-binding clause of a
      single loop expression. Such variables include local variables, iteration
      control variables, and variables found by destructuring.
                                                                          

                                                                          
      </li>
      <li class="itemize">value accumulation
           <ul class="itemize2">
           <li class="itemize">The <a 
href="clmse153.html#x188-482022r1060">collect</a> construct takes one form in its clause and adds the
           value of that form to the end of a list of values. By default, the
           list of values is returned when the loop ﬁnishes.
           </li>
           <li class="itemize">The <a 
href="clmse134.html#x165-333002r822">append</a> construct takes one form in its clause and appends
           the value of that form to the end of a list of values. By default,
           the list of values is returned when the loop ﬁnishes.
           </li>
           <li class="itemize">The  <a 
href="clmse134.html#x165-333006r824">nconc</a>  construct  is  similar  to  <a 
href="clmse134.html#x165-333002r822">append</a>,  but  its  list  values
           are concatenated as if by the Common Lisp function <a 
href="clmse134.html#x165-333006r824">nconc</a>. By
           default, the list of values is returned when the loop ﬁnishes.
           </li>
           <li class="itemize">The <a 
href="clmse134.html#x165-335002r828">sum</a> construct takes one form in its clause that must evaluate
           to  a  number  and  adds  that  number  into  a  running  total.  By
           default, the cumulative sum is returned when the loop ﬁnishes.
           </li>
           <li class="itemize">The <a 
href="clmse134.html#x165-334002r826">count</a> construct takes one form in its clause and counts the
           number of times that the form evaluates to a non-<a 
href="clmse31.html#x42-74002r18">nil</a> value. By
           default, the count is returned when the loop ﬁnishes.
           </li>
           <li class="itemize">The  <a 
href="clmse134.html#x165-336006r832">minimize</a>  construct  takes  one  form  in  its  clause  and
           determines the minimum value obtained by evaluating that form.
           By default, the minimum value is returned when the loop ﬁnishes.
           </li>
           <li class="itemize">The  <a 
href="clmse134.html#x165-336002r830">maximize</a>  construct  takes  one  form  in  its  clause  and
           determines the maximum value obtained by evaluating that form.
           By default, the maximum value is returned when the loop ﬁnishes.</li></ul>
      </li>
      <li class="itemize">termination conditions
                                                                          

                                                                          
           <ul class="itemize2">
           <li class="itemize">The <a 
href="clmse133.html#x164-330002r819">loop-ﬁnish</a> Lisp macro terminates iteration and returns any
           accumulated result. If speciﬁed, any <a 
href="clmse138.html#x169-347006r843">ﬁnally</a> clauses are evaluated.
           </li>
           <li class="itemize">The  <a 
href="clmse132.html#x163-325002r811">for</a>  and  <a 
href="clmse132.html#x163-325004r812">as</a>  constructs  provide  a  termination  test  that  is
           determined by the iteration control clause.
           </li>
           <li class="itemize">The <a 
href="clmse132.html#x163-326002r813">repeat</a> construct causes termination after a speciﬁed number
           of iterations.
           </li>
           <li class="itemize">The <a 
href="clmse133.html#x164-328002r814">while</a> construct takes one form, a condition, and terminates
           the iteration if the condition evaluates to <a 
href="clmse31.html#x42-74002r18">nil</a>. A <a 
href="clmse133.html#x164-328002r814">while</a> clause is
           equivalent to the expression (if (not <i>condition</i>) (loop-ﬁnish)).
           </li>
           <li class="itemize">The  <a 
href="clmse153.html#x188-480004r1034">until</a>  construct  is  the  inverse  of  <a 
href="clmse133.html#x164-328002r814">while</a>;  it  terminates  the
           iteration if the condition evaluates to any non-<a 
href="clmse31.html#x42-74002r18">nil</a> value. An <a 
href="clmse153.html#x188-480004r1034">until</a>
           clause is equivalent to the expression (if <i>condition</i> (loop-ﬁnish)).
           </li>
           <li class="itemize">The <a 
href="clmse133.html#x164-329002r816">always</a> construct takes one form and terminates the loop if the
           form ever evaluates to <a 
href="clmse31.html#x42-74002r18">nil</a>; in this case, it returns <a 
href="clmse31.html#x42-74002r18">nil</a>. Otherwise,
           it provides a default return value of <a 
href="clmse31.html#x42-74004r19">t</a>.
           </li>
           <li class="itemize">The <a 
href="clmse133.html#x164-329004r817">never</a> construct takes one form and terminates the loop if
           the form ever evaluates to non-<a 
href="clmse31.html#x42-74002r18">nil</a>; in this case, it returns <a 
href="clmse31.html#x42-74002r18">nil</a>.
           Otherwise, it provides a default return value of <a 
href="clmse31.html#x42-74004r19">t</a>.
           </li>
           <li class="itemize">The <a 
href="clmse133.html#x164-329006r818">thereis</a> construct takes one form and terminates the loop if
           the form ever evaluates to non-<a 
href="clmse31.html#x42-74002r18">nil</a>; in this case, it returns that
           value.</li></ul>
      </li>
      <li class="itemize">unconditional execution
           <ul class="itemize2">
           <li class="itemize">The <a 
href="clmse137.html#x168-342002r838">do</a> construct simply evaluates all forms in its clause.
                                                                          

                                                                          
           </li>
           <li class="itemize">The <a 
href="clmse137.html#x168-343002r840">return</a> construct takes one form and returns its value. It is
           equivalent to the clause do (return <i>value</i>).</li></ul>
      </li>
      <li class="itemize">conditional execution
           <ul class="itemize2">
           <li class="itemize">The <a 
href="clmse136.html#x167-340002r835">if</a> construct takes one form as a predicate and a clause that
           is executed when the predicate is true. The clause can be a value
           accumulation, unconditional, or another conditional clause; it can
           also be any combination of such clauses connected by the loop
           keyword <a 
href="clmse34.html#x45-79004r49">and</a>.
           </li>
           <li class="itemize">The <a 
href="clmse136.html#x167-340004r836">when</a> construct is a synonym for <a 
href="clmse136.html#x167-340002r835">if</a>.
           </li>
           <li class="itemize">The <a 
href="clmse136.html#x167-340006r837">unless</a> construct is similar to <a 
href="clmse136.html#x167-340004r836">when</a> except that it complements
           the predicate; it executes the following clause if the predicate is
           false.
           </li>
           <li class="itemize">The else construct provides an optional component of <a 
href="clmse136.html#x167-340002r835">if</a>, <a 
href="clmse136.html#x167-340004r836">when</a>,
           and <a 
href="clmse136.html#x167-340006r837">unless</a> clauses that is executed when the predicate is false.
           The component is one of the clauses described under <a 
href="clmse136.html#x167-340002r835">if</a>.
           </li>
           <li class="itemize">The end construct provides an optional component to mark the
           end of a conditional clause.</li></ul>
      </li>
      <li class="itemize">miscellaneous operations
           <ul class="itemize2">
           <li class="itemize">The <a 
href="clmse138.html#x169-348002r844">named</a> construct assigns a name to a loop construct.
           </li>
           <li class="itemize">The <a 
href="clmse138.html#x169-347002r841">initially</a> construct causes its forms to be evaluated in the loop
           prologue, which precedes all loop code except for initial settings
           speciﬁed by the constructs <a 
href="clmse135.html#x166-338002r834">with</a>, <a 
href="clmse132.html#x163-325002r811">for</a>, or <a 
href="clmse132.html#x163-325004r812">as</a>.
                                                                          

                                                                          
           </li>
           <li class="itemize">The  <a 
href="clmse138.html#x169-347006r843">ﬁnally</a>  construct  causes  its  forms  to  be  evaluated  in  the
           loop epilogue after normal iteration terminates. An unconditional
           clause can also follow the loop keyword <a 
href="clmse138.html#x169-347006r843">ﬁnally</a>.</li></ul>
      </li></ul>
<!--l. 356--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">26.3.3   </span> <a 
 id="x160-31600026.3.3"></a>Loop Syntax</h4>
<!--l. 358--><p class="noindent" >The following syntax description provides an overview of the syntax for
loop clauses. Detailed syntax descriptions of individual clauses appear in
sections <a 
href="clmse132.html#x163-31900026.6">26.6<!--tex4ht:ref: LOOP-ITERATION-SECTION --></a> through <a 
href="clmse138.html#x169-34500026.12">26.12<!--tex4ht:ref: LOOP-MISC-SECTION --></a>. A loop consists of the following types of
clauses:
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>initial-ﬁnal</i> ::= <i>initially</i> | <i>ﬁnally</i>
</td></tr></table>
<!--l. 365--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>variables</i> ::= <i>with</i> | <i>initial-ﬁnal</i> | <i>for-as</i> | <i>repeat</i></td></tr></table>
<!--l. 366--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>main</i> ::= <i>unconditional</i> | <i>accumulation</i> | <i>conditional</i> | <i>termination</i> | <i>initial-ﬁnal</i></td></tr></table>
<!--l. 368--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>loop</i> ::= (loop  [<i>named <i>name</i></i>]  {<i><i></i></i>}* variables  {<i><i></i></i>}* main)</td></tr></table>
<!--l. 370--><p class="indent" >
</div>
<!--l. 372--><p class="indent" >   Note that a loop must have at least one clause; however, for backward
compatibility, the following format is also supported: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(loop  {<i><i>tag</i> | <i>expr</i></i>}* )
</td></tr></table>
<!--l. 376--><p class="indent" >
</div>
</div>
<!--l. 377--><p class="noindent" >where <i>expr</i> is any Common Lisp expression that can be evaluated, and <i>tag</i> is any
symbol not identiﬁable as a loop keyword. Such a format is roughly equivalent to
the following one:
                                                                          

                                                                          
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(loop do  {<i><i>tag</i> | <i>expr</i></i>}* )
</td></tr></table>
<!--l. 383--><p class="indent" >
</div>
</div>
<!--l. 385--><p class="indent" >   A loop prologue consists of any automatic variable initializations prescribed by
the <i>variable</i> clauses, along with any <i>initially</i> clauses in the order they appear in
the source.
<!--l. 389--><p class="indent" >   A loop epilogue consists of <i>ﬁnally</i> clauses, if any, along with any implicit
return value from an <i>accumulation</i> clause or an <i>end-test</i> clause.
                                                                          

                                                                          
   <!--l. 394--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse130.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse128.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse128.html#tailclmse128.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse129.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch26.html#clmse129.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 394--><p class="indent" >   <a 
 id="tailclmse129.html"></a>  
</body></html> 
