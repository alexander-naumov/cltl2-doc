<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Конфликты имён</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 00:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 2375--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse61.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse59.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse59.html#tailclmse59.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse60.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch11.html#clmse60.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">11.5   </span> <a 
href="clm.html#QQ2-76-908" id="x76-90000011.5">Конфликты
имён</a></h3>
<!--l. 2378--><p class="noindent" >Основное неизменяемое правило системы пакетов состоит в том, что внутри
одного пакета каждое имя может ссылаться не более, чем на один символ.
<i>Конфликтом имён</i> называется ситуация, когда существует более одного
подходящего символа и не ясно какой из них должен быть выбран. Если
система не будет следовать одному методу выбора, то правило чтения-чтения
будет нарушено. Например, некоторая программа или данные должны быть
прочитаны при некоторой связи имени с символом. Если связь изменяется в
другой символ, и затем прочитывается дополнительная программа или
символ, то две программы не будут получать доступ к одному и тому же
символу, даже если используют одинаковое имя. Даже если система всегда
выбирает один метод выбора символа, конфликт имён приводит к связи
имени с символом отличной от той, что ожидает пользователь, приводя к
некорректному выполнению программы. Таким образом, в любом случае
возникновения конфликта имён сигнализируется ошибка. Пользователь
может указать системе пакетов, как разрешить конфликт, и продолжить
выполнение.
<!--l. 2394--><p class="indent" >   Может быть ситуация, когда один символ может быть доступен для
пакета более чем одним способом. Например, символ может быть
внешним символов более чем одного используемого пакета, или символ
может быть напрямую представлен в пакете и также унаследован из
другого пакета. В таких случаях конфликта имён не возникает. Один и
тот же символ не может конфликтовать сам с собой. Конфликты
имён возникают только между разными символами с одинаковыми
именами.
<!--l. 2402--><p class="indent" >   Создатель пакета может заранее указать системе, как разрешать
конфликт имён, используя <i>затенения</i>. Каждый пакет имеет список
затеняющих символов. Затеняющий символ имеет преимущество перед
любым другим символом с тем же именем. Разрешение конфликта с
участием затеняющего символа всегда происходит в пользу последнего без
сигнализирования об ошибке (за исключение одного использования
<tt><a 
href="clmse62.html#x78-921002r175">import</a></tt> описанного ниже). Функции <tt><a 
href="clmse62.html#x78-923002r177">shadow</a></tt> и <tt><a 
href="clmse62.html#x78-922002r176">shadowing-import</a></tt> могут
                                                                          

                                                                          
использоваться для декларации затеняющих символов.
<!--l. 2411--><p class="indent" >   Конфликты имён обнаруживаются, когда они становятся возможными, то
есть, когда изменяется структура пакета. Нет смысла проверять конфликты
в каждом процессе поиска имени для символа.
<!--l. 2415--><p class="indent" >   Функции <tt><a 
href="clmse62.html#x78-924002r178">use-package</a></tt>, <tt><a 
href="clmse62.html#x78-921002r175">import</a></tt> и <tt><a 
href="clmse62.html#x78-919002r173">export</a></tt> проверяют возникновение
конфликтов имён. <tt><a 
href="clmse62.html#x78-924002r178">use-package</a></tt> делает внешние символы пакета доступными
для использования в другом пакете. Каждый из этих символов проверяется
на конфликт имён с уже доступным в пакете символом. <tt><a 
href="clmse62.html#x78-921002r175">import</a></tt> добавляет
один символ как внутренний символ пакета, проверяя на конфликты имён с
<i>родственными</i> или <i>доступными символами</i>. <tt><a 
href="clmse62.html#x78-921002r175">import</a></tt> сигнализирует об
ошибке конфликта имён, даже если конфликт произошёл с затеняющим
символом. Это объясняется том, что пользователь дал два явных и
взаимоисключающих указания. <tt><a 
href="clmse62.html#x78-919002r173">export</a></tt> делает один символ доступным для
всех пакетов, которые используют пакет, из которого символ был
экспортирован. Все эти пакеты проверяются на конфликты имён: <tt>(export <i>s</i>
<i>p</i>)</tt> делает <tt>(find-symbol (symbol-name <i>s</i> <i>q</i>)</tt> для каждого пакета <i>q</i> в
<tt>(package-used-by-list <i>p</i>)</tt>. Следует отметить, что в обычно при выполнении
<tt><a 
href="clmse62.html#x78-919002r173">export</a></tt> в течение первоначального определения пакета, результат
<tt><a 
href="clmse62.html#x78-912002r166">package-used-by-list</a></tt> будет <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt> и проверка конфликта имён не будет
занимать много времени.
<!--l. 2433--><p class="indent" >   Функция <tt><a 
href="clmse62.html#x78-916002r170">intern</a></tt>, которая является одной из часто используемых
Lisp&#x2019;овыми считывателем для поиска имен символов, не нуждается в
проверке конфликта имён, потому что она никогда не создаёт новые
символы, если символ с указанным именем уже <i>доступен</i>.
<tt>
<!--l. 2438--><p class="indent" >   <a 
href="clmse62.html#x78-923002r177">shadow</a></tt> и <tt><a 
href="clmse62.html#x78-922002r176">shadowing-import</a></tt> никогда не сигнализируют ошибку конфликта
имён, потому что пользователь, вызывая их, указывает, как возможный
конфликт будет разрешён. <tt><a 
href="clmse62.html#x78-923002r177">shadow</a></tt> проверяет конфликт имён при условии,
что другой существующий символ с указанным именем доступен и, если так,
является ли <i>родственным</i> или унаследованным. В последнем случае, новый
символ создаётся, чтобы затенить старый. <tt><a 
href="clmse62.html#x78-922002r176">shadowing-import</a></tt> проверяет
конфликт имён при условии, что другой существующий символ с указанным
именем доступен и, если так, он затеняется новым символом, что означает,
что он должен быть дезинтернирован, если он был представлен в пакете
напрямую.
<tt>
<!--l. 2448--><p class="indent" >   <a 
href="clmse62.html#x78-925002r179">unuse-package</a></tt>, <tt><a 
href="clmse62.html#x78-920002r174">unexport</a></tt> и <tt><a 
href="clmse62.html#x78-918002r172">unintern</a></tt> (когда символ, будучи
дезинтернированым, не является затеняющим символом) не требуют
                                                                          

                                                                          
проверки конфликтов имён, потому что они просто удаляют символы из
пакета. Они не делают какие-либо новые символы доступными.
<!--l. 2453--><p class="indent" >   Указание затеняющего символа в функцию <tt><a 
href="clmse62.html#x78-918002r172">unintern</a></tt> может раскрывать
конфликт имён, который был ранее разрешён с помощью затенения. Если
пакет A использует пакеты B и C, A содержит затеняющий символ <tt>x</tt>, и B, и
C, каждый содержит внешний символ с именем <tt>x</tt>, тогда при удалении
затеняющего символа <tt>x</tt> из A будет обнаружен конфликт между <tt>b:x</tt> и
<tt>c:x</tt>, если эти два символа различны. В этом случае <tt><a 
href="clmse62.html#x78-918002r172">unintern</a></tt> будет
сигнализировать ошибку.
<!--l. 2461--><p class="indent" >   Прерывание ошибки конфликта имён оставляет оригинальный символ
доступным. Функции для пакетов всегда сигнализируют ошибки конфликтов
имён перед любыми изменениями в структуре пакетов. Однако когда
изменяются много символов за раз, например, когда <tt><a 
href="clmse62.html#x78-919002r173">export</a></tt> получила
список символов, реализация может обрабатывать каждое изменение
по отдельности, таким образом прерывание ошибки, возникшей для
второго символа, не приведёт к отмене результатов, выполненных для
первого символа. Однако, прерывание из ошибки конфликта имён при
использовании <tt><a 
href="clmse62.html#x78-919002r173">export</a></tt> для одного символа не оставит этот символ
доступным для одних пакетов и недоступным для других. В отношении к
каждому обрабатываемому символу <tt><a 
href="clmse62.html#x78-919002r173">export</a></tt> ведёт себя как атомарная
операция.
<!--l. 2472--><p class="indent" >   Продолжение из ошибки конфликта имён должно предлагать
пользователю возможность разрешить конфликт имён в пользу какого-либо
из кандидатов. Структура пакета должна измениться в соответствие с
разрешением конфликта имён, с помощью <tt><a 
href="clmse62.html#x78-922002r176">shadowing-import</a></tt>, <tt><a 
href="clmse62.html#x78-918002r172">unintern</a></tt> или
<tt><a 
href="clmse62.html#x78-920002r174">unexport</a></tt>.
<!--l. 2477--><p class="indent" >   Конфликт имён в <tt><a 
href="clmse62.html#x78-924002r178">use-package</a></tt> между <i>родственными</i> символом в
использующем пакете и внешними символом в используемом пакете может
быть разрешён в пользу первого символа с помощью создания затеняющего
символа, или в пользу второго символа с помощью дезинтернирования
первого символа из использующего пакета. Последний способ опасен, если
символ для дезинтернирования является внешним символом использующего
пакета, так как перестанет быть внешним символом.
<!--l. 2485--><p class="indent" >   Конфликт имён в <tt><a 
href="clmse62.html#x78-924002r178">use-package</a></tt> между двумя внешними символами,
унаследованными в использующем пакете из других пакетов, может быть
разрешён в пользу одного из символов, с помощью импортирования его в
использующий пакет и превращения его в затеняющий символ.
<!--l. 2490--><p class="indent" >   Конфликт имён в <tt><a 
href="clmse62.html#x78-919002r173">export</a></tt> между символом для экспорта и символом
                                                                          

                                                                          
уже присутствующем в пакете, который будет наследовать свеже
экспортирующийся символ, может быть разрешён в пользу экспортируемого
символа с помощью дезинтернирования другого символа, или в пользу уже
присутствующего символа, превращением его в затеняющий.
<!--l. 2496--><p class="indent" >   Конфликт имён в <tt><a 
href="clmse62.html#x78-919002r173">export</a></tt> или <tt><a 
href="clmse62.html#x78-918002r172">unintern</a></tt> из-за пакета, наследующего два
различных символа с одинаковым именем из двух разных пакетов, может
быть разрешён в пользу одного из символов с помощью импортирования его
в использующий пакет и превращении его в затеняющий, также как и при
использовании <tt><a 
href="clmse62.html#x78-924002r178">use-package</a></tt>.
<!--l. 2502--><p class="indent" >   Конфликт имён в <tt><a 
href="clmse62.html#x78-921002r175">import</a></tt> между символом для импортирования и
символом унаследованным из некоторого другого пакета может быть
разрешён в пользу импортируемого символа превращением его в затеняющий
символ или в пользу уже доступного символа с помощью отмены <tt><a 
href="clmse62.html#x78-921002r175">import</a></tt>.
Конфликт имён в <tt><a 
href="clmse62.html#x78-921002r175">import</a></tt> с символом уже присутствующем в пакете может
быть разрешён с помощью дезинтернирования этого символа, или отмены
<tt><a 
href="clmse62.html#x78-921002r175">import</a></tt>.
<!--l. 2509--><p class="indent" >   Хороший стиль пользовательского интерфейса диктует то, что
<tt><a 
href="clmse62.html#x78-924002r178">use-package</a></tt> и <tt><a 
href="clmse62.html#x78-919002r173">export</a></tt>, которые могут вызывать за раз много конфликтов
имён, сначала проверяют все конфликты имён перед тем, как предоставить
любой из них пользователю. Пользователь может выбрать разрешать
ли конфликт для всех сразу или по отдельности. Последний способ
трудоёмок, но позволяет разрешить каждый конфликт отдельным
способом.
<!--l. 2517--><p class="indent" >   Реализации могут предлагать другие пути решения конфликтов имён.
Например, если конфликтующие символы, не используемые для объектов, а
только для имен функций, они могут быть «слиты» с помощью размещения
определения функции в обоих символах. Ссылка на любой символ в целях
вызова функции будет эквивалентна. Похожая операция «слияния» может
быть сделана для значений переменных или для вещей, сохранённых в списке
свойств. В Lisp Machine Lisp&#x2019;е, например, можно было также <i>выдвинуть
(forward)</i> значение, функцию и ячейки свойств так, что изменения в одном
символе приводили к изменению в другом. Некоторые другие реализации
позволяют сделать это для ячейки значения, но на для ячейки списка
свойств. Тогда пользователь может знать является ли этот метод разрешения
конфликтов имён адекватным, потому что метод будет работать только, если
использования двух не-<tt><a 
href="clmse33.html#x44-397002r44">eq</a></tt> символов с одинаковым именем не будет
препятствовать корректной работе программы. Значение стоимости слияния
символов, как разрешении конфликта имён, в том, что оно может
                                                                          

                                                                          
избегать необходимости выбрасывать весь Lisp&#x2019;овый мир, исправлять
формы определения пакета, который вызвал ошибку и начинать с
нуля.
                                                                          

                                                                          
<!--l. 2534--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse61.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse59.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse59.html#tailclmse59.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse60.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch11.html#clmse60.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse60.html"></a>  </div> </div> 
</body></html> 
