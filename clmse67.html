<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Byte Manipulation Functions Функции для манипуляции с байтами</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-11 09:24:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 4357--><p class="noindent" > <div id="main_container"> <div id="content"> <!--l. 4357--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse68.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse66.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse66.html#tailclmse66.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse67.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch12.html#clmse67.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">12.8   </span> <a 
href="clm.html#QQ2-84-213" id="x84-18500012.8">Byte Manipulation Functions Функции для манипуляции с
байтами</a></h3>
<!--l. 4359--><p class="noindent" >Several functions are provided for dealing with an arbitrary-width ﬁeld of
contiguous bits appearing anywhere in an integer. Such a contiguous set
of bits is called a <i>byte</i>. Here the term <i>byte</i> does not imply some ﬁxed
number of bits (such as eight), rather a ﬁeld of arbitrary and user-speciﬁable
width.
<!--l. 4365--><p class="indent" >   Common Lisp содержит несколько функций для работы с полями
смежных битов произвольной длины, находящимися где-нибудь в целом
числе. Такое множество смежных битов называется <i>байт</i>. В Common Lisp&#x2019;е
термин <i>байт</i> не означает некоторое определенное количество бит (как
например восемь), а обозначает поле произвольной, определяемой
пользователем длины.
<!--l. 4372--><p class="indent" >   The byte-manipulation functions use objects called <i>byte speciﬁers</i> to designate
a speciﬁc byte position within an integer. The representation of a byte
speciﬁer is implementation-dependent; in particular, it may or may not be a
number. It is suﬃcient to know that the function <tt><a 
href="#x84-185002r272">byte</a></tt> will construct
one, and that the byte-manipulation functions will accept them. The
function <tt><a 
href="#x84-185002r272">byte</a></tt> accepts two integers representing the <i>position</i> and <i>size</i> of
the byte and returns a byte speciﬁer. Such a speciﬁer designates a byte
whose width is <i>size</i> and whose bits have weights <span class="math">2<sup>position+size−1</sup></span> through
<span class="math">2<sup>position</sup></span>.
<!--l. 4385--><p class="indent" >   Функции обработки байтом используют объекты, называющиеся
<i>спецификаторы байта</i> для определения заданной позиции байта в целом
числе. Представление спецификтора байта зависит от реализации. В
частности оно может быть или не быть числом. Достаточно знать, что
функция <tt><a 
href="#x84-185002r272">byte</a></tt> будет создавать такой спецификатор, и что функция для
обработки байта будет принимать его. Функция <tt><a 
href="#x84-185002r272">byte</a></tt> принимает два
целых числа указывающих на <i>позицию</i> и <i>размер</i> байта и возвращает
его спецификатор. Такой спецификатор определяет байт, у которого
ширина равна <i>размеру</i>, и биты которого имеют веса с <span class="math">2<sup>position+size−1</sup></span> по
                                                                          

                                                                          
<span class="math">2<sup>position</sup></span>.
<div class=defun>
<!--l. 4397--><p class="noindent" ><i>[Function]</i><a 
 id="dx84-185001"></a><a 
 id="x84-185002r272"></a><b> byte</b>  <i>size</i> <i>position</i>
<!--l. 4399--><p class="noindent" ><tt><a 
href="#x84-185002r272">byte</a></tt> takes two integers representing the size and position of a byte and returns
a byte speciﬁer suitable for use as an argument to byte-manipulation
functions.
</div>
<div class=defun>
<!--l. 4405--><p class="noindent" ><i>[Function]</i><a 
 id="dx84-185003"></a><a 
 id="x84-185004r273"></a><b> byte-size</b>  <i>bytespec</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx84-185005"></a><a 
 id="x84-185006r274"></a><b> byte-position</b>  <i>bytespec</i>
<!--l. 4408--><p class="noindent" >Given a byte speciﬁer, <tt><a 
href="#x84-185004r273">byte-size</a></tt> returns the size speciﬁed as an integer;
<tt><a 
href="#x84-185006r274">byte-position</a></tt> similarly returns the position. For example: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(byte-size (byte <i>j</i> <i>k</i>)) <span class="math"> ≡</span> <i>j</i>
</td></tr></table>
<!--l. 4413--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(byte-position (byte <i>j</i> <i>k</i>)) <span class="math"> ≡</span> <i>k</i></td></tr></table>
<!--l. 4415--><p class="indent" >
</div>
</div>
<!--l. 4417--><p class="indent" >   Принимая спецификатор байта, <tt><a 
href="#x84-185004r273">byte-size</a></tt> возвращает размер
указанного байта, а <tt><a 
href="#x84-185006r274">byte-position</a></tt> — позицию этого байта. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(byte-size (byte <i>j</i> <i>k</i>)) <span class="math"> ≡</span> <i>j</i>
</td></tr></table>
<!--l. 4421--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(byte-position (byte <i>j</i> <i>k</i>)) <span class="math"> ≡</span> <i>k</i></td></tr></table>
<!--l. 4423--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 4426--><p class="noindent" ><i>[Function]</i><a 
 id="dx84-185007"></a><a 
 id="x84-185008r275"></a><b> ldb</b>  <i>bytespec</i> <i>integer</i>
<!--l. 4428--><p class="noindent" ><i>bytespec</i> speciﬁes a byte of <i>integer</i> to be extracted. The result is returned as a
non-negative integer. For example: <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logbitp <i>j</i> (ldb (byte <i>s</i> <i>p</i>) <i>n</i>)) <span class="math"> ≡</span> (and (&#x003C; <i>j</i> <i>s</i>) (logbitp (+ <i>j</i> <i>p</i>) <i>n</i>))
</td></tr></table>
<!--l. 4434--><p class="indent" >
</div>
</div>
<!--l. 4435--><p class="noindent" >The name of the function <tt><a 
href="#x84-185008r275">ldb</a></tt> means “load byte.”
<!--l. 4437--><p class="indent" >   If the argument <i>integer</i> is speciﬁed by a form that is a <i>place</i> form acceptable
to <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>, then <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> may be used with <tt><a 
href="#x84-185008r275">ldb</a></tt> to modify a byte within the integer that
is stored in that <i>place</i>. The eﬀect is to perform a <tt><a 
href="#x84-185014r278">dpb</a></tt> operation and then store the
result back into the <i>place</i>.
<!--l. 4445--><p class="indent" >   Спецификатор байта <i>bytespec</i> указывает на байт, который будет извлечен
из целого числа <i>integer</i>. Результат возвращается в качестве неотрицательного
целого числа. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logbitp <i>j</i> (ldb (byte <i>s</i> <i>p</i>) <i>n</i>)) <span class="math"> ≡</span> (and (&#x003C; <i>j</i> <i>s</i>) (logbitp (+ <i>j</i> <i>p</i>) <i>n</i>))
</td></tr></table>
<!--l. 4451--><p class="indent" >
</div>
</div>
<!--l. 4452--><p class="noindent" >Имя функции <tt>ldf</tt> озаначает «load byte (загрузить байт)».
<!--l. 4454--><p class="indent" >   Если аргумент <i>integer</i> задан формой, которая может использоваться в
<tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>, тогда <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> может использоваться вместе с <tt><a 
href="#x84-185008r275">ldb</a></tt> для изменения байта в
целом числе указанном в форме <i>integer</i>. Это действие выполняется с
помощью операции <tt><a 
href="#x84-185014r278">dpb</a></tt>.
</div>
<div class=defun>
<!--l. 4460--><p class="noindent" ><i>[Function]</i><a 
 id="dx84-185009"></a><a 
 id="x84-185010r276"></a><b> ldb-test</b>  <i>bytespec</i> <i>integer</i>
<!--l. 4462--><p class="noindent" ><tt><a 
href="#x84-185010r276">ldb-test</a></tt> is a predicate that is true if any of the bits designated by the byte
speciﬁer <i>bytespec</i> are 1&#x2019;s in <i>integer</i>; that is, it is true if the designated ﬁeld is
non-zero. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ldb-test <i>bytespec</i> <i>n</i>) <span class="math"> ≡</span> (not (zerop (ldb <i>bytespec</i> <i>n</i>)))
</td></tr></table>
<!--l. 4468--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<tt>
<!--l. 4470--><p class="indent" >   <a 
href="#x84-185010r276">ldb-test</a></tt> является предикатом, который истинен, если любой из битов,
указанных в спецификаторе байта <i>bytespec</i>, в целом числе <i>integer</i> имеет
значение 1. Другими словами, предикат истинен, если указанное поле не
равно нулю. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ldb-test <i>bytespec</i> <i>n</i>) <span class="math"> ≡</span> (not (zerop (ldb <i>bytespec</i> <i>n</i>)))
</td></tr></table>
<!--l. 4476--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 4479--><p class="noindent" ><i>[Function]</i><a 
 id="dx84-185011"></a><a 
 id="x84-185012r277"></a><b> mask-ﬁeld</b>  <i>bytespec</i> <i>integer</i>
<!--l. 4481--><p class="noindent" >This is similar to <tt><a 
href="#x84-185008r275">ldb</a></tt>; however, the result contains the speciﬁed byte of <i>integer</i> in
the position speciﬁed by <i>bytespec</i>, rather than in position 0 as with <tt><a 
href="#x84-185008r275">ldb</a></tt>. The
result therefore agrees with <i>integer</i> in the byte speciﬁed but has zero-bits
everywhere else. For example: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ldb <i>bs</i> (mask-ﬁeld <i>bs</i> <i>n</i>)) <span class="math"> ≡</span> (ldb <i>bs</i> <i>n</i>)
</td></tr></table>
<!--l. 4490--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4491--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logbitp <i>j</i> (mask-ﬁeld (byte <i>s</i> <i>p</i>) <i>n</i>))</td></tr></table>
<!--l. 4492--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (and (&#x003E;= <i>j</i> <i>p</i>) (&#x003C; <i>j</i> (+ <i>p</i> <i>s</i>)) (logbitp <i>j</i> <i>n</i>))</td></tr></table>
<!--l. 4493--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4494--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mask-ﬁeld <i>bs</i> <i>n</i>) <span class="math"> ≡</span> (logand <i>n</i> (dpb -1 <i>bs</i> 0))</td></tr></table>
<!--l. 4496--><p class="indent" >
</div>
</div>
<!--l. 4498--><p class="indent" >   If the argument <i>integer</i> is speciﬁed by a form that is a <i>place</i> form
acceptable to <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>, then <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> may be used with <tt><a 
href="#x84-185012r277">mask-field</a></tt> to modify
a byte within the integer that is stored in that <i>place</i>. The eﬀect is to
perform a <tt><a 
href="#x84-185016r279">deposit-field</a></tt> operation and then store the result back into the
<i>place</i>.
                                                                          

                                                                          
<!--l. 4506--><p class="indent" >   Функция похожа а <tt><a 
href="#x84-185008r275">ldb</a></tt>. Однако результат содержит указанный байт
целого числа <i>integer</i> в той же позиции, что указана в спецификаторе <i>bytespec</i>,
а не в нулевой позиции, как делает <tt><a 
href="#x84-185008r275">ldb</a></tt>. Таким образом результат в
указанном байте совпадает с целым числом <i>integer</i> , но в остальных местах
имеет нулевый биты. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ldb <i>bs</i> (mask-ﬁeld <i>bs</i> <i>n</i>)) <span class="math"> ≡</span> (ldb <i>bs</i> <i>n</i>)
</td></tr></table>
<!--l. 4513--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4514--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logbitp <i>j</i> (mask-ﬁeld (byte <i>s</i> <i>p</i>) <i>n</i>))</td></tr></table>
<!--l. 4515--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (and (&#x003E;= <i>j</i> <i>p</i>) (&#x003C; <i>j</i> (+ <i>p</i> <i>s</i>)) (logbitp <i>j</i> <i>n</i>))</td></tr></table>
<!--l. 4516--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4517--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mask-ﬁeld <i>bs</i> <i>n</i>) <span class="math"> ≡</span> (logand <i>n</i> (dpb -1 <i>bs</i> 0))</td></tr></table>
<!--l. 4519--><p class="indent" >
</div>
</div>
<!--l. 4521--><p class="indent" >   Если аргумент <i>integer</i> задан формой, которая может использоваться в
<tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>, тогда <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> может использоваться вместе с <tt><a 
href="#x84-185012r277">mask-field</a></tt> для изменения
байта в целом числе указанном в форме <i>integer</i>. Это действие выполняется с
помощью операции <tt><a 
href="#x84-185016r279">deposit-field</a></tt>.
</div>
<div class=defun>
<!--l. 4527--><p class="noindent" ><i>[Function]</i><a 
 id="dx84-185013"></a><a 
 id="x84-185014r278"></a><b> dpb</b>  <i>newbyte</i> <i>bytespec</i> <i>integer</i>
<!--l. 4529--><p class="noindent" >This returns a number that is the same as <i>integer</i> except in the bits speciﬁed by
<i>bytespec</i>. Let <i>s</i> be the size speciﬁed by <i>bytespec</i>; then the low <i>s</i> bits of <i>newbyte</i>
appear in the result in the byte speciﬁed by <i>bytespec</i>. The integer <i>newbyte</i> is
therefore interpreted as being right-justiﬁed, as if it were the result of <tt><a 
href="#x84-185008r275">ldb</a></tt>. For
example: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logbitp <i>j</i> (dpb <i>m</i> (byte <i>s</i> <i>p</i>) <i>n</i>))
</td></tr></table>
<!--l. 4538--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:69;" 
class="tabbing">  <span class="math"> ≡</span> (if </td><td  
class="tabbing">(and (&#x003E;= <i>j</i> <i>p</i>) (&#x003C; <i>j</i> (+ <i>p</i> <i>s</i>)))</td></tr></table>
<!--l. 4539--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:69;" 
class="tabbing">            </td><td  
class="tabbing">(logbitp (- <i>j</i> <i>p</i>) <i>m</i>)</td></tr></table>
<!--l. 4540--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:69;" 
class="tabbing">            </td><td  
class="tabbing">(logbitp <i>j</i> <i>n</i>))</td></tr></table>
<!--l. 4542--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 4543--><p class="noindent" >The name of the function <tt><a 
href="#x84-185014r278">dpb</a></tt> means “deposit byte.”
<!--l. 4545--><p class="indent" >   Данная функция возвращает число, которое похоже на <i>integer</i> за
исключением битов, указанных спецификатором <i>bytespec.</i>. Пусть <i>s</i> будет
размером, указанным в спецификаторе <i>bytespec</i>. Тогда целое число <i>newbyte</i>
будет интпретировано, будучи выровненным вправо, как если бы было
результатом <tt><a 
href="#x84-185008r275">ldb</a></tt>. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logbitp <i>j</i> (dpb <i>m</i> (byte <i>s</i> <i>p</i>) <i>n</i>))
</td></tr></table>
<!--l. 4552--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:69;" 
class="tabbing">  <span class="math"> ≡</span> (if </td><td  
class="tabbing">(and (&#x003E;= <i>j</i> <i>p</i>) (&#x003C; <i>j</i> (+ <i>p</i> <i>s</i>)))</td></tr></table>
<!--l. 4553--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:69;" 
class="tabbing">            </td><td  
class="tabbing">(logbitp (- <i>j</i> <i>p</i>) <i>m</i>)</td></tr></table>
<!--l. 4554--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:69;" 
class="tabbing">            </td><td  
class="tabbing">(logbitp <i>j</i> <i>n</i>))</td></tr></table>
<!--l. 4556--><p class="indent" >
</div>
</div>
<!--l. 4557--><p class="noindent" >Имя функции <tt><a 
href="#x84-185014r278">dpb</a></tt> означает «deposit byte (сохранить байт)».
</div>
<div class=defun>
<!--l. 4560--><p class="noindent" ><i>[Function]</i><a 
 id="dx84-185015"></a><a 
 id="x84-185016r279"></a><b> deposit-ﬁeld</b>  <i>newbyte</i> <i>bytespec</i> <i>integer</i>
<!--l. 4562--><p class="noindent" >This function is to <tt><a 
href="#x84-185012r277">mask-field</a></tt> as <tt><a 
href="#x84-185014r278">dpb</a></tt> is to <tt><a 
href="#x84-185008r275">ldb</a></tt>. The result is an integer that
contains the bits of <i>newbyte</i> within the byte speciﬁed by <i>bytespec</i>, and elsewhere
contains the bits of <i>integer</i>. For example: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logbitp <i>j</i> (deposit-ﬁeld <i>m</i> (byte <i>s</i> <i>p</i>) <i>n</i>))
</td></tr></table>
<!--l. 4569--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:79;" 
class="tabbing">   <span class="math"> ≡</span> (if </td><td  
class="tabbing">(and (&#x003E;= <i>j</i> <i>p</i>) (&#x003C; <i>j</i> (+ <i>p</i> <i>s</i>)))</td></tr></table>
<!--l. 4570--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:79;" 
class="tabbing">             </td><td  
class="tabbing">(logbitp <i>j</i> <i>m</i>)</td></tr></table>
<!--l. 4571--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:79;" 
class="tabbing">             </td><td  
class="tabbing">(logbitp <i>j</i> <i>n</i>))</td></tr></table>
<!--l. 4573--><p class="indent" >
</div>
</div>
<!--l. 4575--><p class="indent" >   Данная функция относится к <tt><a 
href="#x84-185012r277">mask-field</a></tt> так же, как <tt><a 
href="#x84-185014r278">dpb</a></tt> относится к
<tt><a 
href="#x84-185008r275">ldb</a></tt>. Результатом является целое число, которе содержит биты <i>newbyte</i> в том
                                                                          

                                                                          
месте, куда указывает спецификатор <i>bytespec</i>, и биты числа <i>integer</i> во всех
остальных местах. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logbitp <i>j</i> (deposit-ﬁeld <i>m</i> (byte <i>s</i> <i>p</i>) <i>n</i>))
</td></tr></table>
<!--l. 4581--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:79;" 
class="tabbing">   <span class="math"> ≡</span> (if </td><td  
class="tabbing">(and (&#x003E;= <i>j</i> <i>p</i>) (&#x003C; <i>j</i> (+ <i>p</i> <i>s</i>)))</td></tr></table>
<!--l. 4582--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:79;" 
class="tabbing">             </td><td  
class="tabbing">(logbitp <i>j</i> <i>m</i>)</td></tr></table>
<!--l. 4583--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:79;" 
class="tabbing">             </td><td  
class="tabbing">(logbitp <i>j</i> <i>n</i>))</td></tr></table>
<!--l. 4585--><p class="indent" >
</div>
</div>
<div class=implementation>
<!--l. 4588--><p class="noindent" ><b>Заметка для реализации:</b> If the <i>bytespec</i> is a constant, one may of course
construct, at compile time, an equivalent mask <i>m</i>, for example by computing
<tt>(deposit-field -1 <i>bytespec</i> 0)</tt>. Given this mask <i>m</i>, one may then compute
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(deposit-ﬁeld <i>newbyte</i> <i>bytespec</i> <i>integer</i>)
</td></tr></table>
<!--l. 4595--><p class="indent" >
</div>
</div>
<!--l. 4596--><p class="noindent" >by computing <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logior (logand <i>newbyte</i> <i>m</i>) (logand <i>integer</i> (lognot <i>m</i>)))
</td></tr></table>
<!--l. 4599--><p class="indent" >
</div>
</div>
<!--l. 4600--><p class="noindent" >where the result of <tt>(lognot <i>m</i>)</tt> can of course also be computed at compile time. However,
the following expression may also be used and may require fewer temporary registers in
some situations: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(logxor <i>integer</i> (logand <i>m</i> (logxor <i>integer</i> <i>newbyte</i>)))
</td></tr></table>
<!--l. 4606--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 4607--><p class="noindent" >A related, though possibly less useful, trick is that <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((z (logand (logxor x y) m)))
</td></tr></table>
<!--l. 4609--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setq x (logxor z x))</td></tr></table>
<!--l. 4610--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setq y (logxor z y)))</td></tr></table>
<!--l. 4612--><p class="indent" >
</div>
</div>
<!--l. 4613--><p class="noindent" >interchanges those bits of <tt>x</tt> and <tt>y</tt> for which the mask <tt>m</tt> is <tt>1</tt>, and leaves alone those bits of <tt>x</tt>
and <tt>y</tt> for which <tt>m</tt> is <tt>0</tt>.
</div>
<div class=implementation>
<!--l. 4620--><p class="noindent" ><b>Заметка для реализации:</b> Если спецификатор <i>bytespec</i> является константой,
</div>
</div>
                                                                          

                                                                          
   <!--l. 4626--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse68.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse66.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse66.html#tailclmse66.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse67.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch12.html#clmse67.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 4626--><p class="indent" >   <a 
 id="tailclmse67.html"></a>  </div> </div> 
</body></html> 
