<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Как использовать defstruct</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-19 16:08:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1332--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse100.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse98.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse98.html#tailclmse98.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse99.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse99.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">19.2   </span> <a 
href="clm.html#QQ2-123-255" id="x123-22700019.2">Как использовать defstruct</a></h3>
<!--l. 1334--><p class="noindent" >Все структуры определяются с помощью конструкции <a 
href="#x123-227002r580">defstruct</a>. Вызов
<a 
href="#x123-227002r580">defstruct</a> определяет новый тип данных, экземпляры которого содержат
именованные слоты.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> defstruct </b><a 
 id="dx123-227001"></a><a 
 id="x123-227002r580"></a> name-and-options [doc-string]  {slot-description}+
</td></tr></table>
<!--l. 1340--><p class="indent" >
</div>
<!--l. 1340--><p class="noindent" ><span class="paragraphHead"><a 
href="#x123-22800019.2" id="x123-22800019.2"></a></span>
   Этот макрос определяет структурный тип данных. Обычно вызов <a 
href="#x123-227002r580">defstruct</a>
выглядит как следующий пример. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defstruct (<i>name</i> <i>option-1</i> <i>option-2</i> ... <i>option-m</i>)
</td></tr></table>
<!--l. 1344--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           <i>doc-string</i></td></tr></table>
<!--l. 1345--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           <i>slot-description-1</i></td></tr></table>
<!--l. 1346--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           <i>slot-description-2</i></td></tr></table>
<!--l. 1347--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           ...</td></tr></table>
<!--l. 1348--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           <i>slot-description-n</i>)</td></tr></table>
<!--l. 1349--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1350--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 1351--><p class="noindent" >Имя структуры <i>name</i> должно быть символом. Он становиться именем
нового типа данных, который включает в себя все экземпляры данной
структуры. Соответственно функция <a 
href="clmse32.html#x43-76002r20">typep</a> будет принимать и использовать
это имя. Имя структуры <i>name</i> возвращается как значение формы
<i>defstruct</i>.
<!--l. 1356--><p class="indent" >   Обычно опции не нужны. Если они не заданы, то после слова <a 
href="#x123-227002r580">defstruct</a>
вместо (<i>name</i>) можно записать просто <i>name</i> . Синтаксис опций и их смысл
раскрываются в разделе <a 
href="clmse102.html#x126-23100019.5">19.5<!--tex4ht:ref: DEFSTRUCT-OPTIONS --></a>.
<!--l. 1360--><p class="indent" >   Если присутствует необязательная строка документации <i>doc-string</i>, тогда
она присоединяется к символу <i>name</i>, как документация для типа structure.
Смотрите <a 
href="clmse146.html#x179-417017r889">documentation</a>.
<!--l. 1364--><p class="indent" >   Каждое описание слота <i>slot-description-j</i> выглядит так: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(<i>slot-name</i> <i>default-init</i>
</td></tr></table>
<!--l. 1366--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     <i>slot-option-name-1</i> <i>slot-option-value-1</i></td></tr></table>
<!--l. 1367--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     <i>slot-option-name-2</i> <i>slot-option-value-2</i></td></tr></table>
<!--l. 1368--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ...</td></tr></table>
<!--l. 1369--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     <i>slot-option-name-k<span class="math"><sub>j</sub></span></i> <i>slot-option-value-k<span class="math"><sub>j</sub></span></i>)</td></tr></table>
<!--l. 1371--><p class="indent" >
</div>
</div>
<!--l. 1372--><p class="noindent" >Каждое имя слота <i>slot-name</i> должно быть символом. Для каждого слота
определяется функция доступа. Если опции и первоначальные значения не
указаны, тогда в качестве описания слота вместо (slot-name) можно записать
просто <i>slot-name</i>.
<!--l. 1377--><p class="indent" >   Форма <i>default-init</i> вычисляется, только если соответствующий аргумент не
указан при вызове функций-конструкторов. <i>default-init</i> вычисляется
<i>каждый раз</i>, когда необходимо получить первоначальное значение для
слота.
<!--l. 1382--><p class="indent" >   Если <i>default-init</i> не указано, тогда первоначальное значение слота не
определено и зависит от реализации. Доступные опции для слотов разобраны
в разделе <a 
href="clmse101.html#x125-23000019.4">19.4<!--tex4ht:ref: Defstruct-Slot-Options --></a>.
<!--l. 1386--><p class="indent" >   <a 
href="#x123-227002r580">defstruct</a> не только определяет функции доступа к слотам, но также
                                                                          

                                                                          
выполняет интеграцию с <a 
href="clmse36.html#x48-90002r64">setf</a> для этих функций, определяет предикат с
именем <i>name</i>-p, определяет функцию-конструктор с именем make-<i>name</i> и
определяет функцию копирования с именем copy-<i>name</i>. Все имена
автоматически создаваемых функций интернируются в текущий пакет на
время выполнения <a 
href="#x123-227002r580">defstruct</a> (смотрите <a 
href="clmse60.html#x76-168002r141">*package*</a>). Кроме того, все эти
функции могут быть задекларированы как inline на усмотрение реализации
для повышения производительности. Если вы не хотите, чтобы функции
были задекларированы как inline, укажите декларацию notinline после
формы <a 
href="#x123-227002r580">defstruct</a> для перезаписи декларации inline.
</div>
                                                                          

                                                                          
   <!--l. 1400--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse100.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse98.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse98.html#tailclmse98.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse99.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse99.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 1400--><p class="indent" >   <a 
 id="tailclmse99.html"></a>  
</body></html> 
