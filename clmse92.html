<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Hash Table Functions Функции для хеш-таблиц</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-11 14:56:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 142--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse93.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#tailclmch16.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse92.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#clmse92.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">16.1   </span> <a 
 id="x113-23400016.1"></a>Hash Table Functions Функции для хеш-таблиц</h3>
<!--l. 144--><p class="noindent" >This section documents the functions for hash tables, which use <i>objects</i> as keys
and associate other objects with them.
<!--l. 147--><p class="indent" >   Данный раздел описывает функции для хеш-таблиц, которые используют
<i>объекты</i> для ключей и ассоциируют другие объекты с этими.
<div class=defun>
<!--l. 150--><p class="noindent" ><i>[Function]</i><a 
 id="dx113-234001"></a><a 
 id="x113-234002r545"></a><b> make-hash-table</b>  &#x0026;key  <i>:test</i> <i>:size</i> <i>:rehash-size</i> <i>:rehash-threshold</i>
<!--l. 152--><p class="noindent" >This function creates and returns a new hash table. The :test argument
determines how keys are compared; it must be one of the three values #&#x2019;eq, #&#x2019;eql,
or #&#x2019;equal, or one of the three symbols <a 
href="clmse33.html#x44-81002r46">eq</a>, <a 
href="clmse33.html#x44-81005r47">eql</a>, or <a 
href="clmse33.html#x44-81007r48">equal</a>. If no test is speciﬁed, <a 
href="clmse33.html#x44-81005r47">eql</a>
is assumed.
<!--l. 159--><p class="indent" >   Эта функция создает и возвращает новую хеш-таблицу. Аргумент :test
определяет как будут сравниваться ключи. Он может быть одним из трех
значений #&#x2019;eq, #&#x2019;eql или #&#x2019;equal, или одним из трех символов <a 
href="clmse33.html#x44-81002r46">eq</a>, <a 
href="clmse33.html#x44-81005r47">eql</a> или
<a 
href="clmse33.html#x44-81007r48">equal</a>. По-умолчанию используется <a 
href="clmse33.html#x44-81005r47">eql</a>.
<div class=new>
<!--l. 166--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx113-234003"></a>to add a fourth type of hash table: the value of
#&#x2019;equalp and the symbol <a 
href="clmse33.html#x44-81010r49">equalp</a> are to be additional valid possibilities for the
:test argument.
<!--l. 173--><p class="indent" >   Note that one consequence of the vote to change the rules of ﬂoating-point
contagion <a 
 id="dx113-234004"></a>(described in section <a 
href="clmse66.html#x83-19700012.1">12.1<!--tex4ht:ref: PRECISION-CONTAGION-COERCION-SECTION --></a>) is to require <a 
href="clmse68.html#x85-199002r210">=</a>, and therefore also <a 
href="clmse33.html#x44-81010r49">equalp</a>, to
compare the values of numbers exactly and not approximately, making <a 
href="clmse33.html#x44-81010r49">equalp</a> a
true equivalence relation on numbers.
<!--l. 182--><p class="indent" >   Another valuable use of <a 
href="clmse33.html#x44-81010r49">equalp</a> hash tables is case-insensitive comparison of
keys that are strings.
                                                                          

                                                                          
</div>
<!--l. 186--><p class="indent" >   The :size argument sets the initial size of the hash table, in entries.
(The actual size may be rounded up from the size you specify to the
next “good” size, for example to make it a prime number.) You won&#x2019;t
necessarily be able to store precisely this many entries into the table before it
overﬂows and becomes bigger, but this argument does serve as a hint to
the implementation of approximately how many entries you intend to
store.
<!--l. 196--><p class="indent" >   Аргумент :size устанавливает первоначальный размер хеш-таблицы в
парах. (Указанный размер может быть округлен до «хорошего» размера,
например, до первого следующего простого числа.) Вы можете не сохранять
в таблице столько пар, сколько указали. Этот аргумент служит подсказкой
для реализации о том, какое примерно число элементов вы будете хранить в
хеш-таблице.
<div class=new>
<!--l. 204--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx113-234005"></a>to clarify that the :size argument must be a
non-negative integer.
</div>
<div class=newer>
<!--l. 211--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx113-234006"></a>to regard the preceding description of the :size
argument as deﬁnitive: it is approximately the number of entries that can be
inserted without having to enlarge the hash table.
</div>
<!--l. 217--><p class="indent" >   The :rehash-size argument speciﬁes how much to increase the size of the hash
table when it becomes full. This can be an integer greater than zero, which is the
number of entries to add, or it can be a ﬂoating-point number greater than 1,
which is the ratio of the new size to the old size. The default value for this
argument is implementation-dependent.
<!--l. 225--><p class="indent" >   Аргумент :rehash-size указывает, на сколько увеличить размер
хеш-таблицы, когда она по размерам достигнет пределов. Если это целое
число, оно должно быть больше нуля, и будет означать абсолютное
приращение. Если это число с плавающей точкой, оно должно быть больше 1,
и будет означать относительное приращение к предыдущему размеру.
Значение по-умолчанию зависит от реализации.
<div class=obsolete>
<!--l. 233--><p class="indent" >   The :rehash-threshold argument speciﬁes how full the hash table can get
before it must grow. This can be an integer greater than zero and less than the
:rehash-size (in which case it will be scaled whenever the table is grown), or it can
                                                                          

                                                                          
be a ﬂoating-point number between zero and 1. The default value for this
argument is implementation-dependent.
</div>
<div class=newer>
<!--l. 242--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx113-234007"></a>to replace the preceding speciﬁcation of the
:rehash-threshold argument with the following: The :rehash-threshold
argument speciﬁes how full the hash table can get before it must grow.
It may be any real number between 0 and 1, inclusive. It indicates the
maximum desired level of hash table occupancy. An implementation is
permitted to ignore this argument. The default value for this argument is
implementation-dependent.
<!--l. 252--><p class="indent" >   Аргумент :rehash-threshold указывает, насколько должна наполниться
хеш-таблица, прежде чем она будет увеличина. Он должен быть числом
типа real между 0 и 1, включительно. Он показывает максимальный
уровень заполнения хеш-таблицы. Значение по-умолчанию зависит от
реализации.
</div>
<!--l. 259--><p class="indent" >   An example of the use of <a 
href="#x113-234002r545">make-hash-table</a>: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-hash-table :rehash-size 1.5
</td></tr></table>
<!--l. 261--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 :size (* number-of-widgets 43))</td></tr></table>
<!--l. 263--><p class="indent" >
</div>
</div>
<!--l. 265--><p class="indent" >   Пример использования <a 
href="#x113-234002r545">make-hash-table</a>: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-hash-table :rehash-size 1.5
</td></tr></table>
<!--l. 267--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 :size (* number-of-widgets 43))</td></tr></table>
<!--l. 269--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
                                                                          

                                                                          
<!--l. 272--><p class="noindent" ><i>[Function]</i><a 
 id="dx113-234008"></a><a 
 id="x113-234009r546"></a><b> hash-table-p</b>  <i>object</i>
<!--l. 274--><p class="noindent" ><a 
href="#x113-234009r546">hash-table-p</a> is true if its argument is a hash table, and otherwise is false. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-p x)  ≡ (typep x &#x2019;hash-table)
</td></tr></table>
<!--l. 279--><p class="indent" >
</div>
</div>
<!--l. 281--><p class="indent" >   <a 
href="#x113-234009r546">hash-table-p</a> возвращает истину, если аргумент является хеш-таблицей.
Иначе возвращает ложь. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-p x)  ≡ (typep x &#x2019;hash-table)
</td></tr></table>
<!--l. 285--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 288--><p class="noindent" ><i>[Function]</i><a 
 id="dx113-234010"></a><a 
 id="x113-234011r547"></a><b> gethash</b>  <i>key</i> <i>hash-table</i> &#x0026;optional  <i>default</i>
<!--l. 290--><p class="noindent" ><a 
href="#x113-234011r547">gethash</a> ﬁnds the entry in <i>hash-table</i> whose key is <i>key</i> and returns the associated
value. If there is no such entry, <a 
href="#x113-234011r547">gethash</a> returns <i>default</i>, which is <a 
href="clmse31.html#x42-77002r19">nil</a> if not
speciﬁed.
<!--l. 296--><p class="indent" >   <a 
href="#x113-234011r547">gethash</a> actually returns two values, the second being a predicate value that is
true if an entry was found, and false if no entry was found.
<!--l. 299--><p class="indent" >   <a 
href="clmse36.html#x48-93002r66">setf</a> may be used with <a 
href="#x113-234011r547">gethash</a> to make new entries in a hash table. If an entry
with the speciﬁed <i>key</i> already exists, it is removed before the new entry is added.
The <i>default</i> argument may be speciﬁed to <a 
href="#x113-234011r547">gethash</a> in this context; it is ignored by
<a 
href="clmse36.html#x48-93002r66">setf</a> but may be useful in such macros as <a 
href="clmse69.html#x86-200014r224">incf</a> that are related to <a 
href="clmse36.html#x48-93002r66">setf</a>: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(incf (gethash a-key table 0))
</td></tr></table>
<!--l. 306--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 307--><p class="noindent" >means approximately the same as <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table 0)
</td></tr></table>
<!--l. 309--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 311--><p class="indent" >
</div>
</div>
<!--l. 312--><p class="noindent" >which in turn would be treated as simply <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table)
</td></tr></table>
<!--l. 314--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 316--><p class="indent" >
</div>
</div>
<!--l. 318--><p class="indent" >   <a 
href="#x113-234011r547">gethash</a> ищет элемент в хеш-<i>hash-table</i>, чей ключ равен <i>key</i> и возвращает
связанное значение. Если элемент не был найден, то возвращается значение
аргумента <i>default</i>, который по-умолчанию равен <a 
href="clmse31.html#x42-77002r19">nil</a>.
<!--l. 322--><p class="indent" >   <a 
href="#x113-234011r547">gethash</a> возвращает два значение. Второе значение является предикатом, и
истинно, если значение было найдено, и ложно если нет.
<!--l. 325--><p class="indent" >   <a 
href="clmse36.html#x48-93002r66">setf</a> может использоваться вместе с <a 
href="#x113-234011r547">gethash</a> для создания в хеш-таблице
новых элементов. Если элемент с заданным ключом <i>key</i> уже существует, он
будет удален перед добавлением. В этом контексте может использоваться
аргумент <i>default</i>, он игнорируется <a 
href="clmse36.html#x48-93002r66">setf</a>, но может быть полезным в таких
макросах как <a 
href="clmse69.html#x86-200014r224">incf</a>, которые связаны с <a 
href="clmse36.html#x48-93002r66">setf</a>: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(incf (gethash a-key table 0))
</td></tr></table>
<!--l. 332--><p class="indent" >
</div>
</div>
<!--l. 333--><p class="noindent" >обозначает то же, что и <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table 0)
</td></tr></table>
<!--l. 335--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 337--><p class="indent" >
</div>
</div>
<!--l. 338--><p class="noindent" >что можно преобразовать в <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table)
</td></tr></table>
<!--l. 340--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 342--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 345--><p class="noindent" ><i>[Function]</i><a 
 id="dx113-234012"></a><a 
 id="x113-234013r548"></a><b> remhash</b>  <i>key</i> <i>hash-table</i>
<!--l. 347--><p class="noindent" ><a 
href="#x113-234013r548">remhash</a> removes any entry for <i>key</i> in <i>hash-table</i>. This is a predicate that is true if
there was an entry or false if there was not.
<!--l. 353--><p class="indent" >   <a 
href="#x113-234013r548">remhash</a> удаляет любой элемент в хеш-таблице <i>hash-table</i> ключ, которого
равен параметру <i>key</i>. Возвращает истину, если элемент был удален, и ложь,
если элемента уже не существовало.
</div>
<div class=defun>
<!--l. 358--><p class="noindent" ><i>[Function]</i><a 
 id="dx113-234014"></a><a 
 id="x113-234015r549"></a><b> maphash</b>  <i>function</i> <i>hash-table</i>
<!--l. 360--><p class="noindent" >For each entry in <i>hash-table</i>, <a 
href="#x113-234015r549">maphash</a> calls <i>function</i> on two arguments: the
key of the entry and the value of the entry; <a 
href="#x113-234015r549">maphash</a> then returns <a 
href="clmse31.html#x42-77002r19">nil</a>.
If entries are added to or deleted from the hash table while a <a 
href="#x113-234015r549">maphash</a>
is in progress, the results are unpredictable, with one exception: if the
<i>function</i> calls <a 
href="#x113-234013r548">remhash</a> to remove the entry currently being processed by the
<i>function</i>, or performs a <a 
href="clmse36.html#x48-93002r66">setf</a> of <a 
href="#x113-234011r547">gethash</a> on that entry to change the associated
value, then those operations will have the intended eﬀect. For example: <div class=lisp>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Alter every entry in MY-HASH-TABLE, replacing the value with
</td></tr></table>
<!--l. 372--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; its square root. Entries with negative values are removed.</td></tr></table>
<!--l. 373--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(maphash #&#x2019;(lambda (key val)</td></tr></table>
<!--l. 374--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (if (minusp val)</td></tr></table>
<!--l. 375--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (remhash key my-hash-table)</td></tr></table>
<!--l. 376--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (setf (gethash key my-hash-table) (sqrt val))))</td></tr></table>
<!--l. 377--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         my-hash-table)</td></tr></table>
<!--l. 379--><p class="indent" >
</div>
</div>
<!--l. 381--><p class="indent" >   Для каждого элемента в хеш-таблице <i>hash-table</i>, <a 
href="#x113-234015r549">maphash</a> вызывает
функцию <i>function</i> с двумя аргументами: ключ элемента и значение элемента.
<a 
href="#x113-234015r549">maphash</a> возвращает <a 
href="clmse31.html#x42-77002r19">nil</a>. Если во время выполнения <a 
href="#x113-234015r549">maphash</a> в хеш-таблице
добавлялись или удалялись ключи, то результат непредсказуем, но есть
исключение: если функция <i>function</i> вызывает <a 
href="#x113-234013r548">remhash</a> для удаления
элемента, который в эту функцию и был передан, или устанавливает новое
значение с помощью <a 
href="clmse36.html#x48-93002r66">setf</a> этому элементу, то эти операции будут выполнены
правильно. Например: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Изменение каждого элемента в MY-HASH-TABLE, с заменой на
</td></tr></table>
<!--l. 393--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; квадратный корень. Элементы с отрицательными значения удаляются.</td></tr></table>
<!--l. 394--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(maphash #&#x2019;(lambda (key val)</td></tr></table>
<!--l. 395--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (if (minusp val)</td></tr></table>
<!--l. 396--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (remhash key my-hash-table)</td></tr></table>
<!--l. 397--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (setf (gethash key my-hash-table) (sqrt val))))</td></tr></table>
<!--l. 398--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         my-hash-table)</td></tr></table>
<!--l. 400--><p class="indent" >
</div>
</div>
<div class=new>
<!--l. 403--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx113-234016"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-1420007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class=defun>
                                                                          

                                                                          
<!--l. 409--><p class="noindent" ><i>[Function]</i><a 
 id="dx113-234017"></a><a 
 id="x113-234018r550"></a><b> clrhash</b>  <i>hash-table</i>
<!--l. 411--><p class="noindent" >This removes all the entries from <i>hash-table</i> and returns the hash table
itself.
<!--l. 415--><p class="indent" >   Функция удаляет все элемент из хеш-таблицы <i>hash-table</i> и возвращает эту
хеш-таблицу.
</div>
<div class=defun>
<!--l. 419--><p class="noindent" ><i>[Function]</i><a 
 id="dx113-234019"></a><a 
 id="x113-234020r551"></a><b> hash-table-count</b>  <i>hash-table</i>
<!--l. 421--><p class="noindent" >This returns the number of entries in the <i>hash-table</i>. When a hash table is ﬁrst
created or has been cleared, the number of entries is zero.
<!--l. 426--><p class="indent" >   Функция возвращает количество элементов в хеш-таблице <i>hash-table</i>.
Когда хеш-таблица только были сделана, или только что очищена, то
количество элементов равно нулю.
</div>
<div class=new>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> with-hash-table-iterator </b><a 
 id="dx113-234021"></a><a 
 id="x113-234022r552"></a> (mname hash-table)  { form}*
</td></tr></table>
<!--l. 435--><p class="indent" >
</div>
<!--l. 435--><p class="noindent" ><span class="paragraphHead"><a 
 id="x113-23500016.1"></a></span>
   X3J13 voted in January 1989 <a 
 id="dx113-235001"></a>to add the macro <a 
href="#x113-234022r552">with-hash-table-iterator</a>.
<!--l. 440--><p class="indent" >   The name <i>mname</i> is bound and deﬁned as if by <a 
href="clmse39.html#x51-114010r95">macrolet</a>, with the body
<i>form</i>s as its lexical scope, to be a “generator macro” such that successive
invocations (<i>mname</i>) will return entries, one by one, from the hash table
that is the value of the expression <i>hash-table</i> (which is evaluated exactly
once).
<!--l. 446--><p class="indent" >   At each invocation of the generator macro, there are two possibilities. If there
is yet another unprocessed entry in the hash table, then three values are returned:
<a 
href="clmse31.html#x42-77004r20">t</a>, the key of the hash table entry, and the associated value of the hash table entry.
On the other hand, if there are no more unprocessed entries in the hash table,
then one value is returned: <a 
href="clmse31.html#x42-77002r19">nil</a>.
                                                                          

                                                                          
<!--l. 454--><p class="indent" >   The implicit interior state of the iteration over the hash table entries has
dynamic extent. While the name <i>mname</i> has lexical scope, it is an error to
invoke the generator macro once the <a 
href="#x113-234022r552">with-hash-table-iterator</a> form has been
exited.
<!--l. 459--><p class="indent" >   Invocations of <a 
href="#x113-234022r552">with-hash-table-iterator</a> and related macros may be nested, and
the generator macro of an outer invocation may be called from within an
inner invocation (assuming that its name is visible or otherwise made
available).
<div class=new>
<!--l. 465--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx113-235002"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-1420007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<div class=rationale>
<!--l. 471--><p class="noindent" ><b>Rationale:</b> This facility is a bit more ﬂexible than <a 
href="#x113-234015r549">maphash</a>. It makes possible a
portable and eﬃcient implementation of <a 
href="clmse42.html#x54-129002r106">loop</a> clauses for iterating over hash tables (see
chapter <a 
href="clmch26.html#x162-33400026">26<!--tex4ht:ref: LOOP --></a>).
</div>
</div>
<!--l. 479--><p class="indent" >
                                                                          

                                                                          
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq turtles (make-hash-table :size 9 :test &#x2019;eq))
</td></tr></table>
<!--l. 482--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash &#x2019;howard-kaylan turtles) &#x2019;(musician lead-singer))</td></tr></table>
<!--l. 483--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash &#x2019;john-barbata turtles) &#x2019;(musician drummer))</td></tr></table>
<!--l. 484--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash &#x2019;leonardo turtles) &#x2019;(ninja leader blue))</td></tr></table>
<!--l. 485--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash &#x2019;donatello turtles) &#x2019;(ninja machines purple))</td></tr></table>
<!--l. 486--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash &#x2019;al-nichol turtles) &#x2019;(musician guitarist))</td></tr></table>
<!--l. 487--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash &#x2019;mark-volman turtles) &#x2019;(musician great-hair))</td></tr></table>
<!--l. 488--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash &#x2019;raphael turtles) &#x2019;(ninja cool rude red))</td></tr></table>
<!--l. 489--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash &#x2019;michaelangelo turtles) &#x2019;(ninja party-dude orange))</td></tr></table>
<!--l. 490--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash &#x2019;jim-pons turtles) &#x2019;(musician bassist))</td></tr></table>
<!--l. 491--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 492--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(with-hash-table-iterator (get-turtle turtles)</td></tr></table>
<!--l. 493--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (labels ((try (got-one &#x0026;optional key value)</td></tr></table>
<!--l. 494--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:230;" 
class="tabbing">             (when got-one</td><td style="width:354;" 
class="tabbing-right">  ;Remember, keys may show up in any order</td></tr></table>
<!--l. 495--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               (when (eq (ﬁrst value) &#x2019;ninja)</td></tr></table>
<!--l. 496--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (format t &#x0022;~%~:(~A~): ~{~A~̂, ~}&#x0022;</td></tr></table>
<!--l. 497--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                         key (rest value)))</td></tr></table>
<!--l. 498--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               (multiple-value-call #&#x2019;try (get-turtle)))))</td></tr></table>
<!--l. 499--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (multiple-value-call #&#x2019;try (get-turtle))))     ;Prints 4 lines</td></tr></table>
<!--l. 500--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Michaelangelo: PARTY-DUDE, ORANGE</td></tr></table>
<!--l. 501--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Leonardo: LEADER, BLUE</td></tr></table>
<!--l. 502--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Raphael: COOL, RUDE, RED</td></tr></table>
<!--l. 503--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Donatello: MACHINES, PURPLE</td></tr></table>
<!--l. 504--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   ⇒ nil</td></tr></table>
<!--l. 506--><p class="indent" >
</div>
</div>
</div>
<div class=newer>
<div class=defun>
                                                                          

                                                                          
<!--l. 510--><p class="noindent" ><i>[Function]</i><a 
 id="dx113-235003"></a><a 
 id="x113-235004r553"></a><b> hash-table-rehash-size</b>  <i>hash-table</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx113-235005"></a><a 
 id="x113-235006r554"></a><b> hash-table-rehash-threshold</b>  <i>hash-table</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx113-235007"></a><a 
 id="x113-235008r555"></a><b> hash-table-size</b>  <i>hash-table</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx113-235009"></a><a 
 id="x113-235010r556"></a><b> hash-table-test</b>  <i>hash-table</i>
<!--l. 515--><p class="noindent" >X3J13 voted in March 1989 <a 
 id="dx113-235011"></a>to add four accessor functions that return values
suitable for use in a call to <a 
href="#x113-234002r545">make-hash-table</a> in order to produce a new hash
table with state corresponding to the current state of the argument hash
table.
<!--l. 521--><p class="indent" >   <a 
href="#x113-235004r553">hash-table-rehash-size</a> returns the current rehash size of a hash table.
<!--l. 523--><p class="indent" >   <a 
href="#x113-235006r554">hash-table-rehash-threshold</a> returns the current rehash threshold.
<!--l. 525--><p class="indent" >   <a 
href="#x113-235008r555">hash-table-size</a> returns the current size of a hash table.
<!--l. 527--><p class="indent" >   <a 
href="#x113-235010r556">hash-table-test</a> returns the test used for comparing keys. If the test is one of
the standard test functions, then the result will always be a symbol, even if the
function itself was speciﬁed when the <i>hash-table</i> was created. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-test (make-hash-table :test #&#x2019;equal))  ⇒ equal
</td></tr></table>
<!--l. 533--><p class="indent" >
</div>
</div>
<!--l. 534--><p class="noindent" >Implementations that extend <a 
href="#x113-234002r545">make-hash-table</a> by providing additional possibilities for
the :test argument may determine how the value returned by <a 
href="#x113-235010r556">hash-table-test</a> is
related to such additional tests.
<!--l. 538--><p class="indent" >   Добавлены функции, которые возвращают значения используемые при
вызове <a 
href="#x113-234002r545">make-hash-table</a>.
<!--l. 541--><p class="indent" >   <a 
href="#x113-235004r553">hash-table-rehash-size</a> возвращает размер приращения хеш-таблицы.
<!--l. 543--><p class="indent" >   <a 
href="#x113-235006r554">hash-table-rehash-threshold</a> возвращает текущий уровень заполнения.
<!--l. 545--><p class="indent" >   <a 
href="#x113-235008r555">hash-table-size</a> возвращает рекомендуемый размер хеш-таблицы.
<!--l. 547--><p class="indent" >   <a 
href="#x113-235010r556">hash-table-test</a> возвращает функцию сравнения используемую для ключей.
Если данная функция одна из стандартных, то результат всегда является
символом, даже если при создании хеш-таблицы было указано иное.
Например: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-test (make-hash-table :test #&#x2019;equal))  ⇒ equal
</td></tr></table>
                                                                          

                                                                          
<!--l. 552--><p class="indent" >
</div>
</div>
<!--l. 553--><p class="noindent" >Реализации, которые расширяют <a 
href="#x113-234002r545">make-hash-table</a> дополнительными функциями
сравнения для аргумента :test, могут определять, как будет возвращено
значение из <a 
href="#x113-235010r556">hash-table-test</a> для этих дополнительных функций.
</div>
</div>
                                                                          

                                                                          
   <!--l. 559--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse93.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#tailclmch16.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse92.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#clmse92.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 559--><p class="indent" >   <a 
 id="tailclmse92.html"></a>  
</body></html> 
