<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Establishing New Variable Bindings Установка новых связываний
переменных</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-10 13:43:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 2808--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse40.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html#tailclmse38.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse39.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse39.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">7.5   </span> <a 
 id="x51-1060007.5"></a>Establishing New Variable Bindings Установка новых связываний
переменных</h3>
<!--l. 2811--><p class="noindent" >During the invocation of a function represented by a lambda-expression (or a
closure of a lambda-expression, as produced by <a 
href="clmse35.html#x47-88006r54">function</a>), new bindings are
established for the variables that are the parameters of the lambda-expression.
These bindings initially have values determined by the parameter-binding protocol
discussed in section <a 
href="clmse29.html#x39-670005.2.2">5.2.2<!--tex4ht:ref: LAMBDA-EXPRESSIONS-SECTION --></a>.
<!--l. 2819--><p class="indent" >   В течение вызова функции представленной лямбда-выражением (или
замыканием лямбда-выражения возвращенным функцией <a 
href="clmse35.html#x47-88006r54">function</a>),
для переменных параметров лямбда-выражения устанавливаются
новые связывания. Эти связывания первоначально имеют значения
установленные с помощью протокола связывания параметров, описанного
в <a 
href="clmse29.html#x39-670005.2.2">5.2.2<!--tex4ht:ref: LAMBDA-EXPRESSIONS-SECTION --></a>.
<!--l. 2825--><p class="indent" >   The following constructs may also be used to establish bindings of variables,
both ordinary and functional.
<!--l. 2828--><p class="indent" >   Для установки связываний переменных, обычных и функциональных,
также полезны следующие конструкции.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> let </b><a 
 id="dx51-106001"></a><a 
 id="x51-106002r83"></a> ( {var | (var value)}* )  {declaration}*  { form}*
</td></tr></table>
<!--l. 2833--><p class="indent" >
</div>
<!--l. 2833--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1070007.5"></a></span>
                                                                          

                                                                          
   A <a 
href="#x51-107003r84">let</a> form can be used to execute a series of forms with speciﬁed variables
bound to speciﬁed values.
<!--l. 2837--><p class="indent" >   Форма <a 
href="#x51-107003r84">let</a> может быть использована для связи множества переменных со
значениями соответствующего множества форм.
<!--l. 2840--><p class="indent" >   More precisely, the form <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((<i>var1</i> <i>value1</i>)
</td></tr></table>
<!--l. 2842--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>var2</i> <i>value2</i>)</td></tr></table>
<!--l. 2843--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 2844--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>varm</i> <i>valuem</i>))</td></tr></table>
<!--l. 2845--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration1</i></td></tr></table>
<!--l. 2846--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration2</i></td></tr></table>
<!--l. 2847--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2848--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declarationp</i></td></tr></table>
<!--l. 2849--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body1</i></td></tr></table>
<!--l. 2850--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body2</i></td></tr></table>
<!--l. 2851--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2852--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>bodyn</i>)</td></tr></table>
<!--l. 2854--><p class="indent" >
</div>
</div>
<!--l. 2855--><p class="noindent" >ﬁrst evaluates the expressions <i>value1</i>, <i>value2</i>, and so on, in that order, saving the
resulting values. Then all of the variables <i>varj</i> are bound to the corresponding
values in parallel; each binding will be a lexical binding unless there is a special
declaration to the contrary. The expressions <i>bodyk</i> are then evaluated in order;
the values of all but the last are discarded (that is, the body of a <a 
href="#x51-107003r84">let</a>
form is an implicit <a 
href="clmse38.html#x50-102002r80">progn</a>). The <a 
href="#x51-107003r84">let</a> form returns what evaluating <i>bodyn</i>
produces (if the body is empty, which is fairly useless, <a 
href="#x51-107003r84">let</a> returns <a 
href="clmse31.html#x42-77002r19">nil</a> as its
value). The bindings of the variables have lexical scope and indeﬁnite
extent.
<!--l. 2867--><p class="indent" >   Если быть точнее, форма <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((<i>var1</i> <i>value1</i>)
</td></tr></table>
<!--l. 2869--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>var2</i> <i>value2</i>)</td></tr></table>
                                                                          

                                                                          
<!--l. 2870--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 2871--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>varm</i> <i>valuem</i>))</td></tr></table>
<!--l. 2872--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration1</i></td></tr></table>
<!--l. 2873--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration2</i></td></tr></table>
<!--l. 2874--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2875--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declarationp</i></td></tr></table>
<!--l. 2876--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body1</i></td></tr></table>
<!--l. 2877--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body2</i></td></tr></table>
<!--l. 2878--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2879--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>bodyn</i>)</td></tr></table>
<!--l. 2881--><p class="indent" >
</div>
</div>
<!--l. 2882--><p class="noindent" >сначала последовательно выполняет выражения <i>value1</i>, <i>value2</i> и т.д., сохраняя
результаты. Затем все переменные <i>varj</i> параллельно привязываются к
сохраненным значениям. Каждое связывание будет является лексическим,
кроме тех, для которых указана декларация special. Затем последовательно
выполняются выражения <i>bodyk</i>. Все из значения, кроме последнего,
игнорируются (другими словами, тело <a 
href="#x51-107003r84">let</a> является неявным <a 
href="clmse38.html#x50-102002r80">progn</a>). Форма
<a 
href="#x51-107003r84">let</a> возвращает значение <i>bodyn</i> (если тело пустое, что в принципе бесполезно,
то <a 
href="#x51-107003r84">let</a> возвращает <a 
href="clmse31.html#x42-77002r19">nil</a>). Связывания переменных имеют лексическую область
видимости и неограниченную продолжительность.
<!--l. 2895--><p class="indent" >   Instead of a list (<i>varj</i> <i>valuej</i>), one may write simply <i>varj</i>. In this case <i>varj</i> is
initialized to <a 
href="clmse31.html#x42-77002r19">nil</a>. As a matter of style, it is recommended that <i>varj</i> be written only
when that variable will be stored into (such as by <a 
href="clmse35.html#x47-90002r61">setq</a>) before its ﬁrst use. If it is
important that the initial value be <a 
href="clmse31.html#x42-77002r19">nil</a> rather than some undeﬁned value, then it is
clearer to write out (<i>varj</i> <a 
href="clmse31.html#x42-77002r19">nil</a>) if the initial value is intended to mean “false,” or
(<i>varj</i> &#x2019;()) if the initial value is intended to be an empty list. Note that the code <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let (x)
</td></tr></table>
<!--l. 2905--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (integer x))</td></tr></table>
<!--l. 2906--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setq x (gcd y z))</td></tr></table>
<!--l. 2907--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 2909--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 2910--><p class="noindent" >is incorrect; although x is indeed set before it is used, and is set to a value of the
declared type integer, nevertheless x momentarily takes on the value <a 
href="clmse31.html#x42-77002r19">nil</a> in
violation of the type declaration.
<!--l. 2915--><p class="indent" >   Вместо списка (<i>varj</i> <i>valuej</i>), можно записать просто <i>varj</i>. В таком
случае <i>varj</i> инициализируется значением <a 
href="clmse31.html#x42-77002r19">nil</a>. В целях хорошего стиля
рекомендуется, записывать <i>varj</i> только, если в нее будет что-нибудь записано
(с помощью <a 
href="clmse35.html#x47-90002r61">setq</a> например), перед первым использованием. Если важно,
чтобы первоначальное значение было <a 
href="clmse31.html#x42-77002r19">nil</a>, вместо некоторого неопределенного
значения, тогда будет лучше записть (<i>varj</i> <a 
href="clmse31.html#x42-77002r19">nil</a>) или (<i>varj</i> &#x2019;()), если
значение должно обозначать пустой список. Обратите внимание, что код <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let (x)
</td></tr></table>
<!--l. 2926--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (integer x))</td></tr></table>
<!--l. 2927--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setq x (gcd y z))</td></tr></table>
<!--l. 2928--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 2930--><p class="indent" >
</div>
</div>
<!--l. 2931--><p class="noindent" >неправильный. Так как <i>x</i> объявлен без первоначального значения и также
объявлено, что <i>x</i> это целое число, то произойдет исключение, так как <i>x</i> при
связывании получает <a 
href="clmse31.html#x42-77002r19">nil</a> значение, которое не принадлежит целочисленному
типу.
<!--l. 2936--><p class="indent" >   Declarations may appear at the beginning of the body of a <a 
href="#x51-107003r84">let</a>. See
<a 
href="clmse51.html#x65-167003r153">declare</a>.
<!--l. 2939--><p class="indent" >   Декларации могут использоваться в начале тела <a 
href="#x51-107003r84">let</a>. Смотрите
<a 
href="clmse51.html#x65-167003r153">declare</a>.
<div class=newer>
<!--l. 2942--><p class="indent" >   See also <a 
href="clmse48.html#x61-160003r141">destructuring-bind</a>. Смотрите также <a 
href="clmse48.html#x61-160003r141">destructuring-bind</a>.
</div>
<div class=new>
<!--l. 2947--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx51-107001"></a>to regularize the binding formats for <a 
href="clmse142.html#x173-366002r881">do</a>, <a 
href="clmse42.html#x54-132005r110">do*</a>, <a 
href="#x51-107003r84">let</a>,
<a 
href="#x51-109003r86">let*</a>, <a 
href="clmse42.html#x54-139002r120">prog</a>, <a 
href="clmse42.html#x54-139004r121">prog*</a>, and <a 
href="#x51-111003r88">compiler-let</a>. The new syntactic deﬁnition for <a 
href="#x51-107003r84">let</a> makes the
<i>value</i> optional:
                                                                          

                                                                          
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> let </b><a 
 id="dx51-107002"></a><a 
 id="x51-107003r84"></a> ( {var | (var [value])}* )  {declaration}*  { form}*
</td></tr></table>
<!--l. 2955--><p class="indent" >
</div>
<!--l. 2955--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1080007.5"></a></span>
   This changes <a 
href="#x51-107003r84">let</a> to allow a list (<i>var</i>) to appear, meaning the same as simply
<i>var</i>.
</div>
</div>
</div>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> let* </b><a 
 id="dx51-108001"></a><a 
 id="x51-108002r85"></a> ( {var | (var value)}* )  {declaration}*  { form}*
</td></tr></table>
<!--l. 2964--><p class="indent" >
</div>
<!--l. 2964--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1090007.5"></a></span>
   <a 
href="#x51-109003r86">let*</a> is similar to <a 
href="#x51-107003r84">let</a>, but the bindings of variables are performed sequentially
rather than in parallel. This allows the expression for the value of a variable to
refer to variables previously bound in the <a 
href="#x51-109003r86">let*</a> form.
<!--l. 2970--><p class="indent" >   <a 
href="#x51-109003r86">let*</a> похожа на <a 
href="#x51-107003r84">let</a>, но связывания переменных осуществляются
последовательно, а не параллельно. Это позволяет выражениям для значений
переменных ссылаться на ранее связанные переменные.
<!--l. 2974--><p class="indent" >   More precisely, the form <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let* ((<i>var1</i> <i>value1</i>)
</td></tr></table>
<!--l. 2976--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (<i>var2</i> <i>value2</i>)</td></tr></table>
<!--l. 2977--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       ...</td></tr></table>
<!--l. 2978--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (<i>varm</i> <i>valuem</i>))</td></tr></table>
<!--l. 2979--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration1</i></td></tr></table>
<!--l. 2980--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration2</i></td></tr></table>
<!--l. 2981--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2982--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declarationp</i></td></tr></table>
<!--l. 2983--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body1</i></td></tr></table>
<!--l. 2984--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body2</i></td></tr></table>
<!--l. 2985--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2986--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>bodyn</i>)</td></tr></table>
<!--l. 2988--><p class="indent" >
</div>
</div>
<!--l. 2989--><p class="noindent" >ﬁrst evaluates the expression <i>value1</i>, then binds the variable <i>var1</i> to that value; then
it evaluates <i>value2</i> and binds <i>var2</i>; and so on. The expressions <i>bodyj</i> are then
evaluated in order; the values of all but the last are discarded (that is, the body of
a <a 
href="#x51-109003r86">let*</a> form is an implicit <a 
href="clmse38.html#x50-102002r80">progn</a>). The <a 
href="#x51-109003r86">let*</a> form returns the results of evaluating
<i>bodyn</i> (if the body is empty, which is fairly useless, <a 
href="#x51-109003r86">let*</a> returns <a 
href="clmse31.html#x42-77002r19">nil</a> as its
value). The bindings of the variables have lexical scope and indeﬁnite
extent.
<!--l. 2999--><p class="indent" >   Если точнее, форма <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let* ((<i>var1</i> <i>value1</i>)
</td></tr></table>
<!--l. 3001--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (<i>var2</i> <i>value2</i>)</td></tr></table>
<!--l. 3002--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       ...</td></tr></table>
<!--l. 3003--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (<i>varm</i> <i>valuem</i>))</td></tr></table>
<!--l. 3004--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration1</i></td></tr></table>
<!--l. 3005--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration2</i></td></tr></table>
<!--l. 3006--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 3007--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declarationp</i></td></tr></table>
<!--l. 3008--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body1</i></td></tr></table>
                                                                          

                                                                          
<!--l. 3009--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body2</i></td></tr></table>
<!--l. 3010--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 3011--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>bodyn</i>)</td></tr></table>
<!--l. 3013--><p class="indent" >
</div>
</div>
<!--l. 3014--><p class="noindent" >сначала вычисляет выражение <i>value1</i>, затем с этим значением связывает
переменную <i>var1</i>, затем вычисляет <i>value2</i> и связывает с результатом
переменную <i>var2</i>, и так далее. Затем последовательно вычисляются выражения
<i>bodyj</i>. Значения всех выражений, кроме последнего, игнорируются. То есть
тело формы <a 
href="#x51-109003r86">let*</a> является неявным <a 
href="clmse38.html#x50-102002r80">progn</a>. Форма <a 
href="#x51-109003r86">let*</a> возвращает результаты
вычисления <i>bodyn</i> (если тело пустое, что, впринципе, бесполезно, <a 
href="#x51-109003r86">let*</a>
возвращает <a 
href="clmse31.html#x42-77002r19">nil</a>). Связывания переменных имеют лексическую область
видимости и неограниченную продолжительность.
<!--l. 3024--><p class="indent" >   Instead of a list (<i>varj</i> <i>valuej</i>), one may write simply <i>varj</i>. In this case <i>varj</i> is
initialized to <a 
href="clmse31.html#x42-77002r19">nil</a>. As a matter of style, it is recommended that <i>varj</i> be written only
when that variable will be stored into (such as by <a 
href="clmse35.html#x47-90002r61">setq</a>) before its ﬁrst use. If it is
important that the initial value be <a 
href="clmse31.html#x42-77002r19">nil</a> rather than some undeﬁned value,
then it is clearer to write out (<i>varj</i> <a 
href="clmse31.html#x42-77002r19">nil</a>) if the initial value is intended to
mean “false,” or (<i>varj</i> &#x2019;()) if the initial value is intended to be an empty
list.
<!--l. 3034--><p class="indent" >   Вместо списка (<i>varj</i> <i>valuej</i>), можно записать просто <i>varj</i>. В таком случае
<i>varj</i> будет инициализирована в <a 
href="clmse31.html#x42-77002r19">nil</a>. В целях стиля, рекомендуется
записывать <i>varj</i>, только ей будет что-нибудь присвоено с помощью <a 
href="clmse35.html#x47-90002r61">setq</a>
перед первым использованием. Если необходимо инициализировать
переменную значением <a 
href="clmse31.html#x42-77002r19">nil</a>, а не неопределенным, лучше писать (<i>varj</i> <a 
href="clmse31.html#x42-77002r19">nil</a>) для
инициализации «ложью» или (<i>varj</i> &#x2019;()) для инициализации пустым
списком.
<!--l. 3044--><p class="indent" >   Declarations may appear at the beginning of the body of a <a 
href="#x51-109003r86">let*</a>. See
<a 
href="clmse51.html#x65-167003r153">declare</a>.
<!--l. 3047--><p class="indent" >   В начале тела let* могут использоваться декларации. Смотрите
<a 
href="clmse51.html#x65-167003r153">declare</a>.
<div class=new>
<!--l. 3050--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx51-109001"></a>to regularize the binding formats for <a 
href="clmse142.html#x173-366002r881">do</a>, <a 
href="clmse42.html#x54-132005r110">do*</a>, <a 
href="#x51-107003r84">let</a>,
<a 
href="#x51-109003r86">let*</a>, <a 
href="clmse42.html#x54-139002r120">prog</a>, <a 
href="clmse42.html#x54-139004r121">prog*</a>, and <a 
href="#x51-111003r88">compiler-let</a>. The new syntactic deﬁnition for <a 
href="#x51-109003r86">let*</a> makes the
<i>value</i> optional:
<div class=defmac>
                                                                          

                                                                          
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> let* </b><a 
 id="dx51-109002"></a><a 
 id="x51-109003r86"></a> ( {var | (var [value])}* )  {declaration}*  { form}*
</td></tr></table>
<!--l. 3058--><p class="indent" >
</div>
<!--l. 3058--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1100007.5"></a></span>
   This changes <a 
href="#x51-109003r86">let*</a> to allow a list (<i>var</i>) to appear, meaning the same as simply
<i>var</i>.
</div>
</div>
</div>
<div class=obsolete>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> compiler-let </b><a 
 id="dx51-110001"></a><a 
 id="x51-110002r87"></a> ( {var | (var value)}* )  { form}*
</td></tr></table>
<!--l. 3068--><p class="indent" >
</div>
<!--l. 3068--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1110007.5"></a></span>
   When executed by the Lisp interpreter, <a 
href="#x51-111003r88">compiler-let</a> behaves exactly like <a 
href="#x51-107003r84">let</a>
with all the variable bindings implicitly declared special. When the compiler
processes this form, however, no code is compiled for the bindings; instead,
the processing of the body by the compiler (including, in particular, the
expansion of any macro calls within the body) is done with the special
variables bound to the indicated values <i>in the execution context of the
compiler</i>. This is primarily useful for communication among complicated
macros.
                                                                          

                                                                          
<!--l. 3080--><p class="indent" >   Declarations may <i>not</i> appear at the beginning of the body of a <a 
href="#x51-111003r88">compiler-let</a>.
<div class=rationale>
<!--l. 3084--><p class="noindent" ><b>Rationale:</b> Because of the unorthodox handling by <a 
href="#x51-111003r88">compiler-let</a> of its variable bindings,
it would be complicated and confusing to permit declarations that apparently referred to
the variables bound by <a 
href="#x51-111003r88">compiler-let</a>. Disallowing declarations eliminates the
problem.
</div>
<!--l. 3093--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx51-111001"></a>to regularize the binding formats for <a 
href="clmse142.html#x173-366002r881">do</a>, <a 
href="clmse42.html#x54-132005r110">do*</a>, <a 
href="#x51-107003r84">let</a>,
<a 
href="#x51-109003r86">let*</a>, <a 
href="clmse42.html#x54-139002r120">prog</a>, <a 
href="clmse42.html#x54-139004r121">prog*</a>, and <a 
href="#x51-111003r88">compiler-let</a>. The new syntactic deﬁnition for <a 
href="#x51-111003r88">compiler-let</a>
makes the <i>value</i> optional:
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> compiler-let </b><a 
 id="dx51-111002"></a><a 
 id="x51-111003r88"></a> ( {var | (var [value])}* )  { form}*
</td></tr></table>
<!--l. 3101--><p class="indent" >
</div>
<!--l. 3101--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1120007.5"></a></span>
   This changes <a 
href="#x51-111003r88">compiler-let</a> to allow a list (<i>var</i>) to appear, meaning the same as
simply <i>var</i>.
</div>
</div>
</div>
<div class=newer>
<!--l. 3109--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx51-112001"></a>to remove <a 
href="#x51-111003r88">compiler-let</a> from the language. Many
uses of <a 
href="#x51-111003r88">compiler-let</a> can be replaced with more portable code that uses <a 
href="#x51-114010r95">macrolet</a> or
<a 
href="#x51-115002r96">symbol-macrolet</a>.
</div>
<div class=defspec>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> progv </b><a 
 id="dx51-112002"></a><a 
 id="x51-112003r89"></a> symbols values  { form}*
</td></tr></table>
<!--l. 3119--><p class="indent" >
</div>
<!--l. 3119--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1130007.5"></a></span>
   <a 
href="#x51-112003r89">progv</a> is a special form that allows binding one or more dynamic variables
whose names may be determined at run time. The sequence of forms (an
implicit <a 
href="clmse38.html#x50-102002r80">progn</a>) is evaluated with the dynamic variables whose names are
in the list <i>symbols</i> bound to corresponding values from the list <i>values</i>.
(If too few values are supplied, the remaining symbols are bound and
then made to have no value; see <a 
href="clmse35.html#x47-92006r64">makunbound</a>. If too many values are
supplied, the excess values are ignored.) The results of the <a 
href="#x51-112003r89">progv</a> form
are those of the last <i>form</i>. The bindings of the dynamic variables are
undone on exit from the <a 
href="#x51-112003r89">progv</a> form. The lists of symbols and values
are computed quantities; this is what makes <a 
href="#x51-112003r89">progv</a> diﬀerent from, for
example, <a 
href="#x51-107003r84">let</a>, where the variable names are stated explicitly in the program
text.
<!--l. 3135--><p class="indent" >   <a 
href="#x51-112003r89">progv</a> is particularly useful for writing interpreters for languages embedded in
Lisp; it provides a handle on the mechanism for binding dynamic variables.
<!--l. 3139--><p class="indent" >   <a 
href="#x51-112003r89">progv</a> является специальной формой, которая позволяет создавать
связывания одной и более динамических переменных, чьи имена
устанавливаются во время выполнения. Последовательность форм (неявный
<a 
href="clmse38.html#x50-102002r80">progn</a>) выполняется с динамическими переменными, что имена в списке
<i>symbols</i> связаны с соответствующими значениями в списке <i>values</i>. (Если
значений меньше, чем переменных, то соотвествующие переменные получают
соотвествующие значения, а оставшиеся остаются без значений. Смотрите
<a 
href="clmse35.html#x47-92006r64">makunbound</a>. Если значений больше, чем переменных, они игнорируются.)
Результатом <a 
href="#x51-112003r89">progv</a> является результат последней формы. Связывания
динамических переменных упраздняются при выходе из формы <a 
href="#x51-112003r89">progv</a>.
Списки переменных и значений это вычисляемые значения. Это то, что
отличает <a 
href="#x51-112003r89">progv</a> от, например, <a 
href="#x51-107003r84">let</a>, в которой именя переменных указываются
явно в тексте программы.
<!--l. 3153--><p class="indent" >   <a 
href="#x51-112003r89">progv</a> полезна, в частности, для написания интерпертаторов языков
встраиваемых в Lisp. Она предоставляет управление механизмом связывания
динамических переменных.
</div>
                                                                          

                                                                          
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> ﬂet </b><a 
 id="dx51-113001"></a><a 
 id="x51-113002r90"></a> ( {(name lambda-list
</td></tr></table>
<!--l. 3160--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> [[ {declaration}*  | doc-string]]  { form}* )}* )</td></tr></table>
<!--l. 3161--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> { form}* </td></tr></table>
<!--l. 3161--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Special form]</i><b> labels </b><a 
 id="dx51-113003"></a><a 
 id="x51-113004r91"></a> ( {(name lambda-list</td></tr></table>
<!--l. 3163--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> [[ {declaration}*  | doc-string]]  { form}* )}* )</td></tr></table>
<!--l. 3164--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> { form}* </td></tr></table>
<!--l. 3164--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Special form]</i><b> macrolet </b><a 
 id="dx51-113005"></a><a 
 id="x51-113006r92"></a> ( {(name varlist</td></tr></table>
<!--l. 3166--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> [[ {declaration}*  | doc-string]]  { form}* )}* )</td></tr></table>
<!--l. 3167--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> { form}* </td></tr></table>
<!--l. 3168--><p class="indent" >
</div>
<!--l. 3168--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1140007.5"></a></span>
   <a 
href="#x51-114006r93">ﬂet</a> may be used to deﬁne locally named functions. Within the body of the <a 
href="#x51-114006r93">ﬂet</a>
form, function names matching those deﬁned by the <a 
href="#x51-114006r93">ﬂet</a> refer to the locally
deﬁned functions rather than to the global function deﬁnitions of the same
name.
<!--l. 3174--><p class="indent" >   Any number of functions may be simultaneously deﬁned. Each deﬁnition is
similar in format to a <a 
href="clmse30.html#x40-69002r13">defun</a> form: ﬁrst a name, then a parameter list (which may
contain &#x0026;optional, &#x0026;rest, or &#x0026;key parameters), then optional declarations and
documentation string, and ﬁnally a body. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ﬂet ((safesqrt (x) (sqrt (abs x))))
</td></tr></table>
<!--l. 3180--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ;; The safesqrt function is used in two places.</td></tr></table>
<!--l. 3181--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (safesqrt (apply #&#x2019;+ (map &#x2019;list #&#x2019;safesqrt longlist))))</td></tr></table>
<!--l. 3183--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 3185--><p class="indent" >   <a 
href="#x51-114006r93">ﬂet</a> может быть использована для определения локальных именованных
функций. Внутри тела формы <a 
href="#x51-114006r93">ﬂet</a>, имена функций, совпадающие с именами
определенными в <a 
href="#x51-114006r93">ﬂet</a>, ссылаются на локально определенные функции, а не на
глобальные определения функции с теми же именами.
<!--l. 3190--><p class="indent" >   Может быть определено любое количество функций. Каждое определение
осуществляется формате, как в форме <a 
href="clmse30.html#x40-69002r13">defun</a>: сначала имя, затем список
параметров (который может содержать &#x0026;optional, &#x0026;rest или &#x0026;key
параметры), затем необязательные декларации и строка документации, и,
наконец, тело. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ﬂet ((safesqrt (x) (sqrt (abs x))))
</td></tr></table>
<!--l. 3196--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ;; Функция safesqrt используется в двух местах.</td></tr></table>
<!--l. 3197--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (safesqrt (apply #&#x2019;+ (map &#x2019;list #&#x2019;safesqrt longlist))))</td></tr></table>
<!--l. 3199--><p class="indent" >
</div>
</div>
<!--l. 3202--><p class="indent" >   The <a 
href="#x51-114008r94">labels</a> construct is identical in form to the <a 
href="#x51-114006r93">ﬂet</a> construct. These constructs
diﬀer in that the scope of the deﬁned function names for <a 
href="#x51-114006r93">ﬂet</a> encompasses only the
body, whereas for <a 
href="#x51-114008r94">labels</a> it encompasses the function deﬁnitions themselves.
That is, <a 
href="#x51-114008r94">labels</a> can be used to deﬁne mutually recursive functions, but
<a 
href="#x51-114006r93">ﬂet</a> cannot. This distinction is useful. Using <a 
href="#x51-114006r93">ﬂet</a> one can locally redeﬁne
a global function name, and the new deﬁnition can refer to the global
deﬁnition; the same construction using <a 
href="#x51-114008r94">labels</a> would not have that eﬀect. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun integer-power (n k)       ;A highly &#x0022;bummed&#x0022; integer
</td></tr></table>
<!--l. 3212--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (integer n))          ; exponentiation routine</td></tr></table>
<!--l. 3213--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (type (integer 0 *) k))</td></tr></table>
<!--l. 3214--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (labels ((expt0 (x k a)</td></tr></table>
<!--l. 3215--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (declare (integer x a) (type (integer 0 *) k))</td></tr></table>
<!--l. 3216--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (cond ((zerop k) a)</td></tr></table>
<!--l. 3217--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))</td></tr></table>
<!--l. 3218--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   (t (expt0 (* x x) (ﬂoor k 2) (* x a)))))</td></tr></table>
<!--l. 3219--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           (expt1 (x k a)</td></tr></table>
                                                                          

                                                                          
<!--l. 3220--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (declare (integer x a) (type (integer 1 *) k))</td></tr></table>
<!--l. 3221--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (cond ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))</td></tr></table>
<!--l. 3222--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   (t (expt0 (* x x) (ﬂoor k 2) (* x a))))))</td></tr></table>
<!--l. 3223--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (expt0 n k 1)))</td></tr></table>
<!--l. 3225--><p class="indent" >
</div>
</div>
<!--l. 3227--><p class="indent" >   Конструкция <a 
href="#x51-114008r94">labels</a> идентична по форме конструкции <a 
href="#x51-114006r93">ﬂet</a>. Эти
конструкции различаются в том, что область видимости определенных
функций для <a 
href="#x51-114006r93">ﬂet</a> заключена только в теле, тогда как видимость в <a 
href="#x51-114008r94">labels</a>
охватывает даже определения этих функций. Это значит, что <a 
href="#x51-114008r94">labels</a> может
быть использована для определения взаимно рекурсивных функций, а <a 
href="#x51-114006r93">ﬂet</a> не
может. Это различие бывает полезно. Использование <a 
href="#x51-114006r93">ﬂet</a> может локально
переопределить глобальную функцию, и новое определение может ссылаться
на глобальное. Однако такая же конструкция <a 
href="#x51-114008r94">labels</a> не будет обладать этим
свойством. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun integer-power (n k)       ; Быстрое возведение
</td></tr></table>
<!--l. 3237--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (integer n))          ; целого числа в степень</td></tr></table>
<!--l. 3238--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (type (integer 0 *) k))</td></tr></table>
<!--l. 3239--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (labels ((expt0 (x k a)</td></tr></table>
<!--l. 3240--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (declare (integer x a) (type (integer 0 *) k))</td></tr></table>
<!--l. 3241--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (cond ((zerop k) a)</td></tr></table>
<!--l. 3242--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))</td></tr></table>
<!--l. 3243--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   (t (expt0 (* x x) (ﬂoor k 2) (* x a)))))</td></tr></table>
<!--l. 3244--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           (expt1 (x k a)</td></tr></table>
<!--l. 3245--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (declare (integer x a) (type (integer 1 *) k))</td></tr></table>
<!--l. 3246--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (cond ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))</td></tr></table>
<!--l. 3247--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   (t (expt0 (* x x) (ﬂoor k 2) (* x a))))))</td></tr></table>
<!--l. 3248--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (expt0 n k 1)))</td></tr></table>
<!--l. 3250--><p class="indent" >
</div>
</div>
<!--l. 3253--><p class="indent" >   <a 
href="#x51-114010r95">macrolet</a> is similar in form to <a 
href="#x51-114006r93">ﬂet</a> but deﬁnes local macros, using the same
format used by <a 
href="clmse46.html#x59-157007r137">defmacro</a>. The names established by <a 
href="#x51-114010r95">macrolet</a> as names for macros
                                                                          

                                                                          
are lexically scoped.
<!--l. 3258--><p class="indent" >   <a 
href="#x51-114010r95">macrolet</a> похожа на форму <a 
href="#x51-114006r93">ﬂet</a>, но определяет локальные макросы,
используя тот же формат записи, что и <a 
href="clmse46.html#x59-157007r137">defmacro</a>. Имена для макросов,
установленные с помощью <a 
href="#x51-114010r95">macrolet</a>, имеют лексическую область видимости.
<div class=new>
<!--l. 3264--><p class="indent" >   I have observed that, while most Common Lisp users pronounce <a 
href="#x51-114010r95">macrolet</a> to
rhyme with “silhouette,” a small but vocal minority pronounce it to rhyme with
“Chevrolet.” A very few extremists furthermore adjust their pronunciation of <a 
href="#x51-114006r93">ﬂet</a>
similarly: they say “ﬂay.” Hey, hey! <i>Tr`es outr´e.</i>
</div>
<!--l. 3272--><p class="indent" >   Macros often must be expanded at “compile time” (more generally, at a time
before the program itself is executed), and so the run-time values of variables are
not available to macros deﬁned by <a 
href="#x51-114010r95">macrolet</a>.
<!--l. 3277--><p class="indent" >   Макросы часто должны быть раскрыты во «время компиляции» (общими
словами, во время перед тем, как сама программа будет выполнена), таким
образом, значения переменных во время выполнения не доступны для
макросов, определенных с помощью <a 
href="#x51-114010r95">macrolet</a>.
<div class=obsolete>
<!--l. 3283--><p class="indent" >   The precise rule is that the macro-expansion functions deﬁned by
<a 
href="#x51-114010r95">macrolet</a> are deﬁned in the <i>global</i> environment; lexically scoped entities that
would ordinarily be lexically apparent are not visible within the expansion
functions.
</div>
<div class=newer>
<!--l. 3290--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx51-114001"></a>to retract the previous sentence and specify that
the macro-expansion functions created by <a 
href="#x51-114010r95">macrolet</a> are deﬁned in the lexical
environment in which the <a 
href="#x51-114010r95">macrolet</a> form appears, not in the null lexical
environment. Declarations, <a 
href="#x51-114010r95">macrolet</a> deﬁnitions, and <a 
href="#x51-115002r96">symbol-macrolet</a> deﬁnitions
aﬀect code within the expansion functions in a <a 
href="#x51-114010r95">macrolet</a>, but the consequences are
undeﬁned if such code attempts to refer to any local variable or function bindings
that are visible in that lexical environment.
</div>
<!--l. 3301--><p class="indent" >   However, lexically scoped entities <i>are</i> visible within the body of the <a 
href="#x51-114010r95">macrolet</a>
form and <i>are</i> visible to the code that is the expansion of a macro call. The
following example should make this clear: <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Example of scoping in macrolet.
</td></tr></table>
<!--l. 3307--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 3308--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x ﬂag)</td></tr></table>
<!--l. 3309--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (macrolet ((fudge (z)</td></tr></table>
<!--l. 3310--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;;The parameters x and ﬂag are not accessible</td></tr></table>
<!--l. 3311--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;; at this point; a reference to ﬂag would be to</td></tr></table>
<!--l. 3312--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;; the global variable of that name.</td></tr></table>
<!--l. 3313--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ‘(if ﬂag</td></tr></table>
<!--l. 3314--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     (* ,z ,z)</td></tr></table>
<!--l. 3315--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     ,z)))</td></tr></table>
<!--l. 3316--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ;;The parameters x and ﬂag are accessible here.</td></tr></table>
<!--l. 3317--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (+ x</td></tr></table>
<!--l. 3318--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (fudge x)</td></tr></table>
<!--l. 3319--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (fudge (+ x 1)))))</td></tr></table>
<!--l. 3321--><p class="indent" >
</div>
</div>
<!--l. 3322--><p class="noindent" >The body of the <a 
href="#x51-114010r95">macrolet</a> becomes <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(+ x
</td></tr></table>
<!--l. 3324--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (if ﬂag</td></tr></table>
<!--l. 3325--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (* x x)</td></tr></table>
<!--l. 3326--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       x))</td></tr></table>
<!--l. 3327--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (if ﬂag</td></tr></table>
<!--l. 3328--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (* (+ x 1) (+ x 1))</td></tr></table>
<!--l. 3329--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (+ x 1)))</td></tr></table>
<!--l. 3331--><p class="indent" >
</div>
</div>
<!--l. 3332--><p class="noindent" >after macro expansion. The occurrences of x and ﬂag legitimately refer to the
parameters of the function foo because those parameters are visible at the site of
the macro call which produced the expansion.
<!--l. 3336--><p class="indent" >   Однако, сущности, имеющие лексическую область видимости, <i>видны</i>
внутри тела формы <a 
href="#x51-114010r95">macrolet</a> и <i>видны</i> в коде, который является результатом
раскрытия макровызова. Следующий пример должен помочь в понимании: <div class=lisp>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Пример macrolet.
</td></tr></table>
<!--l. 3340--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 3341--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x ﬂag)</td></tr></table>
<!--l. 3342--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (macrolet ((fudge (z)</td></tr></table>
<!--l. 3343--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;;Параметры x и ﬂag в данной точке</td></tr></table>
<!--l. 3344--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;; недоступны; ссылка на ﬂag была бы</td></tr></table>
<!--l. 3345--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;; одноименную глобальную переменную.</td></tr></table>
<!--l. 3346--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ‘(if ﬂag</td></tr></table>
<!--l. 3347--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     (* ,z ,z)</td></tr></table>
<!--l. 3348--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     ,z)))</td></tr></table>
<!--l. 3349--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ;;Параметры x и ﬂag доступны здесь.</td></tr></table>
<!--l. 3350--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (+ x</td></tr></table>
<!--l. 3351--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (fudge x)</td></tr></table>
<!--l. 3352--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (fudge (+ x 1)))))</td></tr></table>
<!--l. 3354--><p class="indent" >
</div>
</div>
<!--l. 3355--><p class="noindent" >Тело данного примера после разворачивания макросов превращается в <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(+ x
</td></tr></table>
<!--l. 3357--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (if ﬂag</td></tr></table>
<!--l. 3358--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (* x x)</td></tr></table>
<!--l. 3359--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       x))</td></tr></table>
<!--l. 3360--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (if ﬂag</td></tr></table>
<!--l. 3361--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (* (+ x 1) (+ x 1))</td></tr></table>
<!--l. 3362--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (+ x 1)))</td></tr></table>
<!--l. 3364--><p class="indent" >
</div>
</div>
<!--l. 3365--><p class="noindent" >x и ﬂag легитимно ссылаются на параметры функции foo, потому что эти
параметры видимы в месте макровызова.
<div class=newer>
                                                                          

                                                                          
<!--l. 3369--><p class="indent" >   X3J13 voted in March 1988 <a 
 id="dx51-114002"></a>to specify that the body of each function or
expander function deﬁned by <a 
href="#x51-114006r93">ﬂet</a>, <a 
href="#x51-114008r94">labels</a>, or <a 
href="#x51-114010r95">macrolet</a> is implicitly enclosed in a
<a 
href="clmse41.html#x53-124002r103">block</a> construct whose name is the same as the <i>name</i> of the function. Therefore
<a 
href="clmse41.html#x53-125002r104">return-from</a> may be used to exit from the function.
</div>
<div class=newer>
<!--l. 3378--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx51-114003"></a>to extend <a 
href="#x51-114006r93">ﬂet</a> and <a 
href="#x51-114008r94">labels</a> to accept any
function-name (a symbol or a list whose <i>car</i> is <a 
href="clmse36.html#x48-93002r66">setf</a>—see section <a 
href="clmse35.html#x47-860007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>) as a <i>name</i> for
a function to be locally deﬁned. In this way one can create local deﬁnitions for <a 
href="clmse36.html#x48-93002r66">setf</a>
expansion functions. (X3J13 explicitly declined to extend <a 
href="#x51-114010r95">macrolet</a> in the same
manner.)
</div>
<div class=new>
<!--l. 3387--><p class="indent" >   X3J13 voted in March 1988 <a 
 id="dx51-114004"></a>to change <a 
href="#x51-114006r93">ﬂet</a>, <a 
href="#x51-114008r94">labels</a>, and <a 
href="#x51-114010r95">macrolet</a> to allow
declarations to appear before the body. The new descriptions are therefore as
follows:
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> ﬂet </b><a 
 id="dx51-114005"></a><a 
 id="x51-114006r93"></a> ( {(name lambda-list
</td></tr></table>
<!--l. 3395--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> [[ {declaration}*  | doc-string]]  { form}* )}* )</td></tr></table>
<!--l. 3396--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  { form}* </td></tr></table>
<!--l. 3396--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i><b> labels </b><a 
 id="dx51-114007"></a><a 
 id="x51-114008r94"></a> ( {(name lambda-list</td></tr></table>
<!--l. 3398--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> [[ {declaration}*  | doc-string]]  { form}* )}* )</td></tr></table>
<!--l. 3399--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  { form}* </td></tr></table>
<!--l. 3399--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i><b> macrolet </b><a 
 id="dx51-114009"></a><a 
 id="x51-114010r95"></a> ( {(name varlist</td></tr></table>
<!--l. 3401--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> [[ {declaration}*  | doc-string]]  { form}* )}* )</td></tr></table>
<!--l. 3402--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  { form}* </td></tr></table>
<!--l. 3403--><p class="indent" >
</div>
<!--l. 3403--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1150007.5"></a></span>
   These are now syntactically more similar to such other binding forms as
<a 
href="#x51-107003r84">let</a>.
                                                                          

                                                                          
<!--l. 3407--><p class="indent" >   For <a 
href="#x51-114006r93">ﬂet</a> and <a 
href="#x51-114008r94">labels</a>, the bodies of the locally deﬁned functions are part of the
scope of pervasive declarations appearing before the main body. (This is
consistent with the treatment of initialization forms in <a 
href="#x51-107003r84">let</a>.) For <a 
href="#x51-114010r95">macrolet</a>, however,
the bodies of the locally deﬁned macro expander functions are <i>not</i> included in the
scope of pervasive declarations appearing before the main body. (This is
consistent with the rule, stated below, that the bodies of macro expander
functions are in the global environment, not the local lexical environment.) Here is
an example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ﬂet ((stretch (x) (* x *stretch-factor*))
</td></tr></table>
<!--l. 3419--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (chop (x) (- x *chop-margin*)))</td></tr></table>
<!--l. 3420--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (inline stretch chop))   ;Illegal in original Common Lisp</td></tr></table>
<!--l. 3421--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (if (&#x003E; x *chop-margin*) (stretch (chop x)) (chop (stretch x))))</td></tr></table>
<!--l. 3423--><p class="indent" >
</div>
</div>
<!--l. 3424--><p class="noindent" >X3J13 voted to permit declarations of the sort noted above.
</div>
</div>
</div>
<div class=new>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> symbol-macrolet </b><a 
 id="dx51-115001"></a><a 
 id="x51-115002r96"></a> ( {(var expansion)}* )
</td></tr></table>
<!--l. 3433--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  { form}* </td></tr></table>
<!--l. 3434--><p class="indent" >
</div>
<!--l. 3434--><p class="noindent" ><span class="paragraphHead"><a 
 id="x51-1160007.5"></a></span>
                                                                          

                                                                          
   X3J13 voted in June 1988 <a 
 id="dx51-116001"></a>to adopt the Common Lisp Object System. Part of
this proposal is a general mechanism, <a 
href="#x51-115002r96">symbol-macrolet</a>, for treating certain
variable names as if they were parameterless macro calls. This facility may be
useful independent of CLOS. X3J13 voted in March 1989 <a 
 id="dx51-116002"></a>to modify the deﬁnition
of <a 
href="#x51-115002r96">symbol-macrolet</a> substantially and also voted <a 
 id="dx51-116003"></a>to allow declarations before the
body of <a 
href="#x51-115002r96">symbol-macrolet</a> but with peculiar treatment of special and type
declarations.
<!--l. 3449--><p class="indent" >   The <i>forms</i> are executed as an implicit <a 
href="clmse38.html#x50-102002r80">progn</a> in a lexical environment that
causes every reference to any deﬁned <i>var</i> to be replaced by the corresponding
<i>expansion</i>. It is as if the reference to the <i>var</i> were a parameterless macro call; the
<i>expansion</i> is evaluated or otherwise processed in place of the reference (in
                                                                          

                                                                          
particular, the expansion form is itself subject to further expansion—this is one of
the changes <a 
 id="dx51-116004"></a>from the original deﬁnition in the CLOS proposal). Note,
however, that the names of such symbol macros occupy the name space
of variables, not the name space of functions; just as one may have a
function (or macro, or special form) and a variable with the same name
without interference, so one may have an ordinary macro (or function,
or special form) and a symbol macro with the same name. The use of
<a 
href="#x51-115002r96">symbol-macrolet</a> can therefore be shadowed by <a 
href="#x51-107003r84">let</a> or other constructs that bind
variables; <a 
href="#x51-115002r96">symbol-macrolet</a> does not substitute for all occurrences of a <i>var</i>
as a variable but only for those occurrences that would be construed as
references in the scope of a lexical binding of <i>var</i> as a variable. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(symbol-macrolet ((pollyanna &#x2019;goody))
</td></tr></table>
<!--l. 3474--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (list pollyanna (let ((pollyanna &#x2019;two-shoes)) pollyanna)))</td></tr></table>
<!--l. 3475--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ (goody two-shoes), not (goody goody)</td></tr></table>
<!--l. 3477--><p class="indent" >
</div>
</div>
<!--l. 3479--><p class="noindent" >One might think that &#x2019;goody simply replaces all occurrences of pollyanna, and so the
value of the <a 
href="#x51-107003r84">let</a> would be goody; but this is not so. A little reﬂection shows that
under this incorrect interpretation the body in expanded form would be <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(list &#x2019;goody (let ((&#x2019;goody &#x2019;two-shoes)) &#x2019;goody))
</td></tr></table>
<!--l. 3485--><p class="indent" >
</div>
</div>
<!--l. 3486--><p class="noindent" >which is syntactically malformed. The correct expanded form is <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(list &#x2019;goody (let ((pollyanna &#x2019;two-shoes)) pollyanna))
</td></tr></table>
<!--l. 3489--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 3490--><p class="noindent" >because the rebinding of pollyanna by the <a 
href="#x51-107003r84">let</a> form shadows the symbol macro
deﬁnition.
<!--l. 3493--><p class="indent" >   The <i>expansion</i> for each <i>var</i> is not evaluated at binding time but only after it
has replaced a reference to the <i>var</i>. The <a 
href="clmse36.html#x48-93002r66">setf</a> macro allows a symbol macro to be
used as a <i>place</i>, in which case its expansion is used; moreover, <a 
href="clmse35.html#x47-90002r61">setq</a> of
a variable that is really a symbol macro will be treated as if <a 
href="clmse36.html#x48-93002r66">setf</a> had
been used. The values of the last form are returned, or <a 
href="clmse31.html#x42-77002r19">nil</a> if there is no
value.
<!--l. 3501--><p class="indent" >   See <a 
href="clmse47.html#x60-159002r138">macroexpand</a> and <a 
href="clmse47.html#x60-159004r139">macroexpand-1</a>; they will expand symbol macros as well
as ordinary macros.
<!--l. 3504--><p class="indent" >   Certain <i>declarations</i> before the body are handled in a peculiar manner; see
section <a 
href="clmse51.html#x65-1670009.1">9.1<!--tex4ht:ref: DECLARE-SYNTAX-SECTION --></a>.
</div>
</div>
                                                                          

                                                                          
   <!--l. 3511--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse40.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html#tailclmse38.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse39.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse39.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 3511--><p class="indent" >   <a 
 id="tailclmse39.html"></a>  
</body></html> 
