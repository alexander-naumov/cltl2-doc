<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Establishing New Variable Bindings</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-02-22 01:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 2160--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse40.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html#tailclmse38.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse39.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse39.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">7.5   </span> <a 
 id="x51-830007.5"></a>Establishing New Variable Bindings</h3>
<!--l. 2163--><p class="noindent" >During the invocation of a function represented by a lambda-expression (or a
closure of a lambda-expression, as produced by <a 
href="clmse35.html#x47-78004r54">function</a>), new bindings are
established for the variables that are the parameters of the lambda-expression.
These bindings initially have values determined by the parameter-binding protocol
discussed in section <a 
href="clmse29.html#x39-640005.2.2">5.2.2<!--tex4ht:ref: LAMBDA-EXPRESSIONS-SECTION --></a>.
<!--l. 2171--><p class="indent" >   The following constructs may also be used to establish bindings of variables,
both ordinary and functional.
<div class=defspec>
<!--l. 2175--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> let </b> <a 
 id="dx51-83001"></a><a 
 id="x51-83002r83"></a>   ( {<i>var|(varvalue)</i>}∗ )  {<i>declaration</i>}∗  {<i>form</i>}∗
</td></tr></table>
<!--l. 2176--><p class="indent" >
</div>
   A <a 
href="#x51-83004r84">let</a> form can be used to execute a series of forms with speciﬁed variables
bound to speciﬁed values.
   More precisely, the form <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((<i>var1</i> <i>value1</i>)
</td></tr></table>
<!--l. 2182--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>var2</i> <i>value2</i>)</td></tr></table>
<!--l. 2183--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 2184--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>varm</i> <i>valuem</i>))</td></tr></table>
<!--l. 2185--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration1</i></td></tr></table>
<!--l. 2186--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration2</i></td></tr></table>
<!--l. 2187--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2188--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declarationp</i></td></tr></table>
<!--l. 2189--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body1</i></td></tr></table>
                                                                          

                                                                          
<!--l. 2190--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body2</i></td></tr></table>
<!--l. 2191--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2192--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>bodyn</i>)</td></tr></table>
<!--l. 2194--><p class="indent" >
</div>
</div>
<!--l. 2195--><p class="noindent" >ﬁrst evaluates the expressions <i>value1</i>, <i>value2</i>, and so on, in that order, saving the
resulting values. Then all of the variables <i>varj</i> are bound to the corresponding
values in parallel; each binding will be a lexical binding unless there is a special
declaration to the contrary. The expressions <i>bodyk</i> are then evaluated in order;
the values of all but the last are discarded (that is, the body of a <a 
href="#x51-83004r84">let</a>
form is an implicit <a 
href="clmse38.html#x50-82002r80">progn</a>). The <a 
href="#x51-83004r84">let</a> form returns what evaluating <i>bodyn</i>
produces (if the body is empty, which is fairly useless, <a 
href="#x51-83004r84">let</a> returns <a 
href="clmse31.html#x42-70002r19">nil</a> as its
value). The bindings of the variables have lexical scope and indeﬁnite
extent.
<!--l. 2207--><p class="indent" >   Instead of a list <i>(<i>varj</i> <i>valuej</i>)</i>, one may write simply <i>varj</i>. In this case <i>varj</i> is
initialized to <a 
href="clmse31.html#x42-70002r19">nil</a>. As a matter of style, it is recommended that <i>varj</i> be written only
when that variable will be stored into (such as by <a 
href="clmse35.html#x47-79002r61">setq</a>) before its ﬁrst use. If it is
important that the initial value be <a 
href="clmse31.html#x42-70002r19">nil</a> rather than some undeﬁned value, then it is
clearer to write out <i>(<i>varj</i> <a 
href="clmse31.html#x42-70002r19">nil</a>)</i> if the initial value is intended to mean “false,” or
<i>(<i>varj</i> &#x2019;<i>(</i><i>)</i>)</i> if the initial value is intended to be an empty list. Note that the code <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let (x)
</td></tr></table>
<!--l. 2217--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (integer x))</td></tr></table>
<!--l. 2218--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setq x (gcd y z))</td></tr></table>
<!--l. 2219--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 2221--><p class="indent" >
</div>
</div>
<!--l. 2222--><p class="noindent" >is incorrect; although x is indeed set before it is used, and is set to a value of the
declared type integer, nevertheless x momentarily takes on the value <a 
href="clmse31.html#x42-70002r19">nil</a> in
violation of the type declaration.
<!--l. 2227--><p class="indent" >   Declarations may appear at the beginning of the body of a <a 
href="#x51-83004r84">let</a>. See
<a 
href="clmse51.html#x65-104002r151">declare</a>.
                                                                          

                                                                          
<div class=newer>
<!--l. 2231--><p class="indent" >   See also <a 
href="clmse48.html#x61-100002r139">destructuring-bind</a>.
</div>
<div class=new>
<!--l. 2235--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to regularize the binding formats for <a 
href="clmse142.html#x173-249002r879">do</a>, <i>do*</i>,
<a 
href="#x51-83004r84">let</a>, <i>let*</i>, <a 
href="clmse42.html#x54-91004r118">prog</a>, <i>prog*</i>, and <a 
href="#x51-83012r88">compiler-let</a>. The new syntactic deﬁnition for <a 
href="#x51-83004r84">let</a> makes
the <i>value</i> optional:
<div class=defmac>
<!--l. 2242--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> let </b> <a 
 id="dx51-83003"></a><a 
 id="x51-83004r84"></a>   ( {<i>var|(var [<i>value</i>] )</i>}∗ )  {<i>declaration</i>}∗  {<i>form</i>}∗
</td></tr></table>
<!--l. 2243--><p class="indent" >
</div>
   This changes <a 
href="#x51-83004r84">let</a> to allow a list <i>(<i>var</i>)</i> to appear, meaning the same as simply
<i>var</i>.
</div>
</div>
</div>
<div class=defspec>
<!--l. 2251--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> let* </b> <a 
 id="dx51-83005"></a><a 
 id="x51-83006r85"></a>   ( {<i>var|(varvalue)</i>}∗ )  {<i>declaration</i>}∗  {<i>form</i>}∗
</td></tr></table>
<!--l. 2252--><p class="indent" >
</div>
   <i>let*</i> is similar to <a 
href="#x51-83004r84">let</a>, but the bindings of variables are performed sequentially
rather than in parallel. This allows the expression for the value of a variable to
refer to variables previously bound in the <i>let*</i> form.
   More precisely, the form <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let* ((<i>var1</i> <i>value1</i>)
</td></tr></table>
<!--l. 2260--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (<i>var2</i> <i>value2</i>)</td></tr></table>
<!--l. 2261--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       ...</td></tr></table>
                                                                          

                                                                          
<!--l. 2262--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (<i>varm</i> <i>valuem</i>))</td></tr></table>
<!--l. 2263--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration1</i></td></tr></table>
<!--l. 2264--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration2</i></td></tr></table>
<!--l. 2265--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2266--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declarationp</i></td></tr></table>
<!--l. 2267--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body1</i></td></tr></table>
<!--l. 2268--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body2</i></td></tr></table>
<!--l. 2269--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 2270--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>bodyn</i>)</td></tr></table>
<!--l. 2272--><p class="indent" >
</div>
</div>
<!--l. 2273--><p class="noindent" >ﬁrst evaluates the expression <i>value1</i>, then binds the variable <i>var1</i> to that value; then
it evaluates <i>value2</i> and binds <i>var2</i>; and so on. The expressions <i>bodyj</i> are then
evaluated in order; the values of all but the last are discarded (that is, the body of
a <i>let*</i> form is an implicit <a 
href="clmse38.html#x50-82002r80">progn</a>). The <i>let*</i> form returns the results of evaluating
<i>bodyn</i> (if the body is empty, which is fairly useless, <i>let*</i> returns <a 
href="clmse31.html#x42-70002r19">nil</a> as its
value). The bindings of the variables have lexical scope and indeﬁnite
extent.
<!--l. 2283--><p class="indent" >   Instead of a list <i>(<i>varj</i> <i>valuej</i>)</i>, one may write simply <i>varj</i>. In this case <i>varj</i> is
initialized to <a 
href="clmse31.html#x42-70002r19">nil</a>. As a matter of style, it is recommended that <i>varj</i> be written only
when that variable will be stored into (such as by <a 
href="clmse35.html#x47-79002r61">setq</a>) before its ﬁrst use. If it is
important that the initial value be <a 
href="clmse31.html#x42-70002r19">nil</a> rather than some undeﬁned value,
then it is clearer to write out <i>(<i>varj</i> <a 
href="clmse31.html#x42-70002r19">nil</a>)</i> if the initial value is intended to
mean “false,” or <i>(<i>varj</i> &#x2019;<i>(</i><i>)</i>)</i> if the initial value is intended to be an empty
list.
<!--l. 2293--><p class="indent" >   Declarations may appear at the beginning of the body of a <i>let*</i>. See
<a 
href="clmse51.html#x65-104002r151">declare</a>.
<div class=new>
<!--l. 2297--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to regularize the binding formats for <a 
href="clmse142.html#x173-249002r879">do</a>, <i>do*</i>,
<a 
href="#x51-83004r84">let</a>, <i>let*</i>, <a 
href="clmse42.html#x54-91004r118">prog</a>, <i>prog*</i>, and <a 
href="#x51-83012r88">compiler-let</a>. The new syntactic deﬁnition for <i>let*</i>
makes the <i>value</i> optional:
<div class=defmac>
<!--l. 2304--><p class="noindent" ><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> let* </b> <a 
 id="dx51-83007"></a><a 
 id="x51-83008r86"></a>   ( {<i>var|(var [<i>value</i>] )</i>}∗ )  {<i>declaration</i>}∗  {<i>form</i>}∗
</td></tr></table>
<!--l. 2305--><p class="indent" >
</div>
   This changes <i>let*</i> to allow a list <i>(<i>var</i>)</i> to appear, meaning the same as simply
<i>var</i>.
</div>
</div>
</div>
<div class=obsolete>
<div class=defspec>
<!--l. 2313--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> compiler-let </b> <a 
 id="dx51-83009"></a><a 
 id="x51-83010r87"></a>   ( {<i>var|(varvalue)</i>}∗ )  {<i>form</i>}∗
</td></tr></table>
<!--l. 2315--><p class="indent" >
</div>
   When executed by the Lisp interpreter, <a 
href="#x51-83012r88">compiler-let</a> behaves exactly like <a 
href="#x51-83004r84">let</a>
with all the variable bindings implicitly declared special. When the compiler
processes this form, however, no code is compiled for the bindings; instead,
the processing of the body by the compiler (including, in particular, the
expansion of any macro calls within the body) is done with the special
variables bound to the indicated values <i>in the execution context of the
compiler</i>. This is primarily useful for communication among complicated
macros.
   Declarations may <i>not</i> appear at the beginning of the body of a <a 
href="#x51-83012r88">compiler-let</a>.
<div class=rationale>
   <b>Rationale:</b> Because of the unorthodox handling by <a 
href="#x51-83012r88">compiler-let</a> of its variable
bindings, it would be complicated and confusing to permit declarations that apparently
referred to the variables bound by <a 
href="#x51-83012r88">compiler-let</a>. Disallowing declarations eliminates the
problem.
</div>
   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to regularize the binding formats for <a 
href="clmse142.html#x173-249002r879">do</a>, <i>do*</i>,
<a 
href="#x51-83004r84">let</a>, <i>let*</i>, <a 
href="clmse42.html#x54-91004r118">prog</a>, <i>prog*</i>, and <a 
href="#x51-83012r88">compiler-let</a>. The new syntactic deﬁnition for
<a 
href="#x51-83012r88">compiler-let</a> makes the <i>value</i> optional:
<div class=defmac>
   <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> compiler-let </b> <a 
 id="dx51-83011"></a><a 
 id="x51-83012r88"></a>   ( {<i>var|(var [<i>value</i>] )</i>}∗ )  {<i>form</i>}∗
</td></tr></table>
<!--l. 2348--><p class="indent" >
</div>
   This changes <a 
href="#x51-83012r88">compiler-let</a> to allow a list <i>(<i>var</i>)</i> to appear, meaning the same as
simply <i>var</i>.
</div>
</div>
</div>
<div class=newer>
<!--l. 2356--><p class="indent" >   X3J13 voted in June 1989 ⟨<b>?</b>⟩ to remove <a 
href="#x51-83012r88">compiler-let</a> from the language. Many
uses of <a 
href="#x51-83012r88">compiler-let</a> can be replaced with more portable code that uses macrolet or
<a 
href="#x51-83024r94">symbol-macrolet</a>.
</div>
<div class=defspec>
<!--l. 2365--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> progv </b> <a 
 id="dx51-83013"></a><a 
 id="x51-83014r89"></a>   symbols values  {<i>form</i>}∗
</td></tr></table>
<!--l. 2366--><p class="indent" >
</div>
   <a 
href="#x51-83014r89">progv</a> is a special form that allows binding one or more dynamic variables
whose names may be determined at run time. The sequence of forms (an
implicit <a 
href="clmse38.html#x50-82002r80">progn</a>) is evaluated with the dynamic variables whose names are
in the list <i>symbols</i> bound to corresponding values from the list <i>values</i>.
(If too few values are supplied, the remaining symbols are bound and
then made to have no value; see <a 
href="clmse35.html#x47-79008r64">makunbound</a>. If too many values are
supplied, the excess values are ignored.) The results of the <a 
href="#x51-83014r89">progv</a> form
are those of the last <i>form</i>. The bindings of the dynamic variables are
undone on exit from the <a 
href="#x51-83014r89">progv</a> form. The lists of symbols and values
are computed quantities; this is what makes <a 
href="#x51-83014r89">progv</a> diﬀerent from, for
example, <a 
href="#x51-83004r84">let</a>, where the variable names are stated explicitly in the program
text.
   <a 
href="#x51-83014r89">progv</a> is particularly useful for writing interpreters for languages embedded in
Lisp; it provides a handle on the mechanism for binding dynamic variables.
                                                                          

                                                                          
</div>
<div class=defspec>
<!--l. 2388--><p class="noindent" ><div class=tabbing>
</div>
<!--l. 2389--><p class="indent" >   }∗ ) {<i>form</i>}∗   <i>[Special form]</i><b> labels </b> <a 
 id="dx51-83017"></a><a 
 id="x51-83018r91"></a>  ( {<i>(namelambda−list [[<i> {<i>declaration</i>}∗
| doc-string
</div>]]  form*)*)  form* <br 
class="newline" />macrolet ((name varlist &#x003C;declaration* | doc-string&#x003E;  form*)*)  form*
<!--l. 2398--><p class="indent" >   ﬂet may be used to deﬁne locally named functions. Within the body of the ﬂet
form, function names matching those deﬁned by the ﬂet refer to the locally
deﬁned functions rather than to the global function deﬁnitions of the same
name.
<!--l. 2403--><p class="indent" >   Any number of functions may be simultaneously deﬁned. Each deﬁnition is
similar in format to a <a 
href="clmse30.html#x40-66002r13">defun</a> form: ﬁrst a name, then a parameter list (which may
contain <i>&#x0026;optional</i>, <i>&#x0026;rest</i>, or <i>&#x0026;key</i> parameters), then optional declarations and
documentation string, and ﬁnally a body. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ﬂet ((safesqrt (x) (sqrt (abs x))))
</td></tr></table>
<!--l. 2409--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ;; The safesqrt function is used in two places.</td></tr></table>
<!--l. 2410--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (safesqrt (apply #&#x2019;+ (map &#x2019;list #&#x2019;safesqrt longlist))))</td></tr></table>
<!--l. 2412--><p class="indent" >
</div>
</div>
<!--l. 2414--><p class="indent" >   The <a 
href="#x51-83022r93">labels</a> construct is identical in form to the ﬂet construct. These constructs
diﬀer in that the scope of the deﬁned function names for ﬂet encompasses only the
body, whereas for <a 
href="#x51-83022r93">labels</a> it encompasses the function deﬁnitions themselves.
That is, <a 
href="#x51-83022r93">labels</a> can be used to deﬁne mutually recursive functions, but
ﬂet cannot. This distinction is useful. Using ﬂet one can locally redeﬁne
a global function name, and the new deﬁnition can refer to the global
deﬁnition; the same construction using <a 
href="#x51-83022r93">labels</a> would not have that eﬀect. <div class=lisp>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun integer-power (n k)       ;A highly &#x0022;bummed&#x0022; integer
</td></tr></table>
<!--l. 2424--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (integer n))          ; exponentiation routine</td></tr></table>
<!--l. 2425--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (type (integer 0 *) k))</td></tr></table>
<!--l. 2426--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (labels ((expt0 (x k a)</td></tr></table>
<!--l. 2427--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (declare (integer x a) (type (integer 0 *) k))</td></tr></table>
<!--l. 2428--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (cond ((zerop k) a)</td></tr></table>
<!--l. 2429--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))</td></tr></table>
<!--l. 2430--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   (t (expt0 (* x x) (ﬂoor k 2) (* x a)))))</td></tr></table>
<!--l. 2431--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           (expt1 (x k a)</td></tr></table>
<!--l. 2432--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (declare (integer x a) (type (integer 1 *) k))</td></tr></table>
<!--l. 2433--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (cond ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))</td></tr></table>
<!--l. 2434--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   (t (expt0 (* x x) (ﬂoor k 2) (* x a))))))</td></tr></table>
<!--l. 2435--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (expt0 n k 1)))</td></tr></table>
<!--l. 2437--><p class="indent" >
</div>
</div>
<!--l. 2439--><p class="indent" >   macrolet is similar in form to ﬂet but deﬁnes local macros, using the same
format used by <a 
href="clmse46.html#x59-98006r135">defmacro</a>. The names established by macrolet as names for macros
are lexically scoped.
<div class=new>
<!--l. 2445--><p class="indent" >   I have observed that, while most Common Lisp users pronounce macrolet to
rhyme with “silhouette,” a small but vocal minority pronounce it to rhyme with
“Chevrolet.” A very few extremists furthermore adjust their pronunciation of ﬂet
similarly: they say “ﬂay.” Hey, hey! <i>Tr`es outr´e.</i>
</div>
<!--l. 2453--><p class="indent" >   Macros often must be expanded at “compile time” (more generally, at a time
before the program itself is executed), and so the run-time values of variables are
not available to macros deﬁned by macrolet.
<div class=obsolete>
<!--l. 2459--><p class="indent" >   The precise rule is that the macro-expansion functions deﬁned by
macrolet are deﬁned in the <i>global</i> environment; lexically scoped entities that
would ordinarily be lexically apparent are not visible within the expansion
functions.
</div>
<div class=newer>
<!--l. 2466--><p class="indent" >   X3J13 voted in March 1989 ⟨<b>?</b>⟩ to retract the previous sentence and specify
that the macro-expansion functions created by macrolet are deﬁned in the lexical
                                                                          

                                                                          
environment in which the macrolet form appears, not in the null lexical
environment. Declarations, macrolet deﬁnitions, and <a 
href="#x51-83024r94">symbol-macrolet</a> deﬁnitions
aﬀect code within the expansion functions in a macrolet, but the consequences are
undeﬁned if such code attempts to refer to any local variable or function bindings
that are visible in that lexical environment.
</div>
<!--l. 2477--><p class="indent" >   However, lexically scoped entities <i>are</i> visible within the body of the macrolet
form and <i>are</i> visible to the code that is the expansion of a macro call. The
following example should make this clear: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Example of scoping in macrolet.
</td></tr></table>
<!--l. 2483--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 2484--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x ﬂag)</td></tr></table>
<!--l. 2485--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (macrolet ((fudge (z)</td></tr></table>
<!--l. 2486--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;;The parameters x and ﬂag are not accessible</td></tr></table>
<!--l. 2487--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;; at this point; a reference to ﬂag would be to</td></tr></table>
<!--l. 2488--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;; the global variable of that name.</td></tr></table>
<!--l. 2489--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                <tt>‘</tt>(if ﬂag</td></tr></table>
<!--l. 2490--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     (* ,z ,z)</td></tr></table>
<!--l. 2491--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     ,z)))</td></tr></table>
<!--l. 2492--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ;;The parameters x and ﬂag are accessible here.</td></tr></table>
<!--l. 2493--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (+ x</td></tr></table>
<!--l. 2494--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (fudge x)</td></tr></table>
<!--l. 2495--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (fudge (+ x 1)))))</td></tr></table>
<!--l. 2497--><p class="indent" >
</div>
</div>
<!--l. 2498--><p class="noindent" >The body of the macrolet becomes <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(+ x
</td></tr></table>
<!--l. 2500--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (if ﬂag</td></tr></table>
<!--l. 2501--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (* x x)</td></tr></table>
<!--l. 2502--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       x))</td></tr></table>
<!--l. 2503--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (if ﬂag</td></tr></table>
                                                                          

                                                                          
<!--l. 2504--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (* (+ x 1) (+ x 1))</td></tr></table>
<!--l. 2505--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (+ x 1)))</td></tr></table>
<!--l. 2507--><p class="indent" >
</div>
</div>
<!--l. 2508--><p class="noindent" >after macro expansion. The occurrences of x and ﬂag legitimately refer to the
parameters of the function foo because those parameters are visible at the site of
the macro call which produced the expansion.
<div class=newer>
<!--l. 2513--><p class="indent" >   X3J13 voted in March 1988 ⟨<b>?</b>⟩ to specify that the body of each function or
expander function deﬁned by ﬂet, <a 
href="#x51-83022r93">labels</a>, or macrolet is implicitly enclosed in a
<a 
href="clmse41.html#x53-85002r101">block</a> construct whose name is the same as the <i>name</i> of the function. Therefore
<a 
href="clmse41.html#x53-85004r102">return-from</a> may be used to exit from the function.
</div>
<div class=newer>
<!--l. 2522--><p class="indent" >   X3J13 voted in March 1989 ⟨<b>?</b>⟩ to extend ﬂet and <a 
href="#x51-83022r93">labels</a> to accept any
function-name (a symbol or a list whose <i>car</i> is <a 
href="clmse36.html#x48-80002r66">setf</a>—see section <a 
href="clmse35.html#x47-770007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>) as a <i>name</i> for
a function to be locally deﬁned. In this way one can create local deﬁnitions for <a 
href="clmse36.html#x48-80002r66">setf</a>
expansion functions. (X3J13 explicitly declined to extend macrolet in the same
manner.)
</div>
<div class=new>
<!--l. 2531--><p class="indent" >   X3J13 voted in March 1988 ⟨<b>?</b>⟩ to change ﬂet, <a 
href="#x51-83022r93">labels</a>, and macrolet to allow
declarations to appear before the body. The new descriptions are therefore as
follows:
<div class=defmac>
<!--l. 2538--><p class="noindent" ><div class=tabbing>
</div>
<!--l. 2539--><p class="indent" >   }∗ )  {<i>declaration</i>}∗  {<i>form</i>}∗   <i>[Macro]</i><b> labels </b> <a 
 id="dx51-83021"></a><a 
 id="x51-83022r93"></a>
( {<i>(namelambda − list [[<i> {<i>declaration</i>}∗  | doc-string
</div>]]  form*)*) declaration*  form* <br 
class="newline" />macrolet ((name varlist &#x003C;declaration* | doc-string&#x003E;  form*)*) declaration*
form*
<!--l. 2548--><p class="indent" >   These are now syntactically more similar to such other binding forms as
<a 
href="#x51-83004r84">let</a>.
                                                                          

                                                                          
<!--l. 2551--><p class="indent" >   For ﬂet and <a 
href="#x51-83022r93">labels</a>, the bodies of the locally deﬁned functions are part of the
scope of pervasive declarations appearing before the main body. (This is
consistent with the treatment of initialization forms in <a 
href="#x51-83004r84">let</a>.) For macrolet, however,
the bodies of the locally deﬁned macro expander functions are <i>not</i> included in the
scope of pervasive declarations appearing before the main body. (This is
consistent with the rule, stated below, that the bodies of macro expander
functions are in the global environment, not the local lexical environment.) Here is
an example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ﬂet ((stretch (x) (* x *stretch-factor*))
</td></tr></table>
<!--l. 2563--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (chop (x) (- x *chop-margin*)))</td></tr></table>
<!--l. 2564--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (inline stretch chop))   ;Illegal in original Common Lisp</td></tr></table>
<!--l. 2565--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (if (&#x003E; x *chop-margin*) (stretch (chop x)) (chop (stretch x))))</td></tr></table>
<!--l. 2567--><p class="indent" >
</div>
</div>
<!--l. 2568--><p class="noindent" >X3J13 voted to permit declarations of the sort noted above.
</div>
</div>
</div>
<div class=new>
<div class=defspec>
<!--l. 2576--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> symbol-macrolet </b> <a 
 id="dx51-83023"></a><a 
 id="x51-83024r94"></a>   ( {<i>(varexpansion)</i>}∗ )  {<i>declaration</i>}∗  {<i>form</i>}∗
</td></tr></table>
<!--l. 2578--><p class="indent" >
</div>
   X3J13 voted in June 1988 ⟨<b>?</b>⟩ to adopt the Common Lisp Object System. Part
of this proposal is a general mechanism, <a 
href="#x51-83024r94">symbol-macrolet</a>, for treating certain
variable names as if they were parameterless macro calls. This facility may be
useful independent of CLOS. X3J13 voted in March 1989 ⟨<b>?</b>⟩ to modify the
deﬁnition of <a 
href="#x51-83024r94">symbol-macrolet</a> substantially and also voted ⟨<b>?</b>⟩ to allow
declarations before the body of <a 
href="#x51-83024r94">symbol-macrolet</a> but with peculiar treatment of
special and type declarations.
                                                                          

                                                                          
   The <i>forms</i> are executed as an implicit <a 
href="clmse38.html#x50-82002r80">progn</a> in a lexical environment that
causes every reference to any deﬁned <i>var</i> to be replaced by the corresponding
<i>expansion</i>. It is as if the reference to the <i>var</i> were a parameterless macro call; the
<i>expansion</i> is evaluated or otherwise processed in place of the reference (in
                                                                          

                                                                          
particular, the expansion form is itself subject to further expansion—this is one of
the changes ⟨<b>?</b>⟩ from the original deﬁnition in the CLOS proposal). Note,
however, that the names of such symbol macros occupy the name space
of variables, not the name space of functions; just as one may have a
function (or macro, or special form) and a variable with the same name
without interference, so one may have an ordinary macro (or function,
or special form) and a symbol macro with the same name. The use of
<a 
href="#x51-83024r94">symbol-macrolet</a> can therefore be shadowed by <a 
href="#x51-83004r84">let</a> or other constructs that bind
variables; <a 
href="#x51-83024r94">symbol-macrolet</a> does not substitute for all occurrences of a <i>var</i>
as a variable but only for those occurrences that would be construed as
references in the scope of a lexical binding of <i>var</i> as a variable. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(symbol-macrolet ((pollyanna &#x2019;goody))
</td></tr></table>
<!--l. 2618--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (list pollyanna (let ((pollyanna &#x2019;two-shoes)) pollyanna)))</td></tr></table>
<!--l. 2619--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ (goody two-shoes), not (goody goody)</td></tr></table>
<!--l. 2621--><p class="indent" >
</div>
</div>
<!--l. 2623--><p class="noindent" >One might think that <i>&#x2019;goody</i> simply replaces all occurrences of pollyanna, and so the
value of the <a 
href="#x51-83004r84">let</a> would be goody; but this is not so. A little reﬂection shows that
under this incorrect interpretation the body in expanded form would be <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(list &#x2019;goody (let ((&#x2019;goody &#x2019;two-shoes)) &#x2019;goody))
</td></tr></table>
<!--l. 2629--><p class="indent" >
</div>
</div>
<!--l. 2630--><p class="noindent" >which is syntactically malformed. The correct expanded form is <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(list &#x2019;goody (let ((pollyanna &#x2019;two-shoes)) pollyanna))
</td></tr></table>
<!--l. 2633--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 2634--><p class="noindent" >because the rebinding of pollyanna by the <a 
href="#x51-83004r84">let</a> form shadows the symbol macro
deﬁnition.
<!--l. 2637--><p class="indent" >   The <i>expansion</i> for each <i>var</i> is not evaluated at binding time but only after it
has replaced a reference to the <i>var</i>. The <a 
href="clmse36.html#x48-80002r66">setf</a> macro allows a symbol macro to be
used as a <i>place</i>, in which case its expansion is used; moreover, <a 
href="clmse35.html#x47-79002r61">setq</a> of
a variable that is really a symbol macro will be treated as if <a 
href="clmse36.html#x48-80002r66">setf</a> had
been used. The values of the last form are returned, or <a 
href="clmse31.html#x42-70002r19">nil</a> if there is no
value.
<!--l. 2645--><p class="indent" >   See <a 
href="clmse47.html#x60-99002r136">macroexpand</a> and <i>macroexpand-1</i>; they will expand symbol macros as well
as ordinary macros.
<!--l. 2648--><p class="indent" >   Certain <i>declarations</i> before the body are handled in a peculiar manner; see
section <a 
href="clmse51.html#x65-1040009.1">9.1<!--tex4ht:ref: DECLARE-SYNTAX-SECTION --></a>.
</div>
</div>
                                                                          

                                                                          
   <!--l. 2655--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse40.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html#tailclmse38.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse39.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse39.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 2655--><p class="indent" >   <a 
 id="tailclmse39.html"></a>  
</body></html> 
