<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Операторы условных переходов</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-30 23:01:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 5821--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse40.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html#tailclmse38.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse39.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse39.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">7.6   </span> <a 
href="clm.html#QQ2-51-112" id="x51-1050007.6">Операторы условных переходов</a></h3>
<!--l. 5823--><p class="noindent" >Традиционная условная конструкция в Lisp&#x2019;е это <tt><a 
href="#x51-108002r84">cond</a></tt>. Однако, <tt><a 
href="clmse130.html#x160-327002r793">if</a></tt>
гораздо проще и очень похожа на условные конструкции в других
языках программирования. Она сделана примитивом в Common Lisp&#x2019;е.
Common Lisp также предоставляет конструкции диспетчеризации
(распределения) <tt><a 
href="#x51-109002r85">case</a></tt> и <tt><a 
href="#x51-110002r86">typecase</a></tt>, которые часто более удобны, чем
<tt><a 
href="#x51-108002r84">cond</a></tt>.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> if </b><a 
 id="dx51-105001"></a><a 
 id="x51-105002r81"></a> test then [else]
</td></tr></table>
<!--l. 5831--><p class="indent" >
</div>
<!--l. 5831--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-1060007.6" id="x51-1060007.6"></a></span>
   Специальная формы <tt><a 
href="clmse130.html#x160-327002r793">if</a></tt> обозначает то же, что и конструкция <b>if</b>-<b>then</b>-<b>else</b>
в большинстве других языках программирования. Сначала выполняется
форма <i>test</i>. Если результат не равен <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда выбирается форма <i>then</i>.
Иначе выбирается форма <i>else</i>. Выбранная ранее форма выполняется, и <tt><a 
href="clmse130.html#x160-327002r793">if</a></tt>
возвращает то, что вернула это форма. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(if <i>test</i> <i>then</i> <i>else</i>) <span class="math"> ≡</span> (cond (<i>test</i> <i>then</i>) (<tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> <i>else</i>))
</td></tr></table>
<!--l. 5841--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 5842--><p class="noindent" >Но в некоторых ситуациях <tt><a 
href="clmse130.html#x160-327002r793">if</a></tt> оказывается более читабельным.
<!--l. 5844--><p class="indent" >   Форма <i>else</i> может быть опущена. В таком случае, если значение формы
<i>test</i> является <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда ничего не будет выполнено и возвращаемое значение
формы <tt><a 
href="clmse130.html#x160-327002r793">if</a></tt> будет <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Если в этой ситуации значение формы <tt><a 
href="clmse130.html#x160-327002r793">if</a></tt> важно, тогда
в зависимости от контекста стилистически удобнее использовать форму <tt><a 
href="clmse33.html#x44-78004r49">and</a></tt>.
Если значение не важно, тогда удобнее использовать конструкцию
<tt><a 
href="clmse130.html#x160-327004r794">when</a></tt>.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> when </b><a 
 id="dx51-106001"></a><a 
 id="x51-106002r82"></a> test  { form}*
</td></tr></table>
<!--l. 5854--><p class="indent" >
</div>
<!--l. 5854--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-1070007.6" id="x51-1070007.6"></a></span>
   <tt>(when <i>test</i> <i>form1</i> <i>form2</i> ... )</tt> сначала выполняет <i>test</i>. Если
результат <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда ничего не выполняется и возвращается <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Иначе,
последовательно выполняются формы <i>form</i> слева направо (как неявный
<tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>), и возвращается значение последней формы. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(when <i>p</i> <i>a</i> <i>b</i> <i>c</i>) <span class="math"> ≡</span> (and <i>p</i> (progn <i>a</i> <i>b</i> <i>c</i>))
</td></tr></table>
<!--l. 5862--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(when <i>p</i> <i>a</i> <i>b</i> <i>c</i>) <span class="math"> ≡</span> (cond (<i>p</i> <i>a</i> <i>b</i> <i>c</i>))</td></tr></table>
<!--l. 5863--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(when <i>p</i> <i>a</i> <i>b</i> <i>c</i>) <span class="math"> ≡</span> (if <i>p</i> (progn <i>a</i> <i>b</i> <i>c</i>) <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>)</td></tr></table>
<!--l. 5864--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(when <i>p</i> <i>a</i> <i>b</i> <i>c</i>) <span class="math"> ≡</span> (unless (not <i>p</i>) <i>a</i> <i>b</i> <i>c</i>)</td></tr></table>
<!--l. 5866--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 5867--><p class="noindent" >В целях хорошего стиля, <tt><a 
href="clmse130.html#x160-327004r794">when</a></tt> обычно используется для выполнения побочных
эффектов при некоторых условиях, и значение <tt><a 
href="clmse130.html#x160-327004r794">when</a></tt> не используется. Если
значение все-таки важно, тогда, может быть, стилистически функции <tt><a 
href="clmse33.html#x44-78004r49">and</a></tt>
или <tt><a 
href="clmse130.html#x160-327002r793">if</a></tt> более подходят.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> unless </b><a 
 id="dx51-107001"></a><a 
 id="x51-107002r83"></a> test  { form}*
</td></tr></table>
<!--l. 5875--><p class="indent" >
</div>
<!--l. 5875--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-1080007.6" id="x51-1080007.6"></a></span>
   <tt>(unless <i>test</i> <i>form1</i> <i>form2</i> ... )</tt> сначала выполняет <i>test</i>. Если
результат <i>не</i> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда ничего не выполняется и возвращается <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
Иначе, последовательно выполняются формы <i>form</i> слева направо
(как неявный <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>), и возвращается значение последней формы.
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(unless <i>p</i> <i>a</i> <i>b</i> <i>c</i>) <span class="math"> ≡</span> (cond ((not <i>p</i>) <i>a</i> <i>b</i> <i>c</i>))
</td></tr></table>
<!--l. 5883--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(unless <i>p</i> <i>a</i> <i>b</i> <i>c</i>) <span class="math"> ≡</span> (if <i>p</i> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> (progn <i>a</i> <i>b</i> <i>c</i>))</td></tr></table>
<!--l. 5884--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(unless <i>p</i> <i>a</i> <i>b</i> <i>c</i>) <span class="math"> ≡</span> (when (not <i>p</i>) <i>a</i> <i>b</i> <i>c</i>)</td></tr></table>
<!--l. 5886--><p class="indent" >
</div>
</div>
<!--l. 5887--><p class="noindent" >В целях хорошего стиля, <tt><a 
href="clmse130.html#x160-327006r795">unless</a></tt> обычно используется для выполнения побочных
эффектов при некоторых условиях, и значение <tt><a 
href="clmse130.html#x160-327006r795">unless</a></tt> не используется. Если
значение все-таки важно, тогда может быть стилистически более подходящая
функция <tt><a 
href="clmse130.html#x160-327002r793">if</a></tt>.
</div>
<div class=defmac>
                                                                          

                                                                          
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> cond </b><a 
 id="dx51-108001"></a><a 
 id="x51-108002r84"></a> {(test  { form}* )}*
</td></tr></table>
<!--l. 5895--><p class="indent" >
</div>
<!--l. 5895--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-1090007.6" id="x51-1090007.6"></a></span>
   Форма <tt><a 
href="#x51-108002r84">cond</a></tt> содержит некоторое (возможно нулевое) количество
подвыражений, которые является списками форм. Каждое подвыражение
содержит форму условия и ноль и более форм для выполнения. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(cond (<i>test-1</i> <i>consequent-1-1</i> <i>consequent-1-2</i> ...)
</td></tr></table>
<!--l. 5901--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>test-2</i>)</td></tr></table>
<!--l. 5902--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>test-3</i> <i>consequent-3-1</i> ...)</td></tr></table>
<!--l. 5903--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ... )</td></tr></table>
<!--l. 5905--><p class="indent" >
</div>
</div>
<!--l. 5907--><p class="indent" >   Отбирается первое подвыражение, чья форма условия вычисляется в
не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Все остальные подвыражения игнорируются. Формы отобранного
подвыражения последовательно выполняются (как неявный <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>).
<!--l. 5911--><p class="indent" >   Если быть точнее, <tt><a 
href="#x51-108002r84">cond</a></tt> обрабатывает свои подвыражения слева направо.
Для каждого подвыражения, вычисляется форма условия. Если результат
<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, <tt><a 
href="#x51-108002r84">cond</a></tt> переходит к следующему подвыражению. Если результат <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>, <i>cdr</i>
подвыражения обрабатывается, как список форм. Этот список выполняется
слева направо, как неявный <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>. После выполнения списка форм, <tt><a 
href="#x51-108002r84">cond</a></tt>
возвращает управление без обработки оставшихся подвыражений.
Специальная форма <tt><a 
href="#x51-108002r84">cond</a></tt> возвращает результат выполнения последней
формы из списка. Если этот список пустой, тогда возвращается значение
формы условия. Если <tt><a 
href="#x51-108002r84">cond</a></tt> вернула управление без вычисления какой-либо
                                                                          

                                                                          
ветки (все условные формы вычислялись в <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>), возвращается значение
<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<!--l. 5923--><p class="indent" >   Для того, чтобы выполнить последнее подвыражение, в случае если
раньше ничего не выполнилось, можно использовать <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> для формы условия. В
целях стиля, если значение <tt><a 
href="#x51-108002r84">cond</a></tt> будет для чего-то использоваться,
желательно записывать последнее выражение так: <tt>(<tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>)</tt>. Также вопросом
вкуса является запись последнего подвыражения <tt><a 
href="#x51-108002r84">cond</a></tt> как «синглтон», в
таком случае, используется неявный <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>. (Следует отметить, если <i>x</i> может
возвращать несколько значений, то <tt>(cond ... (<i>x</i>))</tt> может вести себя
отлично от <tt>(cond ... (<tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> <i>x</i>))</tt>. Первое выражение всегда возвращает одно
выражение, тогда как второе возвращает все то же, что и <i>x</i>. В зависимости
от стиля, можно указывать поведение явно <tt>(cond ... (t (values <i>x</i>)))</tt>,
используя функцию <tt><a 
href="clmse42.html#x54-130002r105">values</a></tt> для явного указания возврата одного значения.)
Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(setq z (cond (a &#x2019;foo) (b &#x2019;bar)))                                </td><td  
class="tabbing">;Возможна неопределённость
</td></tr></table>
<!--l. 5938--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(setq z (cond (a &#x2019;foo) (b &#x2019;bar) (<tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>)))                     </td><td  
class="tabbing">;Уже лучше</td></tr></table>
<!--l. 5939--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (c d) (e))                                             </td><td  
class="tabbing">;Возможна неопределённость</td></tr></table>
<!--l. 5940--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (c d) (<tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> e))                                          </td><td  
class="tabbing">;Уже лучше</td></tr></table>
<!--l. 5941--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (c d) (<tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> (values e)))                               </td><td  
class="tabbing">;Неплохо (если необходимо</td></tr></table>
<!--l. 5942--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">                                                      </td><td  
class="tabbing">; одно значение)</td></tr></table>
<!--l. 5943--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (c))                                                    </td><td  
class="tabbing">;Возможна неопределённость</td></tr></table>
<!--l. 5944--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (t c))                                                  </td><td  
class="tabbing">;Уже лучше</td></tr></table>
<!--l. 5945--><p class="indent" >     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(if a b c)                                                             </td><td  
class="tabbing">;Тоже неплохо</td></tr></table>
<!--l. 5947--><p class="indent" >
</div>
</div>
<!--l. 5948--><p class="noindent" >Lisp&#x2019;овая форма <tt><a 
href="#x51-108002r84">cond</a></tt> сравнима с последовательностью <b>if</b>-<b>then</b>-<b>else</b>,
используемой в большинстве алгебраических языках программирования:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">(cond (<i>p</i> ...)                </td><td style="width:195;" 
class="tabbing">                                 </td><td  
class="tabbing"><b>if</b> <i>p</i> <b>тогда</b> ...
</td></tr></table>
                                                                          

                                                                          
<!--l. 5953--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">      (<i>q</i> ...)               </td><td style="width:195;" 
class="tabbing">roughly                       </td><td  
class="tabbing"><b>иначе</b> <b>если</b> <i>q</i> <b>тогда</b> ...</td></tr></table>
<!--l. 5954--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">      (<i>r</i> ...)               </td><td style="width:195;" 
class="tabbing">corresponds                  </td><td  
class="tabbing"><b>иначе</b> <b>если</b> <i>r</i> <b>тогда</b> ...</td></tr></table>
<!--l. 5955--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">      ...                    </td><td style="width:195;" 
class="tabbing">to                               </td><td  
class="tabbing">...</td></tr></table>
<!--l. 5956--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">      (<tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> ...))              </td><td style="width:195;" 
class="tabbing">                                 </td><td  
class="tabbing"><b>иначе</b> ...</td></tr></table>
<!--l. 5958--><p class="indent" >
</div>
</div>
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> case </b><a 
 id="dx51-109001"></a><a 
 id="x51-109002r85"></a> keyform  {( {( {key}* ) | key} { form}* )}*
</td></tr></table>
<!--l. 5963--><p class="indent" >
</div>
<!--l. 5963--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-1100007.6" id="x51-1100007.6"></a></span>
   <tt><a 
href="#x51-109002r85">case</a></tt> условный оператор, который выбирает ветку для выполнения, в
зависимости от равенства некоторой переменной некоторой константе.
Константа обычно представляет собой ключевой символ, целое число или
строковый символ (но может быть и любой другой объект). Вот развёрнутая
форма: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(case <i>keyform</i>
</td></tr></table>
<!--l. 5969--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>keylist-1</i> <i>consequent-1-1</i> <i>consequent-1-2</i> ...)</td></tr></table>
<!--l. 5970--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>keylist-2</i> <i>consequent-2-1</i> ...)</td></tr></table>
<!--l. 5971--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>keylist-3</i> <i>consequent-3-1</i> ...)</td></tr></table>
<!--l. 5972--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 5974--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 5975--><p class="noindent" >Структурно <tt><a 
href="#x51-109002r85">case</a></tt> очень похож на <tt><a 
href="#x51-108002r84">cond</a></tt>, и поведение такое же: выбрать список
форм и выполнить их. Однако <tt><a 
href="#x51-109002r85">case</a></tt> отличается механизмом выбора
подвыражения.
<!--l. 5979--><p class="indent" >   Сперва <tt><a 
href="#x51-109002r85">case</a></tt> вычисляет форму <i>keyform</i> для получения объекта, который
называется <i>ключевой объект</i>. Затем <tt><a 
href="#x51-109002r85">case</a></tt> рассматривает все подвыражения.
Если <i>ключевой объект</i> присутствует в списке <i>keylist</i> (то есть, если <i>ключевой
объект</i> равен <tt><a 
href="clmse32.html#x43-77004r45">eql</a></tt> хотя бы одному элементу из списка <i>keylist</i>), то список форм
выбранного подвыражения вычисляется, как неявный <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>. <tt><a 
href="#x51-109002r85">case</a></tt>
возвращает то же, что и последняя форма списка (или <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> если список форм
был пустой). Если ни одно подвыражение не удовлетворило условию, то <tt><a 
href="#x51-109002r85">case</a></tt>
возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<!--l. 5990--><p class="indent" >   Ключи в списке ключей <i>keylist</i> <i>не</i> выполняются. В данном списке должны
быть указаны литеральные ключи. Если один ключ попадается более чем в
одном подвыражении, это считается ошибкой. Следствием является то, что
порядок этих подвыражений не влияет на поведение конструкции
<tt><a 
href="#x51-109002r85">case</a></tt>.
<!--l. 5997--><p class="indent" >   Вместо <i>keylist</i> можно записать один из символов: <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> или <tt>otherwise</tt>.
Подвыражение с одним из таких символов всегда удовлетворяет условию
выбора. Такое подвыражение должно быть последним (это исключение из
правила о произвольности положения подвыражений). Смотрите также
<tt><a 
href="clmse144.html#x177-440002r913">ecase</a></tt> и <tt><a 
href="clmse144.html#x177-441002r914">ccase</a></tt>, каждая из которых предоставляет неявное <tt>otherwise</tt>
подвыражение для сигнализирования об ошибке, если ни одно подвыражение
не удовлетворило условию.
<!--l. 6005--><p class="indent" >   Если в подвыражении только один ключ, тогда этот ключ может быть
записан вместо списка. Такой «синглтоновый ключ» не может быть <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> (так
как возникают конфликты с (), который означает список без ключей), <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>,
<tt>otherwise</tt> или cons-ячейкой.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> typecase </b><a 
 id="dx51-110001"></a><a 
 id="x51-110002r86"></a> keyform  {(type  { form}* )}*
</td></tr></table>
<!--l. 6014--><p class="indent" >
                                                                          

                                                                          
</div>
<!--l. 6014--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-1110007.6" id="x51-1110007.6"></a></span>
   <tt><a 
href="#x51-110002r86">typecase</a></tt> условный оператор, который выбирает подвыражение на основе
типа объекта. Развёрнутая форма: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(typecase <i>keyform</i>
</td></tr></table>
<!--l. 6019--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>type-1</i> <i>consequent-1-1</i> <i>consequent-1-2</i> ...)</td></tr></table>
<!--l. 6020--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>type-2</i> <i>consequent-2-1</i> ...)</td></tr></table>
<!--l. 6021--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>type-3</i> <i>consequent-3-1</i> ...)</td></tr></table>
<!--l. 6022--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 6024--><p class="indent" >
</div>
</div>
<!--l. 6025--><p class="noindent" >Структура <tt><a 
href="#x51-110002r86">typecase</a></tt> похожа на <tt><a 
href="#x51-108002r84">cond</a></tt> или <tt><a 
href="#x51-109002r85">case</a></tt>. Поведение также схоже в том,
что выбирается подвыражение в зависимости от условия. Различие
заключается в механизме выбора подвыражения.
<!--l. 6029--><p class="indent" >   Сперва <tt><a 
href="#x51-110002r86">typecase</a></tt> вычисляет форму <i>keyform</i> для создания объекта,
называемого ключевым объектом. Далее <tt><a 
href="#x51-110002r86">typecase</a></tt> друг за другом
рассматривает каждое подвыражение. Форма <i>type</i>, которая встречается
в каждом подвыражении, является спецификатором типа. Данный
спецификатор не вычисляется, поэтому должен быть литеральным. Когда
ключевой объект принадлежит некоторый типу, то выделенный список форм
<i>consequent</i> выполняется последовательно (как неявный <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>). <tt><a 
href="#x51-110002r86">typecase</a></tt>
возвращает то, что вернула последняя форма из списка (или <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> если список
был пуст). Если не одно подвыражение не было выбрано, <tt><a 
href="#x51-110002r86">typecase</a></tt>
возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<!--l. 6040--><p class="indent" >   Как и для <tt><a 
href="#x51-109002r85">case</a></tt> можно использовать <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> или <tt>otherwise</tt> на позиции <i>типа</i>
для задания подвыражений, которые будут выполняться, только если не
было выполнено других подвыражений. Смотрите также <tt><a 
href="clmse144.html#x177-438002r911">etypecase</a></tt> и
<tt><a 
href="clmse144.html#x177-439002r912">ctypecase</a></tt>, каждая из которых предоставляет неявную ветку <tt>otherwise</tt> для
сигнализирования об ошибке, что ни одно подвыражение не удовлетворило
условию.
                                                                          

                                                                          
<!--l. 6047--><p class="indent" >   Допустимо указывать более одного подвыражение, тип условия которого
уже является подтипом условия другого подвыражения. В таком случае
будет выбрано первое встретившееся подвыражение. Таким образом в
<tt><a 
href="#x51-110002r86">typecase</a></tt>, в отличие от <tt><a 
href="#x51-109002r85">case</a></tt>, порядок следования подвыражений влияет на
поведение всей конструкции. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(typecase an-object
</td></tr></table>
<!--l. 6054--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   (string ...)                             </td><td  
class="tabbing">;Подвыражение обрабатывает строки</td></tr></table>
<!--l. 6055--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   ((array t) ...)                          </td><td  
class="tabbing">;Подвыражение обрабатывает общие массивы</td></tr></table>
<!--l. 6056--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   ((array bit) ...)                       </td><td  
class="tabbing">;Подвыражение обрабатывает битовые массивы</td></tr></table>
<!--l. 6057--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   (array ...)                              </td><td  
class="tabbing">;Обрабатывает все остальные массивы</td></tr></table>
<!--l. 6058--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   ((or list number) ...)                </td><td  
class="tabbing">;Подвыражение обрабатывает списки и числа</td></tr></table>
<!--l. 6059--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   (t ...))                                   </td><td  
class="tabbing">;Подвыражение обрабатывает все остальные объекты</td></tr></table>
<!--l. 6061--><p class="indent" >
</div>
</div>
</div>
                                                                          

                                                                          
   <!--l. 6064--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse40.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html#tailclmse38.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse39.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse39.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 6064--><p class="indent" >   <a 
 id="tailclmse39.html"></a>  
</body></html> 
