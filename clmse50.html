<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Синтаксис декларации</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 00:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 1280--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse51.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#tailclmch9.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse50.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse50.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">9.1   </span> <a 
href="clm.html#QQ2-64-826" id="x64-8180009.1">Синтаксис
декларации</a></h3>
<!--l. 1283--><p class="noindent" >Конструкция <tt><a 
href="#x64-818003r140">declare</a></tt> используется для встраивания деклараций внутрь
выполняемого кода. Глобальные декларации и декларации, вычисленные
программой, устанавливаются конструкцией <tt><a 
href="#x64-829002r141">proclaim</a></tt>.
<div class="newer">
<!--l. 1288--><p class="indent" >   X3J13 проголосовал в июне 1989 <a 
 id="dx64-818001"></a>ввести новый макрос <tt><a 
href="#x64-840002r142">declaim</a></tt>, который
гарантированно распознаётся компилятором, и часто более удобен, чем
<tt><a 
href="#x64-829002r141">proclaim</a></tt> для установки глобальных деклараций. FIXME
</div>
<div class="defspec">
<div class="defmacheader">
<!--l. 1296--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
 <i>[Специальный оператор]</i><b> declare </b><a 
 id="dx64-818002"></a><a 
 id="x64-818003r140"></a> {decl-spec}*
   <br>
<!--l. 1297--><p class="noindent" ></div>
<!--l. 1297--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8190009.1" id="x64-8190009.1"></a></span>
</div>
<!--l. 1298--><p class="indent" >   Форма <tt><a 
href="#x64-818003r140">declare</a></tt> известна как <i>декларация</i>. Декларации могут использоваться
только в начале тел соответствующих специальных форм. То есть
декларация может использоваться в этой специальной форме, как
выражение, и все предыдущие выражение (если есть) также должны быть
формами <tt><a 
href="#x64-818003r140">declare</a></tt> (или, в некоторых случаях, строками документации).
Декларации могут использоваться в лямбда-выражениях и перечисленных
ниже формах. <div class="lisp"><div class="tabbing">
<tt><a 
href="clmse36.html#x48-558002r70">define-setf-method</a></tt>     <tt><a 
href="clmse39.html#x51-600002r83">labels</a></tt>
   <br>   <tt><a 
href="clmse45.html#x58-756002r124">defmacro</a></tt>               <tt><a 
href="clmse39.html#x51-590002r79">let</a></tt><br>   <tt><a 
href="clmse36.html#x48-539003r69">defsetf</a></tt>                <tt><a 
href="clmse39.html#x51-595002r80">let*</a></tt><br>
<tt><a 
href="clmse24.html#x33-193002r6">deftype</a></tt>                <tt>locally</tt><br>  <tt><a 
href="clmse30.html#x40-261002r13">defun</a></tt>                  <tt><a 
href="clmse39.html#x51-601002r84">macrolet</a></tt><br>
<tt><a 
href="clmse134.html#x164-2410002r820">do</a></tt>                     <tt><a 
href="clmse43.html#x55-727002r117">multiple-value-bind</a></tt><br>
<tt><a 
href="clmse42.html#x54-650002r98">do*</a></tt>                    <tt><a 
href="clmse42.html#x54-690002r108">prog</a></tt><br>         <tt><a 
href="clmse62.html#x78-935002r184">do-all-symbols</a></tt>         <tt><a 
href="clmse42.html#x54-691002r109">prog*</a></tt><br>
<tt><a 
href="clmse62.html#x78-934002r183">do-external-symbols</a></tt>    <tt><a 
href="clmse109.html#x135-1671002r612">with-input-from-string</a></tt><br>
<tt><a 
href="clmse62.html#x78-933002r182">do-symbols</a></tt>             <tt><a 
href="clmse116.html#x144-2136009r718">with-open-file</a></tt><br>
<tt><a 
href="clmse42.html#x54-668002r99">dolist</a></tt>                 <tt><a 
href="clmse109.html#x135-1670002r611">with-open-stream</a></tt><br>
<tt><a 
href="clmse42.html#x54-671002r100">dotimes</a></tt>                <tt><a 
href="clmse109.html#x135-1674002r613">with-output-to-string</a></tt><br>                 <tt><a 
href="clmse39.html#x51-599002r82">flet</a></tt><br>
<!--l. 1319--><p class="noindent" ></div>
<!--l. 1319--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8200009.1" id="x64-8200009.1"></a></span>
<!--l. 1319--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8210009.1" id="x64-8210009.1"></a></span>
</div>
<!--l. 1321--><p class="indent" >   Вычисление декларации является ошибкой. Специальные формы,
которые позволяют использовать декларации, явно проверяют их
наличие.
                                                                          

                                                                          
<!--l. 1324--><p class="indent" >   Макровызовы могут раскрываться в декларации, при условии, что
макровызов указан в том месте, где могут быть указаны декларации.
(Однако, макровызов не может использоваться в форме declare на месте
<i>decl-spec</i>.)
<!--l. 1328--><p class="indent" >   Каждая форма <i>decl-spec</i> является списком, у которого <i>car</i> элемент это
символ, указывающий на тип декларации. Декларации могут быть разделены
на два класса: одни относятся к связыванию переменных, другие нет.
(Декларация <tt>special</tt> является исключением, она попадает в оба класса, это
будет описано ниже.) Те, которые касаются связываний переменных,
применяются только к связываниям, созданным в форме, в которой они
используются. Например, в <div class="lisp"><div class="tabbing">
(defun foo (x)
   <br>                    (declare (type ﬂoat x)) ...<br>                    (let ((x &#x2019;a)) ...)<br>
  ...)<br>
<!--l. 1340--><p class="noindent" ></div>
<!--l. 1340--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8220009.1" id="x64-8220009.1"></a></span>
<!--l. 1340--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8230009.1" id="x64-8230009.1"></a></span>
</div>
<!--l. 1341--><p class="indent" >   декларация <tt>type</tt> применяется только для внешнего связывания <tt>x</tt>, а не
для связывания, созданного в <tt><a 
href="clmse39.html#x51-590002r79">let</a></tt>.
<!--l. 1344--><p class="indent" >   Декларации, которые не воздействуют на связывания переменных,
воздействуют на весь код тела в специальной форме. Например, <div class="lisp"><div class="tabbing">
(defun foo (x y) (declare (notinline ﬂoor)) ...)
   <br>
<!--l. 1349--><p class="noindent" ></div>
<!--l. 1349--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8240009.1" id="x64-8240009.1"></a></span>
                                                                          

                                                                          
<!--l. 1349--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8250009.1" id="x64-8250009.1"></a></span>
</div>
<!--l. 1350--><p class="indent" >   рекомендует, что везде внутри тела функции <tt>foo</tt>, <tt><a 
href="clmse68.html#x85-1050002r236">floor</a></tt> должна быть
вызвана как отдельная подпрограмма, а не встроена в код.
<!--l. 1353--><p class="indent" >   Некоторые специальные формы содержат части кода, которые,
правильнее говоря, на являются телом этой формы. Это например код
инициализации переменных и форма результата для циклов. Во всех
случаях, такой дополнительный код оказывается под воздействием
всеобъемлемых деклараций, которые указаны перед телом специальной
формы. Невсеобъемлемые декларации не оказывают воздействия на этот код,
за исключением (конечно) ситуаций, когда код находится в области
действия переменной, для которой использовалась декларация. Например:
<div class="lisp"><div class="tabbing">
(defun few (x <tt>&#x0026;optional</tt> (y *print-circle*))
   <br>                                                    (declare (special *print-circle*))<br>
  ...)<br>
<!--l. 1366--><p class="noindent" ></div>
<!--l. 1366--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8260009.1" id="x64-8260009.1"></a></span>
<!--l. 1366--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8270009.1" id="x64-8270009.1"></a></span>
</div>
<!--l. 1367--><p class="indent" >   Ссылка на <tt><a 
href="clmse111.html#x138-1846003r643">*print-circle*</a></tt> в первой строке примера является
специальной, так как указана соответствующая декларация. <div class="lisp"><div class="tabbing">
(defun nonsense (k x z)
   <br>                                 (foo z x)               ;Первый вызов <tt>foo</tt><br>
  (let ((j (foo k x))     ;Второй вызов <tt>foo</tt><br>
        (x (* k k)))<br>                    (declare (inline foo) (special x z))<br>
    (foo x j z)))         ;Третий вызов <tt>foo</tt><br>
<!--l. 1376--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 1376--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8280009.1" id="x64-8280009.1"></a></span>
<!--l. 1376--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8290009.1" id="x64-8290009.1"></a></span>
</div>
<!--l. 1377--><p class="indent" >   В этом примере, декларация <tt>inline</tt> применяется только ко второму и
третьему вызову <tt>foo</tt>. Декларация <tt>special</tt> для переменной <tt>x</tt> указывает, что
форма <tt><a 
href="clmse39.html#x51-590002r79">let</a></tt> создаст специальное связывание для <tt>x</tt> и тем самым ссылки
в теле формы также будут специальными. Ссылка на <tt>x</tt> во втором
вызове <tt>foo</tt> является специальной. Ссылка на <tt>x</tt> в первом вызове <tt>foo</tt>
является локальной, а не специальной. Декларация <tt>special</tt> для <tt>z</tt>
указывает на то, что ссылка в вызове <tt>foo</tt> будет специальной. Это значит
ссылка не будет указывать на параметр функции <tt>nonsense</tt>, так как для
параметра декларации <tt>special</tt> не указано. (Декларация <tt>special</tt>
переменной <tt>z</tt> указывается не в теле <tt><a 
href="clmse30.html#x40-261002r13">defun</a></tt>, а в теле внутренней конструкции
<tt><a 
href="clmse39.html#x51-590002r79">let</a></tt>. Таким образом она не воздействует на связывание параметра
функции.)
</div>
<div class="defun">
<!--l. 1393--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx64-829001"></a><a 
 id="x64-829002r141"></a><b> proclaim</b>  <i>decl-spec</i>
</div>
<!--l. 1395--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8300009.1" id="x64-8300009.1"></a></span>
   Функция <tt><a 
href="#x64-829002r141">proclaim</a></tt> в качестве аргумента принимает <i>decl-spec</i>, и
применяет указания в глобальном пространстве. (Такие глобальные
декларации называются <i>прокламации</i>.) Так как <tt><a 
href="#x64-829002r141">proclaim</a></tt> является
функцией, то её аргумент вычисляется всегда. Это позволяет программам
вычислять декларацию и затем для применения помещать её в вызов
<tt><a 
href="#x64-829002r141">proclaim</a></tt>.
<!--l. 1403--><p class="indent" >   Любые упоминаемые имена переменных указывают на значения
динамических переменных. Например, выполненная прокламация
<div class="lisp"><div class="tabbing">
(proclaim &#x2019;(type ﬂoat tolerance))
   <br>
<!--l. 1407--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 1407--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8310009.1" id="x64-8310009.1"></a></span>
<!--l. 1407--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8320009.1" id="x64-8320009.1"></a></span>
</div>
<!--l. 1408--><p class="indent" >   указывает на то, что динамическое значение <tt>tolerance</tt> должно
быть всегда числом с плавающей точкой. Подобным образом, любые
упоминаемые имена функций указывают на глобальные определения
функций.
<!--l. 1413--><p class="indent" >   Прокламации содержат универсальные декларации, которые всегда
действуют, кроме случаев сокрытия их локальными декларациями.
Например, <div class="lisp"><div class="tabbing">
(proclaim &#x2019;(inline ﬂoor))
   <br>
<!--l. 1417--><p class="noindent" ></div>
<!--l. 1417--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8330009.1" id="x64-8330009.1"></a></span>
<!--l. 1417--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8340009.1" id="x64-8340009.1"></a></span>
</div>
<!--l. 1418--><p class="indent" >   рекомендует то, что <tt><a 
href="clmse68.html#x85-1050002r236">floor</a></tt> должна быть встроена в места её вызова. Но в
ситуации <div class="lisp"><div class="tabbing">
(defun foo (x y) (declare (notinline ﬂoor)) ...)
   <br>
<!--l. 1422--><p class="noindent" ></div>
<!--l. 1422--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8350009.1" id="x64-8350009.1"></a></span>
                                                                          

                                                                          
<!--l. 1422--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8360009.1" id="x64-8360009.1"></a></span>
</div>
<tt>
<!--l. 1423--><p class="indent" >   <a 
href="clmse68.html#x85-1050002r236">floor</a></tt> будет вызываться как отдельная функция, так как локальная
декларация скрыла прокламацию.
<!--l. 1426--><p class="indent" >   Специальный случай, когда <tt><a 
href="#x64-829002r141">proclaim</a></tt> обрабатывает <tt>special</tt>, то <i>decl-spec</i>
применяется ко всем связываниям и ссылкам на упомянутую переменную.
Например, после <div class="lisp"><div class="tabbing">
(proclaim &#x2019;(special x))
   <br>
<!--l. 1432--><p class="noindent" ></div>
<!--l. 1432--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8370009.1" id="x64-8370009.1"></a></span>
<!--l. 1432--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8380009.1" id="x64-8380009.1"></a></span>
</div>
<!--l. 1433--><p class="indent" >   в определении функции <div class="lisp"><div class="tabbing">
(defun example (x) ...)
   <br>
<!--l. 1436--><p class="noindent" ></div>
<!--l. 1436--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8390009.1" id="x64-8390009.1"></a></span>
<!--l. 1436--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8400009.1" id="x64-8400009.1"></a></span>
</div>
<!--l. 1437--><p class="indent" >   параметр <tt>x</tt> будет связан, как специальная (динамическая) переменная, а
не лексическая (статическая). Такой приём должен использоваться
аккуратно. Обычный способ определить глобальную специальную
переменную это использовать <tt><a 
href="clmse30.html#x40-269002r14">defvar</a></tt> или <tt><a 
href="clmse30.html#x40-270002r15">defparameter</a></tt>.
</div>
                                                                          

                                                                          
<div class="newer">
<div class="defmac">
<div class="defmacheader">
<!--l. 1446--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i><b> declaim </b><a 
 id="dx64-840001"></a><a 
 id="x64-840002r142"></a> {decl-spec}*
   <br>
<!--l. 1447--><p class="noindent" ></div>
<!--l. 1447--><p class="noindent" ><span class="paragraphHead"><a 
href="#x64-8410009.1" id="x64-8410009.1"></a></span>
</div>
<!--l. 1448--><p class="indent" >   Этот макрос синтаксически похож на <tt><a 
href="#x64-818003r140">declare</a></tt> и семантически на
<tt><a 
href="#x64-829002r141">proclaim</a></tt>. Это выполняемая форма и она может использоваться везде, где
может <tt><a 
href="#x64-829002r141">proclaim</a></tt>. Однако, формы <i>decl-spec</i> не вычисляются.
<!--l. 1452--><p class="indent" >   Если вызов этого макроса произошёл на верхнем уровне в файле,
обрабатываемом компилятором, то прокламации также будут выполнены во
время компиляции. As with other deﬁning macros, it is unspeciﬁed whether or
not the compile-time side eﬀects of a <tt><a 
href="#x64-840002r142">declaim</a></tt> persist after the ﬁle has been
compiled (see section <a 
href="clmse120.html#x149-217700024.1">24.1<!--tex4ht:ref: COMPILER-SECTION --></a>). FIXME
</div>
</div>
                                                                          

                                                                          
<!--l. 1461--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse51.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#tailclmch9.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse50.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse50.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse50.html"></a>  </div> </div> 
</body></html> 
