<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Список свойств</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-12 16:57:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 533--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse51.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#tailclmch10.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse50.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#clmse50.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">10.1   </span> <a 
href="clm.html#QQ2-65-164" id="x65-15600010.1">Список
свойств</a></h3>
<!--l. 535--><p class="noindent" >Начиная с самого создания, Lisp для каждого символа ассоциирует
табличную структуру данных, называемую <i>список свойств</i> (для краткости
<i>plist</i>). Список свойств содержит ноль и более элементов. Каждый элемент
содержит ключ (называемым <i>индикатором</i>), который чаще всего является
символом, и ассоциированным с ним значением (называемым иногда
<i>свойством</i>), которое может быть любым Lisp&#x2019;овым объектом. Среди
индикаторов не может быть дубликатов. Список свойств может иметь только
одно свойство для данного имени. Таким образом, значение может получено
с помощью двух символов: исходного символа и индикатора.
<!--l. 545--><p class="indent" >   Список свойств по целевому назначению очень похож на ассоциативный
список. Различие в том, что список свойств является единственно подлинным
объектом. Операции добавления и удаления элементов деструктивны, то есть
при их использовании изменяется старый список, и нового списка свойств
не создаётся. Ассоциативные список, наоборот, обычно изменяются
недеструктивно (без побочных эффектов) с помощью добавления в начало
новых элементов (смотрите <tt><a 
href="clmse84.html#x104-208002r481">acons</a></tt> и <tt><a 
href="clmse84.html#x104-208004r482">pairlis</a></tt>).
<!--l. 553--><p class="indent" >   Список свойств реализуется, как ячейка памяти, содержащая список с
чётным (возможно нулевым) количеством аргументов. (Обычно эта ячейка
памяти является ячейкой списка свойств в символе, но в принципе подходит
любая ячейка памяти, к которой можно применить <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>) Каждая пара
элементов в списке составляет строку. Первый в паре это индикатор, а
второй — значение. Так как функции для списка свойств используют
символ, а не сам список, то изменения этого списка свойств может быть
записаны сохранением обратно в ячейку списка свойств символа.
FIXME
<!--l. 562--><p class="indent" >   Когда создаётся символ, его список свойств пуст. Свойства создаются с
помощью <tt><a 
href="#x65-156002r127">get</a></tt> внутри формы <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>.
<!--l. 565--><p class="indent" >   Common Lisp не использует список свойств символа так интенсивно, как
это делали ранние реализации Lisp&#x2019;а. В Common Lisp&#x2019;е нечасто используемые
данные, такие как отладочная информация, информация для компилятора и
документация, хранятся в списках свойств.
<div class=defun>
<!--l. 570--><p class="noindent" ><i>[Функция]</i><a 
 id="dx65-156001"></a><a 
 id="x65-156002r127"></a><b> get</b>  <i>symbol</i> <i>indicator</i> &#x0026;optional  <i>default</i>
<!--l. 572--><p class="noindent" ><tt><a 
href="#x65-156002r127">get</a></tt> ищет в списке свойств символа <i>symbol</i> индикатор равный <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt> индикатору
<i>indicator</i>. Первый аргумент должен быть символом. Если такое свойство
                                                                          

                                                                          
найдено, возвращается её значение. Иначе возвращается значение
<i>default</i>.
<!--l. 579--><p class="indent" >   Если <i>default</i> не указано, тогда для значения по-умолчанию используется
<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<!--l. 582--><p class="indent" >   Следует отметить, что способа отличить значения по-умолчанию и такое
же значение свойства нет: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get x y) <span class="math"> ≡</span> (getf (symbol-plist x) y)
</td></tr></table>
<!--l. 586--><p class="indent" >
</div>
</div>
<!--l. 587--><p class="noindent" >Допустим, что список свойств символа <tt>foo</tt> является <tt>(bar t baz 3 hunoz
&#x0022;Huh?&#x0022;)</tt>. Тогда, например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get &#x2019;foo &#x2019;baz) <span class="math"> ⇒</span> 3
</td></tr></table>
<!--l. 591--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get &#x2019;foo &#x2019;hunoz) <span class="math"> ⇒</span> &#x0022;Huh?&#x0022;</td></tr></table>
<!--l. 592--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get &#x2019;foo &#x2019;zoo) <span class="math"> ⇒</span> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt></td></tr></table>
<!--l. 594--><p class="indent" >
</div>
</div>
<tt>
<!--l. 596--><p class="indent" >   <a 
href="clmse35.html#x47-89002r64">setf</a></tt> может использоваться вместе с <tt><a 
href="#x65-156002r127">get</a></tt> для создания новой пары
свойства, возможно замещая старую пару с тем же именем. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get &#x2019;clyde &#x2019;species) <span class="math"> ⇒</span> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>
</td></tr></table>
<!--l. 600--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (get &#x2019;clyde &#x2019;species) &#x2019;elephant) <span class="math"> ⇒</span> elephant</td></tr></table>
<!--l. 601--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">и теперь (get &#x2019;clyde &#x2019;species) <span class="math"> ⇒</span> elephant</td></tr></table>
<!--l. 603--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 604--><p class="noindent" >В данном контексте может быть указан аргумент <i>default</i>. Он игнорируется в
<tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>, но может быть полезен в таких макросах, как <tt><a 
href="clmse80.html#x100-201054r451">push</a></tt>, которые связаны с
<tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(push item (get sym &#x2019;token-stack &#x2019;(initial-item)))
</td></tr></table>
<!--l. 609--><p class="indent" >
</div>
</div>
<!--l. 610--><p class="noindent" >означает то же, что и <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (get sym &#x2019;token-stack &#x2019;(initial-item))
</td></tr></table>
<!--l. 612--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (cons item (get sym &#x2019;token-stack &#x2019;(initial-item))))</td></tr></table>
<!--l. 614--><p class="indent" >
</div>
</div>
<!--l. 615--><p class="noindent" >а если упростить, то <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (get sym &#x2019;token-stack)
</td></tr></table>
<!--l. 617--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (cons item (get sym &#x2019;token-stack &#x2019;(initial-item))))</td></tr></table>
<!--l. 619--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 622--><p class="noindent" ><i>[Функция]</i><a 
 id="dx65-156003"></a><a 
 id="x65-156004r128"></a><b> remprop</b>  <i>symbol</i> <i>indicator</i>
<!--l. 624--><p class="noindent" >Эта функция удаляет из символа <i>symbol</i> свойство с индикатором, равным <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt>
индикатору <i>indicator</i>. Индикатор свойства и соответствующее значение
удаляется из списка деструктивной склейкой списка свойств. Она возвращает
<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, если указанного свойства не было, или не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, если свойство было.
<div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remprop x y) <span class="math"> ≡</span> (remf (symbol-plist x) y)
</td></tr></table>
<!--l. 632--><p class="indent" >
</div>
</div>
<!--l. 633--><p class="noindent" >Например, если список свойств <tt>foo</tt> равен <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(color blue height 6.3 near-to bar)
</td></tr></table>
<!--l. 636--><p class="indent" >
</div>
</div>
<!--l. 637--><p class="noindent" >тогда вызов <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remprop &#x2019;foo &#x2019;height)
</td></tr></table>
<!--l. 640--><p class="indent" >
</div>
</div>
<!--l. 641--><p class="noindent" >вернёт значение не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, после изменения списка свойств символа <tt>foo</tt> на
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(color blue near-to bar)
</td></tr></table>
<!--l. 644--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 647--><p class="noindent" ><i>[Функция]</i><a 
 id="dx65-156005"></a><a 
 id="x65-156006r129"></a><b> symbol-plist</b>  <i>symbol</i>
<!--l. 649--><p class="noindent" >Эта функция возвращает список, который содержит пары свойств для
символа <i>symbol</i>. Извлекается содержимое ячейки списка свойств и
возвращается в качестве результата.
                                                                          

                                                                          
<!--l. 654--><p class="indent" >   Следует отметить, что использование <tt><a 
href="#x65-156002r127">get</a></tt> с результатом <tt><a 
href="#x65-156006r129">symbol-plist</a></tt> <i>не</i>
будет работать. Необходимо передавать в <tt><a 
href="#x65-156002r127">get</a></tt> символ, или же использовать
<tt><a 
href="#x65-156008r130">getf</a></tt>.
<!--l. 658--><p class="indent" >   С <tt><a 
href="#x65-156006r129">symbol-plist</a></tt> может использоваться <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> для деструктивной замены
списка свойств символа. Это относительно опасная операция, так как может
уничтожить важную информацию, которую, возможно, хранила там
реализация. Также, позаботьтесь о том, чтобы новый список свойств
содержал чётное количество элементов.
</div>
<div class=defun>
<!--l. 665--><p class="noindent" ><i>[Функция]</i><a 
 id="dx65-156007"></a><a 
 id="x65-156008r130"></a><b> getf</b>  <i>place</i> <i>indicator</i> &#x0026;optional  <i>default</i>
<!--l. 667--><p class="noindent" ><tt><a 
href="#x65-156008r130">getf</a></tt> ищет индикатор равный <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt> <i>indicator</i> в списке свойств, находящимся в
<i>place</i>. Если он найден, тогда возвращается соответствующее значение. Иначе
возвращается <i>default</i>. Если <i>default</i> не задан, то значение по-умолчанию
используется <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Следует отметить, что метода определения, вернулось
ли значение по умолчанию или это значение свойства, нет. Часто
<i>place</i> вычисляется из обобщённой переменной, принимаемой функцией
<tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>.
<tt>
<!--l. 677--><p class="indent" >   <a 
href="clmse35.html#x47-89002r64">setf</a></tt> может использоваться вместе <tt><a 
href="#x65-156008r130">getf</a></tt>, и в этом случае <i>place</i> должно
быть обобщённым, чтобы его можно было передать в <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>. Целью является
добавление новой пары свойства, или изменению уже существующей пары, в
списке свойств, хранящимся в <i>place</i>. В данном контексте может быть
использован аргумент <i>default</i>. Он игнорируется функцией <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>, но может
быть полезен в таких макросах, как <tt><a 
href="clmse80.html#x100-201054r451">push</a></tt>, которые связаны с <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>. Смотрите
описание <tt><a 
href="#x65-156002r127">get</a></tt> для примера.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> remf </b><a 
 id="dx65-156009"></a><a 
 id="x65-156010r131"></a> place indicator
</td></tr></table>
<!--l. 689--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 689--><p class="noindent" ><span class="paragraphHead"><a 
href="#x65-15700010.1" id="x65-15700010.1"></a></span>
   Эта функция в списке свойств, хранящимся в <i>place</i>, удаляет свойства,
индикатор которого равен <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt> аргументу <i>indicator</i>. Индикатор свойства и
соответствующее значение удаляется из списка деструктивной склейкой. <tt><a 
href="#x65-156010r131">remf</a></tt>
возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, если свойства не было в списке, и некоторое не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> значение,
если свойство было. Форма <i>place</i> может быть любой обобщённой переменной,
принимаемой <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>. Смотрите <tt><a 
href="#x65-156004r128">remprop</a></tt>.
</div>
<div class=defun>
<!--l. 700--><p class="noindent" ><i>[Функция]</i><a 
 id="dx65-157001"></a><a 
 id="x65-157002r132"></a><b> get-properties</b>  <i>place</i> <i>indicator-list</i>
<!--l. 702--><p class="noindent" ><tt><a 
href="#x65-157002r132">get-properties</a></tt> похожа на <tt><a 
href="#x65-156008r130">getf</a></tt> за исключением того, что второй
аргумент является списком индикаторов. <tt><a 
href="#x65-157002r132">get-properties</a></tt> ищет первый
встретившийся индикатор, который есть в списке индикаторов. Обычно <i>place</i>
вычисляется из обобщённой переменной, которая может использоваться в
<tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>.
<tt>
<!--l. 708--><p class="indent" >   <a 
href="#x65-157002r132">get-properties</a></tt> возвращает три значения. Если было найдено свойство,
то первые два значения являются индикатором и значением для первого
свойства, чей индикатор присутствовал в списке <i>indicator-list</i>, и третье
значение является остатком списка свойств, <i>car</i> элемент которого был
индикатором (и соответственно <i>cadr</i> элемент — значением). Если ни одного
свойства не было найдено, то все три значения равны <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Третье значение
является флагом успешности или неудачи, и позволяет продолжить поиск
свойств в оставшемся списке.
</div>
                                                                          

                                                                          
<!--l. 719--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse51.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#tailclmch10.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse50.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#clmse50.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse50.html"></a>  </div> </div> 
</body></html> 
