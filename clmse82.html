<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Sorting and Merging</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-14 15:35:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1209--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch15.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse81.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse81.html#tailclmse81.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse82.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse82.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">14.5   </span> <a 
 id="x101-20300014.5"></a>Sorting and Merging</h3>
<!--l. 1211--><p class="noindent" >These functions may destructively modify argument sequences in order to put a
sequence into sorted order or to merge two already sorted sequences.
<div class=defun>
<!--l. 1215--><p class="noindent" ><i>[Function]</i><a 
 id="dx101-203001"></a><a 
 id="x101-203002r409"></a><b> sort</b>  <i>sequence</i> <i>predicate</i> &#x0026;key  <i>:key</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx101-203003"></a><a 
 id="x101-203004r410"></a><b> stable-sort</b>  <i>sequence</i> <i>predicate</i> &#x0026;key  <i>:key</i>
<!--l. 1218--><p class="noindent" ><a 
 id="dx101-203005"></a> The sequence is destructively sorted according to an order determined
by the predicate. The predicate should take two arguments, and return
non-<a 
href="clmse31.html#x42-74002r18">nil</a> if and only if the ﬁrst argument is strictly less than the second (in
some appropriate sense). If the ﬁrst argument is greater than or equal to
the second (in the appropriate sense), then the predicate should return
<a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 1227--><p class="indent" >   The <a 
href="#x101-203002r409">sort</a> function determines the relationship between two elements by giving
keys extracted from the elements to the predicate. The :key argument, when
applied to an element, should return the key for that element. The :key argument
defaults to the identity function, thereby making the element itself be the
key.
<!--l. 1233--><p class="indent" >   The :key function should not have any side eﬀects. A useful example of a :key
function would be a component selector function for a <a 
href="clmse101.html#x125-230002r585">defstruct</a> structure, used in
sorting a sequence of structures. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(sort a p :key s) ≡ (sort a #&#x2019;(lambda (x y) (p (s x) (s y))))
</td></tr></table>
<!--l. 1240--><p class="indent" >
</div>
</div>
<!--l. 1241--><p class="noindent" >While the above two expressions are equivalent, the ﬁrst may be more eﬃcient in
some implementations for certain types of arguments. For example, an
implementation may choose to apply s to each item just once, putting the
resulting keys into a separate table, and then sort the parallel tables, as
                                                                          

                                                                          
opposed to applying s to an item every time just before applying the
predicate.
<!--l. 1248--><p class="indent" >   If the :key and predicate functions always return, then the sorting operation
will always terminate, producing a sequence containing the same elements as the
original sequence (that is, the result is a permutation of sequence). This is
guaranteed even if the predicate does not really consistently represent a total order
(in which case the elements will be scrambled in some unpredictable way, but no
element will be lost). If the :key function consistently returns meaningful keys,
and the predicate does reﬂect some total ordering criterion on those keys, then the
elements of the result sequence will be properly sorted according to that
ordering.
<!--l. 1261--><p class="indent" >   The sorting operation performed by <a 
href="#x101-203002r409">sort</a> is not guaranteed stable. Elements
considered equal by the predicate may or may not stay in their original order.
(The predicate is assumed to consider two elements x and y to be equal if
(funcall predicate x y) and (funcall predicate y x) are both false.) The
function <a 
href="#x101-203004r410">stable-sort</a> guarantees stability but may be slower than <a 
href="#x101-203002r409">sort</a> in some
situations.
<!--l. 1270--><p class="indent" >   The sorting operation may be destructive in all cases. In the case of an array
argument, this is accomplished by permuting the elements in place. In the case of
a list, the list is destructively reordered in the same manner as for <a 
href="clmse78.html#x97-199012r372">nreverse</a>. Thus
if the argument should not be destroyed, the user must sort a copy of the
argument.
<!--l. 1277--><p class="indent" >   Should execution of the :key function or the predicate cause an error, the state
of the list or array being sorted is undeﬁned. However, if the error is corrected, the
sort will, of course, proceed correctly.
<!--l. 1282--><p class="indent" >   Note that since sorting requires many comparisons, and thus many calls to the
predicate, sorting will be much faster if the predicate is a compiled function rather
than interpreted.
<!--l. 1286--><p class="indent" >   An example: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq foovector (sort foovector #&#x2019;string-lessp :key #&#x2019;car))
</td></tr></table>
<!--l. 1289--><p class="indent" >
</div>
</div>
<!--l. 1290--><p class="noindent" >If foovector contained these items before the sort <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Tokens&#x0022; &#x0022;The Lion Sleeps Tonight&#x0022;)
</td></tr></table>
<!--l. 1292--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Carpenters&#x0022; &#x0022;Close to You&#x0022;)</td></tr></table>
<!--l. 1293--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Rolling Stones&#x0022; &#x0022;Brown Sugar&#x0022;)</td></tr></table>
<!--l. 1294--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Beach Boys&#x0022; &#x0022;I Get Around&#x0022;)</td></tr></table>
<!--l. 1295--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Mozart&#x0022; &#x0022;Eine Kleine Nachtmusik&#x0022; (K 525))</td></tr></table>
<!--l. 1296--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Beatles&#x0022; &#x0022;I Want to Hold Your Hand&#x0022;)</td></tr></table>
<!--l. 1298--><p class="indent" >
</div>
</div>
<!--l. 1299--><p class="noindent" >then after the sort foovector would contain <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Beach Boys&#x0022; &#x0022;I Get Around&#x0022;)
</td></tr></table>
<!--l. 1301--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Beatles&#x0022; &#x0022;I Want to Hold Your Hand&#x0022;)</td></tr></table>
<!--l. 1302--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Carpenters&#x0022; &#x0022;Close to You&#x0022;)</td></tr></table>
<!--l. 1303--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Mozart&#x0022; &#x0022;Eine Kleine Nachtmusik&#x0022; (K 525))</td></tr></table>
<!--l. 1304--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Rolling Stones&#x0022; &#x0022;Brown Sugar&#x0022;)</td></tr></table>
<!--l. 1305--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(&#x0022;Tokens&#x0022; &#x0022;The Lion Sleeps Tonight&#x0022;)</td></tr></table>
<!--l. 1307--><p class="indent" >
</div>
</div>
<div class=new>
<!--l. 1310--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx101-203006"></a>to restrict user side eﬀects; see section ??.
</div>
</div>
<div class=defun>
<!--l. 1316--><p class="noindent" ><i>[Function]</i><a 
 id="dx101-203007"></a><a 
 id="x101-203008r411"></a><b> merge</b>  <i>result-type</i> <i>sequence1</i> <i>sequence2</i> <i>predicate</i> &#x0026;key  <i>:key</i>
<!--l. 1318--><p class="noindent" >The sequences sequence1 and sequence2 are destructively merged according to an
order determined by the predicate. The result is a sequence of type result-type,
which must be a subtype of sequence, as for the function <a 
href="clmse25.html#x34-53002r7">coerce</a>. The predicate
should take two arguments and return non-<a 
href="clmse31.html#x42-74002r18">nil</a> if and only if the ﬁrst argument is
strictly less than the second (in some appropriate sense). If the ﬁrst argument is
greater than or equal to the second (in the appropriate sense), then the predicate
should return <a 
href="clmse31.html#x42-74002r18">nil</a>.
                                                                          

                                                                          
<!--l. 1329--><p class="indent" >   The <a 
href="#x101-203008r411">merge</a> function determines the relationship between two elements by
giving keys extracted from the elements to the predicate. The :key function, when
applied to an element, should return the key for that element; the :key function
defaults to the identity function, thereby making the element itself be the
key.
<!--l. 1335--><p class="indent" >   The :key function should not have any side eﬀects. A useful example of a :key
function would be a component selector function for a <a 
href="clmse101.html#x125-230002r585">defstruct</a> structure, used to
merge a sequence of structures.
<!--l. 1340--><p class="indent" >   If the :key and predicate functions always return, then the merging
operation will always terminate. The result of merging two sequences x
and y is a new sequence z, such that the length of z is the sum of the
lengths of x and y, and z contains all the elements of x and y. If x1 and x2
are two elements of x, and x1 precedes x2 in x, then x1 precedes x2 in z,
and similarly for elements of y. In short, z is an interleaving of x and
y.
<!--l. 1350--><p class="indent" >   Moreover, if x and y were correctly sorted according to the predicate, then z
will also be correctly sorted, as shown in this example. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(merge &#x2019;list &#x2019;(1 3 4 6 7) &#x2019;(2 5 8) #&#x2019;&#x003C;) ⇒ (1 2 3 4 5 6 7 8)
</td></tr></table>
<!--l. 1355--><p class="indent" >
</div>
</div>
<!--l. 1356--><p class="noindent" >If x or y is not so sorted then z will not be sorted, but will nevertheless be an
interleaving of x and y.
<!--l. 1359--><p class="indent" >   The merging operation is guaranteed stable; if two or more elements are
considered equal by the predicate, then the elements from sequence1 will precede
those from sequence2 in the result. (The predicate is assumed to consider two
elements x and y to be equal if (funcall predicate x y) and (funcall predicate y x)
are both false.) For example: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(merge &#x2019;string &#x0022;BOY&#x0022; &#x0022;nosy&#x0022; #&#x2019;char-lessp) ⇒ &#x0022;BnOosYy&#x0022;
</td></tr></table>
<!--l. 1370--><p class="indent" >
</div>
                                                                          

                                                                          
</div>
<!--l. 1371--><p class="noindent" >The result can not be &#x0022;BnoOsYy&#x0022;, &#x0022;BnOosyY&#x0022;, or &#x0022;BnoOsyY&#x0022;. The function
<a 
href="clmse74.html#x92-194038r343">char-lessp</a> ignores case, and so considers the characters Y and y to be equal, for
example; the stability property then guarantees that the character from
the ﬁrst argument (Y) must precede the one from the second argument
(y).
<div class=newer>
<!--l. 1379--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx101-203009"></a>to specify that <a 
href="#x101-203008r411">merge</a> should signal an error if the
sequence type speciﬁes the number of elements and the sum of the lengths of the
two sequence arguments is diﬀerent.
</div>
<div class=new>
<!--l. 1386--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx101-203010"></a>to restrict user side eﬀects; see section ??.
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 6--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch15.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse81.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse81.html#tailclmse81.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse82.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse82.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 6--><p class="indent" >   <a 
 id="tailclmse82.html"></a>  
</body></html> 
