<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Compiling Format Control Strings</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-30 23:01:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 891--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse138.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse136.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse136.html#tailclmse136.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse137.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch26.html#clmse137.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">26.5   </span> <a 
href="clm.html#QQ2-168-386" id="x168-34500026.5">Compiling Format Control Strings</a></h3>
<!--l. 893--><p class="noindent" >The control strings used by <tt><a 
href="clmse110.html#x137-261003r666">format</a></tt> are essentially programs that perform
printing. The macro <tt><a 
href="#x168-345002r816">formatter</a></tt> provides the eﬃciency of using a compiled
function for printing without losing the visual compactness of <tt><a 
href="clmse110.html#x137-261003r666">format</a></tt>
strings.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> formatter </b><a 
 id="dx168-345001"></a><a 
 id="x168-345002r816"></a> control-string
</td></tr></table>
<!--l. 900--><p class="indent" >
</div>
<!--l. 900--><p class="noindent" ><span class="paragraphHead"><a 
href="#x168-34600026.5" id="x168-34600026.5"></a></span>
   The <i>control-string</i> must be a literal string. An error is signaled if <i>control-string</i>
is not a valid <tt><a 
href="clmse110.html#x137-261003r666">format</a></tt> control string. The macro <tt><a 
href="#x168-345002r816">formatter</a></tt> expands into an
expression of the form <tt>(function (lambda (stream &#x0026;rest args) ...))</tt> that
does the printing speciﬁed by <i>control-string</i>. The <tt>lambda</tt> created accepts an
output stream as its ﬁrst argument and zero or more data values as its remaining
arguments. The value returned by the <tt>lambda</tt> is the tail (if any) of the data
values that are not printed out by <i>control-string</i>. (For example, if the
<i>control-string</i> is <tt>&#x0022;~A~A&#x0022;</tt>, the <tt><a 
href="clmse79.html#x99-200012r398">cddr</a></tt> (if any) of the data values is returned.)
The form <tt>(formatter &#x0022;~%~2@{~S, ~}&#x0022;)</tt> is equivalent to the following:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#&#x2019;(lambda (stream &#x0026;rest args)
</td></tr></table>
                                                                          

                                                                          
<!--l. 914--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (terpri stream)</td></tr></table>
<!--l. 915--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (dotimes (n 2)</td></tr></table>
<!--l. 916--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (if (null args) (return nil))</td></tr></table>
<!--l. 917--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (prin1 (pop args) stream)</td></tr></table>
<!--l. 918--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (write-string &#x0022;, &#x0022; stream))</td></tr></table>
<!--l. 919--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    args)</td></tr></table>
<!--l. 921--><p class="indent" >
</div>
</div>
<!--l. 923--><p class="indent" >   In support of the above mechanism, <tt><a 
href="clmse110.html#x137-261003r666">format</a></tt> is extended so that it accepts
functions as its second argument as well as strings. When a function is provided,
it must be a function of the form created by <tt><a 
href="#x168-345002r816">formatter</a></tt>. The function is called
with the appropriate output stream as its ﬁrst argument and the data
arguments to <tt><a 
href="clmse110.html#x137-261003r666">format</a></tt> as its remaining arguments. The function should perform
whatever output is necessary and return the unused tail of the arguments (if
any). The directives <tt>~?</tt> and <tt>~{~}</tt> with no body are also extended so that
they accept functions as well as control strings. Every other standard
function that takes a <tt><a 
href="clmse110.html#x137-261003r666">format</a></tt> string as an argument (for example, <tt><a 
href="clmse145.html#x178-459012r942">error</a></tt> and
<tt><a 
href="clmse144.html#x177-456002r929">warn</a></tt>) is also extended so that it can accept functions of the form above
instead.
</div>
                                                                          

                                                                          
   <!--l. 937--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse138.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse136.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse136.html#tailclmse136.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse137.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch26.html#clmse137.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 937--><p class="indent" >   <a 
 id="tailclmse137.html"></a>  
</body></html> 
