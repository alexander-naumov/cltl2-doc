<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Input Functions</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-28 14:08:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 3455--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse111.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html#tailclmse109.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse110.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch22.html#clmse110.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">22.2   </span> <a 
href="clm.html#QQ2-137-294" id="x137-25500022.2">Input Functions</a></h3>
<!--l. 3457--><p class="noindent" >The input functions are divided into two groups: those that operate on streams of
characters and those that operate on streams of binary data.
<!--l. 3461--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">22.2.1   </span> <a 
href="clmli1.html#QQ2-137-295" id="x137-25600022.2.1">Input from Character Streams</a></h4>
<!--l. 3464--><p class="noindent" >Many character input functions take optional arguments called <i>input-stream</i>,
<i>eof-error-p</i>, and <i>eof-value</i>. The <i>input-stream</i> argument is the stream from which to
obtain input; if unsupplied or <a 
href="clmse31.html#x42-74002r18">nil</a> it defaults to the value of the special variable
<a 
href="clmse106.html#x132-240002r578">*standard-input*</a>. One may also specify <a 
href="clmse31.html#x42-74004r19">t</a> as a stream, meaning the value of the
special variable <a 
href="clmse106.html#x132-240012r583">*terminal-io*</a>.
<!--l. 3473--><p class="indent" >   The <i>eof-error-p</i> argument controls what happens if input is from a ﬁle (or any
other input source that has a deﬁnite end) and the end of the ﬁle is reached. If
<i>eof-error-p</i> is true (the default), an error will be signaled at end of ﬁle. If it is
false, then no error is signaled, and instead the function returns <i>eof-value</i>. <div class=new> X3J13
voted in January 1989 <a 
 id="dx137-256001"></a>to clarify that an <i>eof-value</i> argument may be any Lisp
datum whatsoever.
</div>
<!--l. 3487--><p class="indent" >   Functions such as <a 
href="#x137-256003r634">read</a> that read the representation of an object rather than a
single character will always signal an error, regardless of <i>eof-error-p</i>, if the ﬁle
ends in the middle of an object representation. For example, if a ﬁle does not
contain enough right parentheses to balance the left parentheses in it, <a 
href="#x137-256003r634">read</a> will
complain. If a ﬁle ends in a symbol or a number immediately followed by
end-of-ﬁle, <a 
href="#x137-256003r634">read</a> will read the symbol or number successfully and when called
again will see the end-of-ﬁle and only then act according to <i>eof-error-p</i>.
Similarly, the function <a 
href="#x137-256013r638">read-line</a> will successfully read the last line of a
ﬁle even if that line is terminated by end-of-ﬁle rather than the newline
character. If a ﬁle contains ignorable text at the end, such as blank lines and
comments, <a 
href="#x137-256003r634">read</a> will not consider it to end in the middle of an object. Thus an
                                                                          

                                                                          
<i>eof-error-p</i> argument controls what happens when the ﬁle ends <i>between</i>
objects.
<!--l. 3506--><p class="indent" >   Many input functions also take an argument called <i>recursive-p</i>. If speciﬁed
and not <a 
href="clmse31.html#x42-74002r18">nil</a>, this argument speciﬁes that this call is not a “top-level” call
to <a 
href="#x137-256003r634">read</a> but an imbedded call, typically from the function for a macro
character. It is important to distinguish such recursive calls for three
reasons.
<!--l. 3512--><p class="indent" >   First, a top-level call establishes the context within which the #<i>n</i>= and #<i>n</i>#
syntax is scoped. Consider, for example, the expression <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(cons &#x2019;#3=(p q r) &#x2019;(x y . #3#))
</td></tr></table>
<!--l. 3517--><p class="indent" >
</div>
</div>
<!--l. 3518--><p class="noindent" >If the single-quote macro character were deﬁned in this way: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(set-macro-character #\&#x2019;
</td></tr></table>
<!--l. 3520--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     #&#x2019;(lambda (stream char)</td></tr></table>
<!--l. 3521--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                         (declare (ignore char))</td></tr></table>
<!--l. 3522--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                         (list &#x2019;quote (read stream))))</td></tr></table>
<!--l. 3524--><p class="indent" >
</div>
</div>
<!--l. 3525--><p class="noindent" >then the expression could not be read properly, because there would be no way to
know when <a 
href="#x137-256003r634">read</a> is called recursively by the ﬁrst occurrence of &#x2019; that the label
#3= would be referred to later in the containing expression. There would be no
way to know because <a 
href="#x137-256003r634">read</a> could not determine that it was called by a
macro-character function rather than from “top level.” The correct way to
deﬁne the single quote macro character uses the <i>recursive-p</i> argument:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(set-macro-character #\&#x2019;
</td></tr></table>
                                                                          

                                                                          
<!--l. 3534--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     #&#x2019;(lambda (stream char)</td></tr></table>
<!--l. 3535--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                         (declare (ignore char))</td></tr></table>
<!--l. 3536--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                         (list &#x2019;quote (read stream t nil t))))</td></tr></table>
<!--l. 3538--><p class="indent" >
</div>
</div>
<!--l. 3540--><p class="indent" >   Second, a recursive call does not alter whether the reading process is to
preserve whitespace or not (as determined by whether the top-level call was to
<a 
href="#x137-256003r634">read</a> or <a 
href="#x137-256007r636">read-preserving-whitespace</a>). Suppose again that the single quote had the
ﬁrst, incorrect, macro-character deﬁnition shown above. Then a call to
<a 
href="#x137-256007r636">read-preserving-whitespace</a> that read the expression &#x2019;foo  would fail to preserve
the space character following the symbol foo because the single-quote
macro-character function calls <a 
href="#x137-256003r634">read</a>, not <a 
href="#x137-256007r636">read-preserving-whitespace</a>, to read the
following expression (in this case foo). The correct deﬁnition, which passes the
value <a 
href="clmse31.html#x42-74004r19">t</a> for the <i>recursive-p</i> argument to <a 
href="#x137-256003r634">read</a>, allows the top-level call to determine
whether whitespace is preserved.
<!--l. 3553--><p class="indent" >   Third, when end-of-ﬁle is encountered and the <i>eof-error-p</i> argument is not <a 
href="clmse31.html#x42-74002r18">nil</a>,
the kind of error that is signaled may depend on the value of <i>recursive-p</i>. If
<i>recursive-p</i> is not <a 
href="clmse31.html#x42-74002r18">nil</a>, then the end-of-ﬁle is deemed to have occurred within the
middle of a printed representation; if <i>recursive-p</i> is <a 
href="clmse31.html#x42-74002r18">nil</a>, then the end-of-ﬁle may be
deemed to have occurred between objects rather than within the middle of
one.
<div class=defun>
<!--l. 3561--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256002"></a><a 
 id="x137-256003r634"></a><b> read</b>  &#x0026;optional  <i>input-stream</i> <i>eof-error-p</i> <i>eof-value</i> <i>recursive-p</i>
<!--l. 3563--><p class="noindent" ><a 
href="#x137-256003r634">read</a> reads in the printed representation of a Lisp object from <i>input-stream</i>, builds
a corresponding Lisp object, and returns the object.
<!--l. 3568--><p class="indent" >   Note that when the variable *read-suppress* is not <a 
href="clmse31.html#x42-74002r18">nil</a>, then <a 
href="#x137-256003r634">read</a> reads in a
printed representation as best it can, but most of the work of interpreting the
representation is avoided (the intent being that the result is to be discarded
anyway). For example, all extended tokens produce the result <a 
href="clmse31.html#x42-74002r18">nil</a> regardless of
their syntax.
</div>
<div class=defun>
<!--l. 3576--><p class="noindent" ><i>[Variable]</i><a 
 id="dx137-256004"></a><a 
 id="x137-256005r635"></a><b> *read-default-ﬂoat-format*</b>
<!--l. 3578--><p class="noindent" >The value of this variable must be a type speciﬁer symbol for a speciﬁc
ﬂoating-point format; these include short-ﬂoat, single-ﬂoat, double-ﬂoat, and
long-ﬂoat and may include implementation-speciﬁc types as well. The default
                                                                          

                                                                          
value is single-ﬂoat.
<!--l. 3585--><p class="indent" >   *read-default-ﬂoat-format* indicates the ﬂoating-point format to be used for
reading ﬂoating-point numbers that have no exponent marker or have e or E
for an exponent marker. (Other exponent markers explicitly prescribe
the ﬂoating-point format to be used.) The printer also uses this variable
to guide the choice of exponent markers when printing ﬂoating-point
numbers.
</div>
<div class=defun>
<!--l. 3594--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256006"></a><a 
 id="x137-256007r636"></a><b> read-preserving-whitespace</b>  &#x0026;optional  <i>in-stream</i> <i>eof-error-p</i>
<i>eof-value</i> <i>recursive-p</i>
<!--l. 3596--><p class="noindent" >Certain printed representations given to <a 
href="#x137-256003r634">read</a>, notably those of symbols and
numbers, require a delimiting character after them. (Lists do not, because the
close parenthesis marks the end of the list.) Normally <a 
href="#x137-256003r634">read</a> will throw away the
delimiting character if it is a whitespace character; but <a 
href="#x137-256003r634">read</a> will preserve the
character (using <a 
href="#x137-256018r640">unread-char</a>) if it is syntactically meaningful, because it may be
the start of the next expression.
<div class=new>
<!--l. 3606--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx137-256008"></a>to clarify the interaction of <a 
href="#x137-256018r640">unread-char</a> with
echo streams. These changes indirectly aﬀect the echoing behavior of
<a 
href="#x137-256007r636">read-preserving-whitespace</a>.
</div>
<!--l. 3613--><p class="indent" >   The function <a 
href="#x137-256007r636">read-preserving-whitespace</a> is provided for some specialized
situations where it is desirable to determine precisely what character terminated
the extended token.
<!--l. 3617--><p class="indent" >   As an example, consider this macro-character deﬁnition: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun slash-reader (stream char)
</td></tr></table>
<!--l. 3619--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (ignore char))</td></tr></table>
<!--l. 3620--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (do ((path (list (read-preserving-whitespace stream))</td></tr></table>
<!--l. 3621--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (cons (progn (read-char stream nil nil t)</td></tr></table>
<!--l. 3622--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                          (read-preserving-whitespace</td></tr></table>
<!--l. 3623--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                             stream))</td></tr></table>
<!--l. 3624--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   path)))</td></tr></table>
<!--l. 3625--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ((not (char= (peek-char nil stream nil nil t) #\/))</td></tr></table>
<!--l. 3626--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (cons &#x2019;path (nreverse path)))))</td></tr></table>
                                                                          

                                                                          
<!--l. 3627--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(set-macro-character #\/ #&#x2019;slash-reader)</td></tr></table>
<!--l. 3629--><p class="indent" >
</div>
</div>
<!--l. 3630--><p class="noindent" >(This is actually a rather dangerous deﬁnition to make because expressions such as (/
x 3) will no longer be read properly. The ability to reprogram the reader syntax is
very powerful and must be used with caution. This redeﬁnition of <a 
href="clmse105.html#x130-238016r575">/</a> is shown here
purely for the sake of example.)
<!--l. 3636--><p class="indent" >   Consider now calling <a 
href="#x137-256003r634">read</a> on this expression: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(zyedh /usr/games/zork /usr/games/boggle)
</td></tr></table>
<!--l. 3639--><p class="indent" >
</div>
</div>
<!--l. 3640--><p class="noindent" >The <a 
href="clmse105.html#x130-238016r575">/</a> macro reads objects separated by more <a 
href="clmse105.html#x130-238016r575">/</a> characters; thus /usr/games/zork is
intended to be read as (path usr games zork). The entire example expression
should therefore be read as <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(zyedh (path usr games zork) (path usr games boggle))
</td></tr></table>
<!--l. 3645--><p class="indent" >
</div>
</div>
<!--l. 3646--><p class="noindent" >However, if <a 
href="#x137-256003r634">read</a> had been used instead of <a 
href="#x137-256007r636">read-preserving-whitespace</a>, then after the
reading of the symbol zork, the following space would be discarded; the next call
to <a 
href="#x137-256022r641">peek-char</a> would see the following <a 
href="clmse105.html#x130-238016r575">/</a>, and the loop would continue, producing
this interpretation: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(zyedh (path usr games zork usr games boggle))
</td></tr></table>
<!--l. 3653--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 3654--><p class="noindent" >On the other hand, there are times when whitespace <i>should</i> be discarded. If a
command interpreter takes single-character commands, but occasionally reads a
Lisp object, then if the whitespace after a symbol is not discarded it might be
interpreted as a command some time later after the symbol had been
read.
<!--l. 3660--><p class="indent" >   Note that <a 
href="#x137-256007r636">read-preserving-whitespace</a> behaves <i>exactly</i> like <a 
href="#x137-256003r634">read</a> when the
<i>recursive-p</i> argument is not <a 
href="clmse31.html#x42-74002r18">nil</a>. The distinction is established only by calls with
<i>recursive-p</i> equal to <a 
href="clmse31.html#x42-74002r18">nil</a> or omitted.
</div>
<div class=defun>
<!--l. 3665--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256009"></a><a 
 id="x137-256010r637"></a><b> read-delimited-list</b>  <i>char</i> &#x0026;optional  <i>input-stream</i> <i>recursive-p</i>
<!--l. 3667--><p class="noindent" >This reads objects from <i>stream</i> until the next character after an object&#x2019;s
representation (ignoring whitespace characters and comments) is <i>char</i>. (The <i>char</i>
should not have whitespace syntax in the current readtable.) A list of the objects
read is returned.
<!--l. 3674--><p class="indent" >   To be more precise, <a 
href="#x137-256010r637">read-delimited-list</a> looks ahead at each step for the next
non-whitespace character and peeks at it as if with <a 
href="#x137-256022r641">peek-char</a>. If it is <i>char</i>, then
the character is consumed and the list of objects is returned. If it is a constituent
or escape character, then <a 
href="#x137-256003r634">read</a> is used to read an object, which is added to the end
of the list. If it is a macro character, the associated macro function is called; if the
function returns a value, that value is added to the list. The peek-ahead process is
then repeated.
<div class=new>
<!--l. 3685--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx137-256011"></a>to clarify the interaction of <a 
href="#x137-256022r641">peek-char</a> with echo
streams. These changes indirectly aﬀect the echoing behavior of the function
<a 
href="#x137-256010r637">read-delimited-list</a>.
</div>
<!--l. 3692--><p class="indent" >   This function is particularly useful for deﬁning new macro characters. Usually
it is desirable for the terminating character <i>char</i> to be a terminating macro
character so that it may be used to delimit tokens; however, <a 
href="#x137-256010r637">read-delimited-list</a>
makes no attempt to alter the syntax speciﬁed for <i>char</i> by the current readtable.
The user must make any necessary changes to the readtable syntax explicitly. The
following example illustrates this.
<!--l. 3700--><p class="indent" >   Suppose you wanted #{<i>a</i> <i>b</i> <i>c</i> ... <i>z</i>} to be read as a list of all pairs of the
elements <i>a</i>, <i>b</i>, <i>c</i>, ..., <i>z</i>; for example: <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#{p q z a}  reads as  ((p q) (p z) (p a) (q z) (q a) (z a))
</td></tr></table>
<!--l. 3705--><p class="indent" >
</div>
</div>
<!--l. 3706--><p class="noindent" >This can be done by specifying a macro-character deﬁnition for #{ that does
two things: read in all the items up to the }, and construct the pairs.
<a 
href="#x137-256010r637">read-delimited-list</a> performs the ﬁrst task.
<div class=new>
<!--l. 3712--><p class="indent" >   Note that <a 
href="clmse42.html#x54-125013r100">mapcon</a> allows the mapped function to examine the items of the list
after the current one, and that <a 
href="clmse42.html#x54-125013r100">mapcon</a> uses <a 
href="clmse132.html#x163-331006r792">nconc</a>, which is all right because
<a 
href="clmse42.html#x54-125003r95">mapcar</a> will produce fresh lists.
</div>
                                                                          

                                                                          
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun |#{-reader| (stream char arg)
</td></tr></table>
<!--l. 3721--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (ignore char arg))</td></tr></table>
<!--l. 3722--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (mapcon #&#x2019;(lambda (x)</td></tr></table>
<!--l. 3723--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              (mapcar #&#x2019;(lambda (y) (list (car x) y)) (cdr x)))</td></tr></table>
<!--l. 3724--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (read-delimited-list #\} stream t)))</td></tr></table>
<!--l. 3725--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 3726--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(set-dispatch-macro-character #\# #\{ #&#x2019;|#{-reader|)</td></tr></table>
<!--l. 3727--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 3728--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(set-macro-character #\} (get-macro-character #\) <a 
href="clmse31.html#x42-74002r18">nil</a>))</td></tr></table>
<!--l. 3730--><p class="indent" >
</div>
</div>
<!--l. 3731--><p class="noindent" >(Note that <a 
href="clmse31.html#x42-74004r19">t</a> is speciﬁed for the <i>recursive-p</i> argument.)
<!--l. 3733--><p class="indent" >   It is necessary here to give a deﬁnition to the character } as well to prevent it
from being a constituent. If the line <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(set-macro-character #\} (get-macro-character #\) <a 
href="clmse31.html#x42-74002r18">nil</a>))
</td></tr></table>
<!--l. 3738--><p class="indent" >
</div>
</div>
<!--l. 3739--><p class="noindent" >shown above were not included, then the } in <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#{p q z a}
</td></tr></table>
<!--l. 3742--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 3743--><p class="noindent" >would be considered a constituent character, part of the symbol named a}. One could
correct for this by putting a space before the }, but it is better simply to use the
call to <a 
href="clmse109.html#x136-252014r616">set-macro-character</a>.
<!--l. 3748--><p class="indent" >   Giving } the same deﬁnition as the standard deﬁnition of the character ) has
the twin beneﬁt of making it terminate tokens for use with <a 
href="#x137-256010r637">read-delimited-list</a> and
also making it illegal for use in any other context (that is, attempting to read a
stray } will signal an error).
<!--l. 3754--><p class="indent" >   Note that <a 
href="#x137-256010r637">read-delimited-list</a> does not take an <i>eof-error-p</i> (or <i>eof-value</i>)
argument. The reason is that it is always an error to hit end-of-ﬁle during the
operation of <a 
href="#x137-256010r637">read-delimited-list</a>.
</div>
<div class=defun>
<!--l. 3760--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256012"></a><a 
 id="x137-256013r638"></a><b> read-line</b>  &#x0026;optional  <i>input-stream</i> <i>eof-error-p</i> <i>eof-value</i>
<i>recursive-p</i>
<!--l. 3762--><p class="noindent" ><a 
href="#x137-256013r638">read-line</a> reads in a line of text terminated by a newline. It returns the line as a
character string (<i>without</i> the newline character). This function is usually
used to get a line of input from the user. A second returned value is a
ﬂag that is false if the line was terminated normally, or true if end-of-ﬁle
terminated the (non-empty) line. If end-of-ﬁle is encountered immediately (that
is, appears to terminate an empty line), then end-of-ﬁle processing is
controlled in the usual way by the <i>eof-error-p</i>, <i>eof-value</i>, and <i>recursive-p</i>
arguments.
<!--l. 3772--><p class="indent" >   The corresponding output function is <a 
href="clmse111.html#x138-259028r658">write-line</a>.
</div>
<div class=defun>
<!--l. 3775--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256014"></a><a 
 id="x137-256015r639"></a><b> read-char</b>  &#x0026;optional  <i>input-stream</i> <i>eof-error-p</i> <i>eof-value</i>
<i>recursive-p</i>
<!--l. 3777--><p class="noindent" ><a 
href="#x137-256015r639">read-char</a> inputs one character from <i>input-stream</i> and returns it as a character
object.
<!--l. 3781--><p class="indent" >   The corresponding output function is <a 
href="clmse111.html#x138-259024r656">write-char</a>.
<div class=new>
<!--l. 3784--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx137-256016"></a>to clarify the interaction of <a 
href="#x137-256015r639">read-char</a> with echo
streams (as created by <a 
href="clmse107.html#x133-241010r589">make-echo-stream</a>). A character is echoed from the input
stream to the associated output stream the ﬁrst time it is seen. If a character is
read again because of an intervening <a 
href="#x137-256018r640">unread-char</a> operation, the character
is not echoed again when read for the second time or any subsequent
time.
</div>
                                                                          

                                                                          
</div>
<div class=defun>
<!--l. 3794--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256017"></a><a 
 id="x137-256018r640"></a><b> unread-char</b>  <i>character</i> &#x0026;optional  <i>input-stream</i>
<!--l. 3796--><p class="noindent" ><a 
href="#x137-256018r640">unread-char</a> puts the <i>character</i> onto the front of <i>input-stream</i>. The <i>character</i>
must be the same character that was most recently read from the <i>input-stream</i>.
The <i>input-stream</i> “backs up” over this character; when a character is next read
from <i>input-stream</i>, it will be the speciﬁed character followed by the previous
contents of <i>input-stream</i>. <a 
href="#x137-256018r640">unread-char</a> returns <a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 3804--><p class="indent" >   One may apply <a 
href="#x137-256018r640">unread-char</a> only to the character most recently read from
<i>input-stream</i>. Moreover, one may not invoke <a 
href="#x137-256018r640">unread-char</a> twice consecutively
without an intervening <a 
href="#x137-256015r639">read-char</a> operation. The result is that one may back up
only by one character, and one may not insert any characters into the input
stream that were not already there.
<div class=new>
<!--l. 3811--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx137-256019"></a>to clarify that one also may not invoke
<a 
href="#x137-256018r640">unread-char</a> after invoking <a 
href="#x137-256022r641">peek-char</a> without an intervening <a 
href="#x137-256015r639">read-char</a> operation.
This is consistent with the notion that <a 
href="#x137-256022r641">peek-char</a> behaves much like <a 
href="#x137-256015r639">read-char</a>
followed by <a 
href="#x137-256018r640">unread-char</a>.
</div>
<div class=rationale>
<!--l. 3820--><p class="noindent" ><b>Обоснование:</b> This is not intended to be a general mechanism, but rather an eﬃcient
mechanism for allowing the Lisp reader and other parsers to perform one-character
lookahead in the input stream. This protocol admits a wide variety of eﬃcient
implementations, such as simply decrementing a buﬀer pointer. To have to specify the
character in the call to <a 
href="#x137-256018r640">unread-char</a> is admittedly redundant, since at any given time
there is only one character that may be legally speciﬁed. The redundancy is intentional,
again to give the implementation latitude.
</div>
<div class=new>
<!--l. 3834--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx137-256020"></a>to clarify the interaction of <a 
href="#x137-256018r640">unread-char</a> with
echo streams (as created by <a 
href="clmse107.html#x133-241010r589">make-echo-stream</a>). When a character is “unread”
from an echo stream, no attempt is made to “unecho” the character. However, a
character placed back into an echo stream by <a 
href="#x137-256018r640">unread-char</a> will not be re-echoed
when it is subsequently re-read by <a 
href="#x137-256015r639">read-char</a>.
</div>
</div>
<!--l. 3844--><p class="indent" >
                                                                          

                                                                          
<div class=defun>
<!--l. 3846--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256021"></a><a 
 id="x137-256022r641"></a><b> peek-char</b>  &#x0026;optional  <i>peek-type</i> <i>input-stream</i> <i>eof-error-p</i> <i>eof-value</i>
<i>recursive-p</i>
<!--l. 3848--><p class="noindent" >What <a 
href="#x137-256022r641">peek-char</a> does depends on the <i>peek-type</i>, which defaults to <a 
href="clmse31.html#x42-74002r18">nil</a>.
With a <i>peek-type</i> of <a 
href="clmse31.html#x42-74002r18">nil</a>, <a 
href="#x137-256022r641">peek-char</a> returns the next character to be read
from <i>input-stream</i>, without actually removing it from the input stream.
The next time input is done from <i>input-stream</i>, the character will still
be there. It is as if one had called <a 
href="#x137-256015r639">read-char</a> and then <a 
href="#x137-256018r640">unread-char</a> in
succession.
<!--l. 3857--><p class="indent" >   If <i>peek-type</i> is <a 
href="clmse31.html#x42-74004r19">t</a>, then <a 
href="#x137-256022r641">peek-char</a> skips over whitespace characters (but not
comments) and then performs the peeking operation on the next character. This
is useful for ﬁnding the (possible) beginning of the next printed representation of
a Lisp object. The last character examined (the one that starts an object) is not
removed from the input stream.
<!--l. 3866--><p class="indent" >   If <i>peek-type</i> is a character object, then <a 
href="#x137-256022r641">peek-char</a> skips over input characters
until a character that is <a 
href="clmse72.html#x90-191018r327">char=</a> to that object is found; that character is left in the
input stream.
<div class=new>
<!--l. 3872--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx137-256023"></a>to clarify the interaction of <a 
href="#x137-256022r641">peek-char</a> with echo
streams (as created by <a 
href="clmse107.html#x133-241010r589">make-echo-stream</a>). When a character from an echo stream
is only peeked at, it is not echoed at that time. The character remains in the
input stream and may be echoed when read by <a 
href="#x137-256015r639">read-char</a> at a later time. Note,
however, that if the <i>peek-type</i> is not <a 
href="clmse31.html#x42-74002r18">nil</a>, then characters skipped over
(and therefore consumed) by <a 
href="#x137-256022r641">peek-char</a> are treated as if they had been
read by <a 
href="#x137-256015r639">read-char</a>, and will be echoed if <a 
href="#x137-256015r639">read-char</a> would have echoed
them.
</div>
</div>
<div class=defun>
<!--l. 3884--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256024"></a><a 
 id="x137-256025r642"></a><b> listen</b>  &#x0026;optional  <i>input-stream</i>
<!--l. 3886--><p class="noindent" >The predicate <a 
href="#x137-256025r642">listen</a> is true if there is a character immediately available from
<i>input-stream</i>, and is false if not. This is particularly useful when the stream
obtains characters from an interactive device such as a keyboard. A call to
<a 
href="#x137-256015r639">read-char</a> would simply wait until a character was available, but <a 
href="#x137-256025r642">listen</a> can sense
whether or not input is available and allow the program to decide whether or not
to attempt input. On a non-interactive stream, the general rule is that <a 
href="#x137-256025r642">listen</a> is
true except when at end-of-ﬁle.
</div>
                                                                          

                                                                          
<div class=defun>
<!--l. 3898--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256026"></a><a 
 id="x137-256027r643"></a><b> read-char-no-hang</b>  &#x0026;optional  <i>input-stream</i> <i>eof-error-p</i> <i>eof-value</i>
<i>recursive-p</i>
<!--l. 3900--><p class="noindent" >This function is exactly like <a 
href="#x137-256015r639">read-char</a>, except that if it would be necessary to
wait in order to get a character (as from a keyboard), <a 
href="clmse31.html#x42-74002r18">nil</a> is immediately
returned without waiting. This allows one to eﬃciently check for input
availability and get the input if it is available. This is diﬀerent from the <a 
href="#x137-256025r642">listen</a>
operation in two ways. First, <a 
href="#x137-256027r643">read-char-no-hang</a> potentially reads a character,
whereas <a 
href="#x137-256025r642">listen</a> never inputs a character. Second, <a 
href="#x137-256025r642">listen</a> does not distinguish
between end-of-ﬁle and no input being available, whereas <a 
href="#x137-256027r643">read-char-no-hang</a>
does make that distinction, returning <i>eof-value</i> at end-of-ﬁle (or signaling
an error if no <i>eof-error-p</i> is true) but always returning <a 
href="clmse31.html#x42-74002r18">nil</a> if no input is
available.
</div>
<div class=defun>
<!--l. 3916--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256028"></a><a 
 id="x137-256029r644"></a><b> clear-input</b>  &#x0026;optional  <i>input-stream</i>
<!--l. 3918--><p class="noindent" >This clears any buﬀered input associated with <i>input-stream</i>. It is primarily useful
for clearing type-ahead from keyboards when some kind of asynchronous error has
occurred. If this operation doesn&#x2019;t make sense for the stream involved, then
<a 
href="#x137-256029r644">clear-input</a> does nothing. <a 
href="#x137-256029r644">clear-input</a> returns <a 
href="clmse31.html#x42-74002r18">nil</a>.
</div>
<div class=defun>
<!--l. 3926--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256030"></a><a 
 id="x137-256031r645"></a><b> read-from-string</b>  <i>string</i> &#x0026;optional  <i>eof-error-p</i> <i>eof-value</i> &#x0026;key
<i>:start</i> <i>:end</i> <i>:preserve-whitespace</i>
<!--l. 3928--><p class="noindent" >The characters of <i>string</i> are given successively to the Lisp reader, and the Lisp
object built by the reader is returned. Macro characters and so on will all take
eﬀect.
<!--l. 3933--><p class="indent" >   The arguments :start and :end delimit a substring of <i>string</i> beginning at the
character indexed by :start and up to but not including the character indexed by
:end. By default :start is 0 (the beginning of the string) and :end is (length
<i>string</i>). This is the same as for other string functions.
<!--l. 3939--><p class="indent" >   The ﬂag :preserve-whitespace, if provided and not <a 
href="clmse31.html#x42-74002r18">nil</a>, indicates that the
operation should preserve whitespace as for <a 
href="#x137-256007r636">read-preserving-whitespace</a>. It
defaults to <a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 3943--><p class="indent" >   As with other reading functions, the arguments <i>eof-error-p</i> and <i>eof-value</i>
control the action if the end of the (sub)string is reached before the operation is
completed; reaching the end of the string is treated as any other end-of-ﬁle
event.
                                                                          

                                                                          
<!--l. 3949--><p class="indent" >   <a 
href="#x137-256031r645">read-from-string</a> returns two values: the ﬁrst is the object read, and the second
is the index of the ﬁrst character in the string not read. If the entire string was
read, the second result will be either the length of the string or one greater than
the length of the string. The parameter :preserve-whitespace may aﬀect this
second value.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(read-from-string &#x0022;(a b c)&#x0022;) <span class="math"> ⇒</span> (a b c) and 7
</td></tr></table>
<!--l. 3958--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 3961--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-256032"></a><a 
 id="x137-256033r646"></a><b> parse-integer</b>  <i>string</i> &#x0026;key  <i>:start</i> <i>:end</i> <i>:radix</i> <i>:junk-allowed</i>
<!--l. 3963--><p class="noindent" >This function examines the substring of <i>string</i> delimited by :start and :end (which
default to the beginning and end of the string). It skips over whitespace characters
and then attempts to parse an integer. The :radix parameter defaults to 10 and
must be an integer between 2 and 36.
<!--l. 3970--><p class="indent" >   If :junk-allowed is not <a 
href="clmse31.html#x42-74002r18">nil</a>, then the ﬁrst value returned is the value of the
number parsed as an integer or <a 
href="clmse31.html#x42-74002r18">nil</a> if no syntactically correct integer was
seen.
<!--l. 3975--><p class="indent" >   If :junk-allowed is <a 
href="clmse31.html#x42-74002r18">nil</a> (the default), then the entire substring is scanned. The
returned value is the value of the number parsed as an integer. An error is
signaled if the substring does not consist entirely of the representation of an
integer, possibly surrounded on either side by whitespace characters.
<!--l. 3981--><p class="indent" >   In either case, the second value is the index into the string of the delimiter
that terminated the parse, or it is the index beyond the substring if the parse
terminated at the end of the substring (as will always be the case if :junk-allowed
is false).
<!--l. 3986--><p class="indent" >   Note that <a 
href="#x137-256033r646">parse-integer</a> does not recognize the syntactic radix-speciﬁer preﬁxes
#O, #B, #X, and #<i>n</i>R, nor does it recognize a trailing decimal point. It permits
only an optional sign (<a 
href="clmse105.html#x130-238002r568">+</a> or <a 
href="clmse105.html#x130-238008r571">-</a>) followed by a non-empty sequence of digits in the
speciﬁed radix.
</div>
                                                                          

                                                                          
   <h4 class="subsectionHead"><span class="titlemark">22.2.2   </span> <a 
href="clmli1.html#QQ2-137-296" id="x137-25700022.2.2">Input from Binary Streams</a></h4>
<!--l. 3996--><p class="noindent" >Common Lisp currently speciﬁes only a very simple facility for binary input: the
reading of a single byte as an integer.
<div class=defun>
<!--l. 3999--><p class="noindent" ><i>[Function]</i><a 
 id="dx137-257001"></a><a 
 id="x137-257002r647"></a><b> read-byte</b>  <i>binary-input-stream</i> &#x0026;optional  <i>eof-error-p</i> <i>eof-value</i>
<!--l. 4001--><p class="noindent" ><a 
href="#x137-257002r647">read-byte</a> reads one byte from the <i>binary-input-stream</i> and returns it in the form
of an integer.
</div>
                                                                          

                                                                          
   <!--l. 4006--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse111.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html#tailclmse109.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch22.html#clmse110.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 4006--><p class="indent" >   <a 
 id="tailclmse110.html"></a>  
</body></html> 
