<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Создание новых потоков</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 23:44:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 809--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse111.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html#tailclmse109.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse110.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse110.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">21.2   </span> <a 
href="clm.html#QQ2-136-1887" id="x136-185700021.2">Создание новых
потоков</a></h3>
<!--l. 811--><p class="noindent" >Пожалуй самые важные конструкции для создания новых потоков это то,
которые открывают файлы. Смотрите <tt><a 
href="clmli7.html#x196-3480004r1004">with-open-file</a></tt> и <tt><a 
href="clmli7.html#x196-3479682r682">open</a></tt>. Следующие
функции создают потоки без ссылок на файловую систему.
<div class="defun">
<!--l. 815--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx136-1857001"></a><a 
 id="x136-1857002r607"></a><b> make-synonym-stream</b>  <i>symbol</i>
</div>
<!--l. 817--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-185800021.2" id="x136-185800021.2"></a></span>
<tt>
   <a 
href="clmli7.html#x196-3479589r589">make-synonym-stream</a></tt> создаёт и возвращает поток-синоним. Любые
операции на новом потоке будут проделаны на потоке, являющемся
значением динамической переменной с именем <i>symbol</i>. Если значение этой
переменной изменится или будет пересвязано, то поток-синоним будет
воздействовать на новый установленный поток.
<!--l. 824--><p class="indent" >   The result of <tt><a 
href="clmli7.html#x196-3479589r589">make-synonym-stream</a></tt> is always a stream of type <tt>synonym-stream</tt>.
Note that the type of a synonym stream is <i>always</i> <tt>synonym-stream</tt>, regardless of
the type of the stream for which it is a synonym.
<!--l. 829--><p class="indent" >   Результат <tt><a 
href="clmli7.html#x196-3479589r589">make-synonym-stream</a></tt> всегда является потоком типа
<tt>synonym-stream</tt>.
<!--l. 832--><p class="indent" >   Следует отметить, что тип потока-синонима <i>всегда</i> <tt>synonym-stream</tt>, вне
зависимости от того, какой тип у связанного потока.
</div>
<div class="defun">
<!--l. 836--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx136-1858001"></a><a 
 id="x136-1858002r608"></a><b> make-broadcast-stream</b>  &#x0026;rest  <i>streams</i>
</div>
<!--l. 838--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-185900021.2" id="x136-185900021.2"></a></span>
   Эта функция возвращает поток, который работает только для записи.
Любая выходная информация, посланная в этот поток, будет отослана в все
указанные потоки <i>streams</i>. Множество операций, которые могут быть
выполнены на новом потоке, является пересечением множеств операций
                                                                          

                                                                          
для указанных потоков. Результаты, возвращаемые операциями над
новым потоком, являются результатами возвращёнными операциями на
последнем потоке из списка <i>streams</i>. Результаты полученные в ходе
выполнения функции над всеми, кроме последнего, потоками игнорируются.
Если не было передано ни одного потока в аргументе <i>streams</i>, тогда
результат является «кусочком клоаки». Вся выводимая информация будет
игнорироваться.
<!--l. 852--><p class="indent" >   Результат <tt><a 
href="clmli7.html#x196-3479570r570">make-broadcast-stream</a></tt> всегда является потоком типа
<tt>broadcast-stream</tt>.
</div>
<div class="defun">
<!--l. 856--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx136-1859001"></a><a 
 id="x136-1859002r609"></a><b> make-concatenated-stream</b>  &#x0026;rest  <i>streams</i>
</div>
<!--l. 858--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186000021.2" id="x136-186000021.2"></a></span>
   Данная функция возвращает поток, который работает только для чтения.
Входная информация берётся из первого потоки из списка <i>streams</i> пока
указатель не достигнет конца-файла end-of-ﬁle, затем данный поток
откладывается, и входная информация берётся из следующего, и так
далее. Если список потоков <i>stream</i> был пуст, то возвращается поток без
содержимого. Любая попытка чтения будет возвращать конец-файла
end-of-ﬁle.
<!--l. 866--><p class="indent" >   Результат <tt><a 
href="clmli7.html#x196-3479571r571">make-concatenated-stream</a></tt> всегда является потоком типа
<tt>concatenated-stream</tt>.
</div>
<div class="defun">
<!--l. 870--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx136-1860001"></a><a 
 id="x136-1860002r610"></a><b> make-two-way-stream</b>  <i>input-stream</i> <i>output-stream</i>
</div>
<!--l. 872--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186100021.2" id="x136-186100021.2"></a></span>
   Данная функция возвращает поток для чтения и записи, который
входную информацию получает из <i>input-stream</i> и посылает выходную
информацию в <i>output-stream</i>.
<!--l. 877--><p class="indent" >   Результат <tt><a 
href="clmli7.html#x196-3479590r590">make-two-way-stream</a></tt> всегда является потоком типа
<tt>two-stream-stream</tt>.
</div>
<div class="defun">
                                                                          

                                                                          
<!--l. 881--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx136-1861001"></a><a 
 id="x136-1861002r611"></a><b> make-echo-stream</b>  <i>input-stream</i> <i>output-stream</i>
</div>
<!--l. 883--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186200021.2" id="x136-186200021.2"></a></span>
   Данная функция возвращает поток для чтения и записи, который
получает входную информацию из <i>input-stream</i> и отсылает выходную в
<i>output-stream</i>. В дополнение, входная информация посылается в <i>output-stream</i>
(эхо).
<!--l. 888--><p class="indent" >   Результат <tt><a 
href="clmli7.html#x196-3479574r574">make-echo-stream</a></tt> всегда является потоком типа <tt>echo-stream</tt>.
<div class="new">
<!--l. 892--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx136-1862001"></a>to clarify the interaction of <tt><a 
href="clmli7.html#x196-3479765r765">read-char</a></tt>,
<tt><a 
href="clmli7.html#x196-3479969r969">unread-char</a></tt>, and <tt><a 
href="clmli7.html#x196-3479709r709">peek-char</a></tt> with echo streams. (See the descriptions of those
functions for details.)
<!--l. 898--><p class="indent" >   X3J13 explicitly noted that the bidirectional streams that are the initial values
of <tt><a 
href="clmli7.html#x196-3479039r39">*query-io*</a></tt>, <tt><a 
href="clmli7.html#x196-3479011r11">*debug-io*</a></tt>, and <tt><a 
href="clmli7.html#x196-3479050r50">*terminal-io*</a></tt>, even though they may have
some echoing behavior, conceptually are not necessarily the products of calls to
<tt><a 
href="clmli7.html#x196-3479574r574">make-echo-stream</a></tt> and therefore are not subject to the new rules about
echoing on echo streams. Instead, these initial interactive streams may have
implementation-dependent echoing behavior.
</div>
</div>
<div class="defun">
<!--l. 908--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx136-1862002"></a><a 
 id="x136-1862003r612"></a><b> make-string-input-stream</b>  <i>string</i> &#x0026;optional  <i>start</i> <i>end</i>
</div>
<!--l. 910--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186300021.2" id="x136-186300021.2"></a></span>
   Данная функция возвращает поток для чтения. Данный поток
последовательно будет сохранять строковые символы в подстроке в строке
<i>string</i> ограниченной с помощью <i>start</i> и <i>end</i>. После того, как будет достигнут
последний символ, поток вернёт конец-файла.
<!--l. 916--><p class="indent" >   Результат <tt><a 
href="clmli7.html#x196-3479586r586">make-string-input-stream</a></tt> всегда является потоком типа
<tt>string-stream</tt>.
</div>
<div class="defun">
<!--l. 920--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx136-1863001"></a><a 
 id="x136-1863002r613"></a><b> make-string-output-stream</b>  &#x0026;key  <i>:element-type</i>
</div>
                                                                          

                                                                          
<!--l. 922--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186400021.2" id="x136-186400021.2"></a></span>
   Данная функция возвращает поток для записи, который будет
аккумулировать всю полученную информацию в строку, которая может быть
получена с помощью функции <tt><a 
href="clmli7.html#x196-3479450r450">get-output-stream-string</a></tt>.
<!--l. 927--><p class="indent" >   Аргумент <tt>:element-type</tt> указывает, какие символы могут приниматься
потоком. Если аргумент <tt>:element-type</tt> опущен, созданный поток должен
принимать все символы.
<!--l. 931--><p class="indent" >   Результатом <tt><a 
href="clmli7.html#x196-3479587r587">make-string-output-stream</a></tt> всегда является поток типа
<tt>string-stream</tt>.
</div>
<div class="defun">
<!--l. 935--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx136-1864001"></a><a 
 id="x136-1864002r614"></a><b> get-output-stream-string</b>  <i>string-output-stream</i>
</div>
<!--l. 937--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186500021.2" id="x136-186500021.2"></a></span>
   Данная функция возвращает строку, для потока, возвращённого
функцией <tt><a 
href="clmli7.html#x196-3479587r587">make-string-output-stream</a></tt>, которая содержит все записанную в
данный поток информацию. После этого поток сбрасывается. Таким
образом каждый вызов <tt><a 
href="clmli7.html#x196-3479450r450">get-output-stream-string</a></tt> возвращает только те
символы, которые были записаны с момента предыдущего вызова этой
функции (или создания потока, если предыдущего вызова ещё не
было).
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 947--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i><b> with-open-stream </b> <a 
 id="dx136-1865001"></a><a 
 id="x136-1865002r615"></a> (var stream) {declaration}* {form}*
   <br>
<!--l. 948--><p class="noindent" ></div>
<!--l. 948--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186600021.2" id="x136-186600021.2"></a></span>
</div>
<!--l. 949--><p class="indent" >   Форма <i>stream</i> вычисляется и должна вернуть поток. Переменная <i>var</i>
связывается с этим потоком, и затем выполняются формы тела как неявный
                                                                          

                                                                          
<tt><a 
href="clmli7.html#x196-3479745r745">progn</a></tt>. Результатом выполнения <tt><a 
href="clmli7.html#x196-3480005r1005">with-open-stream</a></tt> является значение
последней формы. Поток автоматически закрывается при выходе из формы
<tt><a 
href="clmli7.html#x196-3480005r1005">with-open-stream</a></tt>, вне зависимости от типа выхода. Смотрите <tt><a 
href="clmli7.html#x196-3479234r234">close</a></tt>. Поток
следует рассматривать, как имеющий динамическую продолжительность
видимости.
<!--l. 958--><p class="indent" >   Результатом <tt><a 
href="clmli7.html#x196-3480005r1005">with-open-stream</a></tt> всегда является поток типа <tt>file-stream</tt>.
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 963--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i><b> with-input-from-string </b> <a 
 id="dx136-1866001"></a><a 
 id="x136-1866002r616"></a> (var string {keyword value}*)
   <br>                                                               {declaration}* {form}*<br>
<!--l. 965--><p class="noindent" ></div>
<!--l. 965--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186700021.2" id="x136-186700021.2"></a></span>
</div>
<!--l. 966--><p class="indent" >   Тело выполняется как неявный <tt><a 
href="clmli7.html#x196-3479745r745">progn</a></tt> с переменной <i>var</i> связанной с
потоком символов для чтения, который последовательно предоставляет
символы из значения формы <i>string</i>. <tt><a 
href="clmli7.html#x196-3480003r1003">with-input-from-string</a></tt> возвращает
результат выполнения последней формы <i>form</i> тела.
<!--l. 971--><p class="indent" >   Результатом <tt>with-input-from-stream</tt> всегда является поток типа
<tt>string-stream</tt>.
<!--l. 974--><p class="indent" >   В параметрах могут использоваться следующие имена:
      <div class="quotation">
<div class="flushdesc">
      <!--l. 977--><p class="noindent" >
     <ul><li><b>
<tt>:index</tt> </b></li>Форма  после  <tt>:index</tt> должна  быть  <i>местом</i>,  в  которое
     можно  осуществить  запись  с  помощью  <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>.  Если  форма
     <tt><a 
href="clmli7.html#x196-3480003r1003">with-input-from-string</a></tt> завершается  нормально,  то  <i>место</i>
     будет содержать позицию первого не прочитанного символа
     из строки <i>string</i> (или длину строки, если все символы были
                                                                          

                                                                          
     прочитаны). <i>Место</i> не изменяется в процессе чтения, а только
     во время выхода.
     <li><b>
<tt>:start</tt> </b></li><tt>:start</tt> принимает  аргумент,  указывающий  позицию  с
     которой  необходимо  начинать  чтение  символов  из  строки
     <i>string</i>.
     <li><b>
<tt>:end</tt> </b></li>The <tt>:end</tt> keyword takes an argument indicating, in the manner
     usual for sequence functions, the end of a substring of <i>string</i> to
     be used. <tt>:end</tt> принимает аргумент, указывающий на позицию
     на которой необходимо завершить чтение символов из строки
     <i>string</i>
     </ul>
</div>
      </div>
<!--l. 999--><p class="indent" >   The <tt>:start</tt> and <tt>:index</tt> keywords may both specify the same variable, which
is a pointer within the string to be advanced, perhaps repeatedly by some
containing loop.
<!--l. 1003--><p class="indent" >   Вот простой пример использования <tt><a 
href="clmli7.html#x196-3480003r1003">with-input-from-string</a></tt>: <div class="lisp"><div class="tabbing">
(with-input-from-string (s &#x0022;Animal Crackers&#x0022; :index j :start 6)
   <br>                                                                  (read s)) <span class="math"> ⇒</span> crackers<br>
<!--l. 1007--><p class="noindent" ></div>
<!--l. 1007--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186800021.2" id="x136-186800021.2"></a></span>
<!--l. 1007--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-186900021.2" id="x136-186900021.2"></a></span>
</div>
<!--l. 1008--><p class="indent" >   В качестве побочного эффекта переменная <tt>j</tt> будет установлена в
<tt>15</tt>.
<div class="new">
                                                                          

                                                                          
<!--l. 1011--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx136-1869001"></a>to restrict user side eﬀects; see section
<a 
href="clmse43.html#x55-7040007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<tt>
<!--l. 1016--><p class="indent" >   :start</tt> и <tt>:index</tt> могут оба содержать одну переменную, указывающую
позицию в строке, возможно, внутри цикла.
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 1021--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i><b> with-output-to-string </b> <a 
 id="dx136-1869002"></a><a 
 id="x136-1869003r617"></a> (var [string [(:element-type type)]])
   <br>                                                               {declaration}* {form}*<br>
<!--l. 1023--><p class="noindent" ></div>
<!--l. 1023--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-187000021.2" id="x136-187000021.2"></a></span>
</div>
<!--l. 1024--><p class="indent" >   Можно указать <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt> вместо строки <i>string</i> и использовать аргумент
<tt>:element-type</tt> для указания, какие символы должны приниматься
созданным потоком. Если аргумент <i>string</i> не указан или он <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt> и не
указан <tt>:element-type</tt>, то созданный поток должен принимать все
символы.
<!--l. 1029--><p class="indent" >   If <i>string</i> is speciﬁed, it must be a string with a ﬁll pointer; the output is
incrementally appended to the string (as if by use of <tt><a 
href="clmli7.html#x196-3479990r990">vector-push-extend</a></tt>).
<!--l. 1033--><p class="indent" >   In this way output cannot be accidentally lost. This change makes
<tt>with-output-to-string</tt> behave in the same way that <tt><a 
href="clmli7.html#x196-3479423r423">format</a></tt> does when given a
string as its ﬁrst argument.
<!--l. 1037--><p class="indent" >   Результатом <tt>with-output-to-stream</tt> всегда является поток типа
<tt>string-stream</tt>.
<!--l. 1040--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx136-1870001"></a>to restrict user side eﬀects; see section
<a 
href="clmse43.html#x55-7040007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
                                                                          

                                                                          
<!--l. 1045--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse111.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html#tailclmse109.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse110.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse110.html"></a>   </div> </div> 
</body></html> 
