<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Run-Time Evaluation of Forms Вычисление форм</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-10 00:01:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 51--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse111.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#tailclmch20.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse110.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse110.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">20.1   </span> <a 
 id="x135-26100020.1"></a>Run-Time Evaluation of Forms Вычисление форм</h3>
<!--l. 53--><p class="noindent" >The function <a 
href="#x135-261002r620">eval</a> is the main user interface to the evaluator. Hooks are provided
for user-supplied debugging routines to obtain control during the execution of an
interpretive evaluator. The functions <a 
href="#x135-261011r623">evalhook</a> and <a 
href="#x135-261013r624">applyhook</a> provide
alternative interfaces to the evaluator mechanism for use by these debugging
routines.
<!--l. 59--><p class="indent" >   Функция <a 
href="#x135-261002r620">eval</a> является главным пользовательским интерфейсом к
вычислителю. Для пользовательских отладочных функций в интерпретаторе
предусмотрены ловушки. Функции <a 
href="#x135-261011r623">evalhook</a> и <a 
href="#x135-261013r624">applyhook</a> предоставляют
альтернативные интерфейсы к механизму вычислителся для использования
этих отладочных возможностей.
<div class=defun>
<!--l. 64--><p class="noindent" ><i>[Function]</i><a 
 id="dx135-261001"></a><a 
 id="x135-261002r620"></a><b> eval</b>  <i>form</i>
<!--l. 66--><p class="noindent" >The <i>form</i> is evaluated in the current dynamic environment and a null lexical
environment. Whatever results from the evaluation is returned from the call to
<a 
href="#x135-261002r620">eval</a>.
<!--l. 71--><p class="indent" >   Note that when you write a call to <a 
href="#x135-261002r620">eval</a> <i>two</i> levels of evaluation occur on the
argument form you write. First the argument form is evaluated, as for arguments
to any function, by the usual argument evaluation mechanism (which involves an
implicit use of <a 
href="#x135-261002r620">eval</a>). Then the argument is passed to the <a 
href="#x135-261002r620">eval</a> function, where
another evaluation occurs. For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval (list &#x2019;cdr (car &#x2019;((quote (a . b)) c))))  ⇒ b
</td></tr></table>
<!--l. 80--><p class="indent" >
</div>
</div>
<!--l. 81--><p class="noindent" >The argument form (list &#x2019;cdr (car &#x2019;((quote (a . b)) c))) is evaluated in the usual way
                                                                          

                                                                          
to produce the argument (cdr (quote (a . b))); this is then given to <a 
href="#x135-261002r620">eval</a> because
<a 
href="#x135-261002r620">eval</a> is being called explicitly, and <a 
href="#x135-261002r620">eval</a> evaluates its argument (cdr (quote (a . b)))
to produce b.
<!--l. 86--><p class="indent" >   If all that is required for some application is to obtain the current dynamic
value of a given symbol, the function <a 
href="clmse35.html#x47-89005r55">symbol-value</a> may be more eﬃcient than
<a 
href="#x135-261002r620">eval</a>.
<div class=new>
<!--l. 91--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx135-261003"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-1420007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<!--l. 96--><p class="indent" >   Форма <i>form</i> вычисляется в текущем динамическом окружении и нулевом
лексическом. Результатом функци является вычисленное значение для
переданной формы.
<!--l. 100--><p class="indent" >   Следует отметить, что когда вы записываете вызов к <a 
href="#x135-261002r620">eval</a>, то для
переданной формы происходят <i>два</i> уровня вычислений. Сначала происходит
вычисление формы аргумента, как и любого аргумента для любой функции.
Данное вычисление в свою очередь неявно вызывает <a 
href="#x135-261002r620">eval</a>. Затем происходит
вычисление значения аргумента переданного в функцию <a 
href="#x135-261002r620">eval</a>. Например: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval (list &#x2019;cdr (car &#x2019;((quote (a . b)) c))))  ⇒ b
</td></tr></table>
<!--l. 108--><p class="indent" >
</div>
</div>
<!--l. 109--><p class="noindent" >Форма аргумента (list &#x2019;cdr (car &#x2019;((quote (a . b)) c))) вычисляется в (cdr (quote
(a . b))). Затем <a 
href="#x135-261002r620">eval</a> вычисляет полученный аргумент и возвращает
b.
<!--l. 113--><p class="indent" >   Если необходимо получить динамическое значения для символа, то
удобнее использовать функцию <a 
href="clmse35.html#x47-89005r55">symbol-value</a>.
</div>
<div class=defun>
<!--l. 117--><p class="noindent" ><i>[Variable]</i><a 
 id="dx135-261004"></a><a 
 id="x135-261005r621"></a><b> *evalhook*</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx135-261006"></a><a 
 id="x135-261007r622"></a><b> *applyhook*</b>
<!--l. 120--><p class="noindent" >If the value of <a 
href="#x135-261005r621">*evalhook*</a> is not <a 
href="clmse31.html#x42-77002r19">nil</a>, then <a 
href="#x135-261002r620">eval</a> behaves in a special way. The
non-<a 
href="clmse31.html#x42-77002r19">nil</a> value of <a 
href="#x135-261005r621">*evalhook*</a> should be a function that takes two arguments, a form
and an environment; this is called the <i>eval hook function</i>. When a form is to be
                                                                          

                                                                          
evaluated (any form at all, even a number or a symbol), whether implicitly or via
an explicit call to <a 
href="#x135-261002r620">eval</a>, no attempt is made to evaluate the form. Instead, the hook
function is invoked and is passed the form to be evaluated as its ﬁrst argument.
The hook function is then responsible for evaluating the form; whatever is
returned by the hook function is assumed to be the result of evaluating the
form.
<!--l. 133--><p class="indent" >   The variable <a 
href="#x135-261007r622">*applyhook*</a> is similar to <a 
href="#x135-261005r621">*evalhook*</a> but is used when a function
is about to be applied to arguments. If the value of <a 
href="#x135-261007r622">*applyhook*</a> is not <a 
href="clmse31.html#x42-77002r19">nil</a>, then
<a 
href="#x135-261002r620">eval</a> behaves in a special way.
<!--l. 138--><p class="indent" >   Если значение <a 
href="#x135-261005r621">*evalhook*</a> не является <a 
href="clmse31.html#x42-77002r19">nil</a>, тогда <a 
href="#x135-261002r620">eval</a> ведет себя
специальным образом. Не-/false значение <a 
href="#x135-261005r621">*evalhook*</a> должно быть
функцией, которая принимает два аргумента, форму и окружение.
Эта функция называется «функцией-ловушкой для вычислителя».
Когда форма должна быть вычислена (любая, даже просто число
или символ) неявно или явно с помощью <a 
href="#x135-261002r620">eval</a>, то вместо вычисления
вызывается данная функция с формой в первом аргументе. Тогда
функция-ловушка несет ответственность за вычисление формы, и
все что она вернет будет расценено как результат вычисления этой
формы.
<!--l. 148--><p class="indent" >   Переменная <a 
href="#x135-261007r622">*applyhook*</a> похожа на <a 
href="#x135-261005r621">*evalhook*</a>, но используется, когда
функция должна быть применена к аргументам. Если значение <a 
href="#x135-261007r622">*applyhook*</a>
не <a 
href="clmse31.html#x42-77002r19">nil</a>, тогда <a 
href="#x135-261002r620">eval</a> ведет себя специальным образом. <div class=obsolete> The non-<a 
href="clmse31.html#x42-77002r19">nil</a> value of
<a 
href="#x135-261007r622">*applyhook*</a> should be a function that takes three arguments: a function,
a list of arguments, and an environment; this is called the <i>apply hook
function</i>.
</div>
<div class=new>
<!--l. 160--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx135-261008"></a>to revise the deﬁnition of <a 
href="#x135-261007r622">*applyhook*</a>.
Its value should be a function of <i>two</i> arguments, a function and a list
of arguments; no environment information is passed to an apply hook
function.
<!--l. 167--><p class="indent" >   This was simply a ﬂaw in the ﬁrst edition. Sorry about that.
</div>
<!--l. 170--><p class="indent" >   When a function is about to be applied to a list of arguments, no attempt is
made to apply the function. Instead, the hook function is invoked and is passed
the function and the list of arguments as its ﬁrst and second arguments. The hook
function is then responsible for evaluating the form; whatever is returned by the
hook function is assumed to be the result of evaluating the form. The apply hook
                                                                          

                                                                          
function is used only for application of ordinary functions within <a 
href="#x135-261002r620">eval</a>. It is not
used for applications via <a 
href="clmse37.html#x49-101002r77">apply</a> or <a 
href="clmse37.html#x49-101005r78">funcall</a>, for applications by such functions as
<a 
href="clmse82.html#x101-219005r407">map</a> or <a 
href="clmse82.html#x101-219021r413">reduce</a>, or for invocation of macro-expansion functions by either <a 
href="#x135-261002r620">eval</a> or
<a 
href="clmse47.html#x60-159002r138">macroexpand</a>.
<!--l. 183--><p class="indent" >   Когда функция должна примениться к списку аргументов, то вызывается
функция-ловушка с данной функцией и списком аргументов в качестве
параметров. Выполнение формы доверяется функции-ловушке. То, что она
вернет, будет расценено как результат вычисления формы. Функция-ловушка
используется для применения обычных функций внутри <a 
href="#x135-261002r620">eval</a>. Она не
используется для вызовов <a 
href="clmse37.html#x49-101002r77">apply</a> или <a 
href="clmse37.html#x49-101005r78">funcall</a>, таких функций, как <a 
href="clmse82.html#x101-219005r407">map</a> или
<a 
href="clmse82.html#x101-219021r413">reduce</a>, или вызовов функций раскрытия макросов, таких как <a 
href="#x135-261002r620">eval</a> или
<a 
href="clmse47.html#x60-159002r138">macroexpand</a>. <div class=newer> X3J13 voted in June 1988 <a 
 id="dx135-261009"></a>to specify that the value of
<a 
href="clmse47.html#x60-159011r140">*macroexpand-hook*</a> is ﬁrst coerced to a function before being called as the
expansion interface hook. This vote made no mention of <a 
href="#x135-261005r621">*evalhook*</a> or
<a 
href="#x135-261007r622">*applyhook*</a>, but this may have been an oversight.
<!--l. 198--><p class="indent" >   A proposal was submitted to X3J13 in September 1989 to specify
that the value of <a 
href="#x135-261005r621">*evalhook*</a> or <a 
href="#x135-261007r622">*applyhook*</a> is ﬁrst coerced to a function
before being called. If this proposal is accepted, the value of either variable
may be <a 
href="clmse31.html#x42-77002r19">nil</a>, any other symbol, a lambda-expression, or any object of type
<a 
href="clmse35.html#x47-88006r54">function</a>.
</div>
<!--l. 205--><p class="indent" >   The last argument passed to either kind of hook function contains information
about the lexical environment in an implementation-dependent format.
These arguments are suitable for the functions <a 
href="#x135-261011r623">evalhook</a>, <a 
href="#x135-261013r624">applyhook</a>, and
<a 
href="clmse47.html#x60-159002r138">macroexpand</a>.
<!--l. 210--><p class="indent" >   Последний аргумент помещаемый в функции-ловушки содержит
информацию о лексическом окружении в формате, который зависит от
реализации. Эти аргументы одаковы для функций <a 
href="#x135-261011r623">evalhook</a>, <a 
href="#x135-261013r624">applyhook</a> и
<a 
href="clmse47.html#x60-159002r138">macroexpand</a>.
<!--l. 215--><p class="indent" >   When either kind of hook function is invoked, both of the variables <a 
href="#x135-261005r621">*evalhook*</a>
and <a 
href="#x135-261007r622">*applyhook*</a> are rebound to the value <a 
href="clmse31.html#x42-77002r19">nil</a> around the invocation of the hook
function. This is so that the hook function will not be invoked recursively on
evaluations and applications that occur in the course of executing the code
of the hook function. The functions <a 
href="#x135-261011r623">evalhook</a> and <a 
href="#x135-261013r624">applyhook</a> are useful
for performing recursive evaluations and applications within the hook
function.
<!--l. 225--><p class="indent" >   Когда вызывается одна из функций-ловушек, то обе переменные
<a 
href="#x135-261005r621">*evalhook*</a> и *applyhook связываются со значениями <a 
href="clmse31.html#x42-77002r19">nil</a> на время выполнения
                                                                          

                                                                          
данных функций. Это сделано для того, чтобы функция-ловушка не
зациклилась. Функции <a 
href="#x135-261011r623">evalhook</a> и <a 
href="#x135-261013r624">applyhook</a> полезны для выполнения
рекурсивных вычислений и применений (функции) с функцией ловушкой.
<!--l. 231--><p class="indent" >   The hook feature is provided as an aid to debugging. The <a 
href="clmse129.html#x159-327004r811">step</a> facility is
implemented using this hook.
<!--l. 234--><p class="indent" >   Функциональность ловушки предоставляется для облегчения отладки.
Функциоанальность <a 
href="clmse129.html#x159-327004r811">step</a> реализована с помощью такой ловушки.
<!--l. 237--><p class="indent" >   If a non-local exit causes a throw back to the top level of Lisp, perhaps
because an error could not be corrected, then <a 
href="#x135-261005r621">*evalhook*</a> and <a 
href="#x135-261007r622">*applyhook*</a> are
automatically reset to <a 
href="clmse31.html#x42-77002r19">nil</a> as a safety feature.
<!--l. 242--><p class="indent" >   Если случается нелокальный выход на верхний уровень Lisp&#x2019;а, возможно
потому, что ошибка не может быть исправлена, тогда <a 
href="#x135-261005r621">*evalhook*</a> и
<a 
href="#x135-261007r622">*applyhook*</a> в целях безопасности автоматически сбрасываются в
<a 
href="clmse31.html#x42-77002r19">nil</a>.
</div>
<div class=defun>
<!--l. 247--><p class="noindent" ><i>[Function]</i><a 
 id="dx135-261010"></a><a 
 id="x135-261011r623"></a><b> evalhook</b>  <i>form</i> <i>evalhookfn</i> <i>applyhookfn</i> &#x0026;optional  <i>env</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx135-261012"></a><a 
 id="x135-261013r624"></a><b> applyhook</b>  <i>function</i> <i>args</i> <i>evalhookfn</i> <i>applyhookfn</i> &#x0026;optional
<i>env</i>
<!--l. 250--><p class="noindent" >The functions <a 
href="#x135-261011r623">evalhook</a> and <a 
href="#x135-261013r624">applyhook</a> are provided to make it easier to exploit
the hook feature.
<!--l. 254--><p class="indent" >   Функции <a 
href="#x135-261011r623">evalhook</a> и <a 
href="#x135-261013r624">applyhook</a> представлены для облегчения использования
функциональности ловушек.
<!--l. 257--><p class="indent" >   In the case of <a 
href="#x135-261011r623">evalhook</a>, the <i>form</i> is evaluated. In the case of <a 
href="#x135-261013r624">applyhook</a>, the
<i>function</i> is applied to the list of arguments <i>args</i>. In either case, for the duration of
the operation the variable <a 
href="#x135-261005r621">*evalhook*</a> is bound to <i>evalhookfn</i>, and <a 
href="#x135-261007r622">*applyhook*</a> is
bound to <i>applyhookfn</i>. Furthermore, the <i>env</i> argument is used as the lexical
environment for the operation; <i>env</i> defaults to the null environment. The check
for a hook function is <i>bypassed</i> for the evaluation of the <i>form</i> itself (for <a 
href="#x135-261011r623">evalhook</a>)
or for the application of the <i>function</i> to the <i>args</i> itself (for <a 
href="#x135-261013r624">applyhook</a>), but
not for subsidiary evaluations and applications such as evaluations of
subforms. It is this one-shot bypass that makes <a 
href="#x135-261011r623">evalhook</a> and <a 
href="#x135-261013r624">applyhook</a> so
useful.
<!--l. 273--><p class="indent" >   В случае <a 
href="#x135-261011r623">evalhook</a> вычисляется форма <i>form</i>. В случае <a 
href="#x135-261013r624">applyhook</a> функция
<i>function</i> применяется к списку аргументов <i>args</i>. В обоих случаях,
в процессе выполнения операции переменная <a 
href="#x135-261005r621">*evalhook*</a> связана с
<i>evalhookfn</i>, и <a 
href="#x135-261007r622">*applyhook*</a> с <i>applyhookfn</i>. Кроме того, аргумент <i>env</i>
используется для установки лексического окружения. По-умолчанию
                                                                          

                                                                          
<i>env</i> установлен в нулевое окружение. The check for a hook function is
<i>bypassed</i> for the evaluation of the <i>form</i> itself (for <a 
href="#x135-261011r623">evalhook</a>) or for the
application of the <i>function</i> to the <i>args</i> itself (for <a 
href="#x135-261013r624">applyhook</a>), but not for
subsidiary evaluations and applications such as evaluations of subforms. It
is this one-shot bypass that makes <a 
href="#x135-261011r623">evalhook</a> and <a 
href="#x135-261013r624">applyhook</a> so useful.
FIXME
<div class=new>
<!--l. 289--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx135-261014"></a>to eliminate the optional <i>env</i> parameter to
<a 
href="#x135-261013r624">applyhook</a>, because it is not (and cannot) be useful. Any function that can be
applied carries its own environment and does not need another environment to be
speciﬁed separately. This was a ﬂaw in the ﬁrst edition.
</div>
<!--l. 299--><p class="indent" >   Here is an example of a very simple tracing routine that uses just the <a 
href="#x135-261011r623">evalhook</a>
feature. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *hooklevel* 0)
</td></tr></table>
<!--l. 302--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 303--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun hook (x)</td></tr></table>
<!--l. 304--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((*evalhook* &#x2019;eval-hook-function))</td></tr></table>
<!--l. 305--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (eval x)))</td></tr></table>
<!--l. 306--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 307--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun eval-hook-function (form &#x0026;rest env)</td></tr></table>
<!--l. 308--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((*hooklevel* (+ *hooklevel* 1)))</td></tr></table>
<!--l. 309--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (format *trace-output* &#x0022;~%~V@TForm:  ~S&#x0022;</td></tr></table>
<!--l. 310--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (* *hooklevel* 2) form)</td></tr></table>
<!--l. 311--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (let ((values (multiple-value-list</td></tr></table>
<!--l. 312--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     (evalhook form</td></tr></table>
<!--l. 313--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                               #&#x2019;eval-hook-function</td></tr></table>
<!--l. 314--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                               <a 
href="clmse31.html#x42-77002r19">nil</a></td></tr></table>
<!--l. 315--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                               env))))</td></tr></table>
<!--l. 316--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (format *trace-output* &#x0022;~%~V@TValue:~{ ~S~}&#x0022;</td></tr></table>
<!--l. 317--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              (* *hooklevel* 2) values)</td></tr></table>
<!--l. 318--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (values-list values))))</td></tr></table>
<!--l. 320--><p class="indent" >
</div>
                                                                          

                                                                          
</div>
<!--l. 321--><p class="noindent" >Using these routines, one might see the following interaction: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hook &#x2019;(cons (ﬂoor *print-base* 2) &#x2019;b))
</td></tr></table>
<!--l. 323--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  Form: (CONS (FLOOR *PRINT-BASE* 2) (QUOTE B))</td></tr></table>
<!--l. 324--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    Form: (FLOOR *PRINT-BASE* 3)</td></tr></table>
<!--l. 325--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      Form: *PRINT-BASE*</td></tr></table>
<!--l. 326--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      Value: 10</td></tr></table>
<!--l. 327--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      Form: 3</td></tr></table>
<!--l. 328--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      Value: 3</td></tr></table>
<!--l. 329--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    Value: 3 1</td></tr></table>
<!--l. 330--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    Form: (QUOTE B)</td></tr></table>
<!--l. 331--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    Value: B</td></tr></table>
<!--l. 332--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  Value: (3 . B)</td></tr></table>
<!--l. 333--><p class="indent" >                                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(3 . B)</td></tr></table>
<!--l. 335--><p class="indent" >
</div>
</div>
<!--l. 337--><p class="indent" >   Вот пример, очень простой функции трассировки, которая использует
возможности <a 
href="#x135-261011r623">evalhook</a>. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *hooklevel* 0)
</td></tr></table>
<!--l. 340--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 341--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun hook (x)</td></tr></table>
<!--l. 342--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((*evalhook* &#x2019;eval-hook-function))</td></tr></table>
<!--l. 343--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (eval x)))</td></tr></table>
<!--l. 344--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 345--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun eval-hook-function (form &#x0026;rest env)</td></tr></table>
<!--l. 346--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((*hooklevel* (+ *hooklevel* 1)))</td></tr></table>
<!--l. 347--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (format *trace-output* &#x0022;~%~V@TForm:  ~S&#x0022;</td></tr></table>
<!--l. 348--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (* *hooklevel* 2) form)</td></tr></table>
<!--l. 349--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (let ((values (multiple-value-list</td></tr></table>
<!--l. 350--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     (evalhook form</td></tr></table>
<!--l. 351--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                               #&#x2019;eval-hook-function</td></tr></table>
                                                                          

                                                                          
<!--l. 352--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                               <a 
href="clmse31.html#x42-77002r19">nil</a></td></tr></table>
<!--l. 353--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                               env))))</td></tr></table>
<!--l. 354--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (format *trace-output* &#x0022;~%~V@TValue:~{ ~S~}&#x0022;</td></tr></table>
<!--l. 355--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              (* *hooklevel* 2) values)</td></tr></table>
<!--l. 356--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (values-list values))))</td></tr></table>
<!--l. 358--><p class="indent" >
</div>
</div>
<!--l. 359--><p class="noindent" >Используя этот функционал можно, например, увидеть такую последовательность: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hook &#x2019;(cons (ﬂoor *print-base* 2) &#x2019;b))
</td></tr></table>
<!--l. 361--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  Form: (CONS (FLOOR *PRINT-BASE* 2) (QUOTE B))</td></tr></table>
<!--l. 362--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    Form: (FLOOR *PRINT-BASE* 3)</td></tr></table>
<!--l. 363--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      Form: *PRINT-BASE*</td></tr></table>
<!--l. 364--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      Value: 10</td></tr></table>
<!--l. 365--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      Form: 3</td></tr></table>
<!--l. 366--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      Value: 3</td></tr></table>
<!--l. 367--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    Value: 3 1</td></tr></table>
<!--l. 368--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    Form: (QUOTE B)</td></tr></table>
<!--l. 369--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    Value: B</td></tr></table>
<!--l. 370--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  Value: (3 . B)</td></tr></table>
<!--l. 371--><p class="indent" >                                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(3 . B)</td></tr></table>
<!--l. 373--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 376--><p class="noindent" ><i>[Function]</i><a 
 id="dx135-261015"></a><a 
 id="x135-261016r625"></a><b> constantp</b>  <i>object</i>
<!--l. 378--><p class="noindent" >If the predicate <a 
href="#x135-261016r625">constantp</a> is true of an object, then that object, when considered
as a form to be evaluated, always evaluates to the same thing; it is a constant.
This includes self-evaluating objects such as numbers, characters, strings,
bit-vectors, and keywords, as well as all constant symbols declared by <a 
href="clmse30.html#x40-71006r16">defconstant</a>,
such as <a 
href="clmse31.html#x42-77002r19">nil</a>, <a 
href="clmse31.html#x42-77004r20">t</a>, and <a 
href="clmse70.html#x87-204025r244">pi</a>. In addition, a list whose <i>car</i> is <a 
href="clmse35.html#x47-87002r53">quote</a>, such as (quote foo), is
considered to be a constant.
                                                                          

                                                                          
<!--l. 390--><p class="indent" >   If <a 
href="#x135-261016r625">constantp</a> is false of an object, then that object, considered as a form, might
or might not always evaluate to the same thing.
<!--l. 394--><p class="indent" >   Если предикат <a 
href="#x135-261016r625">constantp</a> для объекта <i>object</i> истенен, то данный объект,
когда рассматривается как вычисляемая форма, всегда вычисляется в одно и
то же значение. Константные объекты включают самовычисляемые объекты,
такие как числа, строковые символы, строки, битовые вектора, ключевые
символы, а также символы констант, определенных с помощью <a 
href="clmse30.html#x40-71006r16">defconstant</a>,
<a 
href="clmse31.html#x42-77002r19">nil</a>, <a 
href="clmse31.html#x42-77004r20">t</a> и <a 
href="clmse70.html#x87-204025r244">pi</a>. В дополнение, список, у которого <i>car</i> элемент равен <a 
href="clmse35.html#x47-87002r53">quote</a>,
например (quote foo), также является константным объектом.
<!--l. 403--><p class="indent" >   Если <a 
href="#x135-261016r625">constantp</a> для объекта <i>object</i> ложен, то этот объект, рассматриваемый
как форма, может не всегда вычисляться в одно и то же значение.
</div>
                                                                          

                                                                          
   <!--l. 408--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse111.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#tailclmch20.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse110.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 408--><p class="indent" >   <a 
 id="tailclmse110.html"></a>  
</body></html> 
