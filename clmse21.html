<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Уточняющие спецификаторы типов</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-11 09:24:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 1200--><p class="noindent" > <div id="main_container"> <div id="content"> <!--l. 1200--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse22.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse20.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse20.html#tailclmse20.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse21.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch4.html#clmse21.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">4.5   </span> <a 
href="clm.html#QQ2-30-55" id="x30-480004.5">Уточняющие спецификаторы типов</a></h3>
<!--l. 1203--><p class="noindent" >Некоторые списки, представляющие типы, с помощью символов могут быть
более специализированы. Такие подробности могут быть отражены, как
более эффективная реализация. Например, предположим что <tt>(array
short-float)</tt>. Реализация A, может выбрать специализированное
представление для массива коротких с плавающей точкой, а реализация B
может выбрать более общее представление.
<!--l. 1209--><p class="indent" >   Если вы хотите создать массив в целях хранения только коротких с
плавающей точкой, вы можете опционально указать для <tt><a 
href="clmse87.html#x109-213002r501">make-array</a></tt> тип
элементов <tt>short-float</tt>. Это <i>не потребует</i> от <tt><a 
href="clmse87.html#x109-213002r501">make-array</a></tt> создать
объект типа <tt>(array short-float)</tt>, но это просто позволит ей выбрать
родственный тип. Запрос можно объяснить так: «Предоставь наиболее
специализированный массив, который может хранить короткие с плавающей
точкой, который только может предоставить реализация». Реализация A
тогда предоставит специализированный массив типа <tt>(array short-float)</tt>, а
реализация B — простой массив типа <tt>(array t)</tt>.
<!--l. 1218--><p class="indent" >   На вопрос, действительно ли тип созданного массива <tt>(array short-float)</tt>,
реализация A ответит «да», но реализация B ответит «нет». Это свойство
<tt><a 
href="clmse87.html#x109-213002r501">make-array</a></tt> и подобных ей функций: то, что вы просите, необязательно
является тем, что вы получите.
<!--l. 1223--><p class="indent" >   Далее перечислены возможные имена типов, которые задаются
списком:
<div class=flushdesc>
<!--l. 1226--><p class="indent" >
      <ul><li><b>
<tt>(array <i>element-type</i> <i>size</i>)</tt> </b></li>Такая запись обозначает множество
      специализированных массивов, элементы которых принадлежат типу
      <i>element-type</i> и size которых равна <i>size</i>. <i>element-type</i> должен быть
      корректным спецификатором типа или не уточнён с помощью
      <tt><a 
href="clmse104.html#x129-237010r572">*</a></tt>. <i>size</i> может быть неотрицательным целым, определяющим
                                                                          

                                                                          
      размер массива, может быть списком неотрицательных целых,
      определяющих размер каждого измерения (размер какого-либо
      измерения может быть не указан, <tt><a 
href="clmse104.html#x129-237010r572">*</a></tt>) или может быть не указан <tt><a 
href="clmse104.html#x129-237010r572">*</a></tt>.
      Например, <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(array integer 3)           ;Трёхэлементный массив целых
</td></tr></table>
      <!--l. 1237--><p class="noindent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(array integer (* * *))     ;Трёхмерный массив целых</td></tr></table>
      <!--l. 1238--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(array * (4 5 6))           ;Трёхмерный массив, размеры измерений 4,5,6</td></tr></table>
      <!--l. 1240--><p class="noindent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(array character (3 *))     ;Двумерный массив символов</td></tr></table>
      <!--l. 1241--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            ; у которого только три строки</td></tr></table>
      <!--l. 1242--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(array short-ﬂoat ())      ;Ранг массива равен нулю, массив содержит</td></tr></table>
      <!--l. 1243--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            ; короткие с плавающие точкой</td></tr></table>
      <!--l. 1245--><p class="noindent" >
</div>
</div>
      <!--l. 1246--><p class="noindent" >Следует отметить, что <tt>(array t)</tt> является правильным подмножеством
      <tt>(array *)</tt>. Причиной тому является то. что <tt>(array t)</tt> это множество
      массивов, которые могут содержать любой Common Lisp объект
      (элементы типа <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>, которые включают все элементы). С другой
      стороны, <tt>(array *)</tt> является множеством всех массивов, включая,
      например, массивы, которые могут хранить только строковые
      символы. Сейчас <tt>(array character)</tt> не является подмножеством
      <tt>(array t)</tt>; два множества фактически непересекаются, потому
      что <tt>(array character)</tt> не является множеством всех массивов,
      которые могут хранить строковые символы, а является множеством
      массивов, которые специализированы хранить именно символы и
      никакие другие объекты FIXME. Поэтому проверка, может ли
      массив <tt>foo</tt> хранить строковые символы, не может быть такой:
      <div class=lisp><div class=tabbing>
                                                                          

                                                                          
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(typep foo &#x2019;(array character))
</td></tr></table>
      <!--l. 1260--><p class="noindent" >
</div>
</div>
      <!--l. 1261--><p class="noindent" >, а должна быть такой: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(subtypep &#x2019;character (array-element-type foo))
</td></tr></table>
      <!--l. 1264--><p class="noindent" >
</div>
</div>
      <!--l. 1265--><p class="noindent" >Смотрите <tt><a 
href="clmse89.html#x111-215002r508">array-element-type</a></tt>.
      <li><b>
<tt>(simple-array <i>element-type</i> <i>sizes</i>)</tt> </b></li>Данная запись эквивалентна <tt>(array
      <i>element-type</i> <i>sizes</i>)</tt> за исключением того, что дополнительно
      определяет, что объекты будут <i>простыми</i> массивами (смотрите
      раздел <a 
href="clmse7.html#x14-290002.5">2.5<!--tex4ht:ref: ARRAY-TYPE-SECTION --></a>).
      <li><b>
<tt>(vector <i>element-type</i> <i>size</i>)</tt> </b></li>Такой тип обозначает множество
      специализированный одномерных массивов, все элементы которых
      принадлежат типу <tt>element-type</tt> и size которого равен <tt>size</tt>. Такой тип
      полностью эквивалентен <tt>(array <i>element-type</i> (<i>size</i>))</tt>. Например:
      <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(vector double-ﬂoat)     ;Векторы двойных
</td></tr></table>
      <!--l. 1279--><p class="noindent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                          ; чисел с плавающей точкой</td></tr></table>
      <!--l. 1280--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(vector * 5)              ;Векторы длинной пять элементов</td></tr></table>
      <!--l. 1281--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(vector t 5)              ;Общие векторы длинной пять элементов FIXME</td></tr></table>
      <!--l. 1282--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(vector (mod 32) *)       ;Вектора целых чисел между 0 и 31</td></tr></table>
      <!--l. 1284--><p class="noindent" >
                                                                          

                                                                          
</div>
</div>
      <li><b>
<tt>(simple-vector <i>size</i>)</tt> </b></li>Такая запись означает то же, что и <tt>(vector t
      <i>size</i>)</tt>.
      <li><b>
<tt>(complex <i>type</i>)</tt> </b></li>Каждый элемент такого типа является комплексным
      числом, у которого действительная и мнимая части принадлежат типу
      <i>type</i>.
      <li><b>
<tt>(function (<i>argument-type-1</i> <i>argument-type-2</i> ...) <i>value-type</i>)</tt> </b></li>Этот
      тип может использоваться только для декларации и не может для
      распознавания; <tt><a 
href="clmse31.html#x42-75002r20">typep</a></tt> будет сигнализировать ошибку, если ей
      будет передан такой спецификатор типа. Каждый элемент такого
      типа является функцией, которая принимает аргументы типов
      перечисленных с помощью форм <i>argument-type-j</i> и возвращает значение
      типа <i>value-type</i>. В форме типов аргументов могут использоваться
      маркеры <tt>&#x0026;optional</tt>, <tt>&#x0026;rest</tt> и <tt>&#x0026;key</tt>. <i>value-type</i> может быть
      спецификатором типа <tt><a 
href="clmse42.html#x54-130002r105">values</a></tt> в случае, если функция возвращает
      несколько значений.
      <li><b>
<tt>(values <i>value-type-1</i> <i>value-type-2</i> ...)</tt> </b></li>Данный тип используется
      только в двух случаях: только как <i>value-type</i> для спецификатора типа
      <i>функции</i> и в специальной форме <tt><a 
href="clmse49.html#x63-153002r126">the</a></tt>. Данный спецификатор
      используется для задания типов в случаях возврата нескольких
      значений. В списке с типами могут использоваться маркеры <tt>&#x0026;optional</tt>,
      <tt>&#x0026;rest</tt> и <tt>&#x0026;key</tt>.</ul>
</div>
                                                                          

                                                                          
   <!--l. 1312--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse22.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse20.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse20.html#tailclmse20.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse21.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch4.html#clmse21.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 1312--><p class="indent" >   <a 
 id="tailclmse21.html"></a>  </div> </div> 
</body></html> 
