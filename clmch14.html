<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>14 Последовательности</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-04 00:46:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1392--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse74.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse73.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse73.html#tailclmse73.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmch14.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clm.html#clmch14.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h2 class="chapterHead"><span class="titlemark">Глава 14</span><br /><a 
href="clm.html#QQ2-92-221" id="x92-19300014">Последовательности</a></h2><div class="chapterTOCS">
    <span class="sectionToc" >14.1 <a 
href="clmse74.html#x93-19400014.1">Простые функции для последовательностей</a></span>
<br />    <span class="sectionToc" >14.2 <a 
href="clmse75.html#x94-19500014.2">Объединение, отображение и приведение последовательностей</a></span>
<br />    <span class="sectionToc" >14.3 <a 
href="clmse76.html#x95-19600014.3">Модификация последовательностей</a></span>
<br />    <span class="sectionToc" >14.4 <a 
href="clmse77.html#x96-19700014.4">Поиск элементов последовательностей</a></span>
<br />    <span class="sectionToc" >14.5 <a 
href="clmse78.html#x97-19800014.5">Сортировка и слияние</a></span>
   </div>
<!--l. 1395--><p class="indent" >   Тип <tt>sequence</tt> объединяет списки и вектора (одномерные массивы). Хотя
это две различные структуры данных с различными структурными
свойствами, приводящими к алгоритмически различному использованию, они
имеют общее свойство: каждая хранит упорядоченное множество
элементов.
<!--l. 1400--><p class="indent" >   Некоторые операции полезны и для списков и для массивов, потому что
они взаимодействуют с упорядоченными множествами элементов. Можно
запросить количество элементов, изменить порядок элементов на
противоположный, извлечь подмножество (подпоследовательность) и так
далее. Для таких целей Common Lisp предлагает ряд общих функций для
последовательностей.
<div class="flushleft" 
>
<!--l. 1406--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" >elt         </td><td align="left" >reverse      </td><td align="left" >map      </td><td align="left" >remove              </td>
</tr><tr><td align="left" >length    </td><td align="left" >nreverse     </td><td align="left" >some     </td><td align="left" >remove-duplicates</td>
</tr><tr><td align="left" >subseq   </td><td align="left" >concatenate</td><td align="left" >every    </td><td align="left" >delete                </td>
</tr><tr><td align="left" >copy-seq </td><td align="left" >position     </td><td align="left" >notany  </td><td align="left" >delete-duplicates  </td>
</tr><tr><td align="left" >ﬁll         </td><td align="left" >ﬁnd           </td><td align="left" >notevery</td><td align="left" >substitute          </td>
</tr><tr><td align="left" >replace   </td><td align="left" >sort          </td><td align="left" >reduce   </td><td align="left" >nsubstitute         </td>
</tr><tr><td align="left" >count     </td><td align="left" >merge        </td><td align="left" >search   </td><td align="left" >mismatch           </td></tr></table></div></div>
<!--l. 1418--><p class="noindent" >Некоторые из этих операций имеют более одной версии. Такие версии
отличаются суффиксом (или префиксом) от имени базовой функции. Кроме
того, многие операции принимают один или более необязательных
именованных аргументов, которые могут изменить поведение операции.
<!--l. 1423--><p class="indent" >   Если операция требует проверки элементов последовательности на
совпадение с некоторым условием, тогда это условие может быть указано
одним из двух способов. Основная операция принимает объект и сравнивает с
ним каждый элемент последовательности на равенство <tt><a 
href="clmse32.html#x43-77004r45">eql</a></tt>. (Операция
сравнения может быть задана в именованном параметре <tt>:test</tt> или
                                                                          

                                                                          
<tt>:test-not</tt>. Использование обоих параметров одновременно является
ошибкой.) Другие варианты операции образуются с добавлением префиксов
<tt>-if</tt> и <tt>-if-not</tt>. Эти операции, в отличие от базовой, принимают не объект, а
предикат с одним аргументом. В этом случае проверяется истинность или
ложность предиката для каждого элемента последовательности. В качестве
примера, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remove <i>item</i> <i>sequence</i>)
</td></tr></table>
<!--l. 1436--><p class="indent" >
</div>
</div>
<!--l. 1437--><p class="noindent" >возвращает копию последовательности <i>sequence</i>, в которой удалены все
элементы равные <tt><a 
href="clmse32.html#x43-77004r45">eql</a></tt> объекту <i>emph</i>. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remove <i>item</i> <i>sequence</i> <tt>:test</tt> #&#x2019;equal)
</td></tr></table>
<!--l. 1441--><p class="indent" >
</div>
</div>
<!--l. 1442--><p class="noindent" >возвращает копию последовательности <i>sequence</i>, в которой удалены все
элементы равные <tt><a 
href="clmse32.html#x43-77006r46">equal</a></tt> объекту <i>emph</i>. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remove-if #&#x2019;numberp <i>sequence</i>)
</td></tr></table>
<!--l. 1446--><p class="indent" >
</div>
</div>
<!--l. 1447--><p class="noindent" >возвращает копию последовательности <i>sequence</i>, в которой удалены все
числа.
<!--l. 1450--><p class="indent" >   Если операция любым методом проверяет элементы последовательности,
то если именованный параметр <tt>:key</tt> не равняется <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, то он должен быть
функцией одного аргумента, которая будет извлекать из элемента
необходимую для проверки часть. Например, <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ﬁnd <i>item</i> <i>sequence</i> <tt>:test</tt> #&#x2019;eq <tt>:key</tt> #&#x2019;car)
</td></tr></table>
<!--l. 1457--><p class="indent" >
</div>
</div>
<!--l. 1458--><p class="noindent" >Это выражение ищет первый элемент последовательности <i>sequence</i>, <i>car</i> элемент
которого равен <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt> объекту <i>item</i>.
<!--l. 1461--><p class="indent" >   Для некоторых операций было бы удобно указать направление обработки
последовательности. В этом случае базовые операции обычно обрабатывают
последовательность в прямом направлении. Обратное направление
обработки указывается с помощью не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> значения для именованного
параметра <tt>:from-end</tt>. (Порядок обработки указываемый в <tt>:from-end</tt>
чисто концептуальный. В зависимости от обрабатываемого объекта и
реализации, действительный порядок обработки может отличаться.
Поэтому пользовательские функции <i>test</i> не должны иметь побочных
эффектов.)
<!--l. 1470--><p class="indent" >   Много операций позволяют указать подпоследовательность для
обработки. Такие операции имеют именованные параметры <tt>:start</tt> и <tt>:end</tt>.
Эти аргумент должны быть индексами внутри последовательности, и
<span class="math"><i>start</i> ≤<i>end</i></span>. Ситуация <span class="math"><i>start</i> &#x003E; <i>end</i></span> является ошибкой. Эти параметры
указывают подпоследовательность начиная с позиции <i>start</i> включительно и
заканчивая позицией <i>end</i> невключительно. Таким образом длина
подпоследовательности равна <span class="math"><i>end</i> −<i>start</i></span>. Если параметр <i>start</i> опущен,
используется значение по-умолчанию ноль. Если параметр <i>end</i> опущен,
используется значение по-умолчанию длина последовательности. В
большинстве случаев, указание подпоследовательности допускается
исключительно ради эффективности. Вместо этого можно было бы
просто вызвать <tt><a 
href="clmse74.html#x93-194004r349">subseq</a></tt>. Однако, следует отметить, что операция,
которая вычисляет индексы для подпоследовательности, возвращает
индексы исходной последовательности, а не подпоследовательности:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(position #\b &#x0022;foobar&#x0022; <tt>:start</tt> 2 <tt>:end</tt> 5) <span class="math"> ⇒</span> 3
</td></tr></table>
<!--l. 1485--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(position #\b (subseq &#x0022;foobar&#x0022; 2 5)) <span class="math"> ⇒</span> 1</td></tr></table>
<!--l. 1487--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 1488--><p class="noindent" >Если в операции участвует две последовательности, тогда ключевые параметры
<tt>:start1</tt>, <tt>:end1</tt>, <tt>start2</tt> и <tt>:end2</tt> используются для указания отдельных
подпоследовательностей для каждой последовательности.
<!--l. 1492--><p class="indent" >   Для некоторых функций, в частности <tt><a 
href="clmse76.html#x95-196006r365">remove</a></tt> и <tt><a 
href="clmse76.html#x95-196012r368">delete</a></tt>, ключевой
параметр <tt>:count</tt> используется для указания, как много подходящих
элементов должны обрабатываться. Если он равен <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> или не указан,
обрабатываются все подходящие элементы.
<!--l. 1497--><p class="indent" >   В следующих описаниях функций, элемент <i>x</i> последовательности
«удовлетворяет условию», если любое из следующих выражений верно:
      <ul class="itemize1">
      <li class="itemize">Была  вызвана  базовая  функция,  функция  <i>testfn</i>  заданная  в
      параметре  <tt>:test</tt>,  и  выражение  <tt>(funcall <i>testfn</i> <i>item</i> (<i>keyfn</i>
      <i>x</i>))</tt> истинно.
      </li>
      <li class="itemize">Была   вызвана   базовая   функция,   функция   <i>testfn</i>   заданная
      в  параметре  <tt>:test-not</tt>,  и  выражение  <tt>(funcall <i>testfn</i> <i>item</i>
      (<i>keyfn</i> <i>x</i>))</tt> ложно.
      </li>
      <li class="itemize">Была  вызвана  функция  <tt>-if</tt>,  и  выражение  <tt>(funcall <i>predicate</i>
      (<i>keyfn</i> <i>x</i>))</tt> истинно.
      </li>
      <li class="itemize">Была   вызвана   функция   <tt>-if-not</tt>,   и   выражение   <tt>(funcall
      <i>predicate</i> (<i>keyfn</i> <i>x</i>))</tt> ложно</li></ul>
<!--l. 1520--><p class="noindent" >В каждом случае, функция <i>keyfn</i> является значением параметра <tt>:key</tt>
(по-умолчанию функцией эквивалентности). Для примера, смотрите
<tt><a 
href="clmse76.html#x95-196006r365">remove</a></tt>.
<!--l. 1523--><p class="indent" >   В следующих описаниях функций два элемента <i>x</i> и <i>y</i>, взятых из
последовательности, «эквивалентны», если одно из следующих выражений
верно:
      <ul class="itemize1">
      <li class="itemize">Функция <i>testfn</i> указана в параметре <tt>:test</tt>, и выражение <tt>(funcall
      <i>testfn</i> (<i>keyfn</i> <i>x</i>) (<i>keyfn</i> <i>y</i>))</tt> истинно.
      </li>
      <li class="itemize">Функция  <i>testfn</i>  указана  в  параметре  <tt>:test-not</tt>,  и  выражение
      <tt>(funcall <i>testfn</i> (<i>keyfn</i> <i>x</i>) (<i>keyfn</i> <i>y</i>))</tt> ложно.</li></ul>
                                                                          

                                                                          
<!--l. 1539--><p class="noindent" >Для примера, смотрите <tt><a 
href="clmse77.html#x96-197022r389">search</a></tt>.
<!--l. 1541--><p class="indent" >   Вы можете рассчитывать на порядок передачи аргументов в функцию
<i>testfn</i>. Это позволяет использовать некоммутативную функцию проверки в
стиле предиката. Порядок аргументов в функцию <i>testfn</i> соответствует
порядку, в котором эти аргументы (или последовательности их содержащие)
были переданы в рассматриваемую функцию. Если рассматриваемая
функция передаёт два элемента из одной последовательности в функцию
<i>testfn</i>, то аргументы передаются в том же порядке, в котором были в
последовательности.
<!--l. 1550--><p class="indent" >   Если функция должна создать и вернуть новый вектор, то она всегда
возвращает <i>простой</i> вектор (смотрите раздел <a 
href="clmse7.html#x14-290002.5">2.5<!--tex4ht:ref: ARRAY-TYPE-SECTION --></a>). Таким же образом, любые
создаваемые строки будут простыми строками.





                                                                          

                                                                          
   <!--l. 1315--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse74.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse73.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse73.html#tailclmse73.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clm.html#clmch14.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 1315--><p class="indent" >   <a 
 id="tailclmch14.html"></a>  
</body></html> 
