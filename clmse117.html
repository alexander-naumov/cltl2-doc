<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Output Functions</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-02-22 01:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 4048--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse118.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse116.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse116.html#tailclmse116.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse117.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch22.html#clmse117.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">22.3   </span> <a 
 id="x144-19700022.3"></a>Output Functions</h3>
<!--l. 4050--><p class="noindent" >The output functions are divided into two groups: those that operate on streams
of characters and those that operate on streams of binary data. The function
<a 
href="#x144-200003r728">format</a> operates on streams of characters but is described in a section
separate from the other character-output functions because of its great
complexity.
<!--l. 4057--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">22.3.1   </span> <a 
 id="x144-19800022.3.1"></a>Output to Character Streams</h4>
<!--l. 4059--><p class="noindent" >These functions all take an optional argument called output-stream, which is
where to send the output. If unsupplied or <a 
href="clmse31.html#x42-70002r19">nil</a>, output-stream defaults to the value
of the variable <i>*standard-output*</i>. If it is <a 
href="clmse31.html#x42-70004r20">t</a>, the value of the variable <i>*terminal-io*</i>
is used.
<div class=obsolete>
<div class=defun>
<!--l. 4066--><p class="noindent" > <i>[Function]</i>   <b>write</b> <a 
 id="dx144-198001"></a><a 
 id="x144-198002r708"></a>   <i>object</i>  <b>&#x0026;key</b>  :stream  :escape  :radix  :base  :circle
:pretty  :level  :length  :case  :gensym  :array
<!--l. 4068--><p class="noindent" >The printed representation of object is written to the output stream speciﬁed by
<i>:stream</i>, which defaults to the value of <i>*standard-output*</i>.
<!--l. 4072--><p class="indent" >   The other keyword arguments specify values used to control the generation of
the printed representation. Each defaults to the value of the corresponding global
variable: see <i>*print-escape*</i>, <i>*print-radix*</i>, <i>*print-base*</i>, <i>*print-circle*</i>,
<i>*print-pretty*</i>, <i>*print-level*</i>, <i>*print-length*</i>, <i>*print-case*</i>, <i>*print-array*</i>, and
<i>*print-gensym*</i>. (This is the means by which these variables aﬀect printing
operations: supplying default values for the <a 
href="#x144-198004r709">write</a> function.) Note that the printing
of symbols is also aﬀected by the value of the variable <i>*package*</i>. <a 
href="#x144-198004r709">write</a> returns
object.
</div>
</div>
                                                                          

                                                                          
<div class=newer>
<!--l. 4089--><p class="indent" >   X3J13 voted in June 1989 ⟨<b>?</b>⟩ to add the keyword argument <i>:readably</i> to the
function <a 
href="#x144-198004r709">write</a>, and voted in June 1989 ⟨<b>?</b>⟩ to add the keyword arguments
<i>:right-margin</i>, <i>:miser-width</i>, <i>:lines</i>, and <i>:pprint-dispatch</i>. The revised description is
as follows.
<div class=defun>
<!--l. 4096--><p class="noindent" > <i>[Function]</i>   <b>write</b> <a 
 id="dx144-198003"></a><a 
 id="x144-198004r709"></a>   <i>object</i>  <b>&#x0026;key</b>  :stream  :escape  :radix  :base  :circle
:pretty  :level  :length  :case  :gensym  :array  :readably  :right-margin
:miser-width  :lines  :pprint-dispatch
<!--l. 4100--><p class="noindent" >The printed representation of object is written to the output stream speciﬁed by
<i>:stream</i>, which defaults to the value of <i>*standard-output*</i>.
<!--l. 4104--><p class="indent" >   The other keyword arguments specify values used to control the generation of
the printed representation. Each defaults to the value of the corresponding global
variable: see <i>*print-escape*</i>, <i>*print-radix*</i>, <i>*print-base*</i>, <i>*print-circle*</i>,
<i>*print-pretty*</i>, <i>*print-level*</i>, <i>*print-length*</i>, and <i>*print-case*</i>, in addition to
<i>*print-array*</i>, <i>*print-gensym*</i>, <i>*print-readably*</i>, <i>*print-right-margin*</i>,
<i>*print-miser-width*</i>, <i>*print-lines*</i>, and <i>*print-pprint-dispatch*</i>. (This is the
means by which these variables aﬀect printing operations: supplying default values
for the <a 
href="#x144-198004r709">write</a> function.) Note that the printing of symbols is also aﬀected by the
value of the variable <i>*package*</i>. <a 
href="#x144-198004r709">write</a> returns object.
</div>
</div>
<div class=defun>
<!--l. 4124--><p class="noindent" > <i>[Function]</i>   <b>prin1</b> <a 
 id="dx144-198005"></a><a 
 id="x144-198006r710"></a>   <i>object</i>  <b>&#x0026;optional</b>  <i>output-stream</i><br 
class="newline" /><i>[Function]</i>   <b>print</b> <a 
 id="dx144-198007"></a><a 
 id="x144-198008r711"></a>   <i>object</i>  <b>&#x0026;optional</b>  <i>output-stream</i><br 
class="newline" /><i>[Function]</i>   <b>pprint</b> <a 
 id="dx144-198009"></a><a 
 id="x144-198010r712"></a>   <i>object</i>  <b>&#x0026;optional</b>  <i>output-stream</i><br 
class="newline" /><i>[Function]</i>   <b>princ</b> <a 
 id="dx144-198011"></a><a 
 id="x144-198012r713"></a>   <i>object</i>  <b>&#x0026;optional</b>  <i>output-stream</i>
<!--l. 4129--><p class="noindent" ><i>prin1</i> outputs the printed representation of object to output-stream. Escape
characters are used as appropriate. Roughly speaking, the output from <i>prin1</i> is
suitable for input to the function <a 
href="clmse116.html#x143-195002r694">read</a>. <i>prin1</i> returns the object as its value. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(prin1 object output-stream)
</td></tr></table>
<!--l. 4135--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ≡ (write object :stream output-stream :escape t)</td></tr></table>
<!--l. 4137--><p class="indent" >
</div>
                                                                          

                                                                          
</div>
<!--l. 4139--><p class="indent" >   <a 
href="#x144-198008r711">print</a> is just like <i>prin1</i> except that the printed representation of object is
preceded by a newline (see <a 
href="#x144-198028r721">terpri</a>) and followed by a space. <a 
href="#x144-198008r711">print</a> returns
object.
<!--l. 4144--><p class="indent" >   <a 
href="#x144-198010r712">pprint</a> is just like <a 
href="#x144-198008r711">print</a> except that the trailing space is omitted and the object
is printed with the <i>*print-pretty*</i> ﬂag non-<a 
href="clmse31.html#x42-70002r19">nil</a> to produce “pretty” output.
<a 
href="#x144-198010r712">pprint</a> returns no values (that is, what the expression <i>(values)</i> returns: zero
values).
<div class=new>
<!--l. 4152--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to adopt a facility for user-controlled pretty
printing (see chapter <a 
href="clmch27.html#x175-25300027">27<!--tex4ht:ref: PPRINT --></a>).
</div>
<!--l. 4158--><p class="indent" >   <a 
href="#x144-198012r713">princ</a> is just like <i>prin1</i> except that the output has no escape characters. A
symbol is printed as simply the characters of its print name; a string is printed
without surrounding double quotes; and there may be diﬀerences for other data
types as well. The general rule is that output from <a 
href="#x144-198012r713">princ</a> is intended to look good
to people, while output from <i>prin1</i> is intended to be acceptable to the
function <a 
href="clmse116.html#x143-195002r694">read</a>. <div class=newer> X3J13 voted in June 1987 ⟨<b>?</b>⟩ to clarify that <a 
href="#x144-198012r713">princ</a> prints
a character in exactly the same manner as <a 
href="#x144-198022r718">write-char</a>: the character is
simply sent to the output stream. This was implied by the speciﬁcation in
section <a 
href="clmse115.html#x142-19300022.1.6">22.1.6<!--tex4ht:ref: PRINTER --></a> in the ﬁrst edition, but is worth pointing out explicitly
here.
</div> <a 
href="#x144-198012r713">princ</a> returns the object as its value. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(princ object output-stream)
</td></tr></table>
<!--l. 4174--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ≡ (write object :stream output-stream :escape <a 
href="clmse31.html#x42-70002r19">nil</a>)</td></tr></table>
<!--l. 4176--><p class="indent" >
</div>
</div>
<div class=incompatibility>
<!--l. 4179--><p class="noindent" ><b>Compatibility note:</b> In MacLisp, the functions <i>prin1</i>, <a 
href="#x144-198008r711">print</a>, and <a 
href="#x144-198012r713">princ</a> return <a 
href="clmse31.html#x42-70004r20">t</a>, not
the argument object.
</div>
</div>
<div class=obsolete>
<div class=defun>
                                                                          

                                                                          
<!--l. 4187--><p class="noindent" > <i>[Function]</i>   <b>write-to-string</b> <a 
 id="dx144-198013"></a><a 
 id="x144-198014r714"></a>   <i>object</i>  <b>&#x0026;key</b>  :escape  :radix  :base  :circle
:pretty  :level  :length  :case  :gensym  :array <br 
class="newline" /><i>[Function]</i>   <b>prin1-to-string</b> <a 
 id="dx144-198015"></a><a 
 id="x144-198016r715"></a>   <i>object</i> <br 
class="newline" /><i>[Function]</i>   <b>princ-to-string</b> <a 
 id="dx144-198017"></a><a 
 id="x144-198018r716"></a>   <i>object</i>
<!--l. 4192--><p class="noindent" >The object is eﬀectively printed as if by <a 
href="#x144-198004r709">write</a>, <i>prin1</i>, or <a 
href="#x144-198012r713">princ</a>, respectively, and
the characters that would be output are made into a string, which is
returned.
</div>
</div>
<div class=incompatibility>
<!--l. 4201--><p class="noindent" ><b>Compatibility note:</b> The Interlisp function mkstring corresponds to the Common Lisp
function <a 
href="#x144-198018r716">princ-to-string</a>.
</div>
<div class=new>
<div class=defun>
<!--l. 4208--><p class="noindent" > <i>[Function]</i>   <b>write-to-string</b> <a 
 id="dx144-198019"></a><a 
 id="x144-198020r717"></a>   <i>object</i>  <b>&#x0026;key</b>  :escape  :radix  :base  :circle
:pretty  :level  :length  :case  :gensym  :array  :readably  :right-margin
:miser-width  :lines  :pprint-dispatch
<!--l. 4212--><p class="noindent" >X3J13 voted in June 1989 (⟨<b>?</b>⟩ and ⟨<b>?</b>⟩) to add keyword arguments to <a 
href="#x144-198004r709">write</a>;
presumably they should also be added to <a 
href="#x144-198020r717">write-to-string</a>.
</div>
</div>
<div class=defun>
<!--l. 4220--><p class="noindent" > <i>[Function]</i>   <b>write-char</b> <a 
 id="dx144-198021"></a><a 
 id="x144-198022r718"></a>   <i>character</i>  <b>&#x0026;optional</b>  <i>output-stream</i>
<!--l. 4222--><p class="noindent" ><a 
href="#x144-198022r718">write-char</a> outputs the character to output-stream, and returns character.
</div>
<div class=defun>
<!--l. 4228--><p class="noindent" > <i>[Function]</i>   <b>write-string</b> <a 
 id="dx144-198023"></a><a 
 id="x144-198024r719"></a>   <i>string</i>  <b>&#x0026;optional</b>  <i>output-stream</i> <b>&#x0026;key</b>  :start
:end<br 
class="newline" /><i>[Function]</i>   <b>write-line</b> <a 
 id="dx144-198025"></a><a 
 id="x144-198026r720"></a>   <i>string</i>  <b>&#x0026;optional</b>  <i>output-stream</i> <b>&#x0026;key</b>  :start
:end
<!--l. 4231--><p class="noindent" ><a 
href="#x144-198024r719">write-string</a> writes the characters of the speciﬁed substring of string to the
output-stream. The <i>:start</i> and <i>:end</i> parameters delimit a substring of string in the
usual manner (see chapter <a 
href="clmch14.html#x99-14100014">14<!--tex4ht:ref: KSEQUE --></a>). <a 
href="#x144-198026r720">write-line</a> does the same thing but then
outputs a newline afterwards. (See <a 
href="clmse116.html#x143-195010r698">read-line</a>.) In either case, the string
is returned (not the substring delimited by <i>:start</i> and <i>:end</i>). In some
implementations these may be much more eﬃcient than an explicit loop using
<a 
href="#x144-198022r718">write-char</a>.
                                                                          

                                                                          
</div>
<div class=defun>
<!--l. 4246--><p class="noindent" > <i>[Function]</i>   <b>terpri</b> <a 
 id="dx144-198027"></a><a 
 id="x144-198028r721"></a>   <b>&#x0026;optional</b>  <i>output-stream</i><br 
class="newline" /><i>[Function]</i>   <b>fresh-line</b> <a 
 id="dx144-198029"></a><a 
 id="x144-198030r722"></a>   <b>&#x0026;optional</b>  <i>output-stream</i>
<!--l. 4249--><p class="noindent" >The function <a 
href="#x144-198028r721">terpri</a> outputs a newline to output-stream. It is identical in eﬀect to
<i>(write-char #<tt>\</tt>Newline output-stream)</i>; however, <a 
href="#x144-198028r721">terpri</a> always returns
<a 
href="clmse31.html#x42-70002r19">nil</a>.
<!--l. 4255--><p class="indent" >   <a 
href="#x144-198030r722">fresh-line</a> is similar to <a 
href="#x144-198028r721">terpri</a> but outputs a newline only if the stream is not
already at the start of a line. (If for some reason this cannot be determined, then
a newline is output anyway.) This guarantees that the stream will be
on a “fresh line” while consuming as little vertical distance as possible.
<a 
href="#x144-198030r722">fresh-line</a> is a predicate that is true if it output a newline, and otherwise
false.
</div>
<div class=defun>
<!--l. 4265--><p class="noindent" > <i>[Function]</i>   <b>ﬁnish-output</b> <a 
 id="dx144-198031"></a><a 
 id="x144-198032r723"></a>   <b>&#x0026;optional</b>  <i>output-stream</i><br 
class="newline" /><i>[Function]</i>   <b>force-output</b> <a 
 id="dx144-198033"></a><a 
 id="x144-198034r724"></a>   <b>&#x0026;optional</b>  <i>output-stream</i><br 
class="newline" /><i>[Function]</i>   <b>clear-output</b> <a 
 id="dx144-198035"></a><a 
 id="x144-198036r725"></a>   <b>&#x0026;optional</b>  <i>output-stream</i>
<!--l. 4269--><p class="noindent" >Some streams may be implemented in an asynchronous or buﬀered manner. The
function <a 
href="#x144-198032r723">ﬁnish-output</a> attempts to ensure that all output sent to output-stream
has reached its destination, and only then returns <a 
href="clmse31.html#x42-70002r19">nil</a>. <a 
href="#x144-198034r724">force-output</a> initiates the
emptying of any internal buﬀers but returns <a 
href="clmse31.html#x42-70002r19">nil</a> without waiting for completion or
acknowledgment.
<!--l. 4277--><p class="indent" >   The function <a 
href="#x144-198036r725">clear-output</a>, on the other hand, attempts to abort any
outstanding output operation in progress in order to allow as little output as
possible to continue to the destination. This is useful, for example, to abort a
lengthy output to the terminal when an asynchronous error occurs. <a 
href="#x144-198036r725">clear-output</a>
returns <a 
href="clmse31.html#x42-70002r19">nil</a>.
<!--l. 4284--><p class="indent" >   The precise actions of all three of these operations are implementation-dependent.
</div>
<div class=newer>
<div class=defmac>
<!--l. 4290--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> print-unreadable-object </b> <a 
 id="dx144-198037"></a><a 
 id="x144-198038r726"></a>   (object stream  [[ <i><i>:type</i> type | <i>:identity</i> id</i>]]  )  {<i>declaration</i>}∗  {<i>form</i>}∗
</td></tr></table>
<!--l. 4293--><p class="indent" >
                                                                          

                                                                          
</div>
   X3J13 voted in June 1989 ⟨<b>?</b>⟩ to add <a 
href="#x144-198038r726">print-unreadable-object</a>, which will
output a printed representation of object on stream, beginning with <i>#&#x003C;</i>
and ending with <i>&#x003E;</i>. Everything output to the stream during execution
of the body forms is enclosed in the angle brackets. If type is true, the
body output is preceded by a brief description of the object&#x2019;s type and
a space character. If id is true, the body output is followed by a space
character and a representation of the object&#x2019;s identity, typically a storage
address.
   If <i>*print-readably*</i> is true, <a 
href="#x144-198038r726">print-unreadable-object</a> signals an error of type
print-not-readable without printing anything.
   The object, stream, type, and id arguments are all evaluated normally. The type
and id default to false. It is valid to provide no body forms. If type and id are both
true and there are no body forms, only one space character separates the printed
type and the printed identity.
   The value returned by <a 
href="#x144-198038r726">print-unreadable-object</a> is <a 
href="clmse31.html#x42-70002r19">nil</a>. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defmethod print-object ((obj airplane) stream)
</td></tr></table>
<!--l. 4316--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (print-unreadable-object (obj stream :type t :identity t)</td></tr></table>
<!--l. 4317--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (princ (tail-number obj) stream)))</td></tr></table>
<!--l. 4318--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(print my-airplane)  prints</td></tr></table>
<!--l. 4319--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#&#x003C;Airplane NW0773 777500123135&#x003E;     ;In implementation A</td></tr></table>
<!--l. 4320--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     or perhaps</td></tr></table>
<!--l. 4321--><p class="indent" >      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#&#x003C;FAA:AIRPLANE NW0773 17&#x003E;           ;In implementation B</td></tr></table>
<!--l. 4323--><p class="indent" >
</div>
</div>
<!--l. 4324--><p class="noindent" >The big advantage of <a 
href="#x144-198038r726">print-unreadable-object</a> is that it allows a user to write
<a 
href="clmse151.html#x184-311128r966">print-object</a> methods that adhere to implementation-speciﬁc style without
requiring the user to write implementation-dependent code.
<!--l. 4329--><p class="indent" >   The X3J13 vote left it unclear whether <a 
href="#x144-198038r726">print-unreadable-object</a> permits
declarations to appear before the body of the macro call. I believe that was the
intent, and this is reﬂected in the syntax shown above; but this is only my
interpretation.
</div>
                                                                          

                                                                          
</div>
<!--l. 4336--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">22.3.2   </span> <a 
 id="x144-19900022.3.2"></a>Output to Binary Streams</h4>
<!--l. 4338--><p class="noindent" >Common Lisp currently speciﬁes only a very simple facility for binary output: the
writing of a single byte as an integer.
<div class=defun>
<!--l. 4341--><p class="noindent" > <i>[Function]</i>   <b>write-byte</b> <a 
 id="dx144-199001"></a><a 
 id="x144-199002r727"></a>   <i>integer</i>  <i>binary-output-stream</i>
<!--l. 4343--><p class="noindent" ><a 
href="#x144-199002r727">write-byte</a> writes one byte, the value of integer. It is an error if integer is not of
the type speciﬁed as the <i>:element-type</i> argument to <a 
href="clmse120.html#x148-215002r766">open</a> when the stream was
created. The value integer is returned.
</div>
<!--l. 4352--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">22.3.3   </span> <a 
 id="x144-20000022.3.3"></a>Formatted Output to Character Streams</h4>
<a 
 id="dx144-200001"></a>
<!--l. 4356--><p class="noindent" >The function <a 
href="#x144-200003r728">format</a> is very useful for producing nicely formatted text, producing
good-looking messages, and so on. <a 
href="#x144-200003r728">format</a> can generate a string or output to a
stream.
<!--l. 4360--><p class="indent" >   Formatted output is performed not only by the <a 
href="#x144-200003r728">format</a> function itself but by
certain other functions that accept a control string “the way <a 
href="#x144-200003r728">format</a> does.” For
example, error-signaling functions such as <a 
href="clmse155.html#x189-335004r989">cerror</a> accept <a 
href="#x144-200003r728">format</a> control
strings.
<div class=defun>
<!--l. 4365--><p class="noindent" > <i>[Function]</i>   <b>format</b> <a 
 id="dx144-200002"></a><a 
 id="x144-200003r728"></a>   <i>destination</i>  <i>control-string</i>  <b>&#x0026;rest</b>  arguments
<!--l. 4367--><p class="noindent" ><a 
href="#x144-200003r728">format</a> is used to produce formatted output. <a 
href="#x144-200003r728">format</a> outputs the characters of
control-string, except that a tilde (<i><tt>~</tt></i>) introduces a directive. The character after
the tilde, possibly preceded by preﬁx parameters and modiﬁers, speciﬁes what
kind of formatting is desired. Most directives use one or more elements
of arguments to create their output; the typical directive puts the next
element of arguments into the output, formatted in some special way. It is
an error if no argument remains for a directive requiring an argument,
but it is not an error if one or more arguments remain unprocessed by a
directive.
                                                                          

                                                                          
<!--l. 4380--><p class="indent" >   The output is sent to destination. If destination is <a 
href="clmse31.html#x42-70002r19">nil</a>, a string is created that
contains the output; this string is returned as the value of the call to
<a 
href="#x144-200003r728">format</a>.
<div class=new>
<!--l. 4385--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that when the ﬁrst argument to
<a 
href="#x144-200003r728">format</a> is <a 
href="clmse31.html#x42-70002r19">nil</a>, <a 
href="#x144-200003r728">format</a> creates a stream of type string-stream in much the same
manner as <a 
href="clmse113.html#x139-184026r653">with-output-to-string</a>. (This stream may be visible to the user if, for
example, the <i><tt>~</tt>S</i> directive is used to print a <a 
href="clmse104.html#x128-170002r617">defstruct</a> structure that has a
user-supplied print function.)
</div>
<!--l. 4395--><p class="indent" >   In all other cases <a 
href="#x144-200003r728">format</a> returns <a 
href="clmse31.html#x42-70002r19">nil</a>, performing output to destination as a side
eﬀect. If destination is a stream, the output is sent to it. If destination
is <a 
href="clmse31.html#x42-70004r20">t</a>, the output is sent to the stream that is the value of the variable
<i>*standard-output*</i>. If destination is a string with a ﬁll pointer, then in eﬀect
the output characters are added to the end of the string (as if by use of
<a 
href="clmse98.html#x120-162008r588">vector-push-extend</a>).
<!--l. 4405--><p class="indent" >   The <a 
href="#x144-200003r728">format</a> function includes some extremely complicated and specialized
features. It is not necessary to understand all or even most of its features to
use <a 
href="#x144-200003r728">format</a> eﬀectively. The beginner should skip over anything in the
following documentation that is not immediately useful or clear. The
more sophisticated features (such as conditionals and iteration) are there
for the convenience of programs with especially complicated formatting
requirements.
<!--l. 4414--><p class="indent" >   A <a 
href="#x144-200003r728">format</a> directive consists of a tilde (<i><tt>~</tt></i>), optional preﬁx parameters separated
by commas, optional colon (<i>:</i>) and at-sign (<i><tt>@</tt></i>) modiﬁers, and a single character
indicating what kind of directive this is. The alphabetic case of the directive
character is ignored. The preﬁx parameters are generally integers, notated as
optionally signed decimal numbers.
<div class=newer>
<!--l. 4423--><p class="indent" >   X3J13 voted in June 1987 ⟨<b>?</b>⟩ to specify that if both colon and at-sign
modiﬁers are present, they may appear in either order; thus <i><tt>~</tt>:<tt>@</tt>R</i> and <i><tt>~</tt><tt>@</tt>:R</i> mean
the same thing. However, it is traditional to put the colon ﬁrst, and all the
examples in this book put colons before at-signs.
</div>
<!--l. 4430--><p class="indent" >   Examples of control strings: <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">&#x0022;<tt>~</tt>S&#x0022;           ;An <i><tt>~</tt>S</i> directive with no parameters or modiﬁers
</td></tr></table>
<!--l. 4432--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">&#x0022;<tt>~</tt>3,-4:<tt>@</tt>s&#x0022;     ;An <i><tt>~</tt>S</i> directive with two parameters, 3 and  − 4,</td></tr></table>
<!--l. 4433--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               ; and both the colon and at-sign ﬂags</td></tr></table>
<!--l. 4434--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">&#x0022;<tt>~</tt>,+4S&#x0022;        ;First preﬁx parameter is omitted and takes</td></tr></table>
<!--l. 4435--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               ; on its default value; the second parameter is 4</td></tr></table>
<!--l. 4437--><p class="indent" >
</div>
</div>
<!--l. 4438--><p class="noindent" >Sometimes a preﬁx parameter is used to specify a character, for instance the
padding character in a right- or left-justifying operation. In this case a
single quote (<i>&#x2019;</i>) followed by the desired character may be used as a preﬁx
parameter, to mean the character object that is the character following
the single quote. For example, you can use <i><tt>~</tt>5,&#x2019;0d</i> to print an integer in
decimal radix in ﬁve columns with leading zeros, or <i><tt>~</tt>5,&#x2019;*d</i> to get leading
asterisks.
<!--l. 4447--><p class="indent" >   In place of a preﬁx parameter to a directive, you can put the letter V (or v),
which takes an argument from arguments for use as a parameter to the directive.
Normally this should be an integer or character object, as appropriate. This
feature allows variable-width ﬁelds and the like. If the argument used by a V
parameter is <a 
href="clmse31.html#x42-70002r19">nil</a>, the eﬀect is as if the parameter had been omitted. You may also
use the character <i>#</i> in place of a parameter; it represents the number of
arguments remaining to be processed.
<!--l. 4456--><p class="indent" >   It is an error to give a format directive more parameters than it is described
here as accepting. It is also an error to give colon or at-sign modiﬁers
to a directive in a combination not speciﬁcally described here as being
meaningful.
</div>
                                                                          

                                                                          
<div class=new>
<!--l. 4465--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to clarify the interaction between <a 
href="#x144-200003r728">format</a> and
the various printer control variables (those named <i>*print-xxx*</i>). This is important
because many <a 
href="#x144-200003r728">format</a> operations are deﬁned, directly or indirectly, in terms of
<i>prin1</i> or <a 
href="#x144-198012r713">princ</a>, which are aﬀected by the printer control variables. The general
rule is that <a 
href="#x144-200003r728">format</a> does not bind any of the standard printer control variables
except as speciﬁed in the individual descriptions of directives. An implementation
may not bind any standard printer control variable not speciﬁed in the
description of a <a 
href="#x144-200003r728">format</a> directive, nor may an implementation fail to bind
any standard printer control variables that is speciﬁed to be bound by
such a description. (See these descriptions for speciﬁc changes voted by
X3J13.)
<!--l. 4480--><p class="indent" >   One consequence of this change is that the user is guaranteed to be able to use
the <a 
href="#x144-200003r728">format</a> <i><tt>~</tt>A</i> and <i><tt>~</tt>S</i> directives to do pretty printing, under control of the
<i>*print-pretty*</i> variable. Implementations have diﬀered on this point in their
interpretations of the ﬁrst edition. The new <i><tt>~</tt>W </i> directive may be more
appropriate than either <i><tt>~</tt>A</i> and <i><tt>~</tt>S</i> for some purposes, whether for pretty printing
or ordinary printing. See section <a 
href="clmse147.html#x179-25700027.4">27.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a> for a discussion of <i><tt>~</tt>W </i> and other new
<a 
href="#x144-200003r728">format</a> directives related to pretty printing.
</div>
<!--l. 4492--><p class="indent" >   Here are some relatively simple examples to give you the general ﬂavor of how
<a 
href="#x144-200003r728">format</a> is used. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;foo&#x0022;)  ⇒ &#x0022;foo&#x0022;
</td></tr></table>
<!--l. 4495--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4496--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x 5)</td></tr></table>
<!--l. 4497--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4498--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;The answer is <tt>~</tt>D.&#x0022; x)  ⇒ &#x0022;The answer is 5.&#x0022;</td></tr></table>
<!--l. 4499--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4500--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;The answer is <tt>~</tt>3D.&#x0022; x)  ⇒ &#x0022;The answer is   5.&#x0022;</td></tr></table>
<!--l. 4501--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4502--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;The answer is <tt>~</tt>3,&#x2019;0D.&#x0022; x)  ⇒ &#x0022;The answer is 005.&#x0022;</td></tr></table>
<!--l. 4503--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4504--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;The answer is <tt>~</tt>:D.&#x0022; (expt 47 x))</td></tr></table>
<!--l. 4505--><p class="indent" >    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                 ⇒ &#x0022;The answer is 229,345,007.&#x0022;</td></tr></table>
<!--l. 4507--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq y &#x0022;elephant&#x0022;)
</td></tr></table>
<!--l. 4510--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4511--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;Look at the <tt>~</tt>A!&#x0022; y)  ⇒ &#x0022;Look at the elephant!&#x0022;</td></tr></table>
<!--l. 4512--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4513--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;Type <tt>~</tt>:C to <tt>~</tt>A.&#x0022;</td></tr></table>
<!--l. 4514--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (set-char-bit #<tt>\</tt>D :control t)</td></tr></table>
<!--l. 4515--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x0022;delete all your ﬁles&#x0022;)</td></tr></table>
<!--l. 4516--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ &#x0022;Type Control-D to delete all your ﬁles.&#x0022;</td></tr></table>
<!--l. 4518--><p class="indent" >
</div>
</div>
<!--l. 4520--><p class="indent" >
                                                                          

                                                                          
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq n 3)
</td></tr></table>
<!--l. 4524--><p class="indent" >
</div>
</div>
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>D item<tt>~</tt>:P found.&#x0022; n)  ⇒ &#x0022;3 items found.&#x0022;
</td></tr></table>
<!--l. 4527--><p class="indent" >
</div>
</div>
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>R dog<tt>~</tt>:<tt>[</tt>s are<tt>~</tt>; is<tt>~</tt><tt>]</tt> here.&#x0022; n (= n 1))
</td></tr></table>
<!--l. 4529--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       ⇒ &#x0022;three dogs are here.&#x0022;</td></tr></table>
<!--l. 4531--><p class="indent" >
</div>
</div>
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>R dog<tt>~</tt>:*<tt>~</tt><tt>[</tt>s are<tt>~</tt>; is<tt>~</tt>:;s are<tt>~</tt><tt>]</tt> here.&#x0022; n)
</td></tr></table>
<!--l. 4533--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       ⇒ &#x0022;three dogs are here.&#x0022;</td></tr></table>
<!--l. 4535--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;Here <tt>~</tt><tt>[</tt>are<tt>~</tt>;is<tt>~</tt>:;are<tt>~</tt><tt>]</tt> <tt>~</tt>:*<tt>~</tt>R pupp<tt>~</tt>:<tt>@</tt>P.&#x0022; n)
</td></tr></table>
<!--l. 4537--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       ⇒ &#x0022;Here are three puppies.&#x0022;</td></tr></table>
<!--l. 4539--><p class="indent" >
</div>
</div>
<!--l. 4541--><p class="indent" >   In the descriptions of the directives that follow, the term arg in general refers
to the next item of the set of arguments to be processed. The word or phrase at
the beginning of each description is a mnemonic (not necessarily an accurate one)
for the directive. <div class=flushdesc>
  <div><br /><b>
<i><tt>~</tt>A</i>                                                                       </b>
Ascii. An arg, any Lisp object, is printed without escape characters (as by
<a 
href="#x144-198012r713">princ</a>). In particular, if arg is a string, its characters will be output verbatim.
If arg is <a 
href="clmse31.html#x42-70002r19">nil</a>, it will be printed as <a 
href="clmse31.html#x42-70002r19">nil</a>; the colon modiﬁer (<i><tt>~</tt>:A</i>) will cause an
arg of <a 
href="clmse31.html#x42-70002r19">nil</a> to be printed as <i>(</i><i>)</i>, but if arg is a composite structure, such as a
list or vector, any contained occurrences of <a 
href="clmse31.html#x42-70002r19">nil</a> will still be printed as <a 
href="clmse31.html#x42-70002r19">nil</a>.
<i>
<!--l. 4557--><p class="indent" >  <tt>~</tt>mincolA</i> inserts spaces on the right, if necessary, to make the width at
least mincol columns. The <i><tt>@</tt></i> modiﬁer causes the spaces to be inserted on the
left rather than the right.
<i>
<!--l. 4561--><p class="indent" >  <tt>~</tt>mincol,colinc,minpad,padcharA</i>  is  the  full  form  of  <i><tt>~</tt>A</i>,  which  allows
elaborate control of the padding. The string is padded on the right (or on the
left if the <i><tt>@</tt></i> modiﬁer is used) with at least minpad copies of padchar; padding
characters are then inserted colinc characters at a time until the total width
is at least mincol. The defaults are <i>0</i> for mincol and minpad, <i>1</i> for colinc,
and the space character for padchar.
<div class=new>
                                                                          

                                                                          
<!--l. 4571--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i> to
<a 
href="clmse31.html#x42-70002r19">nil</a> during the processing of the <i><tt>~</tt>A</i> directive.
</div>
  <br /><b>
<i><tt>~</tt>S</i>                                                                        </b>
S-expression. This is just like <i><tt>~</tt>A</i>, but arg is printed with escape characters (as by
<i>prin1</i> rather than <a 
href="#x144-198012r713">princ</a>). The output is therefore suitable for input to <a 
href="clmse116.html#x143-195002r694">read</a>. <i><tt>~</tt>S</i>
accepts all the arguments and modiﬁers that <i><tt>~</tt>A</i> does.
<div class=new>
<!--l. 4585--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i> to
<a 
href="clmse31.html#x42-70004r20">t</a> during the processing of the <i><tt>~</tt>S</i> directive.
</div>
<!--l. 4591--><p class="indent" >
                                                                          

                                                                          
  <br /><b>
<i><tt>~</tt>D</i>                                                                       </b>
Decimal. An arg, which should be an integer, is printed in decimal radix. <i><tt>~</tt>D</i> will
never put a decimal point after the number.
<i>
<!--l. 4598--><p class="indent" >  <tt>~</tt>mincolD</i> uses a column width of mincol; spaces are inserted on the left if the
number requires fewer than mincol columns for its digits and sign. If the
number doesn&#x2019;t ﬁt in mincol columns, additional columns are used as
needed.
<i>
<!--l. 4603--><p class="indent" >  <tt>~</tt>mincol,padcharD</i> uses padchar as the pad character instead of space.
<!--l. 4606--><p class="indent" >  If arg is not an integer, it is printed in <i><tt>~</tt>A</i> format and decimal base.
<div class=new>
<!--l. 4610--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i>
to <a 
href="clmse31.html#x42-70002r19">nil</a>, <i>*print-radix*</i> to <a 
href="clmse31.html#x42-70002r19">nil</a>, and <i>*print-base*</i> to <i>10</i> during processing of
<i><tt>~</tt>D</i>.
</div>
<!--l. 4617--><p class="indent" >  The <i><tt>@</tt></i> modiﬁer causes the number&#x2019;s sign to be printed always; the default is to
print it only if the number is negative. The <i>:</i> modiﬁer causes commas to be
printed between groups of three digits; the third preﬁx parameter may be used to
change the character used as the comma. Thus the most general form of <i><tt>~</tt>D</i> is
<i><tt>~</tt>mincol,padchar,commacharD</i>.
<div class=new>
<!--l. 4625--><p class="indent" >  X3J13 voted in March 1988 ⟨<b>?</b>⟩ to add a fourth parameter, the commainterval.
This must be an integer; if it is not provided, it defaults to 3. This parameter
controls the number of digits in each group separated by the commachar.
<!--l. 4632--><p class="indent" >  By extension, each of the <i><tt>~</tt>B</i>, <i><tt>~</tt>O</i>, and <i><tt>~</tt>X</i> directives accepts a commainterval
as a fourth parameter, and the <i><tt>~</tt>R</i> directive accepts a commainterval as its ﬁfth
parameter. Examples: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil &#x0022;<tt>~</tt>„&#x2019; ,4B&#x0022; #xFACE)  ⇒ &#x0022;1111 1010 1100 1110&#x0022;
</td></tr></table>
<!--l. 4637--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil &#x0022;<tt>~</tt>„&#x2019; ,4B&#x0022; #x1CE)  ⇒ &#x0022;1 1100 1110&#x0022;</td></tr></table>
<!--l. 4638--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil &#x0022;<tt>~</tt>19„&#x2019; ,4B&#x0022; #xFACE)  ⇒ &#x0022;1111 1010 1100 1110&#x0022;</td></tr></table>
<!--l. 4639--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil &#x0022;<tt>~</tt>19„&#x2019; ,4B&#x0022; #x1CE)  ⇒ &#x0022;0000 0001 1100 1110&#x0022;</td></tr></table>
<!--l. 4641--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 4642--><p class="noindent" >This is one of those little improvements that probably don&#x2019;t matter much but aren&#x2019;t
hard to implement either. It was pretty silly having the number 3 wired into
the deﬁnition of comma separation when it is just as easy to make it a
parameter.
</div>
  <br /><b>
<i><tt>~</tt>B</i>                                                                       </b>
Binary. This is just like <i><tt>~</tt>D</i> but prints in binary radix (radix 2) instead of
decimal. The full form is therefore <i><tt>~</tt>mincol,padchar,commacharB</i>.
<div class=new>
<!--l. 4655--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i>
to <a 
href="clmse31.html#x42-70002r19">nil</a>, <i>*print-radix*</i> to <a 
href="clmse31.html#x42-70002r19">nil</a>, and <i>*print-base*</i> to <i>2</i> during processing of
<i><tt>~</tt>B</i>.
</div>
  <br /><b>
<i><tt>~</tt>O</i>                                                                       </b>Octal.
This is just like <i><tt>~</tt>D</i> but prints in octal radix (radix 8) instead of decimal. The full
form is therefore <i><tt>~</tt>mincol,padchar,commacharO</i>.
<div class=new>
<!--l. 4669--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i>
to <a 
href="clmse31.html#x42-70002r19">nil</a>, <i>*print-radix*</i> to <a 
href="clmse31.html#x42-70002r19">nil</a>, and <i>*print-base*</i> to <i>8</i> during processing of
<i><tt>~</tt>O</i>.
</div>
  <br /><b>
<i><tt>~</tt>X</i>                                                                       </b>
Hexadecimal. This is just like <i><tt>~</tt>D</i> but prints in hexadecimal radix (radix 16)
instead of decimal. The full form is therefore <i><tt>~</tt>mincol,padchar,commacharX</i>.
<div class=new>
<!--l. 4683--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i>
to <a 
href="clmse31.html#x42-70002r19">nil</a>, <i>*print-radix*</i> to <a 
href="clmse31.html#x42-70002r19">nil</a>, and <i>*print-base*</i> to <i>16</i> during processing of
<i><tt>~</tt>X</i>.
</div>
<div class=incompatibility>
                                                                          

                                                                          
<!--l. 4691--><p class="noindent" ><b>Compatibility note:</b> In MacLisp and Lisp Machine Lisp the <i><tt>~</tt>X</i> directive outputs a
space, and <i><tt>~</tt>nX</i> outputs n spaces, in a manner analogous to Fortran X format. In
Common Lisp the directive <i><tt>~</tt><tt>@</tt>T</i> is used for that purpose.
</div>
  <br /><b>
<i><tt>~</tt>R</i>                                                                       </b>Radix.
<i><tt>~</tt>nR</i> prints arg in radix n. The modiﬁer ﬂags and any remaining parameters are
used as for the <i><tt>~</tt>D</i> directive. Indeed, <i><tt>~</tt>D</i> is the same as <i><tt>~</tt>10R</i>. The full form here
is therefore <i><tt>~</tt>radix,mincol,padchar,commacharR</i>.
<div class=new>
<!--l. 4708--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i> to
<a 
href="clmse31.html#x42-70002r19">nil</a>, <i>*print-radix*</i> to <a 
href="clmse31.html#x42-70002r19">nil</a>, and <i>*print-base*</i> to the value of the ﬁrst parameter
during the processing of the <i><tt>~</tt>R</i> directive with a parameter.
</div>
<!--l. 4716--><p class="indent" >  If no parameters are given to <i><tt>~</tt>R</i>, then an entirely diﬀerent interpretation is
given. <div class=new>Notice of correction. In the ﬁrst edition, this sentence referred to
“arguments” given to <i><tt>~</tt>R</i>. The correct term is “parameters.”
</div> The argument should be an integer; suppose it is <i>4</i>. Then <i><tt>~</tt>R</i> prints arg as a
cardinal English number: four; <i><tt>~</tt>:R</i> prints arg as an ordinal English number:
<a 
href="clmse87.html#x107-149014r480">fourth</a>; <i><tt>~</tt><tt>@</tt>R</i> prints arg as a Roman numeral: IV; and <i><tt>~</tt>:<tt>@</tt>R</i> prints arg as an old
Roman numeral: IIII.
<div class=new>
<!--l. 4731--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-base*</i> to
<i>10</i> during the processing of the <i><tt>~</tt>R</i> directive with no parameter.
</div>
<div class=new>
<!--l. 4738--><p class="indent" >  The ﬁrst edition did not specify how <i><tt>~</tt>R</i> and its variants should handle
arguments that are very large or not positive. Actual practice varies, and
X3J13 has not yet addressed the topic. Here is a sampling of current
practice.
<!--l. 4743--><p class="indent" >  For <i><tt>~</tt><tt>@</tt>R</i> and <i><tt>~</tt>:<tt>@</tt>R</i>, nearly all implementations produce Roman numerals only
for integers in the range 1 to 3999, inclusive. Some implementations will produce
old-style Roman numerals for integers in the range 1 to 4999, inclusive.
All other integers are printed in decimal notation, as if <i><tt>~</tt>D</i> had been
used.
<!--l. 4749--><p class="indent" >  For zero, most implementations print zero for <i><tt>~</tt>R</i> and zeroth for <i><tt>~</tt>:R</i>.
<!--l. 4752--><p class="indent" >  For <i><tt>~</tt>R</i> with a negative argument, most implementations simply print the word
                                                                          

                                                                          
minus followed by its absolute value as a cardinal in English.
<!--l. 4755--><p class="indent" >  For <i><tt>~</tt>:R</i> with a negative argument, some implementations also print the
word minus followed by its absolute value as an ordinal in English; other
implementations print the absolute value followed by the word <a 
href="clmse158.html#x193-352008r1077">previous</a>. Thus the
argument <i>-4</i> might produce <i>minus fourth</i> or <i>fourth previous</i>. Each has its charm,
but one is not always a suitable substitute for the other; users should be
careful.
<!--l. 4762--><p class="indent" >  There is standard English nomenclature for fairly large integers (up to 10<sup>6</sup>0, at
least), based on appending the suﬃx -illion to Latin names of integers. Thus we
have the names trillion, quadrillion, sextillion, septillion, and so on. For extremely
large integers, one may express powers of ten in English. One implementation
gives <i>1606938044258990275541962092341162602522202993782792835301376</i>
(which is 2<sup>200</sup>, the result of <i>(ash 1 200)</i>) in this manner:
<div class="flushleft" 
>
<!--l. 4771--><p class="noindent" >
 one times ten to the sixtieth power six hundred six times ten to the ﬁfty-seventh
power nine hundred thirty-eight septdecillion forty-four sexdecillion two hundred
ﬁfty-eight quindecillion nine hundred ninety quattuordecillion two hundred
seventy-ﬁve tredecillion ﬁve hundred forty-one duodecillion nine hundred
sixty-two undecillion ninety-two decillion three hundred forty-one nonillion one
hundred sixty-two octillion six hundred two septillion ﬁve hundred twenty-two
sextillion two hundred two quintillion nine hundred ninety-three quadrillion seven
hundred eighty-two trillion seven hundred ninety-two billion eight hundred
thirty-ﬁve million three hundred one thousand three hundred seventy-six</div>
<!--l. 4784--><p class="noindent" >Another implementation prints it this way (note the use of plus):
<div class="flushleft" 
>
<!--l. 4785--><p class="noindent" >
 one times ten to the sixtieth power plus six hundred six times ten to the
ﬁfty-seventh power plus ... plus two hundred seventy-ﬁve times ten to the
forty-second power plus ﬁve hundred forty-one duodecillion nine hundred
sixty-two undecillion ... three hundred seventy-six</div>
<!--l. 4792--><p class="noindent" >(I have elided some of the text here to save space.)
<!--l. 4794--><p class="indent" >  Unfortunately, the meaning of this nomenclature diﬀers between American
English (in which k-illion means 10<sup>3(k+1)</sup>, so one trillion is 10<sup>12</sup>) and British
English (in which k-illion means 10<sup>6k</sup>, so one trillion is 10<sup>18</sup>). To avoid both
confusion and prolixity, I recommend using decimal notation for all numbers
                                                                          

                                                                          
above 999,999,999; this is similar to the escape hatch used for Roman
numerals.
</div>
  <br /><b>
<i><tt>~</tt>P</i>                                                                       </b>
Plural. If arg is not <a 
href="clmse33.html#x44-74004r47">eql</a> to the integer <i>1</i>, a lowercase s is printed; if arg is <a 
href="clmse33.html#x44-74004r47">eql</a> to <i>1</i>,
nothing is printed. (Notice that if arg is a ﬂoating-point <i>1.0</i>, the s is printed.)
<i><tt>~</tt>:P</i> does the same thing, after doing a <i><tt>~</tt>:*</i> to back up one argument;
that is, it prints a lowercase s if the last argument was not <i>1</i>. This is
useful after printing a number using <i><tt>~</tt>D</i>. <i><tt>~</tt><tt>@</tt>P</i> prints y if the argument
is <i>1</i>, or ies if it is not. <i><tt>~</tt>:<tt>@</tt>P</i> does the same thing, but backs up ﬁrst. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>D tr<tt>~</tt>:<tt>@</tt>P/<tt>~</tt>D win<tt>~</tt>:P&#x0022; 7 1)  ⇒ &#x0022;7 tries/1 win&#x0022;
</td></tr></table>
<!--l. 4814--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>D tr<tt>~</tt>:<tt>@</tt>P/<tt>~</tt>D win<tt>~</tt>:P&#x0022; 1 0)  ⇒ &#x0022;1 try/0 wins&#x0022;</td></tr></table>
<!--l. 4815--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>D tr<tt>~</tt>:<tt>@</tt>P/<tt>~</tt>D win<tt>~</tt>:P&#x0022; 1 3)  ⇒ &#x0022;1 try/3 wins&#x0022;</td></tr></table>
<!--l. 4817--><p class="indent" >
</div>
</div>
  <br /><b>
<i><tt>~</tt>C</i>                                                                       </b>
Character. The next arg should be a character; it is printed according to the
modiﬁer ﬂags.
<div class=obsolete>
<i>
<!--l. 4824--><p class="indent" >  <tt>~</tt>C</i> prints the character in an implementation-dependent abbreviated format.
This format should be culturally compatible with the host environment.
</div>
<div class=newer>
<!--l. 4830--><p class="indent" >  X3J13 voted in June 1987 ⟨<b>?</b>⟩ to specify that <i><tt>~</tt>C</i> performs exactly the same
action as <a 
href="#x144-198022r718">write-char</a> if the character to be printed has zero for its bits attributes.
X3J13 voted in March 1989 ⟨<b>?</b>⟩ to eliminate the bits and font attributes, replacing
them with the notion of implementation-deﬁned attributes. The net eﬀect is that
                                                                          

                                                                          
characters whose implementation-deﬁned attributes all have the “standard” values
should be printed by <i><tt>~</tt>C</i> in the same way that <a 
href="#x144-198022r718">write-char</a> would print
them.
</div>
<i>
<!--l. 4841--><p class="indent" >  <tt>~</tt>:C</i> spells out the names of the control bits and represents non-printing
characters by their names: Control-Meta-F, Control-Return, Space. This is a
“pretty” format for printing characters.
<i>
<!--l. 4846--><p class="indent" >  <tt>~</tt>:<tt>@</tt>C</i> prints what <i><tt>~</tt>:C</i> would, and then if the character requires unusual
shift keys on the keyboard to type it, this fact is mentioned: <i>Control-∂
(Top-F)</i>. This is the format for telling the user about a key he or she
is expected to type, in prompts, for instance. The precise output may
depend not only on the implementation but on the particular I/O devices in
use.
<i>
<!--l. 4853--><p class="indent" >  <tt>~</tt><tt>@</tt>C</i> prints the character so that the Lisp reader can read it, using <i>#<tt>\</tt></i>
syntax.
<div class=new>
<!--l. 4857--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i> to
<a 
href="clmse31.html#x42-70004r20">t</a> during the processing of the <i><tt>~</tt><tt>@</tt>C</i> directive. Other variants of the <i><tt>~</tt>C</i> directive do
not bind any printer control variables.
</div>
<div class=rationale>
<!--l. 4865--><p class="noindent" ><b>Rationale:</b> In some implementations the <i><tt>~</tt>S</i> directive would do what <i><tt>~</tt>C</i> does, but <i><tt>~</tt>C</i>
is compatible with Lisp dialects such as MacLisp that do not have a character data
type.
</div>
  <br /><b>
<i><tt>~</tt>F</i>                                                                       </b>
Fixed-format ﬂoating-point. The next arg is printed as a ﬂoating-point
number.
<!--l. 4878--><p class="indent" >  The full form is <i><tt>~</tt>w,d,k,overﬂowchar,padcharF</i>. The parameter w is the width of
the ﬁeld to be printed; d is the number of digits to print after the decimal point; k
is a scale factor that defaults to zero.
<!--l. 4884--><p class="indent" >  Exactly w characters will be output. First, leading copies of the character
padchar (which defaults to a space) are printed, if necessary, to pad the ﬁeld on
                                                                          

                                                                          
the left. If the arg is negative, then a minus sign is printed; if the arg is not
negative, then a plus sign is printed if and only if the <i><tt>@</tt></i> modiﬁer was speciﬁed.
Then a sequence of digits, containing a single embedded decimal point, is printed;
this represents the magnitude of the value of arg times 10<sup>k</sup>, rounded to d
fractional digits. (When rounding up and rounding down would produce printed
values equidistant from the scaled value of arg, then the implementation is free to
use either one. For example, printing the argument <i>6.375</i> using the format <i><tt>~</tt>4,2F</i>
may correctly produce either <i>6.37</i> or <i>6.38</i>.) Leading zeros are not permitted,
except that a single zero digit is output before the decimal point if the printed
value is less than 1, and this single zero digit is not output after all if
w = d + 1.
<!--l. 4904--><p class="indent" >  If it is impossible to print the value in the required format in a ﬁeld of
width w, then one of two actions is taken. If the parameter overﬂowchar is
speciﬁed, then w copies of that parameter are printed instead of the scaled
value of arg. If the overﬂowchar parameter is omitted, then the scaled
value is printed using more than w characters, as many more as may be
needed.
<!--l. 4912--><p class="indent" >  If the w parameter is omitted, then the ﬁeld is of variable width. In eﬀect, a
value is chosen for w in such a way that no leading pad characters need to be
printed and exactly d characters will follow the decimal point. For example, the
directive <i><tt>~</tt>,2F</i> will print exactly two digits after the decimal point and as many as
necessary before the decimal point.
<!--l. 4920--><p class="indent" >  If the parameter d is omitted, then there is no constraint on the number of
digits to appear after the decimal point. A value is chosen for d in such a way that
as many digits as possible may be printed subject to the width constraint imposed
by the parameter w and the constraint that no trailing zero digits may appear in
the fraction, except that if the fraction to be printed is zero, then a single zero
digit should appear after the decimal point if permitted by the width
constraint.
<!--l. 4929--><p class="indent" >  If both w and d are omitted, then the eﬀect is to print the value using ordinary
free-format output; <i>prin1</i> uses this format for any number whose magnitude is
either zero or between 10<sup>−3</sup> (inclusive) and 10<sup>7</sup> (exclusive).
<!--l. 4934--><p class="indent" >  If w is omitted, then if the magnitude of arg is so large (or, if d is also omitted,
so small) that more than 100 digits would have to be printed, then an
implementation is free, at its discretion, to print the number using exponential
notation instead, as if by the directive <i><tt>~</tt>E</i> (with all parameters to <i><tt>~</tt>E</i> defaulted,
not taking their values from the <i><tt>~</tt>F</i> directive).
<!--l. 4941--><p class="indent" >  If arg is a rational number, then it is coerced to be a single-ﬂoat and then
                                                                          

                                                                          
printed. (Alternatively, an implementation is permitted to process a rational
number by any other method that has essentially the same behavior but
avoids such hazards as loss of precision or overﬂow because of the coercion.
However, note that if w and d are unspeciﬁed and the number has no
exact decimal representation, for example <i>1/3</i>, some precision cutoﬀ must
be chosen by the implementation: only a ﬁnite number of digits may be
printed.)
<!--l. 4950--><p class="indent" >  If arg is a complex number or some non-numeric object, then it is printed using
the format directive <i><tt>~</tt>wD</i>, thereby printing it in decimal radix and a minimum
ﬁeld width of w. (If it is desired to print each of the real part and imaginary part
of a complex number using a <i><tt>~</tt>F</i> directive, then this must be done explicitly
with two <i><tt>~</tt>F</i> directives and code to extract the two parts of the complex
number.)
<div class=new>
<!--l. 4959--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i> to
<a 
href="clmse31.html#x42-70002r19">nil</a> during the processing of the <i><tt>~</tt>F</i> directive.
</div>
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x)
</td></tr></table>
<!--l. 4966--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format nil &#x0022;<tt>~</tt>6,2F|<tt>~</tt>6,2,1,&#x2019;*F|<tt>~</tt>6,2„&#x2019;?F|<tt>~</tt>6F|<tt>~</tt>,2F|<tt>~</tt>F&#x0022;</td></tr></table>
<!--l. 4967--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          x x x x x x))</td></tr></table>
<!--l. 4968--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 3.14159)   ⇒ &#x0022;  3.14| 31.42|  3.14|3.1416|3.14|3.14159&#x0022;</td></tr></table>
<!--l. 4969--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo -3.14159)  ⇒ &#x0022; -3.14|-31.42| -3.14|-3.142|-3.14|-3.14159&#x0022;</td></tr></table>
<!--l. 4970--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 100.0)     ⇒ &#x0022;100.00|******|100.00| 100.0|100.00|100.0&#x0022;</td></tr></table>
<!--l. 4971--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 1234.0)    ⇒ &#x0022;1234.00|******|??????|1234.0|1234.00|1234.0&#x0022;</td></tr></table>
<!--l. 4972--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 0.006)     ⇒ &#x0022;  0.01|  0.06|  0.01| 0.006|0.01|0.006&#x0022;</td></tr></table>
<!--l. 4974--><p class="indent" >
</div>
</div>
<div class=incompatibility>
<!--l. 4977--><p class="noindent" ><b>Compatibility note:</b> The <i><tt>~</tt>F</i> directive is similar to the <i>Fw.d</i> edit descriptor in
Fortran.
<!--l. 4981--><p class="indent" >  The presence or absence of the <i><tt>@</tt></i> modiﬁer corresponds to the eﬀect of the Fortran SS
                                                                          

                                                                          
or SP edit descriptor; nothing in Common Lisp corresponds to the Fortran S edit
descriptor.
<!--l. 4986--><p class="indent" >  The scale factor speciﬁed by the parameter k corresponds to the scale factor k
speciﬁed by the Fortran <i>kP</i> edit descriptor.
<!--l. 4990--><p class="indent" >  In Fortran, the leading zero that precedes the decimal point when the printed value is
less than 1 is optional; in Common Lisp, the implementation is required to print that
zero digit.
<!--l. 4994--><p class="indent" >  In Common Lisp, the w and d parameters are optional; in Fortran, they are
required.
<!--l. 4997--><p class="indent" >  In Common Lisp, the pad character and overﬂow character are user-speciﬁable; in
Fortran, they are always space and asterisk, respectively.
<!--l. 5000--><p class="indent" >  A Fortran implementation is prohibited from printing a representation of
negative zero; Common Lisp permits the printing of such a representation when
appropriate.
<!--l. 5004--><p class="indent" >  In MacLisp and Lisp Machine Lisp, the <i><tt>~</tt>F</i> format directive takes a single parameter:
the number of digits to use in the printed representation. This incompatibility between
Common Lisp and MacLisp was introduced for the sake of cultural compatibility with
Fortran.
</div>
  <br /><b>
<i><tt>~</tt>E</i>                                                                       </b>
Exponential ﬂoating-point. The next arg is printed in exponential notation.
<!--l. 5016--><p class="indent" >  The full form is <i><tt>~</tt>w,d,e,k,overﬂowchar,padchar,exponentcharE</i>. The
parameter w is the width of the ﬁeld to be printed; d is the number of
digits to print after the decimal point; e is the number of digits to use
when printing the exponent; k is a scale factor that defaults to 1 (not
zero).
<!--l. 5023--><p class="indent" >  Exactly w characters will be output. First, leading copies of the character
padchar (which defaults to a space) are printed, if necessary, to pad the ﬁeld on
the left. If the arg is negative, then a minus sign is printed; if the arg is not
negative, then a plus sign is printed if and only if the <i><tt>@</tt></i> modiﬁer was speciﬁed.
Then a sequence of digits, containing a single embedded decimal point, is
printed. The form of this sequence of digits depends on the scale factor
k. If k is zero, then d digits are printed after the decimal point, and a
single zero digit appears before the decimal point if the total ﬁeld width
will permit it. If k is positive, then it must be strictly less than d + 2; k
signiﬁcant digits are printed before the decimal point, and d − k + 1 digits are
printed after the decimal point. If k is negative, then it must be strictly
                                                                          

                                                                          
greater than  − d; a single zero digit appears before the decimal point
if the total ﬁeld width will permit it, and after the decimal point are
printed ﬁrst  − k zeros and then d + k signiﬁcant digits. The printed
fraction must be properly rounded. (When rounding up and rounding down
would produce printed values equidistant from the scaled value of arg,
then the implementation is free to use either one. For example, printing
<i>637.5</i> using the format <i><tt>~</tt>8,2E</i> may correctly produce either <i>6.37E+02</i> or
<i>6.38E+02</i>.)
<!--l. 5050--><p class="indent" >  Following the digit sequence, the exponent is printed. First the character
parameter exponentchar is printed; if this parameter is omitted, then the exponent
marker that <i>prin1</i> would use is printed, as determined from the type of the
ﬂoating-point number and the current value of <i>*read-default-ﬂoat-format*</i>. Next,
either a plus sign or a minus sign is printed, followed by e digits representing the
power of 10 by which the printed fraction must be multiplied to properly
represent the rounded value of arg.
<!--l. 5061--><p class="indent" >  If it is impossible to print the value in the required format in a ﬁeld of width w,
possibly because k is too large or too small or because the exponent cannot be
printed in e character positions, then one of two actions is taken. If the parameter
overﬂowchar is speciﬁed, then w copies of that parameter are printed instead of
the scaled value of arg. If the overﬂowchar parameter is omitted, then the
scaled value is printed using more than w characters, as many more as
may be needed; if the problem is that d is too small for the speciﬁed k
or that e is too small, then a larger value is used for d or e as may be
needed.
<!--l. 5073--><p class="indent" >  If the w parameter is omitted, then the ﬁeld is of variable width. In eﬀect a
value is chosen for w in such a way that no leading pad characters need to be
printed.
<!--l. 5077--><p class="indent" >  If the parameter d is omitted, then there is no constraint on the number of
digits to appear. A value is chosen for d in such a way that as many digits as
possible may be printed subject to the width constraint imposed by the parameter
w, the constraint of the scale factor k, and the constraint that no trailing zero
digits may appear in the fraction, except that if the fraction to be printed is zero,
then a single zero digit should appear after the decimal point if the width
constraint allows it.
<!--l. 5087--><p class="indent" >  If the parameter e is omitted, then the exponent is printed using the smallest
number of digits necessary to represent its value.
<!--l. 5090--><p class="indent" >  If all of w, d, and e are omitted, then the eﬀect is to print the value using
ordinary free-format exponential-notation output; <i>prin1</i> uses this format for any
                                                                          

                                                                          
non-zero number whose magnitude is less than 10<sup>−3</sup> or greater than or equal to
10<sup>7</sup>.
<div class=new>
<!--l. 5096--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to amend the previous paragraph as
follows:
<!--l. 5100--><p class="indent" >  If all of w, d, and e are omitted, then the eﬀect is to print the value using
ordinary free-format exponential-notation output; <i>prin1</i> uses a similar format for
any non-zero number whose magnitude is less than 10<sup>−3</sup> or greater than or equal
to 10<sup>7</sup>. The only diﬀerence is that the <i><tt>~</tt>E</i> directive always prints a plus or minus
sign before the exponent, while <i>prin1</i> omits the plus sign if the exponent is
non-negative.
<!--l. 5108--><p class="indent" >  (The amendment reconciles this paragraph with the speciﬁcation several
paragraphs above that <i><tt>~</tt>E</i> always prints a plus or minus sign before the
exponent.)
</div>
<!--l. 5113--><p class="indent" >  If arg is a rational number, then it is coerced to be a single-ﬂoat and then
printed. (Alternatively, an implementation is permitted to process a rational
number by any other method that has essentially the same behavior but
avoids such hazards as loss of precision or overﬂow because of the coercion.
However, note that if w and d are unspeciﬁed and the number has no
exact decimal representation, for example <i>1/3</i>, some precision cutoﬀ must
be chosen by the implementation: only a ﬁnite number of digits may be
printed.)
<!--l. 5122--><p class="indent" >  If arg is a complex number or some non-numeric object, then it is printed using
the format directive <i><tt>~</tt>wD</i>, thereby printing it in decimal radix and a minimum
ﬁeld width of w. (If it is desired to print each of the real part and imaginary part
of a complex number using a <i><tt>~</tt>E</i> directive, then this must be done explicitly
with two <i><tt>~</tt>E</i> directives and code to extract the two parts of the complex
number.)
<div class=new>
<!--l. 5131--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i> to
<a 
href="clmse31.html#x42-70002r19">nil</a> during the processing of the <i><tt>~</tt>E</i> directive.
</div>
<div class=lisp>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x)
</td></tr></table>
<!--l. 5138--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format <a 
href="clmse31.html#x42-70002r19">nil</a></td></tr></table>
<!--l. 5139--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          &#x0022;<tt>~</tt>9,2,1„&#x2019;*E|<tt>~</tt>10,3,2,2,&#x2019;?„&#x2019;$E|<tt>~</tt>9,3,2,-2,&#x2019;%<tt>@</tt>E|<tt>~</tt>9,2E&#x0022;</td></tr></table>
<!--l. 5140--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          x x x x))</td></tr></table>
<!--l. 5141--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 3.14159)   ⇒ &#x0022;  3.14E+0| 31.42$-01|+.003E+03|  3.14E+0&#x0022;</td></tr></table>
<!--l. 5142--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo -3.14159)  ⇒ &#x0022; -3.14E+0|-31.42$-01|-.003E+03| -3.14E+0&#x0022;</td></tr></table>
<!--l. 5143--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 1100.0)    ⇒ &#x0022;  1.10E+3| 11.00$+02|+.001E+06|  1.10E+3&#x0022;</td></tr></table>
<!--l. 5144--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 1100.0L0)  ⇒ &#x0022;  1.10L+3| 11.00$+02|+.001L+06|  1.10L+3&#x0022;</td></tr></table>
<!--l. 5145--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 1.1E13)    ⇒ &#x0022;*********| 11.00$+12|+.001E+16| 1.10E+13&#x0022;</td></tr></table>
<!--l. 5146--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 1.1L120)   ⇒ &#x0022;*********|??????????|%%%%%%%%%|1.10L+120&#x0022;</td></tr></table>
<!--l. 5147--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 1.1L1200)  ⇒ &#x0022;*********|??????????|%%%%%%%%%|1.10L+1200&#x0022;</td></tr></table>
<!--l. 5149--><p class="indent" >
</div>
</div>
<!--l. 5150--><p class="noindent" >Here is an example of the eﬀects of varying the scale factor: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(dotimes (k 13)
</td></tr></table>
<!--l. 5152--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format t &#x0022; %Scale factor  2D: | 13,6,2,VE|&#x0022;</td></tr></table>
<!--l. 5153--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:219;" 
class="tabbing">          (- k 5) 3.14159))</td><td style="width:365;" 
class="tabbing-right">                                ;Prints 13 lines</td></tr></table>
<!--l. 5154--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor -5: | 0.000003E+06|</td></tr></table>
<!--l. 5155--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor -4: | 0.000031E+05|</td></tr></table>
<!--l. 5156--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor -3: | 0.000314E+04|</td></tr></table>
<!--l. 5157--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor -2: | 0.003142E+03|</td></tr></table>
<!--l. 5158--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor -1: | 0.031416E+02|</td></tr></table>
<!--l. 5159--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor  0: | 0.314159E+01|</td></tr></table>
<!--l. 5160--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor  1: | 3.141590E+00|</td></tr></table>
<!--l. 5161--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor  2: | 31.41590E-01|</td></tr></table>
<!--l. 5162--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor  3: | 314.1590E-02|</td></tr></table>
<!--l. 5163--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor  4: | 3141.590E-03|</td></tr></table>
<!--l. 5164--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor  5: | 31415.90E-04|</td></tr></table>
<!--l. 5165--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor  6: | 314159.0E-05|</td></tr></table>
<!--l. 5166--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Scale factor  7: | 3141590.E-06|</td></tr></table>
<!--l. 5168--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<div class=incompatibility>
<!--l. 5171--><p class="noindent" ><b>Compatibility note:</b> The <i><tt>~</tt>E</i> directive is similar to the <i>Ew.d</i> and <i>Ew.dEe</i> edit
descriptors in Fortran.
<!--l. 5176--><p class="indent" >  The presence or absence of the <i><tt>@</tt></i> modiﬁer corresponds to the eﬀect of the Fortran SS
or SP edit descriptor; nothing in Common Lisp corresponds to the Fortran S edit
descriptor.
<!--l. 5181--><p class="indent" >  The scale factor speciﬁed by the parameter k corresponds to the scale factor k
speciﬁed by the Fortran <i>kP</i> edit descriptor; note, however, that the default value for k is
1 in Common Lisp, as opposed to the default value of zero in Fortran. (On the other
hand, note that a scale factor of 1 is used for Fortran list-directed output, which is
roughly equivalent to using <i><tt>~</tt>E</i> with the w, d, e, and overﬂowchar parameters
omitted.)
<!--l. 5192--><p class="indent" >  In Common Lisp, the w and d parameters are optional; in Fortran, they are
required.
<!--l. 5195--><p class="indent" >  In Fortran, omitting e causes the exponent to be printed using either two or three
digits; if three digits are required, then the exponent marker is omitted. In Common
Lisp, omitting e causes the exponent to be printed using as few digits as possible; the
exponent marker is never omitted.
<!--l. 5201--><p class="indent" >  In Common Lisp, the pad character and overﬂow character are user-speciﬁable; in
Fortran they are always space and asterisk, respectively.
<!--l. 5204--><p class="indent" >  A Fortran implementation is prohibited from printing a representation of
negative zero; Common Lisp permits the printing of such a representation when
appropriate.
<!--l. 5208--><p class="indent" >  In MacLisp and Lisp Machine Lisp, the <i><tt>~</tt>E</i> format directive takes a single parameter:
the number of digits to use in the printed representation. This incompatibility between
Common Lisp and MacLisp was introduced for the sake of cultural compatibility with
Fortran.
</div>
<!--l. 5216--><p class="indent" >
                                                                          

                                                                          
  <br /><b>
<i><tt>~</tt>G</i>                                                                       </b>
General ﬂoating-point. The next arg is printed as a ﬂoating-point number in either
ﬁxed-format or exponential notation as appropriate.
<!--l. 5222--><p class="indent" >  The full form is <i><tt>~</tt>w,d,e,k,overﬂowchar,padchar,exponentcharG</i>. The
format in which to print arg depends on the magnitude (absolute value)
of the arg. Let n be an integer such that 10<sup>n−1</sup> ≤ arg &#x003C; 10<sup>n</sup>. (If arg is
zero, let n be 0.) Let ee equal e + 2, or 4 if e is omitted. Let ww equal
w − ee, or <a 
href="clmse31.html#x42-70002r19">nil</a> if w is omitted. If d is omitted, ﬁrst let q be the number
of digits needed to print arg with no loss of information and without
leading or trailing zeros; then let d equal <i>(max q (min n 7))</i>. Let dd equal
d − n.
<!--l. 5235--><p class="indent" >  If 0 ≤ dd ≤ d, then arg is printed as if by the format directives <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><tt>~</tt>ww,dd„overﬂowchar,padcharF<tt>~</tt>ee<tt>@</tt>T
</td></tr></table>
<!--l. 5239--><p class="indent" >
</div>
</div>
<!--l. 5240--><p class="noindent" >Note that the scale factor k is not passed to the <i><tt>~</tt>F</i> directive. For all other values of
dd, arg is printed as if by the format directive <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><tt>~</tt>w,d,e,k,overﬂowchar,padchar,exponentcharE
</td></tr></table>
<!--l. 5245--><p class="indent" >
</div>
</div>
<!--l. 5247--><p class="indent" >  In either case, an <i><tt>@</tt></i> modiﬁer is speciﬁed to the <i><tt>~</tt>F</i> or <i><tt>~</tt>E</i> directive if and only if
one was speciﬁed to the <i><tt>~</tt>G</i> directive.
<div class=new>
<!--l. 5252--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i> to
<a 
href="clmse31.html#x42-70002r19">nil</a> during the processing of the <i><tt>~</tt>G</i> directive.
</div> <div class=obsolete> Examples: <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x)
</td></tr></table>
<!--l. 5260--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format <a 
href="clmse31.html#x42-70002r19">nil</a></td></tr></table>
<!--l. 5261--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          &#x0022;<tt>~</tt>9,2,1„&#x2019;*G|<tt>~</tt>9,3,2,3,&#x2019;?„&#x2019;$G|<tt>~</tt>9,3,2,0,&#x2019;%G|<tt>~</tt>9,2G&#x0022;</td></tr></table>
<!--l. 5262--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          x x x))</td></tr></table>
<!--l. 5263--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 0.0314159)  ⇒ &#x0022;  3.14E-2|314.2$-04|0.314E-01|  3.14E-2&#x0022;
</td></tr></table>
<!--l. 5264--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 0.314159)   ⇒ &#x0022;  0.31   |0.314    |0.314    | 0.31    &#x0022;</td></tr></table>
<!--l. 5265--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 3.14159)    ⇒ &#x0022;   3.1   | 3.14    | 3.14    |  3.1    &#x0022;</td></tr></table>
<!--l. 5266--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 31.4159)    ⇒ &#x0022;   31.   | 31.4    | 31.4    |  31.    &#x0022;</td></tr></table>
<!--l. 5267--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 314.159)    ⇒ &#x0022;  3.14E+2| 314.    | 314.    |  3.14E+2&#x0022;</td></tr></table>
<!--l. 5268--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 3141.59)    ⇒ &#x0022;  3.14E+3|314.2$+01|0.314E+04|  3.14E+3&#x0022;</td></tr></table>
<!--l. 5269--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 3141.59L0)  ⇒ &#x0022;  3.14L+3|314.2$+01|0.314L+04|  3.14L+3&#x0022;</td></tr></table>
<!--l. 5270--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 3.14E12)    ⇒ &#x0022;*********|314.0$+10|0.314E+13| 3.14E+12&#x0022;</td></tr></table>
<!--l. 5271--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 3.14L120)   ⇒ &#x0022;*********|?????????|%%%%%%%%%|3.14L+120&#x0022;</td></tr></table>
<!--l. 5272--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 3.14L1200)  ⇒ &#x0022;*********|?????????|%%%%%%%%%|3.14L+1200&#x0022;</td></tr></table>
<!--l. 5274--><p class="indent" >
</div>
</div>
</div>
<!--l. 5276--><p class="noindent" >
                                                                          

                                                                          
<div class=new>
<!--l. 5278--><p class="indent" >  Notice of correction. In the ﬁrst edition, the example for the value <i>3.14E12</i>
contained two typographical errors: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:288;" 
class="tabbing">(foo 3.14E12)    ⇒ &#x0022;*********|314.</td><td style="width:182;" 
class="tabbing">2$+10|0.314E+13| 3.14</td><td  
class="tabbing">L+12&#x0022;
</td></tr></table>
<!--l. 5282--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:288;" 
class="tabbing">                                                 </td><td style="width:182;" 
class="tabbing">↑            </td><td  
class="tabbing">↑</td></tr></table>
<!--l. 5283--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:288;" 
class="tabbing">                     </td><td style="width:182;" 
class="tabbing">should be <i>0</i>               </td><td  
class="tabbing">should be E</td></tr></table>
<!--l. 5285--><p class="indent" >
</div>
</div>
<!--l. 5286--><p class="noindent" >These have been corrected above.
</div>
<div class=incompatibility>
<!--l. 5290--><p class="noindent" ><b>Compatibility note:</b> The <i><tt>~</tt>G</i> directive is similar to the <i>Gw.d</i> edit descriptor in
Fortran.
<!--l. 5294--><p class="indent" >  The Common Lisp rules for deciding between the use of <i><tt>~</tt>F</i> and <i><tt>~</tt>E</i> are compatible
with the rules used by Fortran but have been extended to cover the cases where w or d is
omitted or where e is speciﬁed.
<!--l. 5299--><p class="indent" >  In MacLisp and Lisp Machine Lisp, the <i><tt>~</tt>G</i> format directive is equivalent
to the Common Lisp <i><tt>~</tt><tt>@</tt>*</i> directive. This incompatibility between Common
Lisp and MacLisp was introduced for the sake of cultural compatibility with
Fortran.
</div>
  <br /><b>
<i><tt>~</tt>$</i>                                                                        </b>
Dollars ﬂoating-point. The next arg is printed as a ﬂoating-point number in
ﬁxed-format notation. This format is particularly convenient for printing a value
as dollars and cents.
<!--l. 5311--><p class="indent" >  The full form is <i><tt>~</tt>d,n,w,padchar$</i>. The parameter d is the number of digits to
print after the decimal point (default value 2); n is the minimum number of digits
to print before the decimal point (default value 1); w is the minimum total width
of the ﬁeld to be printed (default value 0).
<!--l. 5319--><p class="indent" >  First padding and the sign are output. If the arg is negative, then a minus sign
is printed; if the arg is not negative, then a plus sign is printed if and only if the <i><tt>@</tt></i>
modiﬁer was speciﬁed. If the <i>:</i> modiﬁer is used, the sign appears before
                                                                          

                                                                          
any padding, and otherwise after the padding. If w is speciﬁed and the
number of other characters to be output is less than w, then copies of
padchar (which defaults to a space) are output to make the total ﬁeld width
equal w. Then n digits are printed for the integer part of arg, with leading
zeros if necessary; then a decimal point; then d digits of fraction, properly
rounded.
<!--l. 5333--><p class="indent" >  If the magnitude of arg is so large that more than m digits would have to be
printed, where m is the larger of w and 100, then an implementation is free, at its
discretion, to print the number using exponential notation instead, as if by the
directive <i><tt>~</tt>w,q„„padcharE</i>, where w and padchar are present or omitted according
to whether they were present or omitted in the <i><tt>~</tt>$</i> directive, and where
q = d + n − 1, where d and n are the (possibly default) values given to the <i><tt>~</tt>$</i>
directive.
<!--l. 5343--><p class="indent" >  If arg is a rational number, then it is coerced to be a single-ﬂoat and
then printed. (Alternatively, an implementation is permitted to process a
rational number by any other method that has essentially the same behavior
but avoids such hazards as loss of precision or overﬂow because of the
coercion.)
<!--l. 5349--><p class="indent" >  If arg is a complex number or some non-numeric object, then it is printed using
the format directive <i><tt>~</tt>wD</i>, thereby printing it in decimal radix and a minimum
ﬁeld width of w. (If it is desired to print each of the real part and imaginary part
of a complex number using a <i><tt>~</tt>$</i> directive, then this must be done explicitly
with two <i><tt>~</tt>$</i> directives and code to extract the two parts of the complex
number.)
<div class=new>
<!--l. 5358--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x144-200003r728">format</a> binds <i>*print-escape*</i> to
<a 
href="clmse31.html#x42-70002r19">nil</a> during the processing of the <i><tt>~</tt>$</i> directive.
</div>
  <br /><b>
<i><tt>~</tt>%</i>                                                                       </b>This
outputs a <i>#<tt>\</tt>Newline</i> character, thereby terminating the current output line and
beginning a new one (see <a 
href="#x144-198028r721">terpri</a>).
<i>
<!--l. 5370--><p class="indent" >  <tt>~</tt>n%</i> outputs n newlines.
<!--l. 5372--><p class="indent" >  No arg is used. Simply putting a newline in the control string would work, but
<i><tt>~</tt>%</i> is often used because it makes the control string look nicer in the middle of a
Lisp program.
                                                                          

                                                                          
  <br /><b>
<i><tt>~</tt>&#x0026;</i>                                                                       </b>Unless
it can be determined that the output stream is already at the beginning of a line,
this outputs a newline (see <a 
href="#x144-198030r722">fresh-line</a>).
<i>
<!--l. 5381--><p class="indent" >  <tt>~</tt>n&#x0026;</i> calls <a 
href="#x144-198030r722">fresh-line</a> and then outputs n − 1 newlines. <i><tt>~</tt>0&#x0026;</i> does nothing.
  <br /><b>
<i><tt>~</tt>|</i>                                                                        </b>This
outputs a page separator character, if possible. <i><tt>~</tt>n|</i> does this n times. <i>|</i> is vertical
bar, not capital I.
  <br /><b>
<i><tt>~</tt><tt>~</tt></i>                                                                        </b>Tilde.
This outputs a tilde. <i><tt>~</tt>n<tt>~</tt></i> outputs n tildes.
  <br /><b>
<i><tt>~</tt></i>⟨newline⟩                                                                </b>Tilde
immediately followed by a newline ignores the newline and any following
non-newline whitespace characters. With a <i>:</i>, the newline is ignored, but any
following whitespace is left in place. With an <i><tt>@</tt></i>, the newline is left in place, but
any following whitespace is ignored. This directive is typically used when a
format control string is too long to ﬁt nicely into one line of the program: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun type-clash-error (fn nargs argnum right-type wrong-type)
</td></tr></table>
<!--l. 5404--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format *error-output*</td></tr></table>
<!--l. 5405--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          &#x0022;<tt>~</tt>&#x0026;Function <tt>~</tt>S requires its <tt>~</tt>:<tt>[</tt><tt>~</tt>:R<tt>~</tt>;<tt>~</tt>*<tt>~</tt><tt>]</tt> <tt>~</tt></td></tr></table>
<!--l. 5406--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           argument to be of type <tt>~</tt>S,<tt>~</tt>%but it was called <tt>~</tt></td></tr></table>
<!--l. 5407--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           with an argument of type <tt>~</tt>S.<tt>~</tt>%&#x0022;</td></tr></table>
<!--l. 5408--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          fn (eql nargs 1) argnum right-type wrong-type))</td></tr></table>
<!--l. 5409--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 5410--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(type-clash-error &#x2019;aref nil 2 &#x2019;integer &#x2019;vector) prints:</td></tr></table>
<!--l. 5411--><p class="indent" >     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Function AREF requires its second argument to be of type INTEGER,</td></tr></table>
<!--l. 5412--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">but it was called with an argument of type VECTOR.</td></tr></table>
<!--l. 5413--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
                                                                          

                                                                          
<!--l. 5414--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(type-clash-error &#x2019;car 1 1 &#x2019;list &#x2019;short-ﬂoat) prints:</td></tr></table>
<!--l. 5415--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Function CAR requires its argument to be of type LIST,</td></tr></table>
<!--l. 5416--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">but it was called with an argument of type SHORT-FLOAT.</td></tr></table>
<!--l. 5418--><p class="indent" >
</div>
</div>
<!--l. 5419--><p class="noindent" >Note that in this example newlines appear in the output only as speciﬁed by the <i><tt>~</tt>&#x0026;</i>
and <i><tt>~</tt>%</i> directives; the actual newline characters in the control string are
suppressed because each is preceded by a tilde.
  <br /><b>
<i><tt>~</tt>T</i>                                                                       </b>
Tabulate. This spaces over to a given column. <i><tt>~</tt>colnum,colincT</i> will output
suﬃcient spaces to move the cursor to column colnum. If the cursor is
already at or beyond column colnum, it will output spaces to move it
to column colnum+k*colinc for the smallest positive integer k possible,
unless colinc is zero, in which case no spaces are output if the cursor
is already at or beyond column colnum. colnum and colinc default to
<i>1</i>.
<!--l. 5434--><p class="indent" >  Ideally, the current column position is determined by examination of the
destination, whether a stream or string. (Although no user-level operation for
determining the column position of a stream is deﬁned by Common Lisp, such a
facility may exist at the implementation level.) If for some reason the current
absolute column position cannot be determined by direct inquiry, <a 
href="#x144-200003r728">format</a> may be
able to deduce the current column position by noting that certain directives (such
as <i><tt>~</tt>%</i>, or <i><tt>~</tt>&#x0026;</i>, or <i><tt>~</tt>A</i> with the argument being a string containing a newline)
cause the column position to be reset to zero, and counting the number of
characters emitted since that point. If that fails, <a 
href="#x144-200003r728">format</a> may attempt a
similar deduction on the riskier assumption that the destination was at
column zero when <a 
href="#x144-200003r728">format</a> was invoked. If even this heuristic fails or is
implementationally inconvenient, at worst the <i><tt>~</tt>T</i> operation will simply output
two spaces. (All this implies that code that uses <a 
href="#x144-200003r728">format</a> is more likely to
be portable if all format control strings that use the <i><tt>~</tt>T</i> directive either
begin with <i><tt>~</tt>%</i> or <i><tt>~</tt>&#x0026;</i> to force a newline or are designed to be used only
when the destination is known from other considerations to be at column
zero.)
<i>
                                                                          

                                                                          
<!--l. 5456--><p class="indent" >  <tt>~</tt><tt>@</tt>T</i> performs relative tabulation. <i><tt>~</tt>colrel,colinc<tt>@</tt>T</i> outputs colrel spaces and
then outputs the smallest non-negative number of additional spaces necessary to
move the cursor to a column that is a multiple of colinc. For example, the
directive <i><tt>~</tt>3,8<tt>@</tt>T</i> outputs three spaces and then moves the cursor to a “standard
multiple-of-eight tab stop” if not at one already. If the current output column
cannot be determined, however, then colinc is ignored, and exactly colrel spaces
are output.
<div class=new>
<!--l. 5468--><p class="indent" >  X3J13 voted in June 1989 ⟨<b>?</b>⟩ to deﬁne <i><tt>~</tt>:T</i> and <i><tt>~</tt>:<tt>@</tt>T</i> to perform tabulation
relative to a point deﬁned by the pretty printing process (see section <a 
href="clmse147.html#x179-25700027.4">27.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a>).
</div>
  <br /><b>
<i><tt>~</tt>*</i>                                                                        </b>The
next arg is ignored. <i><tt>~</tt>n*</i> ignores the next n arguments.
<i>
<!--l. 5476--><p class="indent" >  <tt>~</tt>:*</i> “ignores backwards”; that is, it backs up in the list of arguments so that
the argument last processed will be processed again. <i><tt>~</tt>n:*</i> backs up n
arguments.
<!--l. 5480--><p class="indent" >  When within a <i><tt>~</tt><tt>{</tt></i> construct (see below), the ignoring (in either direction) is
relative to the list of arguments being processed by the iteration.
<i>
<!--l. 5484--><p class="indent" >  <tt>~</tt>n<tt>@</tt>*</i> is an “absolute goto” rather than a “relative goto”: it goes to the nth arg,
where 0 means the ﬁrst one; n defaults to 0, so <i><tt>~</tt><tt>@</tt>*</i> goes back to the ﬁrst arg.
Directives after a <i><tt>~</tt>n<tt>@</tt>*</i> will take arguments in sequence beginning with the one
gone to. When within a <i><tt>~</tt><tt>{</tt></i> construct, the “goto” is relative to the list of arguments
being processed by the iteration.
  <br /><b>
<i><tt>~</tt>?</i>                                                                        </b>
Indirection. The next arg must be a string, and the one after it a list; both
are consumed by the <i><tt>~</tt>?</i> directive. The string is processed as a <a 
href="#x144-200003r728">format</a>
control string, with the elements of the list as the arguments. Once the
recursive processing of the control string has been ﬁnished, then processing
of the control string containing the <i><tt>~</tt>?</i> directive is resumed. Example: <div class=lisp>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil &#x0022;<tt>~</tt>? <tt>~</tt>D&#x0022; &#x0022;&#x003C;<tt>~</tt>A <tt>~</tt>D&#x003E;&#x0022; &#x2019;(&#x0022;Foo&#x0022; 5) 7)  ⇒ &#x0022;&#x003C;Foo 5&#x003E; 7&#x0022;
</td></tr></table>
<!--l. 5502--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil &#x0022;<tt>~</tt>? <tt>~</tt>D&#x0022; &#x0022;&#x003C;<tt>~</tt>A <tt>~</tt>D&#x003E;&#x0022; &#x2019;(&#x0022;Foo&#x0022; 5 14) 7)  ⇒ &#x0022;&#x003C;Foo 5&#x003E; 7&#x0022;</td></tr></table>
<!--l. 5504--><p class="indent" >
</div>
</div>
<!--l. 5505--><p class="noindent" >Note that in the second example three arguments are supplied to the control
string <i>&#x0022;&#x003C;<tt>~</tt>A <tt>~</tt>D&#x003E;&#x0022;</i>, but only two are processed and the third is therefore
ignored.
<!--l. 5509--><p class="indent" >  With the <i><tt>@</tt></i> modiﬁer, only one arg is directly consumed. The arg must be a
string; it is processed as part of the control string as if it had appeared in place of
the <i><tt>~</tt><tt>@</tt>?</i> construct, and any directives in the recursively processed control string
may consume arguments of the control string containing the <i><tt>~</tt><tt>@</tt>?</i> directive.
Example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil &#x0022;<tt>~</tt><tt>@</tt>? <tt>~</tt>D&#x0022; &#x0022;&#x003C;<tt>~</tt>A <tt>~</tt>D&#x003E;&#x0022; &#x0022;Foo&#x0022; 5 7)  ⇒ &#x0022;&#x003C;Foo 5&#x003E; 7&#x0022;
</td></tr></table>
<!--l. 5517--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil &#x0022;<tt>~</tt><tt>@</tt>? <tt>~</tt>D&#x0022; &#x0022;&#x003C;<tt>~</tt>A <tt>~</tt>D&#x003E;&#x0022; &#x0022;Foo&#x0022; 5 14 7)  ⇒ &#x0022;&#x003C;Foo 5&#x003E; 14&#x0022;</td></tr></table>
<!--l. 5519--><p class="indent" >
</div>
</div>
<!--l. 5521--><p class="indent" >  Here is a rather sophisticated example. The <a 
href="#x144-200003r728">format</a> function itself, as
implemented at one time in Lisp Machine Lisp, used a routine internal to the
<a 
href="#x144-200003r728">format</a> package called format-error to signal error messages; format-error in turn
used <a 
href="clmse156.html#x190-346011r1025">error</a>, which used <a 
href="#x144-200003r728">format</a> recursively. Now format-error took a string and
arguments, just like <a 
href="#x144-200003r728">format</a>, but also printed the control string to <a 
href="#x144-200003r728">format</a> (which
at this point was available in the global variable <i>*ctl-string*</i>) and a little arrow
showing where in the processing of the control string the error occurred. The
variable <i>*ctl-index*</i> pointed one character after the place of the error. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun format-error (string &#x0026;rest args)     ;Example
</td></tr></table>
<!--l. 5534--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (error <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>?<tt>~</tt>%<tt>~</tt>V<tt>@</tt>T ⇓<tt>~</tt>%<tt>~</tt>3<tt>@</tt>T<tt>\</tt>&#x0022;<tt>~</tt>A<tt>\</tt>&#x0022;<tt>~</tt>%&#x0022;</td></tr></table>
<!--l. 5535--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         string args (+ *ctl-index* 3) *ctl-string*))</td></tr></table>
                                                                          

                                                                          
<!--l. 5537--><p class="indent" >
</div>
</div>
<!--l. 5538--><p class="noindent" >(The character set used in the Lisp Machine Lisp implementation contains a
down-arrow character <i> ⇓
</i>, which is not a standard Common Lisp character.) This ﬁrst processed the given
string and arguments using <i><tt>~</tt>?</i>, then output a newline, tabbed a variable amount
for printing the down-arrow, and printed the control string between double quotes
(note the use of <i><tt>\</tt>&#x0022;</i> to include double quotes within the control string). The eﬀect
was something like this: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format t &#x0022;The item is a <tt>~</tt><tt>[</tt>Foo<tt>~</tt>;Bar<tt>~</tt>;Loser<tt>~</tt><tt>]</tt>.&#x0022; &#x2019;quux)
</td></tr></table>
<!--l. 5546--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">»ERROR: The argument to the FORMAT &#x0022;<tt>~</tt><tt>[</tt>&#x0022; command</td></tr></table>
<!--l. 5547--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         must be a number.</td></tr></table>
<!--l. 5548--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                    ⇓ </td></tr></table>
<!--l. 5549--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   &#x0022;The item is a <tt>~</tt><tt>[</tt>Foo<tt>~</tt>;Bar<tt>~</tt>;Loser<tt>~</tt><tt>]</tt>.&#x0022;</td></tr></table>
<!--l. 5551--><p class="indent" >
</div>
</div>
<div class=implementation>
<!--l. 5554--><p class="noindent" ><b>Implementation note:</b> Implementors may wish to report errors occurring within
<a 
href="#x144-200003r728">format</a> control strings in the manner outlined here. It looks pretty ﬂashy when done
properly.
</div>
  </div>
</div>
<div class=new>
<!--l. 5563--><p class="indent" >   X3J13 voted in June 1989 ⟨<b>?</b>⟩ to introduce certain <a 
href="#x144-200003r728">format</a> directives to
support the user interface to the pretty printer described in detail in
chapter <a 
href="clmch27.html#x175-25300027">27<!--tex4ht:ref: PPRINT --></a>.
<div class=flushdesc>
  <div><br /><b>
<i><tt>~</tt><tt>_</tt></i>                                                                        </b>
                                                                          

                                                                          
Conditional newline. Without any modiﬁers, the directive <i><tt>~</tt><tt>_</tt></i> is equivalent to
<i>(pprint-newline :linear)</i>. The directive <i><tt>~</tt><tt>@</tt><tt>_</tt></i> is equivalent to <i>(pprint-newline
:miser)</i>. The directive <i><tt>~</tt>:<tt>_</tt></i> is equivalent to <i>(pprint-newline :ﬁll)</i>. The directive
<i><tt>~</tt>:<tt>@</tt><tt>_</tt></i> is equivalent to <i>(pprint-newline :mandatory)</i>.
  <br /><b>
<i><tt>~</tt>W </i>                                                                      </b>
Write. An  arg,  any  Lisp  object,  is  printed  obeying  every printer  control
variable (as by <a 
href="#x144-198004r709">write</a>). See section <a 
href="clmse147.html#x179-25700027.4">27.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a> for details.
  <br /><b>
<i><tt>~</tt>I</i>                                                                        </b>
Indent.  The  directive  <i><tt>~</tt>nI</i>  is  equivalent  to  <i>(pprint-indent :block n)</i>.  The
directive <i><tt>~</tt>:nI</i> is equivalent to <i>(pprint-indent :current n)</i>. In both cases, n
defaults to zero, if it is omitted.</div>
</div>
</div>
<!--l. 5592--><p class="indent" >   The format directives after this point are much more complicated than
the foregoing; they constitute control structures that can perform case
conversion, conditional selection, iteration, justiﬁcation, and non-local
exits. Used with restraint, they can perform powerful tasks. Used with
abandon, they can produce completely unreadable and unmaintainable
code.
<!--l. 5599--><p class="indent" >   The case-conversion, conditional, iteration, and justiﬁcation constructs can
contain other formatting constructs by bracketing them. These constructs must
nest properly with respect to each other. For example, it is not legitimate to
put the start of a case-conversion construct in each arm of a conditional
and the end of the case-conversion construct outside the conditional: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>:<tt>[</tt>abc<tt>~</tt>:<tt>@</tt>(def<tt>~</tt>;ghi<tt>~</tt>:<tt>@</tt>(jkl<tt>~</tt><tt>]</tt>mno<tt>~</tt>)&#x0022; x)     ;Illegal!
</td></tr></table>
<!--l. 5607--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 5608--><p class="noindent" >One might expect this to produce either <i>&#x0022;abcDEFMNO&#x0022;</i> or <i>&#x0022;ghiJKLMNO&#x0022;</i>,
depending on whether x is false or true; but in fact the construction is
illegal because the <i><tt>~</tt><tt>[</tt>...<tt>~</tt>;...<tt>~</tt><tt>]</tt></i> and <i><tt>~</tt>(...<tt>~</tt>)</i> constructs are not properly
nested.
<!--l. 5613--><p class="indent" >   The processing indirection caused by the <i><tt>~</tt>?</i> directive is also a kind of nesting
for the purposes of this rule of proper nesting. It is not permitted to start a
bracketing construct within a string processed under control of a <i><tt>~</tt>?</i> directive
and end the construct at some point after the <i><tt>~</tt>?</i> construct in the string
containing that construct, or vice versa. For example, this situation is illegal: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>?ghi<tt>~</tt>)&#x0022; &#x0022;abc<tt>~</tt><tt>@</tt>(def&#x0022;)     ;Illegal!
</td></tr></table>
<!--l. 5623--><p class="indent" >
</div>
</div>
<!--l. 5624--><p class="noindent" >One might expect it to produce <i>&#x0022;abcDEFGHI&#x0022;</i>, but in fact the construction is illegal
because the <i><tt>~</tt>?</i> and <i><tt>~</tt>(...<tt>~</tt>)</i> constructs are not properly nested.
<div class=flushdesc>
  <div><br /><b>
<i><tt>~</tt>(str<tt>~</tt>)</i>                                                                   </b>Case
conversion. The contained control string str is processed, and what it produces
is subject to case conversion: <i><tt>~</tt>(</i> converts every uppercase character to
the corresponding lowercase character; <i><tt>~</tt>:(</i> capitalizes all words, as if by
<a 
href="clmse102.html#x125-167016r612">string-capitalize</a>; <i><tt>~</tt><tt>@</tt>(</i> capitalizes just the ﬁrst word and forces the rest to
lowercase; <i><tt>~</tt>:<tt>@</tt>(</i> converts every lowercase character to the corresponding uppercase
character. In this example, <i><tt>~</tt><tt>@</tt>(</i> is used to cause the ﬁrst word produced by <i><tt>~</tt><tt>@</tt>R</i> to
be capitalized: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil &#x0022;<tt>~</tt><tt>@</tt>R <tt>~</tt>(<tt>~</tt><tt>@</tt>R<tt>~</tt>)&#x0022; 14 14)  ⇒ &#x0022;XIV xiv&#x0022;
</td></tr></table>
<!--l. 5642--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun f (n) (format nil &#x0022;<tt>~</tt><tt>@</tt>(<tt>~</tt>R<tt>~</tt>) error<tt>~</tt>:P detected.&#x0022; n))</td></tr></table>
<!--l. 5643--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(f 0)  ⇒ &#x0022;Zero errors detected.&#x0022;</td></tr></table>
<!--l. 5644--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(f 1)  ⇒ &#x0022;One error detected.&#x0022;</td></tr></table>
<!--l. 5645--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(f 23)  ⇒ &#x0022;Twenty-three errors detected.&#x0022;</td></tr></table>
                                                                          

                                                                          
<!--l. 5647--><p class="indent" >
</div>
</div>
  <br /><b>
<i><tt>~</tt><tt>[</tt>str0<tt>~</tt>;str1<tt>~</tt>;...<tt>~</tt>;strn<tt>~</tt><tt>]</tt></i>                                                   </b>
Conditional expression. This is a set of control strings, called clauses, one of which
is chosen and used. The clauses are separated by <i><tt>~</tt>;</i> and the construct is
terminated by <i><tt>~</tt><tt>]</tt></i>. For example, <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">&#x0022;<tt>~</tt><tt>[</tt>Siamese<tt>~</tt>;Manx<tt>~</tt>;Persian<tt>~</tt><tt>]</tt> Cat&#x0022;
</td></tr></table>
<!--l. 5656--><p class="indent" >
</div>
</div>
<!--l. 5657--><p class="noindent" >The argth clause is selected, where the ﬁrst clause is number 0. If a preﬁx parameter
is given (as <i><tt>~</tt>n<tt>[</tt></i>), then the parameter is used instead of an argument.
(This is useful only if the parameter is speciﬁed by <i>#</i>, to dispatch on
the number of arguments remaining to be processed.) If arg is out of
range, then no clause is selected (and no error is signaled). After the
selected alternative has been processed, the control string continues after the
<i><tt>~</tt><tt>]</tt></i>.
<i>
<!--l. 5668--><p class="indent" >  <tt>~</tt><tt>[</tt>str0<tt>~</tt>;str1<tt>~</tt>;...<tt>~</tt>;strn<tt>~</tt>:;default<tt>~</tt><tt>]</tt></i> has a default case. If the last <i><tt>~</tt>;</i> used to
separate clauses is <i><tt>~</tt>:;</i> instead, then the last clause is an “else” clause that is
performed if no other clause is selected. For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">&#x0022;<tt>~</tt><tt>[</tt>Siamese<tt>~</tt>;Manx<tt>~</tt>;Persian<tt>~</tt>:;Alley<tt>~</tt><tt>]</tt> Cat&#x0022;
</td></tr></table>
<!--l. 5675--><p class="indent" >
</div>
</div>
<i>
<!--l. 5677--><p class="indent" >  <tt>~</tt>:<tt>[</tt>false<tt>~</tt>;true<tt>~</tt><tt>]</tt></i> selects the false control string if arg is <a 
href="clmse31.html#x42-70002r19">nil</a>, and selects the true
                                                                          

                                                                          
control string otherwise.
<i>
<!--l. 5680--><p class="indent" >  <tt>~</tt><tt>@</tt><tt>[</tt>true<tt>~</tt><tt>]</tt></i> tests the argument. If it is not <a 
href="clmse31.html#x42-70002r19">nil</a>, then the argument is not used up
by the <i><tt>~</tt><tt>@</tt><tt>[</tt></i> command but remains as the next one to be processed, and the one
clause true is processed. If the arg is <a 
href="clmse31.html#x42-70002r19">nil</a>, then the argument is used up, and
the clause is not processed. The clause therefore should normally use
exactly one argument, and may expect it to be non-<a 
href="clmse31.html#x42-70002r19">nil</a>. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq *print-level* <a 
href="clmse31.html#x42-70002r19">nil</a> *print-length* 5)
</td></tr></table>
<!--l. 5690--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt><tt>@</tt><tt>[</tt> print level = <tt>~</tt>D<tt>~</tt><tt>]</tt><tt>~</tt><tt>@</tt><tt>[</tt> print length = <tt>~</tt>D<tt>~</tt><tt>]</tt>&#x0022;</td></tr></table>
<!--l. 5691--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            *print-level* *print-length*)</td></tr></table>
<!--l. 5692--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ &#x0022; print length = 5&#x0022;</td></tr></table>
<!--l. 5694--><p class="indent" >
</div>
</div>
<!--l. 5696--><p class="indent" >  The combination of <i><tt>~</tt><tt>[</tt></i> and <i>#</i> is useful, for example, for dealing with English
conventions for printing lists: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq foo &#x0022;Items:<tt>~</tt>#<tt>[</tt> none<tt>~</tt>; <tt>~</tt>S<tt>~</tt>; <tt>~</tt>S and <tt>~</tt>S<tt>~</tt>
</td></tr></table>
<!--l. 5699--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           <tt>~</tt>:;<tt>~</tt><tt>@</tt><tt>{</tt><tt>~</tt>#<tt>[</tt><tt>~</tt>; and<tt>~</tt><tt>]</tt> <tt>~</tt>S<tt>~</tt><tt>̂</tt>,<tt>~</tt><tt>}</tt><tt>~</tt><tt>]</tt>.&#x0022;)</td></tr></table>
<!--l. 5701--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> foo)</td></tr></table>
<!--l. 5702--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ⇒ &#x0022;Items: none.&#x0022;</td></tr></table>
<!--l. 5702--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> foo &#x2019;foo)</td></tr></table>
<!--l. 5703--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ⇒ &#x0022;Items: FOO.&#x0022;</td></tr></table>
<!--l. 5704--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> foo &#x2019;foo &#x2019;bar)</td></tr></table>
<!--l. 5705--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ⇒ &#x0022;Items: FOO and BAR.&#x0022;</td></tr></table>
<!--l. 5706--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> foo &#x2019;foo &#x2019;bar &#x2019;baz)</td></tr></table>
<!--l. 5707--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ⇒ &#x0022;Items: FOO, BAR, and BAZ.&#x0022;</td></tr></table>
<!--l. 5708--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> foo &#x2019;foo &#x2019;bar &#x2019;baz &#x2019;quux)</td></tr></table>
<!--l. 5709--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ⇒ &#x0022;Items: FOO, BAR, BAZ, and QUUX.&#x0022;</td></tr></table>
<!--l. 5711--><p class="indent" >
</div>
                                                                          

                                                                          
</div>
  <br /><b>
<i><tt>~</tt>;</i>                                                                        </b>This
separates clauses in <i><tt>~</tt><tt>[</tt></i> and <i><tt>~</tt>&#x003C;</i> constructions. It is an error elsewhere.
  <br /><b>
<i><tt>~</tt><tt>]</tt></i>                                                                        </b>This
terminates a <i><tt>~</tt><tt>[</tt></i>. It is an error elsewhere.
  <br /><b>
<i><tt>~</tt><tt>{</tt>str<tt>~</tt><tt>}</tt></i>                                                                   </b>
Iteration. This is an iteration construct. The argument should be a list, which is
used as a set of arguments as if for a recursive call to <a 
href="#x144-200003r728">format</a>. The string str is
used repeatedly as the control string. Each iteration can absorb as many elements
of the list as it likes as arguments; if str uses up two arguments by itself, then two
elements of the list will get used up each time around the loop. If before any
iteration step the list is empty, then the iteration is terminated. Also, if a preﬁx
parameter n is given, then there will be at most n repetitions of processing
of str. Finally, the <i><tt>~</tt><tt>^</tt></i> directive can be used to terminate the iteration
prematurely.
<!--l. 5735--><p class="indent" >  Here are some simple examples: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a>
</td></tr></table>
<!--l. 5737--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x0022;The winners are:<tt>~</tt><tt>{</tt> <tt>~</tt>S<tt>~</tt><tt>}</tt>.&#x0022;</td></tr></table>
<!--l. 5738--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x2019;(fred harry jill))</td></tr></table>
<!--l. 5739--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ⇒ &#x0022;The winners are: FRED HARRY JILL.&#x0022;</td></tr></table>
<!--l. 5740--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 5741--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;Pairs:<tt>~</tt><tt>{</tt> &#x003C;<tt>~</tt>S,<tt>~</tt>S&#x003E;<tt>~</tt><tt>}</tt>.&#x0022; &#x2019;(a 1 b 2 c 3))</td></tr></table>
<!--l. 5742--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ⇒ &#x0022;Pairs: &#x003C;A,1&#x003E; &#x003C;B,2&#x003E; &#x003C;C,3&#x003E;.&#x0022;</td></tr></table>
<!--l. 5744--><p class="indent" >
</div>
</div>
<i>
<!--l. 5746--><p class="indent" >  <tt>~</tt>:<tt>{</tt>str<tt>~</tt><tt>}</tt></i> is similar, but the argument should be a list of sublists. At each
                                                                          

                                                                          
repetition step, one sublist is used as the set of arguments for processing str; on
the next repetition, a new sublist is used, whether or not all of the last sublist had
been processed. Example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;Pairs:<tt>~</tt>:<tt>{</tt> &#x003C;<tt>~</tt>S,<tt>~</tt>S&#x003E;<tt>~</tt><tt>}</tt>.&#x0022;
</td></tr></table>
<!--l. 5751--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            &#x2019;((a 1) (b 2) (c 3)))</td></tr></table>
<!--l. 5752--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ⇒ &#x0022;Pairs: &#x003C;A,1&#x003E; &#x003C;B,2&#x003E; &#x003C;C,3&#x003E;.&#x0022;</td></tr></table>
<!--l. 5754--><p class="indent" >
</div>
</div>
<i>
<!--l. 5756--><p class="indent" >  <tt>~</tt><tt>@</tt><tt>{</tt>str<tt>~</tt><tt>}</tt></i> is similar to <i><tt>~</tt><tt>{</tt>str<tt>~</tt><tt>}</tt></i>, but instead of using one argument that is a list,
all the remaining arguments are used as the list of arguments for the iteration.
Example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;Pairs:<tt>~</tt><tt>@</tt><tt>{</tt> &#x003C;<tt>~</tt>S,<tt>~</tt>S&#x003E;<tt>~</tt><tt>}</tt>.&#x0022;
</td></tr></table>
<!--l. 5761--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            &#x2019;a 1 &#x2019;b 2 &#x2019;c 3)</td></tr></table>
<!--l. 5762--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ⇒ &#x0022;Pairs: &#x003C;A,1&#x003E; &#x003C;B,2&#x003E; &#x003C;C,3&#x003E;.&#x0022;</td></tr></table>
<!--l. 5764--><p class="indent" >
</div>
</div>
<!--l. 5765--><p class="noindent" >If the iteration is terminated before all the remaining arguments are consumed, then
any arguments not processed by the iteration remain to be processed by any
directives following the iteration construct.
<i>
<!--l. 5769--><p class="indent" >  <tt>~</tt>:<tt>@</tt><tt>{</tt>str<tt>~</tt><tt>}</tt></i> combines the features of <i><tt>~</tt>:<tt>{</tt>str<tt>~</tt><tt>}</tt></i> and <i><tt>~</tt><tt>@</tt><tt>{</tt>str<tt>~</tt><tt>}</tt></i>. All the remaining
arguments are used, and each one must be a list. On each iteration, the next
argument is used as a list of arguments to str. Example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;Pairs:<tt>~</tt>:<tt>@</tt><tt>{</tt> &#x003C;<tt>~</tt>S,<tt>~</tt>S&#x003E;<tt>~</tt><tt>}</tt>.&#x0022;
</td></tr></table>
<!--l. 5777--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            &#x2019;(a 1) &#x2019;(b 2) &#x2019;(c 3))</td></tr></table>
                                                                          

                                                                          
<!--l. 5778--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ⇒ &#x0022;Pairs: &#x003C;A,1&#x003E; &#x003C;B,2&#x003E; &#x003C;C,3&#x003E;.&#x0022;</td></tr></table>
<!--l. 5780--><p class="indent" >
</div>
</div>
<!--l. 5782--><p class="indent" >  Terminating the repetition construct with <i><tt>~</tt>:<tt>}</tt></i> instead of <i><tt>~</tt><tt>}</tt></i> forces str to be
processed at least once, even if the initial list of arguments is null (however, it will
not override an explicit preﬁx parameter of zero).
<!--l. 5787--><p class="indent" >  If str is empty, then an argument is used as str. It must be a string and precede
any arguments processed by the iteration. As an example, the following are
equivalent: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(apply #&#x2019;format stream string arguments)
</td></tr></table>
<!--l. 5791--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format stream &#x0022;<tt>~</tt>1<tt>{</tt><tt>~</tt>:<tt>}</tt>&#x0022; string arguments)</td></tr></table>
<!--l. 5793--><p class="indent" >
</div>
</div>
<!--l. 5794--><p class="noindent" >This will use <a 
href="clmse102.html#x125-167024r616">string</a> as a formatting string. The <i><tt>~</tt>1<tt>{</tt></i> says it will be processed at most
once, and the <i><tt>~</tt>:<tt>}</tt></i> says it will be processed at least once. Therefore it is processed
exactly once, using arguments as the arguments. This case may be handled more
clearly by the <i><tt>~</tt>?</i> directive, but this general feature of <i><tt>~</tt><tt>{</tt></i> is more powerful than
<i><tt>~</tt>?</i>.
  <br /><b>
<i><tt>~</tt><tt>}</tt></i>                                                                        </b>This
terminates a <i><tt>~</tt><tt>{</tt></i>. It is an error elsewhere.
  <br /><b>
<i><tt>~</tt>mincol,colinc,minpad,padchar&#x003C;str<tt>~</tt>&#x003E;</i>                                     </b>
Justiﬁcation. This justiﬁes the text produced by processing str within a
ﬁeld at least mincol columns wide. str may be divided up into segments
with <i><tt>~</tt>;</i>, in which case the spacing is evenly divided between the text
segments.
<!--l. 5811--><p class="indent" >  With no modiﬁers, the leftmost text segment is left-justiﬁed in the ﬁeld, and
the rightmost text segment right-justiﬁed; if there is only one text element, as
                                                                          

                                                                          
a special case, it is right-justiﬁed. The <i>:</i> modiﬁer causes spacing to be
introduced before the ﬁrst text segment; the <i><tt>@</tt></i> modiﬁer causes spacing to be
added after the last. The minpad parameter (default <i>0</i>) is the minimum
number of padding characters to be output between each segment. The
padding character is speciﬁed by padchar, which defaults to the space
character. If the total width needed to satisfy these constraints is greater than
mincol, then the width used is mincol+k*colinc for the smallest possible
non-negative integer value k; colinc defaults to <i>1</i>, and mincol defaults to
<i>0</i>.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>10&#x003C;foo<tt>~</tt>;bar<tt>~</tt>&#x003E;&#x0022;)           ⇒ &#x0022;foo    bar&#x0022;
</td></tr></table>
<!--l. 5827--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>10:&#x003C;foo<tt>~</tt>;bar<tt>~</tt>&#x003E;&#x0022;)          ⇒ &#x0022;  foo  bar&#x0022;</td></tr></table>
<!--l. 5828--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>10:<tt>@</tt>&#x003C;foo<tt>~</tt>;bar<tt>~</tt>&#x003E;&#x0022;)         ⇒ &#x0022;  foo bar &#x0022;</td></tr></table>
<!--l. 5829--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>10&#x003C;foobar<tt>~</tt>&#x003E;&#x0022;)             ⇒ &#x0022;    foobar&#x0022;</td></tr></table>
<!--l. 5830--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>10:&#x003C;foobar<tt>~</tt>&#x003E;&#x0022;)            ⇒ &#x0022;    foobar&#x0022;</td></tr></table>
<!--l. 5831--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>10<tt>@</tt>&#x003C;foobar<tt>~</tt>&#x003E;&#x0022;)            ⇒ &#x0022;foobar    &#x0022;</td></tr></table>
<!--l. 5832--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>10:<tt>@</tt>&#x003C;foobar<tt>~</tt>&#x003E;&#x0022;)           ⇒ &#x0022;  foobar  &#x0022;</td></tr></table>
<!--l. 5834--><p class="indent" >
</div>
</div>
<!--l. 5836--><p class="indent" >  Note that str may include <a 
href="#x144-200003r728">format</a> directives. All the clauses in str are processed
in order; it is the resulting pieces of text that are justiﬁed.
<!--l. 5840--><p class="indent" >  The <i><tt>~</tt><tt>^</tt></i> directive may be used to terminate processing of the clauses
prematurely, in which case only the completely processed clauses are justiﬁed.
<!--l. 5844--><p class="indent" >  If the ﬁrst clause of a <i><tt>~</tt>&#x003C;</i> is terminated with <i><tt>~</tt>:;</i> instead of <i><tt>~</tt>;</i>, then it is used in
a special way. All of the clauses are processed (subject to <i><tt>~</tt><tt>^</tt></i>, of course), but the
ﬁrst one is not used in performing the spacing and padding. When the
padded result has been determined, then if it will ﬁt on the current line
of output, it is output, and the text for the ﬁrst clause is discarded. If,
however, the padded text will not ﬁt on the current line, then the text
segment for the ﬁrst clause is output before the padded text. The ﬁrst clause
ought to contain a newline (such as a <i><tt>~</tt>%</i> directive). The ﬁrst clause is
always processed, and so any arguments it refers to will be used; the
                                                                          

                                                                          
decision is whether to use the resulting segment of text, not whether to
process the ﬁrst clause. If the <i><tt>~</tt>:;</i> has a preﬁx parameter n, then the padded
text must ﬁt on the current line with n character positions to spare to
avoid outputting the ﬁrst clause&#x2019;s text. For example, the control string <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">&#x0022;<tt>~</tt>%;; <tt>~</tt><tt>{</tt><tt>~</tt>&#x003C;<tt>~</tt>%;; <tt>~</tt>1:; <tt>~</tt>S<tt>~</tt>&#x003E;<tt>~</tt><tt>̂</tt>,<tt>~</tt><tt>}</tt>.<tt>~</tt>%&#x0022;
</td></tr></table>
<!--l. 5861--><p class="indent" >
</div>
</div>
<!--l. 5862--><p class="noindent" >can be used to print a list of items separated by commas without breaking items
over line boundaries, beginning each line with <i>;; </i>. The preﬁx parameter <i>1</i> in <i><tt>~</tt>1:;</i>
accounts for the width of the comma that will follow the justiﬁed item if it is not
the last element in the list, or the period if it is. If <i><tt>~</tt>:;</i> has a second preﬁx
parameter, then it is used as the width of the line, thus overriding the natural line
width of the output stream. To make the preceding example use a line width of
50, one would write <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">&#x0022;<tt>~</tt>%;; <tt>~</tt><tt>{</tt><tt>~</tt>&#x003C;<tt>~</tt>%;; <tt>~</tt>1,50:; <tt>~</tt>S<tt>~</tt>&#x003E;<tt>~</tt><tt>̂</tt>,<tt>~</tt><tt>}</tt>.<tt>~</tt>%&#x0022;
</td></tr></table>
<!--l. 5872--><p class="indent" >
</div>
</div>
<!--l. 5874--><p class="indent" >  If the second argument is not speciﬁed, then <a 
href="#x144-200003r728">format</a> uses the line width of the
output stream. If this cannot be determined (for example, when producing a
string result), then <a 
href="#x144-200003r728">format</a> uses <i>72</i> as the line length.
  <br /><b>
<i><tt>~</tt>&#x003E;</i>                                                                       </b>
Terminates a <i><tt>~</tt>&#x003C;</i>. It is an error elsewhere. <div class=new> X3J13 voted in June 1989
⟨<b>?</b>⟩ to introduce certain <a 
href="#x144-200003r728">format</a> directives to support the user interface
to the pretty printer. If <i><tt>~</tt>:&#x003E;</i> is used to terminate a <i><tt>~</tt>&#x003C;...</i> directive, the
directive is equivalent to a call on <a 
href="clmse146.html#x178-256005r891">pprint-logical-block</a>. See section <a 
href="clmse147.html#x179-25700027.4">27.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a> for
details.
                                                                          

                                                                          
</div>
  <br /><b>
<i><tt>~</tt><tt>^</tt></i>                                                                        </b>Up
and out. This is an escape construct. If there are no more arguments remaining to
be processed, then the immediately enclosing <i><tt>~</tt><tt>{</tt></i> or <i><tt>~</tt>&#x003C;</i> construct is terminated. If
there is no such enclosing construct, then the entire formatting operation is
terminated. In the <i><tt>~</tt>&#x003C;</i> case, the formatting is performed, but no more segments
are processed before doing the justiﬁcation. The <i><tt>~</tt><tt>^</tt></i> should appear only at the
beginning of a <i><tt>~</tt>&#x003C;</i> clause, because it aborts the entire clause it appears in (as well
as all following clauses). <i><tt>~</tt><tt>^</tt></i> may appear anywhere in a <i><tt>~</tt><tt>{</tt></i> construct. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq donestr &#x0022;Done.<tt>~</tt><tt>̂</tt> <tt>~</tt>D warning<tt>~</tt>:P.<tt>~</tt><tt>̂</tt> <tt>~</tt>D error<tt>~</tt>:P.&#x0022;)
</td></tr></table>
<!--l. 5903--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> donestr)  ⇒ &#x0022;Done.&#x0022;</td></tr></table>
<!--l. 5904--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> donestr 3)  ⇒ &#x0022;Done. 3 warnings.&#x0022;</td></tr></table>
<!--l. 5905--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> donestr 1 5)  ⇒ &#x0022;Done. 1 warning. 5 errors.&#x0022;</td></tr></table>
<!--l. 5907--><p class="indent" >
</div>
</div>
<!--l. 5909--><p class="indent" >  If a preﬁx parameter is given, then termination occurs if the parameter
is zero. (Hence <i><tt>~</tt><tt>^</tt></i> is equivalent to <i><tt>~</tt>#<tt>^</tt></i>.) If two parameters are given,
termination occurs if they are equal. If three parameters are given, termination
occurs if the ﬁrst is less than or equal to the second and the second is
less than or equal to the third. Of course, this is useless if all the preﬁx
parameters are constants; at least one of them should be a <i>#</i> or a V
parameter.
<!--l. 5917--><p class="indent" >  If <i><tt>~</tt><tt>^</tt></i> is used within a <i><tt>~</tt>:<tt>{</tt></i> construct, then it merely terminates the current
iteration step (because in the standard case it tests for remaining arguments of
the current step only); the next iteration step commences immediately. To
terminate the entire iteration process, use <i><tt>~</tt>:<tt>^</tt></i>.
<div class=new>
<!--l. 5924--><p class="indent" >  X3J13 voted in March 1988 ⟨<b>?</b>⟩ to clarify the behavior of <i><tt>~</tt>:<tt>^</tt></i> as follows. It may
be used only if the command it would terminate is <i><tt>~</tt>:<tt>{</tt></i> or <i><tt>~</tt>:<tt>@</tt><tt>{</tt></i>. The entire
iteration process is terminated if and only if the sublist that is supplying the
                                                                          

                                                                          
arguments for the current iteration step is the last sublist (in the case of
terminating a <i><tt>~</tt>:<tt>{</tt></i> command) or the last argument to that call to <a 
href="#x144-200003r728">format</a> (in the
case of terminating a <i><tt>~</tt>:<tt>@</tt><tt>{</tt></i> command). Note furthermore that while <i><tt>~</tt><tt>^</tt></i> is
equivalent to <i><tt>~</tt>#<tt>^</tt></i> in all circumstances, <i><tt>~</tt>:<tt>^</tt></i> is not equivalent to <i><tt>~</tt>:#<tt>^</tt></i> because the
latter terminates the entire iteration if and only if no arguments remain for the
current iteration step (as opposed to no arguments remaining for the entire
iteration process).
<!--l. 5940--><p class="indent" >  Here are some examples of the diﬀerences in the behaviors of <i><tt>~</tt><tt>^</tt></i>, <i><tt>~</tt>:<tt>^</tt></i>, and <i><tt>~</tt>:#<tt>^</tt></i>.
<div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil
</td></tr></table>
<!--l. 5944--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x0022;<tt>~</tt>:<tt>{</tt>/<tt>~</tt>S<tt>~</tt><tt>̂</tt> ...<tt>~</tt><tt>}</tt>&#x0022;</td></tr></table>
<!--l. 5945--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x2019;((hot dog) (hamburger) (ice cream) (french fries)))</td></tr></table>
<!--l. 5946--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ &#x0022;/HOT .../HAMBURGER/ICE .../FRENCH ...&#x0022;</td></tr></table>
<!--l. 5948--><p class="indent" >
</div>
</div>
<!--l. 5949--><p class="noindent" >For each sublist, “<i> ...</i>” appears after the ﬁrst word unless there are no additional
words. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil
</td></tr></table>
<!--l. 5952--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x0022;<tt>~</tt>:<tt>{</tt>/<tt>~</tt>S<tt>~</tt>:<tt>̂</tt> ...<tt>~</tt><tt>}</tt>&#x0022;</td></tr></table>
<!--l. 5953--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x2019;((hot dog) (hamburger) (ice cream) (french fries)))</td></tr></table>
<!--l. 5954--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ &#x0022;/HOT .../HAMBURGER .../ICE .../FRENCH&#x0022;</td></tr></table>
<!--l. 5956--><p class="indent" >
</div>
</div>
<!--l. 5957--><p class="noindent" >For each sublist, “<i> ...</i>” always appears after the ﬁrst word, unless it is the last
sublist, in which case the entire iteration is terminated. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format nil
</td></tr></table>
                                                                          

                                                                          
<!--l. 5960--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x0022;<tt>~</tt>:<tt>{</tt>/<tt>~</tt>S<tt>~</tt>:#<tt>̂</tt> ...<tt>~</tt><tt>}</tt>&#x0022;</td></tr></table>
<!--l. 5961--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x2019;((hot dog) (hamburger) (ice cream) (french fries)))</td></tr></table>
<!--l. 5962--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ &#x0022;/HOT .../HAMBURGER&#x0022;</td></tr></table>
<!--l. 5964--><p class="indent" >
</div>
</div>
<!--l. 5965--><p class="noindent" >For each sublist, “<i> ...</i>” appears after the ﬁrst word, but if the sublist has only one
word then the entire iteration is terminated.
</div>
<!--l. 5969--><p class="indent" >  If <i><tt>~</tt><tt>^</tt></i> appears within a control string being processed under the control of a <i><tt>~</tt>?</i>
directive, but not within any <i><tt>~</tt><tt>{</tt></i> or <i><tt>~</tt>&#x003C;</i> construct within that string, then the
string being processed will be terminated, thereby ending processing of the <i><tt>~</tt>?</i>
directive. Processing then continues within the string containing the <i><tt>~</tt>?</i> directive
at the point following that directive.
<!--l. 5978--><p class="indent" >  If <i><tt>~</tt><tt>^</tt></i> appears within a <i><tt>~</tt><tt>[</tt></i> or <i><tt>~</tt>(</i> construct, then all the commands up to the <i><tt>~</tt><tt>^</tt></i>
are properly selected or case-converted, the <i><tt>~</tt><tt>[</tt></i> or <i><tt>~</tt>(</i> processing is terminated, and
the outward search continues for a <i><tt>~</tt><tt>{</tt></i> or <i><tt>~</tt>&#x003C;</i> construct to be terminated. For
example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq tellstr &#x0022;<tt>~</tt><tt>@</tt>(<tt>~</tt><tt>@</tt><tt>[</tt><tt>~</tt>R<tt>~</tt><tt>]</tt><tt>~</tt><tt>̂</tt> <tt>~</tt>A.<tt>~</tt>)&#x0022;)
</td></tr></table>
<!--l. 5984--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> tellstr 23)  ⇒ &#x0022;Twenty-three.&#x0022;</td></tr></table>
<!--l. 5985--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> tellstr nil &#x0022;losers&#x0022;)  ⇒ &#x0022;Losers.&#x0022;</td></tr></table>
<!--l. 5986--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> tellstr 23 &#x0022;losers&#x0022;)  ⇒ &#x0022;Twenty-three losers.&#x0022;</td></tr></table>
<!--l. 5988--><p class="indent" >
</div>
</div>
<!--l. 5990--><p class="indent" >  Here are some examples of the use of <i><tt>~</tt><tt>^</tt></i> within a <i><tt>~</tt>&#x003C;</i> construct. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>15&#x003C;<tt>~</tt>S<tt>~</tt>;<tt>~</tt><tt>̂</tt><tt>~</tt>S<tt>~</tt>;<tt>~</tt><tt>̂</tt><tt>~</tt>S<tt>~</tt>&#x003E;&#x0022; &#x2019;foo)
</td></tr></table>
<!--l. 5992--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ⇒ &#x0022;            FOO&#x0022;</td></tr></table>
<!--l. 5993--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>15&#x003C;<tt>~</tt>S<tt>~</tt>;<tt>~</tt><tt>̂</tt><tt>~</tt>S<tt>~</tt>;<tt>~</tt><tt>̂</tt><tt>~</tt>S<tt>~</tt>&#x003E;&#x0022; &#x2019;foo &#x2019;bar)</td></tr></table>
<!--l. 5994--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ⇒ &#x0022;FOO         BAR&#x0022;</td></tr></table>
<!--l. 5995--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format <a 
href="clmse31.html#x42-70002r19">nil</a> &#x0022;<tt>~</tt>15&#x003C;<tt>~</tt>S<tt>~</tt>;<tt>~</tt><tt>̂</tt><tt>~</tt>S<tt>~</tt>;<tt>~</tt><tt>̂</tt><tt>~</tt>S<tt>~</tt>&#x003E;&#x0022; &#x2019;foo &#x2019;bar &#x2019;baz)</td></tr></table>
                                                                          

                                                                          
<!--l. 5996--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ⇒ &#x0022;FOO   BAR   BAZ&#x0022;</td></tr></table>
<!--l. 5998--><p class="indent" >
</div>
</div>
</div>
</div>
<div class=obsolete>
<div class=incompatibility>
<!--l. 6003--><p class="noindent" ><b>Compatibility note:</b> The <i><tt>~</tt>Q</i> directive and user-deﬁned directives of Zetalisp have
been omitted here, as well as control lists (as opposed to strings), which are rumored to
be changing in meaning.
</div>
</div>
<div class=new>
<!--l. 6012--><p class="indent" >   X3J13 voted in June 1989 ⟨<b>?</b>⟩ to introduce user-deﬁned directives in the form
of the <i><tt>~</tt>/.../</i> directive. See section <a 
href="clmse147.html#x179-25700027.4">27.4<!--tex4ht:ref: PPRINT-FORMAT-DIRECTIVES-SECTION --></a> for details.
</div>
<div class=new>
<!--l. 6019--><p class="indent" >   The hairiest <a 
href="#x144-200003r728">format</a> control string I have ever seen in shown in table <a 
href="#x144-2000048">22.8<!--tex4ht:ref: XAPPING-FORMAT-TABLE --></a>. It
started innocently enough as part of the simulator for Connection Machine Lisp
<span class="cite">[<a 
href="clmli5.html#XCONNECTION-MACHINE-LISP">44</a>, <a 
href="clmli5.html#XCMLISP-IMPLEMENTATION">57</a>]</span>; the xapping data type, deﬁned by <a 
href="clmse104.html#x128-170002r617">defstruct</a>, needed a <i>:print-function</i>
option so that xappings would print properly. As this data type became more
complicated, step by step, so did the <a 
href="#x144-200003r728">format</a> control string.
</div> <div class="table">
                                                                          

                                                                          
<!--l. 6027--><p class="indent" >   <a 
 id="x144-2000048"></a><hr class="float"><div class="float" 
>
                                                                          

                                                                          
 <div class="caption" 
><span class="id">Table 22.8: </span><span  
class="content">Print Function for the Xapping Data Type</span></div><!--tex4ht:label?: x144-2000048 -->
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun print-xapping (xapping stream depth)
</td></tr></table>
<!--l. 6033--><p class="noindent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (ignore depth))</td></tr></table>
<!--l. 6034--><p class="noindent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format stream</td></tr></table>
<!--l. 6035--><p class="noindent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          ;; Are you ready for this one?</td></tr></table>
<!--l. 6036--><p class="noindent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          &#x0022;<tt>~</tt>:[<tt>{</tt><tt>~</tt>;[<tt>~</tt>]<tt>~</tt>:<tt>{</tt><tt>~</tt>S<tt>~</tt>:[ ⇒<tt>~</tt>S<tt>~</tt>;<tt>~</tt>*<tt>~</tt>]<tt>~</tt>:<tt>̂</tt> <tt>~</tt><tt>}</tt><tt>~</tt>:[<tt>~</tt>; <tt>~</tt>]<tt>~</tt></td></tr></table>
<!--l. 6037--><p class="noindent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           <tt>~</tt><tt>{</tt><tt>~</tt>S ⇒<tt>~</tt><tt>̂</tt> <tt>~</tt><tt>}</tt><tt>~</tt>:[<tt>~</tt>; <tt>~</tt>]<tt>~</tt>[<tt>~</tt>*<tt>~</tt>; ⇒<tt>~</tt>S<tt>~</tt>; ⇒<tt>~</tt>*<tt>~</tt>]<tt>~</tt>:[<tt>}</tt><tt>~</tt>;]<tt>~</tt>]&#x0022;</td></tr></table>
<!--l. 6038--><p class="noindent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          ;; Is that clear?</td></tr></table>
<!--l. 6039--><p class="noindent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (xectorp xapping)</td></tr></table>
<!--l. 6040--><p class="noindent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (do ((vp (xectorp xapping))</td></tr></table>
<!--l. 6041--><p class="noindent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               (sp (ﬁnite-part-is-xetp xapping))</td></tr></table>
<!--l. 6042--><p class="noindent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               (d (xapping-domain xapping) (cdr d))</td></tr></table>
<!--l. 6043--><p class="noindent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               (r (xapping-range xapping) (cdr r))</td></tr></table>
<!--l. 6044--><p class="noindent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               (z &#x2019;() (cons (list (if vp (car r) (car d))</td></tr></table>
<!--l. 6045--><p class="noindent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                  (or vp sp)</td></tr></table>
<!--l. 6046--><p class="noindent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                  (car r))</td></tr></table>
<!--l. 6047--><p class="noindent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                            z)))</td></tr></table>
<!--l. 6048--><p class="noindent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              ((null d) (reverse z)))</td></tr></table>
<!--l. 6049--><p class="noindent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (and (xapping-domain xapping)</td></tr></table>
<!--l. 6050--><p class="noindent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               (or (xapping-exceptions xapping)</td></tr></table>
<!--l. 6051--><p class="noindent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   (xapping-inﬁnite xapping)))</td></tr></table>
<!--l. 6052--><p class="noindent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (xapping-exceptions xapping)</td></tr></table>
<!--l. 6053--><p class="noindent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (and (xapping-exceptions xapping)</td></tr></table>
<!--l. 6054--><p class="noindent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               (xapping-inﬁnite xapping))</td></tr></table>
<!--l. 6055--><p class="noindent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (ecase (xapping-inﬁnite xapping)</td></tr></table>
<!--l. 6056--><p class="noindent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            ((nil) 0)</td></tr></table>
<!--l. 6057--><p class="noindent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (:constant 1)</td></tr></table>
<!--l. 6058--><p class="noindent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (:universal 2))</td></tr></table>
<!--l. 6059--><p class="noindent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (xapping-default xapping)</td></tr></table>
<!--l. 6060--><p class="noindent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (xectorp xapping)))</td></tr></table>
<!--l. 6062--><p class="noindent" >
</div>
</div>
See section <a 
href="clmse115.html#x142-19200022.1.5">22.1.5<!--tex4ht:ref: READTABLE-SECTION --></a> for the <a 
href="clmse104.html#x128-170002r617">defstruct</a> deﬁnition of the xapping data type, whose
accessor functions are used in this code.
                                                                          

                                                                          
   </div><hr class="endfloat" />
   </div>
<div class=new>
<!--l. 6069--><p class="indent" >   See the description of <a 
href="clmse115.html#x142-192011r676">set-macro-character</a> for a discussion of xappings and the
<a 
href="clmse104.html#x128-170002r617">defstruct</a> deﬁnition. Assume that the predicate xectorp is true of a xapping if it is
a xector, and that the predicate ﬁnite-part-is-xetp is true if every value in the
range is the same as its corresponding index.
<!--l. 6074--><p class="indent" >   Here is a blow-by-blow description of the parts of this format string:
</div>
<div class="flushleft" 
>
<!--l. 6077--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" ><i><tt>~</tt>:[<tt>{</tt><tt>~</tt>;[<tt>~</tt>]</i>                       </td><td align="left" ><!--l. 6080--><p class="noindent" >Print “<i>[ </i>” for a xector, and “<i><tt>{</tt></i>” otherwise.</td>
</tr><tr><td align="left" ><i><tt>~</tt>:<tt>{</tt><tt>~</tt>S<tt>~</tt>:[ ⇒<tt>~</tt>S<tt>~</tt>;<tt>~</tt>*<tt>~</tt>]<tt>~</tt>:<tt>^</tt> <tt>~</tt><tt>}</tt></i> </td><td align="left" ><!--l. 6082--><p class="noindent" >Given a list of lists, print the pairs. Each
sublist has three elements: the index (or
the value if we&#x2019;re printing a xector); a
ﬂag that is true for either a xector or xet
(in which case no arrow is printed); and
the value. Note the use of <i><tt>~</tt>:<tt>{</tt></i> to iterate,
and the use of <i><tt>~</tt>:<tt>^</tt></i> to avoid printing a
separating space after the ﬁnal pair (or
at all, if there are no pairs).               </td>
</tr><tr><td align="left" ><i><tt>~</tt>:[<tt>~</tt>; <tt>~</tt>]</i>                         </td><td align="left" ><!--l. 6089--><p class="noindent" >If   there   were   pairs   and   there   are
exceptions  or  an  inﬁnite  part,  print  a
separating space.                              </td>
</tr><tr><td align="left" ><i><tt>~</tt>⟨newline⟩</i>          </td><td align="left" ><!--l. 6091--><p class="noindent" >Do  nothing.  This  merely  allows  the
format control string to be broken across
two lines.                                        </td>
</tr><tr><td align="left" ><i><tt>~</tt><tt>{</tt><tt>~</tt>S ⇒       <tt>~</tt><tt>^</tt> <tt>~</tt><tt>}</tt></i> </td><td align="left" ><!--l. 6093--><p class="noindent" >Given a list of exception indices, print
them.  Note  the  use  of  <i><tt>~</tt><tt>{</tt></i> to  iterate,
and  the  use  of  <i><tt>~</tt><tt>^</tt></i> to  avoid  printing
a   separating   space   after   the   ﬁnal
exception  (or  at  all,  if  there  are  no
exceptions).                                    </td>
</tr><tr><td align="left" ><i><tt>~</tt>:[<tt>~</tt>; <tt>~</tt>]</i>                         </td><td align="left" ><!--l. 6098--><p class="noindent" >If there were exceptions and there is an
inﬁnite part, print a separating space.  </td>
</tr><tr><td align="left" ><i><tt>~</tt>[<tt>~</tt>*<tt>~</tt>; ⇒  <tt>~</tt>S<tt>~</tt>; ⇒  <tt>~</tt>*<tt>~</tt>]</i> </td><td align="left" ><!--l. 6100--><p class="noindent" >Use <i><tt>~</tt>[ </i> to choose one of three cases for
printing the inﬁnite part.                   </td>
</tr><tr><td align="left" ><i><tt>~</tt>:[<tt>}</tt><tt>~</tt>;]<tt>~</tt>]</i>                       </td><td align="left" ><!--l. 6102--><p class="noindent" >Print “<i>]</i>” for a xector, and “<i><tt>}</tt></i>” otherwise.</td></tr></table>
</div></div>
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 6106--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse118.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse116.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse116.html#tailclmse116.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse117.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch22.html#clmse117.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 6106--><p class="indent" >   <a 
 id="tailclmse117.html"></a>  
</body></html> 
