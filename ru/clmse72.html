<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Случайные числа</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 16:17:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 6976--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse73.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse71.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse71.html#tailclmse71.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse72.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="number.html#clmse72.html" >Наверх</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">12.9   </span> <a 
href="clm.html#QQ2-89-1142" id="x89-111300012.9">Случайные
числа</a></h3>
<!--l. 6979--><p class="noindent" >Функциональность Common Lisp&#x2019;а для генерации псевдослучайных чисел
была аккуратно проработана, чтобы быть переносимой. Тогда как две
реализации могут создавать различные ряды псевдослучайных чисел,
распределение значений должно быть независимо от таких характеристик
компьютера как размер слова.
<div class="defun">
<!--l. 6984--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx89-1113001"></a><a 
 id="x89-1113002r299"></a> <b>random</b>  <i>number</i> <b>&#x0026;optional</b>  <i>state</i>
</div>
<tt>
<!--l. 6987--><p class="indent" >   (random <i>n</i>)</tt> принимает положительное число <i>n</i> и возвращает число такого
же типа между нулём (включительно) и <i>n</i> (невключительно). Число <i>n</i>
может быть целым или с плавающей точкой. При этом используется
приблизительно равномерное распределения. FIXME Если <i>n</i> целое
число, каждый из возможных результатов встречается с (примерной)
вероятностью 1/<i>n</i>. (Слово «примерно» используется из-за различий
реализаций. На практике отклонение от однородности должно быть весьма
мало.)
<!--l. 6996--><p class="indent" >   Аргумент <i>state</i> должен быть объектом типа <tt>random-state</tt>. По-умолчанию
он равен значению переменной <tt><a 
href="symbols.html#x187-2604040r40">*random-state*</a></tt>. Объект используется для
сохранения состояния генератора псевдослучайных чисел и изменяется как
побочное действие от операции <tt><a 
href="symbols.html#x187-2604706r706">random</a></tt>.__________________________________<div class="implementation">
<!--l. 7002--><p class="noindent" ><b>Заметка для реализации:</b> In general, even if <tt><a 
href="symbols.html#x187-2604706r706">random</a></tt> of zero arguments were deﬁned
as in MacLisp, it is not adequate to deﬁne <tt>(random <i>n</i>)</tt> for integral <i>n</i> to be simply <tt>(mod
(random) <i>n</i>)</tt>; this fails to be uniformly distributed if <i>n</i> is larger than the largest number
produced by <tt><a 
href="symbols.html#x187-2604706r706">random</a></tt>, or even if <i>n</i> merely approaches this number. This is another reason
for omitting <tt><a 
href="symbols.html#x187-2604706r706">random</a></tt> of zero arguments in Common Lisp. Assuming that the underlying
mechanism produces “random bits” (possibly in chunks such as ﬁxnums), the best
approach is to produce enough random bits to construct an integer <i>k</i> some number
<i>d</i> of bits larger than <tt>(integer-length <i>n</i>)</tt> (see <tt><a 
href="symbols.html#x187-2604448r448">integer-length</a></tt>), and then
compute <tt>(mod <i>k</i> <i>n</i>)</tt>. The quantity <i>d</i> should be at least 7, and preferably 10 or
                                                                          

                                                                          
more.
<!--l. 7017--><p class="indent" >   To produce random ﬂoating-point numbers in the half-open range <span class="math">[<i>A</i>,<i>B</i>)</span>, accepted
practice (as determined by a look through the <i>Collected Algorithms from the ACM</i>,
particularly algorithms 133, 266, 294, and 370) is to compute <span class="math"><i>X</i> ⋅ (<i>B</i> −<i>A</i>) + <i>A</i></span>,
where <i>X</i> is a ﬂoating-point number uniformly distributed over <span class="math">[0.0,1.0)</span> and
computed by calculating a random integer <span class="math"><i>N</i></span> in the range <span class="math">[0,<i>M</i>)</span> (typically by a
multiplicative-congruential or linear-congruential method mod <span class="math"><i>M</i></span>) and then setting
<span class="math"><i>X</i> = <i>N</i>∕<i>M</i></span>. See also <span class="cite">[<a 
href="bib.html#XKNUTH-VOLUME-2">27</a>]</span>. If one takes <span class="math"><i>M</i> = 2<sup>f</sup></span>, where <span class="math"><i>f</i></span> is the length of the signiﬁcand of a
ﬂoating-point number (and it is in fact common to choose <span class="math"><i>M</i></span> to be a power of
2), then this method is equivalent to the following assembly-language-level
procedure. Assume the representation has no hidden bit. Take a ﬂoating-point 0.5,
and clobber its entire signiﬁcand with random bits. Normalize the result if
necessary.
<!--l. 7036--><p class="indent" >   For example, on the DEC PDP-10, assume that accumulator <tt>T</tt> is completely random
(all 36 bits are random). Then the code sequence <div class="lisp"><div class="tabbing">
LSH T,-9                 ;Clear high 9 bits; low 27 are random
   <br>                      FSC T,128.               ;Install exponent and normalize<br>
<!--l. 7041--><p class="noindent" ></div>
<!--l. 7041--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-111400012.9" id="x89-111400012.9"></a></span>
<!--l. 7041--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-111500012.9" id="x89-111500012.9"></a></span>
</div>
<!--l. 7042--><p class="indent" >   will produce in <tt>T</tt> a random ﬂoating-point number uniformly distributed over
<span class="math">[0.0,1.0)</span>. (Instead of the <tt>LSH</tt> instruction, one could do <div class="lisp"><div class="tabbing">
TLZ T,777000             ;That&#x2019;s 777000 octal
   <br>
<!--l. 7047--><p class="noindent" ></div>
<!--l. 7047--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-111600012.9" id="x89-111600012.9"></a></span>
                                                                          

                                                                          
<!--l. 7047--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-111700012.9" id="x89-111700012.9"></a></span>
</div>
<!--l. 7048--><p class="indent" >   but if the 36 random bits came from a congruential random-number generator, the
high-order bits tend to be “more random” than the low-order ones, and so the <tt>LSH</tt> would
be better for uniform distribution. Ideally all the bits would be the result of high-quality
randomness.)
<!--l. 7053--><p class="indent" >   With a hidden-bit representation, normalization is not a problem, but dealing with
the hidden bit is. The method can be adapted as follows. Take a ﬂoating-point 1.0 and
clobber the explicit signiﬁcand bits with random bits; this produces a random
ﬂoating-point number in the range <span class="math">[1.0,2.0)</span>. Then simply subtract 1.0. In eﬀect, we let
the hidden bit creep in and then subtract it away again.
<!--l. 7060--><p class="indent" >   For example, on the DEC VAX, assume that register <tt>T</tt> is completely random (but a
little less random than on the PDP-10, as it has only 32 random bits). Then the code
sequence <div class="lisp"><div class="tabbing">
INSV #̂X81,#7,#9,T     ;Install correct sign bit and exponent
   <br>                                                SUBF #̂F1.0,T          ;Subtract 1.0<br>
<!--l. 7066--><p class="noindent" ></div>
<!--l. 7066--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-111800012.9" id="x89-111800012.9"></a></span>
<!--l. 7066--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-111900012.9" id="x89-111900012.9"></a></span>
</div>
<!--l. 7067--><p class="indent" >   will produce in <tt>T</tt> a random ﬂoating-point number uniformly distributed over
<span class="math">[0.0,1.0)</span>. Again, if the low-order bits are not random enough, then the instruction
<div class="lisp"><div class="tabbing">
ROTL #7,T
   <br>
<!--l. 7072--><p class="noindent" ></div>
<!--l. 7072--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-112000012.9" id="x89-112000012.9"></a></span>
                                                                          

                                                                          
<!--l. 7072--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-112100012.9" id="x89-112100012.9"></a></span>
</div>
<!--l. 7073--><p class="indent" >   should be performed ﬁrst.
<!--l. 7075--><p class="indent" >   Implementors may wish to consult reference <span class="cite">[<a 
href="bib.html#XADDITIVE-RANDOMS">41</a>]</span> for a discussion of some eﬃcient
methods of generating pseudo-random numbers.
</div>
__________________________________________________________________________
</div>
<div class="defun">
<!--l. 7081--><p class="noindent" ><div class="defunheader"> <i>[Переменная]</i><a 
 id="dx89-1121001"></a><a 
 id="x89-1121002r300"></a> <b>*random-state*</b>
</div>
<!--l. 7084--><p class="indent" >    Данная переменная содержит объект типа <tt>random-state</tt>, который хранит
состояние для генератора случайных чисел, которое по-умолчанию
используется функцией <tt><a 
href="symbols.html#x187-2604706r706">random</a></tt>. Природа этой структуры данных зависит от
реализации. Она может быть выведена на печать и прочитана обратно, но не
обязательно это может быть сделано между реализациями. Вызов <tt><a 
href="symbols.html#x187-2604706r706">random</a></tt>
изменяет этот объект. Связывание этой переменной с другим значением будет
корректно сохраняться и восстанавливаться.
</div>
<div class="defun">
<!--l. 7095--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx89-1121003"></a><a 
 id="x89-1121004r301"></a> <b>make-random-state</b>  <b>&#x0026;optional</b>  <i>state</i>
</div>
<!--l. 7098--><p class="indent" >    Данная функция возвращает новый объект типа <tt>random-state</tt>, подходящий
для использования в качестве значения переменной <tt><a 
href="symbols.html#x187-2604040r40">*random-state*</a></tt>. Если
<i>state</i> не указано или равно <tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt>, тогда <tt><a 
href="symbols.html#x187-2604546r546">make-random-state</a></tt> возвращает
<i>копию</i> текущего объекта состояния генератора псевдослучайных чисел
(значение переменной <tt><a 
href="symbols.html#x187-2604040r40">*random-state*</a></tt>). Если <i>state</i> является объектом
состояния, то возвращается копия данного объекта. Если <i>state</i> равен
<tt><a 
href="symbols.html#x187-2604868r868">t</a></tt>, тогда новый возвращается новый объект состояния, который в
некотором смысле «случайно» инициализирован (текущим временем
например).____________________________________________________________________________________<div class="rationale">
<!--l. 7109--><p class="noindent" ><b>Обоснование:</b> Common Lisp purposely provides no way to initialize a <tt>random-state</tt>
object from a user-speciﬁed “seed.” The reason for this is that the number of bits of state
information in a <tt>random-state</tt> object may vary widely from one implementation to
another, and there is no simple way to guarantee that any user-speciﬁed seed
value will be “random enough.” Instead, the initialization of <tt>random-state</tt>
                                                                          

                                                                          
objects is left to the implementor in the case where the argument <tt><a 
href="symbols.html#x187-2604868r868">t</a></tt> is given to
<tt><a 
href="symbols.html#x187-2604546r546">make-random-state</a></tt>.
<!--l. 7119--><p class="indent" >   To handle the common situation of executing the same program many times in a
reproducible manner, where that program uses <tt><a 
href="symbols.html#x187-2604706r706">random</a></tt>, the following procedure may be
used:
      <ol  class="enumerate1" >
      <li 
  class="enumerate" id="x89-1121006x1">Evaluate <tt>(make-random-state t)</tt> to create a <tt>random-state</tt> object.
      </li>
      <li 
  class="enumerate" id="x89-1121008x2">Write that object to a ﬁle, using <tt><a 
href="symbols.html#x187-2604688r688">print</a></tt>, for later use.
      </li>
      <li 
  class="enumerate" id="x89-1121010x3">Whenever the program is to be run, ﬁrst use <tt><a 
href="symbols.html#x187-2604715r715">read</a></tt> to create a copy of the
      <tt>random-state</tt> object from the printed representation in the ﬁle. Then use
      the <tt>random-state</tt> object newly created by the <tt><a 
href="symbols.html#x187-2604715r715">read</a></tt> operation to initialize
      the random-number generator for the program.</li></ol>
<!--l. 7136--><p class="noindent" >It is for the sake of this procedure for reproducible execution that implementations are
required to provide a read/print syntax for objects of type <tt>random-state</tt>.
<!--l. 7140--><p class="indent" >   It is also possible to make copies of a <tt>random-state</tt> object directly without going
through the print/read process, simply by using the <tt><a 
href="symbols.html#x187-2604546r546">make-random-state</a></tt> function to
copy the object; this allows the same sequence of random numbers to be generated many
times within a single program.
</div>__________________________________________________________________________<div class="implementation">
<!--l. 7147--><p class="noindent" ><b>Заметка для реализации:</b> A recommended way to implement the type
<tt>random-state</tt> is eﬀectively to use the machinery for <tt><a 
href="symbols.html#x187-2604289r289">defstruct</a></tt>. The usual structure
syntax may then be used for printing <tt>random-state</tt> objects; one might look something
like <div class="lisp"><div class="tabbing">
#S(RANDOM-STATE DATA #(14 49 98436589 786345 8734658324 ...))
     <br>
<!--l. 7154--><p class="noindent" ></div>
<!--l. 7154--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-112200012.9" id="x89-112200012.9"></a></span>
                                                                          

                                                                          
<!--l. 7154--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-112300012.9" id="x89-112300012.9"></a></span>
</div>
<!--l. 7155--><p class="indent" >   where the components are of course completely implementation-dependent.
</div>
__________________________________________________________________________
</div>
<div class="defun">
<!--l. 7160--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx89-1123001"></a><a 
 id="x89-1123002r302"></a> <b>random-state-p</b>  <i>object</i>
</div>
<tt>
<!--l. 7163--><p class="indent" >    <a 
href="symbols.html#x187-2604707r707">random-state-p</a></tt> истинен, если аргумент является объектом состояния
генератора случайных чисел, иначе — ложен. <div class="lisp"><div class="tabbing">
(random-state-p <i>x</i>) <span class="math"> ≡</span> (typep <i>x</i> &#x2019;random-state)
     <br>
<!--l. 7167--><p class="noindent" ></div>
<!--l. 7167--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-112400012.9" id="x89-112400012.9"></a></span>
<!--l. 7167--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-112500012.9" id="x89-112500012.9"></a></span>
</div>
</div>
                                                                          

                                                                          
<!--l. 7170--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse73.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse71.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse71.html#tailclmse71.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse72.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="number.html#clmse72.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse72.html"></a>   </div> </div> 
</body></html> 
