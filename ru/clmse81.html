<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Поиск элементов последовательностей</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-05-16 18:04:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt; <br />&#x003C;<a 
href="clmse82.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse80.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse80.html#tailclmse80.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="#tailclmse81.html">В-конец</a>&#x003E;&#x003C;<a 
href="kseque.html#clmse81.html" >Наверх</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">14.4
</span> <a 
href="clm.html#QQ2-100-170" id="x100-14000014.4">Поиск элементов последовательностей</a></h3>
<!--l. 2260--><p class="noindent" >Каждая из этих функций ищет в последовательности элемент, удовлетворяющий
некоторому условию.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 2264--><p class="noindent" >[Функция]</em><a 
 id="dx100-140001"></a> <b>ﬁnd</b> <i>item</i> <i>sequence</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:test</i> <i>:test-not</i> <i>:start :end</i>
<i>:key</i><br />
<em>
[Функция]</em><a 
 id="dx100-140002"></a> <b>ﬁnd-if</b> <i>predicate</i> <i>sequence</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:start</i> <i>:end</i> <i>:key</i><br />
<em>
[Функция]</em><a 
 id="dx100-140003"></a> <b>ﬁnd-if-not</b> <i>predicate</i> <i>sequence</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:start :end :key</i>
</div>
<!--l. 2268--><p class="indent" >   Если последовательность <em>sequence</em> содержит элемент, удовлетворяющий
условию, тогда возвращается первый найденный слева элемент, иначе
возвращается <b><a 
href="symbols.html#x188-375658r658">nil</a></b>.
<!--l. 2272--><p class="indent" >   Если заданы параметры <b>:start</b> и <b>:end</b>, тогда поиск осуществляется в этом
интервале.
<!--l. 2275--><p class="indent" >   Если <b>:from-end</b> указан в не-<b><a 
href="symbols.html#x188-375658r658">nil</a></b>, тогда результатом функции будет
найденный элемент справа.
<div class="new">
<!--l. 2279--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-140004"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-900007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
                                                                          

                                                                          
<!--l. 2286--><p class="noindent" >[Функция]</em><a 
 id="dx100-140005"></a> <b>position</b> <i>item</i> <i>sequence</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:test</i> <i>:test-not</i>
<i>:start :end :key</i><br />
<em>
[Функция]</em><a 
 id="dx100-140006"></a> <b>position-if</b> <i>predicate</i> <i>sequence</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:start :end :key</i><br />
<em>
[Функция]</em><a 
 id="dx100-140007"></a> <b>position-if-not</b> <i>predicate</i> <i>sequence</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:start :end :key</i>
</div>
<!--l. 2290--><p class="indent" >   Если последовательность <em>sequence</em> содержит элемент, удовлетворяющий
условию, тогда возвращается позиция найденного элемента слева, иначе
возвращается <b><a 
href="symbols.html#x188-375658r658">nil</a></b>.
<!--l. 2294--><p class="indent" >   Если заданы параметры <b>:start</b> и <b>:end</b>, тогда поиск осуществляется в этом
интервале. Однако возвращаемый индекс будет относиться ко всей
последовательности в целом.
<!--l. 2298--><p class="indent" >   Если <b>:from-end</b> указан в не-<b><a 
href="symbols.html#x188-375658r658">nil</a></b>, тогда результатом функции будет индекс
найденного элемент справа. (Однако, возвращаемый индекс, будет, как
обычно, принадлежать нумерации слева направо.)
<div class="new">
<!--l. 2303--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-140008"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-900007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<hr></div>
<!--l. 2309--><p class="indent" >   Ниже приведены несколько примеров использования нескольких
функций, преимущественно <b><a 
href="symbols.html#x188-375721r721">position-if</a></b> и <b><a 
href="symbols.html#x188-375404r404">ﬁnd-if</a></b>, для обработки строк. Также
используется <b><a 
href="symbols.html#x188-375565r565">loop</a></b>. <div class="lisp"><tt><div class="tabbing">
(defun debug-palindrome (s)
   <br>                              (ﬂet ((match (x) (char-equal (ﬁrst x) (third x))))<br>
    (let* ((pairs (loop for c across s<br>                        for j from 0<br>
                        when (alpha-char-p c)<br>
                          collect (list c j)))<br>
           (quads (mapcar #&#x2019;append pairs (reverse pairs)))<br>
           (diﬀpos (position-if (complement #&#x2019;match) quads)))<br>
      (when diﬀpos<br>                       (let* ((diﬀ (elt quads diﬀpos))<br>
               (same (ﬁnd-if #&#x2019;match quads<br>
                              :start (+ diﬀpos 1))))<br>
          (if same<br>                                          (format nil<br>
                      &#x0022;/~A/ (at ~D) is not the reverse of /~A/&#x0022;<br>
                                                                          

                                                                          
                      (subseq s (second diﬀ) (second same))<br>
                      (second diﬀ)<br>                      (subseq s (+ (fourth same) 1)<br>
                                (+ (fourth diﬀ) 1)))<br>
              &#x0022;This palindrome is completely messed up!&#x0022;))))))<br>
<!--l. 2333--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2334--><p class="indent" >   Вот пример поведения этой функции <div class="lisp"><tt><div class="tabbing">
(setq panama     ;Предполагаемый палиндром?
   <br>                               &#x0022;A man, a plan, a canoe, pasta, heros, rajahs,<br>
       a coloratura, maps, waste, percale, macaroni, a gag,<br>
       a banana bag, a tan, a tag, a banana bag again<br>
       (or a camel), a crepe, pins, Spam, a rut, a Rolo,<br>
       cash, a jar, sore hats, a peon, a canal–Panama!&#x0022;)<br>
<!--l. 2342--><p class="noindent" ></div>
</tt>
</div>
<div class="lisp">
<tt>
<!--l. 2343--><p class="indent" >   <div class="tabbing">
(debug-palindrome panama)
   <br>                            <span class="math"> ⇒</span> &#x0022;/wast/ (at 73) is not the reverse of /, pins/&#x0022;<br>
<br>                   (replace panama &#x0022;snipe&#x0022; :start1 73)     ;Восстановить<br>
  <span class="math"> ⇒</span> &#x0022;A man, a plan, a canoe, pasta, heros, rajahs,<br>
       a coloratura, maps, snipe, percale, macaroni, a gag,<br>
       a banana bag, a tan, a tag, a banana bag again<br>
       (or a camel), a crepe, pins, Spam, a rut, a Rolo,<br>
       cash, a jar, sore hats, a peon, a canal–Panama!&#x0022;<br>                   <br>
(debug-palindrome panama) <span class="math"> ⇒</span> nil     ;Первоклассный—истинный палиндром<br>
<br>                       (debug-palindrome &#x0022;Rubber baby buggy bumpers&#x0022;)<br>
  <span class="math"> ⇒</span> &#x0022;/Rubber / (at 0) is not the reverse of /umpers/&#x0022;<br>
                                                                          

                                                                          
<br>                       (debug-palindrome &#x0022;Common Lisp: The Language&#x0022;)<br>
  <span class="math"> ⇒</span> &#x0022;/Commo/ (at 0) is not the reverse of /guage/&#x0022;<br>                     <br>
(debug-palindrome &#x0022;Complete mismatches are hard to ﬁnd&#x0022;)<br>          <span class="math"> ⇒</span> <br>
  &#x0022;/Complete mism/ (at 0) is not the reverse of /re hard to ﬁnd/&#x0022;<br>
<br>               (debug-palindrome &#x0022;Waltz, nymph, for quick jigs vex Bud&#x0022;)<br>
  <span class="math"> ⇒</span> &#x0022;This palindrome is completely messed up!&#x0022;<br>                         <br>
(debug-palindrome &#x0022;Doc, note: I dissent.  A fast never<br>
                   prevents a fatness.  I diet on cod.&#x0022;)<br>
  <span class="math"> ⇒</span><b><a 
href="symbols.html#x188-375658r658">nil</a></b>     ;Другой победитель<br>                                        <br>
(debug-palindrome &#x0022;Top step&#x2019;s pup&#x2019;s pet spot&#x0022;) <span class="math"> ⇒</span> nil<br>
<!--l. 2374--><p class="noindent" ></div>
</tt>
</div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 2377--><p class="noindent" >[Функция]</em><a 
 id="dx100-140009"></a> <b>count</b> <i>item</i> <i>sequence</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:test</i> <i>:test-not</i> <i>:start :end :key</i><br />
<em>
[Функция]</em><a 
 id="dx100-140010"></a> <b>count-if</b> <i>predicate</i> <i>sequence</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:start :end :key</i><br />
<em>
[Функция]</em><a 
 id="dx100-140011"></a> <b>count-if-not</b> <i>predicate</i> <i>sequence</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:start :end :key</i>
</div>
<!--l. 2381--><p class="indent" >   Результатом является неотрицательное целое число, указывающее на
количество элементов из указанной подпоследовательности, удовлетворяющих
условию.
<b>
<!--l. 2384--><p class="indent" >   :from-end</b> не оказывает никакого воздействия, и оставлен только для
совместимости с другими функциями.
<div class="new">
<!--l. 2388--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-140012"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-900007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<hr></div>
<div class="defun">
<div class="defunheader">
                                                                          

                                                                          
<em>
<!--l. 2395--><p class="noindent" >[Функция]</em><a 
 id="dx100-140013"></a> <b>mismatch</b> <i>sequence1</i> <i>sequence2</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:test</i> <i>:test-not</i> <i>:key</i>
<i>:start1</i> <i>:start2</i> <i>:end1</i> <i>:end2</i>
</div>
<!--l. 2397--><p class="indent" >   Функция поэлементно сравнивает указанные подпоследовательности. Если
их длины равны и соответственно равны между собой каждые их элементы,
то функция возвращает <b><a 
href="symbols.html#x188-375658r658">nil</a></b>. Иначе, функция возвращает неотрицательное
целое число. Это число указывает на первый элемент слева, который не
совпал с элементом другой последовательности <em>sequence2</em>. Или же, в случае
если одна подпоследовательность короче другой, но все элементы
были одинаковыми, индекс указывает на последний проверенный
элемент.
<!--l. 2406--><p class="indent" >   Если параметр <b>:from-end</b> равен не-<b><a 
href="symbols.html#x188-375658r658">nil</a></b> значению, тогда возвращается
увеличенная на 1 позиция первого не совпавшего элемента справа.
Фактически, (под)последовательности выравниваются по своим правым
концам, затем сравниваются последние элементы, затем предпоследние и так
далее. Возвращаемый индекс принадлежит первой последовательности
<em>sequence1</em>.
<div class="new">
<!--l. 2413--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-140014"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-900007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 2420--><p class="noindent" >[Функция]</em><a 
 id="dx100-140015"></a> <b>search</b> <i>sequence1</i> <i>sequence2</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;key</a></tt> <i>:from-end</i> <i>:test</i> <i>:test-not</i> <i>:key</i>
<i>:start1</i> <i>:start2</i> <i>:end1</i> <i>:end2</i>
</div>
<!--l. 2422--><p class="indent" >   Функция осуществляет поэлементный поиск последовательности <em>sequence1</em>
в последовательности <em>sequence1</em>. Если поиск не увенчался успехом,
результатом является значение <b><a 
href="symbols.html#x188-375658r658">nil</a></b>. Иначе, результат является индексом
первого совпавшего элемента слева во второй последовательности
<em>sequence2</em>.
<!--l. 2428--><p class="indent" >   Если аргумент <b>:from-end</b> равен не-<b><a 
href="symbols.html#x188-375658r658">nil</a></b>, поиск осуществляется справа, и
результат является индексом элемента слева в первой совпавшей
подпоследовательности справа.
                                                                          

                                                                          
<!--l. 2432--><p class="indent" >   Реализация может выбирать алгоритм поиска на своё усмотрение.
Количество проводимых сравнений не может быть указано точно. Например,
<b><a 
href="symbols.html#x188-375822r822">search</a></b> при <b>:from-end</b> равном не-<b><a 
href="symbols.html#x188-375658r658">nil</a></b> может фактически производить поиск
слева направо, но результатом будет всегда индекс самой правой совпавшей
последовательности. Поэтому пользователю желательно использовать
предикаты без побочных эффектов.
<div class="new">
<!--l. 2440--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-140016"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-900007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<hr></div>
                                                                          

                                                                          
<!--l. 2446--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse82.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse80.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse80.html#tailclmse80.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="clmse81.html" >В-начало</a>&#x003E;&#x003C;<a 
href="kseque.html#clmse81.html" >Наверх</a>&#x003E;<br> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt;</div><a 
 id="tailclmse81.html"></a>
 
</body></html> 
