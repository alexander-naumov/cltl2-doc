<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Программный интерфейс системы условий</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-05-22 08:40:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
   <div id="toplinks"> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt; <br />&#x003C;<a 
href="clmse153.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse151.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse151.html#tailclmse151.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="#tailclmse152.html">В-конец</a>&#x003E;&#x003C;<a 
href="clmch29.html#clmse152.html" >Наверх</a>&#x003E;</div><h3 class="sectionHead"><span class="titlemark">29.8
</span> <a 
href="clm.html#QQ2-186-389" id="x186-34800029.8">Программный интерфейс системы условий</a></h3>
<!--l. 1933--><p class="noindent" >Данный раздел описывает функции, макросы, переменные и типы условий
для Системы Условий Common Lisp&#x2019;а.
<!--l. 1936--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.1   </span> <a 
href="frontmatter.html#QQ2-186-390" id="x186-34900029.8.1">Signaling Conditions</a></h4>
<!--l. 1940--><p class="noindent" >The functions in this section provide various mechanisms for signaling warnings,
breaks, continuable errors, and fatal errors.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 1945--><p class="noindent" >[Function]</em><a 
 id="dx186-349001"></a> <b>error</b> <i>datum</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 1947--><p class="indent" >   [This supersedes the description of <b>error</b> given in section ??.—GLS]
<!--l. 1950--><p class="indent" >   Invokes the signal facility on a condition. If the condition is not handled,
<b>(invoke-debugger <em>condition</em>)</b> is executed. As a consequence of calling
<b>invoke-debugger</b>, <b>error</b> never directly returns to its caller; the only exit from
this function can come by non-local transfer of control in a handler or by use of an
interactive debugging command.
<!--l. 1956--><p class="indent" >   If <em>datum</em> is a condition, then that condition is used directly. In this case, it is
an error for the list of <em>arguments</em> to be non-empty; that is, <b>error</b> must have been
called with exactly one argument, the condition.
<!--l. 1960--><p class="indent" >   If <em>datum</em> is a condition type (a class or class name), then the condition used is
eﬀectively the result of <b>(apply #&#x2019;make-condition <em>datum</em> <em>arguments</em>)</b>.
<!--l. 1963--><p class="indent" >   If <em>datum</em> is a string, then the condition used is eﬀectively the result of
<div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(make-condition &#x2019;simple-error
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments <em>arguments</em>)<br>
<!--l. 1968--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 1972--><p class="noindent" >[Function]</em><a 
 id="dx186-349002"></a> <b>cerror</b> <i>continue-format-string</i> <i>datum</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 1974--><p class="indent" >   The function <b>cerror</b> invokes the error facility on a condition. If the condition
is not handled, <b>(invoke-debugger <em>condition</em>)</b> is executed. While signaling is
going on, and while control is in the debugger (if it is reached), it is possible to
continue program execution (thereby returning from the call to <b>cerror</b>) using the
<b>continue</b> restart.
<!--l. 1982--><p class="indent" >   If <em>datum</em> is a condition, then that condition is used directly. In this case,
the list of <em>arguments</em> need not be empty, but will be used only with the
<em>continue-format-string</em> and will not be used to initialize <em>datum</em>.
<!--l. 1987--><p class="indent" >   If <em>datum</em> is a condition type (a class or class name), then the condition used is
eﬀectively the result of <b>(apply #&#x2019;make-condition <em>datum</em> <em>arguments</em>)</b>.
<!--l. 1990--><p class="indent" >   If <em>datum</em> is a string, then the condition used is eﬀectively the result of
<div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;simple-error
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments <em>arguments</em>)<br>
<!--l. 1995--><p class="noindent" ></div>
</tt>
</div>
                                                                          

                                                                          
<!--l. 1997--><p class="indent" >   The <em>continue-format-string</em> must be a string. Note that if <em>datum</em> is not a
string, then the format arguments used by the <em>continue-format-string</em> will
still be the list of <em>arguments</em> (which is in keyword format if <em>datum</em> is
a condition type). In this case, some care may be necessary to set up
the <em>continue-format-string</em> correctly. The <b>format</b> directive <b>~*</b>, which
ignores and skips over <b>format</b> arguments, may be particularly useful in this
situation.
<!--l. 2007--><p class="indent" >   The value returned by <b>cerror</b> is <b>nil</b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 2011--><p class="noindent" >[Function]</em><a 
 id="dx186-349003"></a> <b>signal</b> <i>datum</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 2013--><p class="indent" >   Invokes the signal facility on a condition. If the condition is not handled,
<b>signal</b> returns <b>nil</b>.
<!--l. 2016--><p class="indent" >   If <em>datum</em> is a condition, then that condition is used directly. In this case, it is
an error for the list of <em>arguments</em> to be non-empty; that is, <b>error</b> must have been
called with exactly one argument, the condition.
<!--l. 2020--><p class="indent" >   If <em>datum</em> is a condition type (a class or class name), then the condition used is
eﬀectively the result of <b>(apply #&#x2019;make-condition <em>datum</em> <em>arguments</em>)</b>.
<!--l. 2023--><p class="indent" >   If <em>datum</em> is a string, then the condition used is eﬀectively the result of
<div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;simple-error
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments <em>arguments</em>)<br>
<!--l. 2028--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2030--><p class="indent" >   Note that if <b>(typep <em>condition</em> *break-on-signals*)</b> is true, then the
debugger will be entered prior to beginning the process of signaling. The
<b>continue</b> restart function may be used to continue with the signaling
process; the restart is associated with the signaled condition as if by use of
                                                                          

                                                                          
<b>with-condition-restarts</b>. This is true also for all other functions and
macros that signal conditions, such as <b>warn</b>, <b>error</b>, <b>cerror</b>, <b>assert</b>, and
<b>check-type</b>.
<!--l. 2039--><p class="indent" >   During the dynamic extent of a call to <b>signal</b> with a particular condition, the
eﬀect of calling <b>signal</b> again on that condition object for a distinct abstract event
is not deﬁned. For example, although a handler <em>may</em> resignal a condition in order
to allow outer handlers ﬁrst shot at handling the condition, two distinct
asynchronous keyboard events must not signal an the same (<b>eq</b>) condition object
at the same time.
<!--l. 2047--><p class="indent" >   For further details about signaling and handling, see the discussion of
condition handlers in section <a 
href="clmse150.html#x184-34400029.6.35">29.6.35<!--tex4ht:ref: CONDITION-HANDLERS --></a>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 2053--><p class="noindent" >[Variable]</em><a 
 id="dx186-349004"></a> <b>*break-on-signals*</b>
</div>
<!--l. 2055--><p class="indent" >   This variable is intended primarily for use when the user is debugging
programs that do signaling. The value of <b>*break-on-signals*</b> should be suitable
as a second argument to <b>typep</b>, that is, a type or type speciﬁer.
<!--l. 2060--><p class="indent" >   When <b>(typep <em>condition</em> *break-on-signals*)</b> is true, then calls to
<b>signal</b> (and to other advertised functions such as <b>error</b> that implicitly
call <b>signal</b>) will enter the debugger prior to signaling that <em>condition</em>.
The <b>continue</b> restart may be used to continue with the normal signaling
process; the restart is associated with the signaled condition as if by use of
<b>with-condition-restarts</b>.
<!--l. 2068--><p class="indent" >   Note that <b>nil</b> is a valid type speciﬁer. If the value of <b>*break-on-signals*</b> is
<b>nil</b>, then <b>signal</b> will never enter the debugger in this implicit manner.
<!--l. 2072--><p class="indent" >   When setting this variable, the user is encouraged to choose the most
restrictive speciﬁcation that suﬃces. Setting this ﬂag eﬀectively violates the
modular handling of condition signaling that this chapter seeks to establish. Its
complete eﬀect may be unpredictable in some cases, since the user may not be
aware of the variety or number of calls to <b>signal</b> that are used in programs called
only incidentally.
<!--l. 2080--><p class="indent" >   By default—and certainly in any “production” use—the value of this variable
should be <b>nil</b>, both for reasons of performance and for reasons of modularity and
                                                                          

                                                                          
abstraction.
<div class="newer">
<!--l. 2085--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx186-349005"></a>to remove <b>*break-on-warnings*</b> from the
language; <b>*break-on-signals*</b> oﬀers all the power of <b>*break-on-warnings*</b> and
more.
</div>
<hr></div>
<!--l. 2094--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.2   </span> <a 
href="frontmatter.html#QQ2-186-391" id="x186-35000029.8.2">Assertions</a></h4>
<!--l. 2098--><p class="noindent" >These facilities are designed to make it convenient for the user to insert error
checks into code.
<div class="defmac">
<div class="defmacheader">
<!--l. 2102--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>check-type</b> <a 
 id="dx186-350001"></a>place typespec [string]
   <br>
<!--l. 2103--><p class="noindent" ></div>
</div>
<!--l. 2104--><p class="indent" >   [This supersedes the description of <b>check-type</b> given in section ??.—GLS]
<!--l. 2107--><p class="indent" >   A <b>check-type</b> form signals an error of type <b>type-error</b> if the contents of
<em>place</em> are not of the desired type.
<!--l. 2111--><p class="indent" >   If a condition is signaled, handlers of this condition can use the functions
<b>type-error-datum</b> and <b>type-error-expected-type</b> to access the contents of
<em>place</em> and the <em>typespec</em>, respectively.
<!--l. 2115--><p class="indent" >   This function can return only if the <b>store-value</b> restart is invoked, either
explicitly from a handler or implicitly as one of the options oﬀered by the
debugger. The restart is associated with the signaled condition as if by use of
<b>with-condition-restarts</b>.
<!--l. 2121--><p class="indent" >   If <b>store-value</b> is called, <b>check-type</b> will store the new value that is the
argument to <b>store-value</b> (or that is prompted for interactively by the debugger)
in <em>place</em> and start over, checking the type of the new value and signaling another
error if it is still not the desired type. Subforms of <em>place</em> may be evaluated
multiple times because of the implicit loop generated. <b>check-type</b> returns
                                                                          

                                                                          
<b>nil</b>.
<!--l. 2128--><p class="indent" >   The <em>place</em> must be a generalized variable reference acceptable to <b>setf</b>. The
<em>typespec</em> must be a type speciﬁer; it is not evaluated. The <b>string</b> should
be an English description of the type, starting with an indeﬁnite article
(“a” or “an”); it is evaluated. If the <em>string</em> is not supplied, it is computed
automatically from the <em>typespec</em>. (The optional <em>string</em> argument is allowed because
some applications of <b>check-type</b> may require a more speciﬁc description
of what is wanted than can be generated automatically from the type
speciﬁer.)
<!--l. 2137--><p class="indent" >   The error message will mention the <em>place</em>, its contents, and the desired
type._____________________________________________________________________<div class="implementation">
<!--l. 2140--><p class="noindent" ><b>Заметка для реализации:</b> An implementation may choose to generate
a somewhat diﬀerently worded error message if it recognizes that <em>place</em> is of
a particular form, such as one of the arguments to the function that called
<b>check-type</b>.
</div>___________________________________________________________________________________________________________
<div class="lisp">
<tt>
<!--l. 2148--><p class="indent" >     <div class="tabbing">
Lisp&#x003E; (setq aardvarks &#x2019;(sam harry fred))
     <br>  <span class="math"> ⇒</span> (SAM HARRY FRED)<br> Lisp&#x003E; (check-type aardvarks (array * (3)))<br>
Error: The value of AARDVARKS, (SAM HARRY FRED),<br>
       is not a 3-long array.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use instead.<br>                   2: Return to Lisp Toplevel.<br>
Debug&#x003E; :continue 1<br>           Use Value: #(sam fred harry)<br>            <span class="math"> ⇒</span> NIL<br>
Lisp&#x003E; aardvarks<br>                                           <span class="math"> ⇒</span> #&#x003C;ARRAY-3 13571&#x003E;<br>
Lisp&#x003E; (map &#x2019;list #&#x2019;identity aardvarks)<br>            <span class="math"> ⇒</span> (SAM FRED HARRY)<br>
Lisp&#x003E; (setq aacount &#x2019;foo)<br>                                                     <span class="math"> ⇒</span> FOO<br>
Lisp&#x003E; (check-type aacount (integer 0 *) &#x0022;a non-negative integer&#x0022;)<br>
Error: The value of AACOUNT, FOO, is not a non-negative integer.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use instead.<br>                   2: Return to Lisp Toplevel.<br>
Debug&#x003E; :continue 2<br>                                                                  Lisp&#x003E;<br>
                                                                          

                                                                          
<!--l. 2173--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 2178--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>assert</b> <a 
 id="dx186-350002"></a>test-form [({place}*) [datum {argument}*]]
   <br>
<!--l. 2179--><p class="noindent" ></div>
</div>
<!--l. 2180--><p class="indent" >   [This supersedes the description of <b>assert</b> given in section ??.—GLS]
<!--l. 2183--><p class="indent" >   An <b>assert</b> form signals an error if the value of the <em>test-form</em> is <b>nil</b>. Continuing
from this error using the <b>continue</b> restart will allow the user to alter the values of
some variables, and <b>assert</b> will then start over, evaluating the <em>test-form</em>
again. (The restart is associated with the signaled condition as if by use of
<b>with-condition-restarts</b>.) <b>assert</b> returns <b>nil</b>.
<!--l. 2192--><p class="indent" >   The <em>test-form</em> may be any form. Each <em>place</em> (there may be any number of
them, or none) must be a generalized variable reference acceptable to <b>setf</b>. These
should be variables on which <em>test-form</em> depends, whose values may sensibly be
changed by the user in attempting to correct the error. Subforms of each
<em>place</em> are evaluated only if an error is signaled, and may be re-evaluated
if the error is re-signaled (after continuing without actually ﬁxing the
problem).
<!--l. 2200--><p class="indent" >   The <em>datum</em> and <em>argument</em>s are evaluated only if an error is to be signaled, and
re-evaluated if the error is to be signaled again.
<!--l. 2203--><p class="indent" >   If <em>datum</em> is a condition, then that condition is used directly. In this case, it is
an error to specify any <em>argument</em>s.
<!--l. 2206--><p class="indent" >   If <em>datum</em> is a condition type (a class or class name), then the condition
used is eﬀectively the result of <b>(apply #&#x2019;make-condition <em>datum</em> (list
{<i>argument</i>}* ))</b>.
<!--l. 2209--><p class="indent" >   If <em>datum</em> is a string, then the condition used is eﬀectively the result of
<div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(make-condition &#x2019;simple-error
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments (list  {<i>argument</i>}* ))<br>
<!--l. 2214--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2216--><p class="indent" >   If <em>datum</em> is omitted, then a condition of type <b>simple-error</b> is constructed
using the <em>test-form</em> as data. For example, the following might be used:
<div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;simple-error
   <br>                                         :format-string &#x0022;The assertion ~S failed.&#x0022;<br>
  :format-arguments &#x2019;(<em>test-form</em>))<br>
<!--l. 2223--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2224--><p class="indent" >   Note that the <em>test-form</em> itself, and not its value, is used as the format
argument.________________________________________________________________<div class="implementation">
<!--l. 2227--><p class="noindent" ><b>Заметка для реализации:</b> The debugger need not include the <em>test-form</em> in the error
message, and any <em>places</em> should not be included in the message, but they should be
made available for the user&#x2019;s perusal. If the user gives the “continue” command, an
opportunity should be presented to alter the values of any or all of the references.
The details of this depend on the implementation&#x2019;s style of user interface, of
course.
</div>___________________________________________________________________________________________________________
<!--l. 2237--><p class="indent" >     Here is an example of the use of <b>assert</b>: <div class="lisp"><tt><div class="tabbing">
(setq x (make-array &#x2019;(3 5) :initial-element 3))
     <br>                  (setq y (make-array &#x2019;(3 5) :initial-element 7))<br>                  <br>
(defun matrix-multiply (a b)<br>                             (let ((*print-array* nil))<br>
    (assert (and (= (array-rank a) (array-rank b) 2)<br>
                                                                          

                                                                          
                 (= (array-dimension a 1)<br>                    (array-dimension b 0)))<br>
            (a b)<br>                    &#x0022;Cannot multiply ~S by ~S.&#x0022; a b)<br>
    (really-matrix-multiply a b)))<br>          <br>             (matrix-multiply x y)<br>
Error: Cannot multiply #&#x003C;ARRAY-3-5 12345&#x003E; by #&#x003C;ARRAY-3-5 12364&#x003E;.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify new values.<br>   2: Return to Lisp Toplevel.<br>  Debug&#x003E; :continue 1<br>
Value for A: x<br>            Value for B: (make-array &#x2019;(5 3) :initial-element 6)<br>
 <span class="math"> ⇒</span>#2A((54 54 54 54 54)<br>                                 (54 54 54 54 54)<br>
          (54 54 54 54 54)<br>                                 (54 54 54 54 54)<br>
          (54 54 54 54 54))<br>
<!--l. 2264--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<!--l. 2268--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.3   </span> <a 
href="frontmatter.html#QQ2-186-392" id="x186-35100029.8.3">Exhaustive Case Analysis</a></h4>
<!--l. 2271--><p class="noindent" >The syntax for <b>etypecase</b> and <b>ctypecase</b> is the same as for <b>typecase</b>, except
that no <b>otherwise</b> clause is permitted. Similarly, the syntax for <b>ecase</b> and <b>ccase</b>
is the same as for <b>case</b> except for the <b>otherwise</b> clause.
<b>
<!--l. 2275--><p class="indent" >   etypecase</b> and <b>ecase</b> are similar to <b>typecase</b> and <b>case</b>, respectively, but
signal a non-continuable error rather than returning <b>nil</b> if no clause is
selected.
<b>
<!--l. 2278--><p class="indent" >   ctypecase</b> and <b>ccase</b> are also similar to <b>typecase</b> and <b>case</b>, respectively, but
signal a continuable error if no clause is selected.
<div class="defmac">
<div class="defmacheader">
<!--l. 2283--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>etypecase</b> <a 
 id="dx186-351001"></a>keyform {(type {form}*)}*
   <br>
<!--l. 2284--><p class="noindent" ></div>
                                                                          

                                                                          
</div>
<!--l. 2285--><p class="indent" >   This control construct is similar to <b>typecase</b>, but no explicit <b>otherwise</b> or <b>t</b>
clause is permitted. If no clause is satisﬁed, <b>etypecase</b> signals an error (of type
<b>type-error</b>) with a message constructed from the clauses. It is not permissible to
continue from this error. To supply an error message, the user should use
<b>typecase</b> with an <b>otherwise</b> clause containing a call to <b>error</b>. The name of
this function stands for “exhaustive type case” or “error-checking type
case.”
<!--l. 2293--><p class="indent" >   Example: <div class="lisp"><tt><div class="tabbing">
Lisp&#x003E; (setq x 1/3)
   <br>                              <span class="math"> ⇒</span> 1/3<br>                             Lisp&#x003E; (etypecase x<br>
        (integer (* x 4))<br>                     (symbol (symbol-value x)))<br>
Error: The value of X, 1/3, is neither an integer nor a symbol.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Return to Lisp Toplevel.<br>                                       Debug&#x003E;<br>
<!--l. 2304--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 2308--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>ctypecase</b> <a 
 id="dx186-351002"></a>keyplace {(type {form}*)}*
   <br>
<!--l. 2309--><p class="noindent" ></div>
</div>
<!--l. 2310--><p class="indent" >   This control construct is similar to <b>typecase</b>, but no explicit <b>otherwise</b> or <b>t</b>
clause is permitted.
<!--l. 2313--><p class="indent" >   The <em>keyplace</em> must be a generalized variable reference acceptable to <b>setf</b>. If no
clause is satisﬁed, <b>ctypecase</b> signals an error (of type <b>type-error</b>) with a
message constructed from the clauses. This error may be continued using the
                                                                          

                                                                          
<b>store-value</b> restart. The argument to <b>store-value</b> is stored in <em>keyplace</em> and
then <b>ctypecase</b> starts over, making the type tests again. Subforms of
<em>keyplace</em> may be evaluated multiple times. If the <b>store-value</b> restart
is invoked interactively, the user will be prompted for the value to be
used.
<!--l. 2322--><p class="indent" >   The name of this function is mnemonic for “continuable (exhaustive) type
case.”
<!--l. 2326--><p class="indent" >   Example: <div class="lisp"><tt><div class="tabbing">
Lisp&#x003E; (setq x 1/3)
   <br>                              <span class="math"> ⇒</span> 1/3<br>                             Lisp&#x003E; (ctypecase x<br>
        (integer (* x 4))<br>                     (symbol (symbol-value x)))<br>
Error: The value of X, 1/3, is neither an integer nor a symbol.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use instead.<br>
 2: Return to Lisp Toplevel.<br>                           Debug&#x003E; :continue 1<br>
Use value: 3.7<br>Error: The value of X, 3.7, is neither an integer nor a symbol.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use instead.<br>              2: Return to Lisp Toplevel.<br>
Debug&#x003E; :continue 1<br>                                          Use value: 12<br>
 <span class="math"> ⇒</span> 48<br>
<!--l. 2346--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 2351--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>ecase</b> <a 
 id="dx186-351003"></a>keyform {({({key}*) | key} {form}*)}*
   <br>
<!--l. 2352--><p class="noindent" ></div>
</div>
                                                                          

                                                                          
<!--l. 2354--><p class="indent" >   This control construct is similar to <b>case</b>, but no explicit <b>otherwise</b> or <b>t</b>
clause is permitted. If no clause is satisﬁed, <b>ecase</b> signals an error (of
type <b>type-error</b>) with a message constructed from the clauses. It is not
permissible to continue from this error. To supply an error message, the user
should use <b>case</b> with an <b>otherwise</b> clause containing a call to <b>error</b>.
The name of this function stands for “exhaustive case” or “error-checking
case.”
<!--l. 2362--><p class="indent" >   Example: <div class="lisp"><tt><div class="tabbing">
Lisp&#x003E; (setq x 1/3)
   <br>                                                                                     <span class="math"> ⇒</span> 1/3<br>
Lisp&#x003E; (ecase x<br>                                              (alpha (foo))<br>
        (omega (bar))<br>                                ((zeta phi) (baz)))<br>
Error: The value of X, 1/3, is not ALPHA, OMEGA, ZETA, or PHI.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Return to Lisp Toplevel.<br>                                       Debug&#x003E;<br>
<!--l. 2374--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 2378--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>ccase</b> <a 
 id="dx186-351004"></a>keyplace {({({key}*) | key} {form}*)}*
   <br>
<!--l. 2379--><p class="noindent" ></div>
</div>
<!--l. 2380--><p class="indent" >   [This supersedes the description of <b>ccase</b> given in section ??.—GLS]
<!--l. 2383--><p class="indent" >   This control construct is similar to <b>case</b>, but no explicit <b>otherwise</b> or <b>t</b> clause
is permitted.
<!--l. 2386--><p class="indent" >   The <em>keyplace</em> must be a generalized variable reference acceptable to <b>setf</b>. If no
clause is satisﬁed, <b>ccase</b> signals an error (of type <b>type-error</b>) with a
                                                                          

                                                                          
message constructed from the clauses. This error may be continued using the
<b>store-value</b> restart. The argument to <b>store-value</b> is stored in <em>keyplace</em>
and then <b>ccase</b> starts over, making the type tests again. Subforms of
<em>keyplace</em> may be evaluated multiple times. If the <b>store-value</b> restart
is invoked interactively, the user will be prompted for the value to be
used.
<!--l. 2394--><p class="indent" >   The name of this function is mnemonic for “continuable (exhaustive)
case.”_____________________________________________________________________<div class="implementation">
<!--l. 2397--><p class="noindent" ><b>Заметка для реализации:</b> The <b>type-error</b> signaled by <b>ccase</b> and <b>ecase</b>
is free to choose any representation of the acceptable argument type that it
wishes for placement in the expected-type slot. It will always work to use type
<b>(member . <em>keys</em>)</b>, but in some cases it may be more eﬃcient, for example, to use a
type that represents an integer subrange or a type composed using the <b>or</b> type
speciﬁer.
</div>___________________________________________________________________________________________________________
<hr>
</div>
<!--l. 2409--><p class="noindent" >
     <h4 class="subsectionHead"><span class="titlemark">29.8.4   </span> <a 
href="frontmatter.html#QQ2-186-393" id="x186-35200029.8.4">Handling Conditions</a></h4>
<!--l. 2411--><p class="noindent" >These macros allow a program to gain control when a condition is signaled.
<div class="defmac">
<div class="defmacheader">
<!--l. 2414--><p class="indent" >     <div class="tabbing">
  <em>[Макрос]</em> <b>handler-case</b> <a 
 id="dx186-352001"></a>expression {(typespec ([var]) {form}*)}*
     <br>
<!--l. 2415--><p class="noindent" ></div>
</div>
<!--l. 2416--><p class="indent" >     Executes the given <em>expression</em> in a context where various speciﬁed handlers are
active.
<!--l. 2418--><p class="indent" >     Each <em>typespec</em> may be any type speciﬁer. If during the execution of the
<b>expression</b> a condition is signaled for which there is an appropriate clause—that
is, one for which <b>(typep <em>condition</em> &#x2019;<em>typespec</em>)</b> is true—and if there is no
intervening handler for conditions of that type, then control is transferred to the
                                                                          

                                                                          
body of the relevant clause (unwinding the dynamic state appropriately in the
process) and the given variable <b>var</b> is bound to the condition that was signaled. If
no such condition is signaled and the computation runs to completion, then the
values resulting from the <b>expression</b> are returned by the <b>handler-case</b>
form.
<!--l. 2427--><p class="indent" >   If more than one case is provided, those cases are made accessible in parallel.
That is, in <div class="lisp"><tt><div class="tabbing">
(handler-case <em>expression</em>
   <br>                                                                (<em>type<span class="math"><sub>1</sub></span></em> (<em>var<span class="math"><sub>1</sub></span></em>) <em>form<span class="math"><sub>1</sub></span></em>)<br>
  (<em>type<span class="math"><sub>2</sub></span></em> (<em>var<span class="math"><sub>2</sub></span></em>) <em>form<span class="math"><sub>2</sub></span></em>))<br>
<!--l. 2433--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2434--><p class="indent" >   if the ﬁrst clause (containing <em>form<span class="math"><sub>1</sub></span></em>) has been selected, the handler for the
second is no longer visible (and vice versa).
<!--l. 2437--><p class="indent" >   The cases are searched sequentially from top to bottom. If a signaled condition
matches more than one case (possible if there is type overlap) the earlier of the
two cases will be selected.
                                                                          

                                                                          
<!--l. 2444--><p class="indent" >   If the variable <em>var</em> is not needed, it may be omitted. That is, a clause such as
<div class="lisp"><tt><div class="tabbing">
(<em>type</em> (<em>var</em>) (declare (ignore <em>var</em>)) <em>form</em>)
   <br>
<!--l. 2447--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2448--><p class="indent" >   may be written using the following shorthand notation: <div class="lisp"><tt><div class="tabbing">
(<em>type</em> () <em>form</em>)
   <br>
<!--l. 2451--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2453--><p class="indent" >   If there are no forms in a selected case, the case returns <b>nil</b>. Note that
<div class="lisp"><tt><div class="tabbing">
(handler-case <em>expression</em>
   <br>                  (<em>type<span class="math"><sub>1</sub></span></em> (<em>var<span class="math"><sub>1</sub></span></em>) . <em>body<span class="math"><sub>1</sub></span></em>)<br>                   (<em>type<span class="math"><sub>2</sub></span></em> (<em>var<span class="math"><sub>2</sub></span></em>) . <em>body<span class="math"><sub>2</sub></span></em>)<br>
  ...)<br>
<!--l. 2460--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2461--><p class="indent" >   is approximately equivalent to <div class="lisp"><tt><div class="tabbing">
(block #1=#:block-1
                                                                          

                                                                          
   <br>                                                                      (let (#2=#:var-2)<br>
    (tagbody<br>                    (handler-bind ((<em>type<span class="math"><sub>1</sub></span></em> #&#x2019;(lambda (temp)<br>
                                (setq #2# temp)<br>
                                (go #3=#:tag-3)))<br>
                     (<em>type<span class="math"><sub>2</sub></span></em> #&#x2019;(lambda (temp)<br>
                                   (setq #2# temp)<br>
                                   (go #4=#:tag-4)))<br>
                     ...)<br>               (return-from #1# <em>expression</em>))<br>
      #3# (return-from #1# (let ((<em>var<span class="math"><sub>1</sub></span></em> #2#)) . <em>body<span class="math"><sub>1</sub></span></em>))<br>
      #4# (return-from #1# (let ((<em>var<span class="math"><sub>2</sub></span></em> #2#)) . <em>body<span class="math"><sub>2</sub></span></em>))<br>           ...)))<br>
<!--l. 2477--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2478--><p class="indent" >   [Note the use of “gensyms” such as <b>#:block-1</b> as block names, variables, and
<b>tagbody</b> tags in this example, and the use of <b>#<em>n</em>=</b> and <b>#<em>n</em>#</b> read-macro
syntax to indicate that the very same gensym appears in multiple places.—GLS]
<!--l. 2483--><p class="indent" >   As a special case, the <em>typespec</em> can also be the symbol <b>:no-error</b> in the last
clause. If it is, it designates a clause that will take control if the <em>expression</em> returns
normally. In that case, a completely general lambda-list may follow the symbol
<b>:no-error</b>, and the arguments to which the lambda-list parameters are bound are
like those for <b>multiple-value-call</b> on the return value of the <em>expression</em>. For
example,
                                                                          

                                                                          
<div class="lisp">
<tt>
<!--l. 2492--><p class="indent" >   <div class="tabbing">
(handler-case <em>expression</em>
   <br>                  (<em>type<span class="math"><sub>1</sub></span></em> (<em>var<span class="math"><sub>1</sub></span></em>) . <em>body<span class="math"><sub>1</sub></span></em>)<br>                   (<em>type<span class="math"><sub>2</sub></span></em> (<em>var<span class="math"><sub>2</sub></span></em>) . <em>body<span class="math"><sub>2</sub></span></em>)<br>
  ...<br>                                                 (<em>type<span class="math"><sub>n</sub></span></em> (<em>var<span class="math"><sub>n</sub></span></em>) . <em>body<span class="math"><sub>n</sub></span></em>)<br>
  (:no-error (<em>nvar<span class="math"><sub>1</sub></span></em> <em>nvar<span class="math"><sub>2</sub></span></em> ... <em>nvar<span class="math"><sub>m</sub></span></em>) . <em>nbody</em>))<br>
<!--l. 2499--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2500--><p class="indent" >   is approximately equivalent to <div class="lisp"><tt><div class="tabbing">
(block #1=#:error-return
   <br>           (multiple-value-call #&#x2019;(lambda (<em>nvar<span class="math"><sub>1</sub></span></em> <em>nvar<span class="math"><sub>2</sub></span></em> ... <em>nvar<span class="math"><sub>m</sub></span></em>) . <em>nbody</em>)<br>
    (block #2=#:normal-return<br>                       (return-from #1#<br>
        (handler-case (return-from #2# <em>expression</em>)<br>
          (<em>type<span class="math"><sub>1</sub></span></em> (<em>var<span class="math"><sub>1</sub></span></em>) . <em>body<span class="math"><sub>1</sub></span></em>)<br>                    (<em>type<span class="math"><sub>2</sub></span></em> (<em>var<span class="math"><sub>2</sub></span></em>) . <em>body<span class="math"><sub>2</sub></span></em>)<br>
          ...<br>                                  (<em>type<span class="math"><sub>n</sub></span></em> (<em>var<span class="math"><sub>n</sub></span></em>) . <em>body<span class="math"><sub>n</sub></span></em>))))))<br>
<!--l. 2511--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2515--><p class="indent" >   Examples of the use of <b>handler-case</b>: <div class="lisp"><tt><div class="tabbing">
(handler-case (/ x y)
   <br>                                                              (division-by-zero () nil))<br>
<br>                            (handler-case (open *the-ﬁle* :direction :input)<br>
  (ﬁle-error (condition) (format t &#x0022;~&#x0026;Fooey: ~A~%&#x0022; condition)))<br>
<br>                                        (handler-case (some-user-function)<br>
  (ﬁle-error (condition) condition)<br>                   (division-by-zero () 0)<br>
  ((or unbound-variable undeﬁned-function) () &#x2019;unbound))<br>                <br>
(handler-case (intern x y)<br>                     (error (condition) condition)<br>
                                                                          

                                                                          
  (:no-error (symbol status)<br>                     (declare (ignore symbol))<br>
    status))<br>
<!--l. 2533--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 2537--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>ignore-errors</b> <a 
 id="dx186-352002"></a>{form}*
   <br>
<!--l. 2538--><p class="noindent" ></div>
</div>
<!--l. 2539--><p class="indent" >   Executes its body in a context that handles conditions of type <b>error</b> by
returning control to this form. If no such condition is signaled, any values
returned by the last form are returned by <b>ignore-errors</b>. Otherwise, two values
are returned: <b>nil</b> and the <b>error</b> condition that was signaled.
<b>
<!--l. 2544--><p class="indent" >   ignore-errors</b> could be deﬁned by <div class="lisp"><tt><div class="tabbing">
(defmacro ignore-errors (&#x0026;body forms)
   <br>                                                     ‘(handler-case (progn ,@forms)<br>
     (error (c) (values nil c)))<br>
<!--l. 2549--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 2554--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
 <em>[Макрос]</em> <b>handler-bind</b> <a 
 id="dx186-352003"></a>({(typespec handler)}*) {form}*
   <br>
<!--l. 2555--><p class="noindent" ></div>
</div>
<!--l. 2556--><p class="indent" >   Executes body in a dynamic context where the given handler bindings are in
eﬀect. Each <em>typespec</em> may be any type speciﬁer. Each <em>handler</em> form should
evaluate to a function to be used to handle conditions of the given type(s) during
execution of the <em>form</em>s. This function should take a single argument, the condition
being signaled.
<!--l. 2563--><p class="indent" >   If more than one binding is speciﬁed, the bindings are searched sequentially
from top to bottom in search of a match (by visual analogy with <b>typecase</b>). If an
appropriate <em>typespec</em> is found, the associated handler is run in a context where
none of the handler bindings are visible (to avoid recursive errors). For example,
in the case of <div class="lisp"><tt><div class="tabbing">
(handler-bind ((unbound-variable #&#x2019;(lambda ...))
   <br>                                                         (error #&#x2019;(lambda ...)))<br>
  ...)<br>
<!--l. 2572--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2573--><p class="indent" >   if an unbound variable error is signaled in the body (and not handled by an
intervening handler), the ﬁrst function will be called. If any other kind
of error is signaled, the second function will be called. In either case,
neither handler will be active while executing the code in the associated
function.
<hr></div>
<!--l. 2581--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.5   </span> <a 
href="frontmatter.html#QQ2-186-394" id="x186-35300029.8.5">Deﬁning Conditions</a></h4>
<!--l. 2584--><p class="noindent" >[The contents of this section are still a subject of some debate within X3J13. The
reader may wish to take this section with a grain of salt, two aspirin tablets, and
call a hacker in the morning.—GLS]
                                                                          

                                                                          
<div class="defmac">
<div class="defmacheader">
<!--l. 2589--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>deﬁne-condition</b> <a 
 id="dx186-353001"></a>name ({parent-type}*)[({slot-speciﬁer}*) {option}*]
   <br>
<!--l. 2591--><p class="noindent" ></div>
</div>
<!--l. 2592--><p class="indent" >   Deﬁnes a new condition type called <em>name</em>, which is a subtype of each given
<em>parent-type</em>. Except as otherwise noted, the arguments are not evaluated.
<!--l. 2595--><p class="indent" >   Objects of this condition type will have all of the indicated <em>slot</em>s, plus any
additional slots inherited from the parent types (its superclasses). If the <em>slot</em>s list
is omitted, the empty list is assumed.
<!--l. 2599--><p class="indent" >   A <em>slot</em> must have the form <div class="tabbing">
<em>slot-speciﬁer</em> ::= <em>slot-name</em> | (<em>slot-name</em> <span class="math">[[↓<em>slot-option</em> ]]</span>)
   <br>
<!--l. 2602--><p class="noindent" ></div>For the syntax of a <em>slot-option</em>, see <b>defclass</b>. The slots of a condition object are
normal CLOS slots. Note that <b>with-slots</b> may be used instead of accessor
functions to access slots of a condition object.
<b>
<!--l. 2608--><p class="indent" >   make-condition</b> will accept keywords (in the keyword package) with the
print name of any of the designated slots, and will initialize the corresponding
slots in conditions it creates.
<!--l. 2612--><p class="indent" >   Accessors are created according to the same rules as used by <b>defclass</b>.
<!--l. 2614--><p class="indent" >   The valid <em>options</em> are as follows:
<div class="flushdesc">
      <ul><li><b>
<b>(:documentation <em>doc-string</em>)</b> </b></li>
      <!--l. 2619--><p class="noindent" >The  <em>doc-string</em>  should  be  either  <b>nil</b> or  a  string  that  describes  the
      purpose of the condition type. If this option is omitted, <b>nil</b> is assumed.
      Calling <b>(documentation &#x2019;<em>name</em> &#x2019;type)</b> will retrieve this information.
                                                                          

                                                                          
      <li><b>
<b>(:report <em>exp</em>)</b> </b></li>
      <!--l. 2626--><p class="noindent" >If <em>exp</em> is not a literal string, it must be a suitable argument to the
      <b>function</b> special  operator.  The  expression  <b>(function <em>exp</em>)</b> will  be
      evaluated  in  the  current  lexical  environment.  It  should  produce  a
      function of two arguments, a condition and a stream, that prints on the
      stream a description of the condition. This function is called whenever
      the condition is printed while <b>*print-escape*</b> is <b>nil</b>.
      <!--l. 2633--><p class="noindent" >If <em>exp</em> is a literal string, it is shorthand for <div class="lisp"><tt><div class="tabbing">
      (lambda (c s)
      <br>                                                                  (declare (ignore c))<br>
             (write-string <em>exp</em> s))<br>
      <!--l. 2638--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 2639--><p class="noindent" >[That is, a function is provided that will simply write the given string
      literally to the stream, regardless of the particular condition object
      supplied.—GLS]
      <!--l. 2642--><p class="noindent" >The <b>:report</b> option is processed <em>after</em> the new condition type has been
      deﬁned, so use of the slot accessors within the report function is permitted.
      If this option is not speciﬁed, information about how to report this type of
      condition will be inherited from the <em>parent-type</em>.</ul>
</div>
<!--l. 2648--><p class="indent" >   [X3J13 voted in March 1989 <a 
 id="dx186-353002"></a>to integrate the Condition System and the Object
System. In the original Condition System proposal, <b>deﬁne-condition</b> allowed
only one <em>parent-type</em> (the inheritance structure was a simple hierarchy). Slot
descriptions were much simpler, even simpler than those for <b>defstruct</b>:
<div class="tabbing">
<em>slot</em> ::= <em>slot-name</em> | (<em>slot-name</em>) | (<em>slot-name</em> <em>default-value</em>)
   <br>
                                                                          

                                                                          
<!--l. 2656--><p class="noindent" ></div>Similarly, <b>deﬁne-condition</b> allowed a <b>:conc-name</b> option similar to that of
<b>defstruct</b>: <div class="flushdesc">
      <ul><li><b>
<b>(:conc-name <em>symbol-or-string</em>)</b> </b></li>
<b>
      <!--l. 2662--><p class="noindent" >Not now part of Common Lisp.</b> As with <b>defstruct</b>, this sets up
      automatic preﬁxing of the names of slot accessors. Also as in <b>defstruct</b>,
      the default behavior is to use the name of the new type, <em>name</em>, followed
      by a hyphen. (Generated names are interned in the package that is
      current at the time that the <b>deﬁne-condition</b> is processed).</ul>
</div>
<!--l. 2669--><p class="noindent" >One consequence of the vote was to make <b>deﬁne-condition</b> slot descriptions like
those of <b>defclass</b>.—GLS]
<!--l. 2672--><p class="indent" >   Here are some examples of the use of <b>deﬁne-condition</b>.
<!--l. 2676--><p class="indent" >   The following form deﬁnes a condition of type <b>peg/hole-mismatch</b> that
inherits from a condition type called <b>blocks-world-error</b>: <div class="lisp"><tt><div class="tabbing">
(deﬁne-condition peg/hole-mismatch (blocks-world-error)
   <br>                                                      (peg-shape hole-shape)<br>
  (:report<br>                                     (lambda (condition stream)<br>
      (with-slots (peg-shape hole-shape) condition<br>
        (format stream &#x0022;A ~A peg cannot go in a ~A hole.&#x0022;<br>
                peg-shape hole-shape))))<br>
<!--l. 2686--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2687--><p class="indent" >   The new type has slots <b>peg-shape</b> and <b>hole-shape</b>, so <b>make-condition</b> will
accept <b>:peg-shape</b> and <b>:hole-shape</b> keywords. The <b>with-slots</b> macro may be
used to access the <b>peg-shape</b> and <b>hole-shape</b> slots, as illustrated in the <b>:report</b>
information.
<!--l. 2692--><p class="indent" >   Here is another example. This deﬁnes a condition called <b>machine-error</b> that
inherits from <b>error</b>: <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(deﬁne-condition machine-error (error)
   <br>                                                                ((machine-name<br>
                    :reader machine-error-machine-name))<br>
  (:report (lambda (condition stream)<br>
             (format stream &#x0022;There is a problem with ~A.&#x0022;<br>
                     (machine-error-machine-name condition)))))<br>
<!--l. 2701--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2702--><p class="indent" >   Building on this deﬁnition, we can deﬁne a new error condition that is
a subtype of <b>machine-error</b> for use when machines are not available:
<div class="lisp"><tt><div class="tabbing">
(deﬁne-condition machine-not-available-error (machine-error) ()
   <br>                                               (:report (lambda (condition stream)<br>
             (format stream &#x0022;The machine ~A is not available.&#x0022;<br>
                     (machine-error-machine-name condition)))))<br>
<!--l. 2709--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2710--><p class="indent" >   We may now deﬁne a still more speciﬁc condition, built upon
<b>machine-not-available-error</b>, that provides a default for <b>machine-name</b> but
does not provide any new slots or report information. It just gives the
<b>machine-name</b> slot a default initialization: <div class="lisp"><tt><div class="tabbing">
(deﬁne-condition my-favorite-machine-not-available-error
   <br>                                               (machine-not-available-error)<br>
                  ((machine-name :initform &#x0022;MC.LCS.MIT.EDU&#x0022;)))<br>
<!--l. 2719--><p class="noindent" ></div>
</tt>
</div>
                                                                          

                                                                          
<!--l. 2720--><p class="indent" >   Note that since no <b>:report</b> clause was given, the information inherited
from <b>machine-not-available-error</b> will be used to report this type of
condition.
<hr></div>
<!--l. 2725--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.6   </span> <a 
href="frontmatter.html#QQ2-186-395" id="x186-35400029.8.6">Creating Conditions</a></h4>
<!--l. 2727--><p class="noindent" >The function <b>make-condition</b> is the basic means for creating condition
objects.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 2731--><p class="noindent" >[Function]</em><a 
 id="dx186-354001"></a> <b>make-condition</b> <i>type</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>slot-initializations</i>
</div>
<!--l. 2733--><p class="indent" >   Constructs a condition object of the given <em>type</em> using <em>slot-initializations</em> as a
speciﬁcation of the initial value of the slots. The newly created condition is
returned.
<!--l. 2737--><p class="indent" >   The <em>slot-initializations</em> are alternating keyword/value pairs. For example:
<div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;peg/hole-mismatch
   <br>                                   :peg-shape &#x2019;square :hole-shape &#x2019;round)<br>
<!--l. 2742--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<!--l. 2746--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.7   </span> <a 
href="frontmatter.html#QQ2-186-396" id="x186-35500029.8.7">Establishing Restarts</a></h4>
                                                                          

                                                                          
<!--l. 2748--><p class="noindent" >The lowest-level form that creates restart points is called <b>restart-bind</b>.
The <b>restart-case</b> macro is an abstraction that addresses many common
needs for <b>restart-bind</b> while oﬀering a more palatable syntax. See also
                                                                          

                                                                          
<b>with-simple-restart</b>. The function that transfers control to a restart point
established by one of these macros is called <b>invoke-restart</b>.
<!--l. 2756--><p class="indent" >   All restarts have dynamic extent; a restart does not survive execution of the
form that establishes it.
<div class="defmac">
<div class="defmacheader">
<!--l. 2760--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>with-simple-restart</b> <a 
 id="dx186-355001"></a>(name format-string {format-argument}*){form}*
   <br>
<!--l. 2762--><p class="noindent" ></div>
</div>
<!--l. 2763--><p class="indent" >   This is shorthand for one of the most common uses of <b>restart-case</b>.
<!--l. 2765--><p class="indent" >   If the restart designated by <em>name</em> is not invoked while executing the <em>form</em>s, all
values returned by the last <em>form</em> are returned. If that restart is invoked, control is
transferred to the <b>with-simple-restart</b> form, which immediately returns the two
values <b>nil</b> and <b>t</b>.
<!--l. 2770--><p class="indent" >   The <em>name</em> may be <b>nil</b>, in which case an anonymous restart is established.
<b>
<!--l. 2773--><p class="indent" >   with-simple-restart</b> could be deﬁned by <div class="lisp"><tt><div class="tabbing">
(defmacro with-simple-restart ((restart-name format-string
   <br>                                            &#x0026;rest format-arguments)<br>
                               &#x0026;body forms)<br>
  ‘(restart-case (progn ,@forms)<br>                         (,restart-name ()<br>
       :report<br>                                         (lambda (stream)<br>
           (format stream format-string ,@format-arguments))<br>
       (values nil t))))<br>
<!--l. 2784--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2786--><p class="indent" >   Here is an example of the use of <b>with-simple-restart</b>. <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
Lisp&#x003E; (defun read-eval-print-loop (level)
   <br>                                                                (with-simple-restart<br>
            (abort &#x0022;Exit command level ~D.&#x0022; level)<br>
          (loop<br>                                    (with-simple-restart<br>
                (abort &#x0022;Return to command level ~D.&#x0022; level)<br>
              (let ((form (prog2 (fresh-line)<br>
                                 (read)<br>
                                 (fresh-line))))<br>
                (prin1 (eval form)))))))<br>
 <span class="math"> ⇒</span> READ-EVAL-PRINT-LOOP<br>           Lisp&#x003E; (read-eval-print-loop 1)<br>
(+ &#x2019;a 3)<br> Error: The argument, A, to the function + was of the wrong type.<br>
       The function expected a number.<br>
To continue, type :CONTINUE followed by an option number:<br>
 1: Specify a value to use this time.<br>         2: Return to command level 1.<br>
 3: Exit command level 1.<br>                      4: Return to Lisp Toplevel.<br>
Debug&#x003E;<br>
<!--l. 2809--><p class="noindent" ></div>
</tt>
</div>__________________________________________________________________________
<!--l. 2812--><p class="noindent" ><b>Примечание:</b> Some readers may wonder what ought to be done by the “abort” key (or
whatever the implementation&#x2019;s interrupt key is—Control-C or Control-G, for example).
Such interrupts, whether synchronous or asynchronous in nature, are beyond the scope
of this chapter and indeed are not currently addressed by Common Lisp at all. This may
be a topic worth standardizing under separate cover. Here is some speculation about
some possible things that might happen.
<!--l. 2821--><p class="indent" >     An implementation might simply call <b>abort</b> or <b>break</b> directly without signaling any
condition.
<!--l. 2824--><p class="indent" >     Another implementation might signal some condition related to the fact that a key
had been pressed rather than to the action that should be taken. This is one way to
allow user customization. Perhaps there would be an implementation-dependent
<b>keyboard-interrupt</b> condition type with a slot containing the key that was
pressed—or perhaps there would be such a condition type, but rather than its
having slots, diﬀerent subtypes of that type with names like <b>keyboard-abort</b>,
<b>keyboard-break</b>, and so on might be signaled. That implementation would
then document the action it would take if user programs failed to handle the
condition, and perhaps ways for user programs to usefully dismiss the interrupt.__
<div class="implementation">
                                                                          

                                                                          
<!--l. 2837--><p class="noindent" ><b>Заметка для реализации:</b> Implementors are encouraged to make sure that there is
always a restart named <b>abort</b> around any user code so that user code can
call <b>abort</b> at any time and expect something reasonable to happen; exactly
what the reasonable thing is may vary somewhat. Typically, in an interactive
program, invoking <b>abort</b> should return the user to top level, though in some
batch or multi-processing situations killing the running process might be more
appropriate.
</div>
___________________________________________________________________________________
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 2852--><p class="indent" >     <div class="tabbing">
  <em>[Макрос]</em> <b>restart-case</b> <a 
 id="dx186-355002"></a>expression {(case-name arglist{keyword value}*{form}*)}*
     <br>
<!--l. 2855--><p class="noindent" ></div>
</div>
<!--l. 2856--><p class="indent" >     The <em>expression</em> is evaluated in a dynamic context where the clauses have
special meanings as points to which control may be transferred. If the <em>expression</em>
ﬁnishes executing and returns any values, all such values are simply returned by
the <b>restart-case</b> form. While the <em>expression</em> is running, any code may
transfer control to one of the clauses (see <b>invoke-restart</b>). If a transfer
occurs, the <em>form</em>s in the body of that clause will be evaluated and any
values returned by the last such <em>form</em> will be returned by the <b>restart-case</b>
form.
<!--l. 2864--><p class="indent" >     As a special case, if the <em>expression</em> is a list whose <em>car</em> is <b>signal</b>, <b>error</b>,
<b>cerror</b>, or <b>warn</b>, then <b>with-condition-restarts</b> is implicitly used to
associate the restarts with the condition to be signaled. For example,
<div class="lisp"><tt><div class="tabbing">
(restart-case (signal weird-error)
     <br>                 (become-confused ...)<br>                 (rewind-line-printer ...)<br>
  (halt-and-catch-ﬁre ...))<br>
                                                                          

                                                                          
<!--l. 2874--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2875--><p class="indent" >   is equivalent to <div class="lisp"><tt><div class="tabbing">
(restart-case (with-condition-restarts
   <br>                                                                       weird-error<br>
                (list (ﬁnd-restart &#x2019;become-confused)<br>
                      (ﬁnd-restart &#x2019;rewind-line-printer)<br>
                      (ﬁnd-restart &#x2019;halt-and-catch-ﬁre))<br>
                (signal weird-error))<br>               (become-confused ...)<br>
  (rewind-line-printer ...)<br>                          (halt-and-catch-ﬁre ...))<br>
<!--l. 2886--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2888--><p class="indent" >   If there are no <em>form</em>s in a selected clause, <b>restart-case</b> returns <b>nil</b>.
<!--l. 2890--><p class="indent" >   The <em>case-name</em> may be <b>nil</b> or a symbol naming this restart.
<!--l. 2892--><p class="indent" >   It is possible to have more than one clause use the same <em>case-name</em>. In this
case, the ﬁrst clause with that name will be found by <b>ﬁnd-restart</b>. The other
clauses are accessible using <b>compute-restarts</b>. [In this respect, <b>restart-case</b> is
rather diﬀerent from <b>case</b>!—GLS]
<!--l. 2897--><p class="indent" >   Each <em>arglist</em> is a normal lambda-list containing parameters to be bound during
the execution of its corresponding <em>form</em>s. These parameters are used to pass
any necessary data from a call to <b>invoke-restart</b> to the <b>restart-case</b>
clause.
<!--l. 2902--><p class="indent" >   By default, <b>invoke-restart-interactively</b> will pass no arguments and all
parameters must be optional in order to accommodate interactive restarting.
However, the parameters need not be optional if the <b>:interactive</b> keyword has
been used to inform <b>invoke-restart-interactively</b> about how to compute a
proper argument list.
<!--l. 2908--><p class="indent" >   The valid <em>keyword value</em> pairs are the following: <div class="flushdesc">
      <ul><li><b>
<b>:test <em>fn</em></b> </b></li>
      <!--l. 2912--><p class="noindent" >The <em>fn</em> must be a suitable argument for the <b>function</b> special operator. The
      expression <b>(function <em>fn</em>)</b> will be evaluated in the current lexical
                                                                          

                                                                          
      environment. It should produce a function of one argument, a condition. If
      this function returns <b>nil</b> when given some condition, functions such as
      <b>ﬁnd-restart</b>, <b>compute-restart</b>, and <b>invoke-restart</b> will not consider this
      restart when searching for restarts associated with that condition. If this
      pair is not supplied, it is as if <div class="lisp"><tt><div class="tabbing">
      (lambda (c) (declare (ignore c)) t)
      <br>
      <!--l. 2921--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 2922--><p class="noindent" >were used for the <em>fn</em>.
      <li><b>
<b>:interactive <em>fn</em></b> </b></li>
      <!--l. 2926--><p class="noindent" >The <em>fn</em> must be a suitable argument for the <b>function</b> special operator. The
      expression <b>(function <em>fn</em>)</b> will be evaluated in the current lexical
      environment. It should produce a function of no arguments that returns
      arguments to be used by <b>invoke-restart-interactively</b> when invoking this
      function. This function will be called in the dynamic environment available
      prior to any restart attempt. It may interact with the user on the stream in
      <b>*query-io*</b>.
      <!--l. 2934--><p class="noindent" >If a restart is invoked interactively but no <b>:interactive</b> option was supplied,
      the argument list used in the invocation is the empty list.
      <li><b>
<b>:report <em>exp</em></b> </b></li>
      <!--l. 2940--><p class="noindent" >If <em>exp</em> is not a literal string, it must be a suitable argument to the <b>function</b>
      special operator. The expression <b>(function <em>exp</em>)</b> will be evaluated in the
      current lexical environment. It should produce a function of one argument, a
      stream, that prints on the stream a description of the restart. This function
      is called whenever the restart is printed while <b>*print-escape*</b> is
      <b>nil</b>.
      <!--l. 2947--><p class="noindent" >If <em>exp</em> is a literal string, it is shorthand for <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
      (lambda (s) (write-string <em>exp</em> s))
      <br>
      <!--l. 2950--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 2951--><p class="noindent" >[That is, a function is provided that will simply write the given string
      literally to the stream.—GLS]
      <!--l. 2954--><p class="noindent" >If a named restart is asked to report but no report information has been
      supplied, the name of the restart is used in generating default report
      text.
      <!--l. 2957--><p class="noindent" >When <b>*print-escape*</b> is <b>nil</b>, the printer will use the report information for
      a restart. For example, a debugger might announce the action of typing
      “<b>:continue</b>” by executing the equivalent of <div class="lisp"><tt><div class="tabbing">
      (format *debug-io* &#x0022;~&#x0026;~S – ~A~%&#x0022; &#x2019;:continue some-restart)
      <br>
      <!--l. 2962--><p class="noindent" ></div>
</tt>
</div>
      <!--l. 2963--><p class="noindent" >which might then display as something like <div class="lisp"><tt><div class="tabbing">
      :CONTINUE – Return to command level.
      <br>
      <!--l. 2966--><p class="noindent" ></div>
</tt>
                                                                          

                                                                          
</div>
      <!--l. 2968--><p class="noindent" >It is an error if an unnamed restart is used and no report information is
      provided.____________________________________________________________<div class="rationale">
        <!--l. 2972--><p class="noindent" ><b>Обоснование:</b> Unnamed restarts are required to have report information on the
        grounds that they are generally only useful interactively, and an interactive option
        that has no description is of little value.
        </div>___________________________________________________________________________________________________<div class="implementation">
        <!--l. 2978--><p class="noindent" ><b>Заметка для реализации:</b> Implementations are encouraged to warn about this
        error at compilation time.
        <!--l. 2981--><p class="noindent" >At run time, this error might be noticed when entering the debugger. Since
        signaling an error would probably cause recursive entry into the debugger (causing
        yet another recursive error, and so on), it is suggested that the debugger print
        some indication of such problems when they occur, but not actually signal
        errors.
        </div>___________________________________________________________________________________________________
        </ul>
</div>
<!--l. 2990--><p class="indent" >     Note that <div class="lisp"><tt><div class="tabbing">
(restart-case <em>expression</em>
    <br>    (<em>name<span class="math"><sub>1</sub></span></em> <em>arglist<span class="math"><sub>1</sub></span></em> <em>options<span class="math"><sub>1</sub></span></em> . <em>body<span class="math"><sub>1</sub></span></em>)<br>    (<em>name<span class="math"><sub>2</sub></span></em> <em>arglist<span class="math"><sub>2</sub></span></em> <em>options<span class="math"><sub>2</sub></span></em> . <em>body<span class="math"><sub>2</sub></span></em>)<br>
  ...)<br>
<!--l. 2996--><p class="noindent" ></div>
</tt>
</div>
<!--l. 2997--><p class="indent" >     is essentially equivalent to <div class="lisp"><tt><div class="tabbing">
(block #1=#:block-1
     <br>                                                               (let ((#2=#:var-2 nil))<br>
    (tagbody<br>                (restart-bind ((<em>name<span class="math"><sub>1</sub></span></em> #&#x2019;(lambda (&#x0026;rest temp)<br>
                                           (setq #2# temp)<br>
                                           (go #3=#:tag-3))<br>
                                                                          

                                                                          
                             <span class="math">⟨</span>slightly transformed <em>options<span class="math"><sub>1</sub></span></em><span class="math">⟩</span>)<br>
                     (<em>name<span class="math"><sub>2</sub></span></em> #&#x2019;(lambda (&#x0026;rest temp)<br>
                                     (setq #2# temp)<br>
                                     (go #4=#:tag-4))<br>
                                 <span class="math">⟨</span>slightly transformed <em>options<span class="math"><sub>2</sub></span></em><span class="math">⟩</span>)<br>
                     ...)<br>
        (return-from #1# expression))<br>          #3# (return-from #1#<br>
                (apply #&#x2019;(lambda <em>arglist<span class="math"><sub>1</sub></span></em> . <em>body<span class="math"><sub>1</sub></span></em>) #2#))<br>
      #4# (return-from #1#<br>
                (apply #&#x2019;(lambda <em>arglist<span class="math"><sub>2</sub></span></em> . <em>body<span class="math"><sub>2</sub></span></em>) #2#))<br>         ...)))<br>
<!--l. 3017--><p class="noindent" ></div>
</tt>
</div>
<!--l. 3018--><p class="indent" >   [Note the use of “gensyms” such as <b>#:block-1</b> as block names, variables, and
<b>tagbody</b> tags in this example, and the use of <b>#<em>n</em>=</b> and <b>#<em>n</em>#</b> read-macro
syntax to indicate that the very same gensym appears in multiple places.—GLS]
<!--l. 3024--><p class="indent" >   Here are some examples of the use of <b>restart-case</b>. <div class="lisp"><tt><div class="tabbing">
(loop
   <br>                              (restart-case (return (apply function some-args))<br>
    (new-function (new-function)<br>
        :report &#x0022;Use a diﬀerent function.&#x0022;<br>
        :interactive<br>                                          (lambda ()<br>
            (list (prompt-for &#x2019;function &#x0022;Function: &#x0022;)))<br>
      (setq function new-function))))<br>                                     <br>
(loop<br>                     (restart-case (return (apply function some-args))<br>
    (nil (new-function)<br>                :report &#x0022;Use a diﬀerent function.&#x0022;<br>
        :interactive<br>                                          (lambda ()<br>
            (list (prompt-for &#x2019;function &#x0022;Function: &#x0022;)))<br>
      (setq function new-function))))<br>                                     <br>
(restart-case (a-command-loop)<br>             (return-from-command-level ()<br>
      :report<br>                  (lambda (s)     ;Argument <b>s</b> is a stream<br>
          (format s &#x0022;Return from command level ~D.&#x0022; level))<br>     nil))<br> <br>
(loop<br>                          (restart-case (another-random-computation)<br>
    (continue () nil)))<br>
                                                                          

                                                                          
<!--l. 3054--><p class="noindent" ></div>
</tt>
</div>
<!--l. 3055--><p class="indent" >   The ﬁrst and second examples are equivalent from the point of view of
someone using the interactive debugger, but they diﬀer in one important aspect
for non-interactive handling. If a handler “knows about” named restarts, as in, for
example, <div class="lisp"><tt><div class="tabbing">
(when (ﬁnd-restart &#x2019;new-function)
   <br>                                (invoke-restart &#x2019;new-function the-replacement))<br>
<!--l. 3061--><p class="noindent" ></div>
</tt>
</div>
<!--l. 3062--><p class="indent" >   then only the ﬁrst example, and not the second, will have control transferred
to its correction clause, since only the ﬁrst example uses a restart named
<b>new-function</b>.
<!--l. 3068--><p class="indent" >   Here is a more complete example: <div class="lisp"><tt><div class="tabbing">
(let ((my-food &#x2019;milk)
   <br>                                                          (my-color &#x2019;greenish-blue))<br>
  (do ()<br>                      ((not (bad-food-color-p my-food my-color)))<br>
    (restart-case (error &#x2019;bad-food-color<br>
                         :food my-food :color my-color)<br>
      (use-food (new-food)<br>
          :report &#x0022;Use another food.&#x0022;<br>         (setq my-food new-food))<br>
      (use-color (new-color)<br>                 :report &#x0022;Use another color.&#x0022;<br>
        (setq my-color new-color))))<br>
  ;; We won&#x2019;t get to here until MY-FOOD<br>
  ;; and MY-COLOR are compatible.<br>             (list my-food my-color))<br>
<!--l. 3085--><p class="noindent" ></div>
</tt>
</div>
<!--l. 3086--><p class="indent" >   Assuming that <b>use-food</b> and <b>use-color</b> have been deﬁned as <div class="lisp"><tt><div class="tabbing">
                                                                          

                                                                          
(defun use-food (new-food)
   <br>                                               (invoke-restart &#x2019;use-food new-food))<br>
<br>                                               (defun use-color (new-color)<br>
  (invoke-restart &#x2019;use-color new-color))<br>
<!--l. 3093--><p class="noindent" ></div>
</tt>
</div>
<!--l. 3094--><p class="indent" >   a handler can then restart from the error in either of two ways. It may correct
the color or correct the food. For example: <div class="lisp"><tt><div class="tabbing">
#&#x2019;(lambda (c) ... (use-color &#x2019;white) ...)   ;Corrects <b>color</b>
   <br>                                                                                   <br>
#&#x2019;(lambda (c) ... (use-food &#x2019;cheese) ...)   ;Corrects <b>food</b><br>
<!--l. 3100--><p class="noindent" ></div>
</tt>
</div>
<!--l. 3102--><p class="indent" >   Here is an example using <b>handler-bind</b> and <b>restart-case</b> that refers to a
condition type <b>foo-error</b>, presumably deﬁned elsewhere: <div class="lisp"><tt><div class="tabbing">
(handler-bind ((foo-error #&#x2019;(lambda (ignore) (use-value 7))))
   <br>          (restart-case (error &#x2019;foo-error)<br>            (use-value (x) (* x x))))<br>
 <span class="math"> ⇒</span> 49<br>
<!--l. 3109--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
                                                                          

                                                                          
<!--l. 3114--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>restart-bind</b> <a 
 id="dx186-355003"></a>({(name function {keyword value}*)}*) {form}*
   <br>
<!--l. 3115--><p class="noindent" ></div>
</div>
<!--l. 3116--><p class="indent" >   Executes a body of forms in a dynamic context where the given restart
bindings are in eﬀect.
<!--l. 3119--><p class="indent" >   Each <em>name</em> may be <b>nil</b> to indicate an anonymous restart, or some other
symbol to indicate a named restart.
<!--l. 3122--><p class="indent" >   Each <em>function</em> is a form that should evaluate to a function to be used
to perform the restart. If invoked, this function may either perform a
non-local transfer of control or it may return normally. The function may take
whatever arguments the programmer feels are appropriate; it will be invoked
only if <b>invoke-restart</b> is used from a program, or if a user interactively
asks the debugger to invoke it. In the case of interactive invocation, the
<b>:interactive-function</b> option is used.
<!--l. 3133--><p class="indent" >   The valid <em>keyword value</em> pairs are as follows: <div class="flushdesc">
      <ul><li><b>
<b>:test-function <em>form</em></b> </b></li>
      <!--l. 3137--><p class="noindent" >The <em>form</em> will be evaluated in the current lexical environment and should
      return a function of one argument, a condition. If this function returns
      <b>nil</b> when given some condition, functions such as <b>ﬁnd-restart</b>,
      <b>compute-restart</b>, and <b>invoke-restart</b> will not consider this restart when
      searching for restarts associated with that condition. If this pair is not
      supplied, it is as if <div class="lisp"><tt><div class="tabbing">
      #&#x2019;(lambda (c) (declare (ignore c)) t)
      <br>
      <!--l. 3145--><p class="noindent" ></div>
</tt>
</div>
                                                                          

                                                                          
      <!--l. 3146--><p class="noindent" >were used for the <em>form</em>.
      <li><b>
<b>:interactive-function <em>form</em></b> </b></li>
      <!--l. 3150--><p class="noindent" >The <em>form</em> will be evaluated in the current lexical environment and should
      return a function of no arguments that constructs a list of arguments
      to be used by <b>invoke-restart-interactively</b> when invoking this
      restart. The function may prompt interactively using <b>*query-io*</b> if
      necessary.
      <li><b>
<b>:report-function <em>form</em></b> </b></li>
      <!--l. 3158--><p class="noindent" >The <em>form</em> will be evaluated in the current lexical environment and should
      return a function of one argument, a stream, that prints on the
      stream a summary of the action this restart will take. This function
      is called whenever the restart is printed while <b>*print-escape*</b> is
      <b>nil</b>.</ul>
</div>
<hr>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 3167--><p class="indent" >   <div class="tabbing">
 <em>[Макрос]</em> <b>with-condition-restarts</b> <a 
 id="dx186-355004"></a>condition-form restarts-form{declaration}* {form}*
   <br>
<!--l. 3169--><p class="noindent" ></div>
</div>
<!--l. 3170--><p class="indent" >   The value of <em>condition-form</em> should be a condition <em>C</em> and the value of
<em>restarts-form</em> should be a list of restarts <b>(<em>R1</em> <em>R2</em> ...)</b>. The <em>form</em>s of the body are
evaluated as an implicit <b>progn</b>. While in the dynamic context of the body, an
attempt to ﬁnd a restart associated with a particular condition <span class="math"><em>C</em>′</span> will consider
the restarts <em>R1</em>, <em>R2</em>, <span class="math">…</span> if <span class="math"><em>C</em>′</span> is <b>eq</b> to <em>C</em>.
<!--l. 3178--><p class="indent" >   Usually this macro is not used explicitly in code, because <b>restart-case</b>
handles most of the common uses in a way that is syntactically more
concise.
                                                                          

                                                                          
<!--l. 3182--><p class="indent" >   [The X3J13 vote <a 
 id="dx186-355005"></a>left it unclear whether <b>with-condition-restarts</b> permits
declarations to appear at the heads of its body. I believe that was the intent, but
this is only my interpretation.—GLS]
<hr>
</div>
<!--l. 3189--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.8   </span> <a 
href="frontmatter.html#QQ2-186-397" id="x186-35600029.8.8">Finding and Manipulating Restarts</a></h4>
<!--l. 3191--><p class="noindent" >The following functions determine what restarts are active and invoke
restarts.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3195--><p class="noindent" >[Function]</em><a 
 id="dx186-356001"></a> <b>compute-restarts</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 3197--><p class="indent" >   Uses the dynamic state of the program to compute a list of the restarts that
are currently active. See <b>restart-bind</b>.
<!--l. 3200--><p class="indent" >   If <em>condition</em> is <b>nil</b> or not supplied, all outstanding restarts are returned.
If <em>condition</em> is not <b>nil</b>, only restarts associated with that condition are
returned.
<!--l. 3205--><p class="indent" >   Each restart represents a function that can be called to perform some
form of recovery action, usually a transfer of control to an outer point
in the running program. Implementations are free to implement these
objects in whatever manner is most convenient; the objects need have only
dynamic extent (relative to the scope of the binding form that instantiates
them).
<!--l. 3211--><p class="indent" >   The list that results from a call to <b>compute-restarts</b> is ordered so that the
inner (that is, more recently established) restarts are nearer the head of the
list.
<!--l. 3215--><p class="indent" >   Note, too, that <b>compute-restarts</b> returns all valid restarts, including
anonymous ones, even if some of them have the same name as others
and would therefore not be found by <b>ﬁnd-restart</b> when given a symbol
argument.
<!--l. 3219--><p class="indent" >   Implementations are permitted, but not required, to return diﬀerent (that is,
non-<b>eq</b>) lists from repeated calls to <b>compute-restarts</b> while in the same
                                                                          

                                                                          
dynamic environment. It is an error to modify the list that is returned by
<b>compute-restarts</b>.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3227--><p class="noindent" >[Function]</em><a 
 id="dx186-356002"></a> <b>restart-name</b> <i>restart</i>
</div>
<!--l. 3229--><p class="indent" >   Returns the name of the given <em>restart</em>, or <b>nil</b> if it is not named.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3233--><p class="noindent" >[Function]</em><a 
 id="dx186-356003"></a> <b>ﬁnd-restart</b> <i>restart-identiﬁer</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 3235--><p class="indent" >   Searches for a particular restart in the current dynamic environment.
<!--l. 3237--><p class="indent" >   If <em>condition</em> is <b>nil</b> or not supplied, all outstanding restarts are considered.
If <em>condition</em> is not <b>nil</b>, only restarts associated with that condition are
considered.
<!--l. 3242--><p class="indent" >   If the <em>restart-identiﬁer</em> is a non-<b>nil</b> symbol, then the innermost (that is, most
recently established) restart with that name is returned; <b>nil</b> is returned if no such
restart is found.
<!--l. 3247--><p class="indent" >   If <em>restart-identiﬁer</em> is a restart object, then it is simply returned, unless it is
not currently active, in which case <b>nil</b> is returned.
<!--l. 3250--><p class="indent" >   Although anonymous restarts have a name of <b>nil</b>, it is an error for the symbol
<b>nil</b> to be given as the <em>restart-identiﬁer</em>. Applications that would seem to require
this should be rewritten to make appropriate use of <b>compute-restarts</b>
instead.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
                                                                          

                                                                          
<!--l. 3257--><p class="noindent" >[Function]</em><a 
 id="dx186-356004"></a> <b>invoke-restart</b> <i>restart-identiﬁer</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 3259--><p class="indent" >   Calls the function associated with the given <em>restart-identiﬁer</em>, passing any
given <em>arguments</em>. The <em>restart-identiﬁer</em> must be a restart or the non-null name of
a restart that is valid in the current dynamic context. If the argument is not valid,
an error of type <b>control-error</b> will be signaled.___________________________<div class="implementation">
<!--l. 3265--><p class="noindent" ><b>Заметка для реализации:</b> Restart functions call this function, not vice
versa.
</div>___________________________________________________________________________________________________________
<hr>
</div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3272--><p class="noindent" >[Function]</em><a 
 id="dx186-356005"></a> <b>invoke-restart-interactively</b> <i>restart-identiﬁer</i>
</div>
<!--l. 3274--><p class="indent" >    Calls the function associated with the given <em>restart-identiﬁer</em>, prompting
for any necessary arguments. The <em>restart-identiﬁer</em> must be a restart
or the non-null name of a restart that is valid in the current dynamic
context. If the argument is not valid, an error of type <b>control-error</b> will be
signaled.
<!--l. 3279--><p class="indent" >     The function <b>invoke-restart-interactively</b> will prompt for arguments by
executing the code provided in the <b>:interactive</b> keyword to <b>restart-case</b> or
<b>:interactive-function</b> keyword to <b>restart-bind</b>.
<!--l. 3283--><p class="indent" >     If no <b>:interactive</b> or <b>:interactive-function</b> option has been supplied in the
corresponding <b>restart-case</b> or <b>restart-bind</b>, then it is an error if the restart
takes required arguments. If the arguments are optional, an empty argument list
will be used in this case.
<!--l. 3289--><p class="indent" >     Once <b>invoke-restart-interactively</b> has calculated the arguments, it simply
performs <b>(apply #&#x2019;invoke-restart <em>restart-identi er</em> <em>arguments</em>)</b>.
<b>
<!--l. 3293--><p class="indent" >     invoke-restart-interactively</b> is used internally by the debugger and
may also be useful in implementing other portable, interactive debugging
tools.
<hr></div>
                                                                          

                                                                          
<!--l. 3298--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.9   </span> <a 
href="frontmatter.html#QQ2-186-398" id="x186-35700029.8.9">Warnings</a></h4>
<!--l. 3301--><p class="noindent" >Warnings are a subclass of errors that are conventionally regarded as
“mild.”
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3304--><p class="noindent" >[Function]</em><a 
 id="dx186-357001"></a> <b>warn</b> <i>datum</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>arguments</i>
</div>
<!--l. 3306--><p class="indent" >   [This supersedes the description of <b>warn</b> given in section ??.—GLS]
<!--l. 3309--><p class="indent" >   Warns about a situation, by signaling a condition of type <b>warning</b>.
<!--l. 3311--><p class="indent" >   If <em>datum</em> is a condition, then that condition is used directly. In this case, if the
condition is not of type <b>warning</b> or arguments is non-<b>nil</b>, an error of type
<b>type-error</b> is signaled.
<!--l. 3315--><p class="indent" >   If <em>datum</em> is a condition type (a class or class name), then the condition used is
eﬀectively the result of <b>(apply #&#x2019;make-condition <em>datum</em> <em>arguments</em>)</b>.
This result must be of type <b>warning</b> or an error of type <b>type-error</b> is
signaled.
<!--l. 3319--><p class="indent" >   If <em>datum</em> is a string, then the condition used is eﬀectively the result of
<div class="lisp"><tt><div class="tabbing">
(make-condition &#x2019;simple-error
   <br>                                                          :format-string <em>datum</em><br>
                :format-arguments <em>arguments</em>)<br>
<!--l. 3324--><p class="noindent" ></div>
</tt>
</div>
<!--l. 3326--><p class="indent" >   The precise mechanism for warning is as follows.
      <ol  class="enumerate1" >
      <li 
  class="enumerate" id="x186-357003x1">The warning condition is signaled.
      <!--l. 3331--><p class="noindent" >While the <b>warning</b> condition is being signaled, the <b>muﬄe-warning</b>
      restart is established for use by a handler to bypass further action by
      <b>warn</b> (that is, to cause <b>warn</b> to immediately return <b>nil</b>).
                                                                          

                                                                          
      <!--l. 3335--><p class="noindent" >As                          part                          of                          the
      signaling process, if <b>(typep <em>condition</em> *break-on-signals*)</b> is true,
      then a <b>break</b> will occur prior to beginning the signaling process.
      </li>
      <li 
  class="enumerate" id="x186-357005x2">If no handlers for the warning condition are found, or if all such handlers
      decline, then the condition will be reported to <b>*error-output*</b> by
      the <b>warn</b> function (with possible implementation-speciﬁc extra output
      such  as  motion  to  a  fresh  line  before  or  after  the  display  of  the
      warning, or supplying some introductory text mentioning the name of
      the function that called <b>warn</b> or the fact that this is a warning).
      </li>
      <li 
  class="enumerate" id="x186-357007x3">The value returned by <b>warn</b> (if it returns) is <b>nil</b>.</li></ol>
<hr>
</div>
<!--l. 3352--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.10   </span> <a 
href="frontmatter.html#QQ2-186-399" id="x186-35800029.8.10">Restart Functions</a></h4>
<!--l. 3354--><p class="noindent" >Common Lisp has the following restart functions built in.
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3357--><p class="noindent" >[Function]</em><a 
 id="dx186-358001"></a> <b>abort</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 3359--><p class="indent" >   This function transfers control to the restart named <b>abort</b>. If no such restart
exists, <b>abort</b> signals an error of type <b>control-error</b>.
<!--l. 3362--><p class="indent" >   If <em>condition</em> is <b>nil</b> or not supplied, all outstanding restarts are considered.
If <em>condition</em> is not <b>nil</b>, only restarts associated with that condition are
considered.
<!--l. 3367--><p class="indent" >   The purpose of the <b>abort</b> restart is generally to allow control to return to the
innermost “command level.”
<hr></div>
<div class="defun">
                                                                          

                                                                          
<div class="defunheader">
<em>
<!--l. 3372--><p class="noindent" >[Function]</em><a 
 id="dx186-358002"></a> <b>continue</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 3374--><p class="indent" >   This function transfers control to the restart named <b>continue</b>. If no such
restart exists, <b>continue</b> returns <b>nil</b>.
<!--l. 3377--><p class="indent" >   If <em>condition</em> is <b>nil</b> or not supplied, all outstanding restarts are considered.
If <em>condition</em> is not <b>nil</b>, only restarts associated with that condition are
considered.
<!--l. 3382--><p class="indent" >   The <b>continue</b> restart is generally part of simple protocols where there is a
single “obvious” way to continue, as with <b>break</b> and <b>cerror</b>. Some user-deﬁned
protocols may also wish to incorporate it for similar reasons. In general, however,
it is more reliable to design a special-purpose restart with a name that better suits
the particular application.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3390--><p class="noindent" >[Function]</em><a 
 id="dx186-358003"></a> <b>muﬄe-warning</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 3392--><p class="indent" >   This function transfers control to the restart named <b>muﬄe-warning</b>. If no
such restart exists, <b>muﬄe-warning</b> signals an error of type <b>control-error</b>.
<!--l. 3396--><p class="indent" >   If <em>condition</em> is <b>nil</b> or not supplied, all outstanding restarts are considered.
If <em>condition</em> is not <b>nil</b>, only restarts associated with that condition are
considered.
<b>
<!--l. 3401--><p class="indent" >   warn</b> sets up this restart so that handlers of <b>warning</b> conditions have a way
to tell <b>warn</b> that a <b>warning</b> has already been dealt with and that no further
action is warranted.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
                                                                          

                                                                          
<!--l. 3407--><p class="noindent" >[Function]</em><a 
 id="dx186-358004"></a> <b>store-value</b> <i>value</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 3409--><p class="indent" >   This function transfers control (and one value) to the restart named
<b>store-value</b>. If no such restart exists, <b>store-value</b> returns <b>nil</b>.
<!--l. 3412--><p class="indent" >   If <em>condition</em> is <b>nil</b> or not supplied, all outstanding restarts are considered.
If <em>condition</em> is not <b>nil</b>, only restarts associated with that condition are
considered.
<!--l. 3417--><p class="indent" >   The <b>store-value</b> restart is generally used by handlers trying to recover from
errors of types such as <b>cell-error</b> or <b>type-error</b>, where the handler may wish to
supply a replacement datum to be stored permanently.
<hr></div>
<div class="defun">
<div class="defunheader">
<em>
<!--l. 3423--><p class="noindent" >[Function]</em><a 
 id="dx186-358005"></a> <b>use-value</b> <i>value</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>condition</i>
</div>
<!--l. 3425--><p class="indent" >   This function transfers control (and one value) to the restart named
<b>use-value</b>. If no such restart exists, <b>use-value</b> returns <b>nil</b>.
<!--l. 3428--><p class="indent" >   If <em>condition</em> is <b>nil</b> or not supplied, all outstanding restarts are considered.
If <em>condition</em> is not <b>nil</b>, only restarts associated with that condition are
considered.
<!--l. 3433--><p class="indent" >   The <b>use-value</b> restart is generally used by handlers trying to recover from
errors of types such as <b>cell-error</b>, where the handler may wish to supply a
replacement datum for one-time use.
<hr></div>
<!--l. 3439--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.8.11   </span> <a 
href="frontmatter.html#QQ2-186-400" id="x186-35900029.8.11">Debugging Utilities</a></h4>
<!--l. 3442--><p class="noindent" >Common Lisp does not specify exactly what a debugger is or does, but it does
provide certain means for indicating intent to transfer control to a supervisory or
debugging facility.
<div class="defun">
<div class="defunheader">
                                                                          

                                                                          
<em>
<!--l. 3447--><p class="noindent" >[Function]</em><a 
 id="dx186-359001"></a> <b>break</b> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;optional</a></tt> <i>format-string</i> <tt><a 
href="clmse29.html#x39-620005.2.2">&#x0026;rest</a></tt> <i>format-arguments</i>
</div>
<!--l. 3449--><p class="indent" >   [This supersedes the description of <b>break</b> given in section ??.—GLS]
<!--l. 3452--><p class="indent" >   The function <b>break</b> prints the message described by the <em>format-string</em>
and <em>format-arguments</em> and then goes directly into the debugger without
allowing any possibility of interception by programmed error-handling
facilities.
<!--l. 3457--><p class="indent" >   If no <em>format-string</em> is supplied, a suitable default will be generated.
<!--l. 3459--><p class="indent" >   If continued, <b>break</b> returns <b>nil</b>.
<!--l. 3461--><p class="indent" >   Note that <b>break</b> is presumed to be used as a way of inserting temporary
debugging “breakpoints” in a program, not as a way of signaling errors; it is
expected that continuing from a <b>break</b> will not trigger any unusual recovery
action. For this reason, <b>break</b> does not take the additional format control string
that <b>cerror</b> takes as its ﬁrst argument. This and the lack of any possibility of
interception by programmed error handling are the only program-visible
diﬀerences between <b>break</b> and <b>cerror</b>. The user interface aspects of these
functions are permitted to vary more widely; for example, it is permissible for a
read-eval-print loop to be entered by <b>break</b> rather than by the conventional
debugger.
<b>
<!--l. 3472--><p class="indent" >   break</b> could be deﬁned by <div class="lisp"><tt><div class="tabbing">
(defun break (&#x0026;optional (format-string &#x0022;Break&#x0022;)
   <br>                                                      &#x0026;rest format-arguments)<br>
  (with-simple-restart (continue &#x0022;Return from BREAK.&#x0022;)<br>
    (invoke-debugger<br>                   (make-condition &#x2019;simple-condition<br>
                      :format-string format-string<br>
                      :format-arguments format-arguments)))<br>      nil)<br>
<!--l. 3482--><p class="noindent" ></div>
</tt>
</div>
<hr>
</div>
<div class="defun">
                                                                          

                                                                          
<div class="defunheader">
<em>
<!--l. 3486--><p class="noindent" >[Function]</em><a 
 id="dx186-359002"></a> <b>invoke-debugger</b> <i>condition</i>
</div>
<!--l. 3488--><p class="indent" >   Attempts interactive handling of its argument, which must be a condition.
<!--l. 3490--><p class="indent" >   If the variable <b>*debugger-hook*</b> is not <b>nil</b>, it will be called as a
function on two arguments: the <em>condition</em> being handled and the value of
<b>*debugger-hook*</b>. If a hook function returns normally, the standard debugger
will be tried.
<!--l. 3494--><p class="indent" >   The standard debugger will never directly return. Return can occur only by a
special transfer of control, such as the use of a restart._____________________
<!--l. 3498--><p class="noindent" ><b>Примечание:</b> The exact way in which the debugger interacts with users is expected to
vary considerably from system to system. For example, some systems may use a
keyboard interface, while others may use a mouse interface. Of those systems using
keyboard commands, some may use single-character commands and others may
use parsed line-at-a-time commands. The exact set of commands will vary as
well. The important properties of a debugger are that it makes information
about the error accessible and that it makes the set of apparent restarts easily
accessible.
<!--l. 3508--><p class="indent" >     It is desirable to have a mode where the debugger allows other features,
such as the ability to inspect data, stacks, etc. However, it may sometimes be
appropriate to have this kind of information hidden from users. Experience
on the Lisp Machines has shown that some users who are not programmers
develop a terrible phobia of debuggers. The reason for this usually may be
traced to the fact that the debugger is very foreign to them and provides an
overwhelming amount of information of interest only to programmers. With the
advent of restarts, there is a clear mechanism for the construction of “friendly”
debuggers. Programmers can be taught how to get to the information they need for
debugging, but it should be possible to construct user interfaces to the debugger that
are natural, convenient, intelligible, and friendly even to non-programmers.________
<hr>
</div>
<div class="defun">
<div class="defunheader">
<em>
                                                                          

                                                                          
<!--l. 3525--><p class="noindent" >[Variable]</em><a 
 id="dx186-359003"></a> <b>*debugger-hook*</b>
</div>
<!--l. 3527--><p class="indent" >   This variable should hold either <b>nil</b> or a function of two arguments, a
condition and the value of <b>*debugger-hook*</b>. This function may either handle
the condition (transfer control) or return normally (allowing the standard
debugger to run).
<!--l. 3532--><p class="indent" >   Note that, to minimize recursive errors while debugging, <b>*debugger-hook*</b> is
bound to <b>nil</b> when calling this function. When evaluating code typed in by the
user interactively, the hook function may want to bind <b>*debugger-hook*</b> to the
function that was its second argument so that recursive errors can be handled
using the same interactive facility.
<hr></div>
                                                                          

                                                                          
<!--l. 3541--><p class="indent" >   <div id="bottomlinks">&#x003C;<a 
href="clmse153.html" >Далее</a>&#x003E;&#x003C;<a 
href="clmse151.html" >Назад</a>&#x003E;&#x003C;<a 
href="clmse151.html#tailclmse151.html" >Назад-и-вниз</a>&#x003E;&#x003C;<a 
href="clmse152.html" >В-начало</a>&#x003E;&#x003C;<a 
href="clmch29.html#clmse152.html" >Наверх</a>&#x003E;<br> &lt;<a href="../index.html">Главная</a>&gt; &lt;<a href="symbols.html">Символы</a>&gt;</div><a 
 id="tailclmse152.html"></a>
 
</body></html> 
