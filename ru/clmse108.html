<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Цикл взаимодействия с пользователем</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 16:17:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 599--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="stream.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html#tailclmse107.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse108.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="eval.html#clmse108.html" >Наверх</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">20.2   </span> <a 
href="clm.html#QQ2-133-1561" id="x133-153100020.2">Цикл взаимодействия
с пользователем</a></h3>
<!--l. 601--><p class="noindent" >С Lisp&#x2019;ом можно работать через специальный цикл вида «<tt><a 
href="symbols.html#x187-2604715r715">read</a></tt>-<tt><a 
href="symbols.html#x187-2604343r343">eval</a></tt>-<tt><a 
href="symbols.html#x187-2604688r688">print</a></tt> и
сначала». Изменять состояние Lisp системы можно вызовом в этом цикле
действий, имеющих побочные эффекты.
<!--l. 606--><p class="indent" >   Точное определение такого цикла для Common Lisp&#x2019;а не указывается
здесь специально, оставляя разработчикам поле для творчества. Например,
они могут сделать командную строку, или простой текстовый редактор, или
сложный графический интерфейс. Разработчики могут предоставлять
явный запрос ввода, или (как в MacLisp&#x2019;е) не загромождать экран
подсказками.
<!--l. 612--><p class="indent" >   Цикл взаимодействия с пользователем должен ловить все исключения и
изящно их обрабатывать. Он должен также выводить все результаты
вычисления форм, возможно в отдельных строках. Если форма вернула ноль
значений, это также должно быть отображено.
<!--l. 617--><p class="indent" >   Следующие переменные управляются циклом взаимодействия с
пользователем, для удобства работы, например в случае, если пользователь
забыл сохранить интересное введённое выражение или выведенное значение.
(Следует отметить, что имена некоторых этих переменных нарушают
нотацию глобальных переменных в использовании звёздочек в начале и конце
имени.) Эти переменные в основном используются для взаимодействия с
пользователем, поэтому имеют короткие имена. Использование этих
переменных в программах следует избегать.
<div class="defun">
<!--l. 625--><p class="noindent" ><div class="defunheader"> <i>[Переменная]</i><a 
 id="dx133-1531001"></a><a 
 id="x133-1531002r590"></a> <b>+</b><br />
<i>
[Переменная]</i><a 
 id="dx133-1531003"></a><a 
 id="x133-1531004r591"></a> <b>++</b><br />
<i>
[Переменная]</i><a 
 id="dx133-1531005"></a><a 
 id="x133-1531006r592"></a> <b>+++</b>
</div>
<!--l. 630--><p class="indent" >   Когда форма вычисляется в цикле взаимодействия, переменная <tt><a 
href="symbols.html#x187-2604051r51">+</a></tt>
                                                                          

                                                                          
связывается с предыдущим прочитанным выражением. Переменная <tt><a 
href="symbols.html#x187-2604052r52">++</a></tt>
хранит предыдущее относительно значения <tt><a 
href="symbols.html#x187-2604051r51">+</a></tt> (то есть, форма вычисленная
два шага назад), и <tt><a 
href="symbols.html#x187-2604053r53">+++</a></tt> хранит предыдущее значение относительно
<tt><a 
href="symbols.html#x187-2604052r52">++</a></tt>.
</div>
<div class="defun">
<!--l. 637--><p class="noindent" ><div class="defunheader"> <i>[Переменная]</i><a 
 id="dx133-1531007"></a><a 
 id="x133-1531008r593"></a> <b>-</b>
</div>
<!--l. 640--><p class="indent" >   Когда формы выполняется в цикле взаимодействия, переменная <tt><a 
href="symbols.html#x187-2604054r54">-</a></tt> связана
с этой формой. Это значение, которое получит переменная <tt><a 
href="symbols.html#x187-2604051r51">+</a></tt> на следующей
итерации цикла.
</div>
<div class="defun">
<!--l. 645--><p class="noindent" ><div class="defunheader"> <i>[Переменная]</i><a 
 id="dx133-1531009"></a><a 
 id="x133-1531010r594"></a> <b>*</b><br />
<i>
[Переменная]</i><a 
 id="dx133-1531011"></a><a 
 id="x133-1531012r595"></a> <b>**</b><br />
<i>
[Переменная]</i><a 
 id="dx133-1531013"></a><a 
 id="x133-1531014r596"></a> <b>***</b>
</div>
<!--l. 650--><p class="indent" >   Во время вычисления формы в цикле взаимодействия, переменная <tt><a 
href="symbols.html#x187-2604002r2">*</a></tt>
связана с результатом выполнения предыдущей формы, то есть значения
формы, которая хранится в <tt><a 
href="symbols.html#x187-2604051r51">+</a></tt>. Если результат той формы содержал
несколько значений, в <tt><a 
href="symbols.html#x187-2604002r2">*</a></tt> будет только первое. Если было возвращено ноль
значений, <tt><a 
href="symbols.html#x187-2604002r2">*</a></tt> будет содержать <tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt>. Переменная <tt><a 
href="symbols.html#x187-2604003r3">**</a></tt> хранит предыдущее
значение относительно <tt><a 
href="symbols.html#x187-2604002r2">*</a></tt>. То есть, результат вычисления формы из <tt><a 
href="symbols.html#x187-2604003r3">**</a></tt>. <tt><a 
href="symbols.html#x187-2604004r4">***</a></tt>
хранит предыдущее значение относительно <tt><a 
href="symbols.html#x187-2604004r4">***</a></tt>.
<!--l. 659--><p class="indent" >   Если выполнение <tt><a 
href="symbols.html#x187-2604051r51">+</a></tt> было по каким-то причинам прервано, тогда значения
<tt><a 
href="symbols.html#x187-2604002r2">*</a></tt>, <tt><a 
href="symbols.html#x187-2604003r3">**</a></tt> и <tt><a 
href="symbols.html#x187-2604004r4">***</a></tt> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
</div>
<div class="defun">
<!--l. 665--><p class="noindent" ><div class="defunheader"> <i>[Переменная]</i><a 
 id="dx133-1531015"></a><a 
 id="x133-1531016r597"></a> <b>/</b><br />
<i>
                                                                          

                                                                          
[Переменная]</i><a 
 id="dx133-1531017"></a><a 
 id="x133-1531018r598"></a> <b>//</b><br />
<i>
[Переменная]</i><a 
 id="dx133-1531019"></a><a 
 id="x133-1531020r599"></a> <b>///</b>
</div>
<!--l. 670--><p class="indent" >   Во время вычисления формы в цикле взаимодействия, переменная <tt><a 
href="symbols.html#x187-2604055r55">/</a></tt>
связана со списком результатов выведенных на предыдущей итерации. То
есть это список всех значений выполнения формы <tt><a 
href="symbols.html#x187-2604051r51">+</a></tt>. Значение <tt><a 
href="symbols.html#x187-2604002r2">*</a></tt> должно
всегда совпадать со значением <i>car</i> элемента значения <tt><a 
href="symbols.html#x187-2604055r55">/</a></tt>. Переменная <tt><a 
href="symbols.html#x187-2604056r56">//</a></tt>
хранит предыдущий список значений относительно <tt><a 
href="symbols.html#x187-2604055r55">/</a></tt> (то есть, результат
вычисленный две итерации назад), и <tt><a 
href="symbols.html#x187-2604057r57">///</a></tt> содержит предыдущий список
значений относительно <tt><a 
href="symbols.html#x187-2604057r57">///</a></tt>. Таким образом, значение <tt><a 
href="symbols.html#x187-2604003r3">**</a></tt> должно всегда
совпадать со значением <i>car</i> элемента списка <tt><a 
href="symbols.html#x187-2604056r56">//</a></tt>, а <tt><a 
href="symbols.html#x187-2604004r4">***</a></tt> с с <i>car</i> элементом
<tt><a 
href="symbols.html#x187-2604057r57">///</a></tt>.
<!--l. 681--><p class="indent" >   Если выполнение <tt><a 
href="symbols.html#x187-2604051r51">+</a></tt> было по каким-то причинам прервано, тогда значения
<tt><a 
href="symbols.html#x187-2604055r55">/</a></tt>, <tt><a 
href="symbols.html#x187-2604056r56">//</a></tt> и <tt><a 
href="symbols.html#x187-2604057r57">///</a></tt> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
</div>
<!--l. 687--><p class="indent" >   В качестве примера работы с этими переменным, рассмотрим следующую
возможную работу с системой, где <tt><a 
href="symbols.html#x187-2604062r62">&#x003E;</a></tt> приглашение ввода: <div class="lisp"><div class="tabbing">
&#x003E;(cons - -)                      ;Итерация 1
   <br>                                       ((CONS - -) CONS - -)      ;Очаровашка?<br>
<br>                                  &#x003E;(values)                        ;Итерация 2<br>
                                ;Ничего не выводится<br>
&#x003E;(cons &#x2019;a &#x2019;b)                    ;Итерация 3<br>
(A . B)                           ;Это одно значение<br>
<br>                                  &#x003E;(hairy-loop)̂G               ;Итерация 4<br>
### QUIT to top level.    ;(Пользователь прервал вычисления.)<br>
<br>                                  &#x003E;(ﬂoor 13 4)                    ;Итерация 5<br>
3                                   ;Вернулось два значения<br>                    1<br>
<!--l. 705--><p class="noindent" ></div>
<!--l. 705--><p class="noindent" ><span class="paragraphHead"><a 
href="#x133-153200020.2" id="x133-153200020.2"></a></span>
                                                                          

                                                                          
<!--l. 705--><p class="noindent" ><span class="paragraphHead"><a 
href="#x133-153300020.2" id="x133-153300020.2"></a></span>
</div>
<!--l. 706--><p class="indent" >   В этой точке мы имеем: <div class="lisp"><div class="tabbing">
<!--tex4ht:inline--><div class="tabular"><table width="100%" class="tabular"><tr><td align="left" >+++ <span class="math"> ⇒</span> (cons &#x2019;a &#x2019;b) </td><td align="left" >*** <span class="math"> ⇒</span> NIL   </td><td align="left" >/// <span class="math"> ⇒</span> ()        </td>
</tr><tr><td align="left" >++ <span class="math"> ⇒</span> (hairy-loop)   </td><td align="left" >** <span class="math"> ⇒</span> (A . B)</td><td align="left" >// <span class="math"> ⇒</span> ((A . B))</td>
</tr><tr><td align="left" >+ <span class="math"> ⇒</span> (ﬂoor 13 4)      </td><td align="left" >* <span class="math"> ⇒</span> 3          </td><td align="left" >/ <span class="math"> ⇒</span> (3 1)       </td></tr></table>                      </div>
   <br>
<!--l. 713--><p class="noindent" ></div>
<!--l. 713--><p class="noindent" ><span class="paragraphHead"><a 
href="#x133-153400020.2" id="x133-153400020.2"></a></span>
<!--l. 713--><p class="noindent" ><span class="paragraphHead"><a 
href="#x133-153500020.2" id="x133-153500020.2"></a></span>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
<!--l. 645--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="stream.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html#tailclmse107.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse108.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="eval.html#clmse108.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse108.html"></a>   </div> </div> 
</body></html> 
