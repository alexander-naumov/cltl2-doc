<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Объединение, отображение и приведение последовательностей</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 1713--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse80.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse78.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse78.html#tailclmse78.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse79.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="kseque.html#clmse79.html" >Наверх</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">14.2   </span> <a 
href="clm.html#QQ2-98-1208" id="x98-117800014.2">Объединение,
отображение и приведение последовательностей</a></h3>
<!--l. 1715--><p class="noindent" >Функции в этом разделе могут обрабатывать произвольное количество
последовательностей за исключением функции <tt><a 
href="symbols.html#x185-2605731r731">reduce</a></tt>, которая была
включена сюда из-за концептуальной связи с функциями отображения.
<div class="defun">
<!--l. 1719--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx98-1178001"></a><a 
 id="x98-1178002r375"></a> <b>concatenate</b>  <i>result-type</i> <b>&#x0026;rest</b>  <i>sequences</i>
</div>
<!--l. 1722--><p class="indent" >   Результатом является новая последовательность, которая содержит по
порядку все элементы указанных последовательностей. Результат не
содержит связей с аргументами (в этом <tt><a 
href="symbols.html#x185-2605243r243">concatenate</a></tt> отличается от <tt><a 
href="symbols.html#x185-2605079r79">append</a></tt>).
Тип результата указывается в аргументе <i>result-type</i>, который должен быть
подтипом <tt>sequence</tt>, как для функции <tt><a 
href="symbols.html#x185-2605227r227">coerce</a></tt>. Необходимо, чтобы
элементы исходных последовательностей принадлежали указанному типу
<i>result-type</i>.
<!--l. 1730--><p class="indent" >   Если указана только одна последовательность, и она имеет тот же тип,
что указан в <i>result-type</i>, <tt><a 
href="symbols.html#x185-2605243r243">concatenate</a></tt> всё равно копирует аргумент и
возвращает новую последовательность. Если вам не требуется копия, а
просто необходимо преобразовать тип последовательности, лучше
использовать <tt><a 
href="symbols.html#x185-2605227r227">coerce</a></tt>.
<div class="newer">
<!--l. 1737--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx98-1178003"></a>to specify that <tt><a 
href="symbols.html#x185-2605243r243">concatenate</a></tt> should signal an error
if the sequence type speciﬁes the number of elements and the sum of the argument
lengths is diﬀerent.
</div>
</div>
<div class="defun">
<!--l. 1743--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx98-1178004"></a><a 
 id="x98-1178005r376"></a> <b>map</b>  <i>result-type</i> <i>function</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i>
</div>
<!--l. 1746--><p class="indent" >   Функция <i>function</i> должна принимать только аргументов, сколько
                                                                          

                                                                          
последовательностей было передано в <tt><a 
href="symbols.html#x185-2605556r556">map</a></tt>. Результат функции <tt><a 
href="symbols.html#x185-2605556r556">map</a></tt>
— последовательность, элементы которой являются результатами
применения функции <i>function</i> к соответствующим элементам исходных
последовательностей. Длина итоговой последовательности равна длине самой
короткой исходной.
<!--l. 1753--><p class="indent" >   Если функция <i>function</i> имеет побочные эффекты, она может рассчитывать
на то, что сначала будет вызвана со всеми элементами в <tt>0</tt>-ой позиции, затем
со всеми в <tt>1</tt>-ой и так далее.
<!--l. 1757--><p class="indent" >   Тип итоговой последовательности указывается в аргументе <i>result-type</i> (и
должен быть подтипом <tt>sequence</tt>). Кроме того, для типа можно указать <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>,
и это означает, что результата быть не должно. В таком случае функция
<i>function</i> вызывается только для побочных эффектов, и <tt><a 
href="symbols.html#x185-2605556r556">map</a></tt> возвращает <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>. В
этом случае <tt><a 
href="symbols.html#x185-2605556r556">map</a></tt> похожа на <tt><a 
href="symbols.html#x185-2605558r558">mapc</a></tt>.
<div class="newer">
<!--l. 1765--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx98-1178006"></a>to specify that <tt><a 
href="symbols.html#x185-2605556r556">map</a></tt> should signal an error if the
sequence type speciﬁes the number of elements and the minimum of the argument
lengths is diﬀerent.
</div>
<div class="new">
<!--l. 1771--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx98-1178007"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6500007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<!--l. 1776--><p class="indent" >   Например: <div class="lisp"><div class="tabbing">
(map &#x2019;list #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (-1 -2 -3 -4)
   <br>                                                                               (map &#x2019;string<br>
     #&#x2019;(lambda (x) (if (oddp x) #\1 #\0))<br>                    &#x2019;(1 2 3 4))<br>
   <span class="math"> ⇒</span> &#x0022;1010&#x0022;<br>
<!--l. 1783--><p class="noindent" ></div>
<!--l. 1783--><p class="noindent" ><span class="paragraphHead"><a 
href="#x98-117900014.2" id="x98-117900014.2"></a></span>
<!--l. 1783--><p class="noindent" ><span class="paragraphHead"><a 
href="#x98-118000014.2" id="x98-118000014.2"></a></span>
</div>
</div>
                                                                          

                                                                          
<div class="defun">
<!--l. 1787--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx98-1180001"></a><a 
 id="x98-1180002r377"></a> <b>map-into</b>  <i>result-sequence</i> <i>function</i> <b>&#x0026;rest</b>  <i>sequences</i>
</div>
<!--l. 1790--><p class="indent" >   Функция <tt><a 
href="symbols.html#x185-2605557r557">map-into</a></tt> вычисляет последовательность с помощью применения
функции <i>function</i> к соответствующим элементам исходных последовательностей
и помещает результат в последовательность <i>result-sequence</i>. Функция
возвращается <i>result-sequence</i>.
<!--l. 1795--><p class="indent" >   Аргументы <i>result-sequence</i> и все <i>sequences</i> должны быть списками или
векторами (одномерными массивами). Функция <i>function</i> должна принимать
столько аргументов, сколько было указано исходных последовательностей.
Если <i>result-sequence</i> и другие аргументы <i>sequences</i> не одинаковой длины, цикл
закончится на самой короткой последовательности. Если <i>result-sequence</i>
является вектором с указателем заполнения, то этот указатель во время
цикла игнорируется, а после завершения устанавливается на то количество
элементов, которые были получены от функции <i>function</i>.
<!--l. 1805--><p class="indent" >   Если функция <i>function</i> имеет побочные эффекты, она может рассчитывать
на то, что сначала будет вызвана со всеми элементами в <tt>0</tt>-ой позиции, затем
со всеми в <tt>1</tt>-ой и так далее.
<!--l. 1809--><p class="indent" >   Функция <tt><a 
href="symbols.html#x185-2605557r557">map-into</a></tt> отличается от <tt><a 
href="symbols.html#x185-2605556r556">map</a></tt> тем, что модифицирует уже
имеющуюся последовательность, а не создаёт новую. Кроме того, <tt><a 
href="symbols.html#x185-2605557r557">map-into</a></tt>
может быть вызвана только с двумя аргументами (<i>result-sequence</i> и <i>function</i>),
тогда как <tt><a 
href="symbols.html#x185-2605556r556">map</a></tt> требует как минимум три параметра.
<!--l. 1814--><p class="indent" >   Если <i>result-sequence</i> является <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>, <tt><a 
href="symbols.html#x185-2605557r557">map-into</a></tt> немедленно возвращает <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>,
потому что длина <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt> последовательности равняется нулю.
</div>
<div class="defun">
<!--l. 1820--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx98-1180003"></a><a 
 id="x98-1180004r378"></a> <b>some</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i><br />
<i>
[Функция]</i><a 
 id="dx98-1180005"></a><a 
 id="x98-1180006r379"></a> <b>every</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i><br />
<i>
[Функция]</i><a 
 id="dx98-1180007"></a><a 
 id="x98-1180008r380"></a> <b>notany</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i><br />
<i>
[Функция]</i><a 
 id="dx98-1180009"></a><a 
 id="x98-1180010r381"></a> <b>notevery</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i>
</div>
<!--l. 1826--><p class="indent" >   Всё это предикаты. Функция <i>predicate</i> должна принимать столько
                                                                          

                                                                          
аргументов, сколько было указано последовательностей. Функция <i>predicate</i>
сначала применяется к элементам <tt>0</tt>-ой позиции, затем, возможно, к
элементам <tt>1</tt>-ой позиции, и так далее, до тех пор пока не сработает условие
завершения цикла или не закончится одна из последовательностей
<i>sequences</i>.
<!--l. 1833--><p class="indent" >   Если <i>predicate</i> имеет побочные эффекты, он может рассчитывать на то,
что сначала будет вызвана со всеми элементами в <tt>0</tt>-ой позиции, затем со
всеми в <tt>1</tt>-ой и так далее.
<tt>
<!--l. 1837--><p class="indent" >   <a 
href="symbols.html#x185-2605813r813">some</a></tt> завершается, как только применение <i>predicate</i> вернёт не-<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>
значение. Тогда <tt><a 
href="symbols.html#x185-2605813r813">some</a></tt> возвращает значение, на котором произошла остановка.
Если цикл достиг конца последовательности и ни одно применение <i>predicate</i>
не вернуло не-<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>, тогда возвращается значение <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>. Таким образом, можно
сказать, что предикат <tt><a 
href="symbols.html#x185-2605813r813">some</a></tt> истинен, если <i>какой-либо (some)</i> вызов <i>predicate</i>
истинен.
<tt>
<!--l. 1844--><p class="indent" >   <a 
href="symbols.html#x185-2605347r347">every</a></tt> возвращает <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>, как только применение <i>predicate</i> возвращает <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>.
Если цикл достиг конца последовательности, <tt><a 
href="symbols.html#x185-2605347r347">every</a></tt> возвращает не-<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>.
Таким образом, можно сказать, что предикат <tt><a 
href="symbols.html#x185-2605347r347">every</a></tt> истинен, если <i>каждый
(every)</i> вызов <i>predicate</i> истинен.
<tt>
<!--l. 1850--><p class="indent" >   <a 
href="symbols.html#x185-2605616r616">notany</a></tt> возвращает <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>, как только применение <i>predicate</i> возвращает
не-<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>. Если цикл достиг конца последовательности, <tt><a 
href="symbols.html#x185-2605616r616">notany</a></tt> возвращает
не-<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>. Таким образом, можно сказать, что предикат <tt><a 
href="symbols.html#x185-2605616r616">notany</a></tt> истинен, если <i>ни
какой (notany)</i> вызов <i>predicate</i> не истинен.
<tt>
<!--l. 1856--><p class="indent" >   <a 
href="symbols.html#x185-2605617r617">notevery</a></tt> возвращает не-<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>, как только применение <i>predicate</i> возвращает
<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>. Если цикл достиг конца последовательности, <tt><a 
href="symbols.html#x185-2605617r617">notevery</a></tt> возвращает <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>.
Таким образом, можно сказать, что предикат <tt><a 
href="symbols.html#x185-2605617r617">notevery</a></tt> истинен, если <i>ни
каждый (notany)</i> вызов <i>predicate</i> истинен.
<div class="new">
<!--l. 1863--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx98-1180011"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6500007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class="defun">
<!--l. 1869--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx98-1180012"></a><a 
 id="x98-1180013r382"></a> <b>reduce</b>  <i>function</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:start</i> <i>:end</i>
                                                                          

                                                                          
<i>:initial-value</i>
</div>
<!--l. 1872--><p class="indent" >   Функция <tt><a 
href="symbols.html#x185-2605731r731">reduce</a></tt> объединяет все элементы последовательности использую
заданную (бинарную binary) операцию. Например <tt><a 
href="symbols.html#x185-2605051r51">+</a></tt> может суммировать все
элементы последовательности.
<!--l. 1876--><p class="indent" >   Указанная подпоследовательность последовательности <i>sequence</i>
объединяется или «редуцируется» с помощью функции <i>function</i>, которая
должна принимать два аргумента. Приведение (редуцирование, объединение)
является левоассоциативным, если только <tt>:from-end</tt> не содержит истину, в
последнем случае операция становиться правоассоциативной. По-умолчанию
<tt>:from-end</tt> равно <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>. Если задан аргумент <tt>:initial-value</tt>, то он логически
помещается перед подпоследовательностью (или после в случае истинности
<tt>:from-end</tt>) и включается в операцию редуцирования.
<!--l. 1886--><p class="indent" >   Если указанная подпоследовательность содержит только один
элемент и параметр <tt>:initial-value</tt> не задан, тогда этот элемент
возвращается, и функция <i>function</i> ни разу не вызывается. Если заданная
подпоследовательность пуста, и задан параметр <tt>:initial-value</tt>, тогда
возвращается <tt>:initial-value</tt>, и функция <i>function</i> не вызывается.
<!--l. 1892--><p class="indent" >   Если заданная подпоследовательность пуста, и параметр <tt>:initial-value</tt>
не задан, тогда функция <i>function</i> вызывается без аргументов, и <tt><a 
href="symbols.html#x185-2605731r731">reduce</a></tt>
возвращает то, что вернула эта функция. Это единственное исключение из
правила о том, что функция <i>function</i> вызывается с двумя аргументами.
<div class="lisp">
<!--l. 1897--><p class="indent" >   <div class="tabbing">
(reduce #&#x2019;+ &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> 10
   <br>                             (reduce #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ≡</span> (- (- (- 1 2) 3) 4) <span class="math"> ⇒</span> -8<br>
(reduce #&#x2019;- &#x2019;(1 2 3 4) :from-end t)     ;Альтернативная сумма<br>
   <span class="math"> ≡</span> (- 1 (- 2 (- 3 4))) <span class="math"> ⇒</span> -2<br>
(reduce #&#x2019;+ &#x2019;()) <span class="math"> ⇒</span> 0<br>                             (reduce #&#x2019;+ &#x2019;(3)) <span class="math"> ⇒</span> 3<br>
(reduce #&#x2019;+ &#x2019;(foo)) <span class="math"> ⇒</span> foo<br>      (reduce #&#x2019;list &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (((1 2) 3) 4)<br>
(reduce #&#x2019;list &#x2019;(1 2 3 4) :from-end t) <span class="math"> ⇒</span> (1 (2 (3 4)))<br>
(reduce #&#x2019;list &#x2019;(1 2 3 4) :initial-value &#x2019;foo)<br>           <span class="math"> ⇒</span> ((((foo 1) 2) 3) 4)<br>
(reduce #&#x2019;list &#x2019;(1 2 3 4)<br>                    :from-end t :initial-value &#x2019;foo)<br>
   <span class="math"> ⇒</span> (1 (2 (3 (4 foo))))<br>
<!--l. 1912--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 1912--><p class="noindent" ><span class="paragraphHead"><a 
href="#x98-118100014.2" id="x98-118100014.2"></a></span>
<!--l. 1912--><p class="noindent" ><span class="paragraphHead"><a 
href="#x98-118200014.2" id="x98-118200014.2"></a></span>
</div>
<!--l. 1913--><p class="indent" >   Если функция <i>function</i> имеет побочные эффекта, можно положится на
порядок вызовов функции так, как было продемонстрировано выше.
<!--l. 1916--><p class="indent" >   Имя «reduce» было позаимствовано из APL.
<div class="new">
<!--l. 1919--><p class="indent" >   X3J13 voted in March 1988 <a 
 id="dx98-1182001"></a>to extend the <tt><a 
href="symbols.html#x185-2605731r731">reduce</a></tt> function to take
an additional keyword argument named <tt>:key</tt>. As usual, this argument
defaults to the identity function. The value of this argument must be a
function that accepts at least one argument. This function is applied once
to each element of the sequence that is to participate in the reduction
operation, in the order implied by the <tt>:from-end</tt> argument; the values
returned by this function are combined by the reduction <i>function</i>. However,
the <tt>:key</tt> function is <i>not</i> applied to the <tt>:initial-value</tt> argument (if
any).
</div>
<div class="new">
<!--l. 1933--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx98-1182002"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6500007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
                                                                          

                                                                          
<!--l. 1939--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse80.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse78.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse78.html#tailclmse78.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse79.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="kseque.html#clmse79.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse79.html"></a>   </div> </div> 
</body></html> 
