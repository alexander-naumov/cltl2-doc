<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>End-Test Control</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 1016--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse132.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse130.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse130.html#tailclmse130.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse131.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="loop.html#clmse131.html" >Наверх</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">25.7   </span> <a 
href="clm.html#QQ2-161-2095" id="x161-205200025.7">End-Test
Control</a></h3>
<!--l. 1019--><p class="noindent" >The loop keywords <tt><a 
href="symbols.html#x185-2605077r77">always</a></tt>, <tt><a 
href="symbols.html#x185-2605607r607">never</a></tt>, <tt><a 
href="symbols.html#x185-2605879r879">thereis</a></tt>, <tt><a 
href="symbols.html#x185-2605904r904">until</a></tt>, and <tt><a 
href="symbols.html#x185-2605928r928">while</a></tt> designate
constructs that use a single test condition to determine when loop iteration should
terminate.
<!--l. 1023--><p class="indent" >   The constructs <tt><a 
href="symbols.html#x185-2605077r77">always</a></tt>, <tt><a 
href="symbols.html#x185-2605607r607">never</a></tt>, and <tt><a 
href="symbols.html#x185-2605879r879">thereis</a></tt> provide speciﬁc values to be
returned when a loop terminates. Using <tt><a 
href="symbols.html#x185-2605077r77">always</a></tt>, <tt><a 
href="symbols.html#x185-2605607r607">never</a></tt>, or <tt><a 
href="symbols.html#x185-2605879r879">thereis</a></tt> with
value-returning accumulation clauses can produce unpredictable results.
In all other respects these constructs behave like the <tt><a 
href="symbols.html#x185-2605928r928">while</a></tt> and <tt><a 
href="symbols.html#x185-2605904r904">until</a></tt>
constructs.
<!--l. 1030--><p class="indent" >   The macro <tt><a 
href="symbols.html#x185-2605523r523">loop-finish</a></tt> can be used at any time to cause normal termination.
In normal termination, <tt><a 
href="symbols.html#x185-2605367r367">finally</a></tt> clauses are executed and default return values are
returned.
<!--l. 1034--><p class="indent" >   End-test control constructs can be used anywhere within the loop
body. The termination conditions are tested in the order in which they
appear.
<div class="defloop">
<div class="defmacheader">
<!--l. 1039--><p class="indent" >   <div class="tabbing">
 <i>[Выражение цикла]</i> <b>while</b> <a 
 id="dx161-2052001"></a><a 
 id="x161-2052002r802"></a> expr
   <br>
<!--l. 1039--><p class="noindent" ></div>
<!--l. 1039--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-205300025.7" id="x161-205300025.7"></a></span>
</div>
<div class="defmacheader">
<!--l. 1039--><p class="indent" >   <div class="tabbing">
 <i>[Выражение цикла]</i> <b>until</b> <a 
 id="dx161-2053001"></a><a 
 id="x161-2053002r803"></a> expr
   <br>
                                                                          

                                                                          
<!--l. 1041--><p class="noindent" ></div>
<!--l. 1041--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-205400025.7" id="x161-205400025.7"></a></span>
</div>
<!--l. 1042--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2605928r928">while</a></tt> construct allows iteration to continue until the speciﬁed expression
<i>expr</i> evaluates to <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>. The expression is re-evaluated at the location of the <tt><a 
href="symbols.html#x185-2605928r928">while</a></tt>
clause.
<!--l. 1046--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2605904r904">until</a></tt> construct is equivalent to <tt><a 
href="symbols.html#x185-2605928r928">while</a></tt> (<tt><a 
href="symbols.html#x185-2605615r615">not</a></tt> <i>expr</i>). If the value of the
speciﬁed expression is non-<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>, iteration terminates.
<!--l. 1050--><p class="indent" >   You can use <tt><a 
href="symbols.html#x185-2605928r928">while</a></tt> and <tt><a 
href="symbols.html#x185-2605904r904">until</a></tt> at any point in a loop. If a <tt><a 
href="symbols.html#x185-2605928r928">while</a></tt> or <tt><a 
href="symbols.html#x185-2605904r904">until</a></tt>
clause causes termination, any clauses that precede it in the source are still
evaluated.
<!--l. 1055--><p class="indent" >   Examples: <div class="lisp"><div class="tabbing">
;;; A classic &#x0022;while-loop&#x0022;.
   <br>                                                     (loop while (hungry-p) do (eat))<br>
<br>                                  ;;; UNTIL NOT is equivalent to WHILE.<br>
(loop until (not (hungry-p)) do (eat))<br>                                     <br>
;;; Collect the length and the items of STACK.<br>   (let ((stack &#x2019;(a b c d e f)))<br>
  (loop while stack<br>            for item = (length stack) then (pop stack)<br>
        collect item))<br>                              <span class="math"> ⇒</span> (6 A B C D E F)<br>
<br>                ;;; Use WHILE to terminate a loop that otherwise wouldn&#x2019;t<br>
;;; terminate. Note that WHILE occurs after the WHEN.<br>
(loop for i ﬁxnum from 3<br>      when (oddp i) collect i<br>      while (&#x003C; i 5))<br>
   <span class="math"> ⇒</span> (3 5)<br>
<!--l. 1076--><p class="noindent" ></div>
<!--l. 1076--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-205500025.7" id="x161-205500025.7"></a></span>
<!--l. 1076--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-205600025.7" id="x161-205600025.7"></a></span>
</div>
</div>
<div class="defloop">
<div class="defmacheader">
                                                                          

                                                                          
<!--l. 1081--><p class="indent" >   <div class="tabbing">
 <i>[Выражение цикла]</i> <b>always</b> <a 
 id="dx161-2056001"></a><a 
 id="x161-2056002r804"></a> expr
   <br>
<!--l. 1081--><p class="noindent" ></div>
<!--l. 1081--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-205700025.7" id="x161-205700025.7"></a></span>
</div>
<div class="defmacheader">
<!--l. 1081--><p class="indent" >   <div class="tabbing">
 <i>[Выражение цикла]</i> <b>never</b> <a 
 id="dx161-2057001"></a><a 
 id="x161-2057002r805"></a> expr
   <br>
<!--l. 1082--><p class="noindent" ></div>
<!--l. 1082--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-205800025.7" id="x161-205800025.7"></a></span>
</div>
<div class="defmacheader">
<!--l. 1082--><p class="indent" >   <div class="tabbing">
 <i>[Выражение цикла]</i> <b>thereis</b> <a 
 id="dx161-2058001"></a><a 
 id="x161-2058002r806"></a> expr
   <br>
<!--l. 1084--><p class="noindent" ></div>
<!--l. 1084--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-205900025.7" id="x161-205900025.7"></a></span>
</div>
<!--l. 1085--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2605077r77">always</a></tt> construct takes one form and terminates the loop if the form ever
evaluates to <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>; in this case, it returns <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>. Otherwise, it provides a default
return value of <tt><a 
href="symbols.html#x185-2605871r871">t</a></tt>.
<!--l. 1089--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2605607r607">never</a></tt> construct takes one form and terminates the loop if the form ever
evaluates to non-<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>; in this case, it returns <tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>. Otherwise, it provides a default
return value of <tt><a 
href="symbols.html#x185-2605871r871">t</a></tt>.
<!--l. 1093--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2605879r879">thereis</a></tt> construct takes one form and terminates the loop if the form
ever evaluates to non-<tt><a 
href="symbols.html#x185-2605609r609">nil</a></tt>; in this case, it returns that value.
                                                                          

                                                                          
<!--l. 1097--><p class="indent" >   If the <tt><a 
href="symbols.html#x185-2605928r928">while</a></tt> or <tt><a 
href="symbols.html#x185-2605904r904">until</a></tt> construct causes termination, control is passed to the
loop epilogue, where any <tt><a 
href="symbols.html#x185-2605367r367">finally</a></tt> clauses will be executed. Since <tt><a 
href="symbols.html#x185-2605077r77">always</a></tt>, <tt><a 
href="symbols.html#x185-2605607r607">never</a></tt>,
and <tt><a 
href="symbols.html#x185-2605879r879">thereis</a></tt> use the Common Lisp macro <tt><a 
href="symbols.html#x185-2605751r751">return</a></tt> to terminate iteration, any
<tt><a 
href="symbols.html#x185-2605367r367">finally</a></tt> clause that is speciﬁed is not evaluated.
<!--l. 1104--><p class="indent" >   Examples: <div class="lisp"><div class="tabbing">
;;; Make sure I is always less than 11 (two ways).
   <br>                                   ;;; The FOR construct terminates these loops.<br>
<!--l. 1108--><p class="noindent" ></div>
<!--l. 1108--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206000025.7" id="x161-206000025.7"></a></span>
<!--l. 1108--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206100025.7" id="x161-206100025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1109--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>                                                                      always (&#x003C; i 11))<br>
   <span class="math"> ⇒</span> T<br>
<!--l. 1113--><p class="noindent" ></div>
<!--l. 1113--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206200025.7" id="x161-206200025.7"></a></span>
<!--l. 1113--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206300025.7" id="x161-206300025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1114--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
(loop for i from 0 to 10
   <br>                                                                        never (&#x003E; i 11))<br>
   <span class="math"> ⇒</span> T<br>
<!--l. 1118--><p class="noindent" ></div>
<!--l. 1118--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206400025.7" id="x161-206400025.7"></a></span>
<!--l. 1118--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206500025.7" id="x161-206500025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1119--><p class="indent" >   <div class="tabbing">
;;; If I exceeds 10, return I; otherwise, return NIL.
   <br>                               ;;; The THEREIS construct terminates this loop.<br>
<!--l. 1122--><p class="noindent" ></div>
<!--l. 1122--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206600025.7" id="x161-206600025.7"></a></span>
<!--l. 1122--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206700025.7" id="x161-206700025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1123--><p class="indent" >   <div class="tabbing">
(loop for i from 0
   <br>                                                         thereis (when (&#x003E; i 10) i) )<br>
   <span class="math"> ⇒</span> 11<br>
<!--l. 1127--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 1127--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206800025.7" id="x161-206800025.7"></a></span>
<!--l. 1127--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-206900025.7" id="x161-206900025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1128--><p class="indent" >   <div class="tabbing">
;;; The FINALLY clause is not evaluated in these examples.
   <br>
<!--l. 1130--><p class="noindent" ></div>
<!--l. 1130--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207000025.7" id="x161-207000025.7"></a></span>
<!--l. 1130--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207100025.7" id="x161-207100025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1131--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>           always (&#x003C; i 9)<br>           ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> NIL<br>
<!--l. 1136--><p class="noindent" ></div>
<!--l. 1136--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207200025.7" id="x161-207200025.7"></a></span>
<!--l. 1136--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207300025.7" id="x161-207300025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1137--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
(loop never t
   <br>                                             ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> NIL<br>
<!--l. 1141--><p class="noindent" ></div>
<!--l. 1141--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207400025.7" id="x161-207400025.7"></a></span>
<!--l. 1141--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207500025.7" id="x161-207500025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1142--><p class="indent" >   <div class="tabbing">
(loop thereis &#x0022;Here is my value&#x0022;
   <br>                                             ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> &#x0022;Here is my value&#x0022;<br>
<!--l. 1146--><p class="noindent" ></div>
<!--l. 1146--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207600025.7" id="x161-207600025.7"></a></span>
<!--l. 1146--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207700025.7" id="x161-207700025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1147--><p class="indent" >   <div class="tabbing">
;;; The FOR construct terminates this loop,
   <br>                                           ;;; so the FINALLY clause is evaluated.<br>
<!--l. 1150--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 1150--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207800025.7" id="x161-207800025.7"></a></span>
<!--l. 1150--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-207900025.7" id="x161-207900025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1151--><p class="indent" >   <div class="tabbing">
(loop for i from 1 to 10
   <br>                                                                       thereis (&#x003E; i 11)<br>
      ﬁnally (print i))                                       ;Prints 1 line<br>
11<br>                                                                <span class="math"> ⇒</span> NIL<br>
<!--l. 1157--><p class="noindent" ></div>
<!--l. 1157--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-208000025.7" id="x161-208000025.7"></a></span>
<!--l. 1157--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-208100025.7" id="x161-208100025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1159--><p class="indent" >   <div class="tabbing">
(defstruct mountain height diﬃculty (why &#x0022;because it is there&#x0022;))
   <br>                   (setq everest (make-mountain :height &#x2019;(2.86e-13 parsecs)))<br>
(setq chocorua (make-mountain :height &#x2019;(1059180001 microns)))<br>
(defstruct desert area (humidity 0))<br>(setq sahara (make-desert :area &#x2019;(212480000 square furlongs)))<br>
       ;First there is a mountain, then there is no mountain, then there is <span class="math">…</span><br>
(loop for x in (list everest sahara chocorua)                        ; —GLS<br>
      thereis (and (mountain-p x) (mountain-height x)))<br>
   <span class="math"> ⇒</span> (2.86E-13 PARSECS)<br>                                             <br>
;;; If you could use this code to ﬁnd a counterexample to<br>
;;; Fermat&#x2019;s last theorem, it would still not return the value<br>
;;; of the counterexample because all of the THEREIS clauses<br>
                                                                          

                                                                          
;;; in this example return only T.   Of course, this code has<br>
;;; never been observed to terminate.<br>                                      <br>
(loop for z upfrom 2<br>                                               thereis<br>
        (loop for n upfrom 3 below (log z 2)<br>                    thereis<br>
                (loop for x below z<br>                          thereis<br>
                        (loop for y below z<br>
                              thereis (= (+ (expt x n)<br>
                                            (expt y n))<br>
                                         (expt z n))))))<br>
<!--l. 1186--><p class="noindent" ></div>
<!--l. 1186--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-208200025.7" id="x161-208200025.7"></a></span>
<!--l. 1186--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-208300025.7" id="x161-208300025.7"></a></span>
</div>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 1190--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i> <b>loop-ﬁnish</b> <a 
 id="dx161-2083001"></a><a 
 id="x161-2083002r807"></a> <tt></tt>
   <br>
<!--l. 1191--><p class="noindent" ></div>
<!--l. 1191--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-208400025.7" id="x161-208400025.7"></a></span>
</div>
<!--l. 1192--><p class="indent" >   The macro <tt><a 
href="symbols.html#x185-2605523r523">loop-finish</a></tt> terminates iteration normally and returns any
accumulated result. If speciﬁed, a <tt><a 
href="symbols.html#x185-2605367r367">finally</a></tt> clause is evaluated.
<!--l. 1196--><p class="indent" >   In most cases it is not necessary to use <tt><a 
href="symbols.html#x185-2605523r523">loop-finish</a></tt> because other loop
control clauses terminate the loop. Use <tt><a 
href="symbols.html#x185-2605523r523">loop-finish</a></tt> to provide a normal exit
from a nested condition inside a loop.
<!--l. 1201--><p class="indent" >   You can use <tt><a 
href="symbols.html#x185-2605523r523">loop-finish</a></tt> inside nested Lisp code to provide a normal exit
from a loop. Since <tt><a 
href="symbols.html#x185-2605523r523">loop-finish</a></tt> transfers control to the loop epilogue, using
<tt><a 
href="symbols.html#x185-2605523r523">loop-finish</a></tt> within a <tt><a 
href="symbols.html#x185-2605367r367">finally</a></tt> expression can cause inﬁnite looping.
                                                                          

                                                                          
<!--l. 1208--><p class="indent" >   Implementations are allowed to provide this construct as a local macro by
using <tt><a 
href="symbols.html#x185-2605532r532">macrolet</a></tt>.
<!--l. 1211--><p class="indent" >   Examples: <div class="lisp"><div class="tabbing">
;;; Print a date in February, but exclude leap day.
   <br>
;;; LOOP-FINISH exits from the nested condition.<br>(loop for date in date-list<br>
      do (case date<br>                     (29 (when (eq month &#x2019;february)<br>
                     (loop-ﬁnish))<br>
             (format t &#x0022;~:@(~A~) ~A&#x0022; month date))))<br>
<br>                  ;;; Terminate the loop, but return the accumulated count.<br>
(loop for i in &#x2019;(1 2 3 stop-here 4 5 6)<br>
      when (symbolp i) do (loop-ﬁnish)<br>           count i)<br>        <span class="math"> ⇒</span> 3<br>
<br>                   ;;; This loop works just as well as the previous example.<br>
(loop for i in &#x2019;(1 2 3 stop-here 4 5 6)<br>      until (symbolp i)<br>      count i)<br>
   <span class="math"> ⇒</span> 3<br>
<!--l. 1232--><p class="noindent" ></div>
<!--l. 1232--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-208500025.7" id="x161-208500025.7"></a></span>
<!--l. 1232--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-208600025.7" id="x161-208600025.7"></a></span>
</div>
</div>
                                                                          

                                                                          
<!--l. 1235--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse132.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse130.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse130.html#tailclmse130.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse131.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="loop.html#clmse131.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse131.html"></a>   </div> </div> 
</body></html> 
