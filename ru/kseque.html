<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>14 Последовательности</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 16:17:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 1336--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse78.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse77.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse77.html#tailclmse77.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailkseque.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clm.html#kseque.html" >Наверх</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h2 class="chapterHead"><span class="titlemark">Глава 14</span><br /><a 
href="clm.html#QQ2-96-1188" id="x96-115800014">Последовательности</a></h2><div class="chapterTOCS">
    <span class="sectionToc" >14.1 <a 
href="clmse78.html#x97-117300014.1">Простые функции для последовательностей</a></span>
<br />    <span class="sectionToc" >14.2 <a 
href="clmse79.html#x98-117800014.2">Объединение, отображение и приведение последовательностей</a></span>
<br />    <span class="sectionToc" >14.3 <a 
href="clmse80.html#x99-118300014.3">Модификация последовательностей</a></span>
<br />    <span class="sectionToc" >14.4 <a 
href="clmse81.html#x100-119800014.4">Поиск элементов последовательностей</a></span>
<br />    <span class="sectionToc" >14.5 <a 
href="clmse82.html#x101-120500014.5">Сортировка и слияние</a></span>
   </div>
<!--l. 1339--><p class="indent" >   Тип <tt>sequence</tt> объединяет списки и вектора (одномерные массивы). Хотя
это две различные структуры данных с различными структурными
свойствами, приводящими к алгоритмически различному использованию, они
имеют общее свойство: каждая хранит упорядоченное множество
элементов.
<!--l. 1344--><p class="indent" >   Некоторые операции полезны и для списков и для массивов, потому что
они взаимодействуют с упорядоченными множествами элементов. Можно
запросить количество элементов, изменить порядок элементов на
противоположный, извлечь подмножество (подпоследовательность) и так
далее. Для таких целей Common Lisp предлагает ряд общих для всех типов
последовательностей функций.
<div class="flushleft" 
>
<!--l. 1350--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%" class="tabular"><tr><td align="left" >elt         </td><td align="left" >reverse      </td><td align="left" >map      </td><td align="left" >remove              </td>
</tr><tr><td align="left" >length    </td><td align="left" >nreverse     </td><td align="left" >some     </td><td align="left" >remove-duplicates</td>
</tr><tr><td align="left" >subseq   </td><td align="left" >concatenate</td><td align="left" >every    </td><td align="left" >delete                </td>
</tr><tr><td align="left" >copy-seq </td><td align="left" >position     </td><td align="left" >notany  </td><td align="left" >delete-duplicates  </td>
</tr><tr><td align="left" >ﬁll         </td><td align="left" >ﬁnd           </td><td align="left" >notevery</td><td align="left" >substitute          </td>
</tr><tr><td align="left" >replace   </td><td align="left" >sort          </td><td align="left" >reduce   </td><td align="left" >nsubstitute         </td>
</tr><tr><td align="left" >count     </td><td align="left" >merge        </td><td align="left" >search   </td><td align="left" >mismatch           </td></tr></table></div></div>
<!--l. 1361--><p class="noindent" >Некоторые из этих операций имеют более одной версии. Такие версии
отличаются суффиксом (или префиксом) от имени базовой функции. Кроме
того, многие операции принимают один или более необязательных
именованных аргументов, которые могут изменить поведение операции.
<!--l. 1366--><p class="indent" >   Если операция требует проверки элементов последовательности на
совпадение с некоторым условием, тогда это условие может быть указано
одним из двух способов. Основная операция принимает объект и сравнивает с
ним каждый элемент последовательности на равенство <tt><a 
href="symbols.html#x187-2604338r338">eql</a></tt>. (Операция
сравнения может быть задана в именованном параметре <tt>:test</tt> или
<tt>:test-not</tt>. Использование обоих параметров одновременно является
                                                                          

                                                                          
ошибкой.) Другие варианты операции образуются с добавлением префиксов
<tt>-if</tt> и <tt>-if-not</tt>. Эти операции, в отличие от базовой, принимают не объект, а
предикат с одним аргументом. В этом случае проверяется истинность или
ложность предиката для каждого элемента последовательности. В качестве
примера, <div class="lisp"><div class="tabbing">
(remove <i>item</i> <i>sequence</i>)
   <br>
<!--l. 1379--><p class="noindent" ></div>
<!--l. 1379--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-115900014" id="x96-115900014"></a></span>
<!--l. 1379--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116000014" id="x96-116000014"></a></span>
</div>
<!--l. 1380--><p class="indent" >   возвращает копию последовательности <i>sequence</i>, в которой удалены все
элементы равные <tt><a 
href="symbols.html#x187-2604338r338">eql</a></tt> объекту <i>emph</i>. <div class="lisp"><div class="tabbing">
(remove <i>item</i> <i>sequence</i> <tt>:test</tt> #&#x2019;equal)
   <br>
<!--l. 1384--><p class="noindent" ></div>
<!--l. 1384--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116100014" id="x96-116100014"></a></span>
<!--l. 1384--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116200014" id="x96-116200014"></a></span>
</div>
<!--l. 1385--><p class="indent" >   возвращает копию последовательности <i>sequence</i>, в которой удалены все
элементы равные <tt><a 
href="symbols.html#x187-2604339r339">equal</a></tt> объекту <i>emph</i>. <div class="lisp"><div class="tabbing">
(remove-if #&#x2019;numberp <i>sequence</i>)
   <br>
<!--l. 1389--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 1389--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116300014" id="x96-116300014"></a></span>
<!--l. 1389--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116400014" id="x96-116400014"></a></span>
</div>
<!--l. 1390--><p class="indent" >   возвращает копию последовательности <i>sequence</i>, в которой удалены все
числа.
<!--l. 1393--><p class="indent" >   Если операция любым методом проверяет элементы последовательности,
то если именованный параметр <tt>:key</tt> не равняется <tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt>, то он должен быть
функцией одного аргумента, которая будет извлекать из элемента
необходимую для проверки часть. Например, <div class="lisp"><div class="tabbing">
(ﬁnd <i>item</i> <i>sequence</i> <tt>:test</tt> #&#x2019;eq <tt>:key</tt> #&#x2019;car)
   <br>
<!--l. 1400--><p class="noindent" ></div>
<!--l. 1400--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116500014" id="x96-116500014"></a></span>
<!--l. 1400--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116600014" id="x96-116600014"></a></span>
</div>
<!--l. 1401--><p class="indent" >   Это выражение ищет первый элемент последовательности <i>sequence</i>, <i>car</i>
элемент которого равен <tt><a 
href="symbols.html#x187-2604337r337">eq</a></tt> объекту <i>item</i>.
<div class="newer">
<!--l. 1405--><p class="indent" >   X3J13 voted in June 1988 <a 
 id="dx96-1166001"></a>to allow the <tt>:key</tt> function to be only of type
<tt>symbol</tt> or <tt><a 
href="symbols.html#x187-2604399r399">function</a></tt>; a lambda-expression is no longer acceptable as a
functional argument. One must use the <tt><a 
href="symbols.html#x187-2604399r399">function</a></tt> special operator or the
abbreviation <tt>#&#x2019;</tt> before a lambda-expression that appears as an explicit argument
form.
</div>
<!--l. 1412--><p class="indent" >   Для некоторых операций было бы удобно указать направление обработки
последовательности. В этом случае базовые операции обычно обрабатывают
последовательность в прямом направлении. Обратное направление
обработки указывается с помощью не-<tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt> значения для именованного
параметра <tt>:from-end</tt>. (Порядок обработки указываемый в <tt>:from-end</tt>
                                                                          

                                                                          
чисто концептуальный. В зависимости от обрабатываемого объекта и
реализации, действительный порядок обработки может отличаться.
Поэтому пользовательские функции <i>test</i> не должны иметь побочных
эффектов.)
<!--l. 1421--><p class="indent" >   Много операций позволяют указать подпоследовательность для
обработки. Такие операции имеют именованные параметры <tt>:start</tt> и <tt>:end</tt>.
Эти аргумент должны быть индексами внутри последовательности, и
<span class="math"><i>start</i> ≤<i>end</i></span>. Ситуация <span class="math"><i>start</i> &#x003E; <i>end</i></span> является ошибкой. Эти параметры
указывают подпоследовательность начиная с позиции <i>start</i> включительно и
заканчивая позицией <i>end</i> невключительно. Таким образом длина
подпоследовательности равна <span class="math"><i>end</i> −<i>start</i></span>. Если параметр <i>start</i> опущен,
используется значение по-умолчанию ноль. Если параметр <i>end</i> опущен,
используется значение по-умолчанию длина последовательности. В
большинстве случаев, указание подпоследовательности допускается
исключительно ради эффективности. Вместо этого можно было бы
просто вызвать <tt><a 
href="symbols.html#x187-2604846r846">subseq</a></tt>. Однако, следует отметить, что операция,
которая вычисляет индексы для подпоследовательности, возвращает
индексы исходной последовательности, а не подпоследовательности:
<div class="lisp"><div class="tabbing">
(position #\b &#x0022;foobar&#x0022; <tt>:start</tt> 2 <tt>:end</tt> 5) <span class="math"> ⇒</span> 3
   <br>                                      (position #\b (subseq &#x0022;foobar&#x0022; 2 5)) <span class="math"> ⇒</span> 1<br>
<!--l. 1438--><p class="noindent" ></div>
<!--l. 1438--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116700014" id="x96-116700014"></a></span>
<!--l. 1438--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116800014" id="x96-116800014"></a></span>
</div>
<!--l. 1439--><p class="indent" >   Если в операции участвует две последовательности, тогда ключевые
параметры <tt>:start1</tt>, <tt>:end1</tt>, <tt>start2</tt> и <tt>:end2</tt> используются для указания
отдельных подпоследовательностей для каждой последовательности.
<div class="newer">
<!--l. 1444--><p class="indent" >   X3J13 voted in June 1988 <a 
 id="dx96-1168001"></a>(and further clariﬁcation was voted in January
1989 <a 
 id="dx96-1168002"></a>) to specify that these rules apply not only to all built-in functions
                                                                          

                                                                          
that have keyword parameters named <tt>:start</tt>, <tt>:start1</tt>, <tt>:start2</tt>, <tt>:end</tt>,
<tt>:end1</tt>, or <tt>:end2</tt> but also to functions such as <tt><a 
href="symbols.html#x187-2604846r846">subseq</a></tt> that take required
or optional parameters that are documented as being named <i>start</i> or
<i>end</i>.
      <ul class="itemize1">
      <li class="itemize">A “start” argument must always be a non-negative integer and defaults
      to zero if not supplied; it is not permissible to pass <tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt> as a “start”
      argument.
      </li>
      <li class="itemize">An  “end”  argument  must  be  either  a  non-negative  integer  or  <tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt>
      (which indicates the end of the sequence) and defaults to <tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt> if not
      supplied; therefore supplying <tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt> is equivalent to not supplying such
      an argument.
      </li>
      <li class="itemize">If the “end”  argument is an integer, it must be no greater than the
      active length of the corresponding sequence (as returned by the function
      <tt><a 
href="symbols.html#x187-2604486r486">length</a></tt>).
      </li>
      <li class="itemize">The default value for the “end”  argument is the active length of the
      corresponding sequence.
      </li>
      <li class="itemize">The “start” value (after defaulting, if necessary) must not be greater
      than the corresponding “end” value (after defaulting, if necessary).</li></ul>
<!--l. 1470--><p class="noindent" >This may be summarized as follows. Let <i>x</i> be the sequence within which indices are
to be considered. Let <i>s</i> be the “start” argument for that sequence of any
standard function, whether explicitly speciﬁed or defaulted, through omission,
to zero. Let <i>e</i> be the “end” argument for that sequence of any standard
function, whether explicitly speciﬁed or defaulted, through omission or
an explicitly passed <tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt> value, to the active length of <i>x</i>, as returned by
<tt><a 
href="symbols.html#x187-2604486r486">length</a></tt>. Then it is an error if the test <tt>(&#x003C;= 0 <i>s</i> <i>e</i> (length <i>x</i>))</tt> is not
true.
</div>
<!--l. 1482--><p class="indent" >   Для некоторых функций, в частности <tt><a 
href="symbols.html#x187-2604734r734">remove</a></tt> и <tt><a 
href="symbols.html#x187-2604293r293">delete</a></tt>, ключевой
параметр <tt>:count</tt> используется для указания, как много подходящих
                                                                          

                                                                          
элементов должны обрабатываться. Если он равен <tt><a 
href="symbols.html#x187-2604608r608">nil</a></tt> или не указан,
обрабатываются все подходящие элементы.
<!--l. 1487--><p class="indent" >   В следующих описаниях функций, элемент <i>x</i> последовательности
«удовлетворяет условию», если любое из следующих выражений верно:
      <ul class="itemize1">
      <li class="itemize">Была  вызвана  базовая  функция,  функция  <i>testfn</i>  заданная  в
      параметре  <tt>:test</tt>,  и  выражение  <tt>(funcall <i>testfn</i> <i>item</i> (<i>keyfn</i>
      <i>x</i>))</tt> истинно.
      </li>
      <li class="itemize">Была   вызвана   базовая   функция,   функция   <i>testfn</i>   заданная
      в  параметре  <tt>:test-not</tt>,  и  выражение  <tt>(funcall <i>testfn</i> <i>item</i>
      (<i>keyfn</i> <i>x</i>))</tt> ложно.
      </li>
      <li class="itemize">Была  вызвана  функция  <tt>-if</tt>,  и  выражение  <tt>(funcall <i>predicate</i>
      (<i>keyfn</i> <i>x</i>))</tt> истинно.
      </li>
      <li class="itemize">Была   вызвана   функция   <tt>-if-not</tt>,   и   выражение   <tt>(funcall
      <i>predicate</i> (<i>keyfn</i> <i>x</i>))</tt> ложно</li></ul>
<!--l. 1510--><p class="noindent" >В каждом случае, функция <i>keyfn</i> является значением параметра <tt>:key</tt>
(по-умолчанию функцией эквивалентности). Для примера, смотрите
<tt><a 
href="symbols.html#x187-2604734r734">remove</a></tt>.
<!--l. 1513--><p class="indent" >   В следующих описаниях функций два элемента <i>x</i> и <i>y</i>, взятых из
последовательности, «эквивалентны», если одно из следующих выражений
верно:
      <ul class="itemize1">
      <li class="itemize">Функция <i>testfn</i> указана в параметре <tt>:test</tt>, и выражение <tt>(funcall
      <i>testfn</i> (<i>keyfn</i> <i>x</i>) (<i>keyfn</i> <i>y</i>))</tt> истинно.
      </li>
      <li class="itemize">Функция  <i>testfn</i>  указана  в  параметре  <tt>:test-not</tt>,  и  выражение
      <tt>(funcall <i>testfn</i> (<i>keyfn</i> <i>x</i>) (<i>keyfn</i> <i>y</i>))</tt> ложно.</li></ul>
<!--l. 1529--><p class="noindent" >Для примера, смотрите <tt><a 
href="symbols.html#x187-2604766r766">search</a></tt>.
<div class="newer">
                                                                          

                                                                          
<!--l. 1532--><p class="indent" >   X3J13 voted in June 1988 <a 
 id="dx96-1168003"></a>to allow the <i>testfn</i> or <tt>predicate</tt> to be only of type
<tt>symbol</tt> or <tt><a 
href="symbols.html#x187-2604399r399">function</a></tt>; a lambda-expression is no longer acceptable as a
functional argument. One must use the <tt><a 
href="symbols.html#x187-2604399r399">function</a></tt> special operator or the
abbreviation <tt>#&#x2019;</tt> before a lambda-expression that appears as an explicit argument
form.
</div>
<!--l. 1540--><p class="indent" >   Вы можете рассчитывать на порядок передачи аргументов в функцию
<i>testfn</i>. Это позволяет использовать некоммутативную функцию проверки в
стиле предиката. Порядок аргументов в функцию <i>testfn</i> соответствует
порядку, в котором эти аргументы (или последовательности их содержащие)
были переданы в рассматриваемую функцию. Если рассматриваемая
функция передаёт два элемента из одной последовательности в функцию
<i>testfn</i>, то аргументы передаются в том же порядке, в котором были в
последовательности.
<!--l. 1549--><p class="indent" >   Если функция должна создать и вернуть новый вектор, то она всегда
возвращает <i>простой</i> вектор (смотрите раздел <a 
href="clmse7.html#x14-920002.5">2.5<!--tex4ht:ref: ARRAY-TYPE-SECTION --></a>). Таким же образом, любые
создаваемые строки будут простыми строками.
<div class="defun">
<!--l. 1553--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx96-1168004"></a><a 
 id="x96-1168005r367"></a> <b>complement</b>  <i>fn</i>
</div>
<!--l. 1556--><p class="indent" >   Returns a function whose value is the same as that of <tt><a 
href="symbols.html#x187-2604614r614">not</a></tt> applied to the result
of applying the function <i>fn</i> to the same arguments. One could deﬁne <tt><a 
href="symbols.html#x187-2604238r238">complement</a></tt>
as follows:
<!--l. 1560--><p class="indent" >   Данная функция возвращает другую функцию, значение которой
является <i>отрицанием</i> функции <i>fn</i>. Функцию <tt><a 
href="symbols.html#x187-2604238r238">complement</a></tt> можно было
определить так: <div class="lisp"><div class="tabbing">
(defun complement (fn)
   <br>                                                       #&#x2019;(lambda (&#x0026;rest arguments)<br>
      (not (apply fn arguments))))<br>
<!--l. 1567--><p class="noindent" ></div>
<!--l. 1567--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-116900014" id="x96-116900014"></a></span>
                                                                          

                                                                          
<!--l. 1567--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-117000014" id="x96-117000014"></a></span>
</div>
<!--l. 1569--><p class="indent" >   One intended use of <tt><a 
href="symbols.html#x187-2604238r238">complement</a></tt> is to supplant the use of <tt>:test-not</tt>
arguments and <tt>-if-not</tt> functions.
<!--l. 1572--><p class="indent" >   Можно использовать функцию <tt><a 
href="symbols.html#x187-2604238r238">complement</a></tt> для эмуляции <tt>-if-not</tt>
функций или аргумента <tt>:test-not</tt>. <div class="lisp"><div class="tabbing">
(remove-if-not #&#x2019;virtuous senators) <span class="math"> ≡</span>
   <br>                (remove-if (complement #&#x2019;virtuous) senators)<br>
<br>                                        (remove-duplicates telephone-book<br>
                   :test-not #&#x2019;mismatch) <span class="math"> ≡</span><br>
   (remove-duplicates telephone-book<br>
                      :test (complement #&#x2019;mismatch))<br>
<!--l. 1582--><p class="noindent" ></div>
<!--l. 1582--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-117100014" id="x96-117100014"></a></span>
<!--l. 1582--><p class="noindent" ><span class="paragraphHead"><a 
href="#x96-117200014" id="x96-117200014"></a></span>
</div>
</div>
<!--l. 1585--><p class="noindent" >




                                                                          

                                                                          
   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse78.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse77.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse77.html#tailclmse77.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="kseque.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clm.html#kseque.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailkseque.html"></a>   </div> </div> 
</body></html> 
