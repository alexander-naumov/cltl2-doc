<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Операторы условных переходов</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-13 16:31:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 5928--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse41.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse39.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse39.html#tailclmse39.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse40.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse40.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">7.6   </span> <a 
 id="x52-1060007.6"></a>Операторы условных переходов</h3>
<!--l. 5930--><p class="noindent" >Традиционная условная конструкция в Lisp&#x2019;е это <a 
href="#x52-109002r84">cond</a>. Однако, <a 
href="clmse138.html#x169-343002r840">if</a>
гораздо проще и очень похожа на условные конструкции в других
языках программирования. Она сделана примитивом в Common Lisp&#x2019;е.
Common Lisp также предоставляет конструкции диспетчеризации
(распределения) <a 
href="#x52-110002r85">case</a> и <a 
href="#x52-111002r86">typecase</a>, которые часто более удобны, чем
<a 
href="#x52-109002r84">cond</a>.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> if </b><a 
 id="dx52-106001"></a><a 
 id="x52-106002r81"></a> test then [else]
</td></tr></table>
<!--l. 5938--><p class="indent" >
</div>
<!--l. 5938--><p class="noindent" ><span class="paragraphHead"><a 
 id="x52-1070007.6"></a></span>
   Специальная формы <a 
href="clmse138.html#x169-343002r840">if</a> обозначает то же, что и конструкция <b>if</b>-<b>then</b>-<b>else</b> в
большинстве других языках программирования. Сначала выполняется форма
<i>test</i>. Если резльутат не равен <a 
href="clmse31.html#x42-74002r18">nil</a>, тогда выбирается форма <i>then</i>. Иначе
выбирается форма <i>else</i>. Выбранная ранее форма выполняется, и <a 
href="clmse138.html#x169-343002r840">if</a>
возвращает то, что вернула это форма. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(if <i>test</i> <i>then</i> <i>else</i>)  ≡ (cond (<i>test</i> <i>then</i>) (<a 
href="clmse31.html#x42-74004r19">t</a> <i>else</i>))
</td></tr></table>
<!--l. 5948--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 5949--><p class="noindent" >Но в некоторых ситуациях <a 
href="clmse138.html#x169-343002r840">if</a> оказывается более читабельным.
<!--l. 5951--><p class="indent" >   Форма <i>else</i> может быть опущена. В таком случае, если значение формы
<i>test</i> является <a 
href="clmse31.html#x42-74002r18">nil</a>, тогда ничего не будет выполнено и возвращаемое значение
формы <a 
href="clmse138.html#x169-343002r840">if</a> будет <a 
href="clmse31.html#x42-74002r18">nil</a>. Если в этой ситуации значение формы <a 
href="clmse138.html#x169-343002r840">if</a> важно, тогда в
зависимости от контекста стилистически удобнее использовать форму <a 
href="clmse34.html#x45-79004r49">and</a>.
Если значение не важно, тогда удобнее использовать конструкцию
<a 
href="clmse138.html#x169-343004r841">when</a>.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> when </b><a 
 id="dx52-107001"></a><a 
 id="x52-107002r82"></a> test  { form}*
</td></tr></table>
<!--l. 5961--><p class="indent" >
</div>
<!--l. 5961--><p class="noindent" ><span class="paragraphHead"><a 
 id="x52-1080007.6"></a></span>
   (when <i>test</i> <i>form1</i> <i>form2</i> ... ) сначала выполняет <i>test</i>. Если результат <a 
href="clmse31.html#x42-74002r18">nil</a>,
тогда ничего не выполняется и возвращается <a 
href="clmse31.html#x42-74002r18">nil</a>. Иначе, последовательно
выполняются формы <i>form</i> слева направо (как неявный <a 
href="clmse38.html#x50-96002r71">progn</a>), и возвращается
значение последней формы. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(when <i>p</i> <i>a</i> <i>b</i> <i>c</i>)  ≡ (and <i>p</i> (progn <i>a</i> <i>b</i> <i>c</i>))
</td></tr></table>
<!--l. 5969--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(when <i>p</i> <i>a</i> <i>b</i> <i>c</i>)  ≡ (cond (<i>p</i> <i>a</i> <i>b</i> <i>c</i>))</td></tr></table>
<!--l. 5970--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(when <i>p</i> <i>a</i> <i>b</i> <i>c</i>)  ≡ (if <i>p</i> (progn <i>a</i> <i>b</i> <i>c</i>) <a 
href="clmse31.html#x42-74002r18">nil</a>)</td></tr></table>
<!--l. 5971--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(when <i>p</i> <i>a</i> <i>b</i> <i>c</i>)  ≡ (unless (not <i>p</i>) <i>a</i> <i>b</i> <i>c</i>)</td></tr></table>
<!--l. 5973--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 5974--><p class="noindent" >В целях хорошего стиля, <a 
href="clmse138.html#x169-343004r841">when</a> обычно используется для выполнения побочных
эффектов при некоторых условиях, и значение <a 
href="clmse138.html#x169-343004r841">when</a> не используется. Если
значение все-таки важно, тогда может быть стилистически более подходящи
функции <a 
href="clmse34.html#x45-79004r49">and</a> или <a 
href="clmse138.html#x169-343002r840">if</a>.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> unless </b><a 
 id="dx52-108001"></a><a 
 id="x52-108002r83"></a> test  { form}*
</td></tr></table>
<!--l. 5982--><p class="indent" >
</div>
<!--l. 5982--><p class="noindent" ><span class="paragraphHead"><a 
 id="x52-1090007.6"></a></span>
   (unless <i>test</i> <i>form1</i> <i>form2</i> ... ) сначала выполняет <i>test</i>. Если результат <i>не</i>
<a 
href="clmse31.html#x42-74002r18">nil</a>, тогда ничего не выполняется и возвращается <a 
href="clmse31.html#x42-74002r18">nil</a>. Иначе, последовательно
выполняются формы <i>form</i> слева направо (как неявный <a 
href="clmse38.html#x50-96002r71">progn</a>), и возвращается
значение последней формы. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(unless <i>p</i> <i>a</i> <i>b</i> <i>c</i>)  ≡ (cond ((not <i>p</i>) <i>a</i> <i>b</i> <i>c</i>))
</td></tr></table>
<!--l. 5990--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(unless <i>p</i> <i>a</i> <i>b</i> <i>c</i>)  ≡ (if <i>p</i> <a 
href="clmse31.html#x42-74002r18">nil</a> (progn <i>a</i> <i>b</i> <i>c</i>))</td></tr></table>
<!--l. 5991--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(unless <i>p</i> <i>a</i> <i>b</i> <i>c</i>)  ≡ (when (not <i>p</i>) <i>a</i> <i>b</i> <i>c</i>)</td></tr></table>
<!--l. 5993--><p class="indent" >
</div>
</div>
<!--l. 5994--><p class="noindent" >В целях хорошего стиля, <a 
href="clmse138.html#x169-343006r842">unless</a> обычно используется для выполнения побочных
эффектов при некоторых условиях, и значение <a 
href="clmse138.html#x169-343006r842">unless</a> не используется. Если
значение все-таки важно, тогда может быть стилистически более подходящая
функция <a 
href="clmse138.html#x169-343002r840">if</a>.
</div>
<div class=defmac>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> cond </b><a 
 id="dx52-109001"></a><a 
 id="x52-109002r84"></a> {(test  { form}* )}*
</td></tr></table>
<!--l. 6002--><p class="indent" >
</div>
<!--l. 6002--><p class="noindent" ><span class="paragraphHead"><a 
 id="x52-1100007.6"></a></span>
   Форма <a 
href="#x52-109002r84">cond</a> содержит некоторое (возможно нулевое) количество
подвыражений, которые является списками форм. Каждое подвыражение
содержит форму условия и ноль и более форм для выполнения. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(cond (<i>test-1</i> <i>consequent-1-1</i> <i>consequent-1-2</i> ...)
</td></tr></table>
<!--l. 6008--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>test-2</i>)</td></tr></table>
<!--l. 6009--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>test-3</i> <i>consequent-3-1</i> ...)</td></tr></table>
<!--l. 6010--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ... )</td></tr></table>
<!--l. 6012--><p class="indent" >
</div>
</div>
<!--l. 6014--><p class="indent" >   Отбирается первое подвыражение, чья форма условия вычисляется в
не-<a 
href="clmse31.html#x42-74002r18">nil</a>. Все остальные подвыражения игнорируются. Формы отобранного
подвыражения последовательно выполняются (как неявный <a 
href="clmse38.html#x50-96002r71">progn</a>).
<!--l. 6018--><p class="indent" >   Если быть точнее, <a 
href="#x52-109002r84">cond</a> обрабатывает свои подвыражения слева направо.
Для каждого подвыражения, вычисляется форма условия. Если результат
<a 
href="clmse31.html#x42-74002r18">nil</a>, <a 
href="#x52-109002r84">cond</a> переходит к следующему подвыражению. Если результат <a 
href="clmse31.html#x42-74004r19">t</a>, <i>cdr</i>
подвыражения обрабатывается, как список форм. Этот список выполняется
слева направо, как неявный <a 
href="clmse38.html#x50-96002r71">progn</a>. После выполнения списка форм, <a 
href="#x52-109002r84">cond</a>
возвращает управление без обработки оставщихся подвыражений.
Специальная форма <a 
href="#x52-109002r84">cond</a> возвращает результат выполнения последней
формы из списка. Если этот список пустой, тогда возвращается значение
формы условия. Если <a 
href="#x52-109002r84">cond</a> вернула управление без вычисления какой-либо
ветки (все условные формы вычислились в <a 
href="clmse31.html#x42-74002r18">nil</a>), возвращается значение
<a 
href="clmse31.html#x42-74002r18">nil</a>.
                                                                          

                                                                          
<!--l. 6030--><p class="indent" >   Для того, чтобы выполнить последнее подвыражение, в случае если
раньше ничего не выполнилось, можно использовать <a 
href="clmse31.html#x42-74004r19">t</a> для формы условия. В
целях стиля, если значение <a 
href="#x52-109002r84">cond</a> будет для чего-то использоваться,
желательно записывать последнее выражение так: (<a 
href="clmse31.html#x42-74004r19">t</a> <a 
href="clmse31.html#x42-74002r18">nil</a>). Также вопросом
вкуса является запись последнего подвыражения <a 
href="#x52-109002r84">cond</a> как «синглтон», в
таком случае, используется неявный <a 
href="clmse31.html#x42-74004r19">t</a>. (Следует отметить, если <i>x</i> может
возвращать несколько значений, то (cond ... (<i>x</i>)) может вести себя отлично от
(cond ... (<a 
href="clmse31.html#x42-74004r19">t</a> <i>x</i>)). Первое выражение всегда возвращает одно выражение, тогда
как второе возвращает все то же, что и <i>x</i>. В зависимости от стиля, можно
указывать поведение явно (cond ... (t (values <i>x</i>))), используя функцию
<a 
href="clmse43.html#x55-131002r105">values</a> для явного указания возврата одного значения.) Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(setq z (cond (a &#x2019;foo) (b &#x2019;bar)))                                </td><td  
class="tabbing">;Возможна неопределенность
</td></tr></table>
<!--l. 6045--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(setq z (cond (a &#x2019;foo) (b &#x2019;bar) (<a 
href="clmse31.html#x42-74004r19">t</a> <a 
href="clmse31.html#x42-74002r18">nil</a>)))                       </td><td  
class="tabbing">;Уже лучше</td></tr></table>
<!--l. 6046--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (c d) (e))                                             </td><td  
class="tabbing">;Возможна неопределенность</td></tr></table>
<!--l. 6047--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (c d) (<a 
href="clmse31.html#x42-74004r19">t</a> e))                                           </td><td  
class="tabbing">;Уже лучше</td></tr></table>
<!--l. 6048--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (c d) (<a 
href="clmse31.html#x42-74004r19">t</a> (values e)))                               </td><td  
class="tabbing">;Неплохо (если необходимо</td></tr></table>
<!--l. 6049--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">                                                      </td><td  
class="tabbing">; одно значение)</td></tr></table>
<!--l. 6050--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (c))                                                    </td><td  
class="tabbing">;Возможна неопределенность</td></tr></table>
<!--l. 6051--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(cond (a b) (t c))                                                  </td><td  
class="tabbing">;Уже лучше</td></tr></table>
<!--l. 6052--><p class="indent" >     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:427;" 
class="tabbing">(if a b c)                                                             </td><td  
class="tabbing">;Тоже неплохо</td></tr></table>
<!--l. 6054--><p class="indent" >
</div>
</div>
<!--l. 6055--><p class="noindent" >Lisp&#x2019;овая форма <a 
href="#x52-109002r84">cond</a> сравнима с последовательностью <b>if</b>-<b>then</b>-<b>else</b>,
используемой в большинстве алгебраических языках программирования:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">(cond (<i>p</i> ...)                </td><td style="width:195;" 
class="tabbing">                                 </td><td  
class="tabbing"><b>if</b> <i>p</i> <b>тогда</b> ...
</td></tr></table>
<!--l. 6060--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">      (<i>q</i> ...)               </td><td style="width:195;" 
class="tabbing">roughly                       </td><td  
class="tabbing"><b>иначе</b> <b>если</b> <i>q</i> <b>тогда</b> ...</td></tr></table>
                                                                          

                                                                          
<!--l. 6061--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">      (<i>r</i> ...)               </td><td style="width:195;" 
class="tabbing">corresponds                  </td><td  
class="tabbing"><b>иначе</b> <b>если</b> <i>r</i> <b>тогда</b> ...</td></tr></table>
<!--l. 6062--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">      ...                    </td><td style="width:195;" 
class="tabbing">to                               </td><td  
class="tabbing">...</td></tr></table>
<!--l. 6063--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:185;" 
class="tabbing">      (<a 
href="clmse31.html#x42-74004r19">t</a> ...))              </td><td style="width:195;" 
class="tabbing">                                 </td><td  
class="tabbing"><b>иначе</b> ...</td></tr></table>
<!--l. 6065--><p class="indent" >
</div>
</div>
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> case </b><a 
 id="dx52-110001"></a><a 
 id="x52-110002r85"></a> keyform  {( {( {key}* ) | key} { form}* )}*
</td></tr></table>
<!--l. 6070--><p class="indent" >
</div>
<!--l. 6070--><p class="noindent" ><span class="paragraphHead"><a 
 id="x52-1110007.6"></a></span>
   <a 
href="#x52-110002r85">case</a> условный оператор, который выбирает ветку для выполнения, в
зависимости от равенства некоторой переменной некоторой константе.
Константа обычно представляет собой ключевой символ, целое число или
строковый символ (но может быть и любой другой объект). Вот развернутая
форма: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(case <i>keyform</i>
</td></tr></table>
<!--l. 6076--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>keylist-1</i> <i>consequent-1-1</i> <i>consequent-1-2</i> ...)</td></tr></table>
<!--l. 6077--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>keylist-2</i> <i>consequent-2-1</i> ...)</td></tr></table>
<!--l. 6078--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>keylist-3</i> <i>consequent-3-1</i> ...)</td></tr></table>
<!--l. 6079--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 6081--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 6082--><p class="noindent" >Структурно <a 
href="#x52-110002r85">case</a> очень похож на <a 
href="#x52-109002r84">cond</a>, и поведение такое же: выбрать список
форм и выполнить их. Однако <a 
href="#x52-110002r85">case</a> отличается механизмом выбора
подвыражения.
<!--l. 6086--><p class="indent" >   Сперва <a 
href="#x52-110002r85">case</a> вычисляет форму <i>keyform</i> для получения объекта, который
называется <i>ключевой объект</i>. Затем <a 
href="#x52-110002r85">case</a> рассматривает все подвыражения.
Если <i>ключевой объект</i> присутствует в списке <i>keylist</i> (то есть, если <i>ключевой
объект</i> равен <a 
href="clmse33.html#x44-78004r45">eql</a> хотя бы одному элементу из списка <i>keylist</i>), то список форм
выбранного подвыражения вычисляется, как неявный <a 
href="clmse38.html#x50-96002r71">progn</a>. <a 
href="#x52-110002r85">case</a> возвращает
то же, что и последняя форма списка (или <a 
href="clmse31.html#x42-74002r18">nil</a> если список форм был пустой).
Если ни одно подвыражение не удовлетворило условию, то <a 
href="#x52-110002r85">case</a> возвращает
<a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 6097--><p class="indent" >   Ключи в списке ключей <i>keylist</i> <i>не</i> выполняются. В данном списке должны
быть указаны литеральные ключи. Если один ключ попадается более чем в
одном подвыражении, это считается ошибкой. Следствием является то, что
порядок этих подвыражений не влияет на поведение конструкции
<a 
href="#x52-110002r85">case</a>.
<!--l. 6104--><p class="indent" >   Вместо <i>keylist</i> можно записать один из символов: <a 
href="clmse31.html#x42-74004r19">t</a> или otherwise.
Подвыражение с одним из таких символов всегда удовлетворяет условию
выбора. Такое подвыражение должно быть последним (это исключение из
правила о произвольности положения подвыражений). Смотрите также <a 
href="clmse152.html#x186-456002r960">ecase</a>
и <a 
href="clmse152.html#x186-457002r961">ccase</a>, каждая из которых предоставляет неявное otherwise подвыражение
для сигнализировании об ошибке, если ни одно подвыражение не
удволетворило условию.
<!--l. 6112--><p class="indent" >   Если в подвыражении только один ключ, тогда этот ключ может быть
записан вместо списка. Такой «синглтоновый ключ» не может быть <a 
href="clmse31.html#x42-74002r18">nil</a> (так
как возникают конфликты с (), который означает список без ключей), <a 
href="clmse31.html#x42-74004r19">t</a>,
otherwise или cons-ячейкой.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> typecase </b><a 
 id="dx52-111001"></a><a 
 id="x52-111002r86"></a> keyform  {(type  { form}* )}*
</td></tr></table>
<!--l. 6121--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 6121--><p class="noindent" ><span class="paragraphHead"><a 
 id="x52-1120007.6"></a></span>
   <a 
href="#x52-111002r86">typecase</a> условный оператор, который выбирает подвыражение на основе
типа объекта. Развернутая форма: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(typecase <i>keyform</i>
</td></tr></table>
<!--l. 6126--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>type-1</i> <i>consequent-1-1</i> <i>consequent-1-2</i> ...)</td></tr></table>
<!--l. 6127--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>type-2</i> <i>consequent-2-1</i> ...)</td></tr></table>
<!--l. 6128--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (<i>type-3</i> <i>consequent-3-1</i> ...)</td></tr></table>
<!--l. 6129--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 6131--><p class="indent" >
</div>
</div>
<!--l. 6132--><p class="noindent" >Структура <a 
href="#x52-111002r86">typecase</a> похожа на <a 
href="#x52-109002r84">cond</a> или <a 
href="#x52-110002r85">case</a>. Поведение также схоже в том, что
выбирается подвыражение в зависимости от условия. Различие заключается
в механизме выбора подвыражения.
<!--l. 6136--><p class="indent" >   Сперва <a 
href="#x52-111002r86">typecase</a> вычисляет форму <i>keyform</i> для создания объекта,
называемого ключевым объектом. Далее <a 
href="#x52-111002r86">typecase</a> друг за другом рассматривает
каждое подвыражение. Форма <i>type</i>, которая встречается в каждом
подвыражении, является спецификатором типа. Данный спецификатор не
вычисляется, поэтому должен быть литеральным. Когда ключевой объект
приндалежит некоторый типу, то выделенный список форм <i>consequent</i>
выполняется последовательно (как неявный <a 
href="clmse38.html#x50-96002r71">progn</a>). <a 
href="#x52-111002r86">typecase</a> возвращает то,
что вернула последняя форма из списка (или <a 
href="clmse31.html#x42-74002r18">nil</a> если список был пуст).
Если не одно подвыражение не было выбрано, <a 
href="#x52-111002r86">typecase</a> возвращает
<a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 6147--><p class="indent" >   Как и для <a 
href="#x52-110002r85">case</a> можно использовать <a 
href="clmse31.html#x42-74004r19">t</a> или otherwise на позиции <i>типа</i> для
задания подвыражений, которые будут выполняться, только если не
было выполнено других подвыражений. Смотрите также <a 
href="clmse152.html#x186-454002r958">etypecase</a> и
<a 
href="clmse152.html#x186-455002r959">ctypecase</a>, каждая из которых предоставляет неявную ветку otherwise для
сигнализировании об ошибке, что ни одно подвыражение не удовлетворило
условию.
<!--l. 6154--><p class="indent" >   Допустимо указывать более одного подвыражение, тип условия которого
уже является подтипом условия другого подвыражения. В таком случае
будет выбрано первое встретившееся подвыражение. Таким образом в
<a 
href="#x52-111002r86">typecase</a>, в отличие от <a 
href="#x52-110002r85">case</a>, порядок следования подвыражений влияет на
поведение всей конструкции. <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(typecase an-object
</td></tr></table>
<!--l. 6161--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   (string ...)                             </td><td  
class="tabbing">;Подвыражение обрабатывает строки</td></tr></table>
<!--l. 6162--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   ((array t) ...)                          </td><td  
class="tabbing">;Подвыражение обрабатывает общие массивы</td></tr></table>
<!--l. 6163--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   ((array bit) ...)                       </td><td  
class="tabbing">;Подвыражение обрабатывает битовые массивы</td></tr></table>
<!--l. 6164--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   (array ...)                              </td><td  
class="tabbing">;Обрабатывает все остальные массивы</td></tr></table>
<!--l. 6165--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   ((or list number) ...)                </td><td  
class="tabbing">;Подвыражение обрабатывает списки и числа</td></tr></table>
<!--l. 6166--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:278;" 
class="tabbing">   (t ...))                                   </td><td  
class="tabbing">;Подвыражение обрабатывает все остальные объекты</td></tr></table>
<!--l. 6168--><p class="indent" >
</div>
</div>
</div>
                                                                          

                                                                          
   <!--l. 6171--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse41.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse39.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse39.html#tailclmse39.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse40.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse40.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 6171--><p class="indent" >   <a 
 id="tailclmse40.html"></a>  
</body></html> 
