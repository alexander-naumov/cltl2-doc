<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Поиск элементов последовательностей</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 00:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 2019--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse81.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse79.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse79.html#tailclmse79.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse80.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse80.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">14.4   </span> <a 
href="clm.html#QQ2-99-1248" id="x99-123900014.4">Поиск элементов
последовательностей</a></h3>
<!--l. 2021--><p class="noindent" >Каждая из этих функций ищет в последовательности элемент, удовлетворяющий
некоторому условию.
<div class="defun">
<!--l. 2024--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx99-1239001"></a><a 
 id="x99-1239002r396"></a><b> ﬁnd</b>  <i>item</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:test</i> <i>:test-not</i> <i>:start :end</i>
<i>:key</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx99-1239003"></a><a 
 id="x99-1239004r397"></a><b> ﬁnd-if</b>  <i>predicate</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:start</i> <i>:end</i> <i>:key</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx99-1239005"></a><a 
 id="x99-1239006r398"></a><b> ﬁnd-if-not</b>  <i>predicate</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:start :end :key</i>
</div>
<!--l. 2028--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124000014.4" id="x99-124000014.4"></a></span>
   Если последовательность <i>sequence</i> содержит элемент, удовлетворяющий
условию, тогда возвращается первый найденный слева элемент, иначе
возвращается <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>.
<!--l. 2033--><p class="indent" >   Если заданы параметры <tt>:start</tt> и <tt>:end</tt>, тогда поиск осуществляется в
этом интервале.
<!--l. 2036--><p class="indent" >   Если <tt>:from-end</tt> указан в не-<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>, тогда результатом функции будет
найденный элемент справа.
</div>
<div class="defun">
<!--l. 2040--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx99-1240001"></a><a 
 id="x99-1240002r399"></a><b> position</b>  <i>item</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:test</i> <i>:test-not</i>
<i>:start :end :key</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx99-1240003"></a><a 
 id="x99-1240004r400"></a><b> position-if</b>  <i>predicate</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:start :end :key</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx99-1240005"></a><a 
 id="x99-1240006r401"></a><b> position-if-not</b>  <i>predicate</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:start :end :key</i>
</div>
<!--l. 2044--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124100014.4" id="x99-124100014.4"></a></span>
   Если последовательность <i>sequence</i> содержит элемент, удовлетворяющий
условию, тогда возвращается позиция найденного элемента слева, иначе
возвращается <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>.
<!--l. 2049--><p class="indent" >   Если заданы параметры <tt>:start</tt> и <tt>:end</tt>, тогда поиск осуществляется в
этом интервале. Однако возвращаемый индекс будет относиться ко всей
                                                                          

                                                                          
последовательности в целом.
<!--l. 2053--><p class="indent" >   Если <tt>:from-end</tt> указан в не-<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>, тогда результатом функции будет индекс
найденного элемент справа. (Однако, возвращаемый индекс, будет, как
обычно, принадлежать нумерации слева направо.)
</div> Ниже приведены несколько примеров использования нескольких функций,
преимущественно <tt><a 
href="#x99-1240004r400">position-if</a></tt> и <tt><a 
href="#x99-1239004r397">find-if</a></tt>, для обработки строк. Также
используется <tt><a 
href="clmse42.html#x54-647002r96">loop</a></tt>. <div class="lisp"><div class="tabbing">
(defun debug-palindrome (s)
   <br>                              (ﬂet ((match (x) (char-equal (ﬁrst x) (third x))))<br>
    (let* ((pairs (loop for c across s<br>                        for j from 0<br>
                        when (alpha-char-p c)<br>
                          collect (list c j)))<br>
           (quads (mapcar #&#x2019;append pairs (reverse pairs)))<br>
           (diﬀpos (position-if (complement #&#x2019;match) quads)))<br>
      (when diﬀpos<br>                       (let* ((diﬀ (elt quads diﬀpos))<br>
               (same (ﬁnd-if #&#x2019;match quads<br>
                              :start (+ diﬀpos 1))))<br>
          (if same<br>                                          (format nil<br>
                      &#x0022;/~A/ (at ~D) is not the reverse of /~A/&#x0022;<br>
                      (subseq s (second diﬀ) (second same))<br>
                      (second diﬀ)<br>                      (subseq s (+ (fourth same) 1)<br>
                                (+ (fourth diﬀ) 1)))<br>
              &#x0022;This palindrome is completely messed up!&#x0022;))))))<br>
<!--l. 2081--><p class="noindent" ></div>
<!--l. 2081--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124200014.4" id="x99-124200014.4"></a></span>
<!--l. 2081--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124300014.4" id="x99-124300014.4"></a></span>
</div>
<!--l. 2082--><p class="indent" >   Вот пример поведения этой функции <div class="lisp"><div class="tabbing">
(setq panama     ;Предполагаемый палиндром?
                                                                          

                                                                          
   <br>                               &#x0022;A man, a plan, a canoe, pasta, heros, rajahs,<br>
       a coloratura, maps, waste, percale, macaroni, a gag,<br>
       a banana bag, a tan, a tag, a banana bag again<br>
       (or a camel), a crepe, pins, Spam, a rut, a Rolo,<br>
       cash, a jar, sore hats, a peon, a canal–Panama!&#x0022;)<br>
<!--l. 2090--><p class="noindent" ></div>
<!--l. 2090--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124400014.4" id="x99-124400014.4"></a></span>
<!--l. 2090--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124500014.4" id="x99-124500014.4"></a></span>
</div>
<div class="lisp">
<!--l. 2091--><p class="indent" >   <div class="tabbing">
(debug-palindrome panama)
   <br>                            <span class="math"> ⇒</span> &#x0022;/wast/ (at 73) is not the reverse of /, pins/&#x0022;<br>
<br>                   (replace panama &#x0022;snipe&#x0022; :start1 73)     ;Восстановить<br>
  <span class="math"> ⇒</span> &#x0022;A man, a plan, a canoe, pasta, heros, rajahs,<br>
       a coloratura, maps, snipe, percale, macaroni, a gag,<br>
       a banana bag, a tan, a tag, a banana bag again<br>
       (or a camel), a crepe, pins, Spam, a rut, a Rolo,<br>
       cash, a jar, sore hats, a peon, a canal–Panama!&#x0022;<br>                   <br>
(debug-palindrome panama) <span class="math"> ⇒</span> nil     ;Первоклассный—истинный палиндром<br>
<br>                       (debug-palindrome &#x0022;Rubber baby buggy bumpers&#x0022;)<br>
  <span class="math"> ⇒</span> &#x0022;/Rubber / (at 0) is not the reverse of /umpers/&#x0022;<br>
<br>                       (debug-palindrome &#x0022;Common Lisp: The Language&#x0022;)<br>
  <span class="math"> ⇒</span> &#x0022;/Commo/ (at 0) is not the reverse of /guage/&#x0022;<br>                     <br>
(debug-palindrome &#x0022;Complete mismatches are hard to ﬁnd&#x0022;)<br>          <span class="math"> ⇒</span> <br>
  &#x0022;/Complete mism/ (at 0) is not the reverse of /re hard to ﬁnd/&#x0022;<br>
<br>               (debug-palindrome &#x0022;Waltz, nymph, for quick jigs vex Bud&#x0022;)<br>
  <span class="math"> ⇒</span> &#x0022;This palindrome is completely messed up!&#x0022;<br>                         <br>
(debug-palindrome &#x0022;Doc, note: I dissent.  A fast never<br>
                   prevents a fatness.  I diet on cod.&#x0022;)<br>
  <span class="math"> ⇒</span><tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>     ;Другой победитель<br>                                       <br>
(debug-palindrome &#x0022;Top step&#x2019;s pup&#x2019;s pet spot&#x0022;) <span class="math"> ⇒</span> nil<br>
                                                                          

                                                                          
<!--l. 2122--><p class="noindent" ></div>
<!--l. 2122--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124600014.4" id="x99-124600014.4"></a></span>
<!--l. 2122--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124700014.4" id="x99-124700014.4"></a></span>
</div>
<div class="defun">
<!--l. 2124--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx99-1247001"></a><a 
 id="x99-1247002r402"></a><b> count</b>  <i>item</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:test</i> <i>:test-not</i>
<i>:start :end :key</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx99-1247003"></a><a 
 id="x99-1247004r403"></a><b> count-if</b>  <i>predicate</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:start :end :key</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx99-1247005"></a><a 
 id="x99-1247006r404"></a><b> count-if-not</b>  <i>predicate</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:start :end :key</i>
</div>
<!--l. 2128--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124800014.4" id="x99-124800014.4"></a></span>
   Результатом является неотрицательное целое число, указывающее на
количество элементов из указанной подпоследовательности, удовлетворяющих
условию.
<tt>
<!--l. 2132--><p class="indent" >   :from-end</tt> не оказывает никакого воздействия, и оставлен только для
совместимости с другими функциями.
</div>
<div class="defun">
<!--l. 2136--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx99-1248001"></a><a 
 id="x99-1248002r405"></a><b> mismatch</b>  <i>sequence1</i> <i>sequence2</i> &#x0026;key  <i>:from-end</i> <i>:test</i> <i>:test-not</i> <i>:key</i>
<i>:start1</i> <i>:start2</i> <i>:end1</i> <i>:end2</i>
</div>
<!--l. 2138--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-124900014.4" id="x99-124900014.4"></a></span>
   Функция поэлементно сравнивает указанные подпоследовательности. Если
их длины равны и соответственно равны между собой каждые их элементы,
то функция возвращает <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>. Иначе, функция возвращает неотрицательное
целое число. Это число указывает на первый элемент слева, который не
совпал с элементом другой последовательности <i>sequence2</i>. Или же, в случае
если одна подпоследовательность короче другой, но все элементы
были одинаковыми, индекс указывает на последний проверенный
элемент.
                                                                          

                                                                          
<!--l. 2148--><p class="indent" >   Если параметр <tt>:from-end</tt> равен не-<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt> значению, тогда возвращается
увеличенная на 1 позиция первого не совпавшего элемента справа.
Фактически, (под)последовательности выравниваются по своим правым
концам, затем сравниваются последние элементы, затем предпоследние и так
далее. Возвращаемый индекс принадлежит первой последовательности
<i>sequence1</i>.
</div>
<div class="defun">
<!--l. 2155--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx99-1249001"></a><a 
 id="x99-1249002r406"></a><b> search</b>  <i>sequence1</i> <i>sequence2</i> &#x0026;key  <i>:from-end</i> <i>:test</i> <i>:test-not</i> <i>:key</i>
<i>:start1</i> <i>:start2</i> <i>:end1</i> <i>:end2</i>
</div>
<!--l. 2157--><p class="noindent" ><span class="paragraphHead"><a 
href="#x99-125000014.4" id="x99-125000014.4"></a></span>
   Функция осуществляет поэлементный поиск последовательности <i>sequence1</i>
в последовательности <i>sequence1</i>. Если поиск не увенчался успехом,
результатом является значение <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>. Иначе, результат является индексом
первого совпавшего элемента слева во второй последовательности
<i>sequence2</i>.
<!--l. 2164--><p class="indent" >   Если аргумент <tt>:from-end</tt> равен не-<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>, поиск осуществляется справа, и
результат является индексом элемента слева в первой совпавшей
подпоследовательности справа.
<!--l. 2168--><p class="indent" >   Реализация может выбирать алгоритм поиска на своё усмотрение.
Количество проводимых сравнений не может быть указано точно. Например,
<tt><a 
href="#x99-1249002r406">search</a></tt> при <tt>:from-end</tt> равном не-<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt> может фактически производить поиск
слева направо, но результатом будет всегда индекс самой правой совпавшей
последовательности. Поэтому пользователю желательно использовать
предикаты без побочных эффектов.
</div>
                                                                          

                                                                          
<!--l. 2176--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse81.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse79.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse79.html#tailclmse79.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse80.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse80.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse80.html"></a>    </div> </div> 
</body></html> 
