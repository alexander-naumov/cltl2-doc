<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Функции для хеш-таблиц</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-06 17:14:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 445--><p class="noindent" > <div id="main_container"> <div id="content"> <!--l. 445--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse86.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#tailclmch16.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse85.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#clmse85.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">16.1   </span> <a 
href="clm.html#QQ2-106-238" id="x106-21000016.1">Функции для хеш-таблиц</a></h3>
<!--l. 447--><p class="noindent" >Данный раздел описывает функции для хеш-таблиц, которые используют
<i>объекты</i> для ключей и ассоциируют другие объекты с этими.
<div class=defun>
<!--l. 450--><p class="noindent" ><i>[Функция]</i><a 
 id="dx106-210001"></a><a 
 id="x106-210002r489"></a><b> make-hash-table</b>  &#x0026;key  <i>:test</i> <i>:size</i> <i>:rehash-size</i> <i>:rehash-threshold</i>
<!--l. 452--><p class="noindent" >Эта функция создаёт и возвращает новую хеш-таблицу. Аргумент <tt>:test</tt>
определяет как будут сравниваться ключи. Он может быть одним из трёх
значений <tt>#&#x2019;eq</tt>, <tt>#&#x2019;eql</tt> или <tt>#&#x2019;equal</tt>, или одним из трёх символов <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt>, <tt><a 
href="clmse32.html#x43-77004r45">eql</a></tt> или
<tt><a 
href="clmse32.html#x43-77006r46">equal</a></tt>. По-умолчанию используется <tt><a 
href="clmse32.html#x43-77004r45">eql</a></tt>.
<!--l. 459--><p class="indent" >   Аргумент <tt>:size</tt> устанавливает первоначальный размер хеш-таблицы в
парах. (Указанный размер может быть округлён до «хорошего» размера,
например, до первого следующего простого числа.) Вы можете не сохранять
в таблице столько пар, сколько указали. Этот аргумент служит подсказкой
для реализации о том, какое примерно число элементов вы будете хранить в
хеш-таблице.
<!--l. 466--><p class="indent" >   Аргумент <tt>:rehash-size</tt> указывает, на сколько увеличить размер
хеш-таблицы, когда она по размерам достигнет пределов. Если это целое
число, оно должно быть больше нуля, и будет означать абсолютное
                                                                          

                                                                          
приращение. Если это число с плавающей точкой, оно должно быть больше 1,
и будет означать относительное приращение к предыдущему размеру.
Значение по-умолчанию зависит от реализации.
<div class=newer>
<!--l. 474--><p class="indent" >   Аргумент <tt>:rehash-threshold</tt> указывает, насколько должна наполниться
хеш-таблица, прежде чем она будет увеличена. Он должен быть числом
типа <tt>real</tt> между <tt>0</tt> и <tt>1</tt>, включительно. Он показывает максимальный
уровень заполнения хеш-таблицы. Значение по-умолчанию зависит от
реализации.
</div>
<!--l. 481--><p class="indent" >   Пример использования <tt><a 
href="#x106-210002r489">make-hash-table</a></tt>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-hash-table :rehash-size 1.5
</td></tr></table>
<!--l. 483--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 :size (* number-of-widgets 43))</td></tr></table>
<!--l. 485--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 488--><p class="noindent" ><i>[Функция]</i><a 
 id="dx106-210003"></a><a 
 id="x106-210004r490"></a><b> hash-table-p</b>  <i>object</i>
<!--l. 490--><p class="noindent" ><tt><a 
href="#x106-210004r490">hash-table-p</a></tt> возвращает истину, если аргумент является хеш-таблицей.
Иначе возвращает ложь. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-p x) <span class="math"> ≡</span> (typep x &#x2019;hash-table)
</td></tr></table>
<!--l. 495--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 498--><p class="noindent" ><i>[Функция]</i><a 
 id="dx106-210005"></a><a 
 id="x106-210006r491"></a><b> gethash</b>  <i>key</i> <i>hash-table</i> &#x0026;optional  <i>default</i>
<!--l. 500--><p class="noindent" ><tt><a 
href="#x106-210006r491">gethash</a></tt> ищет элемент в хеш-<i>hash-table</i>, чей ключ равен <i>key</i> и возвращает
связанное значение. Если элемент не был найден, то возвращается значение
аргумента <i>default</i>, который по-умолчанию равен <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
                                                                          

                                                                          
<tt>
<!--l. 505--><p class="indent" >   <a 
href="#x106-210006r491">gethash</a></tt> возвращает два значение. Второе значение является предикатом,
и истинно, если значение было найдено, и ложно если нет.
<tt>
<!--l. 508--><p class="indent" >   <a 
href="clmse35.html#x47-89002r64">setf</a></tt> может использоваться вместе с <tt><a 
href="#x106-210006r491">gethash</a></tt> для создания в хеш-таблице
новых элементов. Если элемент с заданным ключом <i>key</i> уже существует, он
будет удалён перед добавлением. В этом контексте может использоваться
аргумент <i>default</i>, он игнорируется <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>, но может быть полезным в таких
макросах как <tt><a 
href="clmse63.html#x80-177014r187">incf</a></tt>, которые связаны с <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(incf (gethash a-key table 0))
</td></tr></table>
<!--l. 515--><p class="indent" >
</div>
</div>
<!--l. 516--><p class="noindent" >обозначает то же, что и <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table 0)
</td></tr></table>
<!--l. 518--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 520--><p class="indent" >
</div>
</div>
<!--l. 521--><p class="noindent" >что можно преобразовать в <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table)
</td></tr></table>
<!--l. 523--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 525--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
                                                                          

                                                                          
<!--l. 528--><p class="noindent" ><i>[Функция]</i><a 
 id="dx106-210007"></a><a 
 id="x106-210008r492"></a><b> remhash</b>  <i>key</i> <i>hash-table</i>
<!--l. 530--><p class="noindent" ><tt><a 
href="#x106-210008r492">remhash</a></tt> удаляет любой элемент в хеш-таблице <i>hash-table</i> ключ, которого
равен параметру <i>key</i>. Возвращает истину, если элемент был удалён, и ложь,
если элемента уже не существовало.
</div>
<div class=defun>
<!--l. 536--><p class="noindent" ><i>[Функция]</i><a 
 id="dx106-210009"></a><a 
 id="x106-210010r493"></a><b> maphash</b>  <i>function</i> <i>hash-table</i>
<!--l. 538--><p class="noindent" >Для каждого элемента в хеш-таблице <i>hash-table</i>, <tt><a 
href="#x106-210010r493">maphash</a></tt> вызывает функцию
<i>function</i> с двумя аргументами: ключ элемента и значение элемента. <tt><a 
href="#x106-210010r493">maphash</a></tt>
возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Если во время выполнения <tt><a 
href="#x106-210010r493">maphash</a></tt> в хеш-таблице
добавлялись или удалялись ключи, то результат непредсказуем, но есть
исключение: если функция <i>function</i> вызывает <tt><a 
href="#x106-210008r492">remhash</a></tt> для удаления
элемента, который в эту функцию и был передан, или устанавливает новое
значение с помощью <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> этому элементу, то эти операции будут выполнены
правильно. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Изменение каждого элемента в MY-HASH-TABLE, с заменой на
</td></tr></table>
<!--l. 551--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; квадратный корень. Элементы с отрицательными значения удаляются.</td></tr></table>
<!--l. 552--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(maphash #&#x2019;(lambda (key val)</td></tr></table>
<!--l. 553--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (if (minusp val)</td></tr></table>
<!--l. 554--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (remhash key my-hash-table)</td></tr></table>
<!--l. 555--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (setf (gethash key my-hash-table) (sqrt val))))</td></tr></table>
<!--l. 556--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         my-hash-table)</td></tr></table>
<!--l. 558--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 561--><p class="noindent" ><i>[Функция]</i><a 
 id="dx106-210011"></a><a 
 id="x106-210012r494"></a><b> clrhash</b>  <i>hash-table</i>
<!--l. 563--><p class="noindent" >Функция удаляет все элемент из хеш-таблицы <i>hash-table</i> и возвращает эту
хеш-таблицу.
</div>
<div class=defun>
<!--l. 568--><p class="noindent" ><i>[Функция]</i><a 
 id="dx106-210013"></a><a 
 id="x106-210014r495"></a><b> hash-table-count</b>  <i>hash-table</i>
<!--l. 570--><p class="noindent" >Функция возвращает количество элементов в хеш-таблице <i>hash-table</i>. Когда
                                                                          

                                                                          
хеш-таблица только были сделана, или только что очищена, то количество
элементов равно нулю.
</div>
<div class=newer>
<div class=defun>
<!--l. 577--><p class="noindent" ><i>[Функция]</i><a 
 id="dx106-210015"></a><a 
 id="x106-210016r496"></a><b> hash-table-rehash-size</b>  <i>hash-table</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx106-210017"></a><a 
 id="x106-210018r497"></a><b> hash-table-rehash-threshold</b>  <i>hash-table</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx106-210019"></a><a 
 id="x106-210020r498"></a><b> hash-table-size</b>  <i>hash-table</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx106-210021"></a><a 
 id="x106-210022r499"></a><b> hash-table-test</b>  <i>hash-table</i>
<!--l. 582--><p class="noindent" >Добавлены функции, которые возвращают значения используемые при
вызове <tt><a 
href="#x106-210002r489">make-hash-table</a></tt>.
<tt>
<!--l. 586--><p class="indent" >   <a 
href="#x106-210016r496">hash-table-rehash-size</a></tt> возвращает размер приращения хеш-таблицы.
<tt>
<!--l. 588--><p class="indent" >   <a 
href="#x106-210018r497">hash-table-rehash-threshold</a></tt> возвращает текущий уровень заполнения.
<tt>
<!--l. 590--><p class="indent" >   <a 
href="#x106-210020r498">hash-table-size</a></tt> возвращает рекомендуемый размер хеш-таблицы.
<tt>
<!--l. 592--><p class="indent" >   <a 
href="#x106-210022r499">hash-table-test</a></tt> возвращает функцию сравнения используемую для
ключей. Если данная функция одна из стандартных, то результат всегда
является символом, даже если при создании хеш-таблицы было указано иное.
Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-test (make-hash-table :test #&#x2019;equal)) <span class="math"> ⇒</span> equal
</td></tr></table>
<!--l. 597--><p class="indent" >
</div>
</div>
<!--l. 598--><p class="noindent" >Реализации, которые расширяют <tt><a 
href="#x106-210002r489">make-hash-table</a></tt> дополнительными
функциями сравнения для аргумента <tt>:test</tt>, могут определять, как будет
возвращено значение из <tt><a 
href="#x106-210022r499">hash-table-test</a></tt> для этих дополнительных
функций.
</div>
</div>
                                                                          

                                                                          
   <!--l. 604--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse86.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#tailclmch16.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse85.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#clmse85.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 604--><p class="indent" >   <a 
 id="tailclmse85.html"></a>  </div> </div> 
</body></html> 
