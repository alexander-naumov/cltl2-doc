<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Обобщённые переменные</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-11 23:15:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 5003--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse36.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse34.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse34.html#tailclmse34.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse35.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse35.html" >Вверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">7.2   </span> <a 
href="clm.html#QQ2-47-97" id="x47-890007.2">Обобщённые
переменные</a></h3>
<!--l. 5006--><p class="noindent" >В Lisp&#x2019;е, переменная может запомнить одну часть данных, а точнее, один
Lisp объект. Главные операции над переменной это получить её значение и
задать ей другое значение. Их часто называют операциями <i>доступа</i> и
<i>изменения</i>. Концепция переменных с именем в виде символа может быть
обобщена до того, что любое место может сохранять в себе части данных вне
зависимости от того, как данное место именуется. Примерами таких мест
хранения являются <i>car</i> и <i>cdr</i> элементы cons-ячейки, элементы массива, и
компоненты структуры.
<!--l. 5016--><p class="indent" >   Для каждого вида обобщённых переменных существуют две функции,
которые реализуют операции <i>доступа</i> и <i>изменения</i>. Для переменных это имя
переменной для доступа, а для изменения специальная форма <tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt>. Функция
<tt><a 
href="clmse79.html#x99-200002r393">car</a></tt> получает доступ к <i>car</i> элементу cons-ячейки, а функция <tt><a 
href="clmse81.html#x101-205002r457">rplaca</a></tt> изменяет
этот элемент ячейки. Функция <tt><a 
href="clmse34.html#x46-85004r53">symbol-value</a></tt> получает динамическое
значение переменной именованной некоторым символом, а функция <tt><a 
href="clmse34.html#x46-88002r61">set</a></tt>
изменяет эту переменную.
<!--l. 5024--><p class="indent" >   Вместо того, чтобы думать о двух разных функциях, которые
соответственно получают доступ и изменяют некоторое место хранения в
зависимости от своих аргументов, мы может думать просто о вызове
функции доступа с некоторыми аргументами, как о <i>имени</i> данного места
хранения. Таким образом, просто <tt>x</tt> является именем места хранения
(переменной), <tt>(car x)</tt> имя для <i>car</i> элементы для некоторой cons-ячейки
(которая в свою очередь именуется символом <tt>x</tt>). Теперь вместо того, чтобы
запоминать по две функции для каждого вида обобщённых переменных
(например <tt><a 
href="clmse81.html#x101-205002r457">rplaca</a></tt> для <tt><a 
href="clmse79.html#x99-200002r393">car</a></tt>), мы адаптировали единый синтаксис для
изменения некоторого места хранения с помощью макроса <tt><a 
href="#x47-89002r64">setf</a></tt>. Это
аналогично способу, где мы используем специальную форму <tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt> для
преобразования имени переменной (которая является также формой для
доступа к ней) в форму, которая изменяет переменную FIXME. Эта
универсальной отображения в следующей таблице.
<div class="flushleft" 
>
                                                                          

                                                                          
<!--l. 5038--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" >Функция доступа  </td><td align="left" >Функция изменения</td><td align="left" >Изменения с помощью <tt><a 
href="#x47-89002r64">setf</a></tt>     </td>
</tr><tr><td align="left" ><tt>x</tt>                </td><td align="left" ><tt>(setq x datum)</tt>    </td><td align="left" ><tt>(setf x datum)</tt>               </td>
</tr><tr><td align="left" ><tt>(car x)</tt>          </td><td align="left" ><tt>(rplaca x datum)</tt>  </td><td align="left" ><tt>(setf (car x) datum)</tt>         </td>
</tr><tr><td align="left" ><tt>(symbol-value x)</tt> </td><td align="left" ><tt>(set x datum)</tt>     </td><td align="left" ><tt>(setf (symbol-value x) datum)</tt></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr><td align="left" >  </td></tr></table>
</div></div>
<tt>
<!--l. 5048--><p class="noindent" ><a 
href="#x47-89002r64">setf</a></tt> это макрос, который анализирует форму доступа, и производит вызов
соответствующей функции изменения.
<!--l. 5051--><p class="indent" >   С появление в Common Lisp&#x2019;е <tt><a 
href="#x47-89002r64">setf</a></tt>, необходимость в <tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt>, <tt><a 
href="clmse81.html#x101-205002r457">rplaca</a></tt> и <tt><a 
href="clmse34.html#x46-88002r61">set</a></tt>
отпала. Они оставлены в Common Lisp из-за их исторической важности в
Lisp&#x2019;е. Однако, большинство других функций изменения (например
<tt>putprop</tt>, функция изменения для <tt><a 
href="clmse50.html#x65-156002r127">get</a></tt>) были устранены из Common
Lisp&#x2019;а в расчёте на то, что везде на их месте будет использоваться
<tt><a 
href="#x47-89002r64">setf</a></tt>.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> setf </b><a 
 id="dx47-89001"></a><a 
 id="x47-89002r64"></a> {place newvalue}*
</td></tr></table>
<!--l. 5060--><p class="indent" >
</div>
<!--l. 5060--><p class="noindent" ><span class="paragraphHead"><a 
href="#x47-900007.2" id="x47-900007.2"></a></span>
   <tt>(setf <i>place</i> <i>newvalue</i>)</tt> принимает форму <i>place</i>, которая при своём
вычислении получает доступ к объекту в некотором месте хранения и
«инвертирует» эту форму в соответствующую форму <i>изменения</i>. Таким
образом вызов макроса <tt><a 
href="#x47-89002r64">setf</a></tt> разворачивается в форму изменения, которая
сохраняет результат вычисления формы <i>newvalue</i> в место хранения, на
которое ссылалась форма доступа.
<!--l. 5068--><p class="indent" >   Если пар <i>place</i>-<i>newvalue</i> указано более одной, эти пары обрабатываются
последовательно. Таким образом: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf <i>place1</i> <i>newvalue1</i>
</td></tr></table>
                                                                          

                                                                          
<!--l. 5071--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>place2</i> <i>newvalue2</i>)</td></tr></table>
<!--l. 5072--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 5073--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>placen</i> <i>newvaluen</i>)</td></tr></table>
<!--l. 5075--><p class="indent" >
</div>
</div>
<!--l. 5076--><p class="noindent" >эквивалентно <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf <i>place1</i> <i>newvalue1</i>
</td></tr></table>
<!--l. 5078--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>place2</i> <i>newvalue2</i>)</td></tr></table>
<!--l. 5079--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 5080--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>placen</i> <i>newvaluen</i>)</td></tr></table>
<!--l. 5082--><p class="indent" >
</div>
</div>
<!--l. 5083--><p class="noindent" >Следует отметить, что запись <tt>(setf)</tt> является корректной и возвращает
<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<!--l. 5085--><p class="indent" >   Форма <i>place</i> может быть одной из следующих:
      <ul class="itemize1">
      <li class="itemize">Имя переменной (лексической и динамической).
      </li>
      <li class="itemize">Формой вызова функции, у которой первый элемент принадлежит
      множеству указанному в следующей таблице:
      <div class="flushleft" 
>
<!--l. 5095--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" ><tt><a 
href="clmse88.html#x110-214002r506">aref</a></tt>   </td><td align="left" ><tt><a 
href="clmse79.html#x99-200002r393">car</a></tt>  </td><td align="left" ><tt><a 
href="clmse88.html#x110-214004r507">svref</a></tt>        </td><td align="left" >               </td></tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201006r427">nth</a></tt> </td> <td align="left" ><tt><a 
href="clmse79.html#x99-200004r394">cdr</a></tt> </td> <td align="left" ><tt><a 
href="clmse50.html#x65-156002r127">get</a></tt> </td> <td align="left" ></td>
</tr><tr><td align="left" ><tt><a 
href="clmse74.html#x93-194002r348">elt</a></tt>    </td><td align="left" ><tt><a 
href="clmse79.html#x99-200006r395">caar</a></tt> </td><td align="left" ><tt><a 
href="clmse50.html#x65-156008r130">getf</a></tt>         </td><td align="left" ><tt><a 
href="clmse34.html#x46-85004r53">symbol-value</a></tt>   </td>
</tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201028r438">rest</a></tt>   </td><td align="left" ><tt><a 
href="clmse79.html#x99-200008r396">cadr</a></tt> </td><td align="left" ><tt><a 
href="clmse85.html#x106-210006r491">gethash</a></tt>      </td><td align="left" ><tt><a 
href="clmse34.html#x46-85006r54">symbol-function</a></tt></td>
</tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201008r428">first</a></tt>  </td><td align="left" ><tt><a 
href="clmse79.html#x99-200010r397">cdar</a></tt> </td><td align="left" ><tt><a 
href="clmse140.html#x172-404017r847">documentation</a></tt></td><td align="left" ><tt><a 
href="clmse50.html#x65-156006r129">symbol-plist</a></tt>   </td>
</tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201010r429">second</a></tt> </td><td align="left" ><tt><a 
href="clmse79.html#x99-200012r398">cddr</a></tt> </td><td align="left" ><tt><a 
href="clmse91.html#x113-217004r531">fill-pointer</a></tt> </td><td align="left" ><tt><a 
href="clmse44.html#x57-143002r117">macro-function</a></tt> </td>
</tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201012r430">third</a></tt>  </td><td align="left" ><tt><a 
href="clmse79.html#x99-200014r399">caaar</a></tt></td><td align="left" ><tt><a 
href="clmse79.html#x99-200030r407">caaaar</a></tt>       </td><td align="left" ><tt><a 
href="clmse79.html#x99-200046r415">cdaaar</a></tt>         </td></tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201014r431">fourth</a></tt> </td> <td align="left" ><tt><a 
href="clmse79.html#x99-200016r400">caadr</a></tt></td> <td align="left" ><tt><a 
href="clmse79.html#x99-200032r408">caaadr</a></tt> </td> <td align="left" ><tt><a 
href="clmse79.html#x99-200048r416">cdaadr</a></tt></td>
</tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201016r432">fifth</a></tt>  </td><td align="left" ><tt><a 
href="clmse79.html#x99-200018r401">cadar</a></tt></td><td align="left" ><tt><a 
href="clmse79.html#x99-200034r409">caadar</a></tt>       </td><td align="left" ><tt><a 
href="clmse79.html#x99-200050r417">cdadar</a></tt>         </td></tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201018r433">sixth</a></tt> </td> <td align="left" ><tt><a 
href="clmse79.html#x99-200020r402">caddr</a></tt></td> <td align="left" ><tt><a 
href="clmse79.html#x99-200036r410">caaddr</a></tt> </td> <td align="left" ><tt><a 
href="clmse79.html#x99-200052r418">cdaddr</a></tt></td>
</tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201020r434">seventh</a></tt></td><td align="left" ><tt><a 
href="clmse79.html#x99-200022r403">cdaar</a></tt></td><td align="left" ><tt><a 
href="clmse79.html#x99-200038r411">cadaar</a></tt>       </td><td align="left" ><tt><a 
href="clmse79.html#x99-200054r419">cddaar</a></tt>         </td></tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201022r435">eighth</a></tt> </td> <td align="left" ><tt><a 
href="clmse79.html#x99-200024r404">cdadr</a></tt></td> <td align="left" ><tt><a 
href="clmse79.html#x99-200040r412">cadadr</a></tt> </td> <td align="left" ><tt><a 
href="clmse79.html#x99-200056r420">cddadr</a></tt></td>
</tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201024r436">ninth</a></tt>  </td><td align="left" ><tt><a 
href="clmse79.html#x99-200026r405">cddar</a></tt></td><td align="left" ><tt><a 
href="clmse79.html#x99-200042r413">caddar</a></tt>       </td><td align="left" ><tt><a 
href="clmse79.html#x99-200058r421">cdddar</a></tt>         </td></tr><tr><td align="left" ><tt><a 
href="clmse80.html#x100-201026r437">tenth</a></tt> </td> <td align="left" ><tt><a 
href="clmse79.html#x99-200028r406">cdddr</a></tt></td> <td align="left" ><tt><a 
href="clmse79.html#x99-200044r414">cadddr</a></tt> </td> <td align="left" ><tt><a 
href="clmse79.html#x99-200060r422">cddddr</a></tt></td>
</tr></table>
                                                                          

                                                                          
</div></div>
      </li>
      <li class="itemize">Формой вызова функции, у которой первый элемент является именем
      функции-селектора созданной с помощью <tt><a 
href="clmse97.html#x121-225002r561">defstruct</a></tt>.
      </li>
      <li class="itemize">Форма вызова функции, первый элемент которой является именем
      одной из следующих функций при условии, что указанный аргумент
      этой функции в свою очередь является формой <i>place</i>. in this case the
      new <i>place</i> has stored back into it the result of applying the speciﬁed
      “update” function (which is in each of these cases not a true update
      function): FIXME
      <div class="flushleft" 
>
<!--l. 5126--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" >Имя функции</td><td align="left" >Аргумент являющийся <i>местом</i></td><td align="left" >Функция изменения</td>
</tr><tr><td align="left" ><tt>char-bit</tt>    </td><td align="left" >ﬁrst                                       </td><td align="left" ><tt>set-char-bit</tt>      </td></tr><tr><td align="left" ><tt><a 
href="clmse67.html#x84-185008r275">ldb</a></tt> </td> <td align="left" >second </td> <td align="left" ><tt><a 
href="clmse67.html#x84-185014r278">dpb</a></tt></td>
</tr><tr><td align="left" ><tt><a 
href="clmse67.html#x84-185012r277">mask-field</a></tt>  </td><td align="left" >second                                   </td><td align="left" ><tt><a 
href="clmse67.html#x84-185016r279">deposit-field</a></tt>     </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr><td align="left" > </td></tr></table>
</div></div>
      </li>
      <li class="itemize">Форма декларации типа <tt><a 
href="clmse49.html#x63-153002r126">the</a></tt>, в таком случае декларация переносится на
      форму <i>newvalue</i>, и анализируется результирующая <tt><a 
href="#x47-89002r64">setf</a></tt> форма.
      Например: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setf (the integer (cadr x)) (+ y 3))
</td></tr></table>
      <!--l. 5142--><p class="noindent" >
</div>
</div>
      <!--l. 5143--><p class="noindent" >будет обработана как <div class=lisp><div class=tabbing>
                                                                          

                                                                          
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setf (cadr x) (the integer (+ y 3)))
</td></tr></table>
      <!--l. 5146--><p class="noindent" >
</div>
</div>
      </li>
      <li class="itemize">Вызов функции <tt><a 
href="clmse36.html#x48-94002r68">apply</a></tt>, в которой первый аргумент является функцией,
      которая может является <i>местом</i> для <tt><a 
href="#x47-89002r64">setf</a></tt>.
      </li>
      <li class="itemize">Макровызов, в случае чего <tt><a 
href="#x47-89002r64">setf</a></tt> разворачивает макровызов и затем
      анализирует полученную форму.
      </li>
      <li class="itemize">Любая форма, для которой было сделано определение с помощью
      <tt>defsetf</tt> или <tt>define-setf-method</tt>.</li></ul>
<tt>
<!--l. 5161--><p class="indent" >   <a 
href="#x47-89002r64">setf</a></tt> тщательно сохраняет обычный порядок выполнения подформ слева
направо. С другой стороны, точное раскрытие для какой-нибудь частной
формы не гарантируется и может зависеть от реализации. Все, что
гарантируется, это раскрытие <tt><a 
href="#x47-89002r64">setf</a></tt> формы в некоторую функцию
изменения, используемую данной реализацией, и выполнение подформ слева
направо.
<!--l. 5168--><p class="indent" >   Конечным результатом вычисления формы <tt><a 
href="#x47-89002r64">setf</a></tt> является значение
<i>newvalue</i>. Таким образом <tt>(setf (car x) y)</tt> раскрывается не прямо в
<tt>(rplaca x y)</tt>, а в что-то вроде <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((G1 x) (G2 y)) (rplaca G1 G2) G2)
</td></tr></table>
<!--l. 5173--><p class="indent" >
</div>
</div>
<!--l. 5174--><p class="noindent" >точное раскрытие зависит от реализации.
                                                                          

                                                                          
<!--l. 5176--><p class="indent" >   Пользователь может определить новое раскрытие для <tt><a 
href="#x47-89002r64">setf</a></tt> используя
<tt>defsetf</tt>.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> psetf </b><a 
 id="dx47-90001"></a><a 
 id="x47-90002r65"></a> {place newvalue}*
</td></tr></table>
<!--l. 5182--><p class="indent" >
</div>
<!--l. 5182--><p class="noindent" ><span class="paragraphHead"><a 
href="#x47-910007.2" id="x47-910007.2"></a></span>
   <tt><a 
href="#x47-90002r65">psetf</a></tt> похожа на <tt><a 
href="#x47-89002r64">setf</a></tt> за исключением того, что если указано более одной
пары <i>place</i>-<i>newvalue</i> , то присваивание местам новых значений происходит
параллельно. Если говорить точнее, то все подформы, которые должны
быть вычислены, вычисляются слева направо. После выполнения всех
вычислений, выполняются все присваивания в неопределённом порядке.
(Неопределённый порядок влияет на поведение в случае, если более одной
формы <i>place</i> ссылаются на одно и то же место.) <tt><a 
href="#x47-90002r65">psetf</a></tt> всегда возвращает
<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> shiftf </b><a 
 id="dx47-91001"></a><a 
 id="x47-91002r66"></a> {place}+  newvalue
</td></tr></table>
<!--l. 5196--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 5196--><p class="noindent" ><span class="paragraphHead"><a 
href="#x47-920007.2" id="x47-920007.2"></a></span>
   Каждая форма <i>place</i> может быть любой обобщённой переменной, как
для <tt><a 
href="#x47-89002r64">setf</a></tt>. В форме <tt>(shiftf <i>place1</i> <i>place2</i> ... <i>placen</i> <i>newvalue</i>)</tt>,
вычисляются и сохраняются значения с <i>place1</i> по <i>placen</i> и вычисляется
<i>newvalue</i>, как значение с номером <span class="math"><i>n</i> + 1</span>. Значения с 2-го по <span class="math"><i>n</i> + 1</span> сохраняются
в интервале с <i>place1</i> по <i>placen</i> и возвращается 1-ое значение (оригинальное
значение <i>place1</i>). Механизм работает как сдвиг регистров. <i>newvalue</i>
сдвигается с правой стороны, все значения сдвигаются влево на одну
позицию, и возвращается сдвигаемое самое левое значение <i>place1</i>. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x (list &#x2019;a &#x2019;b &#x2019;c)) <span class="math"> ⇒</span> (a b c)
</td></tr></table>
<!--l. 5208--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 5209--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(shiftf (cadr x) &#x2019;z) <span class="math"> ⇒</span> b</td></tr></table>
<!--l. 5210--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   and now x <span class="math"> ⇒</span> (a z c)</td></tr></table>
<!--l. 5211--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 5212--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(shiftf (cadr x) (cddr x) &#x2019;q) <span class="math"> ⇒</span> z</td></tr></table>
<!--l. 5213--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   and now x <span class="math"> ⇒</span> (a (c) . q)</td></tr></table>
<!--l. 5215--><p class="indent" >
</div>
</div>
<!--l. 5216--><p class="noindent" >Эффект от <tt>(shiftf <i>place1</i> <i>place2</i> ... <i>placen</i> <i>newvalue</i>)</tt> эквивалентен
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((<i>var1</i> <i>place1</i>)
</td></tr></table>
<!--l. 5219--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>var2</i> <i>place2</i>)</td></tr></table>
<!--l. 5220--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 5221--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>varn</i> <i>placen</i>))</td></tr></table>
<!--l. 5222--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setf <i>place1</i> <i>var2</i>)</td></tr></table>
<!--l. 5223--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setf <i>place2</i> <i>var3</i>)</td></tr></table>
<!--l. 5224--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 5225--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setf <i>placen</i> <i>newvalue</i>)</td></tr></table>
<!--l. 5226--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>var1</i>)</td></tr></table>
<!--l. 5228--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 5229--><p class="noindent" >за исключением того, что последний вариант выполняет все подформы для
каждого <i>place</i> дважды, тогда как <tt><a 
href="#x47-91002r66">shiftf</a></tt> выполняет только единожды.
Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq n 0)
</td></tr></table>
<!--l. 5233--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x &#x2019;(a b c d))</td></tr></table>
<!--l. 5234--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(shiftf (nth (setq n (+ n 1)) x) &#x2019;z) <span class="math"> ⇒</span> b</td></tr></table>
<!--l. 5235--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   теперь x <span class="math"> ⇒</span> (a z c d)</td></tr></table>
<!--l. 5236--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>but</i>
</td></tr></table>
<!--l. 5237--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq n 0)
</td></tr></table>
<!--l. 5238--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x &#x2019;(a b c d))</td></tr></table>
<!--l. 5239--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(prog1 (nth (setq n (+ n 1)) x)</td></tr></table>
<!--l. 5240--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (setf (nth (setq n (+ n 1)) x) &#x2019;z)) <span class="math"> ⇒</span> b</td></tr></table>
<!--l. 5241--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   и теперь x <span class="math"> ⇒</span> (a b z d)</td></tr></table>
<!--l. 5243--><p class="indent" >
</div>
</div>
<!--l. 5244--><p class="noindent" >Более того, для заданных форм <i>place</i> <tt><a 
href="#x47-91002r66">shiftf</a></tt> может быть более производительной,
чем версия с <tt><a 
href="clmse37.html#x49-96002r72">prog1</a></tt>.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> rotatef </b><a 
 id="dx47-92001"></a><a 
 id="x47-92002r67"></a> {place}*
</td></tr></table>
<!--l. 5250--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 5250--><p class="noindent" ><span class="paragraphHead"><a 
href="#x47-930007.2" id="x47-930007.2"></a></span>
   Каждая <i>place</i> может быть обобщённой переменной, как для <tt><a 
href="#x47-89002r64">setf</a></tt>. В форме
<tt>(rotatef <i>place1</i> <i>place2</i> ... <i>placen</i>)</tt>, вычисляются и сохраняются
значения c <i>place1</i> по <i>placen</i>. Механизм действует как круговой сдвиг
регистров влево, и значение <i>place1</i> сдвигается в конец на <i>placen</i>. Следует
отметить, что <tt>(rotatef <i>place1</i> <i>place2</i>)</tt> меняет значения между <i>place1</i> и
<i>place2</i>.
<!--l. 5259--><p class="indent" >   Эффект от использования <tt>(rotatef <i>place1</i> <i>place2</i> ... <i>placen</i>)</tt>
эквивалентен <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(psetf <i>place1</i> <i>place2</i>
</td></tr></table>
<!--l. 5262--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       <i>place2</i> <i>place3</i></td></tr></table>
<!--l. 5263--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       ...</td></tr></table>
<!--l. 5264--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       <i>placen</i> <i>place1</i>)</td></tr></table>
<!--l. 5266--><p class="indent" >
</div>
</div>
<!--l. 5267--><p class="noindent" >за исключением того, что в последнем вычисление форм происходит дважды,
тогда как <tt><a 
href="#x47-92002r67">rotatef</a></tt> выполняет только единожды. Более того, для заданных
форм <i>place</i> <tt><a 
href="#x47-92002r67">rotatef</a></tt> может быть более производительной, чем версия с
<tt><a 
href="clmse37.html#x49-96002r72">prog1</a></tt>.
<tt>
<!--l. 5271--><p class="indent" >   <a 
href="#x47-92002r67">rotatef</a></tt> всегда возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
</div>
<!--l. 5274--><p class="indent" >   Другие макрос, которые управляют обобщёнными переменными,
включают <tt><a 
href="clmse50.html#x65-156008r130">getf</a></tt>, <tt><a 
href="clmse50.html#x65-156010r131">remf</a></tt>, <tt><a 
href="clmse63.html#x80-177014r187">incf</a></tt>, <tt><a 
href="clmse63.html#x80-177016r188">decf</a></tt>, <tt><a 
href="clmse80.html#x100-201054r451">push</a></tt>, <tt><a 
href="clmse80.html#x100-203002r453">pop</a></tt>, <tt><a 
href="clmse144.html#x177-436002r910">assert</a></tt>, <tt><a 
href="clmse144.html#x177-439002r912">ctypecase</a></tt> и
<tt><a 
href="clmse144.html#x177-441002r914">ccase</a></tt>.
<!--l. 5279--><p class="indent" >   Макросы, которые управляют обобщёнными переменными, должны
гарантировать «явную» семантику: подформы обобщённых переменных
вычисляются точно столько раз, сколько они встречаются в выражении, и в
том же порядке, в котором встречаются.
<!--l. 5284--><p class="indent" >   В ссылках на обобщённые переменные, как в <tt><a 
href="#x47-91002r66">shiftf</a></tt>, <tt><a 
href="clmse63.html#x80-177014r187">incf</a></tt>, <tt><a 
href="clmse80.html#x100-201054r451">push</a></tt> и <tt><a 
href="#x47-89002r64">setf</a></tt>
или <tt><a 
href="clmse67.html#x84-185008r275">ldb</a></tt>, обобщённые переменные считываются и записываются в одну и ту
же ссылку. Сохранение порядка выполнения исходной программы и
количества выполнений чрезвычайно важно.
                                                                          

                                                                          
<b>
<!--l. 5289--><p class="indent" >   Остаток раздела далее не переведён</b>
                                                                          

                                                                          
<!--l. 5291--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse36.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse34.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse34.html#tailclmse34.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse35.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse35.html" >Вверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse35.html"></a>  </div> </div> 
</body></html> 
