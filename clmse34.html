<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Константы и переменные</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-30 23:01:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 4684--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse35.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#tailclmch7.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse34.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse34.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">7.1   </span> <a 
href="clm.html#QQ2-46-89" id="x46-820007.1">Константы и переменные</a></h3>
<!--l. 4688--><p class="noindent" >Так как некоторые Lisp&#x2019;овые объекты данных используются для отображения
программ, можно всегда обозначить константный объект данных
с помощью записи без приукрашательств формы данного объекта.
Однако порождается двусмысленность: константный это объект или
фрагмент кода. Эту двусмысленность разрешает специальная форма
                                                                          

                                                                          
<tt><a 
href="#x46-83002r51">quote</a></tt>.
<!--l. 4694--><p class="indent" >   В Common Lisp&#x2019;е присутствуют два вида переменных, а именно: обычные
переменные и имена функций. Между этими типами есть несколько сходств,
и в некоторых случаях для взаимодействия с ними используются похожие
функции, например <tt><a 
href="#x46-85011r56">boundp</a></tt> и <tt><a 
href="#x46-85013r57">fboundp</a></tt>. Однако для в большинстве случаев
два вида переменных используются для совсем разных целей: один указывает
на функции, макросы и специальные формы, и другие на объекты
данных.
<!--l. 4702--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.1.1   </span> <a 
href="clmli1.html#QQ2-46-90" id="x46-830007.1.1">Использование переменных</a></h4>
<!--l. 4704--><p class="noindent" >Значение обычной переменной может быть получено просто с помощью
записи его имени как формы, которая будет выполнена. Будет ли данное имя
распознано как имя специальной или лексической переменной зависит от
наличия или отсутствия соответствующей декларации <tt>special</tt>. Смотрите
главу <a 
href="clmch9.html#x60-1480009">9<!--tex4ht:ref: DECLAR --></a>.
<!--l. 4709--><p class="indent" >   Следующие функции и специальные формы позволяют ссылаться на
значения констант и переменных.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> quote </b><a 
 id="dx46-83001"></a><a 
 id="x46-83002r51"></a> object
</td></tr></table>
<!--l. 4714--><p class="indent" >
</div>
<!--l. 4714--><p class="noindent" ><span class="paragraphHead"><a 
href="#x46-840007.1.1" id="x46-840007.1.1"></a></span>
   <tt>(quote <i>x</i>)</tt> возвращает <i>x</i>. <i>object</i> не выполняется и может быть любым
объектом Lisp&#x2019;а. Конструкция позволяет записать в программе любой объект,
как константное значение. Например: <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq a 43)
</td></tr></table>
<!--l. 4721--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(list a (cons a 3)) <span class="math"> ⇒</span> (43 (43 . 3))</td></tr></table>
<!--l. 4722--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(list (quote a) (quote (cons a 3)) <span class="math"> ⇒</span> (a (cons a 3))</td></tr></table>
<!--l. 4724--><p class="indent" >
</div>
</div>
<!--l. 4725--><p class="noindent" >Так как <tt><a 
href="#x46-83002r51">quote</a></tt> форма так полезна, но записывать её трудоёмко, для неё
определена стандартная аббревиатура: любая форма <i>f </i> с предшествующей
одинарной кавычкой (<tt> &#x2019; </tt>) оборачивается формой <tt>(quote  )</tt> для создания
<tt>(quote <i>f</i>)</tt>. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x &#x2019;(the magic quote hack))
</td></tr></table>
<!--l. 4732--><p class="indent" >
</div>
</div>
<!--l. 4733--><p class="noindent" >обычно интерпретируется функцией <tt><a 
href="clmse109.html#x136-255003r634">read</a></tt>, как <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x (quote (the magic quote hack)))
</td></tr></table>
<!--l. 4736--><p class="indent" >
</div>
</div>
<!--l. 4737--><p class="noindent" >Смотрите раздел <a 
href="clmse108.html#x135-24900022.1.3">22.1.3<!--tex4ht:ref: MACRO-CHARACTERS-SECTION --></a>.
</div>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> function </b><a 
 id="dx46-84001"></a><a 
 id="x46-84002r52"></a> fn
</td></tr></table>
<!--l. 4742--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 4742--><p class="noindent" ><span class="paragraphHead"><a 
href="#x46-850007.1.1" id="x46-850007.1.1"></a></span>
   Значением <tt><a 
href="#x46-84002r52">function</a></tt> всегда является функциональной интерпретацией <i>fn</i>.
<i>fn</i> интерпретируется как, если бы она была использована на позиции
функции в форме вызова функции. В частности, если <i>fn</i> является символом,
возвращается определение функции, связанное с этим символом, смотрите
<tt><a 
href="#x46-85006r54">symbol-function</a></tt>. Если <i>fn</i> является лямбда-выражением, тогда возвращается
«лексическое замыкание», это значит функция, которая при вызове
выполняет тело лямбда-выражения таким образом, чтобы правила
лексического контекста выполнялись правильно.
<div class=newer>
<!--l. 4754--><p class="indent" >   X3J13 проголосовал в марте 1989 <a 
 id="dx46-85001"></a>расширить функцию <tt><a 
href="#x46-84002r52">function</a></tt> до
принятия любого имени функции (символ или список, <i>car</i> элементы которого
является <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>—смотрите раздел <a 
href="#x46-820007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>) Также принимает принимает
лямбда-выражение. Так можно записать <tt>(function (setf cadr))</tt> для
ссылки на функцию раскрытия <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> для <tt><a 
href="clmse79.html#x99-200002r393">car</a></tt>.
</div>
<a 
 id="dx46-85002"></a>
<!--l. 4764--><p class="indent" >   Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun adder (x) (function (lambda (y) (+ x y))))
</td></tr></table>
<!--l. 4767--><p class="indent" >
</div>
</div>
<!--l. 4768--><p class="noindent" >Результат <tt>(adder 3)</tt> является функцией, которая добавляет <tt>3</tt> к её аргументу:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq add3 (adder 3))
</td></tr></table>
<!--l. 4771--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(funcall add3 5) <span class="math"> ⇒</span> 8</td></tr></table>
<!--l. 4773--><p class="indent" >
</div>
</div>
<!--l. 4774--><p class="noindent" >Это работает, потому что <tt><a 
href="#x46-84002r52">function</a></tt> создаёт замыкание над внутренним
лямбда-выражением, которое может ссылаться на значение <tt>3</tt> переменной <tt>x</tt>
даже после того, как выполнение вышло из функции <tt>adder</tt>.
                                                                          

                                                                          
<!--l. 4778--><p class="indent" >   Если посмотреть глубже, то лексическое замыкание обладает возможностью
ссылаться на лексически видимые <i>связывание</i>, а не просто на значения.
Рассмотрим такой код: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun two-funs (x)
</td></tr></table>
<!--l. 4782--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (list (function (lambda () x))</td></tr></table>
<!--l. 4783--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (function (lambda (y) (setq x y)))))</td></tr></table>
<!--l. 4784--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq funs (two-funs 6))</td></tr></table>
<!--l. 4785--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(funcall (car funs)) <span class="math"> ⇒</span> 6</td></tr></table>
<!--l. 4786--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(funcall (cadr funs) 43) <span class="math"> ⇒</span> 43</td></tr></table>
<!--l. 4787--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(funcall (car funs)) <span class="math"> ⇒</span> 43</td></tr></table>
<!--l. 4789--><p class="indent" >
</div>
</div>
<!--l. 4790--><p class="noindent" >Функция <tt>two-funs</tt> возвращает список двух функций, каждая из которых
ссылается на <i>связывание</i> переменной <tt>x</tt>, созданной в момент входа в
функцию <tt>two-funs</tt>, когда она была вызвана с аргументом <tt>6</tt>. Это
связывание сначала имеет значение <tt>6</tt>, но <tt><a 
href="#x46-86002r59">setq</a></tt> может изменить связывание.
Лексическое замыкание для первого лямбда-выражения не является
«создаёт снимок» значения <tt>6</tt> для <tt>x</tt> при создании замыкания. Вторая
функция может использоваться для изменения связывания (на <tt>43</tt>
например), и это изменённое значение станет доступным в первой
функции.
<!--l. 4799--><p class="indent" >   В ситуации, когда замыкание лямбда-выражения над одним и тем же
множеством связываний может создаваться несколько раз, эти полученные
разные замыкания могут быть равны или не равны <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt> в зависимости от
реализации. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((x 5) (funs &#x2019;()))
</td></tr></table>
<!--l. 4804--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (dotimes (j 10)</td></tr></table>
<!--l. 4805--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (push #&#x2019;(lambda (z)</td></tr></table>
<!--l. 4806--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              (if (null z) (setq x 0) (+ x z)))</td></tr></table>
<!--l. 4807--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          funs))</td></tr></table>
<!--l. 4808--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  funs)</td></tr></table>
                                                                          

                                                                          
<!--l. 4810--><p class="indent" >
</div>
</div>
<!--l. 4811--><p class="noindent" >Результат данного выражения является списком десяти замыканий. Каждое
логически требует только связывания <tt>x</tt>. В любом случае это одно
и то же связывание, но десять замыканий могут быть равны или
не равны <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt> друг другу. С другой стороны, результат выражения
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((funs &#x2019;()))
</td></tr></table>
<!--l. 4817--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (dotimes (j 10)</td></tr></table>
<!--l. 4818--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (let ((x 5))</td></tr></table>
<!--l. 4819--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (push (function (lambda (z)</td></tr></table>
<!--l. 4820--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                        (if (null z) (setq x 0) (+ x z))))</td></tr></table>
<!--l. 4821--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            funs)))</td></tr></table>
<!--l. 4822--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  funs)</td></tr></table>
<!--l. 4824--><p class="indent" >
</div>
</div>
<!--l. 4825--><p class="noindent" >также является списком из десяти замыканий. Однако в этом случае, но одна из
пар замыканий не будет равна <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt>, потому что каждое замыкание имеет своё
связывание <tt>x</tt> отличное от другого. Связывания отличаются, так как в
замыкании используется <tt><a 
href="#x46-86002r59">setq</a></tt>.
<!--l. 4830--><p class="indent" >   Вопрос различного поведения важен, поэтому рассмотрим следующее
простое выражение: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((funs &#x2019;()))
</td></tr></table>
<!--l. 4832--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (dotimes (j 10)</td></tr></table>
<!--l. 4833--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (let ((x 5))</td></tr></table>
<!--l. 4834--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (push (function (lambda (z) (+ x z)))</td></tr></table>
<!--l. 4835--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            funs)))</td></tr></table>
<!--l. 4836--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  funs)</td></tr></table>
<!--l. 4838--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 4839--><p class="noindent" >Результатом является десять замыканий, которые <i>могут</i> быть равны <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt>
попарно. Однако, можно подумать что связывания <tt>x</tt> для каждого замыкания
разные, так как создаются в цикле, но связывания не могут различаться,
потому что их значения идентичны и неизменяемы (иммутабельны), в
замыканиях отсутствует <tt><a 
href="#x46-86002r59">setq</a></tt> для <tt>x</tt>. Компилятор может в таких случаях
оптимизировать выражение так: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((funs &#x2019;()))
</td></tr></table>
<!--l. 4846--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (dotimes (j 10)</td></tr></table>
<!--l. 4847--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (push (function (lambda (z) (+ 5 z)))</td></tr></table>
<!--l. 4848--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          funs))</td></tr></table>
<!--l. 4849--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  funs)</td></tr></table>
<!--l. 4851--><p class="indent" >
</div>
</div>
<!--l. 4852--><p class="noindent" >после чего, в конце концов, замыкания точно могут быть равны. Общее правило
такое, что реализация может в двух различных случаях выполнения формы
<tt><a 
href="#x46-84002r52">function</a></tt> вернуть идентичные (<tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt>) замыкания, если она может доказать, что
два концептуально различающихся замыкания по факту ведут себя
одинаково при одинаковых параметрах вызова. Это просто разрешается для
оптимизации. Полностью корректная реализация может каждый раз при
выполнении формы <tt><a 
href="#x46-84002r52">function</a></tt> возвращать новое замыкание не равное <tt><a 
href="clmse32.html#x43-77002r44">eq</a></tt>
другим.
<!--l. 4861--><p class="indent" >   Часто компилятор может сделать вывод, что замыкание по факту не
нуждается в замыкании над какими-либо связываниями переменных.
Например, в фрагменте кода <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mapcar (function (lambda (x) (+ x 2))) y)
</td></tr></table>
<!--l. 4866--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 4867--><p class="noindent" >функция <tt>(lambda (x) (+ x 2))</tt> не содержит ссылок на какие-либо внешние
сущности. В этом важном случае, одно и то же «замыкание» может быть
использовано в качестве результата всех выполнений специальной формы
<tt><a 
href="#x46-84002r52">function</a></tt>. Несомненно, данное значение может и не быть объектом
замыкания. Оно может быть просто скомпилированной функцией,
не содержащей информации об окружении. Данный пример просто
является частным случаем предыдущего разговора и включён в качестве
подсказки для разработчиков знакомых с предыдущими методами
реализации Lisp&#x2019;а. Различие между замыканиями и другими видами
функций слегка размыто, Common Lisp не определяет отображения
для замыканий и метода различия замыканий и простых функций.
Все что имеет значение, это соблюдение правил лексической области
видимости.
<!--l. 4880--><p class="indent" >   Так как форма <tt><a 
href="#x46-84002r52">function</a></tt> используются часто, но её запись длинная,
для неё определена стандартная аббревиатура: любая форма <i>f </i> с
предшествующими #&#x2019; разворачивается в форму <tt>(function <i>f</i>)</tt>. Например,
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remove-if #&#x2019;numberp &#x2019;(1 a b 3))
</td></tr></table>
<!--l. 4886--><p class="indent" >
</div>
</div>
<!--l. 4887--><p class="noindent" >обычно интерпретируется функцией <tt><a 
href="clmse109.html#x136-255003r634">read</a></tt> как <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remove-if (function numberp) &#x2019;(1 a b 3))
</td></tr></table>
<!--l. 4890--><p class="indent" >
</div>
</div>
<!--l. 4891--><p class="noindent" >Смотрите раздел <a 
href="clmse108.html#x135-25000022.1.4">22.1.4<!--tex4ht:ref: SHARP-SIGN-MACRO-CHARACTER-SECTION --></a>.
</div>
<div class=defun>
<!--l. 4894--><p class="noindent" ><i>[Функция]</i><a 
 id="dx46-85003"></a><a 
 id="x46-85004r53"></a><b> symbol-value</b>  <i>symbol</i>
<!--l. 4896--><p class="noindent" ><tt><a 
href="#x46-85004r53">symbol-value</a></tt> возвращает текущее значение динамической (специальной)
                                                                          

                                                                          
переменной с именем <i>symbol</i>. Если символ не имеет значения, возникает
ошибка. Смотрите <tt><a 
href="#x46-85011r56">boundp</a></tt> и <tt><a 
href="#x46-88004r62">makunbound</a></tt>. Следует отметить, что константные
символы являются переменными, которые не могут быть изменены, таким
образом <tt><a 
href="#x46-85004r53">symbol-value</a></tt> может использоваться для получения значения
именованной константы. <tt><a 
href="#x46-85004r53">symbol-value</a></tt> от ключевого символа будет
возвращать этот ключевой символ.
<tt>
<!--l. 4906--><p class="indent" >   <a 
href="#x46-85004r53">symbol-value</a></tt> не может получить доступ к значению лексической
переменной.
<!--l. 4908--><p class="indent" >   В частности, эта функция полезна для реализации интерпретаторов для
встраиваемых языков в Lisp&#x2019;е. Соответствующая функция присваивания <tt><a 
href="#x46-88002r61">set</a></tt>.
Кроме того, можно пользоваться конструкцией <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> с <tt><a 
href="#x46-85004r53">symbol-value</a></tt>.
</div>
<div class=defun>
<!--l. 4914--><p class="noindent" ><i>[Функция]</i><a 
 id="dx46-85005"></a><a 
 id="x46-85006r54"></a><b> symbol-function</b>  <i>symbol</i>
<!--l. 4916--><p class="noindent" ><tt><a 
href="#x46-85006r54">symbol-function</a></tt> возвращает текущее глобальное определение функции с
именем <i>symbol</i>. В случае если символ не имеет определения функции
сигнализируется ошибка, смотрите <tt><a 
href="#x46-85013r57">fboundp</a></tt>. Следует отметить что
определение может быть функцией или объектом отображающим
специальную форму или макрос. Однако, в последнем случае, попытка
вызова объекта как функции будет является ошибкой. Лучше всего заранее
проверить символ с помощью <tt><a 
href="clmse44.html#x57-143002r117">macro-function</a></tt> и <tt><a 
href="#x46-85015r58">special-operator-p</a></tt> и
только затем вызвать функциональное значение, если оба предыдущих теста
вернули ложь.
<!--l. 4927--><p class="indent" >   Эта функция полезна, в частности, для реализации интерпретаторов
языков встроенных в Lisp.
<tt>
<!--l. 4930--><p class="indent" >   <a 
href="#x46-85006r54">symbol-function</a></tt> не может получить доступ к значению имени
лексической функции, созданной с помощью <tt><a 
href="clmse38.html#x50-102002r77">flet</a></tt> или <tt><a 
href="clmse38.html#x50-102004r78">labels</a></tt>. Она может
получать только глобальное функциональное значение.
<!--l. 4934--><p class="indent" >   Глобальное определение функции для некоторого символа может быть
изменено с помощью <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> и <tt><a 
href="#x46-85006r54">symbol-function</a></tt>. При использовании этой
операции символ будет иметь <i>только</i> заданное определение в качестве
своего глобального функционального значения. Любое предыдущее
определение, было ли оно макросом или функцией, будет потеряно. Попытка
переопределения специальной формы (смотрите таблицу ??) будет является
ошибкой.
</div>
                                                                          

                                                                          
<div class=newer>
<div class=defun>
<!--l. 4944--><p class="noindent" ><i>[Функция]</i><a 
 id="dx46-85007"></a><a 
 id="x46-85008r55"></a><b> fdeﬁnition</b>  <i>function-name</i>
<!--l. 4946--><p class="noindent" >X3J13 проголосовал в марте 1989 <a 
 id="dx46-85009"></a>добавить в язык функцию <tt><a 
href="#x46-85008r55">fdefinition</a></tt>.
Она похожа на <tt><a 
href="#x46-85006r54">symbol-function</a></tt> за исключением того, что её аргументы
может быть любым именем функции (символ или списка, у которого <i>car</i>
элемент равен <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>—смотрите раздел <a 
href="#x46-820007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>). Функция возвращает текущее
глобальное значение определения функции с именем <i>function-name</i>. Можно
использовать <tt><a 
href="#x46-85008r55">fdefinition</a></tt> вместе с <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt> для изменения глобального
определения функции связанной с переданным в параметре именем.
</div>
</div>
<div class=defun>
<!--l. 4959--><p class="noindent" ><i>[Функция]</i><a 
 id="dx46-85010"></a><a 
 id="x46-85011r56"></a><b> boundp</b>  <i>symbol</i>
<!--l. 4961--><p class="noindent" ><tt><a 
href="#x46-85011r56">boundp</a></tt> является истиной, если динамическая (специальная) переменная с
именем <i>symbol</i> имеет значение, иначе возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<!--l. 4965--><p class="indent" >   Смотрите также <tt><a 
href="#x46-88002r61">set</a></tt> и <tt><a 
href="#x46-88004r62">makunbound</a></tt>.
</div>
<div class=defun>
<!--l. 4968--><p class="noindent" ><i>[Функция]</i><a 
 id="dx46-85012"></a><a 
 id="x46-85013r57"></a><b> fboundp</b>  <i>symbol</i>
<!--l. 4970--><p class="noindent" ><tt><a 
href="#x46-85013r57">fboundp</a></tt> является истиной, если символ имеет глобальное определение
функции. Следует отметить, что <tt><a 
href="#x46-85013r57">fboundp</a></tt> является истиной, если символ
указывает на специальную форму или макрос. <tt><a 
href="clmse44.html#x57-143002r117">macro-function</a></tt>
и <tt><a 
href="#x46-85015r58">special-operator-p</a></tt> могут использоваться для проверки таких
случаев.
<!--l. 4977--><p class="indent" >   Смотрите также <tt><a 
href="#x46-85006r54">symbol-function</a></tt> и <tt><a 
href="#x46-88006r63">fmakunbound</a></tt>.
</div>
<div class=defun>
<!--l. 4980--><p class="noindent" ><i>[Функция]</i><a 
 id="dx46-85014"></a><a 
 id="x46-85015r58"></a><b> special-operator-p</b>  <i>symbol</i>
<!--l. 4982--><p class="noindent" >Функция <tt><a 
href="#x46-85015r58">special-operator-p</a></tt> принимает символ. Если символ указывает
на специальную форму, тогда возвращается значение не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, иначе
возвращается <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Возвращённое не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> значение является функцией,
которая может быть использована для интерпретации (вычисления)
специальной формы. FIXME
<!--l. 4989--><p class="indent" >   Возможно также то, что <i>обе</i> функции <tt><a 
href="#x46-85015r58">special-operator-p</a></tt> и
<tt><a 
href="clmse44.html#x57-143002r117">macro-function</a></tt> будут истинными для одного и того же символа. Это
потому, что реализация может иметь любой макрос как специальную
форму для скорости. С другой стороны, определение макроса должно
                                                                          

                                                                          
быть доступно для использования программами, которые понимают
только стандартные специальные формы, перечисленные в таблице ??.
FIXME
</div>
<!--l. 4997--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.1.2   </span> <a 
href="clmli1.html#QQ2-46-93" id="x46-860007.1.2">Присваивание</a></h4>
<!--l. 4999--><p class="noindent" >Следующая функциональность позволяет изменять значение переменной
(если быть точнее, значению соединённому с текущим связыванием
переменной). Такое изменение отличается от создания нового связывания.
Конструкции для создания новых связываний переменных описаны в
разделе <a 
href="clmse38.html#x50-990007.5">7.5<!--tex4ht:ref: VAR-BINDING-SECTION --></a>.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> setq </b><a 
 id="dx46-86001"></a><a 
 id="x46-86002r59"></a> {var form}*
</td></tr></table>
<!--l. 5007--><p class="indent" >
</div>
<!--l. 5007--><p class="noindent" ><span class="paragraphHead"><a 
href="#x46-870007.1.2" id="x46-870007.1.2"></a></span>
   Специальная форма <tt>(setq <i>var1</i> <i>form1</i> <i>var2</i> <i>form2</i> ...)</tt> является
«конструкцией присваивания простых переменных» Lisp&#x2019;а. Вычисляется
первая форма <i>form1</i> и результат сохраняется в переменной <i>var1</i>,
затем вычисляется <i>form2</i> и результат сохраняется в переменной <i>var2</i>,
и так далее. Переменные, конечно же, представлены символами, и
интерпретируются как ссылки к динамическим или статическим переменным
в соответствии с обычными правилами. Таким образов <tt><a 
href="#x46-86002r59">setq</a></tt> может быть
использована для присваивания как лексических, так и специальных
переменных.
<tt>
<!--l. 5018--><p class="indent" >   <a 
href="#x46-86002r59">setq</a></tt> возвращает последнее присваиваемое значение, другими словами,
результат вычисления последнего аргумента. В другом случае, форма <tt>(setq)</tt>
                                                                          

                                                                          
является корректной и возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. В форме должно быть чётное
количество форм аргументов. Например, в <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x (+ 3 2 1) y (cons x nil))
</td></tr></table>
<!--l. 5025--><p class="indent" >
</div>
</div>
<tt>
<!--l. 5026--><p class="noindent" >x</tt> устанавливается в <tt>6</tt>, <tt>y</tt> в <tt>(6)</tt>, и <tt><a 
href="#x46-86002r59">setq</a></tt> возвращает <tt>(6)</tt>. Следует отметить, что
первое присваивание выполняется перед тем, как будет выполнено второе,
тем самым каждое следующее присваивание может использовать значение
предыдущих.
<div class=newer>
<!--l. 5032--><p class="indent" >   Смотрите также описание <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>, «общая конструкция присваивания»
Common Lisp&#x2019;а, которая позволяет присваивать значения переменным,
элементам массива, и другим местам.
<!--l. 5036--><p class="indent" >   Некоторые программисты выбирают путь отречения от <tt><a 
href="#x46-86002r59">setq</a></tt>, и всегда
используют <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>. Другие используют <tt><a 
href="#x46-86002r59">setq</a></tt> для простых переменных и <tt><a 
href="clmse35.html#x47-89002r64">setf</a></tt>
для всех остальных.
</div>
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> psetq </b><a 
 id="dx46-87001"></a><a 
 id="x46-87002r60"></a> {var form}*
</td></tr></table>
<!--l. 5044--><p class="indent" >
</div>
<!--l. 5044--><p class="noindent" ><span class="paragraphHead"><a 
href="#x46-880007.1.2" id="x46-880007.1.2"></a></span>
   Форма <tt><a 
href="#x46-87002r60">psetq</a></tt> похожа на форму <tt><a 
href="#x46-86002r59">setq</a></tt> за исключением того, что выполняет
присваивание параллельно. Сначала выполняются все формы, а затем
                                                                          

                                                                          
переменные получают значения этих форм. Значение формы <tt><a 
href="#x46-87002r60">psetq</a></tt> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq a 1)
</td></tr></table>
<!--l. 5050--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq b 2)</td></tr></table>
<!--l. 5051--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(psetq a b b a)</td></tr></table>
<!--l. 5052--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">a <span class="math"> ⇒</span> 2</td></tr></table>
<!--l. 5053--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">b <span class="math"> ⇒</span> 1</td></tr></table>
<!--l. 5055--><p class="indent" >
</div>
</div>
<!--l. 5056--><p class="noindent" >В этом примере, значения <tt>a</tt> и <tt>b</tt> меняются местами с помощью параллельного
присваивания. (Если несколько переменных должны быть присвоены
параллельно в рамках цикла, целесообразнее использовать конструкцию
<tt><a 
href="clmse131.html#x161-329002r796">do</a></tt>.)
<!--l. 5061--><p class="indent" >   Смотрите также описание <tt><a 
href="clmse35.html#x47-90002r65">psetf</a></tt>, «общая конструкция параллельного
присваивания» Common Lisp&#x2019;а, которая позволяет присваивать переменным,
элементам массива, и другим местам.
</div>
<div class=defun>
<!--l. 5066--><p class="noindent" ><i>[Функция]</i><a 
 id="dx46-88001"></a><a 
 id="x46-88002r61"></a><b> set</b>  <i>symbol</i> <i>value</i>
<!--l. 5068--><p class="noindent" ><tt><a 
href="#x46-88002r61">set</a></tt> позволяет изменить значение динамической (специальной) переменной.
<tt><a 
href="#x46-88002r61">set</a></tt> устанавливает динамической переменной с именем <i>symbol</i> значение
<i>value</i>.
<!--l. 5073--><p class="indent" >   Изменено будет только значение текущего динамического связывания.
Если такого связывания нет, будет изменено наиболее глобальное значение.
Например, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(set (if (eq a b) &#x2019;c &#x2019;d) &#x2019;foo)
</td></tr></table>
<!--l. 5078--><p class="indent" >
</div>
</div>
<!--l. 5079--><p class="noindent" >установит значение <tt>с</tt> в <tt>foo</tt> или <tt><a 
href="clmse41.html#x53-119004r92">do*</a></tt> в <tt>foo</tt>, в зависимости от результата проверки
<tt>(eq a b)</tt>.
                                                                          

                                                                          
<tt>
<!--l. 5082--><p class="indent" >   <a 
href="#x46-88002r61">set</a></tt> в качестве результата возвращает значение <i>value</i>.
<tt>
<!--l. 5084--><p class="indent" >   <a 
href="#x46-88002r61">set</a></tt> не может изменить значение локальной (лексически связанной)
переменной. Обычно для изменения переменных (лексических или
динамических) используется специальная форма <tt><a 
href="#x46-86002r59">setq</a></tt>. <tt><a 
href="#x46-88002r61">set</a></tt> полезна в
частности для реализации интерпретаторов языков встроенных в Lisp.
Смотрите также <tt><a 
href="clmse38.html#x50-101002r76">progv</a></tt>, конструкция, которая создаёт связывания, а не
присваивания динамических переменных.
</div>
<div class=defun>
<!--l. 5094--><p class="noindent" ><i>[Функция]</i><a 
 id="dx46-88003"></a><a 
 id="x46-88004r62"></a><b> makunbound</b>  <i>symbol</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx46-88005"></a><a 
 id="x46-88006r63"></a><b> fmakunbound</b>  <i>symbol</i>
<!--l. 5097--><p class="noindent" ><tt><a 
href="#x46-88004r62">makunbound</a></tt> упраздняет связывание динамической (специальной) переменной
заданной символом <i>symbol</i> (упраздняет значение). <tt><a 
href="#x46-88006r63">fmakunbound</a></tt> аналогично
упраздняет связь символа с глобальным определением функции. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq a 1)
</td></tr></table>
<!--l. 5103--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">a <span class="math"> ⇒</span> 1</td></tr></table>
<!--l. 5104--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(makunbound &#x2019;a)</td></tr></table>
<!--l. 5105--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">a <span class="math"> ⇒</span> ошибка</td></tr></table>
<!--l. 5106--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 5107--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x) (+ x 1))</td></tr></table>
<!--l. 5108--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 4) <span class="math"> ⇒</span> 5</td></tr></table>
<!--l. 5109--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(fmakunbound &#x2019;foo)</td></tr></table>
<!--l. 5110--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(foo 4) <span class="math"> ⇒</span> ошибка</td></tr></table>
<!--l. 5112--><p class="indent" >
</div>
</div>
<!--l. 5113--><p class="noindent" >Обе функции возвращают символ <i>symbol</i> в качестве результата.
</div>
                                                                          

                                                                          
   <!--l. 5116--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse35.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#tailclmch7.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse34.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse34.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 5116--><p class="indent" >   <a 
 id="tailclmse34.html"></a>   
</body></html> 
