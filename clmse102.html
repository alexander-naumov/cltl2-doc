<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Опции defstruct</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-19 16:08:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1501--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse103.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse101.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse101.html#tailclmse101.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse102.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse102.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">19.5   </span> <a 
href="clm.html#QQ2-126-259" id="x126-23100019.5">Опции defstruct</a></h3>
<!--l. 1505--><p class="noindent" >Предыдущее описание <a 
href="clmse99.html#x123-227002r580">defstruct</a> достаточно для среднестатистического
использования. Оставшуюся часть этой главы занимает описание более
сложных возможностей функционала <a 
href="clmse99.html#x123-227002r580">defstruct</a>.
<!--l. 1509--><p class="indent" >   Данный раздел объясняет каждую опцию, которая может быть
использована в <a 
href="clmse99.html#x123-227002r580">defstruct</a>. Опция для <a 
href="clmse99.html#x123-227002r580">defstruct</a> может быть или ключевым
символом, или списком из ключевого символа и аргумента для него. (Следует
отметить, что синтаксис для опций <a 
href="clmse99.html#x123-227002r580">defstruct</a> отличается от синтаксиса
пар, используемых для опций слота. Никакая часть этих опций не
вычисляется.)
<div class=flushdesc>
<!--l. 1518--><p class="indent" >
      <ul><li><b>
:conc-name </b></li>Данная  опция  предоставляет  префикс  для  имён  функций
      доступа. По соглашению, имена всех функций доступа к слотам
      структура   начинаются   с   префикса   —   имени   структуры   с
      последующим дефисом. Это поведение по-умолчанию.
      <!--l. 1525--><p class="noindent" >Аргумент :conc-name указывает альтернативный префикс. (Если
      в  качестве  разделителя  используется  дефис,  он  указывается
      как  часть  префикса.)  Если  в  качестве  аргумента  указано  <a 
href="clmse31.html#x42-74002r18">nil</a>,
      тогда префикс не устанавливается вообще. Тогда имена функций
      доступа совпадают с именами слотов, и это повод давать слотам
      информативные имена.
      <!--l. 1532--><p class="noindent" >Следует отметить, что не зависимо от того, что указана в :conc-name, в
      функции-конструкторе используются ключевые символы, совпадающие
      с именами слотов без присоединяемого префикса. С другой стороны
      префикс используется в именах функций доступа. Например:
      <div class=lisp><div class=tabbing>
                                                                          

                                                                          
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defstruct door knob-color width material)
</td></tr></table>
      <!--l. 1537--><p class="noindent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setq my-door</td></tr></table>
      <!--l. 1538--><p class="noindent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">      (make-door :knob-color &#x2019;red :width 5.0))</td></tr></table>
      <!--l. 1539--><p class="noindent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(door-width my-door) <span class="math"> ⇒</span> 5.0</td></tr></table>
      <!--l. 1540--><p class="noindent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setf (door-width my-door) 43.7)</td></tr></table>
      <!--l. 1541--><p class="noindent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(door-width my-door) <span class="math"> ⇒</span> 43.7</td></tr></table>
      <!--l. 1542--><p class="noindent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(door-knob-color my-door) <span class="math"> ⇒</span> red</td></tr></table>
      <!--l. 1544--><p class="noindent" >
</div>
</div>
      <li><b>
:constructor </b></li>Данная опция принимает один аргумент, символ, который
      указывает имя функции-конструктора. Если аргумент не предоставлен,
      или если опция не указана, имя конструктора создаётся соединением
      строки &#x0022;MAKE-&#x0022; и имени структуры, и помещается в текущий
      пакет в время выполнения формы <a 
href="clmse99.html#x123-227002r580">defstruct</a> (смотрите <a 
href="clmse60.html#x76-168002r141">*package*</a>).
      Если аргумент указан и равен , то функция конструктор не
      создаётся.
      <!--l. 1553--><p class="noindent" >Эта опция имеет более сложный синтаксис, описываемый в
      разделе <a 
href="clmse103.html#x127-23200019.6">19.6<!--tex4ht:ref: DEFSTRUCT-CONSTRUCTOR-SYNTAX --></a>.
      <li><b>
:copier </b></li>Данная опция принимает один аргумент, символ, который указывает
      имя функции копирования. Если аргумент не предоставлен, или если
      опция не указана, имя функции копирования создаётся соединением
      строки &#x0022;COPY-&#x0022; и имени структуры, и помещается в текущий
      пакет в время выполнения формы <a 
href="clmse99.html#x123-227002r580">defstruct</a> (смотрите <a 
href="clmse60.html#x76-168002r141">*package*</a>).
      Если аргумент указан и равен , то функция копирования не
      создаётся.
      <!--l. 1564--><p class="noindent" >Автоматически создаваемая функция копирования просто создаёт
      новую структуру и переносит все компоненты из структуры аргумента в
      свеже создаваемую структуру. Копирование самих компонентов
                                                                          

                                                                          
      структуры не производится. Соответствующие элементы старой и новой
      структуры равны <a 
href="clmse33.html#x44-78004r45">eql</a> между собой.
      <li><b>
:predicate </b></li>Эта опция принимает один аргумент, который задаёт имя
      предиката типа. Если аргумент не указан, или если не указана опция,
      то имя предиката создаётся соединением имени структуры и строки
      &#x0022;-P&#x0022;, помещая имя в текущий пакет на момент вычисления формы
      <a 
href="clmse99.html#x123-227002r580">defstruct</a> (смотрите <a 
href="clmse60.html#x76-168002r141">*package*</a>). Если указанный аргумент равен <a 
href="clmse31.html#x42-74002r18">nil</a>,
      предикат не создаётся. Предикат может быть определён, только если
      структура имеет «имя». Если указана опция :type и не указана :named,
      тогда опция :predicate не должна использоваться или должна иметь
      значение <a 
href="clmse31.html#x42-74002r18">nil</a>.
      <li><b>
:include </b></li>Эта опция используется для создания нового определения структуры
      как расширения для старого определения структуры. В качестве
      примера, предположим у вас есть структура, называемая person,
      которая выглядит так: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defstruct person name age sex)
</td></tr></table>
      <!--l. 1585--><p class="noindent" >
</div>
</div>
      <!--l. 1586--><p class="noindent" >Теперь, предположим, вы хотите создать новую структуру для
      представления астронавта. Так как астронавт также человек, вы
      хотите, чтобы он также имел свойства имя, возраст и пол, и вы хотите
      чтобы Lisp&#x2019;овые функции работали со структурами astronaut также как
      и с структурами person. Вы можете сделать это определив структуру
      astronaut с опцией :include, так: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defstruct (astronaut (:include person)
</td></tr></table>
                                                                          

                                                                          
      <!--l. 1593--><p class="noindent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                      (:conc-name astro-))</td></tr></table>
      <!--l. 1594--><p class="noindent" >                                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">   helmet-size</td></tr></table>
      <!--l. 1595--><p class="noindent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">   (favorite-beverage &#x2019;tang))</td></tr></table>
      <!--l. 1597--><p class="noindent" >
</div>
</div>
      <!--l. 1599--><p class="noindent" >Опция :include заставляет структуру, будучи определённой, иметь те же
      слоты, что и включаемая структура из опции. Это осуществляется с
      помощью того, что функции доступа включаемой структуры будут
      также работать с определяемой структурой. Таким образом, в этом
      примере, astronaut будет иметь пять слотов: три определены в person и
      два в самом astronaut. Функции доступа, определённые с помощью
      структуры person, могут применяться к экземплярам структуры
      astronaut, и будут корректно работать. Более того, astronaut будет
      иметь свои функции доступа для компонентов унаследованных от
      структуры person. Следующий пример иллюстрирует то, как вы можете
      использовать структуры astronaut: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setq x (make-astronaut :name &#x2019;buzz
</td></tr></table>
      <!--l. 1612--><p class="noindent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                        :age 45</td></tr></table>
      <!--l. 1613--><p class="noindent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                        :sex t</td></tr></table>
      <!--l. 1614--><p class="noindent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                        :helmet-size 17.5))</td></tr></table>
      <!--l. 1615--><p class="noindent" >                                                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing"></td></tr></table>
      <!--l. 1616--><p class="noindent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(person-name x) <span class="math"> ⇒</span> buzz</td></tr></table>
      <!--l. 1617--><p class="noindent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(astro-name x) <span class="math"> ⇒</span> buzz</td></tr></table>
      <!--l. 1618--><p class="noindent" >                                                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing"></td></tr></table>
      <!--l. 1619--><p class="noindent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(astro-favorite-beverage x) <span class="math"> ⇒</span> tang</td></tr></table>
      <!--l. 1621--><p class="noindent" >
                                                                          

                                                                          
</div>
</div>
      <!--l. 1622--><p class="noindent" >Различие между функциями доступа person-name и astro-name в том,
      что person-name может быть корректно применена к любому
      экземпляру person, включая astronaut, тогда как astro-name
      может работать только с astronaut. (Реализация может проверять
      или не проверять корректное использоваться таких функций
      доступа.)
      <!--l. 1628--><p class="noindent" >В одной форме <a 
href="clmse99.html#x123-227002r580">defstruct</a> может использовать не более одной опции
      :include. Аргумент для опции :include является обязательным
      и должен быть именем определённой ранее структуры. Если
      структура, будучи определённой, не имела опции :type, тогда
      наследуемая структура также не должна была содержать опцию :type.
      Если структура, будучи определённой, имела опцию :type, тогда
      наследуемая структура должна была иметь опцию :type с тем же
      типом.
      <!--l. 1637--><p class="noindent" >Если опция :type не указана, тогда имя структуры становиться именем
      типа данных. Более того, тип будет является подтипом типа структуры,
      от которой произошло наследование. В вышеприведённом примере,
      astronaut является подтипом person. Так, <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(typep (make-astronaut) &#x2019;person)
</td></tr></table>
      <!--l. 1643--><p class="noindent" >
</div>
</div>
      <!--l. 1644--><p class="noindent" >но и указывает, что все операции над person будут также работать для
      astronaut.
      <!--l. 1647--><p class="noindent" >Далее рассказывается чуть более сложные возможности опции :include.
      Иногда, когда одна структура включает другую, необходимо, чтобы
      значения по-умолчанию или опции слотов из родительской структуры
      при наследовании стали слегка другими. Новая структура может
      задать значения по-умолчанию или опции для наследуемых
      слотов отличными от родительских, с помощью конструкции:
      <div class=lisp><div class=tabbing>
                                                                          

                                                                          
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(:include <i>name</i> <i>slot-description-1</i> <i>slot-description-2</i> ...)
</td></tr></table>
      <!--l. 1654--><p class="noindent" >
</div>
</div>
      <!--l. 1655--><p class="noindent" >Каждая форма <i>slot-description-j</i> должна иметь имя <i>slot-name</i>
      или <i>slot-keyword</i>, такое же как в родительской структуре. Если
      <i>slot-description-j</i> не имеет формы инициализации <i>default-init</i>, тогда в
      новой структуре слот также не будет иметь первоначального значения.
      В противном случае его первоначальное значение будет заменено
      формой <i>default-init</i> из <i>slot-description-j</i>. Доступный для записи слот
      может быть переделан в слот только для чтения. Если слот только для
      чтения в родительской структуре, тогда он также должен быть
      только для чтения в дочерней. Если для слота указан тип, он
      должен быть таким же или подтипом в дочерней структуре. Если
      это строгий подтип, то реализация может проверять или не
      проверять ошибки несовпадения типов при присваивании значений
      слотам.
      <!--l. 1668--><p class="noindent" >Например, если мы хотели бы определить astronaut так, чтобы
      по-умолчанию возрастом астронавта было 45 лет, то мы могли бы
      сказать: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defstruct (astronaut (:include person (age 45)))
</td></tr></table>
      <!--l. 1671--><p class="noindent" >                                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">   helmet-size</td></tr></table>
      <!--l. 1672--><p class="noindent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">   (favorite-beverage &#x2019;tang))</td></tr></table>
      <!--l. 1674--><p class="noindent" >
</div>
</div>
      <li><b>
:print-function </b></li>Эта опция может использоваться, только если не опция :type
                                                                          

                                                                          
      не была указана. Аргумент для опции :print-function должен быть
      функцией трёх аргументов, в форме принимаемой специальной формой
      <a 
href="clmse35.html#x47-85002r52">function</a>. Эта функция используется для вывода рассматриваемой
      структуры. Когда структура выводится на консоль, данная функция
      вызывается с тремя аргументами: структура для печати, поток, в
      который производить вывод, и целое число, отображающее текущую
      глубину (можно сравнить с <a 
href="clmse110.html#x137-254054r649">*print-level*</a>). Функция вывода должна
      следить за значениями таких переменных настройки вывода, как
      <a 
href="clmse110.html#x137-254034r642">*print-escape*</a> и <a 
href="clmse110.html#x137-254036r643">*print-pretty*</a>.
      <!--l. 1690--><p class="noindent" >Если опции :print-function и :type не указаны, тогда функция вывода
      по-умолчанию выводит все слоты используя синтаксис #S (смотрите
      раздел <a 
href="clmse110.html#x137-25200022.1.4">22.1.4<!--tex4ht:ref: SHARP-SIGN-MACRO-CHARACTER-SECTION --></a>).
      <li><b>
:type </b></li>Опция :type явно задаёт представление используемое для структуры.
      Она принимает один аргумент, который должен быть одним из
      перечисленных ниже.
      <!--l. 1698--><p class="noindent" >Задание этой опции заставляет использовать указанное представление и
      заставляет компоненты быть размещёнными в порядке, предусмотренном в
      <a 
href="clmse99.html#x123-227002r580">defstruct</a> форме, в соответствующие последовательные элементы
      указанного представления. Опция также отключает возможность имени
      структуры стать именем типа. (смотрите раздел <a 
href="clmse104.html#x128-23300019.7">19.7<!--tex4ht:ref: EXPLICIT-TYPE-STRUCTURES --></a>).
      <!--l. 1705--><p class="noindent" >Обычно эта опция не используется, и тогда структура представляется
      так, как предусмотрено в реализации.
      <!--l. 1708--><p class="noindent" >
           <div class="quotation">
<div class=flushdesc>
           <!--l. 1710--><p class="noindent" >
    <ul><li><b>
<a 
href="clmse89.html#x111-215010r524">vector</a> </b></li>Структура   представляется   как   вектор   (vector   t).
    размещая  компоненты  как  элементы  вектора.  Первый
    компонент  находится  в  первом  элементе  вектора,  если
    структура  содержит  опцию  :named,  и  в  нулевом,  если
    структура содержит :unnamed.
                                                                          

                                                                          
    <li><b>
(vector <i>element-type</i>) </b></li>Структура                    представляется
    как  (возможно  специализированный)  вектор,  размещая
    компоненты  как  элементы  вектора.  Каждый  компонент
    должен принадлежать типу, который мог быть указан для
    вектора. Первый компонент находится в первом элементе
    вектора,  если  структура  содержит  опцию  :named,  и  в
    нулевом, если структура содержит :unnamed. Структура
    может  быть  :named,  только  если  тип  <a 
href="clmch10.html#x65-15600010">symbol</a>  является
    подтипом указанного в element-type.
    <li><b>
<a 
href="clmse82.html#x102-203038r456">list</a> </b></li>Структура представляется как список. Первый компонент
    является   <i>cadr</i>   элементом,   если   структура   содержит
    :named,   и   является   <i>car</i>   элементом,   если   структура
    содержит :unnamed.</ul>
</div>
           </div>
      <li><b>
:named </b></li>Опция :named указывает, что структура будет иметь «имя». Эта
      опция не принимает аргументов. Если опция :type не указана, тогда
      структура имеет имя. Таким образом эта опция полезно только при
      использовании вместе опцией :type. Смотрите раздел <a 
href="clmse104.html#x128-23300019.7">19.7<!--tex4ht:ref: EXPLICIT-TYPE-STRUCTURES --></a> для
      подробного описания этой опции.
      <li><b>
:initial-oﬀset </b></li>Эта опция позволяет вам указать <a 
href="clmse99.html#x123-227002r580">defstruct</a> пропустить указанное
      количество слотов, перед тем как начинать размещать указанные в теле
      слоты. Эта опция требует аргумент, а именно, неотрицательное
      целое, обозначающее количество пропускаемых слотов. Опция
      :initial-oﬀset может использоваться, только если также указана
      опция :type. Смотрите раздел ?? для подробного описания этой
      опции.</ul>
</div>
                                                                          

                                                                          
   <!--l. 1752--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse103.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse101.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse101.html#tailclmse101.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse102.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse102.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 1752--><p class="indent" >   <a 
 id="tailclmse102.html"></a>  
</body></html> 
