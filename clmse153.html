<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Discussion</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-06 17:14:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 164--><p class="noindent" > <div id="main_container"> <div id="content"> <!--l. 164--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmap3.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse152.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse152.html#tailclmse152.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse153.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmap2.html#clmse153.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">B.4   </span> <a 
href="clm.html#QQ2-188-530" id="x188-486000B.4">Discussion</a></h3>
<!--l. 166--><p class="noindent" >The idea of generators and gatherers was ﬁrst proposed by Pavel Curtis. A key
aspect of his proposal was the realization that generators and gatherers can be
implemented simply and elegantly as closures and that these closures can be
compiled very eﬃciently if certain conditions are met.
<!--l. 172--><p class="indent" >   First, the compiler must support an optimization Curtis calls “<tt><a 
href="clmse38.html#x50-99002r74">let</a></tt> eversion” in
addition to the optimization methods presented in <span class="cite">[<a 
href="clmli5.html#XRABBIT">45</a>]</span>. If a closure is created and
used entirely within a limited lexical scope, the scopes of any bound variables
nested in the closure can be enlarged (everted) to enclose all the uses of the
closure. This allows the variables to be allocated on the stack rather than the
heap.
<!--l. 180--><p class="indent" >   Second, for a generator/gatherer closure to be compiled eﬃciently, it must be
possible to determine at compile time exactly what closure is involved and exactly
what the scope of use of the closure is. There are several aspects to this. The
expression creating the generator/gatherer cannot refer to a free series variable.
The generator/gatherer must be stored in a local variable. This variable must
be used only in calls of <tt><a 
href="clmse151.html#x186-482004r1038">next-in</a></tt>, <tt><a 
href="clmse152.html#x187-484004r1040">next-out</a></tt>, and <tt><a 
href="clmse152.html#x187-484006r1041">result-of</a></tt>, and not
inside a closure. In particular the generator/gatherer cannot be stored
in a data structure, stored in a special variable, or returned as a result
value.
<!--l. 192--><p class="indent" >   All of the examples above satisfy these restrictions. For instance, once the uses
of <tt><a 
href="clmse152.html#x187-484008r1042">gathering</a></tt> and <tt><a 
href="clmse147.html#x181-465002r990">iterate</a></tt> have been optimized, the body of <tt>examp</tt> is as eﬃcient
as any loop performing the same computation.
<!--l. 197--><p class="indent" >   The implementation discussed in <span class="cite">[<a 
href="clmli5.html#XWATERS-SERIES-DESIGN">52</a>]</span> includes a portable Common Lisp
implementation of generators and gatherers. Although the implementation does
not support optimizations of the kind discussed in <span class="cite">[<a 
href="clmli5.html#XRABBIT">45</a>]</span>, it fully optimizes uses of
<tt><a 
href="clmse152.html#x187-484008r1042">gathering</a></tt>.
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 11--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmap3.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse152.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse152.html#tailclmse152.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse153.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmap2.html#clmse153.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 11--><p class="indent" >   <a 
 id="tailclmse153.html"></a>  </div> </div> 
</body></html> 
