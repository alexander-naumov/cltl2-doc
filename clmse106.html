<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Цикл взаимодействия с пользователем</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-19 00:40:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 562--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch21.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html#tailclmse105.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse106.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse106.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">20.2   </span> <a 
 id="x131-23900020.2"></a>Цикл взаимодействия с пользователем</h3>
<!--l. 564--><p class="noindent" >С Lisp&#x2019;ом можно работать через специальный цикл вида «<a 
href="clmse111.html#x138-257003r653">read</a>-<a 
href="clmse105.html#x130-238002r581">eval</a>-<a 
href="clmse112.html#x139-260010r670">print</a> и
сначала». Изменять состояние Lisp системы можно вызовом в этом цикле
действий, имеющих побочные эффекты.
<!--l. 569--><p class="indent" >   Точное определение такого цикла для Common Lisp&#x2019;а не указывается
здесь специально, оставляя разработчикам поле для творчества. Например,
они могут сделать командную строку, или простой текстовый редактор, или
сложный графический интерфейс. Разработчики могут предоставлять
явный запрос ввода, или (как в MacLisp&#x2019;е) не загромождать экран
подсказками.
<!--l. 575--><p class="indent" >   Цикл взаимодействия с пользователем должен ловить все исключения и
изящно их обрабатывать. Он должен также выводить все результаты
вычисления форм, возможно в отдельных строках. Если форма вернула ноль
значений, это также должно быть отображено.
<!--l. 580--><p class="indent" >   Следующие переменные управляются циклом взаимодействия с
пользователем, для удобства работы, например в случае, если пользователь
забыл сохранить интересное введённое выражение или выведенное значение.
(Следует отметить, что имена некоторых этих переменных нарушают
нотацию глобальных переменных в использовании звёздочек в начале и конце
имени.) Эти переменные в основном используются для взаимодействия с
пользователем, поэтому имеют короткие имена. Использование этих
переменных в программах следует избегать.
<div class=defun>
<!--l. 588--><p class="noindent" ><i>[Переменная]</i><a 
 id="dx131-239001"></a><a 
 id="x131-239002r587"></a><b> +</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx131-239003"></a><a 
 id="x131-239004r588"></a><b> ++</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx131-239005"></a><a 
 id="x131-239006r589"></a><b> +++</b>
<!--l. 592--><p class="noindent" >Когда форма вычисляется в цикле взаимодействия, переменная <a 
href="#x131-239002r587">+</a>
связывается с предыдущим прочитанным выражением. Переменная <a 
href="#x131-239004r588">++</a>
хранит предыдущее относительно значения <a 
href="#x131-239002r587">+</a> (то есть, форма вычисленная
два шага назад), и <a 
href="#x131-239006r589">+++</a> хранит предыдущее значение относительно
<a 
href="#x131-239004r588">++</a>.
                                                                          

                                                                          
</div>
<div class=defun>
<!--l. 600--><p class="noindent" ><i>[Переменная]</i><a 
 id="dx131-239007"></a><a 
 id="x131-239008r590"></a><b> -</b>
<!--l. 602--><p class="noindent" >Когда формы выполняется в цикле взаимодействия, переменная <a 
href="#x131-239008r590">-</a> связана с
этой формой. Это значение, которое получит переменная <a 
href="#x131-239002r587">+</a> на следующей
итерации цикла.
</div>
<div class=defun>
<!--l. 608--><p class="noindent" ><i>[Переменная]</i><a 
 id="dx131-239009"></a><a 
 id="x131-239010r591"></a><b> *</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx131-239011"></a><a 
 id="x131-239012r592"></a><b> **</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx131-239013"></a><a 
 id="x131-239014r593"></a><b> ***</b>
<!--l. 612--><p class="noindent" >Во время вычисления формы в цикле взаимодействия, переменная <a 
href="#x131-239010r591">*</a> связана
с результатом выполнения предыдущей формы, то есть значения формы,
которая хранится в <a 
href="#x131-239002r587">+</a>. Если результат той формы содержал несколько
значений, в <a 
href="#x131-239010r591">*</a> будет только первое. Если было возвращено ноль значений, <a 
href="#x131-239010r591">*</a>
будет содержать <a 
href="clmse31.html#x42-74002r18">nil</a>. Переменная <a 
href="#x131-239012r592">**</a> хранит предыдущее значение
относительно <a 
href="#x131-239010r591">*</a>. То есть, результат вычисления формы из <a 
href="#x131-239012r592">**</a>. <a 
href="#x131-239014r593">***</a> хранит
предыдущее значение относительно <a 
href="#x131-239014r593">***</a>.
<!--l. 622--><p class="indent" >   Если выполнение <a 
href="#x131-239002r587">+</a> было по каким-то причинам прервано, тогда значения
<a 
href="#x131-239010r591">*</a>, <a 
href="#x131-239012r592">**</a> и <a 
href="#x131-239014r593">***</a> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
</div>
<div class=defun>
<!--l. 628--><p class="noindent" ><i>[Переменная]</i><a 
 id="dx131-239015"></a><a 
 id="x131-239016r594"></a><b> /</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx131-239017"></a><a 
 id="x131-239018r595"></a><b> //</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx131-239019"></a><a 
 id="x131-239020r596"></a><b> ///</b>
<!--l. 632--><p class="noindent" >Во время вычисления формы в цикле взаимодействия, переменная <a 
href="#x131-239016r594">/</a> связана
со списком результатов выведенных на предыдущей итерации. То есть
это список всех значений выполнения формы <a 
href="#x131-239002r587">+</a>. Значение <a 
href="#x131-239010r591">*</a> должно
всегда совпадать со значением <i>car</i> элемента значения <a 
href="#x131-239016r594">/</a>. Переменная <a 
href="#x131-239018r595">//</a>
хранит предыдущий список значений относительно <a 
href="#x131-239016r594">/</a> (то есть, результат
вычисленный две итерации назад), и <a 
href="#x131-239020r596">///</a> содержит предыдущий список
значений относительно <a 
href="#x131-239020r596">///</a>. Таким образом, значение <a 
href="#x131-239012r592">**</a> должно всегда
совпадать со значением <i>car</i> элемента списка <a 
href="#x131-239018r595">//</a>, а <a 
href="#x131-239014r593">***</a> с с <i>car</i> элементом
<a 
href="#x131-239020r596">///</a>.
<!--l. 644--><p class="indent" >   Если выполнение <a 
href="#x131-239002r587">+</a> было по каким-то причинам прервано, тогда значения
<a 
href="#x131-239016r594">/</a>, <a 
href="#x131-239018r595">//</a> и <a 
href="#x131-239020r596">///</a> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
                                                                          

                                                                          
</div>
<!--l. 650--><p class="indent" >   В качестве примера работы с этими переменным, рассмотрим следующую
возможную работу с системой, где <a 
href="clmse63.html#x80-177008r176">&#x003E;</a> приглашение ввода: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(cons - -)                      </td><td  
class="tabbing">;Итерация 1
</td></tr></table>
<!--l. 654--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">((CONS - -) CONS - -)      </td><td  
class="tabbing">;Очаровашка?</td></tr></table>
<!--l. 655--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 656--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(values)                        </td><td  
class="tabbing">;Итерация 2</td></tr></table>
<!--l. 657--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                ;Ничего не выводится</td></tr></table>
<!--l. 658--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(cons &#x2019;a &#x2019;b)                    </td><td  
class="tabbing">;Итерация 3</td></tr></table>
<!--l. 659--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">(A . B)                           </td><td  
class="tabbing">;Это одно значение</td></tr></table>
<!--l. 660--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 661--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(hairy-loop)̂G               </td><td  
class="tabbing">;Итерация 4</td></tr></table>
<!--l. 662--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">### QUIT to top level.    </td><td  
class="tabbing">;(Пользователь прервал вычисления.)</td></tr></table>
<!--l. 663--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 664--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(ﬂoor 13 4)                    </td><td  
class="tabbing">;Итерация 5</td></tr></table>
<!--l. 665--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">3                                   </td><td  
class="tabbing">;Вернулось два значения</td></tr></table>
<!--l. 666--><p class="indent" >                                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">1</td></tr></table>
<!--l. 668--><p class="indent" >
</div>
</div>
<!--l. 669--><p class="noindent" >В этой точке мы имеем: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" >+++ <span class="math"> ⇒</span> (cons &#x2019;a &#x2019;b) </td><td align="left" >*** <span class="math"> ⇒</span> NIL   </td><td align="left" >/// <span class="math"> ⇒</span> ()        </td>
</tr><tr><td align="left" >++ <span class="math"> ⇒</span> (hairy-loop)   </td><td align="left" >** <span class="math"> ⇒</span> (A . B)</td><td align="left" >// <span class="math"> ⇒</span> ((A . B))</td>
</tr><tr><td align="left" >+ <span class="math"> ⇒</span> (ﬂoor 13 4)      </td><td align="left" >* <span class="math"> ⇒</span> 3          </td><td align="left" >/ <span class="math"> ⇒</span> (3 1)       </td></tr></table>                      </div>
</td></tr></table><!--l. 676--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 750--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch21.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html#tailclmse105.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse106.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse106.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 750--><p class="indent" >   <a 
 id="tailclmse106.html"></a>  
</body></html> 
