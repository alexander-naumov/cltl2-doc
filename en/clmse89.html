<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Hash Table Functions</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 71--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse90.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="hash.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="hash.html#tailhash.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse89.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="hash.html#clmse89.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">16.1   </span> <a 
href="clm.html#QQ2-110-1405" id="x110-137500016.1">Hash Table Functions</a></h3>
<!--l. 73--><p class="noindent" >This section documents the functions for hash tables, which use <i>objects</i> as keys
and associate other objects with them.
<div class="defun">
<!--l. 76--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx110-1375001"></a><a 
 id="x110-1375002r511"></a> <b>make-hash-table</b>  <b>&#x0026;key</b>  <i>:test</i> <i>:size</i> <i>:rehash-size</i> <i>:rehash-threshold</i>
</div>
<!--l. 79--><p class="indent" >   This function creates and returns a new hash table. The <tt>:test</tt> argument
determines how keys are compared; it must be one of the three values <tt>#&#x2019;eq</tt>,
<tt>#&#x2019;eql</tt>, or <tt>#&#x2019;equal</tt>, or one of the three symbols <tt><a 
href="symbols.html#x185-2637337r337">eq</a></tt>, <tt><a 
href="symbols.html#x185-2637338r338">eql</a></tt>, or <tt><a 
href="symbols.html#x185-2637339r339">equal</a></tt>. If no test is
speciﬁed, <tt><a 
href="symbols.html#x185-2637338r338">eql</a></tt> is assumed.
<div class="new">
<!--l. 86--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx110-1375003"></a>to add a fourth type of hash table: the value of
<tt>#&#x2019;equalp</tt> and the symbol <tt><a 
href="symbols.html#x185-2637340r340">equalp</a></tt> are to be additional valid possibilities for the
<tt>:test</tt> argument.
                                                                          

                                                                          
<!--l. 92--><p class="indent" >   Note that one consequence of the vote to change the rules of ﬂoating-point
contagion <a 
 id="dx110-1375004"></a>(described in section <a 
href="clmse64.html#x81-95700012.1">12.1<!--tex4ht:ref: PRECISION-CONTAGION-COERCION-SECTION --></a>) is to require <tt><a 
href="symbols.html#x185-2637061r61">=</a></tt>, and therefore also <tt><a 
href="symbols.html#x185-2637340r340">equalp</a></tt>, to
compare the values of numbers exactly and not approximately, making <tt><a 
href="symbols.html#x185-2637340r340">equalp</a></tt> a
true equivalence relation on numbers.
<!--l. 101--><p class="indent" >   Another valuable use of <tt><a 
href="symbols.html#x185-2637340r340">equalp</a></tt> hash tables is case-insensitive comparison of
keys that are strings.
</div>
<!--l. 105--><p class="indent" >   The <tt>:size</tt> argument sets the initial size of the hash table, in entries.
(The actual size may be rounded up from the size you specify to the
next “good” size, for example to make it a prime number.) You won&#x2019;t
necessarily be able to store precisely this many entries into the table before it
overﬂows and becomes bigger, but this argument does serve as a hint to
the implementation of approximately how many entries you intend to
store.
<div class="new">
<!--l. 116--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx110-1375005"></a>to clarify that the <tt>:size</tt> argument must be a
non-negative integer.
</div>
<div class="newer">
<!--l. 123--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx110-1375006"></a>to regard the preceding description of the <tt>:size</tt>
argument as deﬁnitive: it is approximately the number of entries that can be
inserted without having to enlarge the hash table.
</div>
<!--l. 129--><p class="indent" >   The <tt>:rehash-size</tt> argument speciﬁes how much to increase the size of the
hash table when it becomes full. This can be an integer greater than zero, which is
the number of entries to add, or it can be a ﬂoating-point number greater than 1,
which is the ratio of the new size to the old size. The default value for this
argument is implementation-dependent.
<!--l. 137--><p class="indent" >   The <tt>:rehash-threshold</tt> argument speciﬁes how full the hash table can get
before it must grow. It may be any <tt>real</tt> number between <tt>0</tt> and <tt>1</tt>, inclusive. It
indicates the maximum desired level of hash table occupancy. An implementation
is permitted to ignore this argument. The default value for this argument is
implementation-dependent.
<!--l. 144--><p class="indent" >   An example of the use of <tt><a 
href="symbols.html#x185-2637539r539">make-hash-table</a></tt>: <div class="lisp"><div class="tabbing">
(make-hash-table :rehash-size 1.5
                                                                          

                                                                          
   <br>                                            :size (* number-of-widgets 43))<br>
<!--l. 148--><p class="noindent" ></div>
<!--l. 148--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-137600016.1" id="x110-137600016.1"></a></span>
<!--l. 148--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-137700016.1" id="x110-137700016.1"></a></span>
</div>
</div>
<div class="defun">
<!--l. 151--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx110-1377001"></a><a 
 id="x110-1377002r512"></a> <b>hash-table-p</b>  <i>object</i>
</div>
<tt>
<!--l. 154--><p class="indent" >   <a 
href="symbols.html#x185-2637428r428">hash-table-p</a></tt> is true if its argument is a hash table, and otherwise is false.
<div class="lisp"><div class="tabbing">
(hash-table-p x) <span class="math"> ≡</span> (typep x &#x2019;hash-table)
   <br>
<!--l. 158--><p class="noindent" ></div>
<!--l. 158--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-137800016.1" id="x110-137800016.1"></a></span>
<!--l. 158--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-137900016.1" id="x110-137900016.1"></a></span>
</div>
</div>
<div class="defun">
<!--l. 161--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx110-1379001"></a><a 
 id="x110-1379002r513"></a> <b>gethash</b>  <i>key</i> <i>hash-table</i> <b>&#x0026;optional</b>  <i>default</i>
</div>
<tt>
                                                                          

                                                                          
<!--l. 164--><p class="indent" >   <a 
href="symbols.html#x185-2637422r422">gethash</a></tt> ﬁnds the entry in <i>hash-table</i> whose key is <i>key</i> and returns the
associated value. If there is no such entry, <tt><a 
href="symbols.html#x185-2637422r422">gethash</a></tt> returns <i>default</i>, which is <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> if
not speciﬁed.
<tt>
<!--l. 169--><p class="indent" >   <a 
href="symbols.html#x185-2637422r422">gethash</a></tt> actually returns two values, the second being a predicate value that is
true if an entry was found, and false if no entry was found.
<tt>
<!--l. 172--><p class="indent" >   <a 
href="symbols.html#x185-2637778r778">setf</a></tt> may be used with <tt><a 
href="symbols.html#x185-2637422r422">gethash</a></tt> to make new entries in a hash table. If an
entry with the speciﬁed <i>key</i> already exists, it is removed before the new entry is
added. The <i>default</i> argument may be speciﬁed to <tt><a 
href="symbols.html#x185-2637422r422">gethash</a></tt> in this context; it is
ignored by <tt><a 
href="symbols.html#x185-2637778r778">setf</a></tt> but may be useful in such macros as <tt><a 
href="symbols.html#x185-2637441r441">incf</a></tt> that are related to
<tt><a 
href="symbols.html#x185-2637778r778">setf</a></tt>: <div class="lisp"><div class="tabbing">
(incf (gethash a-key table 0))
   <br>
<!--l. 179--><p class="noindent" ></div>
<!--l. 179--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138000016.1" id="x110-138000016.1"></a></span>
<!--l. 179--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138100016.1" id="x110-138100016.1"></a></span>
</div>
<!--l. 180--><p class="indent" >   means approximately the same as <div class="lisp"><div class="tabbing">
(setf (gethash a-key table 0)
   <br>                                                    (+ (gethash a-key table 0) 1))<br>
<!--l. 184--><p class="noindent" ></div>
<!--l. 184--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138200016.1" id="x110-138200016.1"></a></span>
                                                                          

                                                                          
<!--l. 184--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138300016.1" id="x110-138300016.1"></a></span>
</div>
<!--l. 185--><p class="indent" >   which in turn would be treated as simply <div class="lisp"><div class="tabbing">
(setf (gethash a-key table)
   <br>                                                    (+ (gethash a-key table 0) 1))<br>
<!--l. 189--><p class="noindent" ></div>
<!--l. 189--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138400016.1" id="x110-138400016.1"></a></span>
<!--l. 189--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138500016.1" id="x110-138500016.1"></a></span>
</div>
</div>
<div class="defun">
<!--l. 192--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx110-1385001"></a><a 
 id="x110-1385002r514"></a> <b>remhash</b>  <i>key</i> <i>hash-table</i>
</div>
<tt>
<!--l. 195--><p class="indent" >   <a 
href="symbols.html#x185-2637735r735">remhash</a></tt> removes any entry for <i>key</i> in <i>hash-table</i>. This is a predicate that is
true if there was an entry or false if there was not.
</div>
<div class="defun">
<!--l. 201--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx110-1385003"></a><a 
 id="x110-1385004r515"></a> <b>maphash</b>  <i>function</i> <i>hash-table</i>
</div>
<!--l. 204--><p class="indent" >   For each entry in <i>hash-table</i>, <tt><a 
href="symbols.html#x185-2637562r562">maphash</a></tt> calls <i>function</i> on two arguments: the key
of the entry and the value of the entry; <tt><a 
href="symbols.html#x185-2637562r562">maphash</a></tt> then returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. If entries are
added to or deleted from the hash table while a <tt><a 
href="symbols.html#x185-2637562r562">maphash</a></tt> is in progress,
the results are unpredictable, with one exception: if the <i>function</i> calls
<tt><a 
href="symbols.html#x185-2637735r735">remhash</a></tt> to remove the entry currently being processed by the <i>function</i>,
or performs a <tt><a 
href="symbols.html#x185-2637778r778">setf</a></tt> of <tt><a 
href="symbols.html#x185-2637422r422">gethash</a></tt> on that entry to change the associated
value, then those operations will have the intended eﬀect. For example:
<div class="lisp"><div class="tabbing">
                                                                          

                                                                          
;;; Alter every entry in MY-HASH-TABLE, replacing the value with
   <br>                ;;; its square root. Entries with negative values are removed.<br>
(maphash #&#x2019;(lambda (key val)<br>                          (if (minusp val)<br>
                 (remhash key my-hash-table)<br>
                 (setf (gethash key my-hash-table) (sqrt val))))<br>
         my-hash-table)<br>
<!--l. 222--><p class="noindent" ></div>
<!--l. 222--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138600016.1" id="x110-138600016.1"></a></span>
<!--l. 222--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138700016.1" id="x110-138700016.1"></a></span>
</div>
<div class="new">
<!--l. 225--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx110-1387001"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class="defun">
<!--l. 231--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx110-1387002"></a><a 
 id="x110-1387003r516"></a> <b>clrhash</b>  <i>hash-table</i>
</div>
<!--l. 234--><p class="indent" >   This removes all the entries from <i>hash-table</i> and returns the hash table
itself.
</div>
<div class="defun">
<!--l. 238--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx110-1387004"></a><a 
 id="x110-1387005r517"></a> <b>hash-table-count</b>  <i>hash-table</i>
</div>
<!--l. 241--><p class="indent" >   This returns the number of entries in the <i>hash-table</i>. When a hash table is ﬁrst
created or has been cleared, the number of entries is zero.
</div>
<div class="defmac">
<div class="defmacheader">
                                                                          

                                                                          
<!--l. 247--><p class="indent" >   <div class="tabbing">
 <i>[Macro]</i> <b>with-hash-table-iterator</b> <a 
 id="dx110-1387006"></a><a 
 id="x110-1387007r518"></a> (mname hash-table) {form}*
   <br>
<!--l. 248--><p class="noindent" ></div>
<!--l. 248--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138800016.1" id="x110-138800016.1"></a></span>
</div>
<!--l. 249--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx110-1388001"></a>to add the macro <tt><a 
href="symbols.html#x185-2637935r935">with-hash-table-iterator</a></tt>.
<!--l. 253--><p class="indent" >   The name <i>mname</i> is bound and deﬁned as if by <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt>, with the body
<i>form</i>s as its lexical scope, to be a “generator macro” such that successive
invocations <tt>(<i>mname</i>)</tt> will return entries, one by one, from the hash table
that is the value of the expression <i>hash-table</i> (which is evaluated exactly
once).
<!--l. 259--><p class="indent" >   At each invocation of the generator macro, there are two possibilities. If there
is yet another unprocessed entry in the hash table, then three values are returned:
<tt><a 
href="symbols.html#x185-2637871r871">t</a></tt>, the key of the hash table entry, and the associated value of the hash table entry.
On the other hand, if there are no more unprocessed entries in the hash table,
then one value is returned: <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>.
<!--l. 267--><p class="indent" >   The implicit interior state of the iteration over the hash table entries has
dynamic extent. While the name <i>mname</i> has lexical scope, it is an error to invoke
the generator macro once the <tt><a 
href="symbols.html#x185-2637935r935">with-hash-table-iterator</a></tt> form has been
exited.
<!--l. 272--><p class="indent" >   Invocations of <tt><a 
href="symbols.html#x185-2637935r935">with-hash-table-iterator</a></tt> and related macros may be nested,
and the generator macro of an outer invocation may be called from within an
inner invocation (assuming that its name is visible or otherwise made
available).
<div class="new">
<!--l. 278--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx110-1388002"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>__________________________________________________________________________<div class="rationale">
<!--l. 284--><p class="noindent" ><b>Rationale:</b> This facility is a bit more ﬂexible than <tt><a 
href="symbols.html#x185-2637562r562">maphash</a></tt>. It makes possible a
portable and eﬃcient implementation of <tt><a 
href="symbols.html#x185-2637522r522">loop</a></tt> clauses for iterating over hash tables (see
chapter <a 
href="loop.html#x154-202100025">25<!--tex4ht:ref: LOOP --></a>).
</div>___________________________________________________________________________________________________________
</div>
<div class="lisp">
                                                                          

                                                                          
<!--l. 292--><p class="indent" >   <div class="tabbing">
(setq turtles (make-hash-table :size 9 :test &#x2019;eq))
   <br>              (setf (gethash &#x2019;howard-kaylan turtles) &#x2019;(musician lead-singer))<br>
(setf (gethash &#x2019;john-barbata turtles) &#x2019;(musician drummer))<br>
(setf (gethash &#x2019;leonardo turtles) &#x2019;(ninja leader blue))<br>
(setf (gethash &#x2019;donatello turtles) &#x2019;(ninja machines purple))<br>
(setf (gethash &#x2019;al-nichol turtles) &#x2019;(musician guitarist))<br>
(setf (gethash &#x2019;mark-volman turtles) &#x2019;(musician great-hair))<br>
(setf (gethash &#x2019;raphael turtles) &#x2019;(ninja cool rude red))<br>
(setf (gethash &#x2019;michaelangelo turtles) &#x2019;(ninja party-dude orange))<br>
(setf (gethash &#x2019;jim-pons turtles) &#x2019;(musician bassist))<br>
<br>                               (with-hash-table-iterator (get-turtle turtles)<br>
  (labels ((try (got-one &#x0026;optional key value)<br>             (when got-one  ;Remember, keys may show up in any order<br>
               (when (eq (ﬁrst value) &#x2019;ninja)<br>
                 (format t &#x0022;~%~:(~A~): ~{~A~̂, ~}&#x0022;<br>
                         key (rest value)))<br>
               (multiple-value-call #&#x2019;try (get-turtle)))))<br>
    (multiple-value-call #&#x2019;try (get-turtle))))     ;Prints 4 lines<br>
Michaelangelo: PARTY-DUDE, ORANGE<br>     Leonardo: LEADER, BLUE<br>
Raphael: COOL, RUDE, RED<br>           Donatello: MACHINES, PURPLE<br>
  <span class="math"> ⇒</span> nil<br>
<!--l. 317--><p class="noindent" ></div>
<!--l. 317--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-138900016.1" id="x110-138900016.1"></a></span>
<!--l. 317--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-139000016.1" id="x110-139000016.1"></a></span>
</div>
<div class="defun">
<!--l. 319--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx110-1390001"></a><a 
 id="x110-1390002r519"></a> <b>hash-table-rehash-size</b>  <i>hash-table</i><br />
<i>
[Function]</i><a 
 id="dx110-1390003"></a><a 
 id="x110-1390004r520"></a> <b>hash-table-rehash-threshold</b>  <i>hash-table</i><br />
<i>
                                                                          

                                                                          
[Function]</i><a 
 id="dx110-1390005"></a><a 
 id="x110-1390006r521"></a> <b>hash-table-size</b>  <i>hash-table</i><br />
<i>
[Function]</i><a 
 id="dx110-1390007"></a><a 
 id="x110-1390008r522"></a> <b>hash-table-test</b>  <i>hash-table</i>
</div>
<!--l. 325--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx110-1390009"></a>to add four accessor functions that return values
suitable for use in a call to <tt><a 
href="symbols.html#x185-2637539r539">make-hash-table</a></tt> in order to produce a new hash
table with state corresponding to the current state of the argument hash
table.
<tt>
<!--l. 330--><p class="indent" >   <a 
href="symbols.html#x185-2637429r429">hash-table-rehash-size</a></tt> returns the current rehash size of a hash
table.
<tt>
<!--l. 332--><p class="indent" >   <a 
href="symbols.html#x185-2637430r430">hash-table-rehash-threshold</a></tt> returns the current rehash threshold.
<tt>
<!--l. 334--><p class="indent" >   <a 
href="symbols.html#x185-2637431r431">hash-table-size</a></tt> returns the current size of a hash table.
<tt>
<!--l. 336--><p class="indent" >   <a 
href="symbols.html#x185-2637432r432">hash-table-test</a></tt> returns the test used for comparing keys. If the test is one
of the standard test functions, then the result will always be a symbol, even if the
function itself was speciﬁed when the <i>hash-table</i> was created. For example:
<div class="lisp"><div class="tabbing">
(hash-table-test (make-hash-table :test #&#x2019;equal)) <span class="math"> ⇒</span> equal
   <br>
<!--l. 342--><p class="noindent" ></div>
<!--l. 342--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-139100016.1" id="x110-139100016.1"></a></span>
<!--l. 342--><p class="noindent" ><span class="paragraphHead"><a 
href="#x110-139200016.1" id="x110-139200016.1"></a></span>
</div>
<!--l. 343--><p class="indent" >   Implementations that extend <tt><a 
href="symbols.html#x185-2637539r539">make-hash-table</a></tt> by providing additional
possibilities for the <tt>:test</tt> argument may determine how the value returned by
<tt><a 
href="symbols.html#x185-2637432r432">hash-table-test</a></tt> is related to such additional tests.
</div>
                                                                          

                                                                          
<!--l. 348--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse90.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="hash.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="hash.html#tailhash.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse89.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="hash.html#clmse89.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse89.html"></a>   </div> </div> 
</body></html> 
