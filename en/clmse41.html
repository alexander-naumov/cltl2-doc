<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Blocks and Exits</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 2641--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse42.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse40.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse40.html#tailclmse40.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse41.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="contrl.html#clmse41.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">7.7   </span> <a 
href="clm.html#QQ2-53-617" id="x53-6090007.7">Blocks and Exits</a></h3>
<!--l. 2644--><p class="noindent" >The <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> and <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt> constructs provide a structured lexical non-local exit
facility. At any point lexically within a <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> construct, a <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt> with the
same name may be used to perform an immediate transfer of control that exits
from the <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt>. In the most common cases this mechanism is more eﬃcient than
the dynamic non-local exit facility provided by <tt>catch</tt> and <tt>throw</tt>, described in
section <a 
href="clmse45.html#x57-7180007.11">7.11<!--tex4ht:ref: CATCH-THROW-SECTION --></a>.
<div class="defspec">
<div class="defmacheader">
<!--l. 2654--><p class="indent" >   <div class="tabbing">
 <i>[Special operator]</i> <b>block</b> <a 
 id="dx53-609001"></a><a 
 id="x53-609002r93"></a> name {form}*
   <br>
<!--l. 2655--><p class="noindent" ></div>
<!--l. 2655--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-6100007.7" id="x53-6100007.7"></a></span>
</div>
<!--l. 2656--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> construct executes each <i>form</i> from left to right, returning whatever
is returned by the last <i>form</i>. If, however, a <tt><a 
href="symbols.html#x185-2637751r751">return</a></tt> or <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt> form that
speciﬁes the same <i>name</i> is executed during the execution of some <i>form</i>, then the
results speciﬁed by the <tt><a 
href="symbols.html#x185-2637751r751">return</a></tt> or <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt> are immediately returned as the
value of the <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> construct, and execution proceeds as if the <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> had
terminated normally. In this, <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> diﬀers from <tt><a 
href="symbols.html#x185-2637700r700">progn</a></tt>; the <tt><a 
href="symbols.html#x185-2637700r700">progn</a></tt> construct has
nothing to do with <tt><a 
href="symbols.html#x185-2637751r751">return</a></tt>.
<!--l. 2667--><p class="indent" >   The <i>name</i> is not evaluated; it must be a symbol. The scope of the <i>name</i> is
lexical; only a <tt><a 
href="symbols.html#x185-2637751r751">return</a></tt> or <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt> textually contained in some <i>form</i> can exit
from the block. The extent of the name is dynamic. Therefore it is only possible to
exit from a given run-time incarnation of a block once, either normally or by
explicit return.
<!--l. 2674--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2637291r291">defun</a></tt> form implicitly puts a <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> around the body of the function
deﬁned; the <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> has the same name as the function. Therefore one
may use <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt> to return prematurely from a function deﬁned by
                                                                          

                                                                          
<tt><a 
href="symbols.html#x185-2637291r291">defun</a></tt>.
<!--l. 2679--><p class="indent" >   The lexical scoping of the block name is fully general and has consequences
that may be surprising to users and implementors of other Lisp systems. For
example, the <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt> in the following example actually does work in
Common Lisp as one might expect: <div class="lisp"><div class="tabbing">
(block loser
   <br>         (catch &#x2019;stuﬀ<br>            (mapcar #&#x2019;(lambda (x) (if (numberp x)<br>
                                (hairyfun x)<br>
                                (return-from loser <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>)))<br>
              items)))<br>
<!--l. 2691--><p class="noindent" ></div>
<!--l. 2691--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-6110007.7" id="x53-6110007.7"></a></span>
<!--l. 2691--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-6120007.7" id="x53-6120007.7"></a></span>
</div>
<!--l. 2692--><p class="indent" >   Depending on the situation, a <tt><a 
href="symbols.html#x185-2637751r751">return</a></tt> in Common Lisp may not be simple. A
<tt><a 
href="symbols.html#x185-2637751r751">return</a></tt> can break up catchers if necessary to get to the block in question. It is
possible for a “closure” created by <tt><a 
href="symbols.html#x185-2637399r399">function</a></tt> for a lambda-expression to refer to a
block name as long as the name is lexically apparent.
</div>
<div class="defspec">
<div class="defmacheader">
<!--l. 2702--><p class="indent" >   <div class="tabbing">
 <i>[Special operator]</i> <b>return-from</b> <a 
 id="dx53-612001"></a><a 
 id="x53-612002r94"></a> name [result]
   <br>
<!--l. 2703--><p class="noindent" ></div>
<!--l. 2703--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-6130007.7" id="x53-6130007.7"></a></span>
</div>
<tt>
                                                                          

                                                                          
<!--l. 2704--><p class="indent" >   <a 
href="symbols.html#x185-2637752r752">return-from</a></tt> is used to return from a <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> or from such constructs as <tt><a 
href="symbols.html#x185-2637310r310">do</a></tt> and
<tt><a 
href="symbols.html#x185-2637696r696">prog</a></tt> that implicitly establish a <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt>. The <i>name</i> is not evaluated and must be a
symbol. A <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> construct with the same name must lexically enclose the
occurrence of <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt>; whatever the evaluation of <i>result</i> produces is
immediately returned from the block. (If the <i>result</i> form is omitted, it defaults to
<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. As a matter of style, this form ought to be used to indicate that the
particular value returned doesn&#x2019;t matter.)
<!--l. 2716--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt> form itself never returns and cannot have a value; it causes
results to be returned from a <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> construct. If the evaluation of <i>result</i>
produces multiple values, those multiple values are returned by the construct
exited.
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 2723--><p class="indent" >   <div class="tabbing">
 <i>[Macro]</i> <b>return</b> <a 
 id="dx53-613001"></a><a 
 id="x53-613002r95"></a> [result]
   <br>
<!--l. 2724--><p class="noindent" ></div>
<!--l. 2724--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-6140007.7" id="x53-6140007.7"></a></span>
</div>
<tt>
<!--l. 2725--><p class="indent" >   (return <i>form</i>)</tt> is identical in meaning to <tt>(return-from <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> <i>form</i>)</tt>; it
returns from a block named <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. Blocks established implicitly by iteration
constructs such as <tt><a 
href="symbols.html#x185-2637310r310">do</a></tt> are named <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>, so that <tt><a 
href="symbols.html#x185-2637751r751">return</a></tt> will exit properly from such
a construct.
</div>
                                                                          

                                                                          
<!--l. 2732--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse42.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse40.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse40.html#tailclmse40.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse41.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="contrl.html#clmse41.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse41.html"></a>   </div> </div> 
</body></html> 
