<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Concatenating, Mapping, and Reducing Sequences</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 385--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse80.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse78.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse78.html#tailclmse78.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse79.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="kseque.html#clmse79.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">14.2   </span> <a 
href="clm.html#QQ2-98-1242" id="x98-121200014.2">Concatenating, Mapping, and
Reducing Sequences</a></h3>
<!--l. 387--><p class="noindent" >The functions in this section each operate on an arbitrary number of sequences
except for <tt><a 
href="symbols.html#x185-2637731r731">reduce</a></tt>, which is included here because of its conceptual relationship to
the mapping functions.
<div class="defun">
<!--l. 391--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx98-1212001"></a><a 
 id="x98-1212002r377"></a> <b>concatenate</b>  <i>result-type</i> <b>&#x0026;rest</b>  <i>sequences</i>
</div>
<!--l. 394--><p class="indent" >   The result is a new sequence that contains all the elements of all the sequences
in order. All of the sequences are copied from; the result does not share any
structure with any of the argument sequences (in this <tt><a 
href="symbols.html#x185-2637243r243">concatenate</a></tt> diﬀers from
<tt><a 
href="symbols.html#x185-2637079r79">append</a></tt>). The type of the result is speciﬁed by <i>result-type</i>, which must be a
subtype of <tt>sequence</tt>, as for the function <tt><a 
href="symbols.html#x185-2637227r227">coerce</a></tt>. It must be possible for every
element of the argument sequences to be an element of a sequence of type
<i>result-type</i>.
<!--l. 403--><p class="indent" >   If only one <i>sequence</i> argument is provided and it has the type speciﬁed by
<i>result-type</i>, <tt><a 
href="symbols.html#x185-2637243r243">concatenate</a></tt> is required to copy the argument rather than simply
returning it. If a copy is not required, but only possibly type conversion, then the
<tt><a 
href="symbols.html#x185-2637227r227">coerce</a></tt> function may be appropriate.
<div class="newer">
<!--l. 410--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx98-1212003"></a>to specify that <tt><a 
href="symbols.html#x185-2637243r243">concatenate</a></tt> should signal an error
if the sequence type speciﬁes the number of elements and the sum of the argument
lengths is diﬀerent.
</div>
</div>
<div class="defun">
<!--l. 416--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx98-1212004"></a><a 
 id="x98-1212005r378"></a> <b>map</b>  <i>result-type</i> <i>function</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i>
</div>
<!--l. 419--><p class="indent" >   The <i>function</i> must take as many arguments as there are sequences provided; at
least one sequence must be provided. The result of <tt><a 
href="symbols.html#x185-2637556r556">map</a></tt> is a sequence such that
                                                                          

                                                                          
element <i>j</i> is the result of applying <i>function</i> to element <i>j</i> of each of the argument
sequences. The result sequence is as long as the shortest of the input
sequences.
<!--l. 426--><p class="indent" >   If the <i>function</i> has side eﬀects, it can count on being called ﬁrst on all the
elements numbered <tt>0</tt>, then on all those numbered <tt>1</tt>, and so on.
<!--l. 430--><p class="indent" >   The type of the result sequence is speciﬁed by the argument <i>result-type</i> (which
must be a subtype of the type <tt>sequence</tt>), as for the function <tt><a 
href="symbols.html#x185-2637227r227">coerce</a></tt>.
In addition, one may specify <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> for the result type, meaning that no
result sequence is to be produced; in this case the <i>function</i> is invoked only
for eﬀect, and <tt><a 
href="symbols.html#x185-2637556r556">map</a></tt> returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. This gives an eﬀect similar to that of
<tt><a 
href="symbols.html#x185-2637558r558">mapc</a></tt>.
<div class="newer">
<!--l. 439--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx98-1212006"></a>to specify that <tt><a 
href="symbols.html#x185-2637556r556">map</a></tt> should signal an error if the
sequence type speciﬁes the number of elements and the minimum of the argument
lengths is diﬀerent.
</div>
<div class="new">
<!--l. 445--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx98-1212007"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
<!--l. 450--><p class="noindent" >For example: <div class="lisp"><div class="tabbing">
(map &#x2019;list #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (-1 -2 -3 -4)
   <br>                                                                               (map &#x2019;string<br>
     #&#x2019;(lambda (x) (if (oddp x) #\1 #\0))<br>                    &#x2019;(1 2 3 4))<br>
   <span class="math"> ⇒</span> &#x0022;1010&#x0022;<br>
<!--l. 458--><p class="noindent" ></div>
<!--l. 458--><p class="noindent" ><span class="paragraphHead"><a 
href="#x98-121300014.2" id="x98-121300014.2"></a></span>
<!--l. 458--><p class="noindent" ><span class="paragraphHead"><a 
href="#x98-121400014.2" id="x98-121400014.2"></a></span>
</div>
</div>
<div class="defun">
                                                                          

                                                                          
<!--l. 462--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx98-1214001"></a><a 
 id="x98-1214002r379"></a> <b>map-into</b>  <i>result-sequence</i> <i>function</i> <b>&#x0026;rest</b>  <i>sequences</i>
</div>
<!--l. 465--><p class="indent" >   Function <tt><a 
href="symbols.html#x185-2637557r557">map-into</a></tt> destructively modiﬁes the <i>result-sequence</i> to contain the
results of applying <i>function</i> to corresponding elements of the argument <i>sequences</i>
in turn; it then returns <i>result-sequence</i>.
<!--l. 470--><p class="indent" >   The arguments <i>result-sequence</i> and each element of <i>sequences</i> can each
be either a list or a vector (one-dimensional array). The <i>function</i> must
accept at least as many arguments as the number of argument <i>sequences</i>
supplied to <tt><a 
href="symbols.html#x185-2637557r557">map-into</a></tt>. If <i>result-sequence</i> and the other argument <i>sequences</i>
are not all the same length, the iteration terminates when the shortest
sequence is exhausted. If <i>result-sequence</i> is a vector with a ﬁll pointer, the ﬁll
pointer is ignored when deciding how many iterations to perform, and
afterwards the ﬁll pointer is set to the number of times the <i>function</i> was
applied.
<!--l. 482--><p class="indent" >   If the <i>function</i> has side eﬀects, it can count on being called ﬁrst on all the
elements numbered <tt>0</tt>, then on all those numbered <tt>1</tt>, and so on.
<!--l. 486--><p class="indent" >   If <i>result-sequence</i> is longer than the shortest element of <i>sequences</i>, extra
elements at the end of <i>result-sequence</i> are unchanged.
<!--l. 489--><p class="indent" >   The function <tt><a 
href="symbols.html#x185-2637557r557">map-into</a></tt> diﬀers from <tt><a 
href="symbols.html#x185-2637556r556">map</a></tt> in that it modiﬁes an existing
sequence rather than creating a new one. In addition, <tt><a 
href="symbols.html#x185-2637557r557">map-into</a></tt> can be called with
only two arguments (<i>result-sequence</i> and <i>function</i>), while <tt><a 
href="symbols.html#x185-2637556r556">map</a></tt> requires at least
three arguments.
<!--l. 494--><p class="indent" >   If <i>result-sequence</i> is <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>, <tt><a 
href="symbols.html#x185-2637557r557">map-into</a></tt> immediately returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>, because <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> is a
sequence of length zero.
</div>
<div class="defun">
<!--l. 499--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx98-1214003"></a><a 
 id="x98-1214004r380"></a> <b>some</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i><br />
<i>
[Function]</i><a 
 id="dx98-1214005"></a><a 
 id="x98-1214006r381"></a> <b>every</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i><br />
<i>
[Function]</i><a 
 id="dx98-1214007"></a><a 
 id="x98-1214008r382"></a> <b>notany</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i><br />
<i>
[Function]</i><a 
 id="dx98-1214009"></a><a 
 id="x98-1214010r383"></a> <b>notevery</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;rest</b>  <i>more-sequences</i>
</div>
<!--l. 505--><p class="indent" >   These are all predicates. The <i>predicate</i> must take as many arguments as there
are sequences provided. The <i>predicate</i> is ﬁrst applied to the elements with index <tt>0</tt>
                                                                          

                                                                          
in each of the sequences, and possibly then to the elements with index <tt>1</tt>, and so
on, until a termination criterion is met or the end of the shortest of the <i>sequences</i>
is reached.
<!--l. 512--><p class="indent" >   If the <i>predicate</i> has side eﬀects, it can count on being called ﬁrst on all the
elements numbered <tt>0</tt>, then on all those numbered <tt>1</tt>, and so on.
<tt>
<!--l. 516--><p class="indent" >   <a 
href="symbols.html#x185-2637813r813">some</a></tt> returns as soon as any invocation of <i>predicate</i> returns a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> value;
<tt><a 
href="symbols.html#x185-2637813r813">some</a></tt> returns that value. If the end of a sequence is reached, <tt><a 
href="symbols.html#x185-2637813r813">some</a></tt> returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>.
Thus, considered as a predicate, it is true if <i>some</i> invocation of <i>predicate</i> is
true.
<tt>
<!--l. 522--><p class="indent" >   <a 
href="symbols.html#x185-2637347r347">every</a></tt> returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> as soon as any invocation of <i>predicate</i> returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. If
the end of a sequence is reached, <tt><a 
href="symbols.html#x185-2637347r347">every</a></tt> returns a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> value. Thus,
considered as a predicate, it is true if <i>every</i> invocation of <i>predicate</i> is
true.
<tt>
<!--l. 528--><p class="indent" >   <a 
href="symbols.html#x185-2637616r616">notany</a></tt> returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> as soon as any invocation of <i>predicate</i> returns a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>
value. If the end of a sequence is reached, <tt><a 
href="symbols.html#x185-2637616r616">notany</a></tt> returns a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> value.
Thus, considered as a predicate, it is true if <i>no</i> invocation of <i>predicate</i> is
true.
<tt>
<!--l. 534--><p class="indent" >   <a 
href="symbols.html#x185-2637617r617">notevery</a></tt> returns a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> value as soon as any invocation of <i>predicate</i>
returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. If the end of a sequence is reached, <tt><a 
href="symbols.html#x185-2637617r617">notevery</a></tt> returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. Thus,
considered as a predicate, it is true if <i>not every</i> invocation of <i>predicate</i> is
true.
<div class="new">
<!--l. 541--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx98-1214011"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class="defun">
<!--l. 547--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx98-1214012"></a><a 
 id="x98-1214013r384"></a> <b>reduce</b>  <i>function</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:start</i> <i>:end</i>
<i>:initial-value</i>
</div>
<!--l. 550--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2637731r731">reduce</a></tt> function combines all the elements of a sequence using a binary
operation; for example, using <tt><a 
href="symbols.html#x185-2637051r51">+</a></tt> one can add up all the elements.
<!--l. 554--><p class="indent" >   The speciﬁed subsequence of the <i>sequence</i> is combined or “reduced” using the
                                                                          

                                                                          
<i>function</i>, which must accept two arguments. The reduction is left-associative,
unless the <tt>:from-end</tt> argument is true (it defaults to <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>), in which case it is
right-associative. If an <tt>:initial-value</tt> argument is given, it is logically placed
before the subsequence (after it if <tt>:from-end</tt> is true) and included in the
reduction operation.
<!--l. 563--><p class="indent" >   If the speciﬁed subsequence contains exactly one element and the keyword
argument <tt>:initial-value</tt> is not given, then that element is returned and
the <i>function</i> is not called. If the speciﬁed subsequence is empty and an
<tt>:initial-value</tt> is given, then the <tt>:initial-value</tt> is returned and the <i>function</i>
is not called.
<!--l. 571--><p class="indent" >   If the speciﬁed subsequence is empty and no <tt>:initial-value</tt> is given, then
the <i>function</i> is called with zero arguments, and <tt><a 
href="symbols.html#x185-2637731r731">reduce</a></tt> returns whatever the
function does. (This is the only case where the <i>function</i> is called with other than
two arguments.)
<div class="lisp">
<!--l. 577--><p class="indent" >   <div class="tabbing">
(reduce #&#x2019;+ &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> 10
   <br>                             (reduce #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ≡</span> (- (- (- 1 2) 3) 4) <span class="math"> ⇒</span> -8<br>
(reduce #&#x2019;- &#x2019;(1 2 3 4) :from-end t)     ;Alternating sum<br>
   <span class="math"> ≡</span> (- 1 (- 2 (- 3 4))) <span class="math"> ⇒</span> -2<br>
(reduce #&#x2019;+ &#x2019;()) <span class="math"> ⇒</span> 0<br>                             (reduce #&#x2019;+ &#x2019;(3)) <span class="math"> ⇒</span> 3<br>
(reduce #&#x2019;+ &#x2019;(foo)) <span class="math"> ⇒</span> foo<br>      (reduce #&#x2019;list &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (((1 2) 3) 4)<br>
(reduce #&#x2019;list &#x2019;(1 2 3 4) :from-end t) <span class="math"> ⇒</span> (1 (2 (3 4)))<br>
(reduce #&#x2019;list &#x2019;(1 2 3 4) :initial-value &#x2019;foo)<br>           <span class="math"> ⇒</span> ((((foo 1) 2) 3) 4)<br>
(reduce #&#x2019;list &#x2019;(1 2 3 4)<br>                    :from-end t :initial-value &#x2019;foo)<br>
   <span class="math"> ⇒</span> (1 (2 (3 (4 foo))))<br>
<!--l. 592--><p class="noindent" ></div>
<!--l. 592--><p class="noindent" ><span class="paragraphHead"><a 
href="#x98-121500014.2" id="x98-121500014.2"></a></span>
<!--l. 592--><p class="noindent" ><span class="paragraphHead"><a 
href="#x98-121600014.2" id="x98-121600014.2"></a></span>
</div>
                                                                          

                                                                          
<!--l. 593--><p class="indent" >   If the <i>function</i> produces side eﬀects, the order of the calls to the <i>function</i>
can be correctly predicted from the reduction ordering demonstrated
above.
<!--l. 597--><p class="indent" >   The name “reduce” for this function is borrowed from APL.
<div class="new">
<!--l. 600--><p class="indent" >   X3J13 voted in March 1988 <a 
 id="dx98-1216001"></a>to extend the <tt><a 
href="symbols.html#x185-2637731r731">reduce</a></tt> function to take
an additional keyword argument named <tt>:key</tt>. As usual, this argument
defaults to the identity function. The value of this argument must be a
function that accepts at least one argument. This function is applied once
to each element of the sequence that is to participate in the reduction
operation, in the order implied by the <tt>:from-end</tt> argument; the values
returned by this function are combined by the reduction <i>function</i>. However,
the <tt>:key</tt> function is <i>not</i> applied to the <tt>:initial-value</tt> argument (if
any).
</div>
<div class="new">
<!--l. 614--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx98-1216002"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
                                                                          

                                                                          
<!--l. 620--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse80.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse78.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse78.html#tailclmse78.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse79.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="kseque.html#clmse79.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse79.html"></a>   </div> </div> 
</body></html> 
