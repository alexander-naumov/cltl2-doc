<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Array Creation</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 26--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse92.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="array.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="array.html#tailarray.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse91.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="array.html#clmse91.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">17.1   </span> <a 
href="clm.html#QQ2-113-1425" id="x113-139500017.1">Array Creation</a></h3>
<!--l. 28--><p class="noindent" >Do not be daunted by the many options of the function <tt><a 
href="symbols.html#x185-2637533r533">make-array</a></tt>. All that is
required to construct an array is a list of the dimensions; most of the options are
for relatively esoteric applications.
<div class="defun">
<!--l. 33--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx113-1395001"></a><a 
 id="x113-1395002r524"></a> <b>make-array</b>  <i>dimensions</i> <b>&#x0026;key</b>  <i>:element-type</i> <i>:initial-element</i>
<i>:initial-contents</i> <i>:adjustable</i> <i>:ﬁll-pointer</i> <i>:displaced-to</i> <i>:displaced-index-oﬀset</i>
</div>
<!--l. 36--><p class="indent" >   This is the primitive function for making arrays. The <i>dimensions</i> argument
should be a list of non-negative integers that are to be the dimensions of the
array; the length of the list will be the dimensionality of the array. Each
dimension must be smaller than <tt><a 
href="symbols.html#x185-2637091r91">array-dimension-limit</a></tt>, and the product of all
the dimensions must be smaller than <tt><a 
href="symbols.html#x185-2637101r101">array-total-size-limit</a></tt>. Note that if
<i>dimensions</i> is <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>, then a zero-dimensional array is created. For convenience when
                                                                          

                                                                          
making a one-dimensional array, the single dimension may be provided as an
integer rather than as a list of one integer.
<!--l. 47--><p class="indent" >   An implementation of Common Lisp may impose a limit on the rank
of an array, but this limit may not be smaller than 7. Therefore, any
Common Lisp program may assume the use of arrays of rank 7 or less. The
implementation-dependent limit on array rank is reﬂected in <tt><a 
href="symbols.html#x185-2637098r98">array-rank-limit</a></tt>.
<!--l. 53--><p class="indent" >   The keyword arguments for <tt><a 
href="symbols.html#x185-2637533r533">make-array</a></tt> are as follows:
<div class="flushdesc">
      <ul><li><b>
<tt>:element-type</tt> </b></li>This  argument  should  be  the  name  of  the  type  of  the
      elements of the array; an array is constructed of the most specialized
      type that can nevertheless accommodate elements of the given type.
      The type <tt><a 
href="symbols.html#x185-2637871r871">t</a></tt> speciﬁes a general array, one whose elements may be any
      Lisp object; this is the default type.
<div class="new">
      <!--l. 66--><p class="noindent" >X3J13 voted in January 1989 <a 
 id="dx113-1395003"></a>to change <tt><a 
href="symbols.html#x185-2637896r896">typep</a></tt> and <tt><a 
href="symbols.html#x185-2637858r858">subtypep</a></tt> so that the
      specialized <tt>array</tt> type speciﬁer means the same thing for discrimination
      purposes as for declaration purposes: it encompasses those arrays that can
      result by specifying <i>element-type</i> as the element type to the function
      <tt><a 
href="symbols.html#x185-2637533r533">make-array</a></tt>. Therefore we may say that if <i>type</i> is the <tt>:element-type</tt>
      argument, then the result will be an array of type <tt>(array <i>type</i>)</tt>; put
      another way, for any type <i>A</i>, <div class="lisp"><div class="tabbing">
      (typep (make-array ... :element-type &#x2019;<i>A</i> ...)
      <br>                                                                        &#x2019;(array <i>A</i>)))<br>
      <!--l. 80--><p class="noindent" ></div>
      <!--l. 80--><p class="noindent" ><span class="paragraphHead"><a 
href="#x113-139600017.1" id="x113-139600017.1"></a></span>
                                                                          

                                                                          
      <!--l. 80--><p class="noindent" ><span class="paragraphHead"><a 
href="#x113-139700017.1" id="x113-139700017.1"></a></span>
</div>
      <!--l. 81--><p class="noindent" >is always true. See <tt><a 
href="symbols.html#x185-2637911r911">upgraded-array-element-type</a></tt>.
      </div>
      <li><b>
<tt>:initial-element</tt> </b></li>This argument may be used to initialize each element of the
      array. The value must be of the type speciﬁed by the <tt>:element-type</tt>
      argument. If the <tt>:initial-element</tt> option is omitted, the initial values of
      the array elements are undeﬁned (unless the <tt>:initial-contents</tt> or
      <tt>:displaced-to</tt> option is used). The <tt>:initial-element</tt> option
      may not be used with the <tt>:initial-contents</tt> or <tt>:displaced-to</tt>
      option.
      <li><b>
<tt>:initial-contents</tt> </b></li>This argument may be used to initialize the contents
      of the array. The value is a nested structure of sequences. If the
      array is zero-dimensional, then the value speciﬁes the single element.
      Otherwise, the value must be a sequence whose length is equal to the ﬁrst
      dimension; each element must be a nested structure for an array whose
      dimensions are the remaining dimensions, and so on. For example:
      <div class="lisp"><div class="tabbing">
      (make-array &#x2019;(4 2 3)
      <br>                                                                 :initial-contents<br>
                       &#x2019;(((a b c) (1 2 3))<br>
                         ((d e f) (3 1 2))<br>
                         ((g h i) (2 3 1))<br>
                         ((j k l) (0 0 0))))<br>
      <!--l. 110--><p class="noindent" ></div>
      <!--l. 110--><p class="noindent" ><span class="paragraphHead"><a 
href="#x113-139800017.1" id="x113-139800017.1"></a></span>
                                                                          

                                                                          
      <!--l. 110--><p class="noindent" ><span class="paragraphHead"><a 
href="#x113-139900017.1" id="x113-139900017.1"></a></span>
</div>
      <!--l. 111--><p class="noindent" >The numbers of levels in the structure must equal the rank of the array.
      Each leaf of the nested structure must be of the type speciﬁed by the <tt>:type</tt>
      option. If the <tt>:initial-contents</tt> option is omitted, the initial values of
      the array elements are undeﬁned (unless the <tt>:initial-element</tt> or
      <tt>:displaced-to</tt> option is used). The <tt>:initial-contents</tt> option
      may not be used with the <tt>:initial-element</tt> or <tt>:displaced-to</tt>
      option.
      <li><b>
<tt>:adjustable</tt> </b></li>This argument, if speciﬁed and not <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>, indicates that it must be
      possible to alter the array&#x2019;s size dynamically after it is created. This
      argument defaults to <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>.
<div class="newer">
      <!--l. 126--><p class="noindent" >X3J13 voted in June 1989 <a 
 id="dx113-1399001"></a>to clarify that if this argument is non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> then
      the predicate <tt><a 
href="symbols.html#x185-2637074r74">adjustable-array-p</a></tt> will necessarily be true when applied to
      the resulting array; but if this argument is <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> (or omitted) then
      the resulting array may or may not be adjustable, depending on
      the implementation, and therefore <tt><a 
href="symbols.html#x185-2637074r74">adjustable-array-p</a></tt> may be
      correspondingly true or false of the resulting array. Common Lisp
      provides no portable way to create a non-adjustable array, that
      is, an array for which <tt><a 
href="symbols.html#x185-2637074r74">adjustable-array-p</a></tt> is guaranteed to be
      false.
      </div>
      <li><b>
<tt>:fill-pointer</tt> </b></li>This argument speciﬁes that the array should have a
      ﬁll pointer. If this option is speciﬁed and not <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>, the array must
      be one-dimensional. The value is used to initialize the ﬁll pointer
      for the array. If the value <tt><a 
href="symbols.html#x185-2637871r871">t</a></tt> is speciﬁed, the length of the array is
      used; otherwise the value must be an integer between 0 (inclusive)
      and the length of the array (inclusive). This argument defaults to
      <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>.
      <li><b>
<tt>:displaced-to</tt> </b></li>This argument, if speciﬁed and not <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>, speciﬁes that the array
      will be a <i>displaced</i> array. The argument must then be an array; <tt><a 
href="symbols.html#x185-2637533r533">make-array</a></tt>
                                                                          

                                                                          
      will create an <i>indirect</i> or <i>shared</i> array that shares its contents with the
      speciﬁed array. In this case the <tt>:displaced-index-offset</tt> option may be
      useful. It is an error if the array given as the <tt>:displaced-to</tt> argument does
      not have the same <tt>:element-type</tt> as the array being created. The
      <tt>:displaced-to</tt> option may not be used with the <tt>:initial-element</tt> or
      <tt>:initial-contents</tt> option. This argument defaults to <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>.
      <li><b>
<tt>:displaced-index-offset</tt> </b></li>This argument may be used only in conjunction with
      the <tt>:displaced-to</tt> option. It must be a non-negative integer (it defaults
      to zero); it is made to be the index-oﬀset of the created shared
      array.
      <!--l. 169--><p class="noindent" >When an array A is given as the <tt>:displaced-to</tt> argument to <tt><a 
href="symbols.html#x185-2637533r533">make-array</a></tt>
      when creating array B, then array B is said to be <i>displaced</i> to array A. Now
      the total number of elements in an array, called the <i>total size</i> of the array, is
      calculated as the product of all the dimensions (see <tt><a 
href="symbols.html#x185-2637100r100">array-total-size</a></tt>). It
      is required that the total size of A be no smaller than the sum of the total
      size of B plus the oﬀset <i>n</i> speciﬁed by the <tt>:displaced-index-offset</tt>
      argument. The eﬀect of displacing is that array B does not have
      any elements of its own but instead maps accesses to itself into
      accesses to array A. The mapping treats both arrays as if they were
      one-dimensional by taking the elements in row-major order, and then maps
      an access to element <i>k</i> of array B to an access to element <i>k</i>+<i>n</i> of array
      A.</ul>
</div>
<!--l. 186--><p class="indent" >   If <tt><a 
href="symbols.html#x185-2637533r533">make-array</a></tt> is called with each of the <tt>:adjustable</tt>, <tt>:fill-pointer</tt>, and
<tt>:displaced-to</tt> arguments either unspeciﬁed or <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>, then the resulting array is
guaranteed to be a <i>simple</i> array (see section <a 
href="clmse7.html#x14-920002.5">2.5<!--tex4ht:ref: ARRAY-TYPE-SECTION --></a>).
<div class="newer">
<!--l. 193--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx113-1399002"></a>to clarify that if one or more of the <tt>:adjustable</tt>,
<tt>:fill-pointer</tt>, and <tt>:displaced-to</tt> arguments is true, then whether the
resulting array is simple is unspeciﬁed.
</div>
<!--l. 200--><p class="indent" >   Here are some examples of the use of <tt><a 
href="symbols.html#x185-2637533r533">make-array</a></tt>: <div class="lisp"><div class="tabbing">
;;; Create a one-dimensional array of ﬁve elements.
                                                                          

                                                                          
   <br>                                                                            (make-array 5)<br>
<br>          ;;; Create a two-dimensional array, 3 by 4, with four-bit elements.<br>
(make-array &#x2019;(3 4) <tt>:element-type</tt> &#x2019;(mod 16))<br>
<br>                                         ;;; Create an array of single-ﬂoats.<br>
(make-array 5 <tt>:element-type</tt> &#x2019;single-ﬂoat))<br>   <br>    ;;; Making a shared array.<br>
(setq a (make-array &#x2019;(4 3)))<br>           (setq b (make-array 8 :displaced-to a<br>
                      :displaced-index-oﬀset 2))<br>
;;; Now it is the case that:<br>                       (aref b 0) <span class="math"> ≡</span> (aref a 0 2)<br>
        (aref b 1) <span class="math"> ≡</span> (aref a 1 0)<br>              (aref b 2) <span class="math"> ≡</span> (aref a 1 1)<br>
        (aref b 3) <span class="math"> ≡</span> (aref a 1 2)<br>              (aref b 4) <span class="math"> ≡</span> (aref a 2 0)<br>
        (aref b 5) <span class="math"> ≡</span> (aref a 2 1)<br>              (aref b 6) <span class="math"> ≡</span> (aref a 2 2)<br>
        (aref b 7) <span class="math"> ≡</span> (aref a 3 0)<br>
<!--l. 224--><p class="noindent" ></div>
<!--l. 224--><p class="noindent" ><span class="paragraphHead"><a 
href="#x113-140000017.1" id="x113-140000017.1"></a></span>
<!--l. 224--><p class="noindent" ><span class="paragraphHead"><a 
href="#x113-140100017.1" id="x113-140100017.1"></a></span>
</div>
<!--l. 225--><p class="indent" >   The last example depends on the fact that arrays are, in eﬀect, stored in
row-major order for purposes of sharing. Put another way, the indices for the
elements of an array are ordered lexicographically.
</div>
<div class="defun">
<!--l. 231--><p class="noindent" ><div class="defunheader"> <i>[Constant]</i><a 
 id="dx113-1401001"></a><a 
 id="x113-1401002r525"></a> <b>array-rank-limit</b>
</div>
<!--l. 234--><p class="indent" >   The value of <tt><a 
href="symbols.html#x185-2637098r98">array-rank-limit</a></tt> is a positive integer that is the upper
exclusive bound on the rank of an array. This bound depends on the
implementation but will not be smaller than 8; therefore every Common Lisp
implementation supports arrays whose rank is between 0 and 7 (inclusive).
(Implementors are encouraged to make this limit as large as practicable without
sacriﬁcing performance.)
</div>
<div class="defun">
                                                                          

                                                                          
<!--l. 243--><p class="noindent" ><div class="defunheader"> <i>[Constant]</i><a 
 id="dx113-1401003"></a><a 
 id="x113-1401004r526"></a> <b>array-dimension-limit</b>
</div>
<!--l. 246--><p class="indent" >   The value of <tt><a 
href="symbols.html#x185-2637091r91">array-dimension-limit</a></tt> is a positive integer that is the upper
exclusive bound on each individual dimension of an array. This bound depends on
the implementation but will not be smaller than 1024. (Implementors are
encouraged to make this limit as large as practicable without sacriﬁcing
performance.)
<div class="new">
<!--l. 254--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx113-1401005"></a>to specify that the value of <tt>array-dimension-limit</tt>
must be of type <tt>fixnum</tt>. This in turn implies that all valid array indices will be
ﬁxnums.
</div>
</div>
<div class="defun">
<!--l. 262--><p class="noindent" ><div class="defunheader"> <i>[Constant]</i><a 
 id="dx113-1401006"></a><a 
 id="x113-1401007r527"></a> <b>array-total-size-limit</b>
</div>
<!--l. 265--><p class="indent" >   The value of <tt><a 
href="symbols.html#x185-2637101r101">array-total-size-limit</a></tt> is a positive integer that is the upper
exclusive bound on the total number of elements in an array. This bound depends
on the implementation but will not be smaller than 1024. (Implementors are
encouraged to make this limit as large as practicable without sacriﬁcing
performance.)
<!--l. 272--><p class="indent" >   The actual limit on array size imposed by the implementation may vary
according to the <tt>:element-type</tt> of the array; in this case the value of
<tt><a 
href="symbols.html#x185-2637101r101">array-total-size-limit</a></tt> will be the smallest of these individual limits.
</div>
<div class="defun">
<!--l. 278--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx113-1401008"></a><a 
 id="x113-1401009r528"></a> <b>vector</b>  <b>&#x0026;rest</b>  <i>objects</i>
</div>
<!--l. 281--><p class="indent" >   The function <tt><a 
href="symbols.html#x185-2637920r920">vector</a></tt> is a convenient means for creating a simple general
vector with speciﬁed initial contents. It is analogous to the function <tt><a 
href="symbols.html#x185-2637492r492">list</a></tt>.
<div class="lisp"><div class="tabbing">
                                                                          

                                                                          
(vector <span class="math"><i>a</i><sub>1</sub></span> <span class="math"><i>a</i><sub>2</sub></span> ... <span class="math"><i>a</i><sub>n</sub></span>)
   <br>                                          <span class="math"> ≡</span> (make-array (list <span class="math"><i>n</i></span>) :element-type t<br>
             :initial-contents (list <span class="math"><i>a</i><sub>1</sub></span> <span class="math"><i>a</i><sub>2</sub></span> ... <span class="math"><i>a</i><sub>n</sub></span>))<br>
<!--l. 288--><p class="noindent" ></div>
<!--l. 288--><p class="noindent" ><span class="paragraphHead"><a 
href="#x113-140200017.1" id="x113-140200017.1"></a></span>
<!--l. 288--><p class="noindent" ><span class="paragraphHead"><a 
href="#x113-140300017.1" id="x113-140300017.1"></a></span>
</div>
</div>
                                                                          

                                                                          
<!--l. 291--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse92.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="array.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="array.html#tailarray.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse91.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="array.html#clmse91.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse91.html"></a>   </div> </div> 
</body></html> 
