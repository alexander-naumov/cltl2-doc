<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>By-Position Constructor Functions</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 16:10:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 806--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse106.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html#tailclmse104.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse105.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html#clmse105.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">19.6   </span> <a 
href="clm.html#QQ2-129-1546" id="x129-151600019.6">By-Position Constructor
Functions</a></h3>
<!--l. 809--><p class="noindent" >If the <tt>:constructor</tt> option is given as <tt>(<tt>:constructor</tt> <i>name</i> <i>arglist</i>)</tt>, then
instead of making a keyword-driven constructor function, <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> deﬁnes a
“positional” constructor function, taking arguments whose meaning is determined
by the argument&#x2019;s position rather than by a keyword. The <i>arglist</i> is used to
describe what the arguments to the constructor will be. In the simplest case
something like <tt>(<tt>:constructor</tt> make-foo (a b c))</tt> deﬁnes <tt>make-foo</tt> to be a
three-argument constructor function whose arguments are used to initialize the
slots named <tt>a</tt>, <tt>b</tt>, and <tt>c</tt>.
<!--l. 821--><p class="indent" >   In addition, the keywords <tt>&#x0026;optional</tt>, <tt>&#x0026;rest</tt>, and <tt>&#x0026;aux</tt> are recognized in the
argument list. They work in the way you might expect, but there are a few ﬁne
points worthy of explanation. Consider this example: <div class="lisp"><div class="tabbing">
(<tt>:constructor</tt> create-foo
   <br>                            (a &#x0026;optional b (c &#x2019;sea) &#x0026;rest d &#x0026;aux e (f &#x2019;eﬀ)))<br>
<!--l. 828--><p class="noindent" ></div>
<!--l. 828--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-151700019.6" id="x129-151700019.6"></a></span>
<!--l. 828--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-151800019.6" id="x129-151800019.6"></a></span>
</div>
<!--l. 829--><p class="indent" >   This deﬁnes <tt>create-foo</tt> to be a constructor of one or more arguments. The
ﬁrst argument is used to initialize the <tt>a</tt> slot. The second argument is used to
initialize the <tt>b</tt> slot. If there isn&#x2019;t any second argument, then the default value
given in the body of the <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> (if given) is used instead. The third argument
is used to initialize the <tt>c</tt> slot. If there isn&#x2019;t any third argument, then the symbol
<tt>sea</tt> is used instead. Any arguments following the third argument are collected
into a list and used to initialize the <tt>d</tt> slot. If there are three or fewer arguments,
                                                                          

                                                                          
then <tt><a 
href="symbols.html#x187-2636609r609">nil</a></tt> is placed in the <tt>d</tt> slot. The <tt>e</tt> slot <i>is not initialized</i>; its initial
value is undeﬁned. Finally, the <tt><a 
href="symbols.html#x187-2636351r351">f</a></tt> slot is initialized to contain the symbol
<tt>eff</tt>.
<!--l. 842--><p class="indent" >   The actions taken in the <tt>b</tt> and <tt>e</tt> cases were carefully chosen to allow the
user to specify all possible behaviors. Note that the <tt>&#x0026;aux</tt> “variables” can
be used to completely override the default initializations given in the
body.
<!--l. 847--><p class="indent" >   With this deﬁnition, one can write <div class="lisp"><div class="tabbing">
(create-foo 1 2)
   <br>
<!--l. 850--><p class="noindent" ></div>
<!--l. 850--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-151900019.6" id="x129-151900019.6"></a></span>
<!--l. 850--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152000019.6" id="x129-152000019.6"></a></span>
</div>
<!--l. 851--><p class="indent" >   instead of <div class="lisp"><div class="tabbing">
(make-foo <tt>:a</tt> 1 <tt>:b</tt> 2)
   <br>
<!--l. 854--><p class="noindent" ></div>
<!--l. 854--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152100019.6" id="x129-152100019.6"></a></span>
<!--l. 854--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152200019.6" id="x129-152200019.6"></a></span>
</div>
<!--l. 855--><p class="indent" >   and of course <tt>create-foo</tt> provides defaulting diﬀerent from that of
<tt>make-foo</tt>.
                                                                          

                                                                          
<!--l. 858--><p class="indent" >   It is permissible to use the <tt>:constructor</tt> option more than once, so that you
can deﬁne several diﬀerent constructor functions, each taking diﬀerent
parameters.
<!--l. 862--><p class="indent" >   Because a constructor of this type operates By Order of Arguments, it is
sometimes known as a BOA constructor.
<div class="new">
<!--l. 866--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx129-1522001"></a>to allow <tt>&#x0026;key</tt> and <tt>&#x0026;allow-other-keys</tt> in the
parameter list of a “positional” constructor. The initialization of slots
corresponding to keyword parameters is performed in the same manner as for
<tt>&#x0026;optional</tt> parameters. A variant of the example shown above illustrates this:
<div class="lisp"><div class="tabbing">
(<tt>:constructor</tt> create-foo
   <br>                                                             (a &#x0026;optional b (c &#x2019;sea)<br>
         &#x0026;key p (q &#x2019;cue) ((:why y)) ((:you u) &#x2019;ewe)<br>
         &#x0026;aux e (f &#x2019;eﬀ)))<br>
<!--l. 879--><p class="noindent" ></div>
<!--l. 879--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152300019.6" id="x129-152300019.6"></a></span>
<!--l. 879--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152400019.6" id="x129-152400019.6"></a></span>
</div>
<!--l. 880--><p class="indent" >   The treatment of slots <tt>a</tt>, <tt>b</tt>, <tt>c</tt>, <tt>e</tt>, and <tt><a 
href="symbols.html#x187-2636351r351">f</a></tt> is the same as in the original
example. In addition, if there is a <tt>:p</tt> keyword argument, it is used to
initialize the <tt>p</tt> slot; if there isn&#x2019;t any <tt>:p</tt> keyword argument, then the
default value given in the body of the <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> (if given) is used instead.
Similarly, if there is a <tt>:q</tt> keyword argument, it is used to initialize the <tt>q</tt>
slot; if there isn&#x2019;t any <tt>:q</tt> keyword argument, then the symbol <tt>cue</tt> is used
instead.
<!--l. 891--><p class="indent" >   In order thoroughly to ﬂog this presumably already dead horse, we further
observe that if there is a <tt>:why</tt> keyword argument, it is used to initialize the <tt>y</tt> slot;
otherwise the default value for slot <tt>y</tt> is used instead. Similarly, if there is a <tt>:you</tt>
keyword argument, it is used to initialize the <tt>u</tt> slot; otherwise the symbol <tt>ewe</tt> is
used instead.
                                                                          

                                                                          
<!--l. 899--><p class="indent" >   If memory serves me correctly, <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> was included in the original design
for Common Lisp some time before keyword arguments were approved. The
failure of positional constructors to accept keyword arguments may well have been
an oversight on my part; there is no logical reason to exclude them. I am grateful
to X3J13 for rectifying this.
<!--l. 905--><p class="indent" >   A remaining diﬃculty is that the possibility of keyword arguments renders the
term “positional constructor” a misnomer. Worse yet, it ruins the term “BOA
constructor.” I suggest that they continue to be called BOA constructors, as I
refuse to abandon a good pun. (I regret appearing to have more compassion for
puns than for horses.)
<!--l. 912--><p class="indent" >   As part of the same vote X3J13 also changed <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> to allow BOA
constructors to have parameters (including supplied-p parameters) that do not
correspond to any slot. Such parameters may be used in subsequent initialization
forms in the parameter list. Consider this example: <div class="lisp"><div class="tabbing">
(defstruct (ice-cream-factory
   <br>                                                (:constructor fabricate-factory<br>
               (&#x0026;key (capacity 5)<br>                          location<br>
                      (local-ﬂavors<br>                        (case location<br>
                          ((hawaii) &#x2019;(pineapple macadamia guava))<br>
                          ((massachusetts) &#x2019;(lobster baked-bean))<br>
                          ((california) &#x2019;(ginger lotus avocado<br>
                                          bean-sprout garlic))<br>
                          ((texas) &#x2019;(jalapeno barbecue))))<br>
                      (ﬂavors (subseq (append local-ﬂavors<br>
                                               &#x2019;(vanilla<br>
                                                 chocolate<br>
                                                 strawberry<br>
                                                 pistachio<br>
                                                 maple-walnut<br>
                                                 peppermint))<br>
                                       0 capacity)))))<br>
  (capacity 3)<br>             (ﬂavors &#x2019;(vanilla chocolate strawberry mango)))<br>
<!--l. 940--><p class="noindent" ></div>
<!--l. 940--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152500019.6" id="x129-152500019.6"></a></span>
                                                                          

                                                                          
<!--l. 940--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152600019.6" id="x129-152600019.6"></a></span>
</div>
<!--l. 942--><p class="indent" >   The structure type <tt>ice-cream-factory</tt> has two constructors. The standard
constructor, <tt>make-ice-cream-factory</tt>, takes two keyword arguments named
<tt>:capacity</tt> and <tt>:flavors</tt>. For this constructor, the default for the <tt>capacity</tt> slot
is <tt>3</tt> and the default list of <tt>flavors</tt> is America&#x2019;s favorite threesome and a dark
horse (not a dead one). The BOA constructor <tt>fabricate-factory</tt> accepts four
diﬀerent keyword arguments. The <tt>:capacity</tt> argument defaults to <tt>5</tt>, and the
<tt>:flavors</tt> argument defaults in a complicated manner based on the other three.
The <tt>:local-flavors</tt> argument may be speciﬁed directly, or may be allowed to
default based on the <tt>:location</tt> of the factory. Here are examples of various
factories:
<div class="lisp">
<!--l. 957--><p class="indent" >   <div class="tabbing">
(setq houston (fabricate-factory :capacity 4 :location &#x2019;texas))
   <br>                (setq cambridge (fabricate-factory :location &#x2019;massachusetts))<br>
(setq seattle (fabricate-factory :local-ﬂavors &#x2019;(salmon)))<br>
(setq wheaton (fabricate-factory :capacity 4 :location &#x2019;illinois))<br>
(setq pittsburgh (fabricate-factory :capacity 4))<br>
(setq cleveland (make-factory :capacity 4))<br>
<br>                                        (ice-cream-factory-ﬂavors houston)<br>
 <span class="math"> ⇒</span> (jalapeno barbecue vanilla chocolate)<br>
<!--l. 967--><p class="noindent" ></div>
<!--l. 967--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152700019.6" id="x129-152700019.6"></a></span>
<!--l. 967--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152800019.6" id="x129-152800019.6"></a></span>
</div>
<!--l. 968--><p class="indent" >
                                                                          

                                                                          
<div class="lisp">
<!--l. 969--><p class="indent" >   <div class="tabbing">
(ice-cream-factory-ﬂavors cambridge)
   <br>                        <span class="math"> ⇒</span> (lobster baked-bean vanilla chocolate strawberry)<br>
<br>                                          (ice-cream-factory-ﬂavors seattle)<br>
 <span class="math"> ⇒</span> (salmon vanilla chocolate strawberry pistachio)<br>
<br>                                        (ice-cream-factory-ﬂavors wheaton)<br>
 <span class="math"> ⇒</span> (vanilla chocolate strawberry pistachio)<br>
<br>                                      (ice-cream-factory-ﬂavors pittsburgh)<br>
 <span class="math"> ⇒</span> (vanilla chocolate strawberry pistachio)<br>
<br>                                       (ice-cream-factory-ﬂavors cleveland)<br>
 <span class="math"> ⇒</span> (vanilla chocolate strawberry mango)<br>
<!--l. 984--><p class="noindent" ></div>
<!--l. 984--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-152900019.6" id="x129-152900019.6"></a></span>
<!--l. 984--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-153000019.6" id="x129-153000019.6"></a></span>
</div>
</div>
                                                                          

                                                                          
<!--l. 988--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse106.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html#tailclmse104.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html#clmse105.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse105.html"></a>   </div> </div> 
</body></html> 
