<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Searching Sequences for Items</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 956--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse82.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse80.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse80.html#tailclmse80.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse81.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="kseque.html#clmse81.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">14.4   </span> <a 
href="clm.html#QQ2-100-1262" id="x100-123200014.4">Searching Sequences for Items</a></h3>
<!--l. 958--><p class="noindent" >Each of these functions searches a sequence to locate one or more elements
satisfying some test.
<div class="defun">
<!--l. 961--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx100-1232001"></a><a 
 id="x100-1232002r401"></a> <b>ﬁnd</b>  <i>item</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:test</i> <i>:test-not</i> <i>:start :end</i>
<i>:key</i><br />
<i>
[Function]</i><a 
 id="dx100-1232003"></a><a 
 id="x100-1232004r402"></a> <b>ﬁnd-if</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:start</i> <i>:end</i> <i>:key</i><br />
<i>
[Function]</i><a 
 id="dx100-1232005"></a><a 
 id="x100-1232006r403"></a> <b>ﬁnd-if-not</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:start :end :key</i>
</div>
<!--l. 966--><p class="indent" >   If the <i>sequence</i> contains an element satisfying the test, then the leftmost such
element is returned; otherwise <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> is returned.
<!--l. 970--><p class="indent" >   If <tt>:start</tt> and <tt>:end</tt> keyword arguments are given, only the speciﬁed
subsequence of <i>sequence</i> is searched.
<!--l. 973--><p class="indent" >   If a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> <tt>:from-end</tt> keyword argument is speciﬁed, then the result is the
<i>rightmost</i> element satisfying the test.
<div class="new">
<!--l. 977--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-1232007"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class="defun">
<!--l. 983--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx100-1232008"></a><a 
 id="x100-1232009r404"></a> <b>position</b>  <i>item</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:test</i> <i>:test-not</i>
<i>:start :end :key</i><br />
<i>
[Function]</i><a 
 id="dx100-1232010"></a><a 
 id="x100-1232011r405"></a> <b>position-if</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:start :end :key</i><br />
<i>
[Function]</i><a 
 id="dx100-1232012"></a><a 
 id="x100-1232013r406"></a> <b>position-if-not</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i>
<i>:start :end :key</i>
                                                                          

                                                                          
</div>
<!--l. 988--><p class="indent" >   If the <i>sequence</i> contains an element satisfying the test, then the index within
the sequence of the leftmost such element is returned as a non-negative integer;
otherwise <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> is returned.
<!--l. 992--><p class="indent" >   If <tt>:start</tt> and <tt>:end</tt> keyword arguments are given, only the speciﬁed
subsequence of <i>sequence</i> is searched. However, the index returned is relative to the
entire sequence, not to the subsequence.
<!--l. 997--><p class="indent" >   If a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> <tt>:from-end</tt> keyword argument is speciﬁed, then the result is the
index of the <i>rightmost</i> element satisfying the test. (The index returned, however,
is an index from the left-hand end, as usual.)
<div class="new">
<!--l. 1002--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-1232014"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<!--l. 1008--><p class="indent" >   Here is a simple piece of code that uses several of the sequence functions,
notably <tt><a 
href="symbols.html#x185-2637672r672">position-if</a></tt> and <tt><a 
href="symbols.html#x185-2637371r371">find-if</a></tt>, to process strings. Note one use of <tt><a 
href="symbols.html#x185-2637522r522">loop</a></tt> as
well. <div class="lisp"><div class="tabbing">
(defun debug-palindrome (s)
   <br>                              (ﬂet ((match (x) (char-equal (ﬁrst x) (third x))))<br>
    (let* ((pairs (loop for c across s<br>                        for j from 0<br>
                        when (alpha-char-p c)<br>
                          collect (list c j)))<br>
           (quads (mapcar #&#x2019;append pairs (reverse pairs)))<br>
           (diﬀpos (position-if (complement #&#x2019;match) quads)))<br>
      (when diﬀpos<br>                       (let* ((diﬀ (elt quads diﬀpos))<br>
               (same (ﬁnd-if #&#x2019;match quads<br>
                              :start (+ diﬀpos 1))))<br>
          (if same<br>                                          (format nil<br>
                      &#x0022;/~A/ (at ~D) is not the reverse of /~A/&#x0022;<br>
                      (subseq s (second diﬀ) (second same))<br>
                      (second diﬀ)<br>                      (subseq s (+ (fourth same) 1)<br>
                                (+ (fourth diﬀ) 1)))<br>
              &#x0022;This palindrome is completely messed up!&#x0022;))))))<br>
<!--l. 1032--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 1032--><p class="noindent" ><span class="paragraphHead"><a 
href="#x100-123300014.4" id="x100-123300014.4"></a></span>
<!--l. 1032--><p class="noindent" ><span class="paragraphHead"><a 
href="#x100-123400014.4" id="x100-123400014.4"></a></span>
</div>
<!--l. 1033--><p class="indent" >   Here is an example of its behavior. <div class="lisp"><div class="tabbing">
(setq panama     ;A putative palindrome?
   <br>                               &#x0022;A man, a plan, a canoe, pasta, heros, rajahs,<br>
       a coloratura, maps, waste, percale, macaroni, a gag,<br>
       a banana bag, a tan, a tag, a banana bag again<br>
       (or a camel), a crepe, pins, Spam, a rut, a Rolo,<br>
       cash, a jar, sore hats, a peon, a canal–Panama!&#x0022;)<br>
<!--l. 1041--><p class="noindent" ></div>
<!--l. 1041--><p class="noindent" ><span class="paragraphHead"><a 
href="#x100-123500014.4" id="x100-123500014.4"></a></span>
<!--l. 1041--><p class="noindent" ><span class="paragraphHead"><a 
href="#x100-123600014.4" id="x100-123600014.4"></a></span>
</div>
<div class="lisp">
<!--l. 1042--><p class="indent" >   <div class="tabbing">
(debug-palindrome panama)
   <br>                            <span class="math"> ⇒</span> &#x0022;/wast/ (at 73) is not the reverse of /, pins/&#x0022;<br>
<br>                        (replace panama &#x0022;snipe&#x0022; :start1 73)     ;Repair it<br>
  <span class="math"> ⇒</span> &#x0022;A man, a plan, a canoe, pasta, heros, rajahs,<br>
       a coloratura, maps, snipe, percale, macaroni, a gag,<br>
       a banana bag, a tan, a tag, a banana bag again<br>
       (or a camel), a crepe, pins, Spam, a rut, a Rolo,<br>
       cash, a jar, sore hats, a peon, a canal–Panama!&#x0022;<br>
<br>    (debug-palindrome panama) <span class="math"> ⇒</span> nil     ;Copacetic—a true palindrome<br>
<br>                       (debug-palindrome &#x0022;Rubber baby buggy bumpers&#x0022;)<br>
                                                                          

                                                                          
  <span class="math"> ⇒</span> &#x0022;/Rubber / (at 0) is not the reverse of /umpers/&#x0022;<br>
<br>                       (debug-palindrome &#x0022;Common Lisp: The Language&#x0022;)<br>
  <span class="math"> ⇒</span> &#x0022;/Commo/ (at 0) is not the reverse of /guage/&#x0022;<br>
<br>               (debug-palindrome &#x0022;Complete mismatches are hard to ﬁnd&#x0022;)<br>
  <span class="math"> ⇒</span> <br>    &#x0022;/Complete mism/ (at 0) is not the reverse of /re hard to ﬁnd/&#x0022;<br>
<br>               (debug-palindrome &#x0022;Waltz, nymph, for quick jigs vex Bud&#x0022;)<br>
  <span class="math"> ⇒</span> &#x0022;This palindrome is completely messed up!&#x0022;<br>
<br>                    (debug-palindrome &#x0022;Doc, note: I dissent.  A fast never<br>
                   prevents a fatness.  I diet on cod.&#x0022;)<br>
  <span class="math"> ⇒</span><tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>     ;Another winner<br>                                            <br>
(debug-palindrome &#x0022;Top step&#x2019;s pup&#x2019;s pet spot&#x0022;) <span class="math"> ⇒</span> nil<br>
<!--l. 1073--><p class="noindent" ></div>
<!--l. 1073--><p class="noindent" ><span class="paragraphHead"><a 
href="#x100-123700014.4" id="x100-123700014.4"></a></span>
<!--l. 1073--><p class="noindent" ><span class="paragraphHead"><a 
href="#x100-123800014.4" id="x100-123800014.4"></a></span>
</div>
<div class="defun">
<!--l. 1075--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx100-1238001"></a><a 
 id="x100-1238002r407"></a> <b>count</b>  <i>item</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:test</i> <i>:test-not</i>
<i>:start :end :key</i><br />
<i>
[Function]</i><a 
 id="dx100-1238003"></a><a 
 id="x100-1238004r408"></a> <b>count-if</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:start :end :key</i><br />
<i>
[Function]</i><a 
 id="dx100-1238005"></a><a 
 id="x100-1238006r409"></a> <b>count-if-not</b>  <i>predicate</i> <i>sequence</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:start :end :key</i>
</div>
<!--l. 1080--><p class="indent" >   The result is always a non-negative integer, the number of elements in the
speciﬁed subsequence of <i>sequence</i> satisfying the test.
<!--l. 1084--><p class="indent" >   The <tt>:from-end</tt> argument does not aﬀect the result returned; it is accepted
purely for compatibility with other sequence functions.
<div class="new">
<!--l. 1088--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-1238007"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class="defun">
                                                                          

                                                                          
<!--l. 1094--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx100-1238008"></a><a 
 id="x100-1238009r410"></a> <b>mismatch</b>  <i>sequence1</i> <i>sequence2</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:test</i> <i>:test-not</i>
<i>:key</i> <i>:start1</i> <i>:start2</i> <i>:end1</i> <i>:end2</i>
</div>
<!--l. 1097--><p class="indent" >   The speciﬁed subsequences of <i>sequence1</i> and <i>sequence2</i> are compared
element-wise. If they are of equal length and match in every element, the result is
<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. Otherwise, the result is a non-negative integer. This result is the index within
<i>sequence1</i> of the leftmost position at which the two subsequences fail to
match; or, if one subsequence is shorter than and a matching preﬁx of the
other, the result is the index relative to <i>sequence1</i> beyond the last position
tested.
<!--l. 1108--><p class="indent" >   If a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> <tt>:from-end</tt> keyword argument is given, then <i>one plus</i> the index of
the <i>rightmost</i> position in which the sequences diﬀer is returned. In eﬀect, the
(sub)sequences are aligned at their right-hand ends; then, the last elements are
compared, the penultimate elements, and so on. The index returned is again an
index relative to <i>sequence1</i>.
<div class="new">
<!--l. 1116--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-1238010"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class="defun">
<!--l. 1122--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx100-1238011"></a><a 
 id="x100-1238012r411"></a> <b>search</b>  <i>sequence1</i> <i>sequence2</i> <b>&#x0026;key</b>  <i>:from-end</i> <i>:test</i> <i>:test-not</i> <i>:key</i>
<i>:start1</i> <i>:start2</i> <i>:end1</i> <i>:end2</i>
</div>
<!--l. 1125--><p class="indent" >   A search is conducted for a subsequence of <i>sequence2</i> that element-wise
matches <i>sequence1</i>. If there is no such subsequence, the result is <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>; if there is,
the result is the index into <i>sequence2</i> of the leftmost element of the leftmost such
matching subsequence.
<!--l. 1131--><p class="indent" >   If a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> <tt>:from-end</tt> keyword argument is given, the index of the leftmost
element of the <i>rightmost</i> matching subsequence is returned.
<!--l. 1135--><p class="indent" >   The implementation may choose to search the sequence in any order; there is
no guarantee on the number of times the test is made. For example, <tt><a 
href="symbols.html#x185-2637768r768">search</a></tt> with
a non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> <tt>:from-end</tt> argument might actually search a list from left to right
instead of from right to left (but in either case would return the rightmost
matching subsequence, of course). Therefore it is a good idea for a user-supplied
predicate to be free of side eﬀects.
<div class="new">
                                                                          

                                                                          
<!--l. 1144--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx100-1238013"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
                                                                          

                                                                          
<!--l. 1150--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse82.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse80.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse80.html#tailclmse80.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse81.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="kseque.html#clmse81.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse81.html"></a>   </div> </div> 
</body></html> 
