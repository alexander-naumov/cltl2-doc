<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Random Numbers</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 3370--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse73.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse71.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse71.html#tailclmse71.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse72.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="number.html#clmse72.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">12.9   </span> <a 
href="clm.html#QQ2-89-1176" id="x89-114700012.9">Random Numbers</a></h3>
<!--l. 3373--><p class="noindent" >The Common Lisp facility for generating pseudo-random numbers has been
carefully deﬁned to make its use reasonably portable. While two implementations
may produce diﬀerent series of pseudo-random numbers, the distribution of values
should be relatively independent of such machine-dependent aspects as word
size.
<div class="defun">
<!--l. 3380--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx89-1147001"></a><a 
 id="x89-1147002r301"></a> <b>random</b>  <i>number</i> <b>&#x0026;optional</b>  <i>state</i>
</div>
<tt>
<!--l. 3383--><p class="indent" >   (random <i>n</i>)</tt> accepts a positive number <i>n</i> and returns a number of the same
kind between zero (inclusive) and <i>n</i> (exclusive). The number <i>n</i> may be an integer
or a ﬂoating-point number. An approximately uniform choice distribution is used.
If <i>n</i> is an integer, each of the possible results occurs with (approximate)
probability 1/<i>n</i>. (The qualiﬁer “approximate” is used because of implementation
considerations; in practice, the deviation from uniformity should be quite
small.)
<!--l. 3393--><p class="indent" >   The argument <i>state</i> must be an object of type <tt>random-state</tt>; it defaults to
the value of the variable <tt><a 
href="symbols.html#x185-2637040r40">*random-state*</a></tt>. This object is used to maintain the
state of the pseudo-random-number generator and is altered as a side eﬀect of the
<tt><a 
href="symbols.html#x185-2637708r708">random</a></tt> operation._________________________________________________________<div class="implementation">
<!--l. 3399--><p class="noindent" ><b>Implementation note:</b> In general, even if <tt><a 
href="symbols.html#x185-2637708r708">random</a></tt> of zero arguments were deﬁned as in
MacLisp, it is not adequate to deﬁne <tt>(random <i>n</i>)</tt> for integral <i>n</i> to be simply <tt>(mod
(random) <i>n</i>)</tt>; this fails to be uniformly distributed if <i>n</i> is larger than the largest number
produced by <tt><a 
href="symbols.html#x185-2637708r708">random</a></tt>, or even if <i>n</i> merely approaches this number. This is another reason
for omitting <tt><a 
href="symbols.html#x185-2637708r708">random</a></tt> of zero arguments in Common Lisp. Assuming that the underlying
mechanism produces “random bits” (possibly in chunks such as ﬁxnums), the best
approach is to produce enough random bits to construct an integer <i>k</i> some number
<i>d</i> of bits larger than <tt>(integer-length <i>n</i>)</tt> (see <tt><a 
href="symbols.html#x185-2637448r448">integer-length</a></tt>), and then
compute <tt>(mod <i>k</i> <i>n</i>)</tt>. The quantity <i>d</i> should be at least 7, and preferably 10 or
more.
                                                                          

                                                                          
<!--l. 3414--><p class="indent" >   To produce random ﬂoating-point numbers in the half-open range <span class="math">[<i>A</i>,<i>B</i>)</span>, accepted
practice (as determined by a look through the <i>Collected Algorithms from the ACM</i>,
particularly algorithms 133, 266, 294, and 370) is to compute <span class="math"><i>X</i> ⋅ (<i>B</i> −<i>A</i>) + <i>A</i></span>,
where <i>X</i> is a ﬂoating-point number uniformly distributed over <span class="math">[0.0,1.0)</span> and
computed by calculating a random integer <span class="math"><i>N</i></span> in the range <span class="math">[0,<i>M</i>)</span> (typically by a
multiplicative-congruential or linear-congruential method mod <span class="math"><i>M</i></span>) and then setting
<span class="math"><i>X</i> = <i>N</i>∕<i>M</i></span>. See also <span class="cite">[<a 
href="bib.html#XKNUTH-VOLUME-2">27</a>]</span>. If one takes <span class="math"><i>M</i> = 2<sup>f</sup></span>, where <span class="math"><i>f</i></span> is the length of the signiﬁcand of a
ﬂoating-point number (and it is in fact common to choose <span class="math"><i>M</i></span> to be a power of
2), then this method is equivalent to the following assembly-language-level
procedure. Assume the representation has no hidden bit. Take a ﬂoating-point 0.5,
and clobber its entire signiﬁcand with random bits. Normalize the result if
necessary.
<!--l. 3433--><p class="indent" >   For example, on the DEC PDP-10, assume that accumulator <tt>T</tt> is completely random
(all 36 bits are random). Then the code sequence <div class="lisp"><div class="tabbing">
LSH T,-9                 ;Clear high 9 bits; low 27 are random
   <br>                      FSC T,128.               ;Install exponent and normalize<br>
<!--l. 3438--><p class="noindent" ></div>
<!--l. 3438--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-114800012.9" id="x89-114800012.9"></a></span>
<!--l. 3438--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-114900012.9" id="x89-114900012.9"></a></span>
</div>
<!--l. 3439--><p class="indent" >   will produce in <tt>T</tt> a random ﬂoating-point number uniformly distributed over
<span class="math">[0.0,1.0)</span>. (Instead of the <tt>LSH</tt> instruction, one could do <div class="lisp"><div class="tabbing">
TLZ T,777000             ;That&#x2019;s 777000 octal
   <br>
<!--l. 3444--><p class="noindent" ></div>
<!--l. 3444--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115000012.9" id="x89-115000012.9"></a></span>
                                                                          

                                                                          
<!--l. 3444--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115100012.9" id="x89-115100012.9"></a></span>
</div>
<!--l. 3445--><p class="indent" >   but if the 36 random bits came from a congruential random-number generator, the
high-order bits tend to be “more random” than the low-order ones, and so the <tt>LSH</tt> would
be better for uniform distribution. Ideally all the bits would be the result of high-quality
randomness.)
<!--l. 3450--><p class="indent" >   With a hidden-bit representation, normalization is not a problem, but dealing with
the hidden bit is. The method can be adapted as follows. Take a ﬂoating-point 1.0 and
clobber the explicit signiﬁcand bits with random bits; this produces a random
ﬂoating-point number in the range <span class="math">[1.0,2.0)</span>. Then simply subtract 1.0. In eﬀect, we let
the hidden bit creep in and then subtract it away again.
<!--l. 3457--><p class="indent" >   For example, on the DEC VAX, assume that register <tt>T</tt> is completely random (but a
little less random than on the PDP-10, as it has only 32 random bits). Then the code
sequence <div class="lisp"><div class="tabbing">
INSV #̂X81,#7,#9,T     ;Install correct sign bit and exponent
   <br>                                                SUBF #̂F1.0,T          ;Subtract 1.0<br>
<!--l. 3463--><p class="noindent" ></div>
<!--l. 3463--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115200012.9" id="x89-115200012.9"></a></span>
<!--l. 3463--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115300012.9" id="x89-115300012.9"></a></span>
</div>
<!--l. 3464--><p class="indent" >   will produce in <tt>T</tt> a random ﬂoating-point number uniformly distributed over
<span class="math">[0.0,1.0)</span>. Again, if the low-order bits are not random enough, then the instruction
<div class="lisp"><div class="tabbing">
ROTL #7,T
   <br>
<!--l. 3469--><p class="noindent" ></div>
<!--l. 3469--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115400012.9" id="x89-115400012.9"></a></span>
                                                                          

                                                                          
<!--l. 3469--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115500012.9" id="x89-115500012.9"></a></span>
</div>
<!--l. 3470--><p class="indent" >   should be performed ﬁrst.
<!--l. 3472--><p class="indent" >   Implementors may wish to consult reference <span class="cite">[<a 
href="bib.html#XADDITIVE-RANDOMS">41</a>]</span> for a discussion of some eﬃcient
methods of generating pseudo-random numbers.
</div>
__________________________________________________________________________
</div>
<div class="defun">
<!--l. 3478--><p class="noindent" ><div class="defunheader"> <i>[Variable]</i><a 
 id="dx89-1155001"></a><a 
 id="x89-1155002r302"></a> <b>*random-state*</b>
</div>
<!--l. 3481--><p class="indent" >    This variable holds a data structure, an object of type <tt>random-state</tt>, that
encodes the internal state of the random-number generator that <tt><a 
href="symbols.html#x185-2637708r708">random</a></tt> uses by
default. The nature of this data structure is implementation-dependent. It may be
printed out and successfully read back in, but may or may not function correctly
as a random-number state object in another implementation. A call to <tt><a 
href="symbols.html#x185-2637708r708">random</a></tt> will
perform a side eﬀect on this data structure. Lambda-binding this variable to a
diﬀerent random-number state object will correctly save and restore the old state
object.
</div>
<div class="defun">
<!--l. 3493--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx89-1155003"></a><a 
 id="x89-1155004r303"></a> <b>make-random-state</b>  <b>&#x0026;optional</b>  <i>state</i>
</div>
<!--l. 3496--><p class="indent" >    This function returns a new object of type <tt>random-state</tt>, suitable for use as
the value of the variable <tt><a 
href="symbols.html#x185-2637040r40">*random-state*</a></tt>. If <i>state</i> is <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> or omitted,
<tt><a 
href="symbols.html#x185-2637547r547">make-random-state</a></tt> returns a <i>copy</i> of the current random-number state object
(the value of the variable <tt><a 
href="symbols.html#x185-2637040r40">*random-state*</a></tt>). If <i>state</i> is a state object, a copy of
that state object is returned. If <i>state</i> is <tt><a 
href="symbols.html#x185-2637871r871">t</a></tt>, then a new state object is returned that
has been “randomly” initialized by some means (such as by a time-of-day
clock).___________________________________________________________________________________________<div class="rationale">
<!--l. 3506--><p class="noindent" ><b>Rationale:</b> Common Lisp purposely provides no way to initialize a <tt>random-state</tt>
object from a user-speciﬁed “seed.” The reason for this is that the number of bits of state
information in a <tt>random-state</tt> object may vary widely from one implementation to
another, and there is no simple way to guarantee that any user-speciﬁed seed
value will be “random enough.” Instead, the initialization of <tt>random-state</tt>
objects is left to the implementor in the case where the argument <tt><a 
href="symbols.html#x185-2637871r871">t</a></tt> is given to
                                                                          

                                                                          
<tt><a 
href="symbols.html#x185-2637547r547">make-random-state</a></tt>.
<!--l. 3516--><p class="indent" >   To handle the common situation of executing the same program many times in a
reproducible manner, where that program uses <tt><a 
href="symbols.html#x185-2637708r708">random</a></tt>, the following procedure may be
used:
      <ol  class="enumerate1" >
      <li 
  class="enumerate" id="x89-1155006x1">Evaluate <tt>(make-random-state t)</tt> to create a <tt>random-state</tt> object.
      </li>
      <li 
  class="enumerate" id="x89-1155008x2">Write that object to a ﬁle, using <tt><a 
href="symbols.html#x185-2637690r690">print</a></tt>, for later use.
      </li>
      <li 
  class="enumerate" id="x89-1155010x3">Whenever the program is to be run, ﬁrst use <tt><a 
href="symbols.html#x185-2637717r717">read</a></tt> to create a copy of the
      <tt>random-state</tt> object from the printed representation in the ﬁle. Then use
      the <tt>random-state</tt> object newly created by the <tt><a 
href="symbols.html#x185-2637717r717">read</a></tt> operation to initialize
      the random-number generator for the program.</li></ol>
<!--l. 3533--><p class="noindent" >It is for the sake of this procedure for reproducible execution that implementations are
required to provide a read/print syntax for objects of type <tt>random-state</tt>.
<!--l. 3537--><p class="indent" >   It is also possible to make copies of a <tt>random-state</tt> object directly without going
through the print/read process, simply by using the <tt><a 
href="symbols.html#x185-2637547r547">make-random-state</a></tt> function to
copy the object; this allows the same sequence of random numbers to be generated many
times within a single program.
</div>__________________________________________________________________________<div class="implementation">
<!--l. 3544--><p class="noindent" ><b>Implementation note:</b> A recommended way to implement the type <tt>random-state</tt> is
eﬀectively to use the machinery for <tt><a 
href="symbols.html#x185-2637289r289">defstruct</a></tt>. The usual structure syntax may
then be used for printing <tt>random-state</tt> objects; one might look something like
<div class="lisp"><div class="tabbing">
#S(RANDOM-STATE DATA #(14 49 98436589 786345 8734658324 ...))
     <br>
<!--l. 3551--><p class="noindent" ></div>
<!--l. 3551--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115600012.9" id="x89-115600012.9"></a></span>
                                                                          

                                                                          
<!--l. 3551--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115700012.9" id="x89-115700012.9"></a></span>
</div>
<!--l. 3552--><p class="indent" >   where the components are of course completely implementation-dependent.
</div>
__________________________________________________________________________
</div>
<div class="defun">
<!--l. 3557--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx89-1157001"></a><a 
 id="x89-1157002r304"></a> <b>random-state-p</b>  <i>object</i>
</div>
<tt>
<!--l. 3560--><p class="indent" >    <a 
href="symbols.html#x185-2637709r709">random-state-p</a></tt> is true if its argument is a random-state object, and
otherwise is false. <div class="lisp"><div class="tabbing">
(random-state-p <i>x</i>) <span class="math"> ≡</span> (typep <i>x</i> &#x2019;random-state)
     <br>
<!--l. 3564--><p class="noindent" ></div>
<!--l. 3564--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115800012.9" id="x89-115800012.9"></a></span>
<!--l. 3564--><p class="noindent" ><span class="paragraphHead"><a 
href="#x89-115900012.9" id="x89-115900012.9"></a></span>
</div>
</div>
                                                                          

                                                                          
<!--l. 3567--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse73.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse71.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse71.html#tailclmse71.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse72.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="number.html#clmse72.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse72.html"></a>   </div> </div> 
</body></html> 
