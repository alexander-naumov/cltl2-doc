<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Structures of Explicitly Speciﬁed Representational Type</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 16:10:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 988--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="eval.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html#tailclmse105.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse106.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html#clmse106.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">19.7   </span> <a 
href="clm.html#QQ2-130-1561" id="x130-153100019.7">Structures of Explicitly Speciﬁed
Representational Type</a></h3>
<!--l. 991--><p class="noindent" >Sometimes it is important to have explicit control over the representation of a
structure. The <tt>:type</tt> option allows one to specify that a structure must be
implemented in a particular way, using a list or a speciﬁc kind of vector, and
to specify the exact allocation of structure slots to components of the
representation. A structure may also be “unnamed” or “named,” according to
whether the structure name is stored in (and thus recoverable from) the
structure.
<!--l. 1000--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">19.7.1   </span> <a 
href="frontmatter.html#QQ2-130-1562" id="x130-153200019.7.1">Unnamed Structures</a></h4>
<!--l. 1002--><p class="noindent" >Sometimes a particular data representation is imposed by external requirements,
and yet it is desirable to document the data format as a <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt>-style
structure. For example, consider expressions built up from numbers, symbols, and
binary operations such as <tt><a 
href="symbols.html#x187-2636051r51">+</a></tt> and <tt><a 
href="symbols.html#x187-2636002r2">*</a></tt>. An operation might be represented as it is in
Lisp, as a list of the operator and the two operands. This fact can be expressed
succinctly with <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> in this manner: е<div class="lisp"><div class="tabbing">
(defstruct (binop (:type list))
   <br>                      (operator &#x2019;? :type symbol)<br>                      operand-1<br>
  operand-2)<br>
<!--l. 1014--><p class="noindent" ></div>
<!--l. 1014--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-153300019.7.1" id="x130-153300019.7.1"></a></span>
                                                                          

                                                                          
<!--l. 1014--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-153400019.7.1" id="x130-153400019.7.1"></a></span>
</div>
<!--l. 1015--><p class="indent" >   This will deﬁne a constructor function <tt>make-binop</tt> and three selector
functions, namely <tt>binop-operator</tt>, <tt>binop-operand-1</tt>, and <tt>binop-operand-2</tt>.
(It will <i>not</i>, however, deﬁne a predicate <tt>binop-p</tt>, for reasons explained
below.)
<!--l. 1020--><p class="indent" >   The eﬀect of <tt>make-binop</tt> is simply to construct a list of length 3:
<div class="lisp"><div class="tabbing">
(make-binop :operator &#x2019;+ :operand-1 &#x2019;x :operand-2 5)
   <br>                                                                              <span class="math"> ⇒</span> (+ x 5)<br>
<br>                                    (make-binop :operand-2 4 :operator &#x2019;*)<br>
   <span class="math"> ⇒</span> (* <tt><a 
href="symbols.html#x187-2636609r609">nil</a></tt> 4)<br>
<!--l. 1027--><p class="noindent" ></div>
<!--l. 1027--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-153500019.7.1" id="x130-153500019.7.1"></a></span>
<!--l. 1027--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-153600019.7.1" id="x130-153600019.7.1"></a></span>
</div>
<!--l. 1028--><p class="indent" >   It is just like the function <tt><a 
href="symbols.html#x187-2636492r492">list</a></tt> except that it takes keyword arguments and
performs slot defaulting appropriate to the <tt>binop</tt> conceptual data type. Similarly,
the selector functions <tt>binop-operator</tt>, <tt>binop-operand-1</tt>, and <tt>binop-operand-2</tt>
are essentially equivalent to <tt><a 
href="symbols.html#x187-2636171r171">car</a></tt>, <tt><a 
href="symbols.html#x187-2636167r167">cadr</a></tt>, and <tt><a 
href="symbols.html#x187-2636166r166">caddr</a></tt>, respectively. (They might not
be completely equivalent because, for example, an implementation would be
justiﬁed in adding error-checking code to ensure that the argument to each
selector function is a length-3 list.)
<!--l. 1039--><p class="indent" >   We speak of <tt>binop</tt> as being a “conceptual” data type because <tt>binop</tt> is not
made a part of the Common Lisp type system. The predicate <tt><a 
href="symbols.html#x187-2636896r896">typep</a></tt> will not
recognize <tt>binop</tt> as a type speciﬁer, and <tt><a 
href="symbols.html#x187-2636894r894">type-of</a></tt> will return <tt><a 
href="symbols.html#x187-2636492r492">list</a></tt> when given a
<tt>binop</tt> structure. Indeed, there is no way to distinguish a data structure
constructed by <tt>make-binop</tt> from any other list that happens to have the correct
structure.
<!--l. 1046--><p class="indent" >   There is not even any way to recover the structure name <tt>binop</tt> from a
structure created by <tt>make-binop</tt>. This can be done, however, if the structure is
“named.”
                                                                          

                                                                          
<!--l. 1050--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">19.7.2   </span> <a 
href="frontmatter.html#QQ2-130-1567" id="x130-153700019.7.2">Named Structures</a></h4>
<!--l. 1052--><p class="noindent" >A “named” structure has the property that, given an instance of the structure, the
structure name (that names the type) can be reliably recovered. For structures
deﬁned with no <tt>:type</tt> option, the structure name actually becomes part of the
Common Lisp data-type system. The function <tt><a 
href="symbols.html#x187-2636894r894">type-of</a></tt>, when applied to such
a structure, will return the structure name as the type of the object;
the predicate <tt><a 
href="symbols.html#x187-2636896r896">typep</a></tt> will recognize the structure name as a valid type
speciﬁer.
<!--l. 1061--><p class="indent" >   For structures deﬁned with a <tt>:type</tt> option, <tt><a 
href="symbols.html#x187-2636894r894">type-of</a></tt> will return a type
speciﬁer such as <tt><a 
href="symbols.html#x187-2636492r492">list</a></tt> or <tt>(vector t)</tt>, depending on the type speciﬁed to the
<tt>:type</tt> option. The structure name does not become a valid type speciﬁer.
However, if the <tt>:named</tt> option is also speciﬁed, then the ﬁrst component
of the structure (as created by a <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> constructor function) will
always contain the structure name. This allows the structure name to
be recovered from an instance of the structure and allows a reasonable
predicate for the conceptual type to be deﬁned: the automatically deﬁned
<tt><i>name</i>-p</tt> predicate for the structure operates by ﬁrst checking that its
argument is of the proper type (<tt><a 
href="symbols.html#x187-2636492r492">list</a></tt>, <tt>(vector t)</tt>, or whatever) and
then checking whether the ﬁrst component contains the appropriate type
name.
<!--l. 1077--><p class="indent" >   Consider the <tt>binop</tt> example shown above, modiﬁed only to include the <tt>:named</tt>
option: <div class="lisp"><div class="tabbing">
(defstruct (binop (:type list) :named)
   <br>                      (operator &#x2019;? :type symbol)<br>                      operand-1<br>
  operand-2)<br>
<!--l. 1084--><p class="noindent" ></div>
<!--l. 1084--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-153800019.7.2" id="x130-153800019.7.2"></a></span>
                                                                          

                                                                          
<!--l. 1084--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-153900019.7.2" id="x130-153900019.7.2"></a></span>
</div>
<!--l. 1085--><p class="indent" >   As before, this will deﬁne a constructor function <tt>make-binop</tt> and three
selector functions <tt>binop-operator</tt>, <tt>binop-operand-1</tt>, and <tt>binop-operand-2</tt>. It
will also deﬁne a predicate <tt>binop-p</tt>.
<!--l. 1089--><p class="indent" >   The eﬀect of <tt>make-binop</tt> is now to construct a list of length 4: <div class="lisp"><div class="tabbing">
(make-binop :operator &#x2019;+ :operand-1 &#x2019;x :operand-2 5)
   <br>                                                                      <span class="math"> ⇒</span> (binop + x 5)<br>
<br>                                    (make-binop :operand-2 4 :operator &#x2019;*)<br>
   <span class="math"> ⇒</span> (binop * <tt><a 
href="symbols.html#x187-2636609r609">nil</a></tt> 4)<br>
<!--l. 1096--><p class="noindent" ></div>
<!--l. 1096--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-154000019.7.2" id="x130-154000019.7.2"></a></span>
<!--l. 1096--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-154100019.7.2" id="x130-154100019.7.2"></a></span>
</div>
<!--l. 1097--><p class="indent" >   The structure has the same layout as before except that the structure name
<tt>binop</tt> is included as the ﬁrst list element. The selector functions <tt>binop-operator</tt>,
<tt>binop-operand-1</tt>, and <tt>binop-operand-2</tt> are essentially equivalent to <tt><a 
href="symbols.html#x187-2636167r167">cadr</a></tt>,
<tt><a 
href="symbols.html#x187-2636166r166">caddr</a></tt>, and <tt><a 
href="symbols.html#x187-2636165r165">cadddr</a></tt>, respectively. The predicate <tt>binop-p</tt> is more or less equivalent
to the following deﬁnition. <div class="lisp"><div class="tabbing">
(defun binop-p (x)
   <br>                                               (and (consp x) (eq (car x) &#x2019;binop)))<br>
<!--l. 1108--><p class="noindent" ></div>
<!--l. 1108--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-154200019.7.2" id="x130-154200019.7.2"></a></span>
                                                                          

                                                                          
<!--l. 1108--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-154300019.7.2" id="x130-154300019.7.2"></a></span>
</div>
<!--l. 1109--><p class="indent" >   The name <tt>binop</tt> is still not a valid type speciﬁer recognizable to <tt><a 
href="symbols.html#x187-2636896r896">typep</a></tt>, but at
least there is a way of distinguishing <tt>binop</tt> structures from other similarly deﬁned
structures.
<!--l. 1113--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">19.7.3   </span> <a 
href="frontmatter.html#QQ2-130-1574" id="x130-154400019.7.3">Other Aspects of Explicitly Speciﬁed Structures</a></h4>
<!--l. 1116--><p class="noindent" >The <tt>:initial-offset</tt> option allows one to specify that slots be allocated
beginning at a representational element other than the ﬁrst. For example, the
form <div class="lisp"><div class="tabbing">
(defstruct (binop (:type list) (:initial-oﬀset 2))
   <br>                      (operator &#x2019;? :type symbol)<br>                      operand-1<br>
  operand-2)<br>
<!--l. 1124--><p class="noindent" ></div>
<!--l. 1124--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-154500019.7.3" id="x130-154500019.7.3"></a></span>
<!--l. 1124--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-154600019.7.3" id="x130-154600019.7.3"></a></span>
</div>
<!--l. 1125--><p class="indent" >   would result in the following behavior for <tt>make-binop</tt>: <div class="lisp"><div class="tabbing">
(make-binop :operator &#x2019;+ :operand-1 &#x2019;x :operand-2 5)
   <br>                                                                     <span class="math"> ⇒</span> (nil nil + x 5)<br>
<br>                                    (make-binop :operand-2 4 :operator &#x2019;*)<br>
   <span class="math"> ⇒</span> (nil nil * <tt><a 
href="symbols.html#x187-2636609r609">nil</a></tt> 4)<br>
<!--l. 1132--><p class="noindent" ></div>
<!--l. 1132--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-154700019.7.3" id="x130-154700019.7.3"></a></span>
                                                                          

                                                                          
<!--l. 1132--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-154800019.7.3" id="x130-154800019.7.3"></a></span>
</div>
<!--l. 1133--><p class="indent" >   The selectors <tt>binop-operator</tt>, <tt>binop-operand-1</tt>, and <tt>binop-operand-2</tt>
would be essentially equivalent to <tt><a 
href="symbols.html#x187-2636166r166">caddr</a></tt>, <tt><a 
href="symbols.html#x187-2636165r165">cadddr</a></tt>, and <tt><a 
href="symbols.html#x187-2636171r171">car</a></tt> of <tt><a 
href="symbols.html#x187-2636186r186">cddddr</a></tt>, respectively.
Similarly, the form <div class="lisp"><div class="tabbing">
(defstruct (binop (:type list) :named (:initial-oﬀset 2))
   <br>                      (operator &#x2019;? :type symbol)<br>                      operand-1<br>
  operand-2)<br>
<!--l. 1143--><p class="noindent" ></div>
<!--l. 1143--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-154900019.7.3" id="x130-154900019.7.3"></a></span>
<!--l. 1143--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-155000019.7.3" id="x130-155000019.7.3"></a></span>
</div>
<!--l. 1144--><p class="indent" >   would result in the following behavior for <tt>make-binop</tt>: <div class="lisp"><div class="tabbing">
(make-binop :operator &#x2019;+ :operand-1 &#x2019;x :operand-2 5)
   <br>                                                             <span class="math"> ⇒</span> (nil nil binop + x 5)<br>
<br>                                    (make-binop :operand-2 4 :operator &#x2019;*)<br>
   <span class="math"> ⇒</span> (nil nil binop * <tt><a 
href="symbols.html#x187-2636609r609">nil</a></tt> 4)<br>
<!--l. 1151--><p class="noindent" ></div>
<!--l. 1151--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-155100019.7.3" id="x130-155100019.7.3"></a></span>
<!--l. 1151--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-155200019.7.3" id="x130-155200019.7.3"></a></span>
</div>
<!--l. 1153--><p class="indent" >   If the <tt>:include</tt> is used with the <tt>:type</tt> option, then the eﬀect is ﬁrst to
skip over as many representation elements as needed to represent the
included structure, then to skip over any additional elements speciﬁed by the
<tt>:initial-offset</tt> option, and then to begin allocation of elements from that
point. For example: <div class="lisp"><div class="tabbing">
                                                                          

                                                                          
(defstruct (binop (:type list) :named (:initial-oﬀset 2))
   <br>                                                           (operator &#x2019;? :type symbol)<br>
  operand-1<br>                                                   operand-2)<br>
<br>                                    (defstruct (annotated-binop (:type list)<br>
                            (:initial-oﬀset 3)<br>
                            (:include binop))<br>
  commutative associative identity)<br>                                       <br>
(make-annotated-binop :operator &#x2019;*<br>                       :operand-1 &#x2019;x<br>
                      :operand-2 5<br>
                      :commutative t<br>
                      :associative t<br>
                      :identity 1)<br>
   <span class="math"> ⇒</span> (nil nil binop * x 5 nil nil nil t t 1)<br>
<!--l. 1177--><p class="noindent" ></div>
<!--l. 1177--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-155300019.7.3" id="x130-155300019.7.3"></a></span>
<!--l. 1177--><p class="noindent" ><span class="paragraphHead"><a 
href="#x130-155400019.7.3" id="x130-155400019.7.3"></a></span>
</div>
<!--l. 1178--><p class="indent" >   The ﬁrst two <tt><a 
href="symbols.html#x187-2636609r609">nil</a></tt> elements stem from the <tt>:initial-offset</tt> of <tt>2</tt> in the
deﬁnition of <tt>binop</tt>. The next four elements contain the structure name and three
slots for <tt>binop</tt>. The next three <tt><a 
href="symbols.html#x187-2636609r609">nil</a></tt> elements stem from the <tt>:initial-offset</tt> of <tt>3</tt>
in the deﬁnition of <tt>annotated-binop</tt>. The last three list elements contain the
additional slots for an <tt>annotated-binop</tt>.
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
<!--l. 8--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="eval.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html#tailclmse105.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse106.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html#clmse106.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse106.html"></a>   </div> </div> 
</body></html> 
