<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Establishing New Variable Bindings</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 2014--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse40.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html#tailclmse38.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse39.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="contrl.html#clmse39.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">7.5   </span> <a 
href="clm.html#QQ2-51-563" id="x51-5550007.5">Establishing New Variable
Bindings</a></h3>
<!--l. 2017--><p class="noindent" >During the invocation of a function represented by a lambda-expression (or a
closure of a lambda-expression, as produced by <tt><a 
href="symbols.html#x185-2637399r399">function</a></tt>), new bindings are
established for the variables that are the parameters of the lambda-expression.
These bindings initially have values determined by the parameter-binding protocol
discussed in section <a 
href="clmse29.html#x39-2420005.2.2">5.2.2<!--tex4ht:ref: LAMBDA-EXPRESSIONS-SECTION --></a>.
<!--l. 2025--><p class="indent" >   The following constructs may also be used to establish bindings of variables,
both ordinary and functional.
<div class="defspec">
<div class="defmacheader">
<!--l. 2029--><p class="indent" >   <div class="tabbing">
 <i>[Special operator]</i> <b>let</b> <a 
 id="dx51-555001"></a><a 
 id="x51-555002r79"></a> ({var | (var [value])}*) {declaration}* {form}*
   <br>
<!--l. 2030--><p class="noindent" ></div>
<!--l. 2030--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5560007.5" id="x51-5560007.5"></a></span>
</div>
<!--l. 2031--><p class="indent" >   A <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt> form can be used to execute a series of forms with speciﬁed variables
bound to speciﬁed values.
<!--l. 2034--><p class="indent" >   More precisely, the form <div class="lisp"><div class="tabbing">
(let ((<i>var1</i> <i>value1</i>)
   <br>                                  (<i>var2</i> <i>value2</i>)<br>                                  ...<br>
      (<i>varm</i> <i>valuem</i>))<br>                                       <i>declaration1</i><br>
  <i>declaration2</i><br>                                                          ...<br>
  <i>declarationp</i><br>                                                      <i>body1</i><br>
  <i>body2</i><br>                                                                ...<br>
  <i>bodyn</i>)<br>
                                                                          

                                                                          
<!--l. 2048--><p class="noindent" ></div>
<!--l. 2048--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5570007.5" id="x51-5570007.5"></a></span>
<!--l. 2048--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5580007.5" id="x51-5580007.5"></a></span>
</div>
<!--l. 2049--><p class="indent" >   ﬁrst evaluates the expressions <i>value1</i>, <i>value2</i>, and so on, in that order, saving
the resulting values. Then all of the variables <i>varj</i> are bound to the corresponding
values in parallel; each binding will be a lexical binding unless there is a <tt>special</tt>
declaration to the contrary. The expressions <i>bodyk</i> are then evaluated in order;
the values of all but the last are discarded (that is, the body of a <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt>
form is an implicit <tt><a 
href="symbols.html#x185-2637700r700">progn</a></tt>). The <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt> form returns what evaluating <i>bodyn</i>
produces (if the body is empty, which is fairly useless, <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt> returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> as its
value). The bindings of the variables have lexical scope and indeﬁnite
extent.
<!--l. 2061--><p class="indent" >   Instead of a list <tt>(<i>varj</i> <i>valuej</i>)</tt>, one may write simply <i>varj</i>. In this
case <i>varj</i> is initialized to <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. As a matter of style, it is recommended
that <i>varj</i> be written only when that variable will be stored into (such
as by <tt><a 
href="symbols.html#x185-2637779r779">setq</a></tt>) before its ﬁrst use. If it is important that the initial value
be <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> rather than some undeﬁned value, then it is clearer to write out
<tt>(<i>varj</i> <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>)</tt> if the initial value is intended to mean “false,” or <tt>(<i>varj</i> &#x2019;())</tt>
if the initial value is intended to be an empty list. Note that the code
<div class="lisp"><div class="tabbing">
(let (x)
   <br>                      (declare (integer x))<br>                      (setq x (gcd y z))<br>
  ...)<br>
<!--l. 2075--><p class="noindent" ></div>
<!--l. 2075--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5590007.5" id="x51-5590007.5"></a></span>
                                                                          

                                                                          
<!--l. 2075--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5600007.5" id="x51-5600007.5"></a></span>
</div>
<!--l. 2076--><p class="indent" >   is incorrect; although <tt>x</tt> is indeed set before it is used, and is set to a value of
the declared type <tt>integer</tt>, nevertheless <tt>x</tt> momentarily takes on the value <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> in
violation of the type declaration.
<!--l. 2081--><p class="indent" >   Declarations may appear at the beginning of the body of a <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt>. See
<tt><a 
href="symbols.html#x185-2637271r271">declare</a></tt>.
<!--l. 2084--><p class="indent" >   See also <tt><a 
href="symbols.html#x185-2637303r303">destructuring-bind</a></tt>.
</div>
<div class="defspec">
<div class="defmacheader">
<!--l. 2088--><p class="indent" >   <div class="tabbing">
 <i>[Special operator]</i> <b>let*</b> <a 
 id="dx51-560001"></a><a 
 id="x51-560002r80"></a> ({var | (var [value])}*) {declaration}* {form}*
   <br>
<!--l. 2089--><p class="noindent" ></div>
<!--l. 2089--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5610007.5" id="x51-5610007.5"></a></span>
</div>
<tt>
<!--l. 2090--><p class="indent" >   <a 
href="symbols.html#x185-2637489r489">let*</a></tt> is similar to <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt>, but the bindings of variables are performed
sequentially rather than in parallel. This allows the expression for the
value of a variable to refer to variables previously bound in the <tt><a 
href="symbols.html#x185-2637489r489">let*</a></tt>
form.
<!--l. 2095--><p class="indent" >   More precisely, the form <div class="lisp"><div class="tabbing">
(let* ((<i>var1</i> <i>value1</i>)
   <br>                                 (<i>var2</i> <i>value2</i>)<br>                                 ...<br>
       (<i>varm</i> <i>valuem</i>))<br>                                      <i>declaration1</i><br>
  <i>declaration2</i><br>                                                          ...<br>
  <i>declarationp</i><br>                                                      <i>body1</i><br>
  <i>body2</i><br>                                                                ...<br>
  <i>bodyn</i>)<br>
<!--l. 2109--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 2109--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5620007.5" id="x51-5620007.5"></a></span>
<!--l. 2109--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5630007.5" id="x51-5630007.5"></a></span>
</div>
<!--l. 2110--><p class="indent" >   ﬁrst evaluates the expression <i>value1</i>, then binds the variable <i>var1</i> to that
value; then it evaluates <i>value2</i> and binds <i>var2</i>; and so on. The expressions <i>bodyj</i>
are then evaluated in order; the values of all but the last are discarded (that is,
the body of a <tt><a 
href="symbols.html#x185-2637489r489">let*</a></tt> form is an implicit <tt><a 
href="symbols.html#x185-2637700r700">progn</a></tt>). The <tt><a 
href="symbols.html#x185-2637489r489">let*</a></tt> form returns the results
of evaluating <i>bodyn</i> (if the body is empty, which is fairly useless, <tt><a 
href="symbols.html#x185-2637489r489">let*</a></tt> returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>
as its value). The bindings of the variables have lexical scope and indeﬁnite
extent.
<!--l. 2120--><p class="indent" >   Instead of a list <tt>(<i>varj</i> <i>valuej</i>)</tt>, one may write simply <i>varj</i>. In this case <i>varj</i>
is initialized to <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. As a matter of style, it is recommended that <i>varj</i> be written
only when that variable will be stored into (such as by <tt><a 
href="symbols.html#x185-2637779r779">setq</a></tt>) before its ﬁrst use. If
it is important that the initial value be <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> rather than some undeﬁned value,
then it is clearer to write out <tt>(<i>varj</i> <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>)</tt> if the initial value is intended to mean
“false,” or <tt>(<i>varj</i> &#x2019;())</tt> if the initial value is intended to be an empty
list.
<!--l. 2130--><p class="indent" >   Declarations may appear at the beginning of the body of a <tt><a 
href="symbols.html#x185-2637489r489">let*</a></tt>. See
<tt><a 
href="symbols.html#x185-2637271r271">declare</a></tt>.
</div>
<div class="defspec">
<div class="defmacheader">
<!--l. 2135--><p class="indent" >   <div class="tabbing">
 <i>[Special operator]</i> <b>progv</b> <a 
 id="dx51-563001"></a><a 
 id="x51-563002r81"></a> symbols values {form}*
   <br>
<!--l. 2136--><p class="noindent" ></div>
<!--l. 2136--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5640007.5" id="x51-5640007.5"></a></span>
</div>
<tt>
<!--l. 2137--><p class="indent" >   <a 
href="symbols.html#x185-2637702r702">progv</a></tt> is a special operator that allows binding one or more dynamic
variables whose names may be determined at run time. The sequence of
forms (an implicit <tt><a 
href="symbols.html#x185-2637700r700">progn</a></tt>) is evaluated with the dynamic variables whose
                                                                          

                                                                          
names are in the list <i>symbols</i> bound to corresponding values from the list
<i>values</i>. (If too few values are supplied, the remaining symbols are bound
and then made to have no value; see <tt><a 
href="symbols.html#x185-2637555r555">makunbound</a></tt>. If too many values are
supplied, the excess values are ignored.) The results of the <tt><a 
href="symbols.html#x185-2637702r702">progv</a></tt> form
are those of the last <i>form</i>. The bindings of the dynamic variables are
undone on exit from the <tt><a 
href="symbols.html#x185-2637702r702">progv</a></tt> form. The lists of symbols and values
are computed quantities; this is what makes <tt><a 
href="symbols.html#x185-2637702r702">progv</a></tt> diﬀerent from, for
example, <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt>, where the variable names are stated explicitly in the program
text.
<tt>
<!--l. 2152--><p class="indent" >   <a 
href="symbols.html#x185-2637702r702">progv</a></tt> is particularly useful for writing interpreters for languages embedded in
Lisp; it provides a handle on the mechanism for binding dynamic variables.
</div>
<div class="defspec">
<div class="defmacheader">
<!--l. 2158--><p class="indent" >   <div class="tabbing">
 <i>[Special operator]</i> <b>ﬂet</b> <a 
 id="dx51-564001"></a><a 
 id="x51-564002r82"></a> ({(name lambda-list
   <br>                                       [[{declaration}* | doc-string]] {form}*)}*)<br>
   {declaration}* {form}*<br>
<!--l. 2160--><p class="noindent" ></div>
<!--l. 2160--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5650007.5" id="x51-5650007.5"></a></span>
</div>
<div class="defmacheader">
<!--l. 2160--><p class="indent" >   <div class="tabbing">
 <i>[Special operator]</i> <b>labels</b> <a 
 id="dx51-565001"></a><a 
 id="x51-565002r83"></a> ({(name lambda-list
   <br>                                       [[{declaration}* | doc-string]] {form}*)}*)<br>
   {declaration}* {form}*<br>
<!--l. 2163--><p class="noindent" ></div>
<!--l. 2163--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5660007.5" id="x51-5660007.5"></a></span>
</div>
<div class="defmacheader">
                                                                          

                                                                          
<!--l. 2163--><p class="indent" >   <div class="tabbing">
 <i>[Special operator]</i> <b>macrolet</b> <a 
 id="dx51-566001"></a><a 
 id="x51-566002r84"></a> ({(name varlist
   <br>                                       [[{declaration}* | doc-string]] {form}*)}*)<br>
   {declaration}* {form}*<br>
<!--l. 2167--><p class="noindent" ></div>
<!--l. 2167--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5670007.5" id="x51-5670007.5"></a></span>
</div>
<tt>
<!--l. 2168--><p class="indent" >   <a 
href="symbols.html#x185-2637379r379">flet</a></tt> may be used to deﬁne locally named functions. Within the body of the
<tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt> form, function names matching those deﬁned by the <tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt> refer to the locally
deﬁned functions rather than to the global function deﬁnitions of the same
name.
<!--l. 2173--><p class="indent" >   Any number of functions may be simultaneously deﬁned. Each deﬁnition is
similar in format to a <tt><a 
href="symbols.html#x185-2637291r291">defun</a></tt> form: ﬁrst a name, then a parameter list (which may
contain <tt>&#x0026;optional</tt>, <tt>&#x0026;rest</tt>, or <tt>&#x0026;key</tt> parameters), then optional declarations and
documentation string, and ﬁnally a body. <div class="lisp"><div class="tabbing">
(ﬂet ((safesqrt (x) (sqrt (abs x))))
   <br>                                   ;; The safesqrt function is used in two places.<br>
  (safesqrt (apply #&#x2019;+ (map &#x2019;list #&#x2019;safesqrt longlist))))<br>
<!--l. 2182--><p class="noindent" ></div>
<!--l. 2182--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5680007.5" id="x51-5680007.5"></a></span>
<!--l. 2182--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5690007.5" id="x51-5690007.5"></a></span>
</div>
<!--l. 2184--><p class="indent" >   The <tt><a 
href="symbols.html#x185-2637461r461">labels</a></tt> construct is identical in form to the <tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt> construct. These
constructs diﬀer in that the scope of the deﬁned function names for <tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt>
encompasses only the body, whereas for <tt><a 
href="symbols.html#x185-2637461r461">labels</a></tt> it encompasses the function
deﬁnitions themselves. That is, <tt><a 
href="symbols.html#x185-2637461r461">labels</a></tt> can be used to deﬁne mutually recursive
functions, but <tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt> cannot. This distinction is useful. Using <tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt> one can locally
                                                                          

                                                                          
redeﬁne a global function name, and the new deﬁnition can refer to the global
deﬁnition; the same construction using <tt><a 
href="symbols.html#x185-2637461r461">labels</a></tt> would not have that eﬀect.
<div class="lisp"><div class="tabbing">
(defun integer-power (n k)       ;A highly &#x0022;bummed&#x0022; integer
   <br>                    (declare (integer n))          ; exponentiation routine<br>
  (declare (type (integer 0 *) k))<br>                    (labels ((expt0 (x k a)<br>
             (declare (integer x a) (type (integer 0 *) k))<br>
             (cond ((zerop k) a)<br>
                   ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))<br>
                   (t (expt0 (* x x) (ﬂoor k 2) (* x a)))))<br>
           (expt1 (x k a)<br>
             (declare (integer x a) (type (integer 1 *) k))<br>
             (cond ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))<br>
                   (t (expt0 (* x x) (ﬂoor k 2) (* x a))))))<br>
    (expt0 n k 1)))<br>
<!--l. 2207--><p class="noindent" ></div>
<!--l. 2207--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5700007.5" id="x51-5700007.5"></a></span>
<!--l. 2207--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5710007.5" id="x51-5710007.5"></a></span>
</div>
<tt>
<!--l. 2209--><p class="indent" >   <a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> is similar in form to <tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt> but deﬁnes local macros, using the same
format used by <tt><a 
href="symbols.html#x185-2637284r284">defmacro</a></tt>. The names established by <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> as names for
macros are lexically scoped.
<div class="new">
<!--l. 2215--><p class="indent" >   I have observed that, while most Common Lisp users pronounce <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> to
rhyme with “silhouette,” a small but vocal minority pronounce it to rhyme with
“Chevrolet.” A very few extremists furthermore adjust their pronunciation of <tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt>
similarly: they say “ﬂay.” Hey, hey! <i>Tr`es outr´e.</i>
</div>
<!--l. 2223--><p class="indent" >   Macros often must be expanded at “compile time” (more generally, at a time
before the program itself is executed), and so the run-time values of variables are
not available to macros deﬁned by <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt>.
                                                                          

                                                                          
<div class="newer">
<!--l. 2229--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx51-571001"></a>to retract the previous sentence and specify that
the macro-expansion functions created by <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> are deﬁned in the lexical
environment in which the <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> form appears, not in the null lexical
environment. Declarations, <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> deﬁnitions, and <tt><a 
href="symbols.html#x185-2637864r864">symbol-macrolet</a></tt>
deﬁnitions aﬀect code within the expansion functions in a <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt>, but the
consequences are undeﬁned if such code attempts to refer to any local variable or
function bindings that are visible in that lexical environment.
</div>
<!--l. 2240--><p class="indent" >   However, lexically scoped entities <i>are</i> visible within the body of the <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt>
form and <i>are</i> visible to the code that is the expansion of a macro call. The
following example should make this clear: <div class="lisp"><div class="tabbing">
;;; Example of scoping in macrolet.
   <br>                                                                                               <br>
(defun foo (x ﬂag)<br>                                   (macrolet ((fudge (z)<br>
                ;;The parameters <tt>x</tt> and <tt>flag</tt> are not accessible<br>
                ;; at this point; a reference to <tt>flag</tt> would be to<br>
                ;; the global variable of that name.<br>
                ‘(if ﬂag<br>
                     (* ,z ,z)<br>                                  ,z)))<br>
    ;;The parameters <tt>x</tt> and <tt>flag</tt> are accessible here.<br>                 (+ x<br>
       (fudge x)<br>                                      (fudge (+ x 1)))))<br>
<!--l. 2260--><p class="noindent" ></div>
<!--l. 2260--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5720007.5" id="x51-5720007.5"></a></span>
<!--l. 2260--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5730007.5" id="x51-5730007.5"></a></span>
</div>
<!--l. 2261--><p class="indent" >   The body of the <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> becomes <div class="lisp"><div class="tabbing">
(+ x
                                                                          

                                                                          
   <br>                                                                                     (if ﬂag<br>
       (* x x)<br>                                                       x))<br>
   (if ﬂag<br>                                            (* (+ x 1) (+ x 1))<br>
       (+ x 1)))<br>
<!--l. 2270--><p class="noindent" ></div>
<!--l. 2270--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5740007.5" id="x51-5740007.5"></a></span>
<!--l. 2270--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5750007.5" id="x51-5750007.5"></a></span>
</div>
<!--l. 2271--><p class="indent" >   after macro expansion. The occurrences of <tt>x</tt> and <tt>flag</tt> legitimately refer to the
parameters of the function <tt>foo</tt> because those parameters are visible at the site of
the macro call which produced the expansion.
<!--l. 2275--><p class="indent" >   The body of each function or expander function deﬁned by <tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt>, <tt><a 
href="symbols.html#x185-2637461r461">labels</a></tt>, or
<tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> is implicitly enclosed in a <tt><a 
href="symbols.html#x185-2637128r128">block</a></tt> construct whose name is the same as
the <i>name</i> of the function. Therefore <tt><a 
href="symbols.html#x185-2637752r752">return-from</a></tt> may be used to exit from the
function.
<tt>
<!--l. 2281--><p class="indent" >   <a 
href="symbols.html#x185-2637379r379">flet</a></tt> and <tt><a 
href="symbols.html#x185-2637461r461">labels</a></tt> accept any function-name (a symbol or a list whose <i>car</i> is
<tt><a 
href="symbols.html#x185-2637778r778">setf</a></tt>—see section <a 
href="clmse35.html#x47-4030007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>) as a <i>name</i> for a function to be locally deﬁned. In this way
one can create local deﬁnitions for <tt><a 
href="symbols.html#x185-2637778r778">setf</a></tt> expansion functions. (X3J13 explicitly
declined to extend <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> in the same manner.)
<div class="new">
<!--l. 2289--><p class="indent" >   X3J13 voted in March 1988 <a 
 id="dx51-575001"></a>to change <tt><a 
href="symbols.html#x185-2637379r379">flet</a></tt>, <tt><a 
href="symbols.html#x185-2637461r461">labels</a></tt>, and <tt><a 
href="symbols.html#x185-2637532r532">macrolet</a></tt> to allow
declarations to appear before the body. The new descriptions are therefore as
follows:
</div>
</div>
<div class="defspec">
<div class="defmacheader">
<!--l. 2298--><p class="indent" >   <div class="tabbing">
 <i>[Special operator]</i> <b>symbol-macrolet</b> <a 
 id="dx51-575002"></a><a 
 id="x51-575003r85"></a> ({(var expansion)}*)
   <br>                                                               {declaration}* {form}*<br>
                                                                          

                                                                          
<!--l. 2300--><p class="noindent" ></div>
<!--l. 2300--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5760007.5" id="x51-5760007.5"></a></span>
</div>
<!--l. 2301--><p class="indent" >   X3J13 voted in June 1988 <a 
 id="dx51-576001"></a>to adopt the Common Lisp Object System. Part of
this proposal is a general mechanism, <tt><a 
href="symbols.html#x185-2637864r864">symbol-macrolet</a></tt>, for treating certain
variable names as if they were parameterless macro calls. This facility may be
useful independent of CLOS. X3J13 voted in March 1989 <a 
 id="dx51-576002"></a>to modify the deﬁnition
of <tt><a 
href="symbols.html#x185-2637864r864">symbol-macrolet</a></tt> substantially and also voted <a 
 id="dx51-576003"></a>to allow declarations before the
body of <tt><a 
href="symbols.html#x185-2637864r864">symbol-macrolet</a></tt> but with peculiar treatment of <tt>special</tt> and type
declarations.
<!--l. 2315--><p class="indent" >   The <i>forms</i> are executed as an implicit <tt><a 
href="symbols.html#x185-2637700r700">progn</a></tt> in a lexical environment that
causes every reference to any deﬁned <i>var</i> to be replaced by the corresponding
<i>expansion</i>. It is as if the reference to the <i>var</i> were a parameterless macro call; the
<i>expansion</i> is evaluated or otherwise processed in place of the reference (in
                                                                          

                                                                          
particular, the expansion form is itself subject to further expansion—this is one of
the changes <a 
 id="dx51-576004"></a>from the original deﬁnition in the CLOS proposal). Note,
however, that the names of such symbol macros occupy the name space
of variables, not the name space of functions; just as one may have a
function (or macro, or special operator) and a variable with the same name
without interference, so one may have an ordinary macro (or function, or
special operator) and a symbol macro with the same name. The use of
<tt><a 
href="symbols.html#x185-2637864r864">symbol-macrolet</a></tt> can therefore be shadowed by <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt> or other constructs that bind
variables; <tt><a 
href="symbols.html#x185-2637864r864">symbol-macrolet</a></tt> does not substitute for all occurrences of a <i>var</i>
as a variable but only for those occurrences that would be construed as
references in the scope of a lexical binding of <i>var</i> as a variable. For example:
<div class="lisp"><div class="tabbing">
(symbol-macrolet ((pollyanna &#x2019;goody))
   <br>                   (list pollyanna (let ((pollyanna &#x2019;two-shoes)) pollyanna)))<br>
 <span class="math"> ⇒</span> (goody two-shoes), <i>not</i> (goody goody)<br>
<!--l. 2343--><p class="noindent" ></div>
<!--l. 2343--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5770007.5" id="x51-5770007.5"></a></span>
<!--l. 2343--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5780007.5" id="x51-5780007.5"></a></span>
</div>
<!--l. 2345--><p class="indent" >   One might think that <tt>&#x2019;goody</tt> simply replaces all occurrences of <tt>pollyanna</tt>,
and so the value of the <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt> would be <tt>goody</tt>; but this is not so. A little reﬂection
shows that under this incorrect interpretation the body in expanded form would
be <div class="lisp"><div class="tabbing">
(list &#x2019;goody (let ((&#x2019;goody &#x2019;two-shoes)) &#x2019;goody))
   <br>
<!--l. 2351--><p class="noindent" ></div>
<!--l. 2351--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5790007.5" id="x51-5790007.5"></a></span>
                                                                          

                                                                          
<!--l. 2351--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5800007.5" id="x51-5800007.5"></a></span>
</div>
<!--l. 2352--><p class="indent" >   which is syntactically malformed. The correct expanded form is <div class="lisp"><div class="tabbing">
(list &#x2019;goody (let ((pollyanna &#x2019;two-shoes)) pollyanna))
   <br>
<!--l. 2355--><p class="noindent" ></div>
<!--l. 2355--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5810007.5" id="x51-5810007.5"></a></span>
<!--l. 2355--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5820007.5" id="x51-5820007.5"></a></span>
</div>
<!--l. 2356--><p class="indent" >   because the rebinding of <tt>pollyanna</tt> by the <tt><a 
href="symbols.html#x185-2637488r488">let</a></tt> form shadows the symbol
macro deﬁnition.
<!--l. 2359--><p class="indent" >   The <i>expansion</i> for each <i>var</i> is not evaluated at binding time but only after it
has replaced a reference to the <i>var</i>. The <tt><a 
href="symbols.html#x185-2637778r778">setf</a></tt> macro allows a symbol macro to be
used as a <i>place</i>, in which case its expansion is used; moreover, <tt><a 
href="symbols.html#x185-2637779r779">setq</a></tt> of
a variable that is really a symbol macro will be treated as if <tt><a 
href="symbols.html#x185-2637778r778">setf</a></tt> had
been used. The values of the last form are returned, or <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> if there is no
value.
<!--l. 2367--><p class="indent" >   See <tt><a 
href="symbols.html#x185-2637530r530">macroexpand</a></tt> and <tt><a 
href="symbols.html#x185-2637531r531">macroexpand-1</a></tt>; they will expand symbol macros as well
as ordinary macros.
<!--l. 2370--><p class="indent" >   Certain <i>declarations</i> before the body are handled in a peculiar manner; see
section <a 
href="clmse51.html#x65-7910009.1">9.1<!--tex4ht:ref: DECLARE-SYNTAX-SECTION --></a>.
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 2377--><p class="indent" >   <div class="tabbing">
 <i>[Macro]</i> <b>deﬁne-symbol-macro</b> <a 
 id="dx51-582001"></a><a 
 id="x51-582002r86"></a> symbol {form}
   <br>
<!--l. 2378--><p class="noindent" ></div>
<!--l. 2378--><p class="noindent" ><span class="paragraphHead"><a 
href="#x51-5830007.5" id="x51-5830007.5"></a></span>
                                                                          

                                                                          
</div>
<!--l. 2379--><p class="indent" >   The <i>symbol</i> will act as a macro call. A single form constitutes the body of the
expansion. The <i>symbol</i> cannot already be a special variable.
</div>
                                                                          

                                                                          
<!--l. 2383--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse40.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html#tailclmse38.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse39.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="contrl.html#clmse39.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse39.html"></a>   </div> </div> 
</body></html> 
