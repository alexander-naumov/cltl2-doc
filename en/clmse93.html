<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Array Information</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 355--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse94.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse92.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse92.html#tailclmse92.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse93.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="array.html#clmse93.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">17.3   </span> <a 
href="clm.html#QQ2-115-1439" id="x115-140900017.3">Array Information</a></h3>
<!--l. 357--><p class="noindent" >The following functions extract from an array interesting information other than
the elements.
<div class="defun">
<!--l. 360--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1409001"></a><a 
 id="x115-1409002r531"></a> <b>array-element-type</b>  <i>array</i>
</div>
<tt>
<!--l. 363--><p class="indent" >   <a 
href="symbols.html#x185-2637094r94">array-element-type</a></tt> returns a type speciﬁer for the set of objects that can be
stored in the <i>array</i>. This set may be larger than the set requested when the array
was created; for example, the result of <div class="lisp"><div class="tabbing">
(array-element-type (make-array 5 :element-type &#x2019;(mod 5)))
   <br>
<!--l. 369--><p class="noindent" ></div>
<!--l. 369--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141000017.3" id="x115-141000017.3"></a></span>
<!--l. 369--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141100017.3" id="x115-141100017.3"></a></span>
</div>
<!--l. 370--><p class="indent" >   could be <tt>(mod 5)</tt>, <tt>(mod 8)</tt>, <tt>fixnum</tt>, <tt><a 
href="symbols.html#x185-2637871r871">t</a></tt>, or any other type of which <tt>(mod 5)</tt> is
a subtype. See <tt><a 
href="symbols.html#x185-2637858r858">subtypep</a></tt>.
</div>
<div class="defun">
<!--l. 374--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1411001"></a><a 
 id="x115-1411002r532"></a> <b>array-rank</b>  <i>array</i>
</div>
<!--l. 377--><p class="indent" >   This returns the number of dimensions (axes) of <i>array</i>. This will be a
                                                                          

                                                                          
non-negative integer. See <tt><a 
href="symbols.html#x185-2637098r98">array-rank-limit</a></tt>.
</div>
<div class="defun">
<!--l. 382--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1411003"></a><a 
 id="x115-1411004r533"></a> <b>array-dimension</b>  <i>array</i> <i>axis-number</i>
</div>
<!--l. 385--><p class="indent" >   The length of dimension number <i>axis-number</i> of the <i>array</i> is returned. <i>array</i>
may be any kind of array, and <i>axis-number</i> should be a non-negative integer
less than the rank of <i>array</i>. If the <i>array</i> is a vector with a ﬁll pointer,
<tt><a 
href="symbols.html#x185-2637090r90">array-dimension</a></tt> returns the total size of the vector, including inactive elements,
not the size indicated by the ﬁll pointer. (The function <tt><a 
href="symbols.html#x185-2637487r487">length</a></tt> will return the size
indicated by the ﬁll pointer.)
</div>
<div class="defun">
<!--l. 396--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1411005"></a><a 
 id="x115-1411006r534"></a> <b>array-dimensions</b>  <i>array</i>
</div>
<tt>
<!--l. 399--><p class="indent" >   <a 
href="symbols.html#x185-2637092r92">array-dimensions</a></tt> returns a list whose elements are the dimensions of
<i>array</i>.
</div>
<div class="defun">
<!--l. 403--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1411007"></a><a 
 id="x115-1411008r535"></a> <b>array-total-size</b>  <i>array</i>
</div>
<tt>
<!--l. 406--><p class="indent" >   <a 
href="symbols.html#x185-2637100r100">array-total-size</a></tt> returns the total number of elements in the <i>array</i>,
calculated as the product of all the dimensions. <div class="lisp"><div class="tabbing">
(array-total-size <i>x</i>)
   <br>                                             <span class="math"> ≡</span> (apply #&#x2019;* (array-dimensions <i>x</i>))<br>
   <span class="math"> ≡</span> (reduce #&#x2019;* (array-dimensions <i>x</i>))<br>
<!--l. 412--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 412--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141200017.3" id="x115-141200017.3"></a></span>
<!--l. 412--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141300017.3" id="x115-141300017.3"></a></span>
</div>
<!--l. 413--><p class="indent" >   Note that the total size of a zero-dimensional array is <tt>1</tt>. The total
size of a one-dimensional array is calculated without regard for any ﬁll
pointer.
</div>
<div class="defun">
<!--l. 418--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1413001"></a><a 
 id="x115-1413002r536"></a> <b>array-in-bounds-p</b>  <i>array</i> <b>&#x0026;rest</b>  <i>subscripts</i>
</div>
<!--l. 421--><p class="indent" >   This predicate checks whether the <i>subscripts</i> are all legal subscripts for
<i>array</i>. The predicate is true if they are all legal; otherwise it is false.
The <i>subscripts</i> must be integers. The number of <i>subscripts</i> supplied must
equal the rank of the array. Like <tt><a 
href="symbols.html#x185-2637085r85">aref</a></tt>, <tt><a 
href="symbols.html#x185-2637096r96">array-in-bounds-p</a></tt> ignores ﬁll
pointers.
</div>
<div class="defun">
<!--l. 428--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1413003"></a><a 
 id="x115-1413004r537"></a> <b>array-row-major-index</b>  <i>array</i> <b>&#x0026;rest</b>  <i>subscripts</i>
</div>
<!--l. 431--><p class="indent" >   This function takes an array and valid subscripts for the array and returns a
single non-negative integer less than the total size of the array that identiﬁes the
accessed element in the row-major ordering of the elements. The number of
<i>subscripts</i> supplied must equal the rank of the array. Each subscript must be a
non-negative integer less than the corresponding array dimension. Like <tt><a 
href="symbols.html#x185-2637085r85">aref</a></tt>,
<tt><a 
href="symbols.html#x185-2637099r99">array-row-major-index</a></tt> ignores ﬁll pointers.
<!--l. 440--><p class="indent" >   A possible deﬁnition of <tt><a 
href="symbols.html#x185-2637099r99">array-row-major-index</a></tt>, with no error checking,
would be <div class="lisp"><div class="tabbing">
(defun array-row-major-index (a <tt>&#x0026;rest</tt> subscripts)
                                                                          

                                                                          
   <br>                                            (apply #&#x2019;+ (maplist #&#x2019;(lambda (x y)<br>
                          (* (car x) (apply #&#x2019;* (cdr y))))<br>
                      subscripts<br>
                      (array-dimensions a))))<br>
<!--l. 448--><p class="noindent" ></div>
<!--l. 448--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141400017.3" id="x115-141400017.3"></a></span>
<!--l. 448--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141500017.3" id="x115-141500017.3"></a></span>
</div>
<!--l. 449--><p class="indent" >   For a one-dimensional array, the result of <tt><a 
href="symbols.html#x185-2637099r99">array-row-major-index</a></tt> always
equals the supplied subscript.
</div>
<div class="defun">
<!--l. 453--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1415001"></a><a 
 id="x115-1415002r538"></a> <b>row-major-aref</b>  <i>array</i> <i>index</i>
</div>
<!--l. 456--><p class="indent" >   This allows any array element to be accessed as if the containing array were
one-dimensional. The <i>index</i> must be a non-negative integer less than the total size
of the <i>array</i>. It indexes into the array as if its elements were arranged
one-dimensionally in row-major order. It may be understood in terms of <tt><a 
href="symbols.html#x185-2637085r85">aref</a></tt> as
follows: <div class="lisp"><div class="tabbing">
(row-major-aref <i>array</i> <i>index</i>) <span class="math"> ≡</span>
   <br>                  (aref (make-array (array-total-size array))<br>
                    :displaced-to array<br>
                    :element-type (array-element-type array))<br>
        index)<br>
<!--l. 467--><p class="noindent" ></div>
<!--l. 467--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141600017.3" id="x115-141600017.3"></a></span>
                                                                          

                                                                          
<!--l. 467--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141700017.3" id="x115-141700017.3"></a></span>
</div>
<!--l. 468--><p class="indent" >   In other words, one may treat an array as one-dimensional by creating a new
one-dimensional array that is displaced to the old one and then accessing the new
array. Alternatively, <tt><a 
href="symbols.html#x185-2637085r85">aref</a></tt> may be understood in terms of <tt><a 
href="symbols.html#x185-2637758r758">row-major-aref</a></tt>:
<div class="lisp"><div class="tabbing">
(aref <i>array</i> <span class="math"><i>i</i><sub>0</sub></span> <span class="math"><i>i</i><sub>1</sub></span> ... <span class="math"><i>i</i><sub>n−1</sub></span>) <span class="math"> ≡</span>
   <br>                             (row-major-aref array<br>
                  (array-row-major-index array <span class="math"><i>i</i><sub>0</sub></span> <span class="math"><i>i</i><sub>1</sub></span> ... <span class="math"><i>i</i><sub>n−1</sub></span>)<br>
<!--l. 476--><p class="noindent" ></div>
<!--l. 476--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141800017.3" id="x115-141800017.3"></a></span>
<!--l. 476--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-141900017.3" id="x115-141900017.3"></a></span>
</div>
<!--l. 477--><p class="indent" >   That is, a multidimensional array access is equivalent to a row-major access
using an equivalent row-major index.
<!--l. 480--><p class="indent" >   Like <tt><a 
href="symbols.html#x185-2637085r85">aref</a></tt>, <tt><a 
href="symbols.html#x185-2637758r758">row-major-aref</a></tt> completely ignores ﬁll pointers. A call to
<tt>row-major-setf</tt> is suitable for use as a <i>place</i> for <tt><a 
href="symbols.html#x185-2637778r778">setf</a></tt>.
<!--l. 484--><p class="indent" >   This operation makes it easier to write code that eﬃciently processes arrays of
any rank. Suppose, for example, that one wishes to set every element of an array
<tt>tennis-scores</tt> to zero. One might write <div class="lisp"><div class="tabbing">
(ﬁll (make-array (array-total-size tennis-scores)
   <br>                     :element-type (array-element-type tennis-scores)<br>
                  :displaced-to tennis-scores)<br>                        0)<br>
<!--l. 492--><p class="noindent" ></div>
<!--l. 492--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-142000017.3" id="x115-142000017.3"></a></span>
                                                                          

                                                                          
<!--l. 492--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-142100017.3" id="x115-142100017.3"></a></span>
</div>
<!--l. 493--><p class="indent" >   Unfortunately, this incurs the overhead of creating a displaced array, and <tt><a 
href="symbols.html#x185-2637365r365">fill</a></tt>
cannot be applied to multidimensional arrays. Another approach would be to
handle each possible rank separately: <div class="lisp"><div class="tabbing">
(ecase (array-rank tennis-scores)
   <br>                                                      (0 (setf (aref tennis-scores) 0))<br>
  (1 (dotimes (i0 (array-dimension tennis-scores 0))<br>
       (setf (aref tennis-scores i0) 0)))<br>  (2 (dotimes (i0 (array-dimension tennis-scores 0))<br>
       (dotimes (i1 (array-dimension tennis-scores 1))<br>
         (setf (aref tennis-scores i0 i1) 0))))<br>                            ...<br>
  (7 (dotimes (i0 (array-dimension tennis-scores 0))<br>
       (dotimes (i1 (array-dimension tennis-scores 1))<br>
         (dotimes (i2 (array-dimension tennis-scores 1))<br>
           (dotimes (i3 (array-dimension tennis-scores 1))<br>
             (dotimes (i4 (array-dimension tennis-scores 1))<br>
               (dotimes (i5 (array-dimension tennis-scores 1))<br>
                 (dotimes (i6 (array-dimension tennis-scores 1))<br>
                   (setf (aref tennis-scores i0 i1 i2 i3 i4 i5 i6)<br>
                         0)))))))))<br>                                   )<br>
<!--l. 515--><p class="noindent" ></div>
<!--l. 515--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-142200017.3" id="x115-142200017.3"></a></span>
<!--l. 515--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-142300017.3" id="x115-142300017.3"></a></span>
</div>
<!--l. 516--><p class="indent" >   It is easy to get tired of writing such code. Furthermore, this approach is
undesirable because some implementations of Common Lisp will in fact correctly
support arrays of rank greater than 7 (though no implementation is required to do
so). A recursively nested loop does the job, but it is still pretty hairy:
<div class="lisp"><div class="tabbing">
                                                                          

                                                                          
(labels
   <br>                                                     ((grok-any-rank (&#x0026;rest indices)<br>
     (let ((d (- (array-rank tennis-scores) (length indices)))<br>
       (if (= d 0)<br>              (setf (apply #&#x2019;row-major-aref indices) 0)<br>
           (dotimes (i (array-dimension tennis-scores (- d 1)))<br>
             (apply #&#x2019;grok-any-rank i indices))))))<br>     (grok-any-rank))<br>
<!--l. 530--><p class="noindent" ></div>
<!--l. 530--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-142400017.3" id="x115-142400017.3"></a></span>
<!--l. 530--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-142500017.3" id="x115-142500017.3"></a></span>
</div>
<!--l. 531--><p class="indent" >   Whether this code is particularly eﬃcient depends on many implementation
parameters, such as how <tt>&#x0026;rest</tt> arguments are handled and how cleverly calls
to <tt><a 
href="symbols.html#x185-2637081r81">apply</a></tt> are compiled. How much easier it is to use <tt><a 
href="symbols.html#x185-2637758r758">row-major-aref</a></tt>!
<div class="lisp"><div class="tabbing">
(dotimes (i (array-total-size tennis-scores))
   <br>                                         (setf (row-major-aref tennis-scores i) 0))<br>
<!--l. 538--><p class="noindent" ></div>
<!--l. 538--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-142600017.3" id="x115-142600017.3"></a></span>
<!--l. 538--><p class="noindent" ><span class="paragraphHead"><a 
href="#x115-142700017.3" id="x115-142700017.3"></a></span>
</div>
<!--l. 539--><p class="indent" >   Surely this code is sweeter than the honeycomb.
</div>
<div class="defun">
<!--l. 542--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1427001"></a><a 
 id="x115-1427002r539"></a> <b>adjustable-array-p</b>  <i>array</i>
</div>
<!--l. 545--><p class="indent" >   This predicate is true if the argument (which must be an array) is adjustable,
and otherwise is false.
                                                                          

                                                                          
<div class="newer">
<!--l. 549--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx115-1427003"></a>to clarify that <tt><a 
href="symbols.html#x185-2637074r74">adjustable-array-p</a></tt> is true of
an array if and only if <tt><a 
href="symbols.html#x185-2637073r73">adjust-array</a></tt>, when applied to that array, will
return the same array, that is, an array <tt><a 
href="symbols.html#x185-2637337r337">eq</a></tt> to the original array. If the
<tt>:adjustable</tt> argument to <tt><a 
href="symbols.html#x185-2637533r533">make-array</a></tt> is non-<tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> when an array is created, then
<tt><a 
href="symbols.html#x185-2637074r74">adjustable-array-p</a></tt> must be true of that array. If an array is created with the
<tt>:adjustable</tt> argument <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> (or omitted), then <tt><a 
href="symbols.html#x185-2637074r74">adjustable-array-p</a></tt> may
be true or false of that array, depending on the implementation. X3J13
further voted to <i>deﬁne</i> the terminology “adjustable array” to mean precisely
“an array of which <tt><a 
href="symbols.html#x185-2637074r74">adjustable-array-p</a></tt> is true.” See <tt><a 
href="symbols.html#x185-2637533r533">make-array</a></tt> and
<tt><a 
href="symbols.html#x185-2637073r73">adjust-array</a></tt>.
</div>
</div>
<div class="defun">
<!--l. 567--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx115-1427004"></a><a 
 id="x115-1427005r540"></a> <b>array-displacement</b>  <i>array</i>
</div>
<!--l. 570--><p class="indent" >   This returns two values. The ﬁrst value is the array displaced to and
the second is the displacement. If array is not a displaced array then
array-displacement returns the values nil and 0.
</div>
                                                                          

                                                                          
<!--l. 575--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse94.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse92.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse92.html#tailclmse92.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse93.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="array.html#clmse93.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse93.html"></a>   </div> </div> 
</body></html> 
