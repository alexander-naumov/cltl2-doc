<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Creating New Streams</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 181--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse111.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html#tailclmse109.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse110.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="stream.html#clmse110.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">21.2   </span> <a 
href="clm.html#QQ2-136-1600" id="x136-157000021.2">Creating New Streams</a></h3>
<!--l. 183--><p class="noindent" >Perhaps the most important constructs for creating new streams are those that
open ﬁles; see <tt><a 
href="symbols.html#x185-2637937r937">with-open-file</a></tt> and <tt><a 
href="symbols.html#x185-2637640r640">open</a></tt>. The following functions construct
streams without reference to a ﬁle system.
<div class="defun">
<!--l. 187--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx136-1570001"></a><a 
 id="x136-1570002r609"></a> <b>make-synonym-stream</b>  <i>symbol</i>
</div>
<tt>
<!--l. 190--><p class="indent" >   <a 
href="symbols.html#x185-2637553r553">make-synonym-stream</a></tt> creates and returns a synonym stream. Any operations
on the new stream will be performed on the stream that is then the value of the
dynamic variable named by the <i>symbol</i>. If the value of the variable should
change or be bound, then the synonym stream will operate on the new
stream.
<!--l. 197--><p class="indent" >   The result of <tt><a 
href="symbols.html#x185-2637553r553">make-synonym-stream</a></tt> is always a stream of type <tt>synonym-stream</tt>.
Note that the type of a synonym stream is <i>always</i> <tt>synonym-stream</tt>, regardless of
the type of the stream for which it is a synonym.
</div>
<div class="defun">
<!--l. 203--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx136-1570003"></a><a 
 id="x136-1570004r610"></a> <b>make-broadcast-stream</b>  <b>&#x0026;rest</b>  <i>streams</i>
</div>
<!--l. 206--><p class="indent" >   This returns a stream that works only in the output direction. Any output
sent to this stream will be sent to all of the <i>streams</i> given. The set of operations
that may be performed on the new stream is the intersection of those for the given
streams. The results returned by a stream operation are the values resulting from
performing the operation on the last stream in <i>streams</i>; the results of performing
the operation on all preceding streams are discarded. If no <i>streams</i> are given as
arguments, then the result is a “bit sink”; all output to the resulting stream is
discarded. The result of <tt>make-broadcast-stream</tt> is always a stream of type
<tt>broadcast-stream</tt>.
</div>
                                                                          

                                                                          
<div class="defun">
<!--l. 221--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx136-1570005"></a><a 
 id="x136-1570006r611"></a> <b>make-concatenated-stream</b>  <b>&#x0026;rest</b>  <i>streams</i>
</div>
<!--l. 224--><p class="indent" >   This returns a stream that works only in the input direction. Input is taken
from the ﬁrst of the <i>streams</i> until it reaches end-of-ﬁle; then that stream is
discarded, and input is taken from the next of the <i>streams</i>, and so on. If no
arguments are given, the result is a stream with no content; any input attempt
will result in end-of-ﬁle. The result of <tt>make-concatenated-stream</tt> is always a
stream of type <tt>concatenated-stream</tt>.
</div>
<div class="defun">
<!--l. 234--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx136-1570007"></a><a 
 id="x136-1570008r612"></a> <b>make-two-way-stream</b>  <i>input-stream</i> <i>output-stream</i>
</div>
<!--l. 237--><p class="indent" >   This returns a bidirectional stream that gets its input from <i>input-stream</i> and
sends its output to <i>output-stream</i>. The result of <tt>make-two-way-stream</tt> is always a
stream of type <tt>two-way-stream</tt>.
</div>
<div class="defun">
<!--l. 243--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx136-1570009"></a><a 
 id="x136-1570010r613"></a> <b>make-echo-stream</b>  <i>input-stream</i> <i>output-stream</i>
</div>
<!--l. 246--><p class="indent" >   This returns a bidirectional stream that gets its input from <i>input-stream</i> and
sends its output to <i>output-stream</i>. In addition, all input taken from <i>input-stream</i>
is echoed to <i>output-stream</i>.
<!--l. 250--><p class="indent" >   Result of <tt>make-echo-stream</tt> is always a stream of type <tt>echo-stream</tt>.
<div class="new">
<!--l. 254--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx136-1570011"></a>to clarify the interaction of <tt><a 
href="symbols.html#x185-2637719r719">read-char</a></tt>,
<tt><a 
href="symbols.html#x185-2637903r903">unread-char</a></tt>, and <tt><a 
href="symbols.html#x185-2637666r666">peek-char</a></tt> with echo streams. (See the descriptions of those
functions for details.)
<!--l. 260--><p class="indent" >   X3J13 explicitly noted that the bidirectional streams that are the initial values
of <tt><a 
href="symbols.html#x185-2637039r39">*query-io*</a></tt>, <tt><a 
href="symbols.html#x185-2637011r11">*debug-io*</a></tt>, and <tt><a 
href="symbols.html#x185-2637049r49">*terminal-io*</a></tt>, even though they may have
some echoing behavior, conceptually are not necessarily the products of calls to
<tt><a 
href="symbols.html#x185-2637538r538">make-echo-stream</a></tt> and therefore are not subject to the new rules about
echoing on echo streams. Instead, these initial interactive streams may have
                                                                          

                                                                          
implementation-dependent echoing behavior.
</div>
</div>
<div class="defun">
<!--l. 270--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx136-1570012"></a><a 
 id="x136-1570013r614"></a> <b>make-string-input-stream</b>  <i>string</i> <b>&#x0026;optional</b>  <i>start</i> <i>end</i>
</div>
<!--l. 273--><p class="indent" >   This returns an input stream. The input stream will supply, in order, the
characters in the substring of <i>string</i> delimited by <i>start</i> and <i>end</i>; after the last
character has been supplied, the stream will then be at end-of-ﬁle.
<!--l. 278--><p class="indent" >   Result of <tt><a 
href="symbols.html#x185-2637550r550">make-string-input-stream</a></tt> is always a stream of type
<tt>string-stream</tt>.
</div>
<div class="defun">
<!--l. 282--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx136-1570014"></a><a 
 id="x136-1570015r615"></a> <b>make-string-output-stream</b>  <b>&#x0026;key</b>  <i>:element-type</i>
</div>
<!--l. 285--><p class="indent" >   This returns an output stream that will accumulate all output given it for the
beneﬁt of the function <tt><a 
href="symbols.html#x185-2637416r416">get-output-stream-string</a></tt>.
<!--l. 289--><p class="indent" >   The <tt>:element-type</tt> argument speciﬁes what characters must be accepted by
the created stream. If the <tt>:element-type</tt> argument is omitted, the created
stream must accept all characters.
<!--l. 293--><p class="indent" >   The result of <tt><a 
href="symbols.html#x185-2637551r551">make-string-output-stream</a></tt> is always a stream of type
<tt>string-stream</tt>.
</div>
<div class="defun">
<!--l. 297--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx136-1570016"></a><a 
 id="x136-1570017r616"></a> <b>get-output-stream-string</b>  <i>string-output-stream</i>
</div>
<!--l. 300--><p class="indent" >   Given a stream produced by <tt><a 
href="symbols.html#x185-2637551r551">make-string-output-stream</a></tt>, this returns a
string containing all the characters output to the stream so far. The stream is
then reset; thus each call to <tt><a 
href="symbols.html#x185-2637416r416">get-output-stream-string</a></tt> gets only the characters
since the last such call (or the creation of the stream, if no such previous call has
been made).
</div>
<div class="defmac">
                                                                          

                                                                          
<div class="defmacheader">
<!--l. 308--><p class="indent" >   <div class="tabbing">
 <i>[Macro]</i> <b>with-open-stream</b> <a 
 id="dx136-1570018"></a><a 
 id="x136-1570019r617"></a> (var stream) {declaration}* {form}*
   <br>
<!--l. 309--><p class="noindent" ></div>
<!--l. 309--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-157100021.2" id="x136-157100021.2"></a></span>
</div>
<!--l. 310--><p class="indent" >   The form <i>stream</i> is evaluated and must produce a stream. The variable <i>var</i> is
bound with the stream as its value, and then the forms of the body are executed
as an implicit <tt><a 
href="symbols.html#x185-2637700r700">progn</a></tt>; the results of evaluating the last form are returned as the
value of the <tt><a 
href="symbols.html#x185-2637938r938">with-open-stream</a></tt> form. The stream is automatically closed on exit
from the <tt><a 
href="symbols.html#x185-2637938r938">with-open-stream</a></tt> form, no matter whether the exit is normal or
abnormal; see <tt><a 
href="symbols.html#x185-2637223r223">close</a></tt>. The stream should be regarded as having dynamic
extent.
<!--l. 321--><p class="indent" >   The stream created by <tt><a 
href="symbols.html#x185-2637938r938">with-open-stream</a></tt> is always of type <tt>file-stream</tt>.
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 326--><p class="indent" >   <div class="tabbing">
 <i>[Macro]</i> <b>with-input-from-string</b> <a 
 id="dx136-1571001"></a><a 
 id="x136-1571002r618"></a> (var string {keyword value}*)
   <br>                                                               {declaration}* {form}*<br>
<!--l. 328--><p class="noindent" ></div>
<!--l. 328--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-157200021.2" id="x136-157200021.2"></a></span>
</div>
<!--l. 329--><p class="indent" >   The body is executed as an implicit <tt><a 
href="symbols.html#x185-2637700r700">progn</a></tt> with the variable <i>var</i> bound to a
character input stream that supplies successive characters from the value of the
form <i>string</i>. <tt><a 
href="symbols.html#x185-2637936r936">with-input-from-string</a></tt> returns the results from the last <i>form</i> of
the body.
<!--l. 334--><p class="indent" >   The input stream is automatically closed on exit from the <tt>with-input-from-string</tt>
form, no matter whether the exit is normal or abnormal. The stream should be
regarded as having dynamic extent.
                                                                          

                                                                          
<!--l. 339--><p class="indent" >   The stream created by <tt><a 
href="symbols.html#x185-2637936r936">with-input-from-string</a></tt> is always of type
<tt>string-stream</tt>.
<!--l. 342--><p class="indent" >   The following keyword options may be used:
         <div class="quotation">
<div class="flushdesc">
     <ul><li><b>
<tt>:index</tt> </b></li>The form after the <tt>:index</tt> keyword should be a <i>place</i>
     acceptable to <tt><a 
href="symbols.html#x185-2637778r778">setf</a></tt>. If the <tt><a 
href="symbols.html#x185-2637936r936">with-input-from-string</a></tt> form
     is exited normally, then the <i>place</i> will have stored into it the
     index into the <i>string</i> indicating the ﬁrst character not read
     (the length of the string if all characters were used). The
     <i>place</i> is not updated as reading progresses, but only at the
     end of the operation.
     <li><b>
<tt>:start</tt> </b></li>The <tt>:start</tt> keyword takes an argument indicating, in
     the manner usual for sequence functions, the beginning of a
     substring of <i>string</i> to be used.
     <li><b>
<tt>:end</tt> </b></li>The <tt>:end</tt> keyword takes an argument indicating, in the
     manner usual for sequence functions, the end of a substring
     of <i>string</i> to be used.</ul>
</div>
      </div>
<!--l. 366--><p class="indent" >   Here is an example of the use of <tt><a 
href="symbols.html#x185-2637936r936">with-input-from-string</a></tt>: <div class="lisp"><div class="tabbing">
(with-input-from-string (s &#x0022;Animal Crackers&#x0022; :index j :start 6)
   <br>                                                                  (read s)) <span class="math"> ⇒</span> crackers<br>
<!--l. 370--><p class="noindent" ></div>
<!--l. 370--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-157300021.2" id="x136-157300021.2"></a></span>
                                                                          

                                                                          
<!--l. 370--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-157400021.2" id="x136-157400021.2"></a></span>
</div>
<!--l. 371--><p class="indent" >   As a side eﬀect, the variable <tt>j</tt> is set to <tt>15</tt>.
<div class="new">
<!--l. 374--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx136-1574001"></a>to restrict user side eﬀects; see section
<a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 381--><p class="indent" >   <div class="tabbing">
 <i>[Macro]</i> <b>with-output-to-string</b> <a 
 id="dx136-1574002"></a><a 
 id="x136-1574003r619"></a> (var [string [<tt>:element-type</tt> type]])
   <br>                                                               {declaration}* {form}*<br>
<!--l. 383--><p class="noindent" ></div>
<!--l. 383--><p class="noindent" ><span class="paragraphHead"><a 
href="#x136-157500021.2" id="x136-157500021.2"></a></span>
</div>
<!--l. 384--><p class="indent" >   One may specify <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> instead of a string as the <i>string</i> and use the
<tt>:element-type</tt> argument to specify what characters must be accepted
by the created stream. If no <i>string</i> argument is provided, or if it is <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>
and no <tt>:element-type</tt> is speciﬁed, the created stream must accept all
characters.
<!--l. 390--><p class="indent" >   If <i>string</i> is speciﬁed, it must be a string with a ﬁll pointer; the output is
incrementally appended to the string (as if by use of <tt><a 
href="symbols.html#x185-2637923r923">vector-push-extend</a></tt>).
<!--l. 394--><p class="indent" >   In this way output cannot be accidentally lost. This change makes
<tt>with-output-to-string</tt> behave in the same way that <tt><a 
href="symbols.html#x185-2637392r392">format</a></tt> does when given a
string as its ﬁrst argument.
<!--l. 398--><p class="indent" >   The stream created by <tt><a 
href="symbols.html#x185-2637939r939">with-output-to-string</a></tt> is always of type
<tt>string-stream</tt>.
<!--l. 401--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx136-1575001"></a>to restrict user side eﬀects; see section
<a 
href="clmse43.html#x55-6760007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
                                                                          

                                                                          
<!--l. 406--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse111.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html#tailclmse109.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="stream.html#clmse110.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse110.html"></a>   </div> </div> 
</body></html> 
