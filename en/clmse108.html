<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>The Top-Level Loop</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 16:10:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 248--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="stream.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html#tailclmse107.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse108.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="eval.html#clmse108.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">20.2   </span> <a 
href="clm.html#QQ2-133-1593" id="x133-156300020.2">The Top-Level Loop</a></h3>
<!--l. 250--><p class="noindent" >Normally one interacts with Lisp through a “top-level <tt><a 
href="symbols.html#x187-2636717r717">read</a></tt>-<tt><a 
href="symbols.html#x187-2636343r343">eval</a></tt>-<tt><a 
href="symbols.html#x187-2636690r690">print</a></tt> loop,” so
called because it is the highest level of control and consists of an endless loop that
reads an expression, evaluates it, and prints the results. One has an eﬀect
on the state of the Lisp system only by invoking actions that have side
eﬀects.
<!--l. 257--><p class="indent" >   The precise nature of the top-level loop for Common Lisp is purposely not
rigorously speciﬁed here so that implementors can experiment to improve
the user interface. For example, an implementor may choose to require
line-at-a-time input, or may provide a fancy editor or complex graphics-display
interface. An implementor may choose to provide explicit prompts for input,
or may choose (as MacLisp does) not to clutter up the transcript with
prompts.
<!--l. 267--><p class="indent" >   The top-level loop is required to trap all throws and recover gracefully. It is
also required to print all values resulting from evaluation of a form, perhaps on
separate lines. If a form returns zero values, as little as possible should be
printed.
<!--l. 272--><p class="indent" >   The following variables are maintained by the top-level loop as a limited safety
net, in case the user forgets to save an interesting input expression or output
value. (Note that the names of some of these variables violate the convention that
names of global variables begin and end with an asterisk.) These are intended
primarily for user interaction, which is why they have short names. Use of these
variables should be avoided in programs.
<div class="defun">
<!--l. 279--><p class="noindent" ><div class="defunheader"> <i>[Variable]</i><a 
 id="dx133-1563001"></a><a 
 id="x133-1563002r592"></a> <b>+</b><br />
<i>
[Variable]</i><a 
 id="dx133-1563003"></a><a 
 id="x133-1563004r593"></a> <b>++</b><br />
<i>
[Variable]</i><a 
 id="dx133-1563005"></a><a 
 id="x133-1563006r594"></a> <b>+++</b>
</div>
<!--l. 284--><p class="indent" >   While a form is being evaluated by the top-level loop, the variable <tt><a 
href="symbols.html#x187-2636051r51">+</a></tt> is bound
                                                                          

                                                                          
to the previous form read by the loop. The variable <tt><a 
href="symbols.html#x187-2636052r52">++</a></tt> holds the previous value of
<tt><a 
href="symbols.html#x187-2636051r51">+</a></tt> (that is, the form evaluated two interactions ago), and <tt><a 
href="symbols.html#x187-2636053r53">+++</a></tt> holds the previous
value of <tt><a 
href="symbols.html#x187-2636052r52">++</a></tt>.
</div>
<div class="defun">
<!--l. 291--><p class="noindent" ><div class="defunheader"> <i>[Variable]</i><a 
 id="dx133-1563007"></a><a 
 id="x133-1563008r595"></a> <b>-</b>
</div>
<!--l. 294--><p class="indent" >   While a form is being evaluated by the top-level loop, the variable <tt><a 
href="symbols.html#x187-2636054r54">-</a></tt> is bound
to the form itself; that is, it is the value about to be given to <tt><a 
href="symbols.html#x187-2636051r51">+</a></tt> once this
interaction is done. <div class="new"><i>Notice of correction.</i> In the ﬁrst edition, the name of the
variable <tt><a 
href="symbols.html#x187-2636054r54">-</a></tt> was inadvertently omitted.
</div>
</div>
<div class="defun">
<!--l. 305--><p class="noindent" ><div class="defunheader"> <i>[Variable]</i><a 
 id="dx133-1563009"></a><a 
 id="x133-1563010r596"></a> <b>*</b><br />
<i>
[Variable]</i><a 
 id="dx133-1563011"></a><a 
 id="x133-1563012r597"></a> <b>**</b><br />
<i>
[Variable]</i><a 
 id="dx133-1563013"></a><a 
 id="x133-1563014r598"></a> <b>***</b>
</div>
<!--l. 310--><p class="indent" >   While a form is being evaluated by the top-level loop, the variable <tt><a 
href="symbols.html#x187-2636002r2">*</a></tt> is bound
to the result printed at the end of the last time through the loop; that is, it is
the value produced by evaluating the form in <tt><a 
href="symbols.html#x187-2636051r51">+</a></tt>. If several values were
produced, <tt><a 
href="symbols.html#x187-2636002r2">*</a></tt> contains the ﬁrst value only; <tt><a 
href="symbols.html#x187-2636002r2">*</a></tt> contains <tt><a 
href="symbols.html#x187-2636609r609">nil</a></tt> if zero values
were produced. The variable <tt><a 
href="symbols.html#x187-2636003r3">**</a></tt> holds the previous value of <tt><a 
href="symbols.html#x187-2636002r2">*</a></tt> (that is, the
result printed two interactions ago), and <tt><a 
href="symbols.html#x187-2636004r4">***</a></tt> holds the previous value of
<tt><a 
href="symbols.html#x187-2636003r3">**</a></tt>.
<!--l. 320--><p class="indent" >   If the evaluation of <tt><a 
href="symbols.html#x187-2636051r51">+</a></tt> is aborted for some reason, then the values associated
with <tt><a 
href="symbols.html#x187-2636002r2">*</a></tt>, <tt><a 
href="symbols.html#x187-2636003r3">**</a></tt>, and <tt><a 
href="symbols.html#x187-2636004r4">***</a></tt> are not updated; they are updated only if the printing of
values is at least begun (though not necessarily completed).
</div>
<div class="defun">
<!--l. 326--><p class="noindent" ><div class="defunheader"> <i>[Variable]</i><a 
 id="dx133-1563015"></a><a 
 id="x133-1563016r599"></a> <b>/</b><br />
<i>
                                                                          

                                                                          
[Variable]</i><a 
 id="dx133-1563017"></a><a 
 id="x133-1563018r600"></a> <b>//</b><br />
<i>
[Variable]</i><a 
 id="dx133-1563019"></a><a 
 id="x133-1563020r601"></a> <b>///</b>
</div>
<!--l. 331--><p class="indent" >   While a form is being evaluated by the top-level loop, the variable <tt><a 
href="symbols.html#x187-2636055r55">/</a></tt> is bound
to a list of the results printed at the end of the last time through the loop; that is,
it is a list of all values produced by evaluating the form in <tt><a 
href="symbols.html#x187-2636051r51">+</a></tt>. The value of <tt><a 
href="symbols.html#x187-2636002r2">*</a></tt>
should always be the same as the <i>car</i> of the value of <tt><a 
href="symbols.html#x187-2636055r55">/</a></tt>. The variable <tt><a 
href="symbols.html#x187-2636056r56">//</a></tt>
holds the previous value of <tt><a 
href="symbols.html#x187-2636055r55">/</a></tt> (that is, the results printed two interactions
ago), and <tt><a 
href="symbols.html#x187-2636057r57">///</a></tt> holds the previous value of <tt><a 
href="symbols.html#x187-2636056r56">//</a></tt>. Therefore the value of <tt><a 
href="symbols.html#x187-2636003r3">**</a></tt>
should always be the same as the <i>car</i> of <tt><a 
href="symbols.html#x187-2636056r56">//</a></tt>, and similarly for <tt><a 
href="symbols.html#x187-2636004r4">***</a></tt> and
<tt><a 
href="symbols.html#x187-2636057r57">///</a></tt>.
<!--l. 341--><p class="indent" >   If the evaluation of <tt><a 
href="symbols.html#x187-2636051r51">+</a></tt> is aborted for some reason, then the values associated
with <tt><a 
href="symbols.html#x187-2636055r55">/</a></tt>, <tt><a 
href="symbols.html#x187-2636056r56">//</a></tt>, and <tt><a 
href="symbols.html#x187-2636057r57">///</a></tt> are not updated; they are updated only if the printing of
values is at least begun (though not necessarily completed).
</div>
<!--l. 347--><p class="indent" >   As an example of the processing of these variables, consider the following
possible transcript, where <tt><a 
href="symbols.html#x187-2636062r62">&#x003E;</a></tt> is a prompt by the top-level loop for user input:
<div class="lisp"><div class="tabbing">
&#x003E;(cons - -)                      ;Interaction 1
   <br>                                           ((CONS - -) CONS - -)      ;Cute, huh?<br>
<br>                                  &#x003E;(values)                        ;Interaction 2<br>
                                ;Nothing to print<br>
&#x003E;(cons &#x2019;a &#x2019;b)                    ;Interaction 3<br>
(A . B)                           ;There is a single value<br>
<br>                                  &#x003E;(hairy-loop)̂G               ;Interaction 4<br>
### QUIT to top level.    ;(User aborts the computation.)<br>
<br>                                  &#x003E;(ﬂoor 13 4)                    ;Interaction 5<br>
3                                   ;There are two values<br>                         1<br>
<!--l. 366--><p class="noindent" ></div>
<!--l. 366--><p class="noindent" ><span class="paragraphHead"><a 
href="#x133-156400020.2" id="x133-156400020.2"></a></span>
                                                                          

                                                                          
<!--l. 366--><p class="noindent" ><span class="paragraphHead"><a 
href="#x133-156500020.2" id="x133-156500020.2"></a></span>
</div>
<!--l. 367--><p class="indent" >   At this point we have: <div class="lisp"><div class="tabbing">
<!--tex4ht:inline--><div class="tabular"><table width="100%" class="tabular"><tr><td align="left" >+++ <span class="math"> ⇒</span> (cons &#x2019;a &#x2019;b) </td><td align="left" >*** <span class="math"> ⇒</span> NIL   </td><td align="left" >/// <span class="math"> ⇒</span> ()        </td>
</tr><tr><td align="left" >++ <span class="math"> ⇒</span> (hairy-loop)   </td><td align="left" >** <span class="math"> ⇒</span> (A . B)</td><td align="left" >// <span class="math"> ⇒</span> ((A . B))</td>
</tr><tr><td align="left" >+ <span class="math"> ⇒</span> (ﬂoor 13 4)      </td><td align="left" >* <span class="math"> ⇒</span> 3          </td><td align="left" >/ <span class="math"> ⇒</span> (3 1)       </td></tr></table>                      </div>
   <br>
<!--l. 374--><p class="noindent" ></div>
<!--l. 374--><p class="noindent" ><span class="paragraphHead"><a 
href="#x133-156600020.2" id="x133-156600020.2"></a></span>
<!--l. 374--><p class="noindent" ><span class="paragraphHead"><a 
href="#x133-156700020.2" id="x133-156700020.2"></a></span>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
<!--l. 8--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="stream.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html#tailclmse107.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse108.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="eval.html#clmse108.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse108.html"></a>   </div> </div> 
</body></html> 
