<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Operations on Streams</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 14:21:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 406--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="io.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html#tailclmse110.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse111.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="stream.html#clmse111.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">21.3   </span> <a 
href="clm.html#QQ2-137-1606" id="x137-157600021.3">Operations on Streams</a></h3>
<!--l. 408--><p class="noindent" >This section contains discussion of only those operations that are common to all
streams. Input and output is rather complicated and is discussed separately in
chapter <a 
href="io.html#x138-158000022">22<!--tex4ht:ref: IO --></a>. The interface between streams and the ﬁle system is discussed in
chapter <a 
href="files.html#x143-187100023">23<!--tex4ht:ref: FILES --></a>.
<div class="defun">
<!--l. 414--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1576001"></a><a 
 id="x137-1576002r620"></a> <b>streamp</b>  <i>object</i>
</div>
<tt>
<!--l. 417--><p class="indent" >   <a 
href="symbols.html#x185-2637827r827">streamp</a></tt> is true if its argument is a stream, and otherwise is false.
<div class="lisp"><div class="tabbing">
(streamp x) <span class="math"> ≡</span> (typep x &#x2019;stream)
   <br>
<!--l. 421--><p class="noindent" ></div>
<!--l. 421--><p class="noindent" ><span class="paragraphHead"><a 
href="#x137-157700021.3" id="x137-157700021.3"></a></span>
<!--l. 421--><p class="noindent" ><span class="paragraphHead"><a 
href="#x137-157800021.3" id="x137-157800021.3"></a></span>
</div>
<tt>
<!--l. 423--><p class="indent" >   <a 
href="symbols.html#x185-2637827r827">streamp</a></tt> is unaﬀected by whether its argument, if a stream, is open or closed.
In either case it returns true.
</div>
<div class="defun">
<!--l. 428--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1578001"></a><a 
 id="x137-1578002r621"></a> <b>open-stream-p</b>  <i>stream</i>
                                                                          

                                                                          
</div>
<!--l. 431--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx137-1578003"></a>to add the predicate <tt><a 
href="symbols.html#x185-2637641r641">open-stream-p</a></tt>. It is
true if its argument (which must be a stream) is open, and otherwise is
false.
<!--l. 436--><p class="indent" >   A stream is always created open; it remains open until closed with the <tt><a 
href="symbols.html#x185-2637223r223">close</a></tt>
function. The macros <tt><a 
href="symbols.html#x185-2637938r938">with-open-stream</a></tt>, <tt><a 
href="symbols.html#x185-2637936r936">with-input-from-string</a></tt>,
<tt><a 
href="symbols.html#x185-2637939r939">with-output-to-string</a></tt>, and <tt><a 
href="symbols.html#x185-2637937r937">with-open-file</a></tt> automatically close the created
stream as control leaves their bodies, in eﬀect imposing dynamic extent on the
openness of the stream.
</div>
<div class="defun">
<!--l. 444--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1578004"></a><a 
 id="x137-1578005r622"></a> <b>input-stream-p</b>  <i>stream</i>
</div>
<!--l. 447--><p class="indent" >   This predicate is true if its argument (which must be a stream) can handle
input operations, and otherwise is false.
</div>
<div class="defun">
<!--l. 451--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1578006"></a><a 
 id="x137-1578007r623"></a> <b>output-stream-p</b>  <i>stream</i>
</div>
<!--l. 454--><p class="indent" >   This predicate is true if its argument (which must be a stream) can handle
output operations, and otherwise is false.
</div>
<div class="defun">
<!--l. 458--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1578008"></a><a 
 id="x137-1578009r624"></a> <b>stream-element-type</b>  <i>stream</i>
</div>
<!--l. 461--><p class="indent" >   A type speciﬁer is returned to indicate what objects may be read from or
written to the argument <i>stream</i>, which must be a stream. Streams created by
<tt><a 
href="symbols.html#x185-2637640r640">open</a></tt> will have an element type restricted to a subset of <tt><a 
href="symbols.html#x185-2637214r214">character</a></tt> or
<tt>integer</tt>, but in principle a stream may conduct transactions using any Lisp
objects.
</div>
<div class="defun">
                                                                          

                                                                          
<!--l. 469--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1578010"></a><a 
 id="x137-1578011r625"></a> <b>close</b>  <i>stream</i> <b>&#x0026;key</b>  <i>:abort</i>
</div>
<!--l. 472--><p class="indent" >   The argument must be a stream. The stream is closed. No further
input/output operations may be performed on it. However, certain inquiry
operations may still be performed, and it is permissible to close an already closed
stream.
<div class="newer">
<!--l. 478--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx137-1578012"></a>and revised the vote in March 1989 to specify
that if <tt><a 
href="symbols.html#x185-2637223r223">close</a></tt> is called on an open stream, the stream is closed and <tt><a 
href="symbols.html#x185-2637871r871">t</a></tt> is returned;
but if <tt><a 
href="symbols.html#x185-2637223r223">close</a></tt> is called on a closed stream, it succeeds without error and returns an
unspeciﬁed value. (The rationale for not specifying the value returned for a closed
stream is that in some implementations closing certain streams does not really
have an eﬀect on them—for example, closing the <tt><a 
href="symbols.html#x185-2637049r49">*terminal-io*</a></tt> stream might not
“really” close it—and it is not desirable to force such implementations to keep
otherwise unnecessary state. Portable programs will of course not rely on such
behavior.)
<!--l. 493--><p class="indent" >   X3J13 also voted in January 1989 to specify exactly which inquiry functions
may be applied to closed streams: <div class="tabbing">
<!--tex4ht:inline--><div class="tabular"><table width="100%" class="tabular"><tr><td align="left" > <tt><a 
href="symbols.html#x185-2637827r827">streamp</a></tt>        </td><td align="left" ><tt><a 
href="symbols.html#x185-2637660r660">pathname-host</a></tt>     </td><td align="left" ><tt><a 
href="symbols.html#x185-2637603r603">namestring</a></tt>          </td>
</tr><tr><td align="left" > <tt><a 
href="symbols.html#x185-2637657r657">pathname</a></tt>       </td><td align="left" ><tt><a 
href="symbols.html#x185-2637658r658">pathname-device</a></tt>   </td><td align="left" ><tt><a 
href="symbols.html#x185-2637361r361">file-namestring</a></tt>     </td>
</tr><tr><td align="left" > <tt><a 
href="symbols.html#x185-2637887r887">truename</a></tt>       </td><td align="left" ><tt><a 
href="symbols.html#x185-2637659r659">pathname-directory</a></tt></td><td align="left" ><tt><a 
href="symbols.html#x185-2637307r307">directory-namestring</a></tt></td>
</tr><tr><td align="left" > <tt><a 
href="symbols.html#x185-2637574r574">merge-pathnames</a></tt></td><td align="left" ><tt><a 
href="symbols.html#x185-2637662r662">pathname-name</a></tt>     </td><td align="left" ><tt><a 
href="symbols.html#x185-2637433r433">host-namestring</a></tt>     </td>
</tr><tr><td align="left" > <tt><a 
href="symbols.html#x185-2637640r640">open</a></tt>           </td><td align="left" ><tt><a 
href="symbols.html#x185-2637663r663">pathname-type</a></tt>     </td><td align="left" ><tt><a 
href="symbols.html#x185-2637334r334">enough-namestring</a></tt>   </td>
</tr><tr><td align="left" > <tt><a 
href="symbols.html#x185-2637694r694">probe-file</a></tt>     </td><td align="left" ><tt><a 
href="symbols.html#x185-2637664r664">pathname-version</a></tt>  </td><td align="left" ><tt><a 
href="symbols.html#x185-2637306r306">directory</a></tt>           </td>
</tr><tr><td align="left" >                         </td></tr></table>                                                       </div>
   <br>
<!--l. 504--><p class="noindent" ></div>
<!--l. 504--><p class="noindent" ><span class="paragraphHead"><a 
href="#x137-157900021.3" id="x137-157900021.3"></a></span>
   See the individual descriptions of these functions for more information on how
they operate on closed streams.
</div>
<div class="new">
<!--l. 510--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx137-1579001"></a>to clarify the eﬀect of closing various kinds of
streams. First some terminology:
      <ul class="itemize1">
      <li class="itemize">A                                                                             <i>composite</i>
                                                                          

                                                                          
      stream is one that was returned by a call to <tt>make-synonym-stream</tt>,
      <tt><a 
href="symbols.html#x185-2637534r534">make-broadcast-stream</a></tt>,                   <tt><a 
href="symbols.html#x185-2637535r535">make-concatenated-stream</a></tt>,
      <tt>make-two-way-stream</tt>, or <tt>make-echo-stream</tt>.
      </li>
      <li class="itemize">The <i>constituents</i> of a composite stream are the streams that were given
      as arguments to the function that constructed it or, in the case of
      <tt>make-synonym-stream</tt>, the stream that is the <tt><a 
href="symbols.html#x185-2637868r868">symbol-value</a></tt> of the
      symbol that was given as an argument. (The constituent of a synonym
      stream may therefore vary over time.)
      </li>
      <li class="itemize">A <i>constructed</i> stream is either a composite stream or one returned by
      a call to <tt><a 
href="symbols.html#x185-2637550r550">make-string-input-stream</a></tt>, <tt><a 
href="symbols.html#x185-2637551r551">make-string-output-stream</a></tt>,
      <tt>with-input-from-string</tt>, or <tt><a 
href="symbols.html#x185-2637939r939">with-output-to-string</a></tt>.</li></ul>
<!--l. 537--><p class="indent" >   The eﬀect of applying <tt><a 
href="symbols.html#x185-2637223r223">close</a></tt> to a constructed stream is to close that stream
only. No input/output operations are permitted on the constructed stream once it
has been closed (though certain inquiry functions are still permitted, as described
above).
<!--l. 542--><p class="indent" >   Closing a composite stream has no eﬀect on its constituents; any constituents
that are open remain open.
<!--l. 545--><p class="indent" >   If a stream created by <tt><a 
href="symbols.html#x185-2637551r551">make-string-output-stream</a></tt> is closed, the
result of then applying <tt><a 
href="symbols.html#x185-2637416r416">get-output-stream-string</a></tt> to the stream is
unspeciﬁed.
</div>
<!--l. 550--><p class="indent" >   If the <tt>:abort</tt> parameter is not <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt> (it defaults to <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>), it indicates an
abnormal termination of the use of the stream. An attempt is made to clean up
any side eﬀects of having created the stream in the ﬁrst place. For example, if the
stream performs output to a ﬁle that was newly created when the stream was
created, then if possible the ﬁle is deleted and any previously existing ﬁle is not
superseded.
</div>
<div class="defun">
<!--l. 558--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1579002"></a><a 
 id="x137-1579003r626"></a> <b>broadcast-stream-streams</b>  <i>broadcast-stream</i>
</div>
<!--l. 561--><p class="indent" >   The argument must be of type <tt>broadcast-stream</tt>. A list of the constituent
                                                                          

                                                                          
output streams (whether open or not) is returned.
</div>
<div class="defun">
<!--l. 566--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1579004"></a><a 
 id="x137-1579005r627"></a> <b>concatenated-stream-streams</b>  <i>concatenated-stream</i>
</div>
<!--l. 569--><p class="indent" >   The argument must be of type <tt>concatenated-stream</tt>. A list of constituent
streams (whether open or not) is returned. This list represents the ordered set of
input streams from which the concatenated stream may yet read; the stream from
which it is currently reading is ﬁrst in the list. The list may be empty if no more
streams remain to be read.
</div>
<div class="defun">
<!--l. 578--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1579006"></a><a 
 id="x137-1579007r628"></a> <b>echo-stream-input-stream</b>  <i>echo-stream</i><br />
<i>
[Function]</i><a 
 id="dx137-1579008"></a><a 
 id="x137-1579009r629"></a> <b>echo-stream-output-stream</b>  <i>echo-stream</i>
</div>
<!--l. 582--><p class="indent" >   The argument must be of type <tt>echo-stream</tt>. The function
<tt><a 
href="symbols.html#x185-2637325r325">echo-stream-input-stream</a></tt> returns the constituent input stream;
<tt><a 
href="symbols.html#x185-2637326r326">echo-stream-output-stream</a></tt> returns the constituent output stream.
</div>
<div class="defun">
<!--l. 589--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1579010"></a><a 
 id="x137-1579011r630"></a> <b>synonym-stream-symbol</b>  <i>synonym-stream</i>
</div>
<!--l. 592--><p class="indent" >   The argument must be of type <tt>synonym-stream</tt>. This function returns the
symbol for whose value the <i>synonym-stream</i> is a synonym.
</div>
<div class="defun">
<!--l. 596--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1579012"></a><a 
 id="x137-1579013r631"></a> <b>two-way-stream-input-stream</b>  <i>two-way-stream</i><br />
<i>
                                                                          

                                                                          
[Function]</i><a 
 id="dx137-1579014"></a><a 
 id="x137-1579015r632"></a> <b>two-way-stream-output-stream</b>  <i>two-way-stream</i>
</div>
<!--l. 600--><p class="indent" >   The argument must be of type <tt>two-way-stream</tt>. The function
<tt><a 
href="symbols.html#x185-2637889r889">two-way-stream-input-stream</a></tt> returns the constituent input stream;
<tt><a 
href="symbols.html#x185-2637890r890">two-way-stream-output-stream</a></tt> returns the constituent output stream.
</div>
<div class="defun">
<!--l. 606--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1579016"></a><a 
 id="x137-1579017r633"></a> <b>interactive-stream-p</b>  <i>stream</i>
</div>
<!--l. 609--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx137-1579018"></a>to add the predicate <tt><a 
href="symbols.html#x185-2637450r450">interactive-stream-p</a></tt>, which
returns <tt><a 
href="symbols.html#x185-2637871r871">t</a></tt> if the <i>stream</i> is interactive and otherwise returns <tt><a 
href="symbols.html#x185-2637609r609">nil</a></tt>. A <tt>type-error</tt>
error is signalled if the argument is not of type <tt>stream</tt>.
<!--l. 614--><p class="indent" >   The precise meaning of <tt><a 
href="symbols.html#x185-2637450r450">interactive-stream-p</a></tt> is implementation-dependent
and may depend on the underlying operating system. The intent is to distinguish
between interactive and batch (background, command-ﬁle) operations. Some
characteristics that might distinguish a stream as interactive:
      <ul class="itemize1">
      <li class="itemize">The stream is connected to a person (or the equivalent) in such a way
      that the program can prompt for information and expect to receive
      input that might depend on the prompt.
      </li>
      <li class="itemize">The program is expected to prompt for input and to support “normal
      input editing protocol” for that operating environment.
      </li>
      <li class="itemize">A call to <tt><a 
href="symbols.html#x185-2637719r719">read-char</a></tt> might hang waiting for the user to type something
      rather than quickly returning a character or an end-of-ﬁle indication.</li></ul>
<!--l. 629--><p class="noindent" >The value of <tt><a 
href="symbols.html#x185-2637049r49">*terminal-io*</a></tt> might or might not be interactive.
</div>
<div class="defun">
<!--l. 632--><p class="noindent" ><div class="defunheader"> <i>[Function]</i><a 
 id="dx137-1579019"></a><a 
 id="x137-1579020r634"></a> <b>stream-external-format</b>  <i>stream</i>
</div>
<!--l. 635--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx137-1579021"></a>to add the function <tt><a 
href="symbols.html#x185-2637826r826">stream-external-format</a></tt>,
                                                                          

                                                                          
which returns a speciﬁer for the implementation-recognized scheme used for
representing characters in the argument <i>stream</i>. See the <tt>:external-format</tt>
argument to <tt><a 
href="symbols.html#x185-2637640r640">open</a></tt>.
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
<!--l. 7--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="io.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html#tailclmse110.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse111.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="stream.html#clmse111.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse111.html"></a>   </div> </div> 
</body></html> 
