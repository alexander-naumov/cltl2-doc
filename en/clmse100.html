<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Introduction to Structures</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-20 16:10:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="../cltl2ed.css"></head><body 
>
<!--l. 26--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse101.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html#tailstruct.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse100.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html#clmse100.html" >Up</a><tt>&#x003E;</tt>&lt;<a href="../index.html">Main Page</a>&gt;</div><h3 class="sectionHead"><span class="titlemark">19.1   </span> <a 
href="clm.html#QQ2-124-1492" id="x124-146200019.1">Introduction to Structures</a></h3>
<!--l. 29--><p class="noindent" >The structure facility is embodied in the <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> macro, which allows the user
to create and use aggregate data types with named elements. These are like
“structures” in PL/I, or “records” in Pascal.
<!--l. 34--><p class="indent" >   As an example, assume you are writing a Lisp program that deals with space
ships in a two-dimensional plane. In your program, you need to represent a space
ship by a Lisp object of some kind. The interesting things about a space ship, as
far as your program is concerned, are its position (represented as <i>x</i> and <i>y</i>
coordinates), velocity (represented as components along the <i>x</i> and <i>y</i> axes), and
                                                                          

                                                                          
mass.
<!--l. 43--><p class="indent" >   A ship might therefore be represented as a record structure with ﬁve
components: <i>x</i>-position, <i>y</i>-position, <i>x</i>-velocity, <i>y</i>-velocity, and mass. This
structure could in turn be implemented as a Lisp object in a number of ways. It
could be a list of ﬁve elements; the <i>x</i>-position could be the <i>car</i>, the <i>y</i>-position the
<i>cadr</i>, and so on. Equally well it could be a vector of ﬁve elements: the <i>x</i>-position
could be element 0, the <i>y</i>-position element 1, and so on. The problem with either
of these representations is that the components occupy places in the object that
are quite arbitrary and hard to remember. Someone looking at <tt>(cadddr ship1)</tt>
or <tt>(aref ship1 3)</tt> in a piece of code might ﬁnd it diﬃcult to determine
that this is accessing the <i>y</i>-velocity component of <tt>ship1</tt>. Moreover, if
the representation of a ship should have to be changed, it would be very
diﬃcult to ﬁnd all the places in the code to be changed to match (not
all occurrences of <tt><a 
href="symbols.html#x187-2636165r165">cadddr</a></tt> are intended to extract the <i>y</i>-velocity from a
ship).
<!--l. 59--><p class="indent" >   Ideally components of record structures should have names. One would like to
write something like <tt>(ship-y-velocity ship1)</tt> instead of <tt>(cadddr ship1)</tt>.
One would also like a more mnemonic way to create a ship than this:
<div class="lisp"><div class="tabbing">
(list 0 0 0 0 0)
   <br>
<!--l. 65--><p class="noindent" ></div>
<!--l. 65--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-146300019.1" id="x124-146300019.1"></a></span>
<!--l. 65--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-146400019.1" id="x124-146400019.1"></a></span>
</div>
<!--l. 66--><p class="indent" >   Indeed, one would like <tt>ship</tt> to be a new data type, just like other Lisp data
types, that one could test with <tt><a 
href="symbols.html#x187-2636896r896">typep</a></tt>, for example. The <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> facility
provides all of this.
<tt>
<!--l. 70--><p class="indent" >   <a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> itself is a macro that deﬁnes a structure. For the space ship
example, one might deﬁne the structure by saying: <div class="lisp"><div class="tabbing">
                                                                          

                                                                          
(defstruct ship
   <br>                                 x-position<br>                                 y-position<br>
  x-velocity<br>                                                     y-velocity<br>
  mass)<br>
<!--l. 79--><p class="noindent" ></div>
<!--l. 79--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-146500019.1" id="x124-146500019.1"></a></span>
<!--l. 79--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-146600019.1" id="x124-146600019.1"></a></span>
</div>
<!--l. 80--><p class="indent" >   This declares that every <tt>ship</tt> is an object with ﬁve named components. The
evaluation of this form does several things:
      <ul class="itemize1">
      <li class="itemize">It deﬁnes <tt>ship-x-position</tt> to be a function of one argument, a ship,
      that returns the <i>x</i>-position of the ship; <tt>ship-y-position</tt> and the other
      components are given similar function deﬁnitions. These functions are
      called the <i>access functions</i>, as they are used to access elements of the
      structure.
      </li>
      <li class="itemize">The symbol <tt>ship</tt> becomes the name of a data type of which instances
      of ships are elements. This name becomes acceptable to <tt><a 
href="symbols.html#x187-2636896r896">typep</a></tt>, for
      example; <tt>(typep x &#x2019;ship)</tt> is true if <tt>x</tt> is a ship and false if <tt>x</tt> is any
      object other than a ship.
      </li>
      <li class="itemize">A function named <tt>ship-p</tt> of one argument is deﬁned; it is a predicate
      that is true if its argument is a ship and is false otherwise.
      </li>
      <li class="itemize">A function called <tt>make-ship</tt> is deﬁned that, when invoked, will create a
      data structure with ﬁve components, suitable for use with the access
      functions. Thus executing <div class="lisp"><div class="tabbing">
                                                                          

                                                                          
      (setq ship2 (make-ship))
      <br>
      <!--l. 108--><p class="noindent" ></div>
      <!--l. 108--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-146700019.1" id="x124-146700019.1"></a></span>
      <!--l. 108--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-146800019.1" id="x124-146800019.1"></a></span>
</div>
      <!--l. 109--><p class="noindent" >sets <tt>ship2</tt> to a newly created <tt>ship</tt> object. One can specify the initial values
      of any desired component in the call to <tt>make-ship</tt> by using keyword
      arguments in this way: <div class="lisp"><div class="tabbing">
      (setq ship2 (make-ship <tt>:mass</tt> *default-ship-mass*
      <br>                                                           <tt>:x-position</tt> 0<br>
                                  <tt>:y-position</tt> 0))<br>
      <!--l. 116--><p class="noindent" ></div>
      <!--l. 116--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-146900019.1" id="x124-146900019.1"></a></span>
      <!--l. 116--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-147000019.1" id="x124-147000019.1"></a></span>
</div>
      <!--l. 117--><p class="noindent" >This constructs a new ship and initializes three of its components. This
      function is called the <i>constructor function</i> because it constructs a new
      structure.
                                                                          

                                                                          
      </li>
      <li class="itemize">The <tt>#S</tt> syntax can be used to read instances of <tt>ship</tt> structures, and a
      printer function is provided for printing out ship structures. For example,
      the value of the variable <tt>ship2</tt> shown above might be printed as
      <div class="lisp"><div class="tabbing">
      #S(ship x-position 0 y-position 0 x-velocity nil
      <br>                                                 y-velocity nil mass 170000.0)<br>
      <!--l. 129--><p class="noindent" ></div>
      <!--l. 129--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-147100019.1" id="x124-147100019.1"></a></span>
      <!--l. 129--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-147200019.1" id="x124-147200019.1"></a></span>
</div>
      </li>
      <li class="itemize">A function called <tt>copy-ship</tt> of one argument is deﬁned that, when given a
      <tt>ship</tt> object, will create a new <tt>ship</tt> object that is a copy of the given one.
      This function is called the <i>copier function</i>.
      </li>
      <li class="itemize">One may use <tt><a 
href="symbols.html#x187-2636778r778">setf</a></tt> to alter the components of a <tt>ship</tt>: <div class="lisp"><div class="tabbing">
      (setf (ship-x-position ship2) 100)
      <br>
      <!--l. 141--><p class="noindent" ></div>
      <!--l. 141--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-147300019.1" id="x124-147300019.1"></a></span>
                                                                          

                                                                          
      <!--l. 141--><p class="noindent" ><span class="paragraphHead"><a 
href="#x124-147400019.1" id="x124-147400019.1"></a></span>
</div>
      <!--l. 142--><p class="noindent" >This alters the <i>x</i>-position of <i>ship2</i> to be <tt>100</tt>. This works because <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt>
      behaves as if it generates an appropriate <tt><a 
href="symbols.html#x187-2636288r288">defsetf</a></tt> form for each access
      function.</li></ul>
<!--l. 148--><p class="indent" >   This simple example illustrates the power of <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> to provide abstract
record structures in a convenient manner. <tt><a 
href="symbols.html#x187-2636289r289">defstruct</a></tt> has many other features as
well for specialized purposes.
                                                                          

                                                                          
<!--l. 152--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse101.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html#tailstruct.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse100.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="struct.html#clmse100.html" >Up</a><tt>&#x003E;</tt></div><a 
 id="tailclmse100.html"></a>   </div> </div> 
</body></html> 
