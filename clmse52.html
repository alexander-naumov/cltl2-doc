<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Declaration Speciﬁers</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-02-20 00:42:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 493--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse53.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse51.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse51.html#tailclmse51.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse52.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse52.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">9.2   </span> <a 
 id="x66-1050009.2"></a>Declaration Speciﬁers</h3>
<!--l. 496--><p class="noindent" >Here is a list of valid declaration speciﬁers for use in <i>declare</i>. A construct is
said to be “aﬀected” by a declaration if it occurs within the scope of a
declaration.
<div class=flushdesc>
<!--l. 501--><p class="indent" >
  <div><br /><b>
<i>special</i>                                                                    </b>
<i>(special var1 var2 ...)</i> speciﬁes that all of the variables named are to be considered
special. This speciﬁer aﬀects variable bindings but also pervasively aﬀects
references. All variable bindings aﬀected are made to be dynamic bindings, and
aﬀected variable references refer to the current dynamic binding rather than to
the current local binding. For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun hack (thing *mod*)       ;The binding of the parameter
</td></tr></table>
<!--l. 511--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (special *mod*))     ; <i>*mod*</i> is visible to <i>hack1</i>,</td></tr></table>
<!--l. 512--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (hack1 (car thing)))          ; but not that of <i>thing</i></td></tr></table>
<!--l. 513--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 514--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun hack1 (arg)</td></tr></table>
<!--l. 515--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (special *mod*))     ;Declare references to <i>*mod*</i></td></tr></table>
<!--l. 516--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                ; within <i>hack1</i> to be special</td></tr></table>
<!--l. 517--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (if (atom arg) *mod*</td></tr></table>
<!--l. 518--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (cons (hack1 (car arg)) (hack1 (cdr arg)))))</td></tr></table>
<!--l. 520--><p class="indent" >
</div>
</div>
<!--l. 521--><p class="noindent" >Note that it is conventional, though not required, to give special variables names
                                                                          

                                                                          
that begin and end with an asterisk.
<!--l. 524--><p class="indent" >  A <i>special</i> declaration does not aﬀect bindings pervasively. Inner bindings of a
variable implicitly shadow a <i>special</i> declaration and must be explicitly re-declared
to be special. (However, a <i>special</i> proclamation does pervasively aﬀect bindings;
this exception is made for reasons of convenience and compatibility with
MacLisp.) For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(special x))     ;<i>x</i> is always special
</td></tr></table>
<!--l. 533--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 534--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun example (x y)</td></tr></table>
<!--l. 535--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (special y))</td></tr></table>
<!--l. 536--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((y 3) (x (* x 2)))</td></tr></table>
<!--l. 537--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (print (+ y (locally (declare (special y)) y)))</td></tr></table>
<!--l. 538--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (let ((y 4)) (declare (special y)) (foo x))))</td></tr></table>
<!--l. 540--><p class="indent" >
</div>
</div>
<!--l. 541--><p class="noindent" >In the contorted code above, the outermost and innermost bindings of <i>y</i> are special
and therefore dynamically scoped, but the middle binding is lexically scoped.
The two arguments to <i>+</i> are diﬀerent, one being the value, which is <i>3</i>,
of the lexically bound variable <i>y</i>, and the other being the value of the
special variable named <i>y</i> (a binding of which happens, coincidentally, to
lexically surround it at an outer level). All the bindings of <i>x</i> and references
to <i>x</i> are special, however, because of the proclamation that <i>x</i> is always
<i>special</i>.
<!--l. 551--><p class="indent" >  As a matter of style, use of <i>special</i> proclamations should be avoided. The <i>defvar</i>
and <i>defparameter</i> macros are the conventional means for proclaiming special
variables in a program.
  <br /><b>
<i>type</i>                                                                      </b><i>(type
type var1 var2 ...)</i> aﬀects only variable bindings and speciﬁes that the variables
mentioned will take on values only of the speciﬁed type. In particular, values
assigned to the variables by <i>setq</i>, as well as the initial values of the variables, must
be of the speciﬁed type.
                                                                          

                                                                          
<div class=new>
<!--l. 565--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to alter the interpretation of type
declarations. They are not to be construed to aﬀect “only variable bindings.”
The new rule for a declaration of a variable to have a speciﬁed type is
threefold:
     <ul class="itemize1">
     <li class="itemize">It is an error if, during the execution of any reference to that variable
     within the scope of the declaration, the value of the variable is not of
     the declared type.
     </li>
     <li class="itemize">It is an error if, during the execution of a <i>setq</i> of that variable within
     the scope of the declaration, the new value for the variable is not of the
     declared type.
     </li>
     <li class="itemize">It is an error if, at any moment that execution enters the scope of the
     declaration, the value of the variable is not of the declared type.</li></ul>
<!--l. 582--><p class="noindent" >One may think of a type declaration <i>(declare (type face bodoni))</i> as implicitly
changing every reference to <i>bodoni</i> within the scope of the declaration to <i>(the face
bodoni)</i>; changing every expression exp assigned to <i>bodoni</i> within the scope of the
declaration to <i>(the face exp)</i>; and implicitly executing <i>(the face bodoni)</i> every
time execution enters the scope of the declaration.
<!--l. 589--><p class="indent" >  These new rules make type declarations much more useful. Under ﬁrst edition
rules, a type declaration was useless if not associated with a variable binding;
declarations such as in <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(locally
</td></tr></table>
<!--l. 593--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (type (byte 8) x y))</td></tr></table>
<!--l. 594--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (+ x y))</td></tr></table>
<!--l. 596--><p class="indent" >
</div>
</div>
<!--l. 597--><p class="noindent" >at best had no eﬀect and at worst were erroneous, depending on one&#x2019;s interpretation
of the ﬁrst edition. Under the interpretation approved by X3J13, such declarations
have “the obvious natural interpretation.”
                                                                          

                                                                          
<!--l. 601--><p class="indent" >  X3J13 noted that if nested type declarations refer to the same variable, then all
of them have eﬀect; the value of the variable must be a member of the intersection
of the declared types.
<!--l. 605--><p class="indent" >  Nested type declarations could occur as a result of either macro expansion or
carefully crafted code. There are three cases. First, the inner type might be a
subtype of the outer one: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun compare (apples oranges)
</td></tr></table>
<!--l. 609--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (type number apples oranges))</td></tr></table>
<!--l. 610--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (cond ((typep apples &#x2019;ﬁxnum)</td></tr></table>
<!--l. 611--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ;; The programmer happens to know that, thanks to</td></tr></table>
<!--l. 612--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ;; constraints imposed by the caller, if APPLES</td></tr></table>
<!--l. 613--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ;; is a ﬁxnum, then ORANGES will be also, and</td></tr></table>
<!--l. 614--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ;; therefore wishes to avoid the unnecessary cost</td></tr></table>
<!--l. 615--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ;; of checking ORANGES.  Nevertheless the compiler</td></tr></table>
<!--l. 616--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         ;; should be informed to allow it to optimize code.</td></tr></table>
<!--l. 617--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (locally (declare (type ﬁxnum apples oranges)))</td></tr></table>
<!--l. 618--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                  ;; Maybe the compiler could have ﬁgured</td></tr></table>
<!--l. 619--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                  ;; out by ﬂow analysis that APPLES must</td></tr></table>
<!--l. 620--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                  ;; be a ﬁxnum here, but it doesn&#x2019;t hurt</td></tr></table>
<!--l. 621--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                  ;; to say it explicitly.</td></tr></table>
<!--l. 622--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           (&#x003C; apples oranges)))</td></tr></table>
<!--l. 623--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        ((or (complex apples)</td></tr></table>
<!--l. 624--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (complex oranges))</td></tr></table>
<!--l. 625--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (error &#x0022;Not yet implemented.  Sorry.&#x0022;))</td></tr></table>
<!--l. 626--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        ...))</td></tr></table>
<!--l. 628--><p class="indent" >
</div>
</div>
<!--l. 629--><p class="noindent" >This is the case most likely to arise in code written completely by hand.
<!--l. 631--><p class="indent" >  Second, the outer type might be a subtype of the inner one. In this case the
inner declaration has no additional practical eﬀect, but it is harmless. This is
likely to occur if code declares a variable to be of a very speciﬁc type and
then passes it to a macro that then declares it to be of a less speciﬁc
type.
                                                                          

                                                                          
<!--l. 638--><p class="indent" >  Third, the inner and outer declarations might be for types that overlap, neither
being a subtype of the other. This is likely to occur only as a result of macro
expansion. For example, user code might declare a variable to be of type <i>integer</i>,
and a macro might later declare it to be of type <i>(or ﬁxnum package)</i>; in this case
a compiler could intersect the two types to determine that in this instance the
variable may hold only ﬁxnums.
<!--l. 646--><p class="indent" >  The reader should note that the following code fragment is, perhaps
astonishingly, not in error under the interpretation approved by X3J13: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((james .007)
</td></tr></table>
<!--l. 650--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (maxwell 86))</td></tr></table>
<!--l. 651--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (ﬂet ((spy-swap ()</td></tr></table>
<!--l. 652--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           (rotatef james maxwell)))</td></tr></table>
<!--l. 653--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (locally (declare (integer maxwell))</td></tr></table>
<!--l. 654--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (spy-swap)</td></tr></table>
<!--l. 655--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (view-movie &#x0022;The Sound of Music&#x0022;)</td></tr></table>
<!--l. 656--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (spy-swap)</td></tr></table>
<!--l. 657--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      maxwell)))</td></tr></table>
<!--l. 658--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ 86  (after a couple of hours of Julie Andrews)</td></tr></table>
<!--l. 660--><p class="indent" >
</div>
</div>
<!--l. 661--><p class="noindent" >The variable <i>maxwell</i> is declared to be an integer over the scope of the type
declaration, not over its extent. Indeed <i>maxwell</i> takes on the non-integer value
<i>.007</i> while the Trapp family make their escape, but because no reference to
<i>maxwell</i> within the scope of the declaration ever produces a non-integer value, the
code is correct.
<!--l. 669--><p class="indent" >  Now the assignment to <i>maxwell</i> during the ﬁrst call to <i>spy-swap</i>, and the
reference to <i>maxwell</i> during the second call, do involve non-integer values, but
they occur within the body of <i>spy-swap</i>, which is not in the scope of the type
declaration! One could put the declaration in a diﬀerent place so as to include
<i>spy-swap</i> in the scope: <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((james .007)
</td></tr></table>
<!--l. 676--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (maxwell 86))</td></tr></table>
<!--l. 677--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (locally (declare (integer maxwell))</td></tr></table>
<!--l. 678--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (ﬂet ((spy-swap ()</td></tr></table>
<!--l. 679--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (rotatef james maxwell)))</td></tr></table>
<!--l. 680--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (spy-swap)                                   ;Bug!</td></tr></table>
<!--l. 681--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (view-movie &#x0022;The Sound of Music&#x0022;)</td></tr></table>
<!--l. 682--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (spy-swap)</td></tr></table>
<!--l. 683--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      maxwell)))</td></tr></table>
<!--l. 685--><p class="indent" >
</div>
</div>
<!--l. 686--><p class="noindent" >and then the code is indeed in error.
</div>
<div class=new>
<!--l. 690--><p class="indent" >  X3J13 also voted in January 1989 ⟨<b>?</b>⟩ to alter the meaning of the <i>function</i> type
speciﬁer when used in <i>type</i> declarations (see section <a 
href="clmse22.html#x31-490004.5">4.5<!--tex4ht:ref: SPECIALIZED-TYPE-SPECIFIER-SECTION --></a>).
</div>
  <br /><b>
type                                                                      </b><i>(type
var1 var2 ...)</i> is an abbreviation for <i>(type type var1 var2 ...)</i>, provided that type is
one of the symbols appearing in table <a 
href="clmse19.html#x28-460011">4.1<!--tex4ht:ref: TYPE-SYMBOLS-TABLE --></a>.
<div class=new>
<!--l. 706--><p class="indent" >  Observe that this covers the particularly common case of declaring numeric
variables: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declare (single-ﬂoat mass dx dy dz)
</td></tr></table>
<!--l. 709--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (double-ﬂoat acceleration sum))</td></tr></table>
<!--l. 711--><p class="indent" >
</div>
</div>
<!--l. 712--><p class="noindent" >In many implementations there is also some advantage to declaring variables to have
                                                                          

                                                                          
certain specialized vector types such as <i>base-string</i>.
</div>
  <br /><b>
<i>ftype</i>                                                                      </b><i>(ftype
type function-name-1 function-name-2 ...)</i> speciﬁes that the named functions will
be of the functional type type, an example of which follows. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declare (ftype (function (integer list) t) nth)
</td></tr></table>
<!--l. 722--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (ftype (function (number) ﬂoat) sin cos))</td></tr></table>
<!--l. 724--><p class="indent" >
</div>
</div>
<!--l. 725--><p class="noindent" >Note that rules of lexical scoping are observed; if one of the functions mentioned has
a lexically apparent local deﬁnition (as made by <i>ﬂet</i> or <i>labels</i>), then the
declaration applies to that local deﬁnition and not to the global function
deﬁnition.
<div class=newer>
<!--l. 731--><p class="indent" >  X3J13 voted in March 1989 ⟨<b>?</b>⟩ to extend <i>ftype</i> declaration speciﬁers to accept
any function-name (a symbol or a list whose car is <i>setf </i>—see section <a 
href="clmse35.html#x47-770007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>). Thus
one may write <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declaim (ftype (function (list) t) (setf cadr)))
</td></tr></table>
<!--l. 738--><p class="indent" >
</div>
</div>
<!--l. 739--><p class="noindent" >to indicate the type of the <i>setf </i> expansion function for <i>cadr</i>.
</div>
<div class=new>
<!--l. 743--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to alter the meaning of the <i>function</i> type
speciﬁer when used in <i>ftype</i> declarations (see section <a 
href="clmse22.html#x31-490004.5">4.5<!--tex4ht:ref: SPECIALIZED-TYPE-SPECIFIER-SECTION --></a>).
</div></div>
                                                                          

                                                                          
</div>
<div class=obsolete>
<div class=flushdesc>
<!--l. 753--><p class="indent" >
  <div><br /><b>
<i>function</i>                                                                  </b>
<i>(function name arglist result-type1 result-type2 ...)</i> is entirely equivalent to <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>(ftype (function arglist result-type1 result-type2 ...) name)</i>
</td></tr></table>
<!--l. 758--><p class="indent" >
</div>
</div>
<!--l. 759--><p class="noindent" >but may be more convenient for some purposes. For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declare (function nth (integer list) t)
</td></tr></table>
<!--l. 762--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (function sin (number) ﬂoat)</td></tr></table>
<!--l. 763--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (function cos (number) ﬂoat))</td></tr></table>
<!--l. 765--><p class="indent" >
</div>
</div>
<!--l. 766--><p class="noindent" >The syntax mildly resembles that of <i>defun</i>: a function-name, then an argument list,
then a speciﬁcation of results.
<!--l. 769--><p class="indent" >  Note that rules of lexical scoping are observed; if one of the functions mentioned
has a lexically apparent local deﬁnition (as made by <i>ﬂet</i> or <i>labels</i>), then the
declaration applies to that local deﬁnition and not to the global function
deﬁnition.</div>
</div>
</div>
<div class=new>
                                                                          

                                                                          
<!--l. 777--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to remove this interpretation of the <i>function</i>
declaration speciﬁer from the language. Instead, a declaration speciﬁer <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(function var1 var2 ...)
</td></tr></table>
<!--l. 784--><p class="indent" >
</div>
</div>
<!--l. 785--><p class="noindent" >is to be treated simply as an abbreviation for <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(type function var1 var2 ...)
</td></tr></table>
<!--l. 788--><p class="indent" >
</div>
</div>
<!--l. 789--><p class="noindent" >just as for all other symbols appearing in table <a 
href="clmse19.html#x28-460011">4.1<!--tex4ht:ref: TYPE-SYMBOLS-TABLE --></a>.
<!--l. 791--><p class="indent" >   X3J13 noted that although <i>function</i> appears in table <a 
href="clmse19.html#x28-460011">4.1<!--tex4ht:ref: TYPE-SYMBOLS-TABLE --></a>, the ﬁrst edition also
discussed it explicitly, with a diﬀerent meaning, without noting whether the
diﬀering interpretation was to replace or augment the interpretation regarding
table <a 
href="clmse19.html#x28-460011">4.1<!--tex4ht:ref: TYPE-SYMBOLS-TABLE --></a>. Unfortunately there is an ambiguous case: the declaration <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declare (function foo nil string))
</td></tr></table>
<!--l. 800--><p class="indent" >
</div>
</div>
<!--l. 801--><p class="noindent" >can be construed to abbreviate either <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declare (ftype (function () string) foo))
</td></tr></table>
<!--l. 804--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 805--><p class="noindent" >or <div class=lisp>  <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declare (type function foo nil string))
</td></tr></table>
<!--l. 808--><p class="indent" >
</div>
</div>
<!--l. 809--><p class="noindent" >The latter could perhaps be rejected on semantic grounds: it would be an error to
declare <i>nil</i>, a constant, to be of type <i>function</i>. In any case, X3J13 determined that
the ice was too thin here; the possibility of confusion is not worth the convenience
of an abbreviation for <i>ftype</i> declarations. The change also makes the language
more consistent.
</div>
<div class=flushdesc>
<!--l. 818--><p class="indent" >
  <div><br /><b>
<i>inline</i>                                                                     </b>
<i>(inline function1 function2 ...)</i> speciﬁes that it is desirable for the compiler
to open-code calls to the speciﬁed functions; that is, the code for a speciﬁed
function should be integrated into the calling routine, appearing in-line in
place  of  a  procedure  call.  This  may  achieve  extra  speed  at  the  expense
of debuggability (calls to functions compiled in-line cannot be traced, for
example). This declaration is pervasive. Remember that a compiler is free to
ignore this declaration.
<!--l. 830--><p class="indent" >  Note that rules of lexical scoping are observed; if one of the functions
mentioned has a lexically apparent local deﬁnition (as established by <i>ﬂet</i> or
<i>labels</i>), then the declaration applies to that local deﬁnition and not to the
global function deﬁnition.
<div class=newer>
<!--l. 836--><p class="indent" >  X3J13 voted in October 1988 ⟨<b>?</b>⟩ to clarify that during compilation the <i>inline</i>
declaration speciﬁer serves two distinct purposes: it indicates not only that
aﬀected calls to the speciﬁed functions should be expanded in-line, but also that
aﬀected deﬁnitions of the speciﬁed functions must be recorded for possible use in
performing such expansions.
                                                                          

                                                                          
<!--l. 843--><p class="indent" >  Looking at it the other way, the compiler is not required to save function
deﬁnitions against the possibility of future expansions unless the functions have
already been proclaimed to be <i>inline</i>. If a function is proclaimed (or declaimed)
<i>inline</i> before some call to that function but the current deﬁnition of that
function was established before the proclamation was processed, it is
implementation-dependent whether that call will be expanded in-line. (Of
course, it is implementation-dependent anyway, because a compiler is
always free to ignore <i>inline</i> declaration speciﬁers. However, the intent of
the committee is clear: for best results, the user is advised to put any
<i>inline</i> proclamation of a function before any deﬁnition of or call to that
function.)
<!--l. 857--><p class="indent" >  Consider these examples: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun huey (x) (+ x 100))         ;Compiler need not remember this
</td></tr></table>
<!--l. 859--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declaim (inline huey dewey))</td></tr></table>
<!--l. 860--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun dewey (y) (huey (sqrt y)))  ;Call to <i>huey</i> unlikely to be expanded</td></tr></table>
<!--l. 861--><p class="indent" >    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun louie (z) (dewey (/ z)))    ;Call to <i>dewey</i> likely to be expanded</td></tr></table>
<!--l. 863--><p class="indent" >
</div>
</div>
<!--l. 866--><p class="indent" >  X3J13 voted in March 1989 ⟨<b>?</b>⟩ to extend <i>inline</i> declaration speciﬁers to accept
any function-name (a symbol or a list whose car is <i>setf </i>—see section <a 
href="clmse35.html#x47-770007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>). Thus
one may write <i>(declare (inline (setf cadr)))</i> to indicate that the <i>setf </i> expansion
function for <i>cadr</i> should be compiled in-line.
</div>
  <br /><b>
<i>notinline</i>                                                                 </b>
<i>(notinline function1 function2 ...)</i> speciﬁes that it is undesirable to compile the
speciﬁed functions in-line. This declaration is pervasive. A compiler is not free to
ignore this declaration.
<!--l. 881--><p class="indent" >  Note that rules of lexical scoping are observed; if one of the functions mentioned
has a lexically apparent local deﬁnition (as made by <i>ﬂet</i> or <i>labels</i>), then the
declaration applies to that local deﬁnition and not to the global function
                                                                          

                                                                          
deﬁnition.
<div class=newer>
<!--l. 887--><p class="indent" >  X3J13 voted in March 1989 ⟨<b>?</b>⟩ to extend <i>notinline</i> declaration speciﬁers to
accept any function-name (a symbol or a list whose car is <i>setf </i>—see section <a 
href="clmse35.html#x47-770007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>).
Thus one may write <i>(declare (notinline (setf cadr)))</i> to indicate that the <i>setf </i>
expansion function for <i>cadr</i> should not be compiled in-line.
</div>
<div class=new>
<!--l. 897--><p class="indent" >  X3J13 voted in January 1989 ⟨<b>?</b>⟩ to clarify that the proper way to deﬁne a
function <i>gnards</i> that is not <i>inline</i> by default, but for which a local declaration
<i>(declare (inline gnards))</i> has half a chance of actually compiling <i>gnards</i> in-line, is
as follows: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declaim (inline gnards))
</td></tr></table>
<!--l. 904--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 905--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun gnards ...)</td></tr></table>
<!--l. 906--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 907--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declaim (notinline gnards))</td></tr></table>
<!--l. 909--><p class="indent" >
</div>
</div>
<!--l. 910--><p class="noindent" >The point is that the ﬁrst declamation informs the compiler that the deﬁnition of
<i>gnards</i> may be needed later for in-line expansion, and the second declamation
prevents any expansions unless and until it is overridden.
<!--l. 915--><p class="indent" >  While an implementation is never required to perform in-line expansion, many
implementations that do support such expansion will not process <i>inline</i> requests
successfully unless deﬁnitions are written with these proclamations in the manner
shown above.
</div>
  <br /><b>
<i>ignore</i>                                                                    </b>
<i>(ignore var1 var2 ... varn)</i> aﬀects only variable bindings and speciﬁes that the
bindings of the speciﬁed variables are never used. It is desirable for a compiler to
issue a warning if a variable so declared is ever referred to or is also declared
                                                                          

                                                                          
special, or if a variable is lexical, never referred to, and not declared to be
ignored.
  <br /><b>
<i>optimize</i>                                                                  </b>
<i>(optimize (quality1 value1) (quality2 value2)...)</i> advises the compiler that each
quality should be given attention according to the speciﬁed corresponding value.
A quality is a symbol; standard qualities include <i>speed</i> (of the object
code), <i>space</i> (both code size and run-time space), <i>safety</i> (run-time error
checking), and <i>compilation-speed</i> (speed of the compilation process). <div class=newer> X3J13
voted in October 1988 ⟨<b>?</b>⟩ to add the standard quality <i>debug</i> (ease of
debugging).
</div> Other qualities may be recognized by particular implementations. A value should
be a non-negative integer, normally in the range <i>0</i> to <i>3</i>. The value <i>0</i> means that
the quality is totally unimportant, and <i>3</i> that the quality is extremely important;
<i>1</i> and <i>2</i> are intermediate values, with <i>1</i> the “normal” or “usual” value. One may
abbreviate <i>(quality 3)</i> to simply quality. This declaration is pervasive. For
example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun often-used-subroutine (x y)
</td></tr></table>
<!--l. 951--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (optimize (safety 2)))</td></tr></table>
<!--l. 952--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (error-check x y)</td></tr></table>
<!--l. 953--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (hairy-setup x)</td></tr></table>
<!--l. 954--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (do ((i 0 (+ i 1))</td></tr></table>
<!--l. 955--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (z x (cdr z)))</td></tr></table>
<!--l. 956--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ((null z) i)</td></tr></table>
<!--l. 957--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ;; This inner loop really needs to burn.</td></tr></table>
<!--l. 958--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (declare (optimize speed))</td></tr></table>
<!--l. 959--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (declare (ﬁxnum i))</td></tr></table>
<!--l. 960--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    )))</td></tr></table>
<!--l. 962--><p class="indent" >
</div>
</div>
  <br /><b>
                                                                          

                                                                          
<i>declaration</i>                                                                </b>
<i>(declaration name1 name2 ...)</i> advises the compiler that each namej is a valid but
non-standard declaration name. The purpose of this is to tell one compiler not to
issue warnings for declarations meant for another compiler or other program
processor.
<div class=obsolete>
<!--l. 971--><p class="indent" >  This kind of declaration may be used only as a proclamation. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(declaration author
</td></tr></table>
<!--l. 974--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                        target-language</td></tr></table>
<!--l. 975--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                        target-machine))</td></tr></table>
<!--l. 976--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 977--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(target-language ada))</td></tr></table>
<!--l. 978--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 979--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(target-machine IBM-650))</td></tr></table>
<!--l. 981--><p class="indent" >
</div>
</div>
<!--l. 982--><p class="noindent" >
                                                                          

                                                                          
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun strangep (x)
</td></tr></table>
<!--l. 984--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (author &#x0022;Harry Tweeker&#x0022;))</td></tr></table>
<!--l. 985--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (member x &#x2019;(strange weird odd peculiar)))</td></tr></table>
<!--l. 987--><p class="indent" >
</div>
</div>
</div>
<div class=newer>
<!--l. 991--><p class="indent" >  X3J13 voted in June 1989 ⟨<b>?</b>⟩ to introduce the new macro <i>declaim</i>, which is
guaranteed to be recognized appropriately by the compiler and is often more
convenient than <i>proclaim</i> for establishing global declarations.
<!--l. 996--><p class="indent" >  The <i>declaration</i> declaration speciﬁer may be used with <i>declaim</i> as well as
<i>proclaim</i>. The preceding examples would be better written using <i>declaim</i>, to
ensure that the compiler will process them properly.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declaim (declaration author
</td></tr></table>
<!--l. 1001--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                      target-language</td></tr></table>
<!--l. 1002--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                      target-machine))</td></tr></table>
<!--l. 1003--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1004--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declaim (target-language ada)</td></tr></table>
<!--l. 1005--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (target-machine IBM-650))</td></tr></table>
<!--l. 1006--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1007--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun strangep (x)</td></tr></table>
<!--l. 1008--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (author &#x0022;Harry Tweeker&#x0022;))</td></tr></table>
<!--l. 1009--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (member x &#x2019;(strange weird odd peculiar)))</td></tr></table>
<!--l. 1011--><p class="indent" >
</div>
                                                                          

                                                                          
</div>
</div>
</div>
</div>
<div class=newer>
<!--l. 1016--><p class="indent" >   X3J13 voted in March 1989 ⟨<b>?</b>⟩ to introduce a new declaration speciﬁer
<i>dynamic-extent</i> for variables, and voted in June 1989 ⟨<b>?</b>⟩ to extend it to handle
function-names as well. <div class=flushdesc>
  <div><br /><b>
<i>dynamic-extent</i>                                                           </b>
<i>
<!--l. 1023--><p class="indent" >  (dynamic-extent item1 item2 ... itemn)</i> declares that certain variables or
function-names  refer  to  data  objects  whose  extents  may  be  regarded  as
dynamic; that is, the declaration may be construed as a guarantee on the part
of the programmer that the program will behave correctly even if the data
objects have only dynamic extent rather than the usual indeﬁnite extent.
<!--l. 1030--><p class="indent" >  Each item may be either a variable name or <i>(function f )</i> where f is a
function-name (see section <a 
href="clmse35.html#x47-770007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>). (Of course, <i>(function f )</i> may be abbreviated
in the usual way as <i>#&#x2019;f </i>.)
<!--l. 1035--><p class="indent" >  It is permissible for an implementation simply to ignore this declaration.
In implementations that do not ignore it, the compiler (or interpreter) is
free to make whatever optimizations are appropriate given this information;
the most common optimization is to stack-allocate the initial value of the
object. The data types that can be optimized in this manner may vary from
implementation to implementation.
<!--l. 1042--><p class="indent" >  The meaning of this declaration can be stated more precisely. We say
that object x is an otherwise inaccessible part of y if and only if making
y  inaccessible  would  make  x  inaccessible.  (Note  that  every  object  is  an
otherwise inaccessible part of itself.) Now suppose that construct c contains
a <i>dynamic-extent</i> declaration for variable (or function) v (which need not be
bound by c). Consider the values w<sub>1</sub>,…,w<sub>n</sub> taken on by v during the course
of some execution of c. The declaration asserts that if some object x is an
otherwise inaccessible part of w<sub>j</sub> whenever w<sub>j</sub> becomes the value of v, then
just after execution of c terminates x will be either inaccessible or still an
otherwise inaccessible part of the value of v. If this assertion is ever violated,
the consequences are undeﬁned.
                                                                          

                                                                          
<!--l. 1058--><p class="indent" >  In  some  implementations,  it  is  possible  to  allocate  data  structures  in
a  way  that  will  make  them  easier  to  reclaim  than  by  general-purpose
garbage collection (for example, on the stack or in some temporary area).
The <i>dynamic-extent</i> declaration is designed to give the implementation the
information necessary to exploit such techniques.
<!--l. 1065--><p class="indent" >  For example, in the code fragment <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((x (list &#x2019;a1 &#x2019;b1 &#x2019;c1))
</td></tr></table>
<!--l. 1067--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (y (cons &#x2019;a2 (cons &#x2019;b2 (cons &#x2019;c2 &#x2019;d2)))))</td></tr></table>
<!--l. 1068--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (dynamic-extent x y))</td></tr></table>
<!--l. 1069--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 1071--><p class="indent" >
</div>
</div>
<!--l. 1072--><p class="noindent" >it is not diﬃcult to prove that the otherwise inaccessible parts of <i>x</i> include the three
conses constructed by <i>list</i>, and that the otherwise inaccessible parts of <i>y</i> include
three other conses manufactured by the three calls to <i>cons</i>. Given the
presence of the <i>dynamic-extent</i> declaration, a compiler would be justiﬁed in
stack-allocating these six conses and reclaiming their storage on exit from the <i>let</i>
form.
<!--l. 1080--><p class="indent" >  Since stack allocation of the initial value entails knowing at the object&#x2019;s
creation time that the object can be stack-allocated, it is not generally useful to
declare <i>dynamic-extent</i> for variables that have no lexically apparent initial value.
For example, <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun f ()
</td></tr></table>
<!--l. 1085--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((x (list 1 2 3)))</td></tr></table>
<!--l. 1086--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (declare (dynamic-extent x))</td></tr></table>
<!--l. 1087--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ...))</td></tr></table>
<!--l. 1089--><p class="indent" >
</div>
</div>
<!--l. 1090--><p class="noindent" >would permit a compiler to stack-allocate the list in <i>x</i>. However, <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun g (x) (declare (dynamic-extent x)) ...)
</td></tr></table>
<!--l. 1093--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun f () (g (list 1 2 3)))</td></tr></table>
<!--l. 1095--><p class="indent" >
</div>
</div>
<!--l. 1096--><p class="noindent" >could not typically permit a similar optimization in <i>f </i> because of the possibility of
later redeﬁnition of <i>g</i>. Only an implementation careful enough to recompile <i>f </i> if
the deﬁnition of <i>g</i> were to change incompatibly could stack-allocate the list
argument to <i>g</i> in <i>f </i>.
<!--l. 1102--><p class="indent" >  Other interesting cases are <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(declaim (inline g))
</td></tr></table>
<!--l. 1104--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun g (x) (declare (dynamic-extent x)) ...)</td></tr></table>
<!--l. 1105--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun f () (g (list 1 2 3)))</td></tr></table>
<!--l. 1107--><p class="indent" >
</div>
</div>
<!--l. 1108--><p class="noindent" >and <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun f ()
</td></tr></table>
<!--l. 1110--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (ﬂet ((g (x) (declare (dynamic-extent x)) ...))</td></tr></table>
<!--l. 1111--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (g (list 1 2 3))))</td></tr></table>
<!--l. 1113--><p class="indent" >
</div>
</div>
<!--l. 1114--><p class="noindent" >In each case some compilers might realize the optimization is possible and others
might not.
<!--l. 1117--><p class="indent" >  An interesting variant of this is the so-called stack-allocated rest list, which
can be achieved (in implementations supporting the optimization) by <div class=lisp>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun f (&#x0026;rest x)
</td></tr></table>
<!--l. 1120--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (dynamic-extent x))</td></tr></table>
<!--l. 1121--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 1123--><p class="indent" >
</div>
</div>
<!--l. 1124--><p class="noindent" >Note here that although the initial value of <i>x</i> is not explicitly present, nevertheless
in the usual implementation strategy the function <i>f </i> is responsible for assembling
the list for <i>x</i> from the passed arguments, so the <i>f </i> function can be optimized by a
compiler to construct a stack-allocated list instead of a heap-allocated
list.
<!--l. 1130--><p class="indent" >  Some Common Lisp functions take other functions as arguments; frequently the
argument function is a so-called downward funarg, that is, a functional argument
that is passed only downward and whose extent may therefore be dynamic. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ﬂet ((gd (x) (atan (sinh x))))
</td></tr></table>
<!--l. 1134--><p class="indent" >      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (dynamic-extent #&#x2019;gd))     ;<i>mapcar</i> won&#x2019;t hang on to <i>gd</i></td></tr></table>
<!--l. 1135--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (mapcar #&#x2019;gd my-list-of-numbers))</td></tr></table>
<!--l. 1137--><p class="indent" >
</div>
</div>
<!--l. 1140--><p class="indent" >  The following three examples are in error, since in each case the value of <i>x</i> is
used outside of its extent. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(length (let ((x (list 1 2 3)))
</td></tr></table>
<!--l. 1144--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (declare (dynamic-extent x))</td></tr></table>
<!--l. 1145--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          x))                                    ;Wrong</td></tr></table>
<!--l. 1147--><p class="indent" >
</div>
                                                                          

                                                                          
</div>
<!--l. 1148--><p class="noindent" >The preceding code is obviously incorrect, because the cons cells making up the list
in <i>x</i> might be deallocated (thanks to the declaration) before <i>length</i> is called. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(length (list (let ((x (list 1 2 3)))
</td></tr></table>
<!--l. 1152--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                (declare (dynamic-extent x))</td></tr></table>
<!--l. 1153--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                x)))                             ;Wrong</td></tr></table>
<!--l. 1155--><p class="indent" >
</div>
</div>
<!--l. 1156--><p class="noindent" >In this second case it is less obvious that the code is incorrect, because one might
argue that the cons cells making up the list in <i>x</i> have no eﬀect on the
result to be computed by <i>length</i>. Nevertheless the code brieﬂy violates
the assertion implied by the declaration and is therefore incorrect. (It is
not diﬃcult to imagine a perfectly sensible implementation of a garbage
collector that might become confused by a cons cell containing a dangling
pointer to a list that was once stack-allocated but then deallocated.) <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(progn (let ((x (list 1 2 3)))
</td></tr></table>
<!--l. 1166--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (declare (dynamic-extent x))</td></tr></table>
<!--l. 1167--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         x)                                      ;Wrong</td></tr></table>
<!--l. 1168--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (print &#x0022;Six dollars is your change have a nice day NEXT!&#x0022;))</td></tr></table>
<!--l. 1170--><p class="indent" >
</div>
</div>
<!--l. 1171--><p class="noindent" >In this third case it is even less obvious that the code is incorrect, because
the value of <i>x</i> returned from the <i>let</i> construct is discarded right away
by the <i>progn</i>. Indeed it is, but “right away” isn&#x2019;t fast enough. The code
brieﬂy violates the assertion implied by the declaration and is therefore
incorrect. (If the code is being interpreted, the interpreter might hang
on to the value returned by the <i>let</i> for some time before it is eventually
                                                                          

                                                                          
discarded.)
<!--l. 1180--><p class="indent" >  Here is one last example, one that has little practical import but is theoretically
quite instructive. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(dotimes (j 10)
</td></tr></table>
<!--l. 1183--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (dynamic-extent j))</td></tr></table>
<!--l. 1184--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setq foo 3)                     ;Correct</td></tr></table>
<!--l. 1185--><p class="indent" >     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setq foo j))                    ;Erroneous—but why? (see text)</td></tr></table>
<!--l. 1187--><p class="indent" >
</div>
</div>
<!--l. 1188--><p class="noindent" >Since <i>j</i> is an integer by the deﬁnition of <i>dotimes</i>, but <i>eq</i> and <i>eql</i> are not necessarily
equivalent for integers, what are the otherwise inaccessible parts of <i>j</i>, which this
declaration requires the body of the <i>dotimes</i> not to “save”? If the value of <i>j</i> is <i>3</i>,
and the body does <i>(setq foo 3)</i>, is that an error? The answer is no, but the
interesting thing is that it depends on the implementation-dependent behavior of
<i>eq</i> on numbers. In an implementation where <i>eq</i> and <i>eql</i> are equivalent for <i>3</i>, then
<i>3</i> is not an otherwise inaccessible part because <i>(eq j (+ 2 1))</i> is true, and
therefore there is another way to access the object besides going through <i>j</i>. On
the other hand, in an implementation where <i>eq</i> and <i>eql</i> are not equivalent for <i>3</i>,
then the particular <i>3</i> that is the value of <i>j</i> is an otherwise inaccessible part, but
any other <i>3</i> is not. Thus <i>(setq foo 3)</i> is valid but <i>(setq foo j)</i> is erroneous.
Since <i>(setq foo j)</i> is erroneous in some implementations, it is erroneous
in all portable programs, but some other implementations may not be
able to detect the error. (If this conclusion seems strange, it may help to
replace <i>3</i> everywhere in the preceding argument with some obvious bignum
such as <i>375374638837424898243</i> and to replace <i>10</i> with some even larger
bignum.)
<!--l. 1210--><p class="indent" >  The <i>dynamic-extent</i> declaration should be used with great care. It makes
possible great performance improvements in some situations, but if the user
misdeclares something and consequently the implementation returns a pointer
into the stack (or stores it in the heap), an undeﬁned situation may result and the
integrity of the Lisp storage mechanism may be compromised. Debugging these
situations may be tricky. Users who have asked for this feature have indicated a
willingness to deal with such problems; nevertheless, I do not encourage casual
                                                                          

                                                                          
users to use this declaration.</div>
</div>
</div>
<!--l. 1223--><p class="indent" >   An implementation is free to support other (implementation-dependent)
declaration speciﬁers as well. On the other hand, a Common Lisp compiler
is free to ignore entire classes of declaration speciﬁers (for example,
implementation-dependent declaration speciﬁers not supported by that compiler&#x2019;s
implementation), except for the <i>declaration</i> declaration speciﬁer. Compiler
implementors are encouraged, however, to program the compiler to issue by
default a warning if the compiler ﬁnds a declaration speciﬁer of a kind it never
uses. Such a warning is required in any case if a declaration speciﬁer is not
one of those deﬁned above and has not been declared in a <i>declaration</i>
declaration.
                                                                          

                                                                          
   <!--l. 1237--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse53.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse51.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse51.html#tailclmse51.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse52.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse52.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 1237--><p class="indent" >   <a 
 id="tailclmse52.html"></a>  
</body></html> 
