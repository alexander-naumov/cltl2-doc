<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Функции для хеш-таблиц</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-28 14:08:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 445--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse87.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#tailclmch16.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse86.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#clmse86.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">16.1   </span> <a 
href="clm.html#QQ2-107-240" id="x107-21100016.1">Функции для хеш-таблиц</a></h3>
<!--l. 447--><p class="noindent" >Данный раздел описывает функции для хеш-таблиц, которые используют
<i>объекты</i> для ключей и ассоциируют другие объекты с этими.
<div class=defun>
<!--l. 450--><p class="noindent" ><i>[Функция]</i><a 
 id="dx107-211001"></a><a 
 id="x107-211002r489"></a><b> make-hash-table</b>  &#x0026;key  <i>:test</i> <i>:size</i> <i>:rehash-size</i> <i>:rehash-threshold</i>
<!--l. 452--><p class="noindent" >Эта функция создаёт и возвращает новую хеш-таблицу. Аргумент :test
определяет как будут сравниваться ключи. Он может быть одним из трёх
значений #&#x2019;eq, #&#x2019;eql или #&#x2019;equal, или одним из трёх символов <a 
href="clmse33.html#x44-78002r44">eq</a>, <a 
href="clmse33.html#x44-78004r45">eql</a> или
<a 
href="clmse33.html#x44-78006r46">equal</a>. По-умолчанию используется <a 
href="clmse33.html#x44-78004r45">eql</a>.
<!--l. 459--><p class="indent" >   Аргумент :size устанавливает первоначальный размер хеш-таблицы в
парах. (Указанный размер может быть округлён до «хорошего» размера,
например, до первого следующего простого числа.) Вы можете не сохранять
в таблице столько пар, сколько указали. Этот аргумент служит подсказкой
для реализации о том, какое примерно число элементов вы будете хранить в
хеш-таблице.
<!--l. 466--><p class="indent" >   Аргумент :rehash-size указывает, на сколько увеличить размер
хеш-таблицы, когда она по размерам достигнет пределов. Если это целое
число, оно должно быть больше нуля, и будет означать абсолютное
приращение. Если это число с плавающей точкой, оно должно быть больше 1,
                                                                          

                                                                          
и будет означать относительное приращение к предыдущему размеру.
Значение по-умолчанию зависит от реализации.
<div class=newer>
<!--l. 474--><p class="indent" >   Аргумент :rehash-threshold указывает, насколько должна наполниться
хеш-таблица, прежде чем она будет увеличена. Он должен быть числом
типа real между 0 и 1, включительно. Он показывает максимальный
уровень заполнения хеш-таблицы. Значение по-умолчанию зависит от
реализации.
</div>
<!--l. 481--><p class="indent" >   Пример использования <a 
href="#x107-211002r489">make-hash-table</a>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-hash-table :rehash-size 1.5
</td></tr></table>
<!--l. 483--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 :size (* number-of-widgets 43))</td></tr></table>
<!--l. 485--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 488--><p class="noindent" ><i>[Функция]</i><a 
 id="dx107-211003"></a><a 
 id="x107-211004r490"></a><b> hash-table-p</b>  <i>object</i>
<!--l. 490--><p class="noindent" ><a 
href="#x107-211004r490">hash-table-p</a> возвращает истину, если аргумент является хеш-таблицей. Иначе
возвращает ложь. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-p x) <span class="math"> ≡</span> (typep x &#x2019;hash-table)
</td></tr></table>
<!--l. 495--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 498--><p class="noindent" ><i>[Функция]</i><a 
 id="dx107-211005"></a><a 
 id="x107-211006r491"></a><b> gethash</b>  <i>key</i> <i>hash-table</i> &#x0026;optional  <i>default</i>
<!--l. 500--><p class="noindent" ><a 
href="#x107-211006r491">gethash</a> ищет элемент в хеш-<i>hash-table</i>, чей ключ равен <i>key</i> и возвращает
связанное значение. Если элемент не был найден, то возвращается значение
аргумента <i>default</i>, который по-умолчанию равен <a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 505--><p class="indent" >   <a 
href="#x107-211006r491">gethash</a> возвращает два значение. Второе значение является предикатом, и
истинно, если значение было найдено, и ложно если нет.
                                                                          

                                                                          
<!--l. 508--><p class="indent" >   <a 
href="clmse36.html#x48-90002r64">setf</a> может использоваться вместе с <a 
href="#x107-211006r491">gethash</a> для создания в хеш-таблице
новых элементов. Если элемент с заданным ключом <i>key</i> уже существует, он
будет удалён перед добавлением. В этом контексте может использоваться
аргумент <i>default</i>, он игнорируется <a 
href="clmse36.html#x48-90002r64">setf</a>, но может быть полезным в таких
макросах как <a 
href="clmse64.html#x81-178014r187">incf</a>, которые связаны с <a 
href="clmse36.html#x48-90002r64">setf</a>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(incf (gethash a-key table 0))
</td></tr></table>
<!--l. 515--><p class="indent" >
</div>
</div>
<!--l. 516--><p class="noindent" >обозначает то же, что и <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table 0)
</td></tr></table>
<!--l. 518--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 520--><p class="indent" >
</div>
</div>
<!--l. 521--><p class="noindent" >что можно преобразовать в <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table)
</td></tr></table>
<!--l. 523--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 525--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 528--><p class="noindent" ><i>[Функция]</i><a 
 id="dx107-211007"></a><a 
 id="x107-211008r492"></a><b> remhash</b>  <i>key</i> <i>hash-table</i>
<!--l. 530--><p class="noindent" ><a 
href="#x107-211008r492">remhash</a> удаляет любой элемент в хеш-таблице <i>hash-table</i> ключ, которого
равен параметру <i>key</i>. Возвращает истину, если элемент был удалён, и ложь,
если элемента уже не существовало.
</div>
                                                                          

                                                                          
<div class=defun>
<!--l. 536--><p class="noindent" ><i>[Функция]</i><a 
 id="dx107-211009"></a><a 
 id="x107-211010r493"></a><b> maphash</b>  <i>function</i> <i>hash-table</i>
<!--l. 538--><p class="noindent" >Для каждого элемента в хеш-таблице <i>hash-table</i>, <a 
href="#x107-211010r493">maphash</a> вызывает функцию
<i>function</i> с двумя аргументами: ключ элемента и значение элемента. <a 
href="#x107-211010r493">maphash</a>
возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>. Если во время выполнения <a 
href="#x107-211010r493">maphash</a> в хеш-таблице
добавлялись или удалялись ключи, то результат непредсказуем, но есть
исключение: если функция <i>function</i> вызывает <a 
href="#x107-211008r492">remhash</a> для удаления
элемента, который в эту функцию и был передан, или устанавливает новое
значение с помощью <a 
href="clmse36.html#x48-90002r64">setf</a> этому элементу, то эти операции будут выполнены
правильно. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Изменение каждого элемента в MY-HASH-TABLE, с заменой на
</td></tr></table>
<!--l. 551--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; квадратный корень. Элементы с отрицательными значения удаляются.</td></tr></table>
<!--l. 552--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(maphash #&#x2019;(lambda (key val)</td></tr></table>
<!--l. 553--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (if (minusp val)</td></tr></table>
<!--l. 554--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (remhash key my-hash-table)</td></tr></table>
<!--l. 555--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (setf (gethash key my-hash-table) (sqrt val))))</td></tr></table>
<!--l. 556--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         my-hash-table)</td></tr></table>
<!--l. 558--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 561--><p class="noindent" ><i>[Функция]</i><a 
 id="dx107-211011"></a><a 
 id="x107-211012r494"></a><b> clrhash</b>  <i>hash-table</i>
<!--l. 563--><p class="noindent" >Функция удаляет все элемент из хеш-таблицы <i>hash-table</i> и возвращает эту
хеш-таблицу.
</div>
<div class=defun>
<!--l. 568--><p class="noindent" ><i>[Функция]</i><a 
 id="dx107-211013"></a><a 
 id="x107-211014r495"></a><b> hash-table-count</b>  <i>hash-table</i>
<!--l. 570--><p class="noindent" >Функция возвращает количество элементов в хеш-таблице <i>hash-table</i>. Когда
хеш-таблица только были сделана, или только что очищена, то количество
элементов равно нулю.
</div>
<div class=newer>
<div class=defun>
                                                                          

                                                                          
<!--l. 577--><p class="noindent" ><i>[Функция]</i><a 
 id="dx107-211015"></a><a 
 id="x107-211016r496"></a><b> hash-table-rehash-size</b>  <i>hash-table</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx107-211017"></a><a 
 id="x107-211018r497"></a><b> hash-table-rehash-threshold</b>  <i>hash-table</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx107-211019"></a><a 
 id="x107-211020r498"></a><b> hash-table-size</b>  <i>hash-table</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx107-211021"></a><a 
 id="x107-211022r499"></a><b> hash-table-test</b>  <i>hash-table</i>
<!--l. 582--><p class="noindent" >Добавлены функции, которые возвращают значения используемые при
вызове <a 
href="#x107-211002r489">make-hash-table</a>.
<!--l. 586--><p class="indent" >   <a 
href="#x107-211016r496">hash-table-rehash-size</a> возвращает размер приращения хеш-таблицы.
<!--l. 588--><p class="indent" >   <a 
href="#x107-211018r497">hash-table-rehash-threshold</a> возвращает текущий уровень заполнения.
<!--l. 590--><p class="indent" >   <a 
href="#x107-211020r498">hash-table-size</a> возвращает рекомендуемый размер хеш-таблицы.
<!--l. 592--><p class="indent" >   <a 
href="#x107-211022r499">hash-table-test</a> возвращает функцию сравнения используемую для ключей.
Если данная функция одна из стандартных, то результат всегда является
символом, даже если при создании хеш-таблицы было указано иное.
Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-test (make-hash-table :test #&#x2019;equal)) <span class="math"> ⇒</span> equal
</td></tr></table>
<!--l. 597--><p class="indent" >
</div>
</div>
<!--l. 598--><p class="noindent" >Реализации, которые расширяют <a 
href="#x107-211002r489">make-hash-table</a> дополнительными функциями
сравнения для аргумента :test, могут определять, как будет возвращено
значение из <a 
href="#x107-211022r499">hash-table-test</a> для этих дополнительных функций.
</div>
</div>
                                                                          

                                                                          
   <!--l. 604--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse87.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#tailclmch16.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse86.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#clmse86.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 604--><p class="indent" >   <a 
 id="tailclmse86.html"></a>  
</body></html> 
