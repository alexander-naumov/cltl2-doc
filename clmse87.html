<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Функции для хеш-таблиц</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-18 01:47:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 467--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse88.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#tailclmch16.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse87.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#clmse87.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">16.1   </span> <a 
 id="x108-21200016.1"></a>Функции для хеш-таблиц</h3>
<!--l. 469--><p class="noindent" >Данный раздел описывает функции для хеш-таблиц, которые используют
<i>объекты</i> для ключей и ассоциируют другие объекты с этими.
<div class=defun>
<!--l. 472--><p class="noindent" ><i>[Функция]</i><a 
 id="dx108-212001"></a><a 
 id="x108-212002r508"></a><b> make-hash-table</b>  &#x0026;key  <i>:test</i> <i>:size</i> <i>:rehash-size</i> <i>:rehash-threshold</i>
<!--l. 474--><p class="noindent" >Эта функция создаёт и возвращает новую хеш-таблицу. Аргумент :test
определяет как будут сравниваться ключи. Он может быть одним из трёх
значений #&#x2019;eq, #&#x2019;eql или #&#x2019;equal, или одним из трёх символов <a 
href="clmse33.html#x44-78002r44">eq</a>, <a 
href="clmse33.html#x44-78004r45">eql</a> или
<a 
href="clmse33.html#x44-78006r46">equal</a>. По-умолчанию используется <a 
href="clmse33.html#x44-78004r45">eql</a>.
<!--l. 481--><p class="indent" >   Аргумент :size устанавливает первоначальный размер хеш-таблицы в
парах. (Указанный размер может быть округлён до «хорошего» размера,
например, до первого следующего простого числа.) Вы можете не сохранять
в таблице столько пар, сколько указали. Этот аргумент служит подсказкой
для реализации о том, какое примерно число элементов вы будете хранить в
хеш-таблице.
<!--l. 488--><p class="indent" >   Аргумент :rehash-size указывает, на сколько увеличить размер
хеш-таблицы, когда она по размерам достигнет пределов. Если это целое
число, оно должно быть больше нуля, и будет означать абсолютное
                                                                          

                                                                          
приращение. Если это число с плавающей точкой, оно должно быть больше 1,
и будет означать относительное приращение к предыдущему размеру.
Значение по-умолчанию зависит от реализации.
<div class=newer>
<!--l. 496--><p class="indent" >   Аргумент :rehash-threshold указывает, насколько должна наполниться
хеш-таблица, прежде чем она будет увеличена. Он должен быть числом
типа real между 0 и 1, включительно. Он показывает максимальный
уровень заполнения хеш-таблицы. Значение по-умолчанию зависит от
реализации.
</div>
<!--l. 503--><p class="indent" >   Пример использования <a 
href="#x108-212002r508">make-hash-table</a>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-hash-table :rehash-size 1.5
</td></tr></table>
<!--l. 505--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 :size (* number-of-widgets 43))</td></tr></table>
<!--l. 507--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 510--><p class="noindent" ><i>[Функция]</i><a 
 id="dx108-212003"></a><a 
 id="x108-212004r509"></a><b> hash-table-p</b>  <i>object</i>
<!--l. 512--><p class="noindent" ><a 
href="#x108-212004r509">hash-table-p</a> возвращает истину, если аргумент является хеш-таблицей. Иначе
возвращает ложь. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-p x) <span class="math"> ≡</span> (typep x &#x2019;hash-table)
</td></tr></table>
<!--l. 517--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 520--><p class="noindent" ><i>[Функция]</i><a 
 id="dx108-212005"></a><a 
 id="x108-212006r510"></a><b> gethash</b>  <i>key</i> <i>hash-table</i> &#x0026;optional  <i>default</i>
<!--l. 522--><p class="noindent" ><a 
href="#x108-212006r510">gethash</a> ищет элемент в хеш-<i>hash-table</i>, чей ключ равен <i>key</i> и возвращает
связанное значение. Если элемент не был найден, то возвращается значение
аргумента <i>default</i>, который по-умолчанию равен <a 
href="clmse31.html#x42-74002r18">nil</a>.
                                                                          

                                                                          
<!--l. 527--><p class="indent" >   <a 
href="#x108-212006r510">gethash</a> возвращает два значение. Второе значение является предикатом, и
истинно, если значение было найдено, и ложно если нет.
<!--l. 530--><p class="indent" >   <a 
href="clmse36.html#x48-90002r64">setf</a> может использоваться вместе с <a 
href="#x108-212006r510">gethash</a> для создания в хеш-таблице
новых элементов. Если элемент с заданным ключом <i>key</i> уже существует, он
будет удалён перед добавлением. В этом контексте может использоваться
аргумент <i>default</i>, он игнорируется <a 
href="clmse36.html#x48-90002r64">setf</a>, но может быть полезным в таких
макросах как <a 
href="clmse64.html#x81-178014r187">incf</a>, которые связаны с <a 
href="clmse36.html#x48-90002r64">setf</a>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(incf (gethash a-key table 0))
</td></tr></table>
<!--l. 537--><p class="indent" >
</div>
</div>
<!--l. 538--><p class="noindent" >обозначает то же, что и <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table 0)
</td></tr></table>
<!--l. 540--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 542--><p class="indent" >
</div>
</div>
<!--l. 543--><p class="noindent" >что можно преобразовать в <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (gethash a-key table)
</td></tr></table>
<!--l. 545--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (+ (gethash a-key table 0) 1))</td></tr></table>
<!--l. 547--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 550--><p class="noindent" ><i>[Функция]</i><a 
 id="dx108-212007"></a><a 
 id="x108-212008r511"></a><b> remhash</b>  <i>key</i> <i>hash-table</i>
<!--l. 552--><p class="noindent" ><a 
href="#x108-212008r511">remhash</a> удаляет любой элемент в хеш-таблице <i>hash-table</i> ключ, которого
равен параметру <i>key</i>. Возвращает истину, если элемент был удалён, и ложь,
если элемента уже не существовало.
                                                                          

                                                                          
</div>
<div class=defun>
<!--l. 558--><p class="noindent" ><i>[Функция]</i><a 
 id="dx108-212009"></a><a 
 id="x108-212010r512"></a><b> maphash</b>  <i>function</i> <i>hash-table</i>
<!--l. 560--><p class="noindent" >Для каждого элемента в хеш-таблице <i>hash-table</i>, <a 
href="#x108-212010r512">maphash</a> вызывает функцию
<i>function</i> с двумя аргументами: ключ элемента и значение элемента. <a 
href="#x108-212010r512">maphash</a>
возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>. Если во время выполнения <a 
href="#x108-212010r512">maphash</a> в хеш-таблице
добавлялись или удалялись ключи, то результат непредсказуем, но есть
исключение: если функция <i>function</i> вызывает <a 
href="#x108-212008r511">remhash</a> для удаления
элемента, который в эту функцию и был передан, или устанавливает новое
значение с помощью <a 
href="clmse36.html#x48-90002r64">setf</a> этому элементу, то эти операции будут выполнены
правильно. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Изменение каждого элемента в MY-HASH-TABLE, с заменой на
</td></tr></table>
<!--l. 573--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; квадратный корень. Элементы с отрицательными значения удаляются.</td></tr></table>
<!--l. 574--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(maphash #&#x2019;(lambda (key val)</td></tr></table>
<!--l. 575--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (if (minusp val)</td></tr></table>
<!--l. 576--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (remhash key my-hash-table)</td></tr></table>
<!--l. 577--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (setf (gethash key my-hash-table) (sqrt val))))</td></tr></table>
<!--l. 578--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         my-hash-table)</td></tr></table>
<!--l. 580--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 583--><p class="noindent" ><i>[Функция]</i><a 
 id="dx108-212011"></a><a 
 id="x108-212012r513"></a><b> clrhash</b>  <i>hash-table</i>
<!--l. 585--><p class="noindent" >Функция удаляет все элемент из хеш-таблицы <i>hash-table</i> и возвращает эту
хеш-таблицу.
</div>
<div class=defun>
<!--l. 590--><p class="noindent" ><i>[Функция]</i><a 
 id="dx108-212013"></a><a 
 id="x108-212014r514"></a><b> hash-table-count</b>  <i>hash-table</i>
<!--l. 592--><p class="noindent" >Функция возвращает количество элементов в хеш-таблице <i>hash-table</i>. Когда
хеш-таблица только были сделана, или только что очищена, то количество
элементов равно нулю.
</div>
<div class=newer>
                                                                          

                                                                          
<div class=defun>
<!--l. 599--><p class="noindent" ><i>[Функция]</i><a 
 id="dx108-212015"></a><a 
 id="x108-212016r515"></a><b> hash-table-rehash-size</b>  <i>hash-table</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx108-212017"></a><a 
 id="x108-212018r516"></a><b> hash-table-rehash-threshold</b>  <i>hash-table</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx108-212019"></a><a 
 id="x108-212020r517"></a><b> hash-table-size</b>  <i>hash-table</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx108-212021"></a><a 
 id="x108-212022r518"></a><b> hash-table-test</b>  <i>hash-table</i>
<!--l. 604--><p class="noindent" >Добавлены функции, которые возвращают значения используемые при
вызове <a 
href="#x108-212002r508">make-hash-table</a>.
<!--l. 608--><p class="indent" >   <a 
href="#x108-212016r515">hash-table-rehash-size</a> возвращает размер приращения хеш-таблицы.
<!--l. 610--><p class="indent" >   <a 
href="#x108-212018r516">hash-table-rehash-threshold</a> возвращает текущий уровень заполнения.
<!--l. 612--><p class="indent" >   <a 
href="#x108-212020r517">hash-table-size</a> возвращает рекомендуемый размер хеш-таблицы.
<!--l. 614--><p class="indent" >   <a 
href="#x108-212022r518">hash-table-test</a> возвращает функцию сравнения используемую для ключей.
Если данная функция одна из стандартных, то результат всегда является
символом, даже если при создании хеш-таблицы было указано иное.
Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(hash-table-test (make-hash-table :test #&#x2019;equal)) <span class="math"> ⇒</span> equal
</td></tr></table>
<!--l. 619--><p class="indent" >
</div>
</div>
<!--l. 620--><p class="noindent" >Реализации, которые расширяют <a 
href="#x108-212002r508">make-hash-table</a> дополнительными функциями
сравнения для аргумента :test, могут определять, как будет возвращено
значение из <a 
href="#x108-212022r518">hash-table-test</a> для этих дополнительных функций.
</div>
</div>
                                                                          

                                                                          
   <!--l. 626--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse88.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#tailclmch16.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse87.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch16.html#clmse87.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 626--><p class="indent" >   <a 
 id="tailclmse87.html"></a>  
</body></html> 
