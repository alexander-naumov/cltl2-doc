<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Создание массива</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-06 02:11:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 1020--><p class="noindent" > <div id="main_container"> <div id="content"> <!--l. 1020--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse88.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch17.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch17.html#tailclmch17.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse87.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch17.html#clmse87.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">17.1   </span> <a 
href="clm.html#QQ2-109-241" id="x109-21300017.1">Создание массива</a></h3>
<!--l. 1022--><p class="noindent" >Не волнуйтесь о большом количестве опций для функции <tt><a 
href="#x109-213002r501">make-array</a></tt>. Все
что действительно необходимо, это список размерностей. Остальные же
опции служат для относительно эзотерических программ.
<div class=defun>
<!--l. 1026--><p class="noindent" ><i>[Функция]</i><a 
 id="dx109-213001"></a><a 
 id="x109-213002r501"></a><b> make-array</b>  <i>dimensions</i> &#x0026;key  <i>:element-type</i> <i>:initial-element</i>
<i>:initial-contents</i> <i>:adjustable</i> <i>:ﬁll-pointer</i> <i>:displaced-to</i> <i>:displaced-index-oﬀset</i>
<!--l. 1028--><p class="noindent" >Это базовая функция для создания массивов. Аргумент <i>dimensions</i> должен
быть списком неотрицательных целых чисел, которые являются измерениями
массива. Длина списка является размерностью массива. Каждое измерение
должно быть меньше чем <tt><a 
href="#x109-213006r503">array-dimension-limit</a></tt>, и произведение всех
                                                                          

                                                                          
измерений должно быть меньше <tt><a 
href="#x109-213008r504">array-total-size-limit</a></tt>. Следует отметить,
что если <i>dimensions</i> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда создаётся массив с нулевым количеством
измерений. По соглашению, при создании одномерного массива, размер
измерений может быть указан как одиночное целое число, а не список целых
чисел.
<!--l. 1039--><p class="indent" >   Реализация Common Lisp&#x2019;а может иметь ограничение на ранг массива, но
это ограничение должно быть меньше 7. Таким образом, любая Common Lisp
программа может использовать массивы с рангом меньшим или равным
7.
<!--l. 1043--><p class="indent" >   Для <tt><a 
href="#x109-213002r501">make-array</a></tt> существуют следующие именованные параметры:
<div class=flushdesc>
<!--l. 1046--><p class="indent" >
      <ul><li><b>
:element-type </b></li>Этот  аргумент  должен  быть  именем  типа  элементов
      массива. Массив создаётся с наиболее близким типом к указанному,
      и  не  может  содержать  объекты  отличные  от  этого  типа.  Тип  <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>
      указывает на создание общего массива, элементы которого могут
      быть любыми объектами. <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> является значением по-умолчанию.
      <li><b>
:initial-element </b></li>Этот аргумент может использоваться для инициализации
      каждого элемента массива. Значение должно принадлежать типу
      указанному в аргументе :element-type
      . Если :initial-element
      опущен, тогда значение по-умолчанию для элементов массива не
      определено (если только не используется :initial-contents
      или :displaced-to
      ). Опция :initial-element
      может не использоваться, когда указана опция :initial-contents
      или :displaced-to
      .
      <li><b>
:initial-contents </b></li>Этот аргумент может использоваться для инициализации
      содержимого массива. Значением параметра является структура
      вложенных последовательностей. Если массив с нулевым количеством
      измерений, тогда значение задаёт одиночный элемент. В противном
      случае, значение должно быть последовательностью с длинной, равной
                                                                          

                                                                          
      размеру первого измерения. Каждый вложенный элемент также должен
      быть последовательностью, размером равным следующему измерению
      массива. Например: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(make-array &#x2019;(4 2 3)
</td></tr></table>
      <!--l. 1073--><p class="noindent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">            :initial-contents</td></tr></table>
      <!--l. 1074--><p class="noindent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">            &#x2019;(((a b c) (1 2 3))</td></tr></table>
      <!--l. 1075--><p class="noindent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">              ((d e f) (3 1 2))</td></tr></table>
      <!--l. 1076--><p class="noindent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">              ((g h i) (2 3 1))</td></tr></table>
      <!--l. 1077--><p class="noindent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">              ((j k l) (0 0 0))))</td></tr></table>
      <!--l. 1079--><p class="noindent" >
</div>
</div>
      <!--l. 1080--><p class="noindent" >Количество уровней в структуре должно равняться рангу массива.
      Каждый лист вложенной структуры должен иметь тип, указанный в
      опции :type
      . Если опция :initial-contents
      опущена, первоначальное значение элементов массива не определено
      (если только не используется опция :initial-element
      или :displaced-to
      ). Опция :initial-contents
      может не использоваться, когда указана опция :initial-element
      или :displaced-to
      .
      <li><b>
:adjustable </b></li>Если данный аргумент указан и не является <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда размер
      массива после создания может быть изменён. По-умолчанию параметр
      равен <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
      <li><b>
:fill-pointer </b></li>Данный аргумент указывает, что массив должен иметь
      указатель заполнения. Если эта опция указана и не является <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда
                                                                          

                                                                          
      массив должен быть одномерным. Значение используется для
      инициализации указателя заполнения массива. Если указано
      значение <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>, тогда используется длина массива. Иначе, значение
      должно быть целым числом между нулём (включительно) и
      длинной массива (включительно)ю Аргумент по-умолчанию равен
      <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
      <li><b>
:displaced-to </b></li>Если данный аргумент указан и не является <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, то он
      указывает на то, что массив будет <i>соединён</i> с другим массивом.
      Значение аргумента должно быть уже созданным массивом.
      <tt><a 
href="#x109-213002r501">make-array</a></tt> создаст <i>косвенный</i> или <i>разделяемый</i> массив, который имеет
      общее содержимое с указанным массивом. В таком случае опция
      :displaced-index-offset
      позволяет указать смещение общей части массивов. Если массив,
      переданный в аргумент :displaced-to
      , не имеет такого же типа элементов (:element-type
      ), как и создаваемый массив, то генерируется ошибка. Опция
      :displaced-to
      не может использоваться вместе с опцией :initial-element
      или :initial-contents
      . По-умолчанию аргумент равен <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
      <li><b>
:displaced-index-offset </b></li>Данный аргумент может использоваться только в
      сочетании с опцией :displaced-to
      . Она должна быть неотрицательным целым (по-умолчанию равна
      нулю). Она означает смещение создаваемого <i>разделяемого</i> массива
      относительно исходного.
      <!--l. 1122--><p class="noindent" >Если при создании массива B массив A передан в качестве аргумента
      :displaced-to
      в функцию <tt><a 
href="#x109-213002r501">make-array</a></tt>, тогда массив B называется <i>соединённым</i> с
      массивом A. Полное количество элементов массива, называемое <i>полный
      размер</i> массива, вычисляется как произведение размеров всех
      измерений (смотрите <tt><a 
href="clmse89.html#x111-215010r512">array-total-size</a></tt>). Необходимо, чтобы полный
      размер массива A был не меньше чем сумма <i>полного размера</i> массива B
      и смещения <i>n</i>, указанного в аргументе :displaced-index-offset
      . Смысл соединения массивов в том, что массив B не имеет своих
                                                                          

                                                                          
      элементов и операции над ним приводят в действительности к
      операциям над массивом A. При отображении элементов массивов,
      последние рассматриваются как одномерные, с построчным порядком
      размещения элементов. Так, элемент с индексом <i>k</i> массива <i>B</i>
      отображается в элемент с индексом <i>k</i>+<i>n</i> массива <i>A</i>.</ul>
</div>
<!--l. 1138--><p class="indent" >   Если <tt><a 
href="#x109-213002r501">make-array</a></tt> вызывается без указания аргументов :adjustable
, :fill-pointer
и <tt>:displaced-to</tt>, или указания их в <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда получаемый массив
гарантированного будет <i>простым</i> (смотрите раздел <a 
href="clmse7.html#x14-290002.5">2.5<!--tex4ht:ref: ARRAY-TYPE-SECTION --></a>).
<!--l. 1143--><p class="indent" >   Вот несколько примеров использования <tt><a 
href="#x109-213002r501">make-array</a></tt>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Создание одномерного массива с пятью элементами.
</td></tr></table>
<!--l. 1145--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-array 5)</td></tr></table>
<!--l. 1146--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1147--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Создание двумерного массива, 3 на 4, с четырёхбитными элементами.</td></tr></table>
<!--l. 1148--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-array &#x2019;(3 4) :element-type &#x2019;(mod 16))</td></tr></table>
<!--l. 1149--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1150--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Создание массива чисел с плавающей точкой.</td></tr></table>
<!--l. 1151--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-array 5 :element-type &#x2019;single-ﬂoat))</td></tr></table>
<!--l. 1152--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1153--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Создание соединённого массива.</td></tr></table>
<!--l. 1154--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq a (make-array &#x2019;(4 3)))</td></tr></table>
<!--l. 1155--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq b (make-array 8 :displaced-to a</td></tr></table>
<!--l. 1156--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                      :displaced-index-oﬀset 2))</td></tr></table>
<!--l. 1157--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; В таком случае:</td></tr></table>
<!--l. 1158--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (aref b 0) <span class="math"> ≡</span> (aref a 0 2)</td></tr></table>
<!--l. 1159--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (aref b 1) <span class="math"> ≡</span> (aref a 1 0)</td></tr></table>
<!--l. 1160--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (aref b 2) <span class="math"> ≡</span> (aref a 1 1)</td></tr></table>
<!--l. 1161--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (aref b 3) <span class="math"> ≡</span> (aref a 1 2)</td></tr></table>
<!--l. 1162--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (aref b 4) <span class="math"> ≡</span> (aref a 2 0)</td></tr></table>
<!--l. 1163--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (aref b 5) <span class="math"> ≡</span> (aref a 2 1)</td></tr></table>
<!--l. 1164--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (aref b 6) <span class="math"> ≡</span> (aref a 2 2)</td></tr></table>
<!--l. 1165--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (aref b 7) <span class="math"> ≡</span> (aref a 3 0)</td></tr></table>
<!--l. 1167--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
</div>
<div class=defun>
<!--l. 1170--><p class="noindent" ><i>[Константа]</i><a 
 id="dx109-213003"></a><a 
 id="x109-213004r502"></a><b> array-rank-limit</b>
<!--l. 1172--><p class="noindent" >Значение <tt><a 
href="#x109-213004r502">array-rank-limit</a></tt> является положительным целым, которое
обозначает (невключительно) наивысший возможный ранг массива. Это
значение зависит от реализации, но не может быть меньше 8. Таком образом
каждая реализация Common Lisp&#x2019;а поддерживает массивы, ранг которых
лежит между 0 и 7 (включительно). (Разработчикам предлагается сделать
это значение большим настолько, на сколько это возможно без ущерба в
производительности.)
</div>
<div class=defun>
<!--l. 1182--><p class="noindent" ><i>[Константа]</i><a 
 id="dx109-213005"></a><a 
 id="x109-213006r503"></a><b> array-dimension-limit</b>
<!--l. 1184--><p class="noindent" >Значение <tt><a 
href="#x109-213006r503">array-dimension-limit</a></tt> является положительным целым,
которое обозначает (невключительно) наивысший возможный размер
измерения для массива. Это значение зависит от реализации, но не
может быть меньше 1024. (Разработчикам предлагается сделать это
значение большим настолько, на сколько это возможно без ущерба в
производительности.)
</div>
<div class=defun>
<!--l. 1192--><p class="noindent" ><i>[Константа]</i><a 
 id="dx109-213007"></a><a 
 id="x109-213008r504"></a><b> array-total-size-limit</b>
<!--l. 1194--><p class="noindent" >Значение <tt><a 
href="#x109-213008r504">array-total-size-limit</a></tt> является положительным целым, которое
обозначает (невключительно) наивысшее возможное количество элементов в
массиве. Это значение зависит от реализации, но не может быть меньше 1024.
(Разработчикам предлагается сделать это значение большим настолько, на
сколько это возможно без ущерба в производительности.)
<!--l. 1201--><p class="indent" >   На практике предельный размер массива может зависеть от типа
элемента массива, в таком случае <tt><a 
href="#x109-213008r504">array-total-size-limit</a></tt> будет
наименьшим из ряда этих размеров.
</div>
<div class=defun>
<!--l. 1205--><p class="noindent" ><i>[Функция]</i><a 
 id="dx109-213009"></a><a 
 id="x109-213010r505"></a><b> vector</b>  &#x0026;rest  <i>objects</i>
<!--l. 1207--><p class="noindent" >Функция <tt><a 
href="#x109-213010r505">vector</a></tt> служит для создания простых базовых векторов с
заданным содержимым. Она является аналогом для функции <tt><a 
href="clmse80.html#x100-201034r441">list</a></tt>.
<div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(vector <span class="math"><i>a</i><sub>1</sub></span> <span class="math"><i>a</i><sub>2</sub></span> ... <span class="math"><i>a</i><sub>n</sub></span>)
</td></tr></table>
<!--l. 1212--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (make-array (list <span class="math"><i>n</i></span>) :element-type t</td></tr></table>
<!--l. 1213--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             :initial-contents (list <span class="math"><i>a</i><sub>1</sub></span> <span class="math"><i>a</i><sub>2</sub></span> ... <span class="math"><i>a</i><sub>n</sub></span>))</td></tr></table>
<!--l. 1215--><p class="indent" >
</div>
</div>
</div>
                                                                          

                                                                          
   <!--l. 1218--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse88.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch17.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch17.html#tailclmch17.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse87.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch17.html#clmse87.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 1218--><p class="indent" >   <a 
 id="tailclmse87.html"></a>  </div> </div> 
</body></html> 
