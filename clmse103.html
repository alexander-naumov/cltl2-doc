<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Introduction to Structures</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-02-26 02:27:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 24--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse104.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#tailclmch19.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse103.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse103.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">19.1   </span> <a 
 id="x127-16900019.1"></a>Introduction to Structures</h3>
<!--l. 27--><p class="noindent" >The structure facility is embodied in the <a 
href="clmse104.html#x128-170002r619">defstruct</a> macro, which allows the user to
create and use aggregate data types with named elements. These are like
“structures” in PL/I, or “records” in Pascal.
<!--l. 32--><p class="indent" >   As an example, assume you are writing a Lisp program that deals with space
ships in a two-dimensional plane. In your program, you need to represent a space
                                                                          

                                                                          
ship by a Lisp object of some kind. The interesting things about a space ship, as
far as your program is concerned, are its position (represented as x and y
coordinates), velocity (represented as components along the x and y axes), and
mass.
<!--l. 40--><p class="indent" >   A ship might therefore be represented as a record structure with ﬁve
components: x-position, y-position, x-velocity, y-velocity, and mass. This structure
could in turn be implemented as a Lisp object in a number of ways. It could be a
list of ﬁve elements; the x-position could be the car, the y-position the cadr, and
so on. Equally well it could be a vector of ﬁve elements: the x-position could
be element 0, the y-position element 1, and so on. The problem with
either of these representations is that the components occupy places in the
object that are quite arbitrary and hard to remember. Someone looking at
(cadddr ship1) or (aref ship1 3) in a piece of code might ﬁnd it diﬃcult to
determine that this is accessing the y-velocity component of ship1. Moreover, if
the representation of a ship should have to be changed, it would be very
diﬃcult to ﬁnd all the places in the code to be changed to match (not
all occurrences of <a 
href="clmse86.html#x106-148044r465">cadddr</a> are intended to extract the y-velocity from a
ship).
<!--l. 56--><p class="indent" >   Ideally components of record structures should have names. One would like to
write something like (ship-y-velocity ship1) instead of (cadddr ship1).
One would also like a more mnemonic way to create a ship than this: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(list 0 0 0 0 0)
</td></tr></table>
<!--l. 62--><p class="indent" >
</div>
</div>
<!--l. 63--><p class="noindent" >Indeed, one would like ship to be a new data type, just like other Lisp data types,
that one could test with <a 
href="clmse32.html#x43-72002r21">typep</a>, for example. The <a 
href="clmse104.html#x128-170002r619">defstruct</a> facility provides all of
this.
<!--l. 67--><p class="indent" >   <a 
href="clmse104.html#x128-170002r619">defstruct</a> itself is a macro that deﬁnes a structure. For the space ship example,
one might deﬁne the structure by saying: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defstruct ship
</td></tr></table>
                                                                          

                                                                          
<!--l. 70--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  x-position</td></tr></table>
<!--l. 71--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  y-position</td></tr></table>
<!--l. 72--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  x-velocity</td></tr></table>
<!--l. 73--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  y-velocity</td></tr></table>
<!--l. 74--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  mass)</td></tr></table>
<!--l. 76--><p class="indent" >
</div>
</div>
<!--l. 77--><p class="noindent" >This declares that every ship is an object with ﬁve named components. The
evaluation of this form does several things:
      <ul class="itemize1">
      <li class="itemize">It deﬁnes ship-x-position to be a function of one argument, a ship,
      that returns the x-position of the ship; ship-y-position and the other
      components are given similar function deﬁnitions. These functions are
      called the access functions, as they are used to access elements of the
      structure.
      </li>
      <li class="itemize">The symbol ship becomes the name of a data type of which instances
      of  ships  are  elements.  This  name  becomes  acceptable  to  <a 
href="clmse32.html#x43-72002r21">typep</a>,  for
      example; (typep x &#x2019;ship) is true if x is a ship and false if x is any object
      other than a ship.
      </li>
      <li class="itemize">A function named ship-p of one argument is deﬁned; it is a predicate
      that is true if its argument is a ship and is false otherwise.
      </li>
      <li class="itemize">A function called make-ship is deﬁned that, when invoked, will create a data
      structure with ﬁve components, suitable for use with the access functions.
      Thus executing <div class=lisp> <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setq ship2 (make-ship))
</td></tr></table>
      <!--l. 104--><p class="noindent" >
                                                                          

                                                                          
</div>
</div>
      <!--l. 105--><p class="noindent" >sets ship2 to a newly created ship object. One can specify the initial values
      of any desired component in the call to make-ship by using keyword
      arguments in this way: <div class=lisp> <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setq ship2 (make-ship :mass *default-ship-mass*
</td></tr></table>
      <!--l. 109--><p class="noindent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                       :x-position 0</td></tr></table>
      <!--l. 110--><p class="noindent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                       :y-position 0))</td></tr></table>
      <!--l. 112--><p class="noindent" >
</div>
</div>
      <!--l. 113--><p class="noindent" >This constructs a new ship and initializes three of its components. This
      function is called the constructor function because it constructs a new
      structure.
      </li>
      <li class="itemize">The #S syntax can be used to read instances of ship structures, and a
      printer function is provided for printing out ship structures. For example,
      the value of the variable ship2 shown above might be printed as <div class=lisp>
      <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">#S(ship x-position 0 y-position 0 x-velocity nil
</td></tr></table>
      <!--l. 123--><p class="noindent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         y-velocity nil mass 170000.0)</td></tr></table>
      <!--l. 125--><p class="noindent" >
</div>
</div>
      </li>
      <li class="itemize">A function called copy-ship of one argument is deﬁned that, when given a
      ship object, will create a new ship object that is a copy of the given one.
      This function is called the copier function.
                                                                          

                                                                          
      </li>
      <li class="itemize">One may use <a 
href="clmse36.html#x48-80002r66">setf</a> to alter the components of a ship: <div class=lisp> <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setf (ship-x-position ship2) 100)
</td></tr></table>
      <!--l. 137--><p class="noindent" >
</div>
</div>
      <!--l. 138--><p class="noindent" >This alters the x-position of ship2 to be 100. This works because <a 
href="clmse104.html#x128-170002r619">defstruct</a>
      behaves as if it generates an appropriate <a 
href="clmse36.html#x48-80033r71">defsetf</a> form for each access
      function.</li></ul>
<!--l. 144--><p class="indent" >   This simple example illustrates the power of <a 
href="clmse104.html#x128-170002r619">defstruct</a> to provide abstract
record structures in a convenient manner. <a 
href="clmse104.html#x128-170002r619">defstruct</a> has many other features as
well for specialized purposes.
                                                                          

                                                                          
   <!--l. 148--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse104.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#tailclmch19.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse103.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse103.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 148--><p class="indent" >   <a 
 id="tailclmse103.html"></a>  
</body></html> 
