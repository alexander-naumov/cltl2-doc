<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Опции defstruct</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 00:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 1501--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse104.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse102.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse102.html#tailclmse102.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse103.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse103.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">19.5   </span> <a 
href="clm.html#QQ2-127-1595" id="x127-158600019.5">Опции defstruct</a></h3>
<!--l. 1505--><p class="noindent" >Предыдущее описание <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt> достаточно для среднестатистического
использования. Оставшуюся часть этой главы занимает описание более
сложных возможностей функционала <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt>.
<!--l. 1509--><p class="indent" >   Данный раздел объясняет каждую опцию, которая может быть
использована в <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt>. Опция для <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt> может быть или ключевым
символом, или списком из ключевого символа и аргумента для него. (Следует
отметить, что синтаксис для опций <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt> отличается от синтаксиса
пар, используемых для опций слота. Никакая часть этих опций не
вычисляется.)
<div class="flushdesc">
<!--l. 1518--><p class="indent" >
      <ul><li><b>
<tt>:conc-name</tt> </b></li>Данная опция предоставляет префикс для имён функций
      доступа. По соглашению, имена всех функций доступа к слотам
      структура   начинаются   с   префикса   —   имени   структуры   с
      последующим дефисом. Это поведение по-умолчанию.
      <!--l. 1525--><p class="noindent" >Аргумент <tt>:conc-name</tt> указывает альтернативный префикс. (Если
      в  качестве  разделителя  используется  дефис,  он  указывается
      как  часть  префикса.)  Если  в  качестве  аргумента  указано  <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>,
      тогда префикс не устанавливается вообще. Тогда имена функций
      доступа совпадают с именами слотов, и это повод давать слотам
      информативные имена.
      <!--l. 1532--><p class="noindent" >Следует отметить, что не зависимо от того, что указана в <tt>:conc-name</tt>, в
      функции-конструкторе используются ключевые символы, совпадающие
      с именами слотов без присоединяемого префикса. С другой стороны
      префикс используется в именах функций доступа. Например:
      <div class="lisp"><div class="tabbing">
                                                                          

                                                                          
      (defstruct door knob-color width material)
      <br>                                                                          (setq my-door<br>
                 (make-door :knob-color &#x2019;red :width 5.0))<br>
           (door-width my-door) <span class="math"> ⇒</span> 5.0<br>
           (setf (door-width my-door) 43.7)<br>
           (door-width my-door) <span class="math"> ⇒</span> 43.7<br>
           (door-knob-color my-door) <span class="math"> ⇒</span> red<br>
      <!--l. 1544--><p class="noindent" ></div>
      <!--l. 1544--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-158700019.5" id="x127-158700019.5"></a></span>
      <!--l. 1544--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-158800019.5" id="x127-158800019.5"></a></span>
</div>
      <li><b>
<tt>:constructor</tt> </b></li>Данная опция принимает один аргумент, символ, который
      указывает имя функции-конструктора. Если аргумент не предоставлен,
      или если опция не указана, имя конструктора создаётся соединением
      строки <tt>&#x0022;MAKE-&#x0022;</tt> и имени структуры, и помещается в текущий пакет в
      время выполнения формы <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt> (смотрите <tt><a 
href="clmse62.html#x78-904002r158">*package*</a></tt>).
      Если аргумент указан и равен <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>, то функция конструктор не
      создаётся.
      <!--l. 1553--><p class="noindent" >Эта опция имеет более сложный синтаксис, описываемый в
      разделе <a 
href="clmse104.html#x128-160100019.6">19.6<!--tex4ht:ref: DEFSTRUCT-CONSTRUCTOR-SYNTAX --></a>.
      <li><b>
<tt>:copier</tt> </b></li>Данная опция принимает один аргумент, символ, который указывает
      имя функции копирования. Если аргумент не предоставлен, или если
      опция не указана, имя функции копирования создаётся соединением
      строки <tt>&#x0022;COPY-&#x0022;</tt> и имени структуры, и помещается в текущий пакет в
      время выполнения формы <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt> (смотрите <tt><a 
href="clmse62.html#x78-904002r158">*package*</a></tt>).
      Если аргумент указан и равен <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>, то функция копирования не
      создаётся.
                                                                          

                                                                          
      <!--l. 1564--><p class="noindent" >Автоматически создаваемая функция копирования просто создаёт
      новую структуру и переносит все компоненты из структуры аргумента в
      свеже создаваемую структуру. Копирование самих компонентов
      структуры не производится. Соответствующие элементы старой и новой
      структуры равны <tt><a 
href="clmse33.html#x44-402003r45">eql</a></tt> между собой.
      <li><b>
<tt>:predicate</tt> </b></li>Эта опция принимает один аргумент, который задаёт имя
      предиката типа. Если аргумент не указан, или если не указана опция,
      то имя предиката создаётся соединением имени структуры и строки
      <tt>&#x0022;-P&#x0022;</tt>, помещая имя в текущий пакет на момент вычисления формы
      <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt> (смотрите <tt><a 
href="clmse62.html#x78-904002r158">*package*</a></tt>). Если указанный аргумент равен <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>,
      предикат не создаётся. Предикат может быть определён, только если
      структура имеет «имя». Если указана опция <tt>:type</tt> и не указана <tt>:named</tt>,
      тогда опция <tt>:predicate</tt> не должна использоваться или должна иметь
      значение <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>.
      <li><b>
<tt>:include</tt> </b></li>Эта опция используется для создания нового определения
      структуры как расширения для старого определения структуры. В
      качестве примера, предположим у вас есть структура, называемая
      <tt>person</tt>, которая выглядит так: <div class="lisp"><div class="tabbing">
      (defstruct person name age sex)
      <br>
      <!--l. 1585--><p class="noindent" ></div>
      <!--l. 1585--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-158900019.5" id="x127-158900019.5"></a></span>
      <!--l. 1585--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159000019.5" id="x127-159000019.5"></a></span>
</div>
                                                                          

                                                                          
      <!--l. 1586--><p class="noindent" >Теперь, предположим, вы хотите создать новую структуру для
      представления астронавта. Так как астронавт также человек, вы
      хотите, чтобы он также имел свойства имя, возраст и пол, и
      вы хотите чтобы Lisp&#x2019;овые функции работали со структурами
      <tt>astronaut</tt> также как и с структурами <tt>person</tt>. Вы можете сделать
      это определив структуру <tt>astronaut</tt> с опцией <tt>:include</tt>, так:
      <div class="lisp"><div class="tabbing">
      (defstruct (astronaut (:include person)
      <br>                                                     (:conc-name astro-))<br>
              helmet-size<br>                       (favorite-beverage &#x2019;tang))<br>
      <!--l. 1597--><p class="noindent" ></div>
      <!--l. 1597--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159100019.5" id="x127-159100019.5"></a></span>
      <!--l. 1597--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159200019.5" id="x127-159200019.5"></a></span>
</div>
      <!--l. 1599--><p class="noindent" >Опция <tt>:include</tt> заставляет структуру, будучи определённой,
      иметь те же слоты, что и включаемая структура из опции. Это
      осуществляется с помощью того, что функции доступа включаемой
      структуры будут также работать с определяемой структурой. Таким
      образом, в этом примере, <tt>astronaut</tt> будет иметь пять слотов: три
      определены в <tt>person</tt> и два в самом <tt>astronaut</tt>. Функции доступа,
      определённые с помощью структуры <tt>person</tt>, могут применяться к
      экземплярам структуры <tt>astronaut</tt>, и будут корректно работать.
      Более того, <tt>astronaut</tt> будет иметь свои функции доступа для
      компонентов унаследованных от структуры <tt>person</tt>. Следующий пример
      иллюстрирует то, как вы можете использовать структуры <tt>astronaut</tt>:
      <div class="lisp"><div class="tabbing">
                                                                          

                                                                          
      (setq x (make-astronaut :name &#x2019;buzz
      <br>                                                                     :age 45<br>
                                   :sex t<br>
                                   :helmet-size 17.5))<br>                 <br>
           (person-name x) <span class="math"> ⇒</span> buzz<br>       (astro-name x) <span class="math"> ⇒</span> buzz<br>       <br>
           (astro-favorite-beverage x) <span class="math"> ⇒</span> tang<br>
      <!--l. 1621--><p class="noindent" ></div>
      <!--l. 1621--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159300019.5" id="x127-159300019.5"></a></span>
      <!--l. 1621--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159400019.5" id="x127-159400019.5"></a></span>
</div>
      <!--l. 1622--><p class="noindent" >Различие между функциями доступа <tt>person-name</tt> и <tt>astro-name</tt> в том,
      что <tt>person-name</tt> может быть корректно применена к любому
      экземпляру <tt>person</tt>, включая <tt>astronaut</tt>, тогда как <tt>astro-name</tt> может
      работать только с <tt>astronaut</tt>. (Реализация может проверять
      или не проверять корректное использоваться таких функций
      доступа.)
      <!--l. 1628--><p class="noindent" >В одной форме <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt> может использовать не более одной опции
      <tt>:include</tt>. Аргумент для опции <tt>:include</tt> является обязательным и
      должен быть именем определённой ранее структуры. Если структура,
      будучи определённой, не имела опции <tt>:type</tt>, тогда наследуемая
      структура также не должна была содержать опцию <tt>:type</tt>. Если
      структура, будучи определённой, имела опцию <tt>:type</tt>, тогда
      наследуемая структура должна была иметь опцию <tt>:type</tt> с тем же
      типом.
      <!--l. 1637--><p class="noindent" >Если опция <tt>:type</tt> не указана, тогда имя структуры становиться именем
      типа данных. Более того, тип будет является подтипом типа структуры,
      от которой произошло наследование. В вышеприведённом примере,
      <tt>astronaut</tt> является подтипом <tt>person</tt>. Так, <div class="lisp"><div class="tabbing">
                                                                          

                                                                          
      (typep (make-astronaut) &#x2019;person)
      <br>
      <!--l. 1643--><p class="noindent" ></div>
      <!--l. 1643--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159500019.5" id="x127-159500019.5"></a></span>
      <!--l. 1643--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159600019.5" id="x127-159600019.5"></a></span>
</div>
      <!--l. 1644--><p class="noindent" >но и указывает, что все операции над <tt>person</tt> будут также работать для
      <tt>astronaut</tt>.
      <!--l. 1647--><p class="noindent" >Далее рассказывается чуть более сложные возможности опции
      <tt>:include</tt>. Иногда, когда одна структура включает другую, необходимо,
      чтобы значения по-умолчанию или опции слотов из родительской
      структуры при наследовании стали слегка другими. Новая структура
      может задать значения по-умолчанию или опции для наследуемых
      слотов отличными от родительских, с помощью конструкции:
      <div class="lisp"><div class="tabbing">
      (:include <i>name</i> <i>slot-description-1</i> <i>slot-description-2</i> ...)
      <br>
      <!--l. 1654--><p class="noindent" ></div>
      <!--l. 1654--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159700019.5" id="x127-159700019.5"></a></span>
                                                                          

                                                                          
      <!--l. 1654--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159800019.5" id="x127-159800019.5"></a></span>
</div>
      <!--l. 1655--><p class="noindent" >Каждая форма <i>slot-description-j</i> должна иметь имя <i>slot-name</i>
      или <i>slot-keyword</i>, такое же как в родительской структуре. Если
      <i>slot-description-j</i> не имеет формы инициализации <i>default-init</i>, тогда в
      новой структуре слот также не будет иметь первоначального значения.
      В противном случае его первоначальное значение будет заменено
      формой <i>default-init</i> из <i>slot-description-j</i>. Доступный для записи слот
      может быть переделан в слот только для чтения. Если слот только для
      чтения в родительской структуре, тогда он также должен быть
      только для чтения в дочерней. Если для слота указан тип, он
      должен быть таким же или подтипом в дочерней структуре. Если
      это строгий подтип, то реализация может проверять или не
      проверять ошибки несовпадения типов при присваивании значений
      слотам.
      <!--l. 1668--><p class="noindent" >Например, если мы хотели бы определить <tt>astronaut</tt> так, чтобы
      по-умолчанию возрастом астронавта было 45 лет, то мы могли бы
      сказать: <div class="lisp"><div class="tabbing">
      (defstruct (astronaut (:include person (age 45)))
      <br>                                                                            helmet-size<br>
              (favorite-beverage &#x2019;tang))<br>
      <!--l. 1674--><p class="noindent" ></div>
      <!--l. 1674--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-159900019.5" id="x127-159900019.5"></a></span>
      <!--l. 1674--><p class="noindent" ><span class="paragraphHead"><a 
href="#x127-160000019.5" id="x127-160000019.5"></a></span>
</div>
      <li><b>
<tt>:print-function</tt> </b></li>Эта опция может использоваться, только если не опция
                                                                          

                                                                          
      <tt>:type</tt> не была указана. Аргумент для опции <tt>:print-function</tt>
      должен быть функцией трёх аргументов, в форме принимаемой
      специальной формой <tt><a 
href="clmse35.html#x47-433005r52">function</a></tt>. Эта функция используется для вывода
      рассматриваемой структуры. Когда структура выводится на
      консоль, данная функция вызывается с тремя аргументами:
      структура для печати, поток, в который производить вывод, и
      целое число, отображающее текущую глубину (можно сравнить с
      <tt><a 
href="clmse111.html#x138-1865002r648">*print-level*</a></tt>). Функция вывода должна следить за значениями
      таких переменных настройки вывода, как <tt><a 
href="clmse111.html#x138-1844002r641">*print-escape*</a></tt> и
      <tt><a 
href="clmse111.html#x138-1845002r642">*print-pretty*</a></tt>.
      <!--l. 1690--><p class="noindent" >Если опции <tt>:print-function</tt> и <tt>:type</tt> не указаны, тогда функция
      вывода по-умолчанию выводит все слоты используя синтаксис <tt>#S</tt>
      (смотрите раздел <a 
href="clmse111.html#x138-175300022.1.4">22.1.4<!--tex4ht:ref: SHARP-SIGN-MACRO-CHARACTER-SECTION --></a>).
      <li><b>
<tt>:type</tt> </b></li>Опция <tt>:type</tt> явно задаёт представление используемое для структуры.
      Она принимает один аргумент, который должен быть одним из
      перечисленных ниже.
      <!--l. 1698--><p class="noindent" >Задание этой опции заставляет использовать указанное представление и
      заставляет компоненты быть размещёнными в порядке, предусмотренном в
      <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt> форме, в соответствующие последовательные элементы
      указанного представления. Опция также отключает возможность имени
      структуры стать именем типа. (смотрите раздел <a 
href="clmse105.html#x129-160800019.7">19.7<!--tex4ht:ref: EXPLICIT-TYPE-STRUCTURES --></a>).
      <!--l. 1705--><p class="noindent" >Обычно эта опция не используется, и тогда структура представляется
      так, как предусмотрено в реализации.
      <!--l. 1708--><p class="noindent" >
           <div class="quotation">
<div class="flushdesc">
           <!--l. 1710--><p class="noindent" >
    <ul><li><b>
<tt><a 
href="clmse90.html#x112-1468002r522">vector</a></tt> </b></li>Структура  представляется  как  вектор  <tt>(vector t)</tt>.
    размещая  компоненты  как  элементы  вектора.  Первый
    компонент  находится  в  первом  элементе  вектора,  если
    структура  содержит  опцию  <tt>:named</tt>,  и  в  нулевом,  если
    структура содержит <tt>:unnamed</tt>.
                                                                          

                                                                          
    <li><b>
<tt>(vector <i>element-type</i>)</tt> </b></li>Структура              представляется
    как  (возможно  специализированный)  вектор,  размещая
    компоненты  как  элементы  вектора.  Каждый  компонент
    должен принадлежать типу, который мог быть указан для
    вектора. Первый компонент находится в первом элементе
    вектора,  если  структура  содержит  опцию  <tt>:named</tt>,  и  в
    нулевом, если структура содержит <tt>:unnamed</tt>. Структура
    может  быть  <tt>:named</tt>,  только  если  тип  <tt><a 
href="clmch10.html#x67-85500010">symbol</a></tt> является
    подтипом указанного в <tt>element-type</tt>.
    <li><b>
<tt><a 
href="clmse83.html#x103-1304002r458">list</a></tt> </b></li>Структура                  представляется                  как
    список. Первый компонент является <i>cadr</i> элементом, если
    структура  содержит  <tt>:named</tt>,  и  является  <i>car</i> элементом,
    если структура содержит <tt>:unnamed</tt>.</ul>
</div>
           </div>
      <li><b>
<tt>:named</tt> </b></li>Опция <tt>:named</tt> указывает, что структура будет иметь «имя». Эта
      опция не принимает аргументов. Если опция <tt>:type</tt> не указана, тогда
      структура имеет имя. Таким образом эта опция полезно только при
      использовании вместе опцией <tt>:type</tt>. Смотрите раздел <a 
href="clmse105.html#x129-160800019.7">19.7<!--tex4ht:ref: EXPLICIT-TYPE-STRUCTURES --></a> для
      подробного описания этой опции.
      <li><b>
<tt>:initial-offset</tt> </b></li>Эта опция позволяет вам указать <tt><a 
href="clmse100.html#x124-1572002r579">defstruct</a></tt> пропустить
      указанное количество слотов, перед тем как начинать размещать
      указанные в теле слоты. Эта опция требует аргумент, а именно,
      неотрицательное целое, обозначающее количество пропускаемых слотов.
      Опция <tt>:initial-offset</tt> может использоваться, только если также
      указана опция <tt>:type</tt>. Смотрите раздел ?? для подробного описания
      этой опции.</ul>
</div>
                                                                          

                                                                          
<!--l. 1752--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse104.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse102.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse102.html#tailclmse102.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse103.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse103.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse103.html"></a>  </div> </div> 
</body></html> 
