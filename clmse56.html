<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Экспортирование и импортирование символов</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-04 00:46:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 2276--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse57.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse55.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse55.html#tailclmse55.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse56.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch11.html#clmse56.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">11.4   </span> <a 
href="clm.html#QQ2-72-171" id="x72-16400011.4">Экспортирование и импортирование символов</a></h3>
<!--l. 2279--><p class="noindent" >Символы из одного пакета могут стать доступными в другом пакете двумя
способами.
<!--l. 2281--><p class="indent" >   Первый способ, каждый отдельный символ может быть добавлен в пакет с
использованием функции <tt><a 
href="clmse59.html#x75-168030r158">import</a></tt>. Форма <tt>(import &#x2019;editor:buffer)</tt>
принимает внешний символ с именем <tt>buffer</tt> в пакете <tt>editor</tt> (этот символ
распознаётся Lisp считывателем) и добавляет его в текущий пакет в качестве
внутреннего символа. Символ становится <i>доступным</i> в текущем пакете.
Импортированный символ автоматически не экспортируется из текущего
пакета, но если он уже существовал в пакете и был внешним, то это свойство
не меняется. После вызова <tt><a 
href="clmse59.html#x75-168030r158">import</a></tt> в импортирующем пакете появляется
возможность ссылаться на <tt>buffer</tt> без указания полного имени. Свойства
<tt>buffer</tt> в пакете <tt>editor</tt> не меняются, <tt>editor</tt> продолжает оставаться
домашним пакетом для этого символа. Будучи импортированным, символ
будет присутствовать в пакете и может быть удалён только с помощью
вызова <tt><a 
href="clmse59.html#x75-168024r155">unintern</a></tt>.
<!--l. 2296--><p class="indent" >   Если символ уже присутствует в импортирующем пакете, <tt><a 
href="clmse59.html#x75-168030r158">import</a></tt> ничего
не делает. Если другой символ с таким же именем <tt>buffer</tt> уже доступен в
импортирующем пакете (напрямую или унаследован), тогда сигнализируется
исправимая ошибка, как написано в разделе <a 
href="clmse57.html#x73-16500011.5">11.5<!--tex4ht:ref: NAME-CONFLICTS-SECTION --></a>. <tt><a 
href="clmse59.html#x75-168030r158">import</a></tt> не допускает
сокрытия одного символа другим.
<!--l. 2303--><p class="indent" >   Символ называется скрытым другим символом в некотором пакете, когда
первый символ был бы доступен через наследование, если бы не присутствие
второго символа. Для импортирования символа без ошибки скрытия,
используйте функцию <tt><a 
href="clmse59.html#x75-168032r159">shadowing-import</a></tt>. Она вставляет символ в указанный
пакет, как внутренний символ, вне зависимости от того, происходит ли
скрытие другого символа с тем же именем. Если другой символ с тем же
именем присутствовал в пакете, тогда этот символ сначала удаляется из
пакета <tt><a 
href="clmse59.html#x75-168024r155">unintern</a></tt>. Новый символ добавляется в список затеняющих символов
FIXME. <tt><a 
href="clmse59.html#x75-168032r159">shadowing-import</a></tt> должна использоваться аккуратно. Она изменяем
состояние системы пакетов так, что правила согласованности могут перестать
                                                                          

                                                                          
работать.
<!--l. 2316--><p class="indent" >   Второй способ предоставляется функцией <tt><a 
href="clmse59.html#x75-168036r161">use-package</a></tt>. Эта функция
делает так, что пакет наследует все внешние символы некоторого другого
пакета. Эти символы становятся доступными, как <i>внутренние</i> символы,
используемого пакета. То есть, на них можно ссылаться без указания пакета
внутри текущего пакета, но они не становятся доступными в других пакетах,
использующих данный. Следует отметить, что <tt><a 
href="clmse59.html#x75-168036r161">use-package</a></tt>, в отличие от
<tt><a 
href="clmse59.html#x75-168030r158">import</a></tt>, не делает новые символы <i>родственными</i> в текущем пакете, а делает
их только <i>доступными</i> с помощью наследования связи символов с именами.
<tt><a 
href="clmse59.html#x75-168036r161">use-package</a></tt> проверяет конфликты имен между импортируемыми и уже
доступными символами в импортирующем пакете. Это подробнее описано в
разделе <a 
href="clmse57.html#x73-16500011.5">11.5<!--tex4ht:ref: NAME-CONFLICTS-SECTION --></a>.
<!--l. 2328--><p class="indent" >   Обычно пользователь, по-умолчанию работая в пакете <tt>common-lisp-user</tt>,
будет загружать ряд пакетов в Lisp систему для предоставления
расширенного рабочего окружения, и затем вызывать <tt><a 
href="clmse59.html#x75-168036r161">use-package</a></tt>
для каждого из этих пакетов для простого доступа к их внешним
символами. <tt><a 
href="clmse59.html#x75-168038r162">unuse-package</a></tt> производит обратные действия относительно
<tt><a 
href="clmse59.html#x75-168036r161">use-package</a></tt>. Внешние символы используемые пакетом перестают
наследоваться. Однако, любые импортированные символы, остаются
доступными.
<!--l. 2337--><p class="indent" >   Не существует способа наследовать <i>внутренние</i> символы другого пакета.
Для ссылки на внутренний символ, пользователь должен поменять домашний
пакет для данного символа на текущий, или использовать полное
имя (вместе с пакетом), или импортировать этот символ в текущий
пакет.
<!--l. 2342--><p class="indent" >   Различие между внешними и внутренними символами прежде всего
означает скрытие имен, так чтобы одна программа не могла использовать
пространство имен другой программы.
<!--l. 2346--><p class="indent" >   Когда <tt><a 
href="clmse59.html#x75-168020r153">intern</a></tt> или некоторые другие функций хотят найти символ в
заданном пакете, они сначала ищут символ среди внешних и внутренних
символов текущего пакета, затем они в неопределённом порядке ищут среди
внешних символов используемых пакетов. Порядок не имеет значение. В
соответствии с правилами разрешения конфликтов имен (смотрите ниже),
если конфликтующие символы существуют в двух и более пакетах,
унаследованных пакетом <i>X</i>, символ с этим именем должен также быть в <i>X</i>,
как затеняющий символ. Конечно, реализации могут выбрать другой, более
эффективный способ для реализации такого поиска, не изменяя поведение
ранее описанного интерфейса.
                                                                          

                                                                          
<!--l. 2356--><p class="indent" >   Функция <tt><a 
href="clmse59.html#x75-168026r156">export</a></tt> принимает символ, который доступен в некотором
указанном пакете (напрямую или унаследован из другого пакета) и делает
его внешним символом этого пакета. Если символ уже доступен как внешний,
<tt><a 
href="clmse59.html#x75-168026r156">export</a></tt> ничего не делает. Если символ представлен, как внутренний
<i>родственный</i> символ, его статус просто меняется на внешний. Если он
доступен, как внутренний символ, полученный с помощью <tt><a 
href="clmse59.html#x75-168036r161">use-package</a></tt>,
символ сначала импортируется в пакет, а затем делается внешним. (После
этого символ становиться импортированным в пакет и остаётся в нем, вне
зависимости от того будет ли использована <tt><a 
href="clmse59.html#x75-168038r162">unuse-package</a></tt> или нет). Если
символ вообще недоступен в указанном пакете, то сигнализируется ошибка с
возможностью решить проблему, а, именно, какой символ должен быть
импортирован.
<!--l. 2368--><p class="indent" >   Функция <tt><a 
href="clmse59.html#x75-168028r157">unexport</a></tt> откатывает ошибочное экспортирование символа. Она
работает только для символов напрямую представленных в текущем пакете,
меняя их свойство на «внутреннее». Если <tt><a 
href="clmse59.html#x75-168028r157">unexport</a></tt> получает символ,
который в текущем пакете уже является внутренним, она ничего не
делает. Если получает вообще недоступный символ, то сигнализирует
ошибку.
                                                                          

                                                                          
   <!--l. 2375--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse57.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse55.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse55.html#tailclmse55.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse56.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch11.html#clmse56.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 2375--><p class="indent" >   <a 
 id="tailclmse56.html"></a>  
</body></html> 
