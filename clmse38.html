<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Установка новых связываний переменных</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-12 16:57:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 5437--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse39.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse37.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse37.html#tailclmse37.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse38.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse38.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">7.5   </span> <a 
href="clm.html#QQ2-50-107" id="x50-990007.5">Установка новых
связываний переменных</a></h3>
<!--l. 5440--><p class="noindent" >В течение вызова функции представленной лямбда-выражением (или
замыканием лямбда-выражения возвращённым функцией <tt><a 
href="clmse34.html#x46-84002r52">function</a></tt>),
для переменных параметров лямбда-выражения устанавливаются
новые связывания. Эти связывания первоначально имеют значения
установленные с помощью протокола связывания параметров, описанного
в <a 
href="clmse28.html#x38-640005.2.2">5.2.2<!--tex4ht:ref: LAMBDA-EXPRESSIONS-SECTION --></a>.
<!--l. 5446--><p class="indent" >   Для установки связываний переменных, обычных и функциональных,
также полезны следующие конструкции.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> let </b><a 
 id="dx50-99001"></a><a 
 id="x50-99002r74"></a> ( {var | (var [value])}* )  {declaration}*  { form}*
</td></tr></table>
<!--l. 5451--><p class="indent" >
</div>
<!--l. 5451--><p class="noindent" ><span class="paragraphHead"><a 
href="#x50-1000007.5" id="x50-1000007.5"></a></span>
   Форма <tt><a 
href="#x50-99002r74">let</a></tt> может быть использована для связи множества переменных со
значениями соответствующего множества форм.
<!--l. 5455--><p class="indent" >   Если быть точнее, форма <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((<i>var1</i> <i>value1</i>)
</td></tr></table>
<!--l. 5457--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>var2</i> <i>value2</i>)</td></tr></table>
<!--l. 5458--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 5459--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (<i>varm</i> <i>valuem</i>))</td></tr></table>
<!--l. 5460--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration1</i></td></tr></table>
                                                                          

                                                                          
<!--l. 5461--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration2</i></td></tr></table>
<!--l. 5462--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 5463--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declarationp</i></td></tr></table>
<!--l. 5464--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body1</i></td></tr></table>
<!--l. 5465--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body2</i></td></tr></table>
<!--l. 5466--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 5467--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>bodyn</i>)</td></tr></table>
<!--l. 5469--><p class="indent" >
</div>
</div>
<!--l. 5470--><p class="noindent" >сначала последовательно выполняет выражения <i>value1</i>, <i>value2</i> и т.д., сохраняя
результаты. Затем все переменные <i>varj</i> параллельно привязываются к
сохранённым значениям. Каждое связывание будет является лексическим,
кроме тех, для которых указана декларация <tt>special</tt>. Затем последовательно
выполняются выражения <i>bodyk</i>. Все из значения, кроме последнего,
игнорируются (другими словами, тело <tt><a 
href="#x50-99002r74">let</a></tt> является неявным <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>). Форма
<tt><a 
href="#x50-99002r74">let</a></tt> возвращает значение <i>bodyn</i> (если тело пустое, что в принципе бесполезно,
то <tt><a 
href="#x50-99002r74">let</a></tt> возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>). Связывания переменных имеют лексическую область
видимости и неограниченную продолжительность.
<!--l. 5483--><p class="indent" >   Вместо списка <tt>(<i>varj</i> <i>valuej</i>)</tt>, можно записать просто <i>varj</i>. В таком
случае <i>varj</i> инициализируется значением <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. В целях хорошего стиля
рекомендуется, записывать <i>varj</i> только, если в неё будет что-нибудь записано
(с помощью <tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt> например), перед первым использованием. Если
важно, чтобы первоначальное значение было <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, вместо некоторого
неопределённого значения, тогда будет лучше записать <tt>(<i>varj</i> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>)</tt> или
<tt>(<i>varj</i> &#x2019;())</tt>, если значение должно обозначать пустой список. Обратите
внимание, что код <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let (x)
</td></tr></table>
<!--l. 5494--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (integer x))</td></tr></table>
<!--l. 5495--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setq x (gcd y z))</td></tr></table>
<!--l. 5496--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 5498--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 5499--><p class="noindent" >неправильный. Так как <i>x</i> объявлен без первоначального значения и также
объявлено, что <i>x</i> это целое число, то произойдёт исключение, так как <i>x</i> при
связывании получает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> значение, которое не принадлежит целочисленному
типу.
<!--l. 5504--><p class="indent" >   Декларации могут использоваться в начале тела <tt><a 
href="#x50-99002r74">let</a></tt>. Смотрите
<tt><a 
href="clmse47.html#x61-149003r123">declare</a></tt>.
</div>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> let* </b><a 
 id="dx50-100001"></a><a 
 id="x50-100002r75"></a> ( {var | (var [value])}* )  {declaration}*  { form}*
</td></tr></table>
<!--l. 5509--><p class="indent" >
</div>
<!--l. 5509--><p class="noindent" ><span class="paragraphHead"><a 
href="#x50-1010007.5" id="x50-1010007.5"></a></span>
   <tt><a 
href="#x50-100002r75">let*</a></tt> похожа на <tt><a 
href="#x50-99002r74">let</a></tt>, но связывания переменных осуществляются
последовательно, а не параллельно. Это позволяет выражениям для значений
переменных ссылаться на ранее связанные переменные.
<!--l. 5514--><p class="indent" >   Если точнее, форма <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let* ((<i>var1</i> <i>value1</i>)
</td></tr></table>
<!--l. 5516--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (<i>var2</i> <i>value2</i>)</td></tr></table>
<!--l. 5517--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       ...</td></tr></table>
<!--l. 5518--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (<i>varm</i> <i>valuem</i>))</td></tr></table>
<!--l. 5519--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration1</i></td></tr></table>
<!--l. 5520--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declaration2</i></td></tr></table>
<!--l. 5521--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 5522--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>declarationp</i></td></tr></table>
<!--l. 5523--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body1</i></td></tr></table>
<!--l. 5524--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body2</i></td></tr></table>
<!--l. 5525--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 5526--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>bodyn</i>)</td></tr></table>
                                                                          

                                                                          
<!--l. 5528--><p class="indent" >
</div>
</div>
<!--l. 5529--><p class="noindent" >сначала вычисляет выражение <i>value1</i>, затем с этим значением связывает
переменную <i>var1</i>, затем вычисляет <i>value2</i> и связывает с результатом
переменную <i>var2</i>, и так далее. Затем последовательно вычисляются
выражения <i>bodyj</i>. Значения всех выражений, кроме последнего,
игнорируются. То есть тело формы <tt><a 
href="#x50-100002r75">let*</a></tt> является неявным <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>.
Форма <tt><a 
href="#x50-100002r75">let*</a></tt> возвращает результаты вычисления <i>bodyn</i> (если тело
пустое, что, в принципе, бесполезно, <tt><a 
href="#x50-100002r75">let*</a></tt> возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>). Связывания
переменных имеют лексическую область видимости и неограниченную
продолжительность.
<!--l. 5539--><p class="indent" >   Вместо списка <tt>(<i>varj</i> <i>valuej</i>)</tt>, можно записать просто <i>varj</i>. В таком
случае <i>varj</i> будет инициализирована в <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. В целях стиля, рекомендуется
записывать <i>varj</i>, только ей будет что-нибудь присвоено с помощью <tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt>
перед первым использованием. Если необходимо инициализировать
переменную значением <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, а не неопределённым, лучше писать <tt>(<i>varj</i> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>)</tt>
для инициализации «ложью» или <tt>(<i>varj</i> &#x2019;())</tt> для инициализации пустым
списком.
<!--l. 5549--><p class="indent" >   В начале тела <tt>let*</tt> могут использоваться декларации. Смотрите
<tt><a 
href="clmse47.html#x61-149003r123">declare</a></tt>.
</div>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> progv </b><a 
 id="dx50-101001"></a><a 
 id="x50-101002r76"></a> symbols values  { form}*
</td></tr></table>
<!--l. 5554--><p class="indent" >
</div>
<!--l. 5554--><p class="noindent" ><span class="paragraphHead"><a 
href="#x50-1020007.5" id="x50-1020007.5"></a></span>
   <tt><a 
href="#x50-101002r76">progv</a></tt> является специальной формой, которая позволяет создавать
связывания одной и более динамических переменных, чьи имена
устанавливаются во время выполнения. Последовательность форм (неявный
                                                                          

                                                                          
<tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>) выполняется с динамическими переменными, что имена в списке
<i>symbols</i> связаны с соответствующими значениями в списке <i>values</i>. (Если
значений меньше, чем переменных, то соответствующие переменные
получают соответствующие значения, а оставшиеся остаются без значений.
Смотрите <tt><a 
href="clmse34.html#x46-88004r62">makunbound</a></tt>. Если значений больше, чем переменных, они
игнорируются.) Результатом <tt><a 
href="#x50-101002r76">progv</a></tt> является результат последней формы.
Связывания динамических переменных упраздняются при выходе из формы
<tt><a 
href="#x50-101002r76">progv</a></tt>. Списки переменных и значений это вычисляемые значения. Это то,
что отличает <tt><a 
href="#x50-101002r76">progv</a></tt> от, например, <tt><a 
href="#x50-99002r74">let</a></tt>, в которой имена переменных
указываются явно в тексте программы.
<tt>
<!--l. 5569--><p class="indent" >   <a 
href="#x50-101002r76">progv</a></tt> полезна, в частности, для написания интерпретаторов языков
встраиваемых в Lisp. Она предоставляет управление механизмом связывания
динамических переменных.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> ﬂet </b><a 
 id="dx50-102001"></a><a 
 id="x50-102002r77"></a> ( {(name lambda-list
</td></tr></table>
<!--l. 5577--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> [[ {declaration}*  | doc-string]]  { form}* )}* )</td></tr></table>
<!--l. 5578--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  { form}* </td></tr></table>
<!--l. 5578--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Макрос]</i><b> labels </b><a 
 id="dx50-102003"></a><a 
 id="x50-102004r78"></a> ( {(name lambda-list</td></tr></table>
<!--l. 5580--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> [[ {declaration}*  | doc-string]]  { form}* )}* )</td></tr></table>
<!--l. 5581--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  { form}* </td></tr></table>
<!--l. 5581--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Макрос]</i><b> macrolet </b><a 
 id="dx50-102005"></a><a 
 id="x50-102006r79"></a> ( {(name varlist</td></tr></table>
<!--l. 5583--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> [[ {declaration}*  | doc-string]]  { form}* )}* )</td></tr></table>
<!--l. 5584--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  { form}* </td></tr></table>
<!--l. 5585--><p class="indent" >
</div>
<!--l. 5585--><p class="noindent" ><span class="paragraphHead"><a 
href="#x50-1030007.5" id="x50-1030007.5"></a></span>
   <tt><a 
href="#x50-102002r77">flet</a></tt> может быть использована для определения локальных именованных
функций. Внутри тела формы <tt><a 
href="#x50-102002r77">flet</a></tt>, имена функций, совпадающие с именами
                                                                          

                                                                          
определёнными в <tt><a 
href="#x50-102002r77">flet</a></tt>, ссылаются на локально определённые функции, а не
на глобальные определения функции с теми же именами.
<!--l. 5591--><p class="indent" >   Может быть определено любое количество функций. Каждое определение
осуществляется формате, как в форме <tt><a 
href="clmse29.html#x39-66002r13">defun</a></tt>: сначала имя, затем список
параметров (который может содержать <tt>&#x0026;optional</tt>, <tt>&#x0026;rest</tt> или <tt>&#x0026;key</tt>
параметры), затем необязательные декларации и строка документации, и,
наконец, тело. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(ﬂet ((safesqrt (x) (sqrt (abs x))))
</td></tr></table>
<!--l. 5597--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ;; Функция safesqrt используется в двух местах.</td></tr></table>
<!--l. 5598--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (safesqrt (apply #&#x2019;+ (map &#x2019;list #&#x2019;safesqrt longlist))))</td></tr></table>
<!--l. 5600--><p class="indent" >
</div>
</div>
<!--l. 5602--><p class="indent" >   Конструкция <tt><a 
href="#x50-102004r78">labels</a></tt> идентична по форме конструкции <tt><a 
href="#x50-102002r77">flet</a></tt>. Эти
конструкции различаются в том, что область видимости определённых
функций для <tt><a 
href="#x50-102002r77">flet</a></tt> заключена только в теле, тогда как видимость в <tt><a 
href="#x50-102004r78">labels</a></tt>
охватывает даже определения этих функций. Это значит, что <tt><a 
href="#x50-102004r78">labels</a></tt> может
быть использована для определения взаимно рекурсивных функций, а <tt><a 
href="#x50-102002r77">flet</a></tt>
не может. Это различие бывает полезно. Использование <tt><a 
href="#x50-102002r77">flet</a></tt> может локально
переопределить глобальную функцию, и новое определение может ссылаться
на глобальное. Однако такая же конструкция <tt><a 
href="#x50-102004r78">labels</a></tt> не будет обладать этим
свойством. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun integer-power (n k)       ; Быстрое возведение
</td></tr></table>
<!--l. 5612--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (integer n))          ; целого числа в степень</td></tr></table>
<!--l. 5613--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (type (integer 0 *) k))</td></tr></table>
<!--l. 5614--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (labels ((expt0 (x k a)</td></tr></table>
<!--l. 5615--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (declare (integer x a) (type (integer 0 *) k))</td></tr></table>
<!--l. 5616--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (cond ((zerop k) a)</td></tr></table>
<!--l. 5617--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))</td></tr></table>
<!--l. 5618--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   (t (expt0 (* x x) (ﬂoor k 2) (* x a)))))</td></tr></table>
<!--l. 5619--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           (expt1 (x k a)</td></tr></table>
<!--l. 5620--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (declare (integer x a) (type (integer 1 *) k))</td></tr></table>
                                                                          

                                                                          
<!--l. 5621--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (cond ((evenp k) (expt1 (* x x) (ﬂoor k 2) a))</td></tr></table>
<!--l. 5622--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   (t (expt0 (* x x) (ﬂoor k 2) (* x a))))))</td></tr></table>
<!--l. 5623--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (expt0 n k 1)))</td></tr></table>
<!--l. 5625--><p class="indent" >
</div>
</div>
<tt>
<!--l. 5627--><p class="indent" >   <a 
href="#x50-102006r79">macrolet</a></tt> похожа на форму <tt><a 
href="#x50-102002r77">flet</a></tt>, но определяет локальные макросы,
используя тот же формат записи, что и <tt><a 
href="clmse44.html#x57-143004r118">defmacro</a></tt>. Имена для макросов,
установленные с помощью <tt><a 
href="#x50-102006r79">macrolet</a></tt>, имеют лексическую область
видимости.
<!--l. 5632--><p class="indent" >   Макросы часто должны быть раскрыты во «время компиляции» (общими
словами, во время перед тем, как сама программа будет выполнена), таким
образом, значения переменных во время выполнения не доступны для
макросов, определённых с помощью <tt><a 
href="#x50-102006r79">macrolet</a></tt>.
<!--l. 5637--><p class="indent" >   Однако, сущности, имеющие лексическую область видимости, <i>видны</i>
внутри тела формы <tt><a 
href="#x50-102006r79">macrolet</a></tt> и <i>видны</i> в коде, который является результатом
раскрытия макровызова. Следующий пример должен помочь в понимании:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; Пример macrolet.
</td></tr></table>
<!--l. 5641--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 5642--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x ﬂag)</td></tr></table>
<!--l. 5643--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (macrolet ((fudge (z)</td></tr></table>
<!--l. 5644--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;;Параметры <tt>x</tt> и <tt>flag</tt> в данной точке</td></tr></table>
<!--l. 5645--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;; недоступны; ссылка на <tt>flag</tt> была бы</td></tr></table>
<!--l. 5646--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ;; одноимённую глобальную переменную.</td></tr></table>
<!--l. 5647--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ‘(if ﬂag</td></tr></table>
<!--l. 5648--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     (* ,z ,z)</td></tr></table>
<!--l. 5649--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     ,z)))</td></tr></table>
<!--l. 5650--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ;;Параметры <tt>x</tt> и <tt>flag</tt> доступны здесь.</td></tr></table>
<!--l. 5651--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (+ x</td></tr></table>
<!--l. 5652--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (fudge x)</td></tr></table>
<!--l. 5653--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (fudge (+ x 1)))))</td></tr></table>
<!--l. 5655--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 5656--><p class="noindent" >Тело данного примера после разворачивания макросов превращается в
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(+ x
</td></tr></table>
<!--l. 5658--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (if ﬂag</td></tr></table>
<!--l. 5659--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (* x x)</td></tr></table>
<!--l. 5660--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       x))</td></tr></table>
<!--l. 5661--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (if ﬂag</td></tr></table>
<!--l. 5662--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (* (+ x 1) (+ x 1))</td></tr></table>
<!--l. 5663--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (+ x 1)))</td></tr></table>
<!--l. 5665--><p class="indent" >
</div>
</div>
<tt>
<!--l. 5666--><p class="noindent" >x</tt> и <tt>flag</tt> легитимно ссылаются на параметры функции <tt>foo</tt>, потому что эти
параметры видимы в месте макровызова.
</div>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> symbol-macrolet </b><a 
 id="dx50-103001"></a><a 
 id="x50-103002r80"></a> ( {(var expansion)}* )
</td></tr></table>
<!--l. 5672--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  { form}* </td></tr></table>
<!--l. 5673--><p class="indent" >
</div>
<!--l. 5673--><p class="noindent" ><span class="paragraphHead"><a 
href="#x50-1040007.5" id="x50-1040007.5"></a></span>
   X3J13 проголосовал в июне 1988 <a 
 id="dx50-104001"></a>адаптировать Common Lisp&#x2019;овую систему
объектов (CLOS). Часть этого является общий механизм, <tt><a 
href="#x50-103002r80">symbol-macrolet</a></tt>,
для обработки заданных имён переменным, как если бы они были
                                                                          

                                                                          
макровызовами без параметров. Эта функциональность полезно независимо
от CLOS.
<!--l. 5681--><p class="indent" >   Формы <i>forms</i> выполняются как неявный <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt> в лексическом окружении,
в котором любая ссылка на обозначенную переменную <i>var</i> будет заменена на
соответствующее выражение <i>expansion</i>. Это происходит, как будто ссылка на
переменную <i>var</i> является макровызовом без параметров. Выражение
<i>expansion</i> вычисляется или обрабатывается в месте появления ссылки.
Однако, следует отметить, что имена таких макросимволов работает в
пространстве имен переменных, не в пространстве функций. Использование
<tt><a 
href="#x50-103002r80">symbol-macrolet</a></tt> может быть в свою очередь перекрыто с помощью
<tt><a 
href="#x50-99002r74">let</a></tt> или другой конструкцией, связывающей переменные. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(symbol-macrolet ((pollyanna &#x2019;goody))
</td></tr></table>
<!--l. 5691--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (list pollyanna (let ((pollyanna &#x2019;two-shoes)) pollyanna)))</td></tr></table>
<!--l. 5692--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <span class="math"> ⇒</span> (goody two-shoes), <i>not</i> (goody goody)</td></tr></table>
<!--l. 5694--><p class="indent" >
</div>
</div>
<!--l. 5696--><p class="indent" >   Выражение <i>expansion</i> для каждой переменной <i>var</i> вычисляется не во
время связывания, а во время подстановки вместо ссылок на <i>var</i>.
Конструкция возвращает значения последней вычисленной формы, или <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>,
если таких значений не было.
<!--l. 5701--><p class="indent" >   Смотрите документация <tt><a 
href="clmse45.html#x58-145002r119">macroexpand</a></tt> и <tt><a 
href="clmse45.html#x58-145004r120">macroexpand-1</a></tt>. Они раскрывают
макросы символов, также как и обычные макросы.
<!--l. 5704--><p class="indent" >   Указанные декларации <i>declarations</i> перед телом обрабатываются так как
описано в разделе <a 
href="clmse47.html#x61-1490009.1">9.1<!--tex4ht:ref: DECLARE-SYNTAX-SECTION --></a>.
</div>
                                                                          

                                                                          
<!--l. 5708--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse39.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse37.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse37.html#tailclmse37.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse38.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse38.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse38.html"></a>  </div> </div> 
</body></html> 
