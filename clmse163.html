<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Gatherers</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-08 00:30:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 86--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse164.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse162.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse162.html#tailclmse162.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse163.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmap2.html#clmse163.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">B.3   </span> <a 
 id="x199-521000B.3"></a>Gatherers</h3>
<!--l. 88--><p class="noindent" >These functions create and process gatherers.
<div class=defun>
<!--l. 90--><p class="noindent" ><i>[Function]</i><a 
 id="dx199-521001"></a><a 
 id="x199-521002r1124"></a><b> gatherer</b>  <i>collector</i>
<!--l. 92--><p class="noindent" >The collector must be a function of type (function ((series t<sub>1</sub>)) t<sub>2</sub>). Given this
function, <a 
href="#x199-521002r1124">gatherer</a> returns a gatherer that accepts elements of type t<sub>1</sub> and returns
a ﬁnal result of type t<sub>2</sub>. The method for combining elements used by the gatherer
is the same as the one used by the collector.
</div>
<div class=defun>
<!--l. 101--><p class="noindent" ><i>[Function]</i><a 
 id="dx199-521003"></a><a 
 id="x199-521004r1125"></a><b> next-out</b>  <i>gatherer</i> <i>item</i>
<!--l. 103--><p class="noindent" >Given a gatherer and a value, <a 
href="#x199-521004r1125">next-out</a> enters the value into the gatherer.
</div>
<div class=defun>
<!--l. 109--><p class="noindent" ><i>[Function]</i><a 
 id="dx199-521005"></a><a 
 id="x199-521006r1126"></a><b> result-of</b>  <i>gatherer</i>
<!--l. 111--><p class="noindent" ><a 
href="#x199-521006r1126">result-of</a> retrieves the net result from a gatherer. <a 
href="#x199-521006r1126">result-of</a> can be applied at
any time. However, it is an error to apply <a 
href="#x199-521006r1126">result-of</a> twice to the same
gatherer or to apply <a 
href="#x199-521004r1125">next-out</a> to a gatherer once <a 
href="#x199-521006r1126">result-of</a> has been applied. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((g (gatherer #&#x2019;collect-sum)))
</td></tr></table>
<!--l. 117--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (dolist (i &#x2019;(1 2 3 4))</td></tr></table>
<!--l. 118--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (next-out g i)</td></tr></table>
<!--l. 119--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (if (evenp i) (next-out g (* 10 i))))</td></tr></table>
<!--l. 120--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (result-of g))</td></tr></table>
<!--l. 121--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ 70</td></tr></table>
<!--l. 123--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> gathering </b><a 
 id="dx199-521007"></a><a 
 id="x199-521008r1127"></a> ( {(var fn)}* )  { form}*
</td></tr></table>
<!--l. 128--><p class="indent" >
</div>
<!--l. 128--><p class="noindent" ><span class="paragraphHead"><a 
 id="x199-522000B.3"></a></span>
   The ﬁrst subform must be a list of pairs. The ﬁrst element of each pair, var,
must be a variable name. The second element of each pair, fn, must be a form
that when wrapped in (function ...) is acceptable as an argument to <a 
href="#x199-521002r1124">gatherer</a>.
Each symbol is bound to a gatherer constructed from the corresponding collector.
The body (consisting of the forms) is evaluated in the scope of these bindings.
When this evaluation is complete, <a 
href="#x199-521008r1127">gathering</a> returns the <a 
href="#x199-521006r1126">result-of</a> each gatherer. If
there are n pairs in the binding list, <a 
href="#x199-521008r1127">gathering</a> returns n values. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun examp (data)
</td></tr></table>
<!--l. 140--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (gathering ((x collect) (y collect-sum))</td></tr></table>
<!--l. 141--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (iterate ((i (scan data)))</td></tr></table>
<!--l. 142--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (case (ﬁrst i)</td></tr></table>
<!--l. 143--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (:slot (next-out x (second i)))</td></tr></table>
<!--l. 144--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (:part (dolist (j (second i)) (next-out x j))))</td></tr></table>
<!--l. 145--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (next-out y (third i)))))</td></tr></table>
<!--l. 146--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 147--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(examp &#x2019;((:slot a 10) (:part (c d) 40)))  ⇒ (a c d) and 50</td></tr></table>
<!--l. 149--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 151--><p class="indent" >   As a further illustration of gatherers, consider the following deﬁnition for
a simpliﬁed version of <a 
href="#x199-521008r1127">gathering</a> that handles only one binding pair. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defmacro simple-gathering (((var collector)) &#x0026;body body)
</td></tr></table>
<!--l. 154--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ‘(let ((,var (gatherer (function ,collector))))</td></tr></table>
<!--l. 155--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ,@body</td></tr></table>
<!--l. 156--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (result-of ,var)))</td></tr></table>
<!--l. 158--><p class="indent" >
</div>
</div>
<!--l. 159--><p class="noindent" >The full capabilities of <a 
href="#x199-521008r1127">gathering</a> can be supported in much the same way.
</div>
                                                                          

                                                                          
   <!--l. 163--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse164.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse162.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse162.html#tailclmse162.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse163.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmap2.html#clmse163.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 163--><p class="indent" >   <a 
 id="tailclmse163.html"></a>  
</body></html> 
