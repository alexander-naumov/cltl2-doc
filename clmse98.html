<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Introduction to Structures Введения в структуры</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-19 00:40:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 31--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse99.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#tailclmch19.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse98.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse98.html" >Вверх</a><tt>&#x003E;</tt></p></div>
                                                                          

                                                                          
   <h3 class="sectionHead"><span class="titlemark">19.1   </span> <a 
 id="x122-22600019.1"></a>Introduction to Structures Введения в структуры</h3>
<!--l. 34--><p class="noindent" >The structure facility is embodied in the <a 
href="clmse99.html#x123-227002r580">defstruct</a> macro, which allows the user to
create and use aggregate data types with named elements. These are like
“structures” in PL/I, or “records” in Pascal.
<!--l. 39--><p class="indent" >   Функциональность структур вополщена в макросе <a 
href="clmse99.html#x123-227002r580">defstruct</a>, который
позволяет пользовател создавать и использовать сгруппированные типы
данных с именованными элементами. Она похожа на функциональность
«структур (structures)» в PL/I или «записей (records)» в Pascal&#x2019;е.
<!--l. 44--><p class="indent" >   As an example, assume you are writing a Lisp program that deals with space
ships in a two-dimensional plane. In your program, you need to represent a space
ship by a Lisp object of some kind. The interesting things about a space ship, as
far as your program is concerned, are its position (represented as <i>x</i> and <i>y</i>
coordinates), velocity (represented as components along the <i>x</i> and <i>y</i> axes), and
mass.
<!--l. 53--><p class="indent" >   В качестве примера, предположим, что вы пишете программу на Lisp&#x2019;е,
которая управляет космическими кораблями в двухмерном пространстве. В
вашей программе, вам необходимо представить космический корабль как
некоторого вида Lisp&#x2019;овый объект. Интересующие вашу программу
свойства корабля являются: его позиция (представленая как <i>x</i> и <i>y</i>
координаты), скорость (представленная как отрезки по осям <i>x</i> и <i>y</i>) и
масса.
<!--l. 60--><p class="indent" >   A ship might therefore be represented as a record structure with ﬁve
components: <i>x</i>-position, <i>y</i>-position, <i>x</i>-velocity, <i>y</i>-velocity, and mass. This
structure could in turn be implemented as a Lisp object in a number of ways. It
could be a list of ﬁve elements; the <i>x</i>-position could be the <i>car</i>, the <i>y</i>-position the
<i>cadr</i>, and so on. Equally well it could be a vector of ﬁve elements: the <i>x</i>-position
could be element 0, the <i>y</i>-position element 1, and so on. The problem with either
of these representations is that the components occupy places in the object that
are quite arbitrary and hard to remember. Someone looking at (cadddr ship1)
or (aref ship1 3) in a piece of code might ﬁnd it diﬃcult to determine
that this is accessing the <i>y</i>-velocity component of ship1. Moreover, if
the representation of a ship should have to be changed, it would be very
diﬃcult to ﬁnd all the places in the code to be changed to match (not
all occurrences of <a 
href="clmse81.html#x101-202044r428">cadddr</a> are intended to extract the <i>y</i>-velocity from a
ship).
<!--l. 76--><p class="indent" >   Таким образом, корабль может быть представлен как запись структуры с
пятью компонентами: позиция-<i>x</i>, позиция-<i>y</i>, скорость-<i>x</i>, скорость-<i>y</i> и масса.
Эта структура может быть реализована как Lisp&#x2019;овый объект несколькими
                                                                          

                                                                          
способами. Она может быть списком из пяти элементов; позиция-<i>x</i> будет <i>car</i>
элементом, позиция-<i>y</i> будет <i>cadr</i>, и так далее. Подобным образом структура
может быть вектором из пяти элементов: позиция-<i>x</i> будет 0-ым элементом,
позиция-<i>y</i> будет 1-ым, и так далее. Проблема данных представлений состоит
в том, что компоненты занимают совершенно случайные позиции и их
сложно запомнить. Кто-нибудь увидев где-то в коде строки (cadddr ship1)
или (aref ship1 3), обнаружит сложность в определении того, что это
производится доступ к компоненту скорости-<i>y</i> структуры ship1. Более того,
если представление корабля должно быть изменено, то будет очень
сложно найти все места в коде для изменения в соответствие с новым
представлением (не все появления <a 
href="clmse81.html#x101-202044r428">cadddr</a> означают доступ к скорости-<i>y</i>
корабля).
<!--l. 93--><p class="indent" >   Ideally components of record structures should have names. One would like to
write something like (ship-y-velocity ship1) instead of (cadddr ship1).
One would also like a more mnemonic way to create a ship than this:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(list 0 0 0 0 0)
</td></tr></table>
<!--l. 99--><p class="indent" >
</div>
</div>
<!--l. 100--><p class="noindent" >Indeed, one would like ship to be a new data type, just like other Lisp data types,
that one could test with <a 
href="clmse32.html#x43-76002r20">typep</a>, for example. The <a 
href="clmse99.html#x123-227002r580">defstruct</a> facility provides all of
this.
<!--l. 104--><p class="indent" >   Лучше было бы если бы записи структур имели имена. Можно было бы
написать что-то вроде (ship-y-velocity ship1) вместо (cadddr ship1). Кроме
того было бы неплохо иметь более информативную запись для создания
структур, чем эта: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(list 0 0 0 0 0)
</td></tr></table>
<!--l. 109--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 110--><p class="noindent" >Несомненно, хочется, чтобы ship был новым типом данных, как и любой другой
тип Lisp&#x2019;овых данных, чтобы, например, осуществить проверку с помощью
<a 
href="clmse32.html#x43-76002r20">typep</a>. Функциональность <a 
href="clmse99.html#x123-227002r580">defstruct</a> предоставляет все, что выше было
необходимо.
<!--l. 115--><p class="indent" >   <a 
href="clmse99.html#x123-227002r580">defstruct</a> itself is a macro that deﬁnes a structure. For the space ship example,
one might deﬁne the structure by saying: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defstruct ship
</td></tr></table>
<!--l. 118--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  x-position</td></tr></table>
<!--l. 119--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  y-position</td></tr></table>
<!--l. 120--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  x-velocity</td></tr></table>
<!--l. 121--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  y-velocity</td></tr></table>
<!--l. 122--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  mass)</td></tr></table>
<!--l. 124--><p class="indent" >
</div>
</div>
<!--l. 125--><p class="noindent" >This declares that every ship is an object with ﬁve named components. The
evaluation of this form does several things:
<!--l. 128--><p class="indent" >   <a 
href="clmse99.html#x123-227002r580">defstruct</a> является макросом, который определяет структуру. Например,
для космического корабля, можно определить структуру так: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defstruct ship
</td></tr></table>
<!--l. 131--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  x-position</td></tr></table>
<!--l. 132--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  y-position</td></tr></table>
<!--l. 133--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  x-velocity</td></tr></table>
<!--l. 134--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  y-velocity</td></tr></table>
<!--l. 135--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  mass)</td></tr></table>
<!--l. 137--><p class="indent" >
</div>
</div>
<!--l. 138--><p class="noindent" >Запись декларирует, что каждый объект ship является объектом с пятью
именованными компонентами. Вычисление этой формы делает несколько
вещей.
                                                                          

                                                                          
      <ul class="itemize1">
      <li class="itemize">It deﬁnes ship-x-position to be a function of one argument, a ship,
      that returns the <i>x</i>-position of the ship; ship-y-position and the other
      components are given similar function deﬁnitions. These functions are
      called the <i>access functions</i>, as they are used to access elements of the
      structure.
      </li>
      <li class="itemize">Она определяет ship-x-position как функцию одного аргумента, а
      именно,
      корабля, которая возвращает позицию-<i>x</i> корабля. ship-y-position и
      другие компоненты получают такие же определения функций. Эти
      функции называются <i>функциями доступа</i>, так как используются
      для доступа к компонентам структуры.
      </li>
      <li class="itemize">The symbol ship becomes the name of a data type of which instances
      of  ships  are  elements.  This  name  becomes  acceptable  to  <a 
href="clmse32.html#x43-76002r20">typep</a>,  for
      example; (typep x &#x2019;ship) is true if x is a ship and false if x is any object
      other than a ship.
      </li>
      <li class="itemize">Символ   ship   становится   именем   типа   данных,   к   которому
      принадлежат экземпляры объектом кораблей. Например, это имя
      может  использоваться  в  <a 
href="clmse32.html#x43-76002r20">typep</a>.  (typep  x  &#x2019;ship)  истинен,  если  x
      является  кораблём,  и  ложен,  если  x  является  любым  другим
      объектом.
      </li>
      <li class="itemize">A function named ship-p of one argument is deﬁned; it is a predicate
      that is true if its argument is a ship and is false otherwise.
      </li>
      <li class="itemize">Определяется  функция  одного  аргумента  с  именем  ship-p.  Она
      является предикатом, который истинен, если аргумент является
      кораблём, и ложен в противных случаях.
      </li>
      <li class="itemize">A function called make-ship is deﬁned that, when invoked, will create a data
      structure with ﬁve components, suitable for use with the access functions.
                                                                          

                                                                          
      Thus executing <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setq ship2 (make-ship))
</td></tr></table>
      <!--l. 185--><p class="noindent" >
</div>
</div>
      <!--l. 186--><p class="noindent" >sets ship2 to a newly created ship object. One can specify the initial values
      of any desired component in the call to make-ship by using keyword
      arguments in this way: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setq ship2 (make-ship :mass *default-ship-mass*
</td></tr></table>
      <!--l. 190--><p class="noindent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                       :x-position 0</td></tr></table>
      <!--l. 191--><p class="noindent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                       :y-position 0))</td></tr></table>
      <!--l. 193--><p class="noindent" >
</div>
</div>
      <!--l. 194--><p class="noindent" >This constructs a new ship and initializes three of its components. This
      function is called the <i>constructor function</i> because it constructs a new
      structure.
      </li>
      <li class="itemize">Определяется функция с именем make-ship, при вызове которой
      создаётся структура данных из пяти компонентов, готовая к
      использованию в <i>функциях доступа</i>. Так, выполнение <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setq ship2 (make-ship))
</td></tr></table>
      <!--l. 205--><p class="noindent" >
                                                                          

                                                                          
</div>
</div>
      <!--l. 206--><p class="noindent" >устанавливает в ship2 свеже созданный объект ship. Можно указать
      первоначальные значения для компонентов структуры используя
      именованные параметры: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setq ship2 (make-ship :mass *default-ship-mass*
</td></tr></table>
      <!--l. 210--><p class="noindent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                       :x-position 0</td></tr></table>
      <!--l. 211--><p class="noindent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                       :y-position 0))</td></tr></table>
      <!--l. 213--><p class="noindent" >
</div>
</div>
      <!--l. 214--><p class="noindent" >Форма создает новый корабль и инициализирует три его компонента.
      Эта функция называется <i>функцией-конструктором</i>, потому что создаёт
      новую структуру.
      </li>
      <li class="itemize">The #S syntax can be used to read instances of ship structures, and a
      printer function is provided for printing out ship structures. For example,
      the value of the variable ship2 shown above might be printed as
      <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">#S(ship x-position 0 y-position 0 x-velocity nil
</td></tr></table>
      <!--l. 224--><p class="noindent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         y-velocity nil mass 170000.0)</td></tr></table>
      <!--l. 226--><p class="noindent" >
</div>
</div>
                                                                          

                                                                          
      </li>
      <li class="itemize">Синтаксис #S может использоваться для чтения экземпляров структур
      ship, и также предоставляется функция вывода для печати структур
      кораблей. Например, значение ранее упомянутой переменной ship2
      может быть выведено как <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">#S(ship x-position 0 y-position 0 x-velocity nil
</td></tr></table>
      <!--l. 234--><p class="noindent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         y-velocity nil mass 170000.0)</td></tr></table>
      <!--l. 236--><p class="noindent" >
</div>
</div>
      </li>
      <li class="itemize">A function called copy-ship of one argument is deﬁned that, when given a
      ship object, will create a new ship object that is a copy of the given one.
      This function is called the <i>copier function</i>.
      </li>
      <li class="itemize">Определяется функция одного аргумента с именем copy-ship, которая
      получая объект ship, будет создавать новый объект ship, который
      является копией исходного. Эта функция называется <i>функцией
      копирования</i>.
      </li>
      <li class="itemize">One may use <a 
href="clmse36.html#x48-90002r64">setf</a> to alter the components of a ship: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setf (ship-x-position ship2) 100)
</td></tr></table>
      <!--l. 254--><p class="noindent" >
</div>
</div>
      <!--l. 255--><p class="noindent" >This alters the <i>x</i>-position of <i>ship2</i> to be 100. This works because <a 
href="clmse99.html#x123-227002r580">defstruct</a>
      behaves as if it generates an appropriate defsetf form for each access
      function.
                                                                          

                                                                          
      </li>
      <li class="itemize">Можно использовать <a 
href="clmse36.html#x48-90002r64">setf</a> для изменения компонентов объекта ship:
      <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(setf (ship-x-position ship2) 100)
</td></tr></table>
      <!--l. 264--><p class="noindent" >
</div>
</div>
      <!--l. 265--><p class="noindent" >Данная запись именяет позицию-<i>x</i> переменной <i>ship2</i> в 100. Она
      работает, потому что <a 
href="clmse99.html#x123-227002r580">defstruct</a> ведет себя так, будто создаёт
      соотвествующие defsetf формы для <i>функций доступа</i>.</li></ul>
<!--l. 270--><p class="indent" >   This simple example illustrates the power of <a 
href="clmse99.html#x123-227002r580">defstruct</a> to provide abstract
record structures in a convenient manner. <a 
href="clmse99.html#x123-227002r580">defstruct</a> has many other features as
well for specialized purposes.
<!--l. 274--><p class="indent" >   Этот простой пример отображает мощь и удобство <a 
href="clmse99.html#x123-227002r580">defstruct</a> для
представления записей структур. <a 
href="clmse99.html#x123-227002r580">defstruct</a> имеет много других возможностей
для специализированных целей.
                                                                          

                                                                          
   <!--l. 278--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse99.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#tailclmch19.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse98.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse98.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 278--><p class="indent" >   <a 
 id="tailclmse98.html"></a>  
</body></html> 
