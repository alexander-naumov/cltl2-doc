<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Объединение, отображение и приведение последовательностей</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-20 19:35:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1648--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse78.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse76.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse76.html#tailclmse76.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse77.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse77.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">14.2   </span> <a 
href="clm.html#QQ2-96-225" id="x96-19700014.2">Объединение, отображение и приведение последовательностей</a></h3>
<!--l. 1650--><p class="noindent" >Функции в этом разделе могут обрабатывать произвольное количество
последовательностей за исключением функции <a 
href="#x96-197016r375">reduce</a>, которая была
включена сюда из-за концептуальной связи с функциями отображения.
<div class=defun>
<!--l. 1654--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197001"></a><a 
 id="x96-197002r368"></a><b> concatenate</b>  <i>result-type</i> &#x0026;rest  <i>sequences</i>
<!--l. 1656--><p class="noindent" >Результатом является новая последовательность, которая содержит по
порядку все элементы указанных
последовательностей. Результат не содержит связей с аргументами (в этом
<a 
href="#x96-197002r368">concatenate</a> отличается от <a 
href="clmse134.html#x165-333002r821">append</a>). Тип результата указывается в аргументе
<i>result-type</i>, который должен быть подтипом sequence, как для функции <a 
href="clmse25.html#x34-53002r7">coerce</a>.
Необходимо, чтобы элементы исходных последовательностей принадлежали
указанному типу <i>result-type</i>.
<!--l. 1666--><p class="indent" >   Если указана только одна последовательность, и она имеет тот же тип,
что указан в <i>result-type</i>, <a 
href="#x96-197002r368">concatenate</a> всё равно копирует аргумент и
возвращает новую последовательность. Если вам не требуется копия, а
просто необходимо преобразовать тип последовательности, лучше
использовать <a 
href="clmse25.html#x34-53002r7">coerce</a>.
</div>
<div class=defun>
<!--l. 1673--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197003"></a><a 
 id="x96-197004r369"></a><b> map</b>  <i>result-type</i> <i>function</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i>
<!--l. 1675--><p class="noindent" >Функция <i>function</i> должна принимать только аргументов, сколько
последовательностей было передано в <a 
href="#x96-197004r369">map</a>. Результат функции <a 
href="#x96-197004r369">map</a>
— последовательность, элементы которой являются результатами
применения функции <i>function</i> к соответствующим элементам исходных
последовательностей. Длина итоговой последовательности равна длине самой
короткой исходной.
<!--l. 1683--><p class="indent" >   Если функция <i>function</i> имеет побочные эффекты, она может рассчитывать
на то, что сначала будет вызвана со всеми элементами в 0-ой позиции, затем
со всеми в 1-ой и так далее.
                                                                          

                                                                          
<!--l. 1687--><p class="indent" >   Тип итоговой последовательности указывается в аргументе <i>result-type</i> (и
должен быть подтипом sequence). Кроме того, для типа можно указать <a 
href="clmse31.html#x42-74002r18">nil</a>, и
это означает, что результата быть не должно. В таком случае функция
<i>function</i> вызывается только для побочных эффектов, и <a 
href="#x96-197004r369">map</a> возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>. В
этом случае <a 
href="#x96-197004r369">map</a> похожа на <a 
href="clmse42.html#x54-125007r97">mapc</a>.
<!--l. 1694--><p class="indent" >   Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(map &#x2019;list #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (-1 -2 -3 -4)
</td></tr></table>
<!--l. 1696--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(map &#x2019;string</td></tr></table>
<!--l. 1697--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     #&#x2019;(lambda (x) (if (oddp x) #\1 #\0))</td></tr></table>
<!--l. 1698--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     &#x2019;(1 2 3 4))</td></tr></table>
<!--l. 1699--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> &#x0022;1010&#x0022;</td></tr></table>
<!--l. 1701--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 1705--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197005"></a><a 
 id="x96-197006r370"></a><b> map-into</b>  <i>result-sequence</i> <i>function</i> &#x0026;rest  <i>sequences</i>
<!--l. 1707--><p class="noindent" >Функция <a 
href="#x96-197006r370">map-into</a> вычисляет последовательность с помощью применения
функции <i>function</i> к соответствующим элементам исходных последовательностей
и помещает результат в последовательность <i>result-sequence</i>. Функция
возвращается <i>result-sequence</i>.
<!--l. 1713--><p class="indent" >   Аргументы <i>result-sequence</i> и все <i>sequences</i> должны быть списками или
векторами (одномерными массивами). Функция <i>function</i> должна принимать
столько аргументов, сколько было указано исходных последовательностей.
Если <i>result-sequence</i> и другие аргументы <i>sequences</i> не одинаковой длины, цикл
закончится на самой короткой последовательности. Если <i>result-sequence</i>
является вектором с указателем заполнения, то этот указатель во время
цикла игнорируется, а после завершения устанавливается на то количество
элементов, которые были получены от функции <i>function</i>.
<!--l. 1723--><p class="indent" >   Если функция <i>function</i> имеет побочные эффекты, она может рассчитывать
на то, что сначала будет вызвана со всеми элементами в 0-ой позиции, затем
со всеми в 1-ой и так далее.
<!--l. 1727--><p class="indent" >   Функция <a 
href="#x96-197006r370">map-into</a> отличается от <a 
href="#x96-197004r369">map</a> тем, что модифицирует уже
имеющуюся последовательность, а не создаёт новую. Кроме того, <a 
href="#x96-197006r370">map-into</a>
                                                                          

                                                                          
может быть вызвана только с двумя аргументами (<i>result-sequence</i> и <i>function</i>),
тогда как <a 
href="#x96-197004r369">map</a> требует как минимум три параметра.
<!--l. 1732--><p class="indent" >   Если <i>result-sequence</i> является <a 
href="clmse31.html#x42-74002r18">nil</a>, <a 
href="#x96-197006r370">map-into</a> немедленно возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>,
потому что длина <a 
href="clmse31.html#x42-74002r18">nil</a> последовательности равняется нулю.
</div>
<div class=defun>
<!--l. 1738--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197007"></a><a 
 id="x96-197008r371"></a><b> some</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx96-197009"></a><a 
 id="x96-197010r372"></a><b> every</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx96-197011"></a><a 
 id="x96-197012r373"></a><b> notany</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx96-197013"></a><a 
 id="x96-197014r374"></a><b> notevery</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i>
<!--l. 1743--><p class="noindent" >Всё это предикаты. Функция <i>predicate</i> должна принимать столько
аргументов, сколько было указано последовательностей. Функция <i>predicate</i>
сначала применяется к элементам 0-ой позиции, затем, возможно, к
элементам 1-ой позиции, и так далее, до тех пор пока не сработает условие
завершения цикла или не закончится одна из последовательностей
<i>sequences</i>.
<!--l. 1751--><p class="indent" >   Если <i>predicate</i> имеет побочные эффекты, он может рассчитывать на то,
что сначала будет вызвана со всеми элементами в 0-ой позиции, затем со
всеми в 1-ой и так далее.
<!--l. 1755--><p class="indent" >   <a 
href="#x96-197008r371">some</a> завершается, как только применение <i>predicate</i> вернёт не-<a 
href="clmse31.html#x42-74002r18">nil</a> значение.
Тогда <a 
href="#x96-197008r371">some</a> возвращает значение, на котором произошла остановка. Если
цикл достиг конца последовательности и ни одно применение <i>predicate</i> не
вернуло не-<a 
href="clmse31.html#x42-74002r18">nil</a>, тогда возвращается значение <a 
href="clmse31.html#x42-74002r18">nil</a>. Таким образом, можно
сказать, что предикат <a 
href="#x96-197008r371">some</a> истинен, если <i>какой-либо (some)</i> вызов <i>predicate</i>
истинен.
<!--l. 1762--><p class="indent" >   <a 
href="#x96-197010r372">every</a> возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>, как только применение <i>predicate</i> возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>.
Если цикл достиг конца последовательности, <a 
href="#x96-197010r372">every</a> возвращает не-<a 
href="clmse31.html#x42-74002r18">nil</a>. Таким
образом, можно сказать, что предикат <a 
href="#x96-197010r372">every</a> истинен, если <i>каждый (every)</i>
вызов <i>predicate</i> истинен.
<!--l. 1768--><p class="indent" >   <a 
href="#x96-197012r373">notany</a> возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>, как только применение <i>predicate</i> возвращает не-<a 
href="clmse31.html#x42-74002r18">nil</a>.
Если цикл достиг конца последовательности, <a 
href="#x96-197012r373">notany</a> возвращает не-<a 
href="clmse31.html#x42-74002r18">nil</a>. Таким
образом, можно сказать, что предикат <a 
href="#x96-197012r373">notany</a> истинен, если <i>ни какой
(notany)</i> вызов <i>predicate</i> не истинен.
<!--l. 1774--><p class="indent" >   <a 
href="#x96-197014r374">notevery</a> возвращает не-<a 
href="clmse31.html#x42-74002r18">nil</a>, как только применение <i>predicate</i> возвращает
<a 
href="clmse31.html#x42-74002r18">nil</a>. Если цикл достиг конца последовательности, <a 
href="#x96-197014r374">notevery</a> возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>.
Таким образом, можно сказать, что предикат <a 
href="#x96-197014r374">notevery</a> истинен, если <i>ни
каждый (notany)</i> вызов <i>predicate</i> истинен.
</div>
                                                                          

                                                                          
<div class=defun>
<!--l. 1781--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197015"></a><a 
 id="x96-197016r375"></a><b> reduce</b>  <i>function</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:start</i> <i>:end</i> <i>:initial-value</i>
<!--l. 1783--><p class="noindent" >Функция <a 
href="#x96-197016r375">reduce</a> объединяет все элементы последовательности использую
заданную (бинарную binary) операцию. Например <a 
href="clmse106.html#x131-239002r586">+</a> может суммировать все
элементы последовательности.
<!--l. 1788--><p class="indent" >   Указанная подпоследовательность последовательности <i>sequence</i>
объединяется или «редуцируется» с помощью функции <i>function</i>, которая
должна принимать два аргумента. Приведение (редуцирование, объединение)
является левоассоциативным, если только :from-end не содержит истину, в
последнем случае операция становиться правоассоциативной. По-умолчанию
:from-end равно <a 
href="clmse31.html#x42-74002r18">nil</a>. Если задан аргумент :initial-value, то он логически
помещается перед подпоследовательностью (или после в случае истинности
:from-end) и включается в операцию редуцирования.
<!--l. 1798--><p class="indent" >   Если указанная подпоследовательность содержит только один элемент и
параметр :initial-value не задан, тогда этот элемент возвращается, и функция
<i>function</i> ни разу не вызывается. Если заданная подпоследовательность пуста,
и задан параметр :initial-value, тогда возвращается :initial-value, и функция
<i>function</i> не вызывается.
<!--l. 1804--><p class="indent" >   Если заданная подпоследовательность пуста, и параметр :initial-value не
задан, тогда функция <i>function</i> вызывается без аргументов, и <a 
href="#x96-197016r375">reduce</a>
возвращает то, что вернула эта функция. Это единственное исключение из
правила о том, что функция <i>function</i> вызывается с двумя аргументами.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> 10
</td></tr></table>
<!--l. 1810--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ≡</span> (- (- (- 1 2) 3) 4) <span class="math"> ⇒</span> -8</td></tr></table>
<!--l. 1811--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;- &#x2019;(1 2 3 4) :from-end t)     ;Альтернативная сумма</td></tr></table>
<!--l. 1812--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (- 1 (- 2 (- 3 4))) <span class="math"> ⇒</span> -2</td></tr></table>
<!--l. 1813--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;()) <span class="math"> ⇒</span> 0</td></tr></table>
<!--l. 1814--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;(3)) <span class="math"> ⇒</span> 3</td></tr></table>
<!--l. 1815--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;(foo)) <span class="math"> ⇒</span> foo</td></tr></table>
<!--l. 1816--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (((1 2) 3) 4)</td></tr></table>
<!--l. 1817--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4) :from-end t) <span class="math"> ⇒</span> (1 (2 (3 4)))</td></tr></table>
<!--l. 1818--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4) :initial-value &#x2019;foo)</td></tr></table>
                                                                          

                                                                          
<!--l. 1819--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> ((((foo 1) 2) 3) 4)</td></tr></table>
<!--l. 1820--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4)</td></tr></table>
<!--l. 1821--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        :from-end t :initial-value &#x2019;foo)</td></tr></table>
<!--l. 1822--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> (1 (2 (3 (4 foo))))</td></tr></table>
<!--l. 1824--><p class="indent" >
</div>
</div>
<!--l. 1825--><p class="noindent" >Если функция <i>function</i> имеет побочные эффекта, можно положится на порядок
вызовов функции так, как было продемонстрировано выше.
<!--l. 1828--><p class="indent" >   Имя «reduce» было позаимствовано из APL.
</div>
                                                                          

                                                                          
   <!--l. 1831--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse78.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse76.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse76.html#tailclmse76.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse77.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse77.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 1831--><p class="indent" >   <a 
 id="tailclmse77.html"></a>  
</body></html> 
