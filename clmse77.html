<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Concatenating, Mapping, and Reducing Sequences</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-19 16:08:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 401--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse78.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse76.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse76.html#tailclmse76.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse77.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse77.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">14.2   </span> <a 
href="clm.html#QQ2-96-225" id="x96-19700014.2">Concatenating, Mapping, and Reducing Sequences</a></h3>
<!--l. 403--><p class="noindent" >The functions in this section each operate on an arbitrary number of sequences
except for <a 
href="#x96-197021r376">reduce</a>, which is included here because of its conceptual relationship to
the mapping functions.
<div class=defun>
<!--l. 407--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197001"></a><a 
 id="x96-197002r369"></a><b> concatenate</b>  <i>result-type</i> &#x0026;rest  <i>sequences</i>
<!--l. 409--><p class="noindent" >The result is a new sequence that contains all the elements of all the sequences in
order. All of the sequences are copied from; the result does not share any
structure with any of the argument sequences (in this <a 
href="#x96-197002r369">concatenate</a> diﬀers from
<a 
href="clmse134.html#x165-333002r822">append</a>). The type of the result is speciﬁed by result-type, which must be a
subtype of sequence, as for the function <a 
href="clmse25.html#x34-53002r7">coerce</a>. It must be possible for every
element of the argument sequences to be an element of a sequence of type
result-type.
<!--l. 419--><p class="indent" >   If only one sequence argument is provided and it has the type speciﬁed by
result-type, <a 
href="#x96-197002r369">concatenate</a> is required to copy the argument rather than simply
returning it. If a copy is not required, but only possibly type conversion, then the
<a 
href="clmse25.html#x34-53002r7">coerce</a> function may be appropriate.
<div class=newer>
<!--l. 426--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx96-197003"></a>to specify that <a 
href="#x96-197002r369">concatenate</a> should signal an error if
the sequence type speciﬁes the number of elements and the sum of the argument
lengths is diﬀerent.
</div>
</div>
<div class=defun>
<!--l. 432--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197004"></a><a 
 id="x96-197005r370"></a><b> map</b>  <i>result-type</i> <i>function</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i>
<!--l. 434--><p class="noindent" >The function must take as many arguments as there are sequences provided; at
least one sequence must be provided. The result of <a 
href="#x96-197005r370">map</a> is a sequence such that
element j is the result of applying function to element j of each of the argument
sequences. The result sequence is as long as the shortest of the input
sequences.
<!--l. 442--><p class="indent" >   If the function has side eﬀects, it can count on being called ﬁrst on all the
                                                                          

                                                                          
elements numbered 0, then on all those numbered 1, and so on.
<!--l. 446--><p class="indent" >   The type of the result sequence is speciﬁed by the argument result-type
(which must be a subtype of the type sequence), as for the function <a 
href="clmse25.html#x34-53002r7">coerce</a>.
In addition, one may specify <a 
href="clmse31.html#x42-74002r18">nil</a> for the result type, meaning that no
result sequence is to be produced; in this case the function is invoked only
for eﬀect, and <a 
href="#x96-197005r370">map</a> returns <a 
href="clmse31.html#x42-74002r18">nil</a>. This gives an eﬀect similar to that of
<a 
href="clmse42.html#x54-125007r97">mapc</a>.
<div class=newer>
<!--l. 455--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx96-197006"></a>to specify that <a 
href="#x96-197005r370">map</a> should signal an error if the
sequence type speciﬁes the number of elements and the minimum of the argument
lengths is diﬀerent.
</div>
<div class=new>
<!--l. 461--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx96-197007"></a>to restrict user side eﬀects; see section ??.
</div>
<div class=incompatibility>
<!--l. 467--><p class="noindent" ><b>Compatibility note:</b> In MacLisp, Lisp Machine Lisp, Interlisp, and indeed even Lisp
1.5, the function <a 
href="#x96-197005r370">map</a> has always meant a non-value-returning version. However,
standard computer science literature, including in particular the recent wave of papers
on “functional programming,” have come to use <a 
href="#x96-197005r370">map</a> to mean what in the past Lisp
implementations have called <a 
href="clmse42.html#x54-125003r95">mapcar</a>. To simplify things henceforth, Common Lisp
follows current usage, and what was formerly called <a 
href="#x96-197005r370">map</a> is named <a 
href="clmse42.html#x54-125009r98">mapl</a> in Common
Lisp.
</div>
<!--l. 480--><p class="noindent" >For example: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(map &#x2019;list #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (-1 -2 -3 -4)
</td></tr></table>
<!--l. 483--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(map &#x2019;string</td></tr></table>
<!--l. 484--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     #&#x2019;(lambda (x) (if (oddp x) #\1 #\0))</td></tr></table>
<!--l. 485--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     &#x2019;(1 2 3 4))</td></tr></table>
<!--l. 486--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> &#x0022;1010&#x0022;</td></tr></table>
<!--l. 488--><p class="indent" >
</div>
</div>
</div>
<div class=newer>
                                                                          

                                                                          
<div class=defun>
<!--l. 493--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197008"></a><a 
 id="x96-197009r371"></a><b> map-into</b>  <i>result-sequence</i> <i>function</i> &#x0026;rest  <i>sequences</i>
<!--l. 495--><p class="noindent" >X3J13 voted in June 1989 <a 
 id="dx96-197010"></a>to add the function <a 
href="#x96-197009r371">map-into</a>. It destructively
modiﬁes the result-sequence to contain the results of applying function to
corresponding elements of the argument sequences in turn; it then returns
result-sequence.
<!--l. 502--><p class="indent" >   The arguments result-sequence and each element of sequences can each
be either a list or a vector (one-dimensional array). The <a 
href="clmse35.html#x47-85002r52">function</a> must
accept at least as many arguments as the number of argument sequences
supplied to <a 
href="#x96-197009r371">map-into</a>. If result-sequence and the other argument sequences
are not all the same length, the iteration terminates when the shortest
sequence is exhausted. If result-sequence is a vector with a ﬁll pointer, the ﬁll
pointer is ignored when deciding how many iterations to perform, and
afterwards the ﬁll pointer is set to the number of times the function was
applied.
<!--l. 514--><p class="indent" >   If the function has side eﬀects, it can count on being called ﬁrst on all the
elements numbered 0, then on all those numbered 1, and so on.
<!--l. 518--><p class="indent" >   If result-sequence is longer than the shortest element of sequences, extra
elements at the end of result-sequence are unchanged.
<!--l. 521--><p class="indent" >   The function <a 
href="#x96-197009r371">map-into</a> diﬀers from <a 
href="#x96-197005r370">map</a> in that it modiﬁes an existing
sequence rather than creating a new one. In addition, <a 
href="#x96-197009r371">map-into</a> can be called with
only two arguments (result-sequence and function), while <a 
href="#x96-197005r370">map</a> requires at least
three arguments.
<!--l. 526--><p class="indent" >   If result-sequence is <a 
href="clmse31.html#x42-74002r18">nil</a>, <a 
href="#x96-197009r371">map-into</a> immediately returns <a 
href="clmse31.html#x42-74002r18">nil</a>, because <a 
href="clmse31.html#x42-74002r18">nil</a> is a
sequence of length zero.
</div>
</div>
<div class=defun>
<!--l. 532--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197011"></a><a 
 id="x96-197012r372"></a><b> some</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx96-197013"></a><a 
 id="x96-197014r373"></a><b> every</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx96-197015"></a><a 
 id="x96-197016r374"></a><b> notany</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx96-197017"></a><a 
 id="x96-197018r375"></a><b> notevery</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i>
<!--l. 537--><p class="noindent" >These are all predicates. The predicate must take as many arguments as there are
sequences provided. The predicate is ﬁrst applied to the elements with index 0 in
each of the sequences, and possibly then to the elements with index 1, and so on,
until a termination criterion is met or the end of the shortest of the sequences is
reached.
<!--l. 545--><p class="indent" >   If the predicate has side eﬀects, it can count on being called ﬁrst on all the
                                                                          

                                                                          
elements numbered 0, then on all those numbered 1, and so on.
<!--l. 549--><p class="indent" >   <a 
href="#x96-197012r372">some</a> returns as soon as any invocation of predicate returns a non-<a 
href="clmse31.html#x42-74002r18">nil</a> value;
<a 
href="#x96-197012r372">some</a> returns that value. If the end of a sequence is reached, <a 
href="#x96-197012r372">some</a> returns <a 
href="clmse31.html#x42-74002r18">nil</a>.
Thus, considered as a predicate, it is true if some invocation of predicate is
true.
<!--l. 555--><p class="indent" >   <a 
href="#x96-197014r373">every</a> returns <a 
href="clmse31.html#x42-74002r18">nil</a> as soon as any invocation of predicate returns <a 
href="clmse31.html#x42-74002r18">nil</a>. If
the end of a sequence is reached, <a 
href="#x96-197014r373">every</a> returns a non-<a 
href="clmse31.html#x42-74002r18">nil</a> value. Thus,
considered as a predicate, it is true if every invocation of predicate is
true.
<!--l. 561--><p class="indent" >   <a 
href="#x96-197016r374">notany</a> returns <a 
href="clmse31.html#x42-74002r18">nil</a> as soon as any invocation of predicate returns a non-<a 
href="clmse31.html#x42-74002r18">nil</a>
value. If the end of a sequence is reached, <a 
href="#x96-197016r374">notany</a> returns a non-<a 
href="clmse31.html#x42-74002r18">nil</a> value.
Thus, considered as a predicate, it is true if no invocation of predicate is
true.
<!--l. 567--><p class="indent" >   <a 
href="#x96-197018r375">notevery</a> returns a non-<a 
href="clmse31.html#x42-74002r18">nil</a> value as soon as any invocation of predicate
returns <a 
href="clmse31.html#x42-74002r18">nil</a>. If the end of a sequence is reached, <a 
href="#x96-197018r375">notevery</a> returns <a 
href="clmse31.html#x42-74002r18">nil</a>. Thus,
considered as a predicate, it is true if not every invocation of predicate is
true.
<div class=new>
<!--l. 574--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx96-197019"></a>to restrict user side eﬀects; see section ??.
</div>
<div class=incompatibility>
<!--l. 580--><p class="noindent" ><b>Compatibility note:</b> The order of the arguments here is not compatible with Interlisp
and Lisp Machine Lisp. This is to stress the similarity of these functions to <a 
href="#x96-197005r370">map</a>. The
functions are therefore extended here to functions of more than one argument, and to
multiple sequences.
</div>
</div>
<div class=defun>
<!--l. 590--><p class="noindent" ><i>[Function]</i><a 
 id="dx96-197020"></a><a 
 id="x96-197021r376"></a><b> reduce</b>  <i>function</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:start</i> <i>:end</i> <i>:initial-value</i>
<!--l. 592--><p class="noindent" >The <a 
href="#x96-197021r376">reduce</a> function combines all the elements of a sequence using a binary
operation; for example, using <a 
href="clmse106.html#x131-239002r587">+</a> one can add up all the elements.
<!--l. 597--><p class="indent" >   The speciﬁed subsequence of the sequence is combined or “reduced” using the
function, which must accept two arguments. The reduction is left-associative,
unless the :from-end argument is true (it defaults to <a 
href="clmse31.html#x42-74002r18">nil</a>), in which case it is
right-associative. If an :initial-value argument is given, it is logically placed before
the subsequence (after it if :from-end is true) and included in the reduction
operation.
<!--l. 606--><p class="indent" >   If the speciﬁed subsequence contains exactly one element and the keyword
                                                                          

                                                                          
argument :initial-value is not given, then that element is returned and
the function is not called. If the speciﬁed subsequence is empty and an
:initial-value is given, then the :initial-value is returned and the function is not
called.
<!--l. 614--><p class="indent" >   If the speciﬁed subsequence is empty and no :initial-value is given, then the
function is called with zero arguments, and <a 
href="#x96-197021r376">reduce</a> returns whatever the function
does. (This is the only case where the function is called with other than two
arguments.)
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> 10
</td></tr></table>
<!--l. 621--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ≡</span> (- (- (- 1 2) 3) 4) <span class="math"> ⇒</span> -8</td></tr></table>
<!--l. 622--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;- &#x2019;(1 2 3 4) :from-end t)     ;Alternating sum</td></tr></table>
<!--l. 623--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (- 1 (- 2 (- 3 4))) <span class="math"> ⇒</span> -2</td></tr></table>
<!--l. 624--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;()) <span class="math"> ⇒</span> 0</td></tr></table>
<!--l. 625--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;(3)) <span class="math"> ⇒</span> 3</td></tr></table>
<!--l. 626--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;(foo)) <span class="math"> ⇒</span> foo</td></tr></table>
<!--l. 627--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (((1 2) 3) 4)</td></tr></table>
<!--l. 628--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4) :from-end t) <span class="math"> ⇒</span> (1 (2 (3 4)))</td></tr></table>
<!--l. 629--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4) :initial-value &#x2019;foo)</td></tr></table>
<!--l. 630--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> ((((foo 1) 2) 3) 4)</td></tr></table>
<!--l. 631--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4)</td></tr></table>
<!--l. 632--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        :from-end t :initial-value &#x2019;foo)</td></tr></table>
<!--l. 633--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> (1 (2 (3 (4 foo))))</td></tr></table>
<!--l. 635--><p class="indent" >
</div>
</div>
<!--l. 636--><p class="noindent" >If the function produces side eﬀects, the order of the calls to the function
can be correctly predicted from the reduction ordering demonstrated
above.
<!--l. 640--><p class="indent" >   The name “reduce” for this function is borrowed from APL.
<div class=new>
<!--l. 643--><p class="indent" >   X3J13 voted in March 1988 <a 
 id="dx96-197022"></a>to extend the <a 
href="#x96-197021r376">reduce</a> function to take an
                                                                          

                                                                          
additional keyword argument named :key. As usual, this argument defaults to the
identity function. The value of this argument must be a function that accepts at
least one argument. This function is applied once to each element of the sequence
that is to participate in the reduction operation, in the order implied by the
:from-end argument; the values returned by this function are combined by the
reduction function. However, the :key function is not applied to the :initial-value
argument (if any).
</div>
<div class=new>
<!--l. 657--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx96-197023"></a>to restrict user side eﬀects; see section ??.
</div>
</div>
                                                                          

                                                                          
   <!--l. 663--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse78.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse76.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse76.html#tailclmse76.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse77.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse77.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 663--><p class="indent" >   <a 
 id="tailclmse77.html"></a>  
</body></html> 
