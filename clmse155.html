<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Program Interface to the Condition System</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-02-20 00:42:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1088--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse156.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse154.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse154.html#tailclmse154.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse155.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch29.html#clmse155.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">29.4   </span> <a 
 id="x189-33400029.4"></a>Program Interface to the Condition System</h3>
<!--l. 1090--><p class="noindent" >This section describes functions, macros, variables, and condition types associated
with the Common Lisp Condition System.
<!--l. 1094--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.1   </span> <a 
 id="x189-33500029.4.1"></a>Signaling Conditions</h4>
<!--l. 1098--><p class="noindent" >The functions in this section provide various mechanisms for signaling warnings,
breaks, continuable errors, and fatal errors.
<div class=defun>
<!--l. 1102--><p class="noindent" > <i>[Function]</i>   <b>error</b> <a 
 id="dx189-335001"></a><a 
 id="x189-335002r989"></a>   <i>datum</i>  <b>&#x0026;rest</b>  arguments
<!--l. 1104--><p class="noindent" >[This supersedes the description of <i>error</i> given in section <a 
href="clmse124.html#x153-22000024.1">24.1<!--tex4ht:ref: ERROR-SIGNALLING-FUNCTIONS --></a>.—GLS]
<!--l. 1108--><p class="indent" >   Invokes the signal facility on a condition. If the condition is not handled,
<i>(invoke-debugger condition)</i> is executed. As a consequence of calling <i>invoke-debugger</i>,
<i>error</i> never directly returns to its caller; the only exit from this function can come
by non-local transfer of control in a handler or by use of an interactive debugging
command.
<!--l. 1114--><p class="indent" >   If datum is a condition, then that condition is used directly. In this case, it is
an error for the list of arguments to be non-empty; that is, <i>error</i> must have been
called with exactly one argument, the condition.
<!--l. 1118--><p class="indent" >   If datum is a condition type (a class or class name), then the condition used is
eﬀectively the result of <i>(apply #&#x2019;make-condition datum arguments)</i>.
<!--l. 1121--><p class="indent" >   If datum is a string, then the condition used is eﬀectively the result of <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-condition &#x2019;simple-error
</td></tr></table>
<!--l. 1123--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-string datum</td></tr></table>
<!--l. 1124--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-arguments arguments)</td></tr></table>
<!--l. 1126--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
</div>
<div class=defun>
<!--l. 1129--><p class="noindent" > <i>[Function]</i>   <b>cerror</b> <a 
 id="dx189-335003"></a><a 
 id="x189-335004r990"></a>   <i>continue-format-string</i>  <i>datum</i>  <b>&#x0026;rest</b>  arguments
<!--l. 1131--><p class="noindent" >[This supersedes the description of <i>cerror</i> given in section <a 
href="clmse124.html#x153-22000024.1">24.1<!--tex4ht:ref: ERROR-SIGNALLING-FUNCTIONS --></a>.—GLS]
<!--l. 1135--><p class="indent" >   The function <i>cerror</i> invokes the error facility on a condition. If the condition is
not handled, <i>(invoke-debugger condition)</i> is executed. While signaling is going on,
and while control is in the debugger (if it is reached), it is possible to continue
program execution (thereby returning from the call to <i>cerror</i>) using the <i>continue</i>
restart.
<!--l. 1143--><p class="indent" >   If datum is a condition, then that condition is used directly. In this case,
the list of arguments need not be empty, but will be used only with the
continue-format-string and will not be used to initialize datum.
<!--l. 1148--><p class="indent" >   If datum is a condition type (a class or class name), then the condition used is
eﬀectively the result of <i>(apply #&#x2019;make-condition datum arguments)</i>.
<!--l. 1151--><p class="indent" >   If datum is a string, then the condition used is eﬀectively the result of <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-condition &#x2019;simple-error
</td></tr></table>
<!--l. 1153--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-string datum</td></tr></table>
<!--l. 1154--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-arguments arguments)</td></tr></table>
<!--l. 1156--><p class="indent" >
</div>
</div>
<!--l. 1158--><p class="indent" >   The continue-format-string must be a string. Note that if datum is not a
string, then the format arguments used by the continue-format-string will still be
the list of arguments (which is in keyword format if datum is a condition type). In
this case, some care may be necessary to set up the continue-format-string
correctly. The <i>format</i> directive <i><tt>~</tt>*</i>, which ignores and skips over <i>format</i>
arguments, may be particularly useful in this situation.
<!--l. 1168--><p class="indent" >   The value returned by <i>cerror</i> is <i>nil</i>.
</div>
<div class=defun>
<!--l. 1171--><p class="noindent" > <i>[Function]</i>   <b>signal</b> <a 
 id="dx189-335005"></a><a 
 id="x189-335006r991"></a>   <i>datum</i>  <b>&#x0026;rest</b>  arguments
<!--l. 1173--><p class="noindent" >Invokes the signal facility on a condition. If the condition is not handled, <i>signal</i>
                                                                          

                                                                          
returns <i>nil</i>.
<!--l. 1177--><p class="indent" >   If datum is a condition, then that condition is used directly. In this case, it is
an error for the list of arguments to be non-empty; that is, <i>error</i> must have been
called with exactly one argument, the condition.
<!--l. 1181--><p class="indent" >   If datum is a condition type (a class or class name), then the condition used is
eﬀectively the result of <i>(apply #&#x2019;make-condition datum arguments)</i>.
<!--l. 1184--><p class="indent" >   If datum is a string, then the condition used is eﬀectively the result of <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-condition &#x2019;simple-error
</td></tr></table>
<!--l. 1186--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-string datum</td></tr></table>
<!--l. 1187--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-arguments arguments)</td></tr></table>
<!--l. 1189--><p class="indent" >
</div>
</div>
<!--l. 1191--><p class="indent" >   Note that if <i>(typep condition *break-on-signals*)</i> is true, then the
debugger will be entered prior to beginning the process of signaling. The
<i>continue</i> restart function may be used to continue with the signaling
process; the restart is associated with the signaled condition as if by use
of <i>with-condition-restarts</i>. This is true also for all other functions and
macros that signal conditions, such as <i>warn</i>, <i>error</i>, <i>cerror</i>, <i>assert</i>, and
<i>check-type</i>.
<!--l. 1200--><p class="indent" >   During the dynamic extent of a call to <i>signal</i> with a particular condition, the
eﬀect of calling <i>signal</i> again on that condition object for a distinct abstract event
is not deﬁned. For example, although a handler may resignal a condition in order
to allow outer handlers ﬁrst shot at handling the condition, two distinct
asynchronous keyboard events must not signal an the same (<i>eq</i>) condition object
at the same time.
<!--l. 1208--><p class="indent" >   For further details about signaling and handling, see the discussion of
condition handlers in section <a 
href="clmse154.html#x188-33200029.3.17">29.3.17<!--tex4ht:ref: CONDITION-HANDLERS --></a>.
</div>
<div class=defun>
<!--l. 1213--><p class="noindent" > <i>[Variable]</i>   <b>*break-on-signals*</b> <a 
 id="dx189-335007"></a><a 
 id="x189-335008r992"></a>
<!--l. 1215--><p class="noindent" >This variable is intended primarily for use when the user is debugging programs
that do signaling. The value of <i>*break-on-signals*</i> should be suitable as a second
argument to <i>typep</i>, that is, a type or type speciﬁer.
                                                                          

                                                                          
<!--l. 1221--><p class="indent" >   When <i>(typep condition *break-on-signals*)</i> is true, then calls to <i>signal</i> (and to
other advertised functions such as <i>error</i> that implicitly call <i>signal</i>) will enter the
debugger prior to signaling that condition. The <i>continue</i> restart may be used to
continue with the normal signaling process; the restart is associated with the
signaled condition as if by use of <i>with-condition-restarts</i>.
<!--l. 1229--><p class="indent" >   Note that <i>nil</i> is a valid type speciﬁer. If the value of <i>*break-on-signals*</i> is <i>nil</i>,
then <i>signal</i> will never enter the debugger in this implicit manner.
<!--l. 1233--><p class="indent" >   When setting this variable, the user is encouraged to choose the most
restrictive speciﬁcation that suﬃces. Setting this ﬂag eﬀectively violates the
modular handling of condition signaling that this chapter seeks to establish. Its
complete eﬀect may be unpredictable in some cases, since the user may not be
aware of the variety or number of calls to <i>signal</i> that are used in programs called
only incidentally.
<!--l. 1241--><p class="indent" >   By default—and certainly in any “production” use—the value of this variable
should be <i>nil</i>, both for reasons of performance and for reasons of modularity and
abstraction.
<div class=newer>
<!--l. 1246--><p class="indent" >   X3J13 voted in March 1989 ⟨<b>?</b>⟩ to remove <i>*break-on-warnings*</i> from the
language; <i>*break-on-signals*</i> oﬀers all the power of <i>*break-on-warnings*</i> and
more.
</div>
<div class=incompatibility>
<!--l. 1254--><p class="noindent" ><b>Compatibility note:</b> This variable is similar to the Zetalisp variable <i>trace-conditions</i>
except for the obvious diﬀerence that <i>zl:trace-conditions</i> takes a type or list of types
while <i>*break-on-signals*</i> takes a single type speciﬁer.
<!--l. 1260--><p class="indent" >   [There is no loss of generality in Common Lisp because the <i>or</i> type speciﬁer may be
used to indicate that any of a set of conditions should enter the debugger.—GLS]
</div>
</div>
<!--l. 1268--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.2   </span> <a 
 id="x189-33600029.4.2"></a>Assertions</h4>
<!--l. 1272--><p class="noindent" >These facilities are designed to make it convenient for the user to insert error
checks into code.
<div class=defmac>
<!--l. 1276--><p class="noindent" ><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> check-type </b> <a 
 id="dx189-336001"></a><a 
 id="x189-336002r993"></a>   place typespec  [ <i>string</i>]
</td></tr></table>
<!--l. 1277--><p class="indent" >
</div>
   [This supersedes the description of <i>check-type</i> given in section <a 
href="clmse125.html#x154-22100024.2">24.2<!--tex4ht:ref: SPECIALIZED-ERROR-SIGNALLING --></a>.—GLS]
   A <i>check-type</i> form signals an error of type <i>type-error</i> if the contents of place
are not of the desired type.
   If a condition is signaled, handlers of this condition can use the functions
<i>type-error-datum</i> and <i>type-error-expected-type</i> to access the contents of place and
the typespec, respectively.
   This function can return only if the <i>store-value</i> restart is invoked, either
explicitly from a handler or implicitly as one of the options oﬀered by the
debugger. The restart is associated with the signaled condition as if by use of
<i>with-condition-restarts</i>.
   If <i>store-value</i> is called, <i>check-type</i> will store the new value that is the argument
to <i>store-value</i> (or that is prompted for interactively by the debugger) in place and
start over, checking the type of the new value and signaling another error
if it is still not the desired type. Subforms of place may be evaluated
multiple times because of the implicit loop generated. <i>check-type</i> returns
<i>nil</i>.
   The place must be a generalized variable reference acceptable to <i>setf </i>. The
typespec must be a type speciﬁer; it is not evaluated. The <i>string</i> should
be an English description of the type, starting with an indeﬁnite article
(“a” or “an”); it is evaluated. If the string is not supplied, it is computed
automatically from the typespec. (The optional string argument is allowed because
some applications of <i>check-type</i> may require a more speciﬁc description
of what is wanted than can be generated automatically from the type
speciﬁer.)
   The error message will mention the place, its contents, and the desired
type.
<div class=implementation>
   <b>Implementation note:</b> An implementation may choose to generate a somewhat
diﬀerently worded error message if it recognizes that place is of a particular form, such as
one of the arguments to the function that called <i>check-type</i>.
</div>
<div class=lisp>
                                                                          

                                                                          
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (setq aardvarks &#x2019;(sam harry fred))
</td></tr></table>
<!--l. 1323--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ (SAM HARRY FRED)</td></tr></table>
<!--l. 1324--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (check-type aardvarks (array * (3)))</td></tr></table>
<!--l. 1325--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Error: The value of AARDVARKS, (SAM HARRY FRED),</td></tr></table>
<!--l. 1326--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       is not a 3-long array.</td></tr></table>
<!--l. 1327--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">To continue, type :CONTINUE followed by an option number:</td></tr></table>
<!--l. 1328--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 1: Specify a value to use instead.</td></tr></table>
<!--l. 1329--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 2: Return to Lisp Toplevel.</td></tr></table>
<!--l. 1330--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Debug&#x003E; :continue 1</td></tr></table>
<!--l. 1331--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Use Value: #(sam fred harry)</td></tr></table>
<!--l. 1332--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ NIL</td></tr></table>
<!--l. 1333--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; aardvarks</td></tr></table>
<!--l. 1334--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ #&#x003C;ARRAY-3 13571&#x003E;</td></tr></table>
<!--l. 1335--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (map &#x2019;list #&#x2019;identity aardvarks)</td></tr></table>
<!--l. 1336--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ (SAM FRED HARRY)</td></tr></table>
<!--l. 1337--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (setq aacount &#x2019;foo)</td></tr></table>
<!--l. 1338--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ FOO</td></tr></table>
<!--l. 1339--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (check-type aacount (integer 0 *) &#x0022;a non-negative integer&#x0022;)</td></tr></table>
<!--l. 1340--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Error: The value of AACOUNT, FOO, is not a non-negative integer.</td></tr></table>
<!--l. 1341--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">To continue, type :CONTINUE followed by an option number:</td></tr></table>
<!--l. 1342--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 1: Specify a value to use instead.</td></tr></table>
<!--l. 1343--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 2: Return to Lisp Toplevel.</td></tr></table>
<!--l. 1344--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Debug&#x003E; :continue 2</td></tr></table>
<!--l. 1345--><p class="indent" >                                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E;</td></tr></table>
<!--l. 1347--><p class="indent" >
</div>
</div>
<div class=incompatibility>
<!--l. 1350--><p class="noindent" ><b>Compatibility note:</b> In Zetalisp, the equivalent facility is called <i>check-arg-type</i>.
</div>
</div>
<div class=defmac>
<!--l. 1358--><p class="noindent" ><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> assert </b> <a 
 id="dx189-336003"></a><a 
 id="x189-336004r994"></a>   test-form  [ <i>({<i>place</i>}∗ ) [ <i>datum {<i>argument</i>}∗ </i>] </i>]
</td></tr></table>
<!--l. 1359--><p class="indent" >
</div>
   [This supersedes the description of <i>assert</i> given in section <a 
href="clmse125.html#x154-22100024.2">24.2<!--tex4ht:ref: SPECIALIZED-ERROR-SIGNALLING --></a>.—GLS]
   An <i>assert</i> form signals an error if the value of the test-form is <i>nil</i>. Continuing
from this error using the <i>continue</i> restart will allow the user to alter the values of
some variables, and <i>assert</i> will then start over, evaluating the test-form
again. (The restart is associated with the signaled condition as if by use of
<i>with-condition-restarts</i>.) <i>assert</i> returns <i>nil</i>.
   The test-form may be any form. Each place (there may be any number of
them, or none) must be a generalized variable reference acceptable to <i>setf </i>. These
should be variables on which test-form depends, whose values may sensibly be
changed by the user in attempting to correct the error. Subforms of each
place are evaluated only if an error is signaled, and may be re-evaluated
if the error is re-signaled (after continuing without actually ﬁxing the
problem).
   The datum and arguments are evaluated only if an error is to be signaled, and
re-evaluated if the error is to be signaled again.
   If datum is a condition, then that condition is used directly. In this case, it is
an error to specify any arguments.
   If datum is a condition type (a class or class name), then the condition used is
eﬀectively the result of <i>(apply #&#x2019;make-condition datum (list {<i>argument</i>}∗ ))</i>.
   If datum is a string, then the condition used is eﬀectively the result of <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-condition &#x2019;simple-error
</td></tr></table>
<!--l. 1391--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-string datum</td></tr></table>
<!--l. 1392--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-arguments (list  {<i>argument</i>}∗ ))</td></tr></table>
<!--l. 1394--><p class="indent" >
</div>
</div>
<!--l. 1396--><p class="noindent" >If datum is omitted, then a condition of type <i>simple-error</i> is constructed
using the test-form as data. For example, the following might be used: <div class=lisp>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-condition &#x2019;simple-error
</td></tr></table>
<!--l. 1400--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  :format-string &#x0022;The assertion <tt>~</tt>S failed.&#x0022;</td></tr></table>
<!--l. 1401--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  :format-arguments &#x2019;(test-form))</td></tr></table>
<!--l. 1403--><p class="indent" >
</div>
</div>
<!--l. 1404--><p class="noindent" >Note that the test-form itself, and not its value, is used as the format argument.
<div class=implementation>
<!--l. 1407--><p class="noindent" ><b>Implementation note:</b> The debugger need not include the test-form in the error
message, and any places should not be included in the message, but they should be made
available for the user&#x2019;s perusal. If the user gives the “continue” command, an
opportunity should be presented to alter the values of any or all of the references.
The details of this depend on the implementation&#x2019;s style of user interface, of
course.
</div>
<!--l. 1417--><p class="indent" >   Here is an example of the use of <i>assert</i>: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq x (make-array &#x2019;(3 5) :initial-element 3))
</td></tr></table>
<!--l. 1419--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq y (make-array &#x2019;(3 5) :initial-element 7))</td></tr></table>
<!--l. 1420--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1421--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun matrix-multiply (a b)</td></tr></table>
<!--l. 1422--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((*print-array* nil))</td></tr></table>
<!--l. 1423--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (assert (and (= (array-rank a) (array-rank b) 2)</td></tr></table>
<!--l. 1424--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (= (array-dimension a 1)</td></tr></table>
<!--l. 1425--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                    (array-dimension b 0)))</td></tr></table>
<!--l. 1426--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (a b)</td></tr></table>
<!--l. 1427--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            &#x0022;Cannot multiply <tt>~</tt>S by <tt>~</tt>S.&#x0022; a b)</td></tr></table>
<!--l. 1428--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (really-matrix-multiply a b)))</td></tr></table>
<!--l. 1429--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1430--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(matrix-multiply x y)</td></tr></table>
<!--l. 1431--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Error: Cannot multiply #&#x003C;ARRAY-3-5 12345&#x003E; by #&#x003C;ARRAY-3-5 12364&#x003E;.</td></tr></table>
<!--l. 1432--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">To continue, type :CONTINUE followed by an option number:</td></tr></table>
<!--l. 1433--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 1: Specify new values.</td></tr></table>
<!--l. 1434--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 2: Return to Lisp Toplevel.</td></tr></table>
                                                                          

                                                                          
<!--l. 1435--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Debug&#x003E; :continue 1</td></tr></table>
<!--l. 1436--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Value for A: x</td></tr></table>
<!--l. 1437--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Value for B: (make-array &#x2019;(5 3) :initial-element 6)</td></tr></table>
<!--l. 1438--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">  ⇒#2A(</td><td  
class="tabbing">(54 54 54 54 54)</td></tr></table>
<!--l. 1439--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">             </td><td  
class="tabbing">(54 54 54 54 54)</td></tr></table>
<!--l. 1440--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">             </td><td  
class="tabbing">(54 54 54 54 54)</td></tr></table>
<!--l. 1441--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">             </td><td  
class="tabbing">(54 54 54 54 54)</td></tr></table>
<!--l. 1442--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">             </td><td  
class="tabbing">(54 54 54 54 54))</td></tr></table>
<!--l. 1444--><p class="indent" >
</div>
</div>
</div>
<!--l. 1448--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.3   </span> <a 
 id="x189-33700029.4.3"></a>Exhaustive Case Analysis</h4>
<!--l. 1451--><p class="noindent" >The syntax for <i>etypecase</i> and <i>ctypecase</i> is the same as for <i>typecase</i>, except that no
<i>otherwise</i> clause is permitted. Similarly, the syntax for <i>ecase</i> and <i>ccase</i> is the
same as for <i>case</i> except for the <i>otherwise</i> clause.
<i>
<!--l. 1455--><p class="indent" >   etypecase</i> and <i>ecase</i> are similar to <i>typecase</i> and <i>case</i>, respectively, but
signal a non-continuable error rather than returning <i>nil</i> if no clause is
selected.
<i>
<!--l. 1458--><p class="indent" >   ctypecase</i> and <i>ccase</i> are also similar to <i>typecase</i> and <i>case</i>, respectively, but
signal a continuable error if no clause is selected.
<div class=defmac>
<!--l. 1463--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> etypecase </b> <a 
 id="dx189-337001"></a><a 
 id="x189-337002r995"></a>   keyform  {<i>(type{<i>form</i>}∗ )</div> }∗
</td></tr></table>
<!--l. 1464--><p class="indent" >
</div>
   [This supersedes the description of <i>etypecase</i> given in section <a 
href="clmse126.html#x155-22200024.3">24.3<!--tex4ht:ref: EXHAUSTIVE-CASE-ANALYSIS --></a>.—GLS]
   This control construct is similar to <i>typecase</i>, but no explicit <i>otherwise</i> or <i>t</i>
clause is permitted. If no clause is satisﬁed, <i>etypecase</i> signals an error (of type
                                                                          

                                                                          
<i>type-error</i>) with a message constructed from the clauses. It is not permissible to
continue from this error. To supply an error message, the user should use
<i>typecase</i> with an <i>otherwise</i> clause containing a call to <i>error</i>. The name of
this function stands for “exhaustive type case” or “error-checking type
case.”
   Example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (setq x 1/3)
</td></tr></table>
<!--l. 1478--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ 1/3</td></tr></table>
<!--l. 1479--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (etypecase x</td></tr></table>
<!--l. 1480--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (integer (* x 4))</td></tr></table>
<!--l. 1481--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (symbol (symbol-value x)))</td></tr></table>
<!--l. 1482--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Error: The value of X, 1/3, is neither an integer nor a symbol.</td></tr></table>
<!--l. 1483--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">To continue, type :CONTINUE followed by an option number:</td></tr></table>
<!--l. 1484--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 1: Return to Lisp Toplevel.</td></tr></table>
<!--l. 1485--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Debug&#x003E;</td></tr></table>
<!--l. 1487--><p class="indent" >
</div>
</div>
<div class=defmac>
   <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> ctypecase </b> <a 
 id="dx189-337003"></a><a 
 id="x189-337004r996"></a>   keyplace  {<i>(type{<i>form</i>}∗ )</div> }∗
</td></tr></table>
<!--l. 1492--><p class="indent" >
</div>
   [This supersedes the description of <i>ctypecase</i> given in section <a 
href="clmse126.html#x155-22200024.3">24.3<!--tex4ht:ref: EXHAUSTIVE-CASE-ANALYSIS --></a>.—GLS]
   This control construct is similar to <i>typecase</i>, but no explicit <i>otherwise</i> or <i>t</i>
clause is permitted.
   The keyplace must be a generalized variable reference acceptable to <i>setf </i>. If no
clause is satisﬁed, <i>ctypecase</i> signals an error (of type <i>type-error</i>) with a
message constructed from the clauses. This error may be continued using the
<i>store-value</i> restart. The argument to <i>store-value</i> is stored in keyplace
and then <i>ctypecase</i> starts over, making the type tests again. Subforms
of keyplace may be evaluated multiple times. If the <i>store-value</i> restart
                                                                          

                                                                          
is invoked interactively, the user will be prompted for the value to be
used.
   The name of this function is mnemonic for “continuable (exhaustive) type
case.”
   Example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (setq x 1/3)
</td></tr></table>
<!--l. 1514--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ 1/3</td></tr></table>
<!--l. 1515--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (ctypecase x</td></tr></table>
<!--l. 1516--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (integer (* x 4))</td></tr></table>
<!--l. 1517--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (symbol (symbol-value x)))</td></tr></table>
<!--l. 1518--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Error: The value of X, 1/3, is neither an integer nor a symbol.</td></tr></table>
<!--l. 1519--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">To continue, type :CONTINUE followed by an option number:</td></tr></table>
<!--l. 1520--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 1: Specify a value to use instead.</td></tr></table>
<!--l. 1521--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 2: Return to Lisp Toplevel.</td></tr></table>
<!--l. 1522--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Debug&#x003E; :continue 1</td></tr></table>
<!--l. 1523--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Use value: 3.7</td></tr></table>
<!--l. 1524--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Error: The value of X, 3.7, is neither an integer nor a symbol.</td></tr></table>
<!--l. 1525--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">To continue, type :CONTINUE followed by an option number:</td></tr></table>
<!--l. 1526--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 1: Specify a value to use instead.</td></tr></table>
<!--l. 1527--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 2: Return to Lisp Toplevel.</td></tr></table>
<!--l. 1528--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Debug&#x003E; :continue 1</td></tr></table>
<!--l. 1529--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Use value: 12</td></tr></table>
<!--l. 1530--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ 48</td></tr></table>
<!--l. 1532--><p class="indent" >
</div>
</div>
<div class=defmac>
   <div class=tabbing>
   )
</div> }∗
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> ecase </b> <a 
 id="dx189-337005"></a><a 
 id="x189-337006r997"></a>   keyform  {<i>( {<i>( {<i>key</i>}∗ ) | key</div> }{<i>form</i>}∗
</td></tr></table>
<!--l. 1538--><p class="indent" >
                                                                          

                                                                          
</div>
   [This supersedes the description of <i>ecase</i> given in section <a 
href="clmse126.html#x155-22200024.3">24.3<!--tex4ht:ref: EXHAUSTIVE-CASE-ANALYSIS --></a>.—GLS]
<!--l. 1542--><p class="noindent" >This control construct is similar to <i>case</i>, but no explicit <i>otherwise</i> or <i>t</i>
clause is permitted. If no clause is satisﬁed, <i>ecase</i> signals an error (of
type <i>type-error</i>) with a message constructed from the clauses. It is not
permissible to continue from this error. To supply an error message, the
user should use <i>case</i> with an <i>otherwise</i> clause containing a call to <i>error</i>.
The name of this function stands for “exhaustive case” or “error-checking
case.”
<!--l. 1550--><p class="indent" >   Example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (setq x 1/3)
</td></tr></table>
<!--l. 1552--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ 1/3</td></tr></table>
<!--l. 1553--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (ecase x</td></tr></table>
<!--l. 1554--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (alpha (foo))</td></tr></table>
<!--l. 1555--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (omega (bar))</td></tr></table>
<!--l. 1556--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        ((zeta phi) (baz)))</td></tr></table>
<!--l. 1557--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Error: The value of X, 1/3, is not ALPHA, OMEGA, ZETA, or PHI.</td></tr></table>
<!--l. 1558--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">To continue, type :CONTINUE followed by an option number:</td></tr></table>
<!--l. 1559--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 1: Return to Lisp Toplevel.</td></tr></table>
<!--l. 1560--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Debug&#x003E;</td></tr></table>
<!--l. 1562--><p class="indent" >
</div>
</div>
<div class=defmac>
   <div class=tabbing>
   )
</div> }∗
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> ccase </b> <a 
 id="dx189-337007"></a><a 
 id="x189-337008r998"></a>   keyplace  {<i>( {<i>( {<i>key</i>}∗ ) | key</div> }{<i>form</i>}∗
</td></tr></table>
<!--l. 1567--><p class="indent" >
</div>
   [This supersedes the description of <i>ccase</i> given in section <a 
href="clmse126.html#x155-22200024.3">24.3<!--tex4ht:ref: EXHAUSTIVE-CASE-ANALYSIS --></a>.—GLS]
                                                                          

                                                                          
<!--l. 1571--><p class="noindent" >This control construct is similar to <i>case</i>, but no explicit <i>otherwise</i> or <i>t</i> clause is
permitted.
<!--l. 1574--><p class="indent" >   The keyplace must be a generalized variable reference acceptable to <i>setf </i>.
If no clause is satisﬁed, <i>ccase</i> signals an error (of type <i>type-error</i>) with
a message constructed from the clauses. This error may be continued
using the <i>store-value</i> restart. The argument to <i>store-value</i> is stored in
keyplace and then <i>ccase</i> starts over, making the type tests again. Subforms
of keyplace may be evaluated multiple times. If the <i>store-value</i> restart
is invoked interactively, the user will be prompted for the value to be
used.
<!--l. 1582--><p class="indent" >   The name of this function is mnemonic for “continuable (exhaustive)
case.”
<div class=implementation>
<!--l. 1585--><p class="noindent" ><b>Implementation note:</b> The <i>type-error</i> signaled by <i>ccase</i> and <i>ecase</i> is free to choose
any representation of the acceptable argument type that it wishes for placement in the
expected-type slot. It will always work to use type <i>(member . keys)</i>, but in some cases it
may be more eﬃcient, for example, to use a type that represents an integer subrange or
a type composed using the <i>or</i> type speciﬁer.
</div>
<!--l. 1597--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.4   </span> <a 
 id="x189-33800029.4.4"></a>Handling Conditions</h4>
<!--l. 1599--><p class="noindent" >These macros allow a program to gain control when a condition is signaled.
<div class=defmac>
<!--l. 1602--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> handler-case </b> <a 
 id="dx189-338001"></a><a 
 id="x189-338002r999"></a>   expression  {<i>(typespec( [<i>var</i>] ) {<i>form</i>}∗ )</div> }∗
</td></tr></table>
<!--l. 1603--><p class="indent" >
</div>
   Executes the given expression in a context where various speciﬁed handlers are
active.
   Each typespec may be any type speciﬁer. If during the execution of the
<i>expression</i> a condition is signaled for which there is an appropriate clause—that is,
one for which <i>(typep condition &#x2019;typespec)</i> is true—and if there is no intervening
handler for conditions of that type, then control is transferred to the body of the
                                                                          

                                                                          
relevant clause (unwinding the dynamic state appropriately in the process) and
the given variable <i>var</i> is bound to the condition that was signaled. If no such
condition is signaled and the computation runs to completion, then the
values resulting from the <i>expression</i> are returned by the <i>handler-case</i>
form.
   If more than one case is provided, those cases are made accessible in parallel.
That is, in <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(handler-case expression
</td></tr></table>
<!--l. 1618--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (type<sub>1</sub> (var<sub>1</sub>) form<sub>1</sub>)</td></tr></table>
<!--l. 1619--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (type<sub>2</sub> (var<sub>2</sub>) form<sub>2</sub>))</td></tr></table>
<!--l. 1621--><p class="indent" >
</div>
</div>
<!--l. 1622--><p class="noindent" >if the ﬁrst clause (containing form<sub>1</sub>) has been selected, the handler for the second is
no longer visible (and vice versa).
<!--l. 1625--><p class="indent" >   The cases are searched sequentially from top to bottom. If a signaled condition
matches more than one case (possible if there is type overlap) the earlier of the
two cases will be selected.
                                                                          

                                                                          
<!--l. 1632--><p class="indent" >   If the variable var is not needed, it may be omitted. That is, a clause such as <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(type (var) (declare (ignore var)) form)
</td></tr></table>
<!--l. 1635--><p class="indent" >
</div>
</div>
<!--l. 1636--><p class="noindent" >may be written using the following shorthand notation: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(type () form)
</td></tr></table>
<!--l. 1639--><p class="indent" >
</div>
</div>
<!--l. 1641--><p class="indent" >   If there are no forms in a selected case, the case returns <i>nil</i>. Note that <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(handler-case expression
</td></tr></table>
<!--l. 1644--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (type<sub>1</sub> (var<sub>1</sub>) . body<sub>1</sub>)</td></tr></table>
<!--l. 1645--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (type<sub>2</sub> (var<sub>2</sub>) . body<sub>2</sub>)</td></tr></table>
<!--l. 1646--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 1648--><p class="indent" >
</div>
</div>
<!--l. 1649--><p class="noindent" >is approximately equivalent to <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(block #1=#:block-1
</td></tr></table>
<!--l. 1651--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let (#2=#:var-2)</td></tr></table>
<!--l. 1652--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (tagbody</td></tr></table>
<!--l. 1653--><p class="indent" >                                  (handler-bind ((type<sub>1</sub> <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:223;" 
class="tabbing"></td><td  
class="tabbing">#&#x2019;(lambda (temp)</td></tr></table>
                                                                          

                                                                          
<!--l. 1654--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:223;" 
class="tabbing">                                      </td><td  
class="tabbing">    (setq #2# temp)</td></tr></table>
<!--l. 1655--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                          (go #3=#:tag-3)))</td><td style="width:245;" 
class="tabbing"></td></tr></table>
<!--l. 1656--><p class="indent" >                                              (type<sub>2</sub> <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td><td style="width:245;" 
class="tabbing">#&#x2019;(lambda (temp)</td></tr></table>
<!--l. 1657--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                          </td><td  
class="tabbing">    (setq #2# temp)</td></tr></table>
<!--l. 1658--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                              (go #4=#:tag-4)))</td><td  
class="tabbing"></td></tr></table>
<!--l. 1659--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     ...)</td></tr></table>
<!--l. 1660--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (return-from #1# expression))</td></tr></table>
<!--l. 1661--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      #3# (return-from #1# (let ((var<sub>1</sub> #2#)) . body<sub>1</sub>))</td></tr></table>
<!--l. 1662--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      #4# (return-from #1# (let ((var<sub>2</sub> #2#)) . body<sub>2</sub>))</td></tr></table>
<!--l. 1663--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...)))</td></tr></table>
<!--l. 1665--><p class="indent" >
</div>
</div>
<!--l. 1666--><p class="noindent" >[Note the use of “gensyms” such as <i>#:block-1</i> as block names, variables, and <i>tagbody</i>
tags in this example, and the use of <i>#n=</i> and <i>#n#</i> read-macro syntax to indicate
that the very same gensym appears in multiple places.—GLS]
<!--l. 1671--><p class="indent" >   As a special case, the typespec can also be the symbol <i>:no-error</i> in the last
clause. If it is, it designates a clause that will take control if the expression returns
normally. In that case, a completely general lambda-list may follow the symbol
<i>:no-error</i>, and the arguments to which the lambda-list parameters are bound are
like those for <i>multiple-value-call</i> on the return value of the expression. For
example,
                                                                          

                                                                          
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(handler-case expression
</td></tr></table>
<!--l. 1681--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (type<sub>1</sub> (var<sub>1</sub>) . body<sub>1</sub>)</td></tr></table>
<!--l. 1682--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (type<sub>2</sub> (var<sub>2</sub>) . body<sub>2</sub>)</td></tr></table>
<!--l. 1683--><p class="indent" >                                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...</td></tr></table>
<!--l. 1684--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (type<sub>n</sub> (var<sub>n</sub>) . body<sub>n</sub>)</td></tr></table>
<!--l. 1685--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (:no-error (nvar<sub>1</sub> nvar<sub>2</sub> ... nvar<sub>m</sub>) . nbody))</td></tr></table>
<!--l. 1687--><p class="indent" >
</div>
</div>
<!--l. 1688--><p class="noindent" >is approximately equivalent to <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(block #1=#:error-return
</td></tr></table>
<!--l. 1690--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (multiple-value-call #&#x2019;(lambda (nvar<sub>1</sub> nvar<sub>2</sub> ... nvar<sub>m</sub>) . nbody)</td></tr></table>
<!--l. 1691--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (block #2=#:normal-return</td></tr></table>
<!--l. 1692--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (return-from #1#</td></tr></table>
<!--l. 1693--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (handler-case (return-from #2# expression)</td></tr></table>
<!--l. 1694--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (type<sub>1</sub> (var<sub>1</sub>) . body<sub>1</sub>)</td></tr></table>
<!--l. 1695--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (type<sub>2</sub> (var<sub>2</sub>) . body<sub>2</sub>)</td></tr></table>
<!--l. 1696--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          ...</td></tr></table>
<!--l. 1697--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (type<sub>n</sub> (var<sub>n</sub>) . body<sub>n</sub>))))))</td></tr></table>
<!--l. 1699--><p class="indent" >
</div>
</div>
<!--l. 1703--><p class="indent" >   Examples of the use of <i>handler-case</i>: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(handler-case (/ x y)
</td></tr></table>
<!--l. 1705--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (division-by-zero () nil))</td></tr></table>
                                                                          

                                                                          
<!--l. 1706--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1707--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(handler-case (open *the-ﬁle* :direction :input)</td></tr></table>
<!--l. 1708--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (ﬁle-error (condition) (format t &#x0022;<tt>~</tt>&#x0026;Fooey: <tt>~</tt>A<tt>~</tt>%&#x0022; condition)))</td></tr></table>
<!--l. 1709--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1710--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(handler-case (some-user-function)</td></tr></table>
<!--l. 1711--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (ﬁle-error (condition) condition)</td></tr></table>
<!--l. 1712--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (division-by-zero () 0)</td></tr></table>
<!--l. 1713--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ((or unbound-variable undeﬁned-function) () &#x2019;unbound))</td></tr></table>
<!--l. 1714--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 1715--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(handler-case (intern x y)</td></tr></table>
<!--l. 1716--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (error (condition) condition)</td></tr></table>
<!--l. 1717--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (:no-error (symbol status)</td></tr></table>
<!--l. 1718--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (declare (ignore symbol))</td></tr></table>
<!--l. 1719--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    status))</td></tr></table>
<!--l. 1721--><p class="indent" >
</div>
</div>
<div class=defmac>
   <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> ignore-errors </b> <a 
 id="dx189-338003"></a><a 
 id="x189-338004r1000"></a>   {<i>form</i>}∗
</td></tr></table>
<!--l. 1726--><p class="indent" >
</div>
   Executes its body in a context that handles conditions of type <i>error</i> by
returning control to this form. If no such condition is signaled, any values
returned by the last form are returned by <i>ignore-errors</i>. Otherwise, two values are
returned: <i>nil</i> and the <i>error</i> condition that was signaled.
<i>
   ignore-errors</i> could be deﬁned by <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defmacro ignore-errors (&#x0026;body forms)
</td></tr></table>
<!--l. 1734--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <tt>‘</tt>(handler-case (progn ,<tt>@</tt>forms)</td></tr></table>
<!--l. 1735--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (error (c) (values nil c)))</td></tr></table>
<!--l. 1737--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
</div>
<div class=defmac>
   <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> handler-bind </b> <a 
 id="dx189-338005"></a><a 
 id="x189-338006r1001"></a>   ( {<i>(typespechandler)</i>}∗ )  {<i>form</i>}∗
</td></tr></table>
<!--l. 1743--><p class="indent" >
</div>
   Executes body in a dynamic context where the given handler bindings are in
eﬀect. Each typespec may be any type speciﬁer. Each handler form should evaluate
to a function to be used to handle conditions of the given type(s) during execution
of the forms. This function should take a single argument, the condition being
signaled.
   If more than one binding is speciﬁed, the bindings are searched sequentially
from top to bottom in search of a match (by visual analogy with <i>typecase</i>). If an
appropriate typespec is found, the associated handler is run in a context where
none of the handler bindings are visible (to avoid recursive errors). For example,
in the case of <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(handler-bind ((unbound-variable #&#x2019;(lambda ...))
</td></tr></table>
<!--l. 1757--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               (error #&#x2019;(lambda ...)))</td></tr></table>
<!--l. 1758--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 1760--><p class="indent" >
</div>
</div>
<!--l. 1761--><p class="noindent" >if an unbound variable error is signaled in the body (and not handled by an
intervening handler), the ﬁrst function will be called. If any other kind
of error is signaled, the second function will be called. In either case,
neither handler will be active while executing the code in the associated
function.
</div>
                                                                          

                                                                          
<!--l. 1769--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.5   </span> <a 
 id="x189-33900029.4.5"></a>Deﬁning Conditions</h4>
<!--l. 1772--><p class="noindent" >[The contents of this section are still a subject of some debate within X3J13. The
reader may wish to take this section with a grain of salt, two aspirin tablets, and
call a hacker in the morning.—GLS]
<div class=defmac>
<!--l. 1777--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> deﬁne-condition </b> <a 
 id="dx189-339001"></a><a 
 id="x189-339002r1002"></a>   name ( {<i>parent − type</i>}∗ )  [ <i>({<i>slot − specifier</i>}∗ ) {<i>option</i>}∗ </i>]
</td></tr></table>
<!--l. 1779--><p class="indent" >
</div>
   Deﬁnes a new condition type called name, which is a subtype of each given
parent-type. Except as otherwise noted, the arguments are not evaluated.
   Objects of this condition type will have all of the indicated slots, plus any
additional slots inherited from the parent types (its superclasses). If the slots list
is omitted, the empty list is assumed.
   A slot must have the form <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">slot-speciﬁer ::= slot-name | (slot-name [[↓slot-option ]])
</td></tr></table>
<!--l. 1790--><p class="indent" >
</div>
<!--l. 1791--><p class="noindent" >For the syntax of a slot-option, see <i>defclass</i>. The slots of a condition object are
normal CLOS slots. Note that <i>with-slots</i> may be used instead of accessor functions
to access slots of a condition object.
<i>
<!--l. 1796--><p class="indent" >   make-condition</i> will accept keywords (in the keyword package) with the print
name of any of the designated slots, and will initialize the corresponding slots in
conditions it creates.
<!--l. 1800--><p class="indent" >   Accessors are created according to the same rules as used by <i>defclass</i>.
<!--l. 1802--><p class="indent" >   The valid options are as follows:
<div class=flushdesc>
<!--l. 1805--><p class="indent" >
                                                                          

                                                                          
  <div><br /><b>
<i>(:documentation doc-string)</i>                                               </b>
<!--l. 1807--><p class="indent" >  The doc-string should be either <i>nil</i> or a string that describes the purpose
of  the  condition  type.  If  this  option  is  omitted,  <i>nil</i> is  assumed.  Calling
<i>(documentation &#x2019;name &#x2019;type)</i> will retrieve this information.
  <br /><b>
<i>(:report exp)</i>                                                              </b>
<!--l. 1814--><p class="indent" >  If  exp  is  not  a  literal  string,  it  must  be  a  suitable  argument  to  the
<i>function</i> special form. The expression <i>(function exp)</i> will be evaluated in the
current lexical environment. It should produce a function of two arguments,
a condition and a stream, that prints on the stream a description of the
condition. This function is called whenever the condition is printed while
<i>*print-escape*</i> is <i>nil</i>.
<!--l. 1821--><p class="indent" >  If exp is a literal string, it is shorthand for <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(lambda (c s)
</td></tr></table>
<!--l. 1823--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (ignore c))</td></tr></table>
<!--l. 1824--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (write-string exp s))</td></tr></table>
<!--l. 1826--><p class="indent" >
</div>
</div>
<!--l. 1827--><p class="noindent" >[That is, a function is provided that will simply write the given string literally to the
stream, regardless of the particular condition object supplied.—GLS]
<!--l. 1830--><p class="indent" >  The <i>:report</i> option is processed after the new condition type has been deﬁned,
so use of the slot accessors within the report function is permitted. If this option
is not speciﬁed, information about how to report this type of condition will be
inherited from the parent-type.</div>
</div>
<!--l. 1836--><p class="indent" >   [X3J13 voted in March 1989 ⟨<b>?</b>⟩ to integrate the Condition System and the
Object System. In the original Condition System proposal, <i>deﬁne-condition</i>
allowed only one parent-type (the inheritance structure was a simple hierarchy).
Slot descriptions were much simpler, even simpler than those for <i>defstruct</i>:
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">slot ::= slot-name | (slot-name) | (slot-name default-value)
</td></tr></table>
<!--l. 1844--><p class="indent" >
</div>
<!--l. 1845--><p class="noindent" >Similarly, <i>deﬁne-condition</i> allowed a <i>:conc-name</i> option similar to that of <i>defstruct</i>:
<div class=flushdesc>
  <div><br /><b>
<i>(:conc-name symbol-or-string)</i>                                             </b>
<!--l. 1850--><p class="indent" >  Not  now  part  of  Common  Lisp. As  with  <i>defstruct</i>,  this  sets  up
automatic preﬁxing of the names of slot accessors. Also as in <i>defstruct</i>, the
default behavior is to use the name of the new type, name, followed by a
hyphen. (Generated names are interned in the package that is current at the
time that the <i>deﬁne-condition</i> is processed).</div>
</div>
<!--l. 1857--><p class="noindent" >One consequence of the vote was to make <i>deﬁne-condition</i> slot descriptions like those
of <i>defclass</i>.—GLS]
<!--l. 1860--><p class="indent" >   Here are some examples of the use of <i>deﬁne-condition</i>.
<!--l. 1864--><p class="indent" >   The following form deﬁnes a condition of type <i>peg/hole-mismatch</i> that inherits
from a condition type called <i>blocks-world-error</i>: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(deﬁne-condition peg/hole-mismatch (blocks-world-error)
</td></tr></table>
<!--l. 1867--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                  (peg-shape hole-shape)</td></tr></table>
<!--l. 1868--><p class="indent" >                                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (:report</td></tr></table>
<!--l. 1869--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (lambda (condition stream)</td></tr></table>
<!--l. 1870--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (with-slots (peg-shape hole-shape) condition</td></tr></table>
<!--l. 1871--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (format stream &#x0022;A <tt>~</tt>A peg cannot go in a <tt>~</tt>A hole.&#x0022;</td></tr></table>
<!--l. 1872--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                peg-shape hole-shape))))</td></tr></table>
<!--l. 1874--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 1875--><p class="noindent" >The new type has slots <i>peg-shape</i> and <i>hole-shape</i>, so <i>make-condition</i> will accept
<i>:peg-shape</i> and <i>:hole-shape</i> keywords. The <i>with-slots</i> macro may be used to
access the <i>peg-shape</i> and <i>hole-shape</i> slots, as illustrated in the <i>:report</i>
information.
<!--l. 1880--><p class="indent" >   Here is another example. This deﬁnes a condition called <i>machine-error</i> that
inherits from <i>error</i>: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(deﬁne-condition machine-error (error)
</td></tr></table>
<!--l. 1883--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                  ((machine-name</td></tr></table>
<!--l. 1884--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                    :reader machine-error-machine-name))</td></tr></table>
<!--l. 1885--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (:report (lambda (condition stream)</td></tr></table>
<!--l. 1886--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (format stream &#x0022;There is a problem with <tt>~</tt>A.&#x0022;</td></tr></table>
<!--l. 1887--><p class="indent" >      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     (machine-error-machine-name condition)))))</td></tr></table>
<!--l. 1889--><p class="indent" >
</div>
</div>
<!--l. 1890--><p class="noindent" >Building on this deﬁnition, we can deﬁne a new error condition that is a subtype of
<i>machine-error</i> for use when machines are not available: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(deﬁne-condition machine-not-available-error (machine-error) ()
</td></tr></table>
<!--l. 1893--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (:report (lambda (condition stream)</td></tr></table>
<!--l. 1894--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (format stream &#x0022;The machine <tt>~</tt>A is not available.&#x0022;</td></tr></table>
<!--l. 1895--><p class="indent" >      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     (machine-error-machine-name condition)))))</td></tr></table>
<!--l. 1897--><p class="indent" >
</div>
</div>
<!--l. 1898--><p class="noindent" >We may now deﬁne a still more speciﬁc condition, built upon <i>machine-not-available-error</i>,
that provides a default for <i>machine-name</i> but does not provide any new slots or
report information. It just gives the <i>machine-name</i> slot a default initialization: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(deﬁne-condition my-favorite-machine-not-available-error
</td></tr></table>
                                                                          

                                                                          
<!--l. 1904--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                  (machine-not-available-error)</td></tr></table>
<!--l. 1905--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                  ((machine-name :initform &#x0022;MC.LCS.MIT.EDU&#x0022;)))</td></tr></table>
<!--l. 1907--><p class="indent" >
</div>
</div>
<!--l. 1908--><p class="noindent" >Note that since no <i>:report</i> clause was given, the information inherited from
<i>machine-not-available-error</i> will be used to report this type of condition.
</div>
<!--l. 1913--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.6   </span> <a 
 id="x189-34000029.4.6"></a>Creating Conditions</h4>
<!--l. 1915--><p class="noindent" >The function <i>make-condition</i> is the basic means for creating condition
objects.
<div class=defun>
<!--l. 1918--><p class="noindent" > <i>[Function]</i>   <b>make-condition</b> <a 
 id="dx189-340001"></a><a 
 id="x189-340002r1003"></a>   <i>type</i>  <b>&#x0026;rest</b>  slot-initializations
<!--l. 1920--><p class="noindent" >Constructs a condition object of the given type using slot-initializations as a
speciﬁcation of the initial value of the slots. The newly created condition is
returned.
<!--l. 1925--><p class="indent" >   The slot-initializations are alternating keyword/value pairs. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-condition &#x2019;peg/hole-mismatch
</td></tr></table>
<!--l. 1928--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :peg-shape &#x2019;square :hole-shape &#x2019;round)</td></tr></table>
<!--l. 1930--><p class="indent" >
</div>
</div>
</div>
<!--l. 1934--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.7   </span> <a 
 id="x189-34100029.4.7"></a>Establishing Restarts</h4>
                                                                          

                                                                          
<!--l. 1936--><p class="noindent" >The lowest-level form that creates restart points is called <i>restart-bind</i>. The
<i>restart-case</i> macro is an abstraction that addresses many common needs for
<i>restart-bind</i> while oﬀering a more palatable syntax. See also <i>with-simple-restart</i>.
                                                                          

                                                                          
The function that transfers control to a restart point established by one of these
macros is called <i>invoke-restart</i>.
<!--l. 1944--><p class="indent" >   All restarts have dynamic extent; a restart does not survive execution of the
form that establishes it.
<div class=defmac>
<!--l. 1948--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> with-simple-restart </b> <a 
 id="dx189-341001"></a><a 
 id="x189-341002r1004"></a>   (name format-string  {<i>format − argument</i>}∗ )  {<i>form</i>}∗
</td></tr></table>
<!--l. 1950--><p class="indent" >
</div>
   This is shorthand for one of the most common uses of <i>restart-case</i>.
   If the restart designated by name is not invoked while executing the forms, all
values returned by the last form are returned. If that restart is invoked, control is
transferred to the <i>with-simple-restart</i> form, which immediately returns the two
values <i>nil</i> and <i>t</i>.
   The name may be <i>nil</i>, in which case an anonymous restart is established.
<i>
   with-simple-restart</i> could be deﬁned by <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defmacro with-simple-restart ((restart-name format-string
</td></tr></table>
<!--l. 1963--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                &#x0026;rest format-arguments)</td></tr></table>
<!--l. 1964--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                               &#x0026;body forms)</td></tr></table>
<!--l. 1965--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <tt>‘</tt>(restart-case (progn ,<tt>@</tt>forms)</td></tr></table>
<!--l. 1966--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (,restart-name ()</td></tr></table>
<!--l. 1967--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       :report</td></tr></table>
<!--l. 1968--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (lambda (stream)</td></tr></table>
<!--l. 1969--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           (format stream ,format-string ,<tt>@</tt>format-arguments))</td></tr></table>
<!--l. 1970--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (values nil t))))</td></tr></table>
<!--l. 1972--><p class="indent" >
</div>
</div>
<!--l. 1974--><p class="noindent" >Here is an example of the use of <i>with-simple-restart</i>. <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (defun read-eval-print-loop (level)
</td></tr></table>
<!--l. 1976--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (with-simple-restart</td></tr></table>
<!--l. 1977--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (abort &#x0022;Exit command level <tt>~</tt>D.&#x0022; level)</td></tr></table>
<!--l. 1978--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (loop</td></tr></table>
<!--l. 1979--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (with-simple-restart</td></tr></table>
<!--l. 1980--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                (abort &#x0022;Return to command level <tt>~</tt>D.&#x0022; level)</td></tr></table>
<!--l. 1981--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              (let ((form (prog2 (fresh-line)</td></tr></table>
<!--l. 1982--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                 (read)</td></tr></table>
<!--l. 1983--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                 (fresh-line))))</td></tr></table>
<!--l. 1984--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                (prin1 (eval form)))))))</td></tr></table>
<!--l. 1985--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ READ-EVAL-PRINT-LOOP</td></tr></table>
<!--l. 1986--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Lisp&#x003E; (read-eval-print-loop 1)</td></tr></table>
<!--l. 1987--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(+ &#x2019;a 3)</td></tr></table>
<!--l. 1988--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Error: The argument, A, to the function + was of the wrong type.</td></tr></table>
<!--l. 1989--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       The function expected a number.</td></tr></table>
<!--l. 1990--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">To continue, type :CONTINUE followed by an option number:</td></tr></table>
<!--l. 1991--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 1: Specify a value to use this time.</td></tr></table>
<!--l. 1992--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 2: Return to command level 1.</td></tr></table>
<!--l. 1993--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 3: Exit command level 1.</td></tr></table>
<!--l. 1994--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> 4: Return to Lisp Toplevel.</td></tr></table>
<!--l. 1995--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">Debug&#x003E;</td></tr></table>
<!--l. 1997--><p class="indent" >
</div>
</div>
<div class=incompatibility>
<!--l. 2000--><p class="noindent" ><b>Compatibility note:</b> In contrast to the way that Zetalisp has traditionally deﬁned
<i>abort</i> as a kind of condition to be handled, the Common Lisp Condition System deﬁnes
<i>abort</i> as a way to restart (“proceed” in Zetalisp terms).
</div>
<!--l. 2007--><p class="noindent" ><b>Remark:</b> Some readers may wonder what ought to be done by the “abort” key (or
whatever the implementation&#x2019;s interrupt key is—Control-C or Control-G, for example).
Such interrupts, whether synchronous or asynchronous in nature, are beyond the scope
of this chapter and indeed are not currently addressed by Common Lisp at all. This may
be a topic worth standardizing under separate cover. Here is some speculation about
some possible things that might happen.
                                                                          

                                                                          
<!--l. 2016--><p class="indent" >   An implementation might simply call <i>abort</i> or <i>break</i> directly without signaling any
condition.
<!--l. 2019--><p class="indent" >   Another implementation might signal some condition related to the fact that a key
had been pressed rather than to the action that should be taken. This is one way to
allow user customization. Perhaps there would be an implementation-dependent
<i>keyboard-interrupt</i> condition type with a slot containing the key that was pressed—or
perhaps there would be such a condition type, but rather than its having slots, diﬀerent
subtypes of that type with names like <i>keyboard-abort</i>, <i>keyboard-break</i>, and so on might
be signaled. That implementation would then document the action it would take if user
programs failed to handle the condition, and perhaps ways for user programs to usefully
dismiss the interrupt.
<div class=implementation>
<!--l. 2032--><p class="noindent" ><b>Implementation note:</b> Implementors are encouraged to make sure that there
is always a restart named <i>abort</i> around any user code so that user code can
call <i>abort</i> at any time and expect something reasonable to happen; exactly
what the reasonable thing is may vary somewhat. Typically, in an interactive
program, invoking <i>abort</i> should return the user to top level, though in some
batch or multi-processing situations killing the running process might be more
appropriate.
</div>
</div>
<div class=defmac>
<!--l. 2047--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> restart-case </b> <a 
 id="dx189-341003"></a><a 
 id="x189-341004r1005"></a>   expression  {<i>(case − namearglist{<i>keywordvalue</i>}∗  {<i>form</i>}∗ )</div> }∗
</td></tr></table>
<!--l. 2050--><p class="indent" >
</div>
   The expression is evaluated in a dynamic context where the clauses have
special meanings as points to which control may be transferred. If the expression
ﬁnishes executing and returns any values, all such values are simply returned by
the <i>restart-case</i> form. While the expression is running, any code may
transfer control to one of the clauses (see <i>invoke-restart</i>). If a transfer
occurs, the forms in the body of that clause will be evaluated and any
values returned by the last such form will be returned by the <i>restart-case</i>
form.
   As a special case, if the expression is a list whose car is <i>signal</i>, <i>error</i>, <i>cerror</i>, or
<i>warn</i>, then <i>with-condition-restarts</i> is implicitly used to associate the restarts with
                                                                          

                                                                          
the condition to be signaled. For example, <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(restart-case (signal weird-error)
</td></tr></table>
<!--l. 2065--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (become-confused ...)</td></tr></table>
<!--l. 2066--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (rewind-line-printer ...)</td></tr></table>
<!--l. 2067--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (halt-and-catch-ﬁre ...))</td></tr></table>
<!--l. 2069--><p class="indent" >
</div>
</div>
<!--l. 2070--><p class="noindent" >is equivalent to <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(restart-case (with-condition-restarts
</td></tr></table>
<!--l. 2072--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                weird-error</td></tr></table>
<!--l. 2073--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                (list (ﬁnd-restart &#x2019;become-confused)</td></tr></table>
<!--l. 2074--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                      (ﬁnd-restart &#x2019;rewind-line-printer)</td></tr></table>
<!--l. 2075--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                      (ﬁnd-restart &#x2019;halt-and-catch-ﬁre))</td></tr></table>
<!--l. 2076--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                (signal weird-error))</td></tr></table>
<!--l. 2077--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (become-confused ...)</td></tr></table>
<!--l. 2078--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (rewind-line-printer ...)</td></tr></table>
<!--l. 2079--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (halt-and-catch-ﬁre ...))</td></tr></table>
<!--l. 2081--><p class="indent" >
</div>
</div>
<!--l. 2083--><p class="indent" >   If there are no forms in a selected clause, <i>restart-case</i> returns <i>nil</i>.
<!--l. 2085--><p class="indent" >   The case-name may be <i>nil</i> or a symbol naming this restart.
<!--l. 2087--><p class="indent" >   It is possible to have more than one clause use the same case-name. In this
case, the ﬁrst clause with that name will be found by <i>ﬁnd-restart</i>. The other
clauses are accessible using <i>compute-restarts</i>. [In this respect, <i>restart-case</i> is
rather diﬀerent from <i>case</i>!—GLS]
<!--l. 2092--><p class="indent" >   Each arglist is a normal lambda-list containing parameters to be bound during
the execution of its corresponding forms. These parameters are used to
pass any necessary data from a call to <i>invoke-restart</i> to the <i>restart-case</i>
clause.
                                                                          

                                                                          
<!--l. 2097--><p class="indent" >   By default, <i>invoke-restart-interactively</i> will pass no arguments and all
parameters must be optional in order to accommodate interactive restarting.
However, the parameters need not be optional if the <i>:interactive</i> keyword has been
used to inform <i>invoke-restart-interactively</i> about how to compute a proper
argument list.
<!--l. 2103--><p class="indent" >   The valid keyword value pairs are the following: <div class=flushdesc>
  <div><br /><b>
<i>:test fn</i>                                                                   </b>
<!--l. 2107--><p class="indent" >  The fn must be a suitable argument for the <i>function</i> special form. The
expression <i>(function fn)</i> will be evaluated in the current lexical environment. It
should produce a function of one argument, a condition. If this function returns
<i>nil</i> when given some condition, functions such as <i>ﬁnd-restart</i>, <i>compute-restart</i>,
and <i>invoke-restart</i> will not consider this restart when searching for restarts
associated with that condition. If this pair is not supplied, it is as if <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(lambda (c) (declare (ignore c)) t)
</td></tr></table>
<!--l. 2116--><p class="indent" >
</div>
</div>
<!--l. 2117--><p class="noindent" >were used for the fn.
  <br /><b>
<i>:interactive fn</i>                                                            </b>
<!--l. 2121--><p class="indent" >  The fn must be a suitable argument for the <i>function</i> special form. The
expression <i>(function fn)</i> will be evaluated in the current lexical environment.
It should produce a function of no arguments that returns arguments
to be used by <i>invoke-restart-interactively</i> when invoking this function.
This function will be called in the dynamic environment available prior
to any restart attempt. It may interact with the user on the stream in
<i>*query-io*</i>.
<!--l. 2129--><p class="indent" >  If a restart is invoked interactively but no <i>:interactive</i> option was supplied, the
argument list used in the invocation is the empty list.
  <br /><b>
                                                                          

                                                                          
<i>:report exp</i>                                                                </b>
<!--l. 2135--><p class="indent" >  If exp is not a literal string, it must be a suitable argument to the <i>function</i>
special form. The expression <i>(function exp)</i> will be evaluated in the current lexical
environment. It should produce a function of one argument, a stream, that prints
on the stream a description of the restart. This function is called whenever the
restart is printed while <i>*print-escape*</i> is <i>nil</i>.
<!--l. 2142--><p class="indent" >  If exp is a literal string, it is shorthand for <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(lambda (s) (write-string exp s))
</td></tr></table>
<!--l. 2145--><p class="indent" >
</div>
</div>
<!--l. 2146--><p class="noindent" >[That is, a function is provided that will simply write the given string literally to the
stream.—GLS]
<!--l. 2149--><p class="indent" >  If a named restart is asked to report but no report information has been
supplied, the name of the restart is used in generating default report
text.
<!--l. 2152--><p class="indent" >  When <i>*print-escape*</i> is <i>nil</i>, the printer will use the report information for a
restart. For example, a debugger might announce the action of typing “<i>:continue</i>”
by executing the equivalent of <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(format *debug-io* &#x0022;<tt>~</tt>&#x0026;<tt>~</tt>S – <tt>~</tt>A<tt>~</tt>%&#x0022; &#x2019;:continue some-restart)
</td></tr></table>
<!--l. 2157--><p class="indent" >
</div>
</div>
<!--l. 2158--><p class="noindent" >which might then display as something like <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">:CONTINUE – Return to command level.
</td></tr></table>
<!--l. 2161--><p class="indent" >
</div>
                                                                          

                                                                          
</div>
<!--l. 2163--><p class="indent" >  It is an error if an unnamed restart is used and no report information is
provided.
<div class=rationale>
<!--l. 2167--><p class="noindent" ><b>Rationale:</b> Unnamed restarts are required to have report information on the grounds
that they are generally only useful interactively, and an interactive option that has no
description is of little value.
</div>
<div class=implementation>
<!--l. 2173--><p class="noindent" ><b>Implementation note:</b> Implementations are encouraged to warn about this error at
compilation time.
<!--l. 2176--><p class="indent" >  At run time, this error might be noticed when entering the debugger. Since signaling
an error would probably cause recursive entry into the debugger (causing yet
another recursive error, and so on), it is suggested that the debugger print
some indication of such problems when they occur, but not actually signal
errors.
</div>
  </div>
</div>
<!--l. 2185--><p class="indent" >   Note that <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(restart-case expression
</td></tr></table>
<!--l. 2187--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (name<sub>1</sub> arglist<sub>1</sub> options<sub>1</sub> . body<sub>1</sub>)</td></tr></table>
<!--l. 2188--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (name<sub>2</sub> arglist<sub>2</sub> options<sub>2</sub> . body<sub>2</sub>)</td></tr></table>
<!--l. 2189--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 2191--><p class="indent" >
</div>
</div>
<!--l. 2192--><p class="noindent" >is essentially equivalent to <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(block #1=#:block-1
</td></tr></table>
<!--l. 2194--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((#2=#:var-2 nil))</td></tr></table>
<!--l. 2195--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (tagbody</td></tr></table>
<!--l. 2196--><p class="indent" >                           (restart-bind ((name<sub>1</sub> <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:227;" 
class="tabbing"></td><td  
class="tabbing">#&#x2019;(lambda (&#x0026;rest temp)</td></tr></table>
                                                                          

                                                                          
<!--l. 2197--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:227;" 
class="tabbing">                                       </td><td  
class="tabbing">    (setq #2# temp)</td></tr></table>
<!--l. 2198--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:227;" 
class="tabbing">                                       </td><td  
class="tabbing">    (go #3=#:tag-3))</td></tr></table>
<!--l. 2199--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                       ⟨slightly transformed options<sub>1</sub>⟩)</td><td style="width:256;" 
class="tabbing"></td></tr></table>
<!--l. 2200--><p class="indent" >                                       (name<sub>2</sub> <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td><td style="width:256;" 
class="tabbing">#&#x2019;(lambda (&#x0026;rest temp)</td></tr></table>
<!--l. 2201--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                            </td><td style="width:256;" 
class="tabbing">    (setq #2# temp)</td></tr></table>
<!--l. 2202--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                            </td><td  
class="tabbing">    (go #4=#:tag-4))</td></tr></table>
<!--l. 2203--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                            ⟨slightly transformed options<sub>2</sub>⟩)</td><td  
class="tabbing"></td></tr></table>
<!--l. 2204--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                     ...)</td></tr></table>
<!--l. 2205--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (return-from #1# expression))</td></tr></table>
<!--l. 2206--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      #3# (return-from #1#</td></tr></table>
<!--l. 2207--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                (apply #&#x2019;(lambda arglist<sub>1</sub> . body<sub>1</sub>) #2#))</td></tr></table>
<!--l. 2208--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      #4# (return-from #1#</td></tr></table>
<!--l. 2209--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                (apply #&#x2019;(lambda arglist<sub>2</sub> . body<sub>2</sub>) #2#))</td></tr></table>
<!--l. 2210--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...)))</td></tr></table>
<!--l. 2212--><p class="indent" >
</div>
</div>
<!--l. 2213--><p class="noindent" >[Note the use of “gensyms” such as <i>#:block-1</i> as block names, variables, and <i>tagbody</i>
tags in this example, and the use of <i>#n=</i> and <i>#n#</i> read-macro syntax to indicate
that the very same gensym appears in multiple places.—GLS]
<!--l. 2219--><p class="indent" >   Here are some examples of the use of <i>restart-case</i>. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(loop
</td></tr></table>
<!--l. 2221--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (restart-case (return (apply function some-args))</td></tr></table>
<!--l. 2222--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (new-function (new-function)</td></tr></table>
<!--l. 2223--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        :report &#x0022;Use a diﬀerent function.&#x0022;</td></tr></table>
<!--l. 2224--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        :interactive</td></tr></table>
<!--l. 2225--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (lambda ()</td></tr></table>
<!--l. 2226--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (list (prompt-for &#x2019;function &#x0022;Function: &#x0022;)))</td></tr></table>
<!--l. 2227--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (setq function new-function))))</td></tr></table>
<!--l. 2228--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 2229--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(loop</td></tr></table>
<!--l. 2230--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (restart-case (return (apply function some-args))</td></tr></table>
<!--l. 2231--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (nil (new-function)</td></tr></table>
<!--l. 2232--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        :report &#x0022;Use a diﬀerent function.&#x0022;</td></tr></table>
                                                                          

                                                                          
<!--l. 2233--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        :interactive</td></tr></table>
<!--l. 2234--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (lambda ()</td></tr></table>
<!--l. 2235--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (list (prompt-for &#x2019;function &#x0022;Function: &#x0022;)))</td></tr></table>
<!--l. 2236--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (setq function new-function))))</td></tr></table>
<!--l. 2237--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 2238--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(restart-case (a-command-loop)</td></tr></table>
<!--l. 2239--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (return-from-command-level ()</td></tr></table>
<!--l. 2240--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      :report</td></tr></table>
<!--l. 2241--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (lambda (s)     ;Argument <i>s</i> is a stream</td></tr></table>
<!--l. 2242--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (format s &#x0022;Return from command level <tt>~</tt>D.&#x0022; level))</td></tr></table>
<!--l. 2243--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    nil))</td></tr></table>
<!--l. 2244--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 2245--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(loop</td></tr></table>
<!--l. 2246--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (restart-case (another-random-computation)</td></tr></table>
<!--l. 2247--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (continue () nil)))</td></tr></table>
<!--l. 2249--><p class="indent" >
</div>
</div>
<!--l. 2250--><p class="noindent" >The ﬁrst and second examples are equivalent from the point of view of someone
using the interactive debugger, but they diﬀer in one important aspect for
non-interactive handling. If a handler “knows about” named restarts, as in, for
example, <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(when (ﬁnd-restart &#x2019;new-function)
</td></tr></table>
<!--l. 2254--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (invoke-restart &#x2019;new-function the-replacement))</td></tr></table>
<!--l. 2256--><p class="indent" >
</div>
</div>
<!--l. 2257--><p class="noindent" >then only the ﬁrst example, and not the second, will have control transferred to
its correction clause, since only the ﬁrst example uses a restart named
<i>new-function</i>.
<!--l. 2263--><p class="indent" >   Here is a more complete example: <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((my-food &#x2019;milk)
</td></tr></table>
<!--l. 2265--><p class="indent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (my-color &#x2019;greenish-blue))</td></tr></table>
<!--l. 2266--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (do ()</td></tr></table>
<!--l. 2267--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ((not (bad-food-color-p my-food my-color)))</td></tr></table>
<!--l. 2268--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (restart-case (error &#x2019;bad-food-color</td></tr></table>
<!--l. 2269--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                         :food my-food :color my-color)</td></tr></table>
<!--l. 2270--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (use-food (new-food)</td></tr></table>
<!--l. 2271--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          :report &#x0022;Use another food.&#x0022;</td></tr></table>
<!--l. 2272--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq my-food new-food))</td></tr></table>
<!--l. 2273--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (use-color (new-color)</td></tr></table>
<!--l. 2274--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          :report &#x0022;Use another color.&#x0022;</td></tr></table>
<!--l. 2275--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq my-color new-color))))</td></tr></table>
<!--l. 2276--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ;; We won&#x2019;t get to here until MY-FOOD</td></tr></table>
<!--l. 2277--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ;; and MY-COLOR are compatible.</td></tr></table>
<!--l. 2278--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (list my-food my-color))</td></tr></table>
<!--l. 2280--><p class="indent" >
</div>
</div>
<!--l. 2281--><p class="noindent" >Assuming that <i>use-food</i> and <i>use-color</i> have been deﬁned as <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun use-food (new-food)
</td></tr></table>
<!--l. 2283--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (invoke-restart &#x2019;use-food new-food))</td></tr></table>
<!--l. 2284--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 2285--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun use-color (new-color)</td></tr></table>
<!--l. 2286--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (invoke-restart &#x2019;use-color new-color))</td></tr></table>
<!--l. 2288--><p class="indent" >
</div>
</div>
<!--l. 2289--><p class="noindent" >a handler can then restart from the error in either of two ways. It may correct the
color or correct the food. For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#&#x2019;(lambda (c) ... (use-color &#x2019;white) ...)   ;Corrects <i>color</i>
</td></tr></table>
<!--l. 2292--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
                                                                          

                                                                          
<!--l. 2293--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#&#x2019;(lambda (c) ... (use-food &#x2019;cheese) ...)   ;Corrects <i>food</i></td></tr></table>
<!--l. 2295--><p class="indent" >
</div>
</div>
<!--l. 2297--><p class="indent" >   Here is an example using <i>handler-bind</i> and <i>restart-case</i> that refers to a
condition type <i>foo-error</i>, presumably deﬁned elsewhere: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(handler-bind ((foo-error #&#x2019;(lambda (ignore) (use-value 7))))
</td></tr></table>
<!--l. 2300--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (restart-case (error &#x2019;foo-error)</td></tr></table>
<!--l. 2301--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (use-value (x) (* x x))))</td></tr></table>
<!--l. 2302--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ⇒ 49</td></tr></table>
<!--l. 2304--><p class="indent" >
</div>
</div>
<div class=defmac>
   <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> restart-bind </b> <a 
 id="dx189-341005"></a><a 
 id="x189-341006r1006"></a>   ( {<i>(namefunction{<i>keywordvalue</i>}∗ )</div> }∗ )  {<i>form</i>}∗
</td></tr></table>
<!--l. 2310--><p class="indent" >
</div>
   Executes a body of forms in a dynamic context where the given restart
bindings are in eﬀect.
   Each name may be <i>nil</i> to indicate an anonymous restart, or some other
symbol to indicate a named restart.
   Each function is a form that should evaluate to a function to be used to
perform the restart. If invoked, this function may either perform a non-local
transfer of control or it may return normally. The function may take whatever
arguments the programmer feels are appropriate; it will be invoked only if
<i>invoke-restart</i> is used from a program, or if a user interactively asks the debugger
to invoke it. In the case of interactive invocation, the <i>:interactive-function</i> option
is used.
   The valid keyword value pairs are as follows: <div class=flushdesc>
                                                                          

                                                                          
  <div><br /><b>
<i>:test-function form</i>                                                        </b>
<!--l. 2332--><p class="noindent" >The form will be evaluated in the current lexical environment and should return a
function of one argument, a condition. If this function returns <i>nil</i> when
given some condition, functions such as <i>ﬁnd-restart</i>, <i>compute-restart</i>, and
<i>invoke-restart</i> will not consider this restart when searching for restarts
associated with that condition. If this pair is not supplied, it is as if <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#&#x2019;(lambda (c) (declare (ignore c)) t)
</td></tr></table>
<!--l. 2340--><p class="indent" >
</div>
</div>
<!--l. 2341--><p class="noindent" >were used for the form.
  <br /><b>
<i>:interactive-function form</i>                                                 </b>
<!--l. 2345--><p class="indent" >  The form will be evaluated in the current lexical environment and should return
a function of no arguments that constructs a list of arguments to be used by
<i>invoke-restart-interactively</i> when invoking this restart. The function may prompt
interactively using <i>*query-io*</i> if necessary.
  <br /><b>
<i>:report-function form</i>                                                      </b>
<!--l. 2353--><p class="indent" >  The form will be evaluated in the current lexical environment and should return
a function of one argument, a stream, that prints on the stream a summary of the
action this restart will take. This function is called whenever the restart is printed
while <i>*print-escape*</i> is <i>nil</i>.</div>
</div>
<div class=defmac>
   <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> with-condition-restarts </b> <a 
 id="dx189-341007"></a><a 
 id="x189-341008r1007"></a>   condition-form restarts-form  {<i>declaration</i>}∗  {<i>form</i>}∗
</td></tr></table>
                                                                          

                                                                          
<!--l. 2364--><p class="indent" >
</div>
   The value of condition-form should be a condition C and the value of
restarts-form should be a list of restarts <i>(R1 R2 ...)</i>. The forms of the body are
evaluated as an implicit <i>progn</i>. While in the dynamic context of the body, an
attempt to ﬁnd a restart associated with a particular condition C′ will consider
the restarts R1, R2, … if C′ is <i>eq</i> to C.
   Usually this macro is not used explicitly in code, because <i>restart-case</i>
handles most of the common uses in a way that is syntactically more
concise.
   [The X3J13 vote ⟨<b>?</b>⟩ left it unclear whether <i>with-condition-restarts</i> permits
declarations to appear at the heads of its body. I believe that was the intent, but
this is only my interpretation.—GLS]
</div>
<!--l. 2384--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.8   </span> <a 
 id="x189-34200029.4.8"></a>Finding and Manipulating Restarts</h4>
<!--l. 2386--><p class="noindent" >The following functions determine what restarts are active and invoke
restarts.
<div class=defun>
<!--l. 2389--><p class="noindent" > <i>[Function]</i>   <b>compute-restarts</b> <a 
 id="dx189-342001"></a><a 
 id="x189-342002r1008"></a>   <b>&#x0026;optional</b>  <i>condition</i>
<!--l. 2391--><p class="noindent" >Uses the dynamic state of the program to compute a list of the restarts that are
currently active. See <i>restart-bind</i>.
<!--l. 2395--><p class="indent" >   If condition is <i>nil</i> or not supplied, all outstanding restarts are returned.
If condition is not <i>nil</i>, only restarts associated with that condition are
returned.
<!--l. 2400--><p class="indent" >   Each restart represents a function that can be called to perform some
form of recovery action, usually a transfer of control to an outer point
in the running program. Implementations are free to implement these
objects in whatever manner is most convenient; the objects need have only
dynamic extent (relative to the scope of the binding form that instantiates
them).
<!--l. 2406--><p class="indent" >   The list that results from a call to <i>compute-restarts</i> is ordered so that the
inner (that is, more recently established) restarts are nearer the head of the
list.
                                                                          

                                                                          
<!--l. 2410--><p class="indent" >   Note, too, that <i>compute-restarts</i> returns all valid restarts, including
anonymous ones, even if some of them have the same name as others
and would therefore not be found by <i>ﬁnd-restart</i> when given a symbol
argument.
<!--l. 2414--><p class="indent" >   Implementations are permitted, but not required, to return diﬀerent (that is,
non-<i>eq</i>) lists from repeated calls to <i>compute-restarts</i> while in the same
dynamic environment. It is an error to modify the list that is returned by
<i>compute-restarts</i>.
</div>
<div class=defun>
<!--l. 2421--><p class="noindent" > <i>[Function]</i>   <b>restart-name</b> <a 
 id="dx189-342003"></a><a 
 id="x189-342004r1009"></a>   <i>restart</i>
<!--l. 2423--><p class="noindent" >Returns the name of the given restart, or <i>nil</i> if it is not named.
</div>
<div class=defun>
<!--l. 2427--><p class="noindent" > <i>[Function]</i>   <b>ﬁnd-restart</b> <a 
 id="dx189-342005"></a><a 
 id="x189-342006r1010"></a>   <i>restart-identiﬁer</i>  <b>&#x0026;optional</b>  <i>condition</i>
<!--l. 2429--><p class="noindent" >Searches for a particular restart in the current dynamic environment.
<!--l. 2432--><p class="indent" >   If condition is <i>nil</i> or not supplied, all outstanding restarts are considered.
If condition is not <i>nil</i>, only restarts associated with that condition are
considered.
<!--l. 2437--><p class="indent" >   If the restart-identiﬁer is a non-<i>nil</i> symbol, then the innermost (that is, most
recently established) restart with that name is returned; <i>nil</i> is returned if no such
restart is found.
<!--l. 2442--><p class="indent" >   If restart-identiﬁer is a restart object, then it is simply returned, unless it is
not currently active, in which case <i>nil</i> is returned.
<!--l. 2445--><p class="indent" >   Although anonymous restarts have a name of <i>nil</i>, it is an error for the symbol
<i>nil</i> to be given as the restart-identiﬁer. Applications that would seem to require
this should be rewritten to make appropriate use of <i>compute-restarts</i>
instead.
</div>
<div class=defun>
<!--l. 2451--><p class="noindent" > <i>[Function]</i>   <b>invoke-restart</b> <a 
 id="dx189-342007"></a><a 
 id="x189-342008r1011"></a>   <i>restart-identiﬁer</i>  <b>&#x0026;rest</b>  arguments
<!--l. 2453--><p class="noindent" >Calls the function associated with the given restart-identiﬁer, passing any given
arguments. The restart-identiﬁer must be a restart or the non-null name of a
restart that is valid in the current dynamic context. If the argument is not valid,
an error of type <i>control-error</i> will be signaled.
<div class=implementation>
<!--l. 2460--><p class="noindent" ><b>Implementation note:</b> Restart functions call this function, not vice versa.
</div>
                                                                          

                                                                          
</div>
<div class=defun>
<!--l. 2466--><p class="noindent" > <i>[Function]</i>   <b>invoke-restart-interactively</b> <a 
 id="dx189-342009"></a><a 
 id="x189-342010r1012"></a>   <i>restart-identiﬁer</i>
<!--l. 2468--><p class="noindent" >Calls the function associated with the given restart-identiﬁer, prompting for any
necessary arguments. The restart-identiﬁer must be a restart or the non-null name
of a restart that is valid in the current dynamic context. If the argument is not
valid, an error of type <i>control-error</i> will be signaled.
<!--l. 2474--><p class="indent" >   The function <i>invoke-restart-interactively</i> will prompt for arguments by
executing the code provided in the <i>:interactive</i> keyword to <i>restart-case</i> or
<i>:interactive-function</i> keyword to <i>restart-bind</i>.
<!--l. 2478--><p class="indent" >   If no <i>:interactive</i> or <i>:interactive-function</i> option has been supplied in the
corresponding <i>restart-case</i> or <i>restart-bind</i>, then it is an error if the restart takes
required arguments. If the arguments are optional, an empty argument list will be
used in this case.
<!--l. 2484--><p class="indent" >   Once <i>invoke-restart-interactively</i> has calculated the arguments, it simply
performs <i>(apply #&#x2019;invoke-restart restart-identiﬁer arguments)</i>.
<i>
<!--l. 2488--><p class="indent" >   invoke-restart-interactively</i> is used internally by the debugger and
may also be useful in implementing other portable, interactive debugging
tools.
</div>
<!--l. 2493--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.9   </span> <a 
 id="x189-34300029.4.9"></a>Warnings</h4>
<!--l. 2496--><p class="noindent" >Warnings are a subclass of errors that are conventionally regarded as
“mild.”
<div class=defun>
<!--l. 2498--><p class="noindent" > <i>[Function]</i>   <b>warn</b> <a 
 id="dx189-343001"></a><a 
 id="x189-343002r1013"></a>   <i>datum</i>  <b>&#x0026;rest</b>  arguments
<!--l. 2500--><p class="noindent" >[This supersedes the description of <i>warn</i> given in section <a 
href="clmse124.html#x153-22000024.1">24.1<!--tex4ht:ref: ERROR-SIGNALLING-FUNCTIONS --></a>.—GLS]
<!--l. 2504--><p class="indent" >   Warns about a situation, by signaling a condition of type <i>warning</i>.
<!--l. 2506--><p class="indent" >   If datum is a condition, then that condition is used directly. In this case, if the
condition is not of type <i>warning</i> or arguments is non-<i>nil</i>, an error of type
<i>type-error</i> is signaled.
<!--l. 2510--><p class="indent" >   If datum is a condition type (a class or class name), then the condition used
is eﬀectively the result of <i>(apply #&#x2019;make-condition datum arguments)</i>.
This result must be of type <i>warning</i> or an error of type <i>type-error</i> is
                                                                          

                                                                          
signaled.
<!--l. 2514--><p class="indent" >   If datum is a string, then the condition used is eﬀectively the result of <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(make-condition &#x2019;simple-error
</td></tr></table>
<!--l. 2516--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-string datum</td></tr></table>
<!--l. 2517--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                :format-arguments arguments)</td></tr></table>
<!--l. 2519--><p class="indent" >
</div>
</div>
<!--l. 2521--><p class="indent" >   The precise mechanism for warning is as follows.
      <ol  class="enumerate1" >
      <li 
  class="enumerate" id="x189-343004x1">The warning condition is signaled.
      <!--l. 2534--><p class="noindent" >While  the  <i>warning</i> condition  is  being  signaled,  the  <i>muﬄe-warning</i>
      restart is established for use by a handler to bypass further action by
      <i>warn</i> (that is, to cause <i>warn</i> to immediately return <i>nil</i>).
      <!--l. 2538--><p class="noindent" >As part of the signaling process, if <i>(typep condition *break-on-signals*)</i>
      is true, then a <i>break</i> will occur prior to beginning the signaling process.
      </li>
      <li 
  class="enumerate" id="x189-343006x2">If no handlers for the warning condition are found, or if all such handlers
      decline, then the condition will be reported to <i>*error-output*</i> by the
      <i>warn</i> function (with possible implementation-speciﬁc extra output such
      as motion to a fresh line before or after the display of the warning, or
      supplying some introductory text mentioning the name of the function
      that called <i>warn</i> or the fact that this is a warning).
      </li>
      <li 
  class="enumerate" id="x189-343008x3">The value returned by <i>warn</i> (if it returns) is <i>nil</i>.</li></ol>
</div>
                                                                          

                                                                          
<!--l. 2576--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.10   </span> <a 
 id="x189-34400029.4.10"></a>Restart Functions</h4>
<!--l. 2578--><p class="noindent" >Common Lisp has the following restart functions built in.
<div class=defun>
<!--l. 2580--><p class="noindent" > <i>[Function]</i>   <b>abort</b> <a 
 id="dx189-344001"></a><a 
 id="x189-344002r1014"></a>   <b>&#x0026;optional</b>  <i>condition</i>
<!--l. 2582--><p class="noindent" >This function transfers control to the restart named <i>abort</i>. If no such restart
exists, <i>abort</i> signals an error of type <i>control-error</i>.
<!--l. 2586--><p class="indent" >   If condition is <i>nil</i> or not supplied, all outstanding restarts are considered.
If condition is not <i>nil</i>, only restarts associated with that condition are
considered.
<!--l. 2591--><p class="indent" >   The purpose of the <i>abort</i> restart is generally to allow control to return to the
innermost “command level.”
</div>
<div class=defun>
<!--l. 2595--><p class="noindent" > <i>[Function]</i>   <b>continue</b> <a 
 id="dx189-344003"></a><a 
 id="x189-344004r1015"></a>   <b>&#x0026;optional</b>  <i>condition</i>
<!--l. 2597--><p class="noindent" >This function transfers control to the restart named <i>continue</i>. If no such restart
exists, <i>continue</i> returns <i>nil</i>.
<!--l. 2601--><p class="indent" >   If condition is <i>nil</i> or not supplied, all outstanding restarts are considered.
If condition is not <i>nil</i>, only restarts associated with that condition are
considered.
<!--l. 2606--><p class="indent" >   The <i>continue</i> restart is generally part of simple protocols where there is a
single “obvious” way to continue, as with <i>break</i> and <i>cerror</i>. Some user-deﬁned
protocols may also wish to incorporate it for similar reasons. In general, however,
it is more reliable to design a special-purpose restart with a name that better suits
the particular application.
</div>
<div class=defun>
<!--l. 2613--><p class="noindent" > <i>[Function]</i>   <b>muﬄe-warning</b> <a 
 id="dx189-344005"></a><a 
 id="x189-344006r1016"></a>   <b>&#x0026;optional</b>  <i>condition</i>
<!--l. 2615--><p class="noindent" >This function transfers control to the restart named <i>muﬄe-warning</i>. If no such
restart exists, <i>muﬄe-warning</i> signals an error of type <i>control-error</i>.
<!--l. 2620--><p class="indent" >   If condition is <i>nil</i> or not supplied, all outstanding restarts are considered.
If condition is not <i>nil</i>, only restarts associated with that condition are
considered.
<i>
<!--l. 2625--><p class="indent" >   warn</i> sets up this restart so that handlers of <i>warning</i> conditions have a way to
tell <i>warn</i> that a <i>warning</i> has already been dealt with and that no further action is
warranted.
</div>
                                                                          

                                                                          
<div class=defun>
<!--l. 2630--><p class="noindent" > <i>[Function]</i>   <b>store-value</b> <a 
 id="dx189-344007"></a><a 
 id="x189-344008r1017"></a>   <i>value</i>  <b>&#x0026;optional</b>  <i>condition</i>
<!--l. 2632--><p class="noindent" >This function transfers control (and one value) to the restart named <i>store-value</i>. If
no such restart exists, <i>store-value</i> returns <i>nil</i>.
<!--l. 2636--><p class="indent" >   If condition is <i>nil</i> or not supplied, all outstanding restarts are considered.
If condition is not <i>nil</i>, only restarts associated with that condition are
considered.
<!--l. 2641--><p class="indent" >   The <i>store-value</i> restart is generally used by handlers trying to recover from
errors of types such as <i>cell-error</i> or <i>type-error</i>, where the handler may wish to
supply a replacement datum to be stored permanently.
</div>
<div class=defun>
<!--l. 2646--><p class="noindent" > <i>[Function]</i>   <b>use-value</b> <a 
 id="dx189-344009"></a><a 
 id="x189-344010r1018"></a>   <i>value</i>  <b>&#x0026;optional</b>  <i>condition</i>
<!--l. 2648--><p class="noindent" >This function transfers control (and one value) to the restart named <i>use-value</i>. If
no such restart exists, <i>use-value</i> returns <i>nil</i>.
<!--l. 2652--><p class="indent" >   If condition is <i>nil</i> or not supplied, all outstanding restarts are considered.
If condition is not <i>nil</i>, only restarts associated with that condition are
considered.
<!--l. 2657--><p class="indent" >   The <i>use-value</i> restart is generally used by handlers trying to recover from
errors of types such as <i>cell-error</i>, where the handler may wish to supply a
replacement datum for one-time use.
</div>
<!--l. 2663--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">29.4.11   </span> <a 
 id="x189-34500029.4.11"></a>Debugging Utilities</h4>
<!--l. 2666--><p class="noindent" >Common Lisp does not specify exactly what a debugger is or does, but it does
provide certain means for indicating intent to transfer control to a supervisory or
debugging facility.
<div class=defun>
<!--l. 2670--><p class="noindent" > <i>[Function]</i>   <b>break</b> <a 
 id="dx189-345001"></a><a 
 id="x189-345002r1019"></a>   <b>&#x0026;optional</b>  <i>format-string</i> <b>&#x0026;rest</b>  format-arguments
<!--l. 2672--><p class="noindent" >[This supersedes the description of <i>break</i> given in section <a 
href="clmse124.html#x153-22000024.1">24.1<!--tex4ht:ref: ERROR-SIGNALLING-FUNCTIONS --></a>.—GLS]
<!--l. 2676--><p class="indent" >   The function <i>break</i> prints the message described by the format-string
and format-arguments and then goes directly into the debugger without
allowing any possibility of interception by programmed error-handling
facilities.
<!--l. 2681--><p class="indent" >   If no format-string is supplied, a suitable default will be generated.
                                                                          

                                                                          
<!--l. 2683--><p class="indent" >   If continued, <i>break</i> returns <i>nil</i>.
<!--l. 2685--><p class="indent" >   Note that <i>break</i> is presumed to be used as a way of inserting temporary
debugging “breakpoints” in a program, not as a way of signaling errors; it is
expected that continuing from a <i>break</i> will not trigger any unusual recovery
action. For this reason, <i>break</i> does not take the additional format control string
that <i>cerror</i> takes as its ﬁrst argument. This and the lack of any possibility of
interception by programmed error handling are the only program-visible
diﬀerences between <i>break</i> and <i>cerror</i>. The user interface aspects of these functions
are permitted to vary more widely; for example, it is permissible for a
read-eval-print loop to be entered by <i>break</i> rather than by the conventional
debugger.
<i>
<!--l. 2696--><p class="indent" >   break</i> could be deﬁned by <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun break (&#x0026;optional (format-string &#x0022;Break&#x0022;)
</td></tr></table>
<!--l. 2698--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              &#x0026;rest format-arguments)</td></tr></table>
<!--l. 2699--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (with-simple-restart (continue &#x0022;Return from BREAK.&#x0022;)</td></tr></table>
<!--l. 2700--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (invoke-debugger</td></tr></table>
<!--l. 2701--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (make-condition &#x2019;simple-condition</td></tr></table>
<!--l. 2702--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                      :format-string format-string</td></tr></table>
<!--l. 2703--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                      :format-arguments format-arguments)))</td></tr></table>
<!--l. 2704--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  nil)</td></tr></table>
<!--l. 2706--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 2709--><p class="noindent" > <i>[Function]</i>   <b>invoke-debugger</b> <a 
 id="dx189-345003"></a><a 
 id="x189-345004r1020"></a>   <i>condition</i>
<!--l. 2711--><p class="noindent" >Attempts interactive handling of its argument, which must be a condition.
<!--l. 2714--><p class="indent" >   If the variable <i>*debugger-hook*</i> is not <i>nil</i>, it will be called as a function on two
arguments: the condition being handled and the value of <i>*debugger-hook*</i>. If a
hook function returns normally, the standard debugger will be tried.
<!--l. 2718--><p class="indent" >   The standard debugger will never directly return. Return can occur only by a
special transfer of control, such as the use of a restart.
<!--l. 2722--><p class="noindent" ><b>Remark:</b> The exact way in which the debugger interacts with users is expected to vary
considerably from system to system. For example, some systems may use a
                                                                          

                                                                          
keyboard interface, while others may use a mouse interface. Of those systems using
keyboard commands, some may use single-character commands and others may
use parsed line-at-a-time commands. The exact set of commands will vary as
well. The important properties of a debugger are that it makes information
about the error accessible and that it makes the set of apparent restarts easily
accessible.
<!--l. 2732--><p class="indent" >   It is desirable to have a mode where the debugger allows other features,
such as the ability to inspect data, stacks, etc. However, it may sometimes be
appropriate to have this kind of information hidden from users. Experience
on the Lisp Machines has shown that some users who are not programmers
develop a terrible phobia of debuggers. The reason for this usually may be
traced to the fact that the debugger is very foreign to them and provides an
overwhelming amount of information of interest only to programmers. With the
advent of restarts, there is a clear mechanism for the construction of “friendly”
debuggers. Programmers can be taught how to get to the information they
need for debugging, but it should be possible to construct user interfaces to
the debugger that are natural, convenient, intelligible, and friendly even to
non-programmers.
</div>
<div class=defun>
<!--l. 2748--><p class="noindent" > <i>[Variable]</i>   <b>*debugger-hook*</b> <a 
 id="dx189-345005"></a><a 
 id="x189-345006r1021"></a>
<!--l. 2750--><p class="noindent" >This variable should hold either <i>nil</i> or a function of two arguments, a condition
and the value of <i>*debugger-hook*</i>. This function may either handle the condition
(transfer control) or return normally (allowing the standard debugger to
run).
<!--l. 2756--><p class="indent" >   Note that, to minimize recursive errors while debugging, <i>*debugger-hook*</i> is
bound to <i>nil</i> when calling this function. When evaluating code typed in by the
user interactively, the hook function may want to bind <i>*debugger-hook*</i> to the
function that was its second argument so that recursive errors can be handled
using the same interactive facility.
</div>
                                                                          

                                                                          
   <!--l. 2765--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse156.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse154.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse154.html#tailclmse154.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse155.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch29.html#clmse155.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 2765--><p class="indent" >   <a 
 id="tailclmse155.html"></a>  
</body></html> 
