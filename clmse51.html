<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Список свойств</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-19 15:57:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 625--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse52.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#tailclmch10.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse51.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#clmse51.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">10.1   </span> <a 
href="clm.html#QQ2-66-164" id="x66-15700010.1">Список свойств</a></h3>
<!--l. 627--><p class="noindent" >Начиная с самого создания, Lisp для каждого символа ассоциирует
табличную структуру данных, называемую <i>список свойств</i> (для краткости
<i>plist</i>). Список свойств содержит ноль и более элементов. Каждый элемент
содержит ключ (называемым <i>индикатором</i>), который чаще всего является
символом, и ассоциированным с ним значением (называемым иногда
<i>свойством</i>), которое может быть любым Lisp&#x2019;овым объектом. Среди
индикаторов не может быть дубликатов. Список свойств может иметь только
одно свойство для данного имени. Таким образом, значение может получено
с помощью двух символов: исходного символа и индикатора.
<!--l. 637--><p class="indent" >   Список свойств по целевому назначению очень похож на ассоциативный
список. Различие в том, что список свойств является единственно подлинным
объектом. Операции добавления и удаления элементов деструктивны, то есть
при их использовании изменяется старый список, и нового списка свойств
не создаётся. Ассоциативные список, наоборот, обычно изменяются
недеструктивно (без побочных эффектов) с помощью добавления в начало
новых элементов (смотрите <a 
href="clmse86.html#x106-210002r496">acons</a> и <a 
href="clmse86.html#x106-210004r497">pairlis</a>).
<!--l. 645--><p class="indent" >   Список свойств реализуется, как ячейка памяти, содержащая список с
чётным (возможно нулевым) количеством аргументов. (Обычно эта ячейка
памяти является ячейкой списка свойств в символе, но в принципе подходит
любая ячейка памяти, к которой можно применить <a 
href="clmse36.html#x48-90002r64">setf</a>) Каждая пара
элементов в списке составляет строку. Первый в паре это индикатор, а
второй — значение. Так как функции для списка свойств используют
символ, а не сам список, то изменения этого списка свойств может быть
записаны сохранением обратно в ячейку списка свойств символа.
FIXME
<!--l. 654--><p class="indent" >   Когда создаётся символ, его список свойств пуст. Свойства создаются с
помощью <a 
href="#x66-157002r127">get</a> внутри формы <a 
href="clmse36.html#x48-90002r64">setf</a>.
<!--l. 657--><p class="indent" >   Common Lisp не использует список свойств символа так интенсивно, как
это делали ранние реализации Lisp&#x2019;а. В Common Lisp&#x2019;е нечасто используемые
данные, такие как отладочная информация, информация для компилятора и
документация, хранятся в списках свойств.
<div class=defun>
<!--l. 662--><p class="noindent" ><i>[Функция]</i><a 
 id="dx66-157001"></a><a 
 id="x66-157002r127"></a><b> get</b>  <i>symbol</i> <i>indicator</i> &#x0026;optional  <i>default</i>
<!--l. 664--><p class="noindent" ><a 
href="#x66-157002r127">get</a> ищет в списке свойств символа <i>symbol</i> индикатор равный <a 
href="clmse33.html#x44-78002r44">eq</a> индикатору
                                                                          

                                                                          
<i>indicator</i>. Первый аргумент должен быть символом. Если такое свойство
найдено, возвращается её значение. Иначе возвращается значение
<i>default</i>.
<!--l. 671--><p class="indent" >   Если <i>default</i> не указано, тогда для значения по-умолчанию используется
<a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 674--><p class="indent" >   Следует отметить, что способа отличить значения по-умолчанию и такое
же значение свойства нет: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get x y) <span class="math"> ≡</span> (getf (symbol-plist x) y)
</td></tr></table>
<!--l. 678--><p class="indent" >
</div>
</div>
<!--l. 679--><p class="noindent" >Допустим, что список свойств символа foo является (bar t baz 3 hunoz &#x0022;Huh?&#x0022;).
Тогда, например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get &#x2019;foo &#x2019;baz) <span class="math"> ⇒</span> 3
</td></tr></table>
<!--l. 683--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get &#x2019;foo &#x2019;hunoz) <span class="math"> ⇒</span> &#x0022;Huh?&#x0022;</td></tr></table>
<!--l. 684--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get &#x2019;foo &#x2019;zoo) <span class="math"> ⇒</span> <a 
href="clmse31.html#x42-74002r18">nil</a></td></tr></table>
<!--l. 686--><p class="indent" >
</div>
</div>
<!--l. 688--><p class="indent" >   <a 
href="clmse36.html#x48-90002r64">setf</a> может использоваться вместе с <a 
href="#x66-157002r127">get</a> для создания новой пары
свойства, возможно замещая старую пару с тем же именем. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(get &#x2019;clyde &#x2019;species) <span class="math"> ⇒</span> <a 
href="clmse31.html#x42-74002r18">nil</a>
</td></tr></table>
<!--l. 692--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (get &#x2019;clyde &#x2019;species) &#x2019;elephant) <span class="math"> ⇒</span> elephant</td></tr></table>
<!--l. 693--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">и теперь (get &#x2019;clyde &#x2019;species) <span class="math"> ⇒</span> elephant</td></tr></table>
<!--l. 695--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 696--><p class="noindent" >В данном контексте может быть указан аргумент <i>default</i>. Он игнорируется в
<a 
href="clmse36.html#x48-90002r64">setf</a>, но может быть полезен в таких макросах, как <a 
href="clmse82.html#x102-203060r466">push</a>, которые связаны с
<a 
href="clmse36.html#x48-90002r64">setf</a>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(push item (get sym &#x2019;token-stack &#x2019;(initial-item)))
</td></tr></table>
<!--l. 701--><p class="indent" >
</div>
</div>
<!--l. 702--><p class="noindent" >означает то же, что и <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (get sym &#x2019;token-stack &#x2019;(initial-item))
</td></tr></table>
<!--l. 704--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (cons item (get sym &#x2019;token-stack &#x2019;(initial-item))))</td></tr></table>
<!--l. 706--><p class="indent" >
</div>
</div>
<!--l. 707--><p class="noindent" >а если упростить, то <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setf (get sym &#x2019;token-stack)
</td></tr></table>
<!--l. 709--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (cons item (get sym &#x2019;token-stack &#x2019;(initial-item))))</td></tr></table>
<!--l. 711--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 714--><p class="noindent" ><i>[Функция]</i><a 
 id="dx66-157003"></a><a 
 id="x66-157004r128"></a><b> remprop</b>  <i>symbol</i> <i>indicator</i>
<!--l. 716--><p class="noindent" >Эта функция удаляет из символа <i>symbol</i> свойство с индикатором, равным <a 
href="clmse33.html#x44-78002r44">eq</a>
индикатору <i>indicator</i>. Индикатор свойства и соответствующее значение
удаляется из списка деструктивной склейкой списка свойств. Она возвращает
<a 
href="clmse31.html#x42-74002r18">nil</a>, если указанного свойства не было, или не-<a 
href="clmse31.html#x42-74002r18">nil</a>, если свойство было.
<div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remprop x y) <span class="math"> ≡</span> (remf (symbol-plist x) y)
</td></tr></table>
<!--l. 724--><p class="indent" >
</div>
</div>
<!--l. 725--><p class="noindent" >Например, если список свойств foo равен <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(color blue height 6.3 near-to bar)
</td></tr></table>
<!--l. 728--><p class="indent" >
</div>
</div>
<!--l. 729--><p class="noindent" >тогда вызов <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remprop &#x2019;foo &#x2019;height)
</td></tr></table>
<!--l. 732--><p class="indent" >
</div>
</div>
<!--l. 733--><p class="noindent" >вернёт значение не-<a 
href="clmse31.html#x42-74002r18">nil</a>, после изменения списка свойств символа foo на
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(color blue near-to bar)
</td></tr></table>
<!--l. 736--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 739--><p class="noindent" ><i>[Функция]</i><a 
 id="dx66-157005"></a><a 
 id="x66-157006r129"></a><b> symbol-plist</b>  <i>symbol</i>
<!--l. 741--><p class="noindent" >Эта функция возвращает список, который содержит пары свойств для
символа <i>symbol</i>. Извлекается содержимое ячейки списка свойств и
возвращается в качестве результата.
                                                                          

                                                                          
<!--l. 746--><p class="indent" >   Следует отметить, что использование <a 
href="#x66-157002r127">get</a> с результатом <a 
href="#x66-157006r129">symbol-plist</a> <i>не</i>
будет работать. Необходимо передавать в <a 
href="#x66-157002r127">get</a> символ, или же использовать
<a 
href="#x66-157008r130">getf</a>.
<!--l. 750--><p class="indent" >   С <a 
href="#x66-157006r129">symbol-plist</a> может использоваться <a 
href="clmse36.html#x48-90002r64">setf</a> для деструктивной замены
списка свойств символа. Это относительно опасная операция, так как может
уничтожить важную информацию, которую, возможно, хранила там
реализация. Также, позаботьтесь о том, чтобы новый список свойств
содержал чётное количество элементов.
</div>
<div class=defun>
<!--l. 757--><p class="noindent" ><i>[Функция]</i><a 
 id="dx66-157007"></a><a 
 id="x66-157008r130"></a><b> getf</b>  <i>place</i> <i>indicator</i> &#x0026;optional  <i>default</i>
<!--l. 759--><p class="noindent" ><a 
href="#x66-157008r130">getf</a> ищет индикатор равный <a 
href="clmse33.html#x44-78002r44">eq</a> <i>indicator</i> в списке свойств, находящимся в
<i>place</i>. Если он найден, тогда возвращается соответствующее значение. Иначе
возвращается <i>default</i>. Если <i>default</i> не задан, то значение по-умолчанию
используется . Следует отметить, что метода определения, вернулось
ли значение по умолчанию или это значение свойства, нет. Часто
<i>place</i> вычисляется из обобщённой переменной, принимаемой функцией
<a 
href="clmse36.html#x48-90002r64">setf</a>.
<!--l. 769--><p class="indent" >   <a 
href="clmse36.html#x48-90002r64">setf</a> может использоваться вместе <a 
href="#x66-157008r130">getf</a>, и в этом случае <i>place</i> должно быть
обобщённым, чтобы его можно было передать в <a 
href="clmse36.html#x48-90002r64">setf</a>. Целью является
добавление новой пары свойства, или изменению уже существующей пары, в
списке свойств, хранящимся в <i>place</i>. В данном контексте может быть
использован аргумент <i>default</i>. Он игнорируется функцией <a 
href="clmse36.html#x48-90002r64">setf</a>, но может быть
полезен в таких макросах, как <a 
href="clmse82.html#x102-203060r466">push</a>, которые связаны с <a 
href="clmse36.html#x48-90002r64">setf</a>. Смотрите
описание <a 
href="#x66-157002r127">get</a> для примера.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> remf </b><a 
 id="dx66-157009"></a><a 
 id="x66-157010r131"></a> place indicator
</td></tr></table>
<!--l. 781--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 781--><p class="noindent" ><span class="paragraphHead"><a 
href="#x66-15800010.1" id="x66-15800010.1"></a></span>
   Эта функция в списке свойств, хранящимся в <i>place</i>, удаляет свойства,
индикатор которого равен <a 
href="clmse33.html#x44-78002r44">eq</a> аргументу <i>indicator</i>. Индикатор свойства и
соответствующее значение удаляется из списка деструктивной склейкой. <a 
href="#x66-157010r131">remf</a>
возвращает <a 
href="clmse31.html#x42-74002r18">nil</a>, если свойства не было в списке, и некоторое не-<a 
href="clmse31.html#x42-74002r18">nil</a> значение,
если свойство было. Форма <i>place</i> может быть любой обобщённой переменной,
принимаемой <a 
href="clmse36.html#x48-90002r64">setf</a>. Смотрите <a 
href="#x66-157004r128">remprop</a>.
</div>
<div class=defun>
<!--l. 792--><p class="noindent" ><i>[Функция]</i><a 
 id="dx66-158001"></a><a 
 id="x66-158002r132"></a><b> get-properties</b>  <i>place</i> <i>indicator-list</i>
<!--l. 794--><p class="noindent" ><a 
href="#x66-158002r132">get-properties</a> похожа на <a 
href="#x66-157008r130">getf</a> за исключением того, что второй аргумент
является списком индикаторов. <a 
href="#x66-158002r132">get-properties</a> ищет первый встретившийся
индикатор, который есть в списке индикаторов. Обычно <i>place</i> вычисляется из
обобщённой переменной, которая может использоваться в <a 
href="clmse36.html#x48-90002r64">setf</a>.
<!--l. 800--><p class="indent" >   <a 
href="#x66-158002r132">get-properties</a> возвращает три значения. Если было найдено свойство, то
первые два значения являются индикатором и значением для первого
свойства, чей индикатор присутствовал в списке <i>indicator-list</i>, и третье
значение является остатком списка свойств, <i>car</i> элемент которого был
индикатором (и соответственно <i>cadr</i> элемент — значением). Если ни одного
свойства не было найдено, то все три значения равны <a 
href="clmse31.html#x42-74002r18">nil</a>. Третье значение
является флагом успешности или неудачи, и позволяет продолжить поиск
свойств в оставшемся списке.
</div>
                                                                          

                                                                          
   <!--l. 811--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse52.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#tailclmch10.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse51.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#clmse51.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 811--><p class="indent" >   <a 
 id="tailclmse51.html"></a>  
</body></html> 
