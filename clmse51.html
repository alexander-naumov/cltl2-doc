<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Declaration Syntax</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-02-20 00:42:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 26--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse52.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#tailclmch9.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse51.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse51.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">9.1   </span> <a 
 id="x65-1040009.1"></a>Declaration Syntax</h3>
<!--l. 29--><p class="noindent" >The <i>declare</i> construct is used for embedding declarations within executable code.
Global declarations and declarations that are computed by a program are
established by the <i>proclaim</i> construct.
<div class=newer>
<!--l. 34--><p class="indent" >   X3J13 voted in June 1989 ⟨<b>?</b>⟩ to introduce the new macro <i>declaim</i>, which is
guaranteed to be recognized appropriately by the compiler and is often more
convenient than <i>proclaim</i> for establishing global declarations.
</div>
<div class=defspec>
<!--l. 41--><p class="noindent" ><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> declare </b> <a 
 id="dx65-104001"></a><a 
 id="x65-104002r152"></a>   {<i>decl − spec</i>}∗
</td></tr></table>
<!--l. 42--><p class="indent" >
</div>
   A <i>declare</i> form is known as a declaration. Declarations may occur only at the
beginning of the bodies of certain special forms; that is, a declaration may occur
only as a statement of such a special form, and all statements preceding it (if any)
must also be <i>declare</i> forms (or possibly documentation strings, in some cases).
Declarations may occur in lambda-expressions and in the forms listed here. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>deﬁne-setf-method</i>            </td><td  
class="tabbing"><i>labels</i>
</td></tr></table>
<!--l. 52--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>defmacro</i>                       </td><td  
class="tabbing"><i>let</i></td></tr></table>
<!--l. 53--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>defsetf </i>                          </td><td  
class="tabbing"><i>let*</i></td></tr></table>
<!--l. 54--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>deftype</i>                          </td><td  
class="tabbing"><i>locally</i></td></tr></table>
<!--l. 55--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>defun</i>                           </td><td  
class="tabbing"><i>macrolet</i></td></tr></table>
<!--l. 56--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>do</i>                               </td><td  
class="tabbing"><i>multiple-value-bind</i></td></tr></table>
<!--l. 57--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>do*</i>                              </td><td  
class="tabbing"><i>prog</i></td></tr></table>
<!--l. 58--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>do-all-symbols</i>                 </td><td  
class="tabbing"><i>prog*</i></td></tr></table>
<!--l. 59--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>do-external-symbols</i>          </td><td  
class="tabbing"><i>with-input-from-string</i></td></tr></table>
<!--l. 60--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>do-symbols</i>                     </td><td  
class="tabbing"><i>with-open-ﬁle</i></td></tr></table>
<!--l. 61--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>dolist</i>                            </td><td  
class="tabbing"><i>with-open-stream</i></td></tr></table>
<!--l. 62--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>dotimes</i>                         </td><td  
class="tabbing"><i>with-output-to-string</i></td></tr></table>
<!--l. 63--><p class="indent" >                                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>ﬂet</i></td></tr></table>
<!--l. 65--><p class="indent" >
</div>
</div>
<div class=new>
<!--l. 67--><p class="noindent" >Notice of correction. In the ﬁrst edition, the above list failed to mention the forms
<i>deﬁne-setf-method</i>, <i>with-input-from-string</i>, <i>with-open-ﬁle</i>, <i>with-open-stream</i>, and
<i>with-output-to-string</i>, even though their individual descriptions in the ﬁrst edition
speciﬁed that declarations may appear in those forms.
</div>
<!--l. 75--><p class="noindent" >X3J13 voted in June 1989 ⟨<b>?</b>⟩ to add <i>with-condition-restarts</i> and also ⟨<b>?</b>⟩ to add
<i>print-unreadable-object</i> and <i>with-standard-io-syntax</i>. The X3J13 vote left
it unclear whether these macros permit declarations to appear at the
                                                                          

                                                                          
heads of their bodies. I believe that was the intent, but this is only my
interpretation.
<div class=new>
<!--l. 84--><p class="indent" >   X3J13 voted in June 1988 ⟨<b>?</b>⟩ to adopt the Common Lisp Object System,
which includes the following additional forms in which declarations may occur: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>defgeneric</i>                      </td><td  
class="tabbing"><i>generic-function</i>
</td></tr></table>
<!--l. 91--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>deﬁne-method-combination</i>  </td><td  
class="tabbing"><i>generic-labels</i></td></tr></table>
<!--l. 92--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>defmethod</i>                      </td><td  
class="tabbing"><i>with-added-methods</i></td></tr></table>
<!--l. 93--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>generic-ﬂet</i></td></tr></table>
<!--l. 95--><p class="indent" >
</div>
</div>
<!--l. 96--><p class="noindent" >Furthermore X3J13 voted in January 1989 ⟨<b>?</b>⟩ to allow declarations to occur before
the bodies of these forms: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><i>symbol-macrolet</i>               </td><td  
class="tabbing"><i>with-slots</i>
</td></tr></table>
<!--l. 102--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><i>with-accessors</i></td></tr></table>
<!--l. 104--><p class="indent" >
</div>
</div>
<!--l. 105--><p class="noindent" >There are certain aspects peculiar to <i>symbol-macrolet</i> (and therefore also to
<i>with-accessors</i> and <i>with-slots</i>, which expand into uses of <i>symbol-macrolet</i>). An
error is signaled if a name deﬁned by <i>symbol-macrolet</i> is declared <i>special</i>, and a
type declaration of a name deﬁned by <i>symbol-macrolet</i> is equivalent in eﬀect to
wrapping a <i>the</i> form mentioning that type around the expansion of the deﬁned
symbol.
</div>
<!--l. 115--><p class="indent" >   It is an error to attempt to evaluate a declaration. Those special forms that
permit declarations to appear perform explicit checks for their presence.
<div class=incompatibility>
                                                                          

                                                                          
<!--l. 120--><p class="noindent" ><b>Compatibility note:</b> In MacLisp, <i>declare</i> is a special form that does nothing but
return the symbol <i>declare</i> as its result. The MacLisp interpreter knows nothing about
declarations but just blindly evaluates them, eﬀectively ignoring them. The MacLisp
compiler recognizes declarations but processes them simply by evaluating the subforms
of the declaration in the compilation context. In Common Lisp it is important that
both the interpreter and compiler recognize declarations (especially <i>special</i>
declarations) and treat them consistently, and so the rules about the structure
and use of declarations have been made considerably more stringent. The odd
tricks played in MacLisp by writing arbitrary forms to be evaluated within a
<i>declare</i> form are better done in both MacLisp and Common Lisp by using
<i>eval-when</i>.
</div>
<!--l. 139--><p class="indent" >   It is permissible for a macro call to expand into a declaration and be
recognized as such, provided that the macro call appears where a declaration may
legitimately appear. (However, a macro call may not appear in place of a
decl-spec.)
<div class=new>
<!--l. 145--><p class="indent" >   X3J13 voted in March 1988 ⟨<b>?</b>⟩ to eliminate the recognition of a declaration
resulting from the expansion of a macro call. This feature proved to be seldom
used and awkward to implement in interpreters, compilers, and other
code-analyzing programs.
<!--l. 152--><p class="indent" >   Under this change, a declaration is recognized only as such if it appears
explicitly, as a list whose car is the symbol <i>declare</i>, in the body of a relevant
special form. (Note, however, that it is still possible for a macro to expand into a
call to the <i>proclaim</i> function.)
</div>
<!--l. 159--><p class="indent" >   Each decl-spec is a list whose car is a symbol specifying the kind of declaration
to be made. Declarations may be divided into two classes: those that concern the
bindings of variables, and those that do not. (The <i>special</i> declaration is the
sole exception: it eﬀectively falls into both classes, as explained below.)
Those that concern variable bindings apply only to the bindings made
by the form at the head of whose body they appear. For example, in <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x)
</td></tr></table>
<!--l. 168--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (type ﬂoat x)) ...</td></tr></table>
<!--l. 169--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((x &#x2019;a)) ...)</td></tr></table>
                                                                          

                                                                          
<!--l. 170--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 172--><p class="indent" >
</div>
</div>
<!--l. 173--><p class="noindent" >the <i>type</i> declaration applies only to the outer binding of <i>x</i>, and not to the binding
made in the <i>let</i>.
<div class=incompatibility>
<!--l. 177--><p class="noindent" ><b>Compatibility note:</b> This represents a diﬀerence from MacLisp, in which type
declarations are pervasive.
</div>
<!--l. 183--><p class="indent" >   Declarations that do not concern themselves with variable bindings are
pervasive, aﬀecting all code in the body of the special form. As an example of a
pervasive declaration, <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x y) (declare (notinline ﬂoor)) ...)
</td></tr></table>
<!--l. 188--><p class="indent" >
</div>
</div>
<!--l. 189--><p class="noindent" >advises that everywhere within the body of <i>foo</i> the function <i>ﬂoor</i> should not be
open-coded but called as an out-of-line subroutine.
<!--l. 192--><p class="indent" >   Some special forms contain pieces of code that, properly speaking, are not part
of the body of the special form. Examples of this are initialization forms
that provide values for bound variables, and the result forms of iteration
constructs. In all cases such additional code is within the scope of any
pervasive declarations appearing before the body of the special form.
Non-pervasive declarations have no eﬀect on such code, except (of course)
in those situations where the code is deﬁned to be within the scope of
the variables aﬀected by such non-pervasive declarations. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun few (x <i>&#x0026;optional</i> (y *print-circle*))
</td></tr></table>
<!--l. 203--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (special *print-circle*))</td></tr></table>
<!--l. 204--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 206--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 207--><p class="noindent" >The reference to <i>*print-circle*</i> in the ﬁrst line of this example is special because of
the declaration in the second line. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun nonsense (k x z)
</td></tr></table>
<!--l. 210--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (foo z x)               ;First call to <i>foo</i></td></tr></table>
<!--l. 211--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((j (foo k x))     ;Second call to <i>foo</i></td></tr></table>
<!--l. 212--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (x (* k k)))</td></tr></table>
<!--l. 213--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (declare (inline foo) (special x z))</td></tr></table>
<!--l. 214--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (foo x j z)))         ;Third call to <i>foo</i></td></tr></table>
<!--l. 216--><p class="indent" >
</div>
</div>
<!--l. 217--><p class="noindent" >In this rather nonsensical example, the <i>inline</i> declaration applies to the second
and third calls to <i>foo</i>, but not to the ﬁrst one. The <i>special</i> declaration
of <i>x</i> causes the <i>let</i> form to make a special binding for <i>x</i> and causes the
reference to <i>x</i> in the body of the <i>let</i> to be a special reference. The reference
to <i>x</i> in the second call to <i>foo</i> is also a special reference. The reference
to <i>x</i> in the ﬁrst call to <i>foo</i> is a local reference, not a special one. The
<i>special</i> declaration of <i>z</i> causes the reference to <i>z</i> in the call to <i>foo</i> to be a
special reference; it will not refer to the parameter to <i>nonsense</i> named <i>z</i>,
because that parameter binding has not been declared to be <i>special</i>. (The
<i>special</i> declaration of <i>z</i> does not appear in the body of the <i>defun</i>, but
in an inner construct, and therefore does not aﬀect the binding of the
parameter.)
<div class=new>
<!--l. 236--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to replace the rules concerning the scope of
declarations occurring at the head of a special form or lambda-expression:
      <ul class="itemize1">
      <li class="itemize">The scope of a declaration always includes the body forms, as well as
      any “stepper” or “result” forms (which are logically part of the body),
      of the special form or lambda-expression.
      </li>
                                                                          

                                                                          
      <li class="itemize">If the declaration applies to a name binding, then the scope of the
      declaration also includes the scope of the name binding.</li></ul>
<!--l. 248--><p class="noindent" >Note that the distinction between pervasive and non-pervasive declarations is
eliminated. An important change from the ﬁrst edition is that “initialization”
forms are speciﬁcally not included as part of the body under the ﬁrst rule; on the
other hand, in many cases initialization forms may fall within the scope of certain
declarations under the second rule.
</div>
<div class=new>
<!--l. 258--><p class="indent" >   X3J13 also voted in January 1989 ⟨<b>?</b>⟩ to change the interpretation of <i>type</i>
declarations (see section <a 
href="clmse52.html#x66-1050009.2">9.2<!--tex4ht:ref: DECLARATION-SPECIFIERS-SECTION --></a>).
</div>
<div class=new>
<!--l. 265--><p class="indent" >   These changes aﬀect the interpretation of some of the examples from the ﬁrst
edition. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x)
</td></tr></table>
<!--l. 268--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (type ﬂoat x)) ...</td></tr></table>
<!--l. 269--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((x &#x2019;a)) ...)</td></tr></table>
<!--l. 270--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 272--><p class="indent" >
</div>
</div>
<!--l. 273--><p class="noindent" >Under the interpretation approved by X3J13, the type declaration applies to both
bindings of <i>x</i>. More accurately, the type declaration is considered to apply to
variable references rather than bindings, and the type declaration refers to every
reference in the body of <i>foo</i> to a variable named <i>x</i>, no matter to what binding it
may refer. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x y) (declare (notinline ﬂoor)) ...)
</td></tr></table>
<!--l. 281--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 282--><p class="noindent" >This example of the use of <i>notinline</i> stands unchanged, but the following slight
extension of it would change: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x &#x0026;optional (y (ﬂoor x)))
</td></tr></table>
<!--l. 285--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (notinline ﬂoor)) ...)</td></tr></table>
<!--l. 287--><p class="indent" >
</div>
</div>
<!--l. 288--><p class="noindent" >Under ﬁrst edition rules, the <i>notinline</i> declaration would be considered to apply to
the call to <i>ﬂoor</i> in the initialization form for <i>y</i>. Under the interpretation approved
by X3J13, the <i>notinline</i> would not apply to that particular call to <i>ﬂoor</i>. Instead
the user must write something like <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x &#x0026;optional (y (locally (declare (notinline ﬂoor))
</td></tr></table>
<!--l. 294--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                    (ﬂoor x))))</td></tr></table>
<!--l. 295--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (notinline ﬂoor)) ...)</td></tr></table>
<!--l. 297--><p class="indent" >
</div>
</div>
<!--l. 298--><p class="noindent" >or perhaps <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(locally (declare (notinline ﬂoor))
</td></tr></table>
<!--l. 300--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (defun foo (x &#x0026;optional (y (ﬂoor x))) ...))</td></tr></table>
<!--l. 302--><p class="indent" >
</div>
</div>
<!--l. 303--><p class="noindent" >Similarly, the <i>special</i> declaration in <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun few (x <i>&#x0026;optional</i> (y *print-circle*))
</td></tr></table>
                                                                          

                                                                          
<!--l. 305--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (special *print-circle*))</td></tr></table>
<!--l. 306--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 308--><p class="indent" >
</div>
</div>
<!--l. 309--><p class="noindent" >is not considered to apply to the reference in the initialization form for <i>y</i> in <i>few</i>. As
for the <i>nonsense</i> example, <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun nonsense (k x z)
</td></tr></table>
<!--l. 312--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (foo z x)               ;First call to <i>foo</i></td></tr></table>
<!--l. 313--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((j (foo k x))     ;Second call to <i>foo</i></td></tr></table>
<!--l. 314--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (x (* k k)))</td></tr></table>
<!--l. 315--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (declare (inline foo) (special x z))</td></tr></table>
<!--l. 316--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (foo x j z)))         ;Third call to <i>foo</i></td></tr></table>
<!--l. 318--><p class="indent" >
</div>
</div>
<!--l. 319--><p class="noindent" >under the interpretation approved by X3J13, the <i>inline</i> declaration is no
longer considered to apply to the second call to <i>foo</i>, because it is in an
initialization form, which is no longer considered in the scope of the declaration.
Similarly, the reference to <i>x</i> in that second call to <i>foo</i> is no longer taken to
be a special reference, but a local reference to the second parameter of
<i>nonsense</i>.
</div>
</div>
<div class=obsolete>
<div class=defmac>
<!--l. 331--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> locally </b> <a 
 id="dx65-104003"></a><a 
 id="x65-104004r153"></a>   {<i>declaration</i>}∗  {<i>form</i>}∗
</td></tr></table>
<!--l. 332--><p class="indent" >
</div>
                                                                          

                                                                          
   This macro may be used to make local pervasive declarations where desired. It
does not bind any variables and therefore cannot be used meaningfully for
declarations of variable bindings. (Note that the <i>special</i> declaration may be used
with <i>locally</i> to pervasively aﬀect references to, rather than bindings of, variables.)
For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(locally (declare (inline ﬂoor) (notinline car cdr))
</td></tr></table>
<!--l. 340--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (declare (optimize space))</td></tr></table>
<!--l. 341--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (ﬂoor (car x) (cdr y)))</td></tr></table>
<!--l. 343--><p class="indent" >
</div>
</div>
</div>
</div>
<div class=new>
<!--l. 348--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <i>locally</i> executes the forms as
an implicit <i>progn</i> and returns the value(s) of the last form.
</div>
<div class=newer>
<!--l. 355--><p class="indent" >   X3J13 voted in March 1989 ⟨<b>?</b>⟩ to make <i>locally</i> be a special form rather than a
macro. It still has the same syntax.
<div class=defspec>
<!--l. 359--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> locally </b> <a 
 id="dx65-104005"></a><a 
 id="x65-104006r154"></a>   {<i>declaration</i>}∗  {<i>form</i>}∗
</td></tr></table>
<!--l. 360--><p class="indent" >
</div>
   This change was made to accommodate the new compilation model for
top-level forms in a ﬁle (see section <a 
href="clmse127.html#x157-22400025.1">25.1<!--tex4ht:ref: COMPILER-SECTION --></a>). When a <i>locally</i> form appears at top
level, the forms in its body are processed as top-level forms. This means that one
may, for example, meaningfully use <i>locally</i> to wrap declarations around a <i>defun</i> or
<i>defmacro</i> form: <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(locally
</td></tr></table>
<!--l. 367--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (optimize (safety 3) (space 3) (debug 3) (speed 1)))</td></tr></table>
<!--l. 368--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (defun foo (x &#x0026;optional (y (abs x)) (z (sqrt y)))</td></tr></table>
<!--l. 369--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (bar x y z)))</td></tr></table>
<!--l. 371--><p class="indent" >
</div>
</div>
<!--l. 372--><p class="noindent" >Without assurance that this works one must write something cumbersome such as <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">
</td></tr></table>
<!--l. 375--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x &#x0026;optional (y (locally</td></tr></table>
<!--l. 376--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                              (declare (optimize (safety 3)</td></tr></table>
<!--l. 377--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                                 (space 3)</td></tr></table>
<!--l. 378--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                                 (debug 3)</td></tr></table>
<!--l. 379--><p class="indent" >      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                                 (speed 1)))</td></tr></table>
<!--l. 380--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                              (abs x)))</td></tr></table>
<!--l. 381--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                         (z (locally</td></tr></table>
<!--l. 382--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                              (declare (optimize (safety 3)</td></tr></table>
<!--l. 383--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                                 (space 3)</td></tr></table>
<!--l. 384--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                                 (debug 3)</td></tr></table>
<!--l. 385--><p class="indent" >      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                                 (speed 1)))</td></tr></table>
<!--l. 386--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                              (sqrt y))))</td></tr></table>
<!--l. 387--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (locally</td></tr></table>
<!--l. 388--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (declare (optimize (safety 3) (space 3) (debug 3) (speed 1)))</td></tr></table>
<!--l. 389--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (bar x y z)))</td></tr></table>
<!--l. 391--><p class="indent" >
</div>
</div>
</div>
</div>
<!--l. 395--><p class="indent" >
                                                                          

                                                                          
<div class=defun>
<!--l. 397--><p class="noindent" > <i>[Function]</i>   <b>proclaim</b> <a 
 id="dx65-104007"></a><a 
 id="x65-104008r155"></a>   <i>decl-spec</i>
<!--l. 399--><p class="noindent" >The function <i>proclaim</i> takes a decl-spec as its argument and puts it into eﬀect
globally. (Such a global declaration is called a proclamation.) Because
<i>proclaim</i> is a function, its argument is always evaluated. This allows a
program to compute a declaration and then put it into eﬀect by calling
<i>proclaim</i>.
<!--l. 407--><p class="indent" >   Any variable names mentioned are assumed to refer to the dynamic values of
the variable. For example, the proclamation <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(type ﬂoat tolerance))
</td></tr></table>
<!--l. 412--><p class="indent" >
</div>
</div>
<!--l. 413--><p class="noindent" >once executed, speciﬁes that the dynamic value of <i>tolerance</i> should always be a
ﬂoating-point number. Similarly, any function-names mentioned are assumed to
refer to the global function deﬁnition.
<!--l. 419--><p class="indent" >   A proclamation constitutes a universal declaration, always in force unless
locally shadowed. For example, <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(inline ﬂoor))
</td></tr></table>
<!--l. 423--><p class="indent" >
</div>
</div>
<!--l. 424--><p class="noindent" >advises that <i>ﬂoor</i> should normally be open-coded in-line by the compiler (but in the
situation <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x y) (declare (notinline ﬂoor)) ...)
</td></tr></table>
<!--l. 428--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 429--><p class="noindent" >it will be compiled out-of-line anyway in the body of <i>foo</i>, because of the shadowing
local declaration to that eﬀect).
<div class=newer>
<!--l. 433--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to clarify that such shadowing does not occur
in the case of type declarations. If there is a local type declaration for a special
variable and there is also a global proclamation for that same variable, then the
value of the variable within the scope of the local declaration must be a member
of the intersection of the two declared types. This is consistent with the treatment
of nested local type declarations on which X3J13 also voted in January 1989
⟨<b>?</b>⟩.
</div>
<!--l. 443--><p class="indent" >   As a special case (so to speak), <i>proclaim</i> treats a <i>special</i> decl-spec as applying
to all bindings as well as to all references of the mentioned variables.
<div class=new>Notice of correction. In the ﬁrst edition, this sentence referred to a “<i>special</i>
declaration-form.” That was incorrect; <i>proclaim</i> accepts only a decl-spec, not a
declaration-form.
</div>
<!--l. 453--><p class="indent" >   For example, after <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(special x))
</td></tr></table>
<!--l. 456--><p class="indent" >
</div>
</div>
<!--l. 457--><p class="noindent" >in a function deﬁnition such as <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun example (x) ...)
</td></tr></table>
<!--l. 460--><p class="indent" >
</div>
</div>
<!--l. 461--><p class="noindent" >the parameter <i>x</i> will be bound as a special (dynamic) variable rather than as a lexical
(static) variable. This facility should be used with caution. The usual way to
deﬁne a globally special variable is with <i>defvar</i> or <i>defparameter</i>.
</div>
                                                                          

                                                                          
<div class=newer>
<!--l. 468--><p class="indent" >   X3J13 voted in June 1989 ⟨<b>?</b>⟩ to clarify that the compiler is not required to
treat calls to <i>proclaim</i> any diﬀerently from the way it treats any other function
call. If a top-level call to <i>proclaim</i> is to take eﬀect at compile time, it should be
surrounded by an appropriate <i>eval-when</i> form. Better yet, the new macro <i>declaim</i>
may be used instead.
<div class=defmac>
<!--l. 477--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> declaim </b> <a 
 id="dx65-104009"></a><a 
 id="x65-104010r156"></a>   {<i>decl − spec</i>}∗
</td></tr></table>
<!--l. 478--><p class="indent" >
</div>
   This macro is syntactically like <i>declare</i> and semantically like <i>proclaim</i>. It is an
executable form and may be used anywhere <i>proclaim</i> may be called. However,
each decl-spec is not evaluated.
   If a call to this macro appears at top level in a ﬁle being processed by the ﬁle
compiler, the proclamations are also made at compile time. As with other deﬁning
macros, it is unspeciﬁed whether or not the compile-time side eﬀects of a <i>declaim</i>
persist after the ﬁle has been compiled (see section <a 
href="clmse127.html#x157-22400025.1">25.1<!--tex4ht:ref: COMPILER-SECTION --></a>).
</div>
</div>
                                                                          

                                                                          
   <!--l. 493--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse52.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#tailclmch9.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse51.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse51.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 493--><p class="indent" >   <a 
 id="tailclmse51.html"></a>  
</body></html> 
