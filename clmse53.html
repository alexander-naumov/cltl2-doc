<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Type Declaration for Forms Декларация типов для форм</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-09 00:03:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1519--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch10.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse52.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse52.html#tailclmse52.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse53.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse53.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">9.3   </span> <a 
 id="x67-1730009.3"></a>Type Declaration for Forms Декларация типов для форм</h3>
<!--l. 1521--><p class="noindent" >Frequently it is useful to declare that the value produced by the evaluation of
some form will be of a particular type. Using <a 
href="clmse51.html#x65-167003r153">declare</a> one can declare the type of
the value held by a bound variable, but there is no easy way to declare the type of
the value of an unnamed form. For this purpose the <a 
href="#x67-173002r158">the</a> special form is deﬁned;
(the <i>type</i> <i>form</i>) means that the value of <i>form</i> is declared to be of type
<i>type</i>.
<!--l. 1529--><p class="indent" >   Часто бывает полезно задекларировать, что значение, возвращаемое
некоторой формой будет принадлежать определенному типу. Использование
<a 
href="clmse51.html#x65-167003r153">declare</a> может применяться только к значениям связанным с переменной, но
не для безымянных форм. Для этих целей определена специальная форма
<a 
href="#x67-173002r158">the</a>. (the <i>type</i> <i>form</i>) означает, что значение формы <i>form</i> будет принадлежать
типу <i>type</i>.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> the </b><a 
 id="dx67-173001"></a><a 
 id="x67-173002r158"></a> value-type form
</td></tr></table>
<!--l. 1538--><p class="indent" >
</div>
<!--l. 1538--><p class="noindent" ><span class="paragraphHead"><a 
 id="x67-1740009.3"></a></span>
   The <i>form</i> is evaluated; whatever it produces is returned by the <a 
href="#x67-173002r158">the</a> form. In
addition, it is an error if what is produced by the <i>form</i> does not conform to
the data type speciﬁed by <i>value-type</i> (which is not evaluated). (A given
implementation may or may not actually check for this error. Implementations are
encouraged to make an explicit error check when running interpretively.)
In eﬀect, this declares that the user undertakes to guarantee that the
                                                                          

                                                                          
values of the form will always be of the speciﬁed type. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the string (copy-seq x))     ;The result will be a string
</td></tr></table>
<!--l. 1549--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the integer (+ x 3))         ;The result of <a 
href="clmse111.html#x136-262002r626">+</a> will be an integer</td></tr></table>
<!--l. 1550--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(+ (the integer x) 3)         ;The value of x will be an integer</td></tr></table>
<!--l. 1551--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the (complex rational) (* z 3))</td></tr></table>
<!--l. 1552--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the (unsigned-byte 8) (logand x mask))</td></tr></table>
<!--l. 1554--><p class="indent" >
</div>
</div>
<!--l. 1555--><p class="noindent" >The <a 
href="clmse44.html#x56-144002r123">values</a> type speciﬁer may be used to indicate the types of multiple values: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the (values integer integer) (ﬂoor x y))
</td></tr></table>
<!--l. 1558--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the (values string t)</td></tr></table>
<!--l. 1559--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (gethash the-key the-string-table))</td></tr></table>
<!--l. 1561--><p class="indent" >
</div>
</div>
<!--l. 1563--><p class="indent" >   Вычисляется форма <i>form</i>. То, что будет вычислено, будет возвращено из
формы <i>the</i>. Дополнительно будет осуществлена проверка на принадлежность
возвращенного значения типу <i>value-type</i> (его форма не выполняется)
и в случае несовпадения выдана ошибка. (Реализация может и не
осуществлять эту проверку. Однако поощряется такая проверка при работе в
интерпретаторе.) В целом эта форма декларирует, что пользователь
гарантирует, что значение формы всегда принадлежит заданному типу.
Например: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the string (copy-seq x))     ;Результат будет строкой
</td></tr></table>
<!--l. 1572--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the integer (+ x 3))         ;Результат <a 
href="clmse111.html#x136-262002r626">+</a> будет целым числом</td></tr></table>
<!--l. 1573--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(+ (the integer x) 3)         ;The value of x will be an integer</td></tr></table>
                                                                          

                                                                          
<!--l. 1574--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the (complex rational) (* z 3))</td></tr></table>
<!--l. 1575--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(the (unsigned-byte 8) (logand x mask))</td></tr></table>
<!--l. 1577--><p class="indent" >
</div>
</div>
<div class=newer>
<!--l. 1581--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx67-174001"></a>to clarify that <i>value-type</i> may be any valid type
speciﬁer whatsoever. The point is that a type speciﬁer need not be one suitable
for discrimination but only for declaration.
<!--l. 1586--><p class="indent" >   In the case that the <i>form</i> produces exactly one value and <i>value-type</i> is not a
<a 
href="clmse44.html#x56-144002r123">values</a> type speciﬁer, one may describe a <a 
href="#x67-173002r158">the</a> form as being entirely equivalent to <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((#1=#:temp <i>form</i>)) (declare (type <i>value-type</i> #1#)) #1#)
</td></tr></table>
<!--l. 1591--><p class="indent" >
</div>
</div>
<!--l. 1592--><p class="noindent" >A more elaborate expression could be written to describe the case where <i>value-type</i> is
a <a 
href="clmse44.html#x56-144002r123">values</a> type speciﬁer.
</div>
<div class=incompatibility>
<!--l. 1597--><p class="noindent" ><b>Compatibility note:</b> This construct is borrowed from the Interlisp DECL package;
Interlisp, however, allows an implicit <a 
href="clmse38.html#x50-102002r80">progn</a> after the type speciﬁer rather than just a
single form. The MacLisp ﬁxnum-identity and ﬂonum-identity constructs can be
expressed as (the ﬁxnum <i>x</i>) and (the single-ﬂoat <i>x</i>).
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 7--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch10.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse52.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse52.html#tailclmse52.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse53.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse53.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 7--><p class="indent" >   <a 
 id="tailclmse53.html"></a>  
</body></html> 
