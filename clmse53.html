<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Список свойств</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 00:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 533--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse54.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#tailclmch10.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse53.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#clmse53.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">10.1   </span> <a 
href="clm.html#QQ2-68-864" id="x68-85600010.1">Список
свойств</a></h3>
<!--l. 535--><p class="noindent" >Начиная с самого создания, Lisp для каждого символа ассоциирует
табличную структуру данных, называемую <i>список свойств</i> (для краткости
<i>plist</i>). Список свойств содержит ноль и более элементов. Каждый элемент
содержит ключ (называемым <i>индикатором</i>), который чаще всего является
символом, и ассоциированным с ним значением (называемым иногда
<i>свойством</i>), которое может быть любым Lisp&#x2019;овым объектом. Среди
индикаторов не может быть дубликатов. Список свойств может иметь только
одно свойство для данного имени. Таким образом, значение может получено
с помощью двух символов: исходного символа и индикатора.
<!--l. 545--><p class="indent" >   Список свойств по целевому назначению очень похож на ассоциативный
список. Различие в том, что список свойств является единственно подлинным
объектом. Операции добавления и удаления элементов деструктивны, то есть
при их использовании изменяется старый список, и нового списка свойств
не создаётся. Ассоциативные список, наоборот, обычно изменяются
недеструктивно (без побочных эффектов) с помощью добавления в начало
новых элементов (смотрите <tt><a 
href="clmse87.html#x107-1404002r498">acons</a></tt> и <tt><a 
href="clmse87.html#x107-1407002r499">pairlis</a></tt>).
<!--l. 553--><p class="indent" >   Список свойств реализуется, как ячейка памяти, содержащая список с
чётным (возможно нулевым) количеством аргументов. (Обычно эта ячейка
памяти является ячейкой списка свойств в символе, но в принципе подходит
любая ячейка памяти, к которой можно применить <tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>) Каждая пара
элементов в списке составляет строку. Первый в паре это индикатор, а
второй — значение. Так как функции для списка свойств используют
символ, а не сам список, то изменения этого списка свойств может быть
записаны сохранением обратно в ячейку списка свойств символа.
FIXME
<!--l. 562--><p class="indent" >   Когда создаётся символ, его список свойств пуст. Свойства создаются с
помощью <tt><a 
href="#x68-856002r144">get</a></tt> внутри формы <tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>.
<!--l. 565--><p class="indent" >   Common Lisp не использует список свойств символа так интенсивно, как
это делали ранние реализации Lisp&#x2019;а. В Common Lisp&#x2019;е нечасто используемые
данные, такие как отладочная информация, информация для компилятора и
документация, хранятся в списках свойств.
<div class="defun">
<!--l. 570--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx68-856001"></a><a 
 id="x68-856002r144"></a><b> get</b>  <i>symbol</i> <i>indicator</i> &#x0026;optional  <i>default</i>
</div>
                                                                          

                                                                          
<!--l. 572--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-85700010.1" id="x68-85700010.1"></a></span>
<tt>
   <a 
href="#x68-856002r144">get</a></tt> ищет в списке свойств символа <i>symbol</i> индикатор равный <tt><a 
href="clmse33.html#x44-397002r44">eq</a></tt>
индикатору <i>indicator</i>. Первый аргумент должен быть символом. Если такое
свойство найдено, возвращается её значение. Иначе возвращается значение
<i>default</i>.
<!--l. 579--><p class="indent" >   Если <i>default</i> не указано, тогда для значения по-умолчанию используется
<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>.
<!--l. 582--><p class="indent" >   Следует отметить, что способа отличить значения по-умолчанию и такое
же значение свойства нет: <div class="lisp"><div class="tabbing">
(get x y) <span class="math"> ≡</span> (getf (symbol-plist x) y)
   <br>
<!--l. 586--><p class="noindent" ></div>
<!--l. 586--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-85800010.1" id="x68-85800010.1"></a></span>
<!--l. 586--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-85900010.1" id="x68-85900010.1"></a></span>
</div>
<!--l. 587--><p class="indent" >   Допустим, что список свойств символа <tt>foo</tt> является <tt>(bar t baz 3 hunoz
&#x0022;Huh?&#x0022;)</tt>. Тогда, например: <div class="lisp"><div class="tabbing">
(get &#x2019;foo &#x2019;baz) <span class="math"> ⇒</span> 3
   <br>                                                         (get &#x2019;foo &#x2019;hunoz) <span class="math"> ⇒</span> &#x0022;Huh?&#x0022;<br>
(get &#x2019;foo &#x2019;zoo) <span class="math"> ⇒</span> <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt><br>
<!--l. 594--><p class="noindent" ></div>
<!--l. 594--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86000010.1" id="x68-86000010.1"></a></span>
                                                                          

                                                                          
<!--l. 594--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86100010.1" id="x68-86100010.1"></a></span>
</div>
<tt>
<!--l. 596--><p class="indent" >   <a 
href="clmse36.html#x48-474002r64">setf</a></tt> может использоваться вместе с <tt><a 
href="#x68-856002r144">get</a></tt> для создания новой пары
свойства, возможно замещая старую пару с тем же именем. Например:
<div class="lisp"><div class="tabbing">
(get &#x2019;clyde &#x2019;species) <span class="math"> ⇒</span> <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>
   <br>                    (setf (get &#x2019;clyde &#x2019;species) &#x2019;elephant) <span class="math"> ⇒</span> elephant<br>
и теперь (get &#x2019;clyde &#x2019;species) <span class="math"> ⇒</span> elephant<br>
<!--l. 603--><p class="noindent" ></div>
<!--l. 603--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86200010.1" id="x68-86200010.1"></a></span>
<!--l. 603--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86300010.1" id="x68-86300010.1"></a></span>
</div>
<!--l. 604--><p class="indent" >   В данном контексте может быть указан аргумент <i>default</i>. Он игнорируется в
<tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>, но может быть полезен в таких макросах, как <tt><a 
href="clmse83.html#x103-1332002r468">push</a></tt>, которые связаны с
<tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>: <div class="lisp"><div class="tabbing">
(push item (get sym &#x2019;token-stack &#x2019;(initial-item)))
   <br>
<!--l. 609--><p class="noindent" ></div>
<!--l. 609--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86400010.1" id="x68-86400010.1"></a></span>
<!--l. 609--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86500010.1" id="x68-86500010.1"></a></span>
</div>
<!--l. 610--><p class="indent" >   означает то же, что и <div class="lisp"><div class="tabbing">
                                                                          

                                                                          
(setf (get sym &#x2019;token-stack &#x2019;(initial-item))
   <br>                           (cons item (get sym &#x2019;token-stack &#x2019;(initial-item))))<br>
<!--l. 614--><p class="noindent" ></div>
<!--l. 614--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86600010.1" id="x68-86600010.1"></a></span>
<!--l. 614--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86700010.1" id="x68-86700010.1"></a></span>
</div>
<!--l. 615--><p class="indent" >   а если упростить, то <div class="lisp"><div class="tabbing">
(setf (get sym &#x2019;token-stack)
   <br>                           (cons item (get sym &#x2019;token-stack &#x2019;(initial-item))))<br>
<!--l. 619--><p class="noindent" ></div>
<!--l. 619--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86800010.1" id="x68-86800010.1"></a></span>
<!--l. 619--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-86900010.1" id="x68-86900010.1"></a></span>
</div>
</div>
<div class="defun">
<!--l. 622--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx68-869001"></a><a 
 id="x68-869002r145"></a><b> remprop</b>  <i>symbol</i> <i>indicator</i>
</div>
<!--l. 624--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87000010.1" id="x68-87000010.1"></a></span>
   Эта функция удаляет из символа <i>symbol</i> свойство с индикатором, равным
<tt><a 
href="clmse33.html#x44-397002r44">eq</a></tt> индикатору <i>indicator</i>. Индикатор свойства и соответствующее значение
удаляется из списка деструктивной склейкой списка свойств. Она возвращает
<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>, если указанного свойства не было, или не-<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>, если свойство было.
<div class="lisp"><div class="tabbing">
                                                                          

                                                                          
(remprop x y) <span class="math"> ≡</span> (remf (symbol-plist x) y)
   <br>
<!--l. 632--><p class="noindent" ></div>
<!--l. 632--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87100010.1" id="x68-87100010.1"></a></span>
<!--l. 632--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87200010.1" id="x68-87200010.1"></a></span>
</div>
<!--l. 633--><p class="indent" >   Например, если список свойств <tt>foo</tt> равен <div class="lisp"><div class="tabbing">
(color blue height 6.3 near-to bar)
   <br>
<!--l. 636--><p class="noindent" ></div>
<!--l. 636--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87300010.1" id="x68-87300010.1"></a></span>
<!--l. 636--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87400010.1" id="x68-87400010.1"></a></span>
</div>
<!--l. 637--><p class="indent" >   тогда вызов <div class="lisp"><div class="tabbing">
(remprop &#x2019;foo &#x2019;height)
   <br>
<!--l. 640--><p class="noindent" ></div>
<!--l. 640--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87500010.1" id="x68-87500010.1"></a></span>
                                                                          

                                                                          
<!--l. 640--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87600010.1" id="x68-87600010.1"></a></span>
</div>
<!--l. 641--><p class="indent" >   вернёт значение не-<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>, после изменения списка свойств символа <tt>foo</tt> на
<div class="lisp"><div class="tabbing">
(color blue near-to bar)
   <br>
<!--l. 644--><p class="noindent" ></div>
<!--l. 644--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87700010.1" id="x68-87700010.1"></a></span>
<!--l. 644--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87800010.1" id="x68-87800010.1"></a></span>
</div>
</div>
<div class="defun">
<!--l. 647--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx68-878001"></a><a 
 id="x68-878002r146"></a><b> symbol-plist</b>  <i>symbol</i>
</div>
<!--l. 649--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-87900010.1" id="x68-87900010.1"></a></span>
   Эта функция возвращает список, который содержит пары свойств для
символа <i>symbol</i>. Извлекается содержимое ячейки списка свойств и
возвращается в качестве результата.
<!--l. 654--><p class="indent" >   Следует отметить, что использование <tt><a 
href="#x68-856002r144">get</a></tt> с результатом <tt><a 
href="#x68-878002r146">symbol-plist</a></tt> <i>не</i>
будет работать. Необходимо передавать в <tt><a 
href="#x68-856002r144">get</a></tt> символ, или же использовать
<tt><a 
href="#x68-879002r147">getf</a></tt>.
<!--l. 658--><p class="indent" >   С <tt><a 
href="#x68-878002r146">symbol-plist</a></tt> может использоваться <tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt> для деструктивной замены
списка свойств символа. Это относительно опасная операция, так как может
уничтожить важную информацию, которую, возможно, хранила там
реализация. Также, позаботьтесь о том, чтобы новый список свойств
содержал чётное количество элементов.
</div>
<div class="defun">
<!--l. 665--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx68-879001"></a><a 
 id="x68-879002r147"></a><b> getf</b>  <i>place</i> <i>indicator</i> &#x0026;optional  <i>default</i>
</div>
                                                                          

                                                                          
<!--l. 667--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-88000010.1" id="x68-88000010.1"></a></span>
<tt>
   <a 
href="#x68-879002r147">getf</a></tt> ищет индикатор равный <tt><a 
href="clmse33.html#x44-397002r44">eq</a></tt> <i>indicator</i> в списке свойств, находящимся
в <i>place</i>. Если он найден, тогда возвращается соответствующее значение.
Иначе возвращается <i>default</i>. Если <i>default</i> не задан, то значение по-умолчанию
используется <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>. Следует отметить, что метода определения, вернулось
ли значение по умолчанию или это значение свойства, нет. Часто
<i>place</i> вычисляется из обобщённой переменной, принимаемой функцией
<tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>.
<tt>
<!--l. 677--><p class="indent" >   <a 
href="clmse36.html#x48-474002r64">setf</a></tt> может использоваться вместе <tt><a 
href="#x68-879002r147">getf</a></tt>, и в этом случае <i>place</i> должно
быть обобщённым, чтобы его можно было передать в <tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>. Целью является
добавление новой пары свойства, или изменению уже существующей пары, в
списке свойств, хранящимся в <i>place</i>. В данном контексте может быть
использован аргумент <i>default</i>. Он игнорируется функцией <tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>, но может
быть полезен в таких макросах, как <tt><a 
href="clmse83.html#x103-1332002r468">push</a></tt>, которые связаны с <tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>. Смотрите
описание <tt><a 
href="#x68-856002r144">get</a></tt> для примера.
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 688--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i><b> remf </b><a 
 id="dx68-880001"></a><a 
 id="x68-880002r148"></a> place indicator
   <br>
<!--l. 689--><p class="noindent" ></div>
<!--l. 689--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-88100010.1" id="x68-88100010.1"></a></span>
</div>
<!--l. 690--><p class="indent" >   Эта функция в списке свойств, хранящимся в <i>place</i>, удаляет свойства,
индикатор которого равен <tt><a 
href="clmse33.html#x44-397002r44">eq</a></tt> аргументу <i>indicator</i>. Индикатор свойства и
соответствующее значение удаляется из списка деструктивной склейкой. <tt><a 
href="#x68-880002r148">remf</a></tt>
возвращает <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>, если свойства не было в списке, и некоторое не-<tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt> значение,
если свойство было. Форма <i>place</i> может быть любой обобщённой переменной,
принимаемой <tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>. Смотрите <tt><a 
href="#x68-869002r145">remprop</a></tt>.
</div>
                                                                          

                                                                          
<div class="defun">
<!--l. 700--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx68-881001"></a><a 
 id="x68-881002r149"></a><b> get-properties</b>  <i>place</i> <i>indicator-list</i>
</div>
<!--l. 702--><p class="noindent" ><span class="paragraphHead"><a 
href="#x68-88200010.1" id="x68-88200010.1"></a></span>
<tt>
   <a 
href="#x68-881002r149">get-properties</a></tt> похожа на <tt><a 
href="#x68-879002r147">getf</a></tt> за исключением того, что второй
аргумент является списком индикаторов. <tt><a 
href="#x68-881002r149">get-properties</a></tt> ищет первый
встретившийся индикатор, который есть в списке индикаторов. Обычно <i>place</i>
вычисляется из обобщённой переменной, которая может использоваться в
<tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>.
<tt>
<!--l. 708--><p class="indent" >   <a 
href="#x68-881002r149">get-properties</a></tt> возвращает три значения. Если было найдено свойство,
то первые два значения являются индикатором и значением для первого
свойства, чей индикатор присутствовал в списке <i>indicator-list</i>, и третье
значение является остатком списка свойств, <i>car</i> элемент которого был
индикатором (и соответственно <i>cadr</i> элемент — значением). Если ни одного
свойства не было найдено, то все три значения равны <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>. Третье значение
является флагом успешности или неудачи, и позволяет продолжить поиск
свойств в оставшемся списке.
</div>
                                                                          

                                                                          
<!--l. 719--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse54.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#tailclmch10.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse53.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#clmse53.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse53.html"></a>  </div> </div> 
</body></html> 
