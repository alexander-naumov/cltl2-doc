<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Creating New Streams</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-02-26 02:27:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 179--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse114.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse112.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse112.html#tailclmse112.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse113.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse113.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">21.2   </span> <a 
 id="x139-18400021.2"></a>Creating New Streams</h3>
<!--l. 181--><p class="noindent" >Perhaps the most important constructs for creating new streams are those that
open ﬁles; see <a 
href="clmse120.html#x148-215012r769">with-open-ﬁle</a> and <a 
href="clmse120.html#x148-215002r768">open</a>. The following functions construct streams
without reference to a ﬁle system.
<div class=defun>
<!--l. 185--><p class="noindent" ><i>[Function]</i><a 
 id="dx139-184001"></a><a 
 id="x139-184002r643"></a><b> make-synonym-stream</b>  <i>symbol</i>
<!--l. 187--><p class="noindent" ><a 
href="#x139-184002r643">make-synonym-stream</a> creates and returns a synonym stream. Any operations on
the new stream will be performed on the stream that is then the value of the
dynamic variable named by the symbol. If the value of the variable should
change or be bound, then the synonym stream will operate on the new
stream.
<div class=new>
<!--l. 196--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx139-184003"></a>to specify that the result of make-synonym-stream
is always a stream of type synonym-stream. Note that the type of a synonym
stream is always synonym-stream, regardless of the type of the stream for which it
is a synonym.
</div>
</div>
<div class=defun>
<!--l. 205--><p class="noindent" ><i>[Function]</i><a 
 id="dx139-184004"></a><a 
 id="x139-184005r644"></a><b> make-broadcast-stream</b>  &#x0026;rest  <i>streams</i>
<!--l. 207--><p class="noindent" >This returns a stream that works only in the output direction. Any output sent to
this stream will be sent to all of the streams given. The set of operations that may
be performed on the new stream is the intersection of those for the given streams.
The results returned by a stream operation are the values resulting from
performing the operation on the last stream in streams; the results of performing
the operation on all preceding streams are discarded. If no streams are given as
arguments, then the result is a “bit sink”; all output to the resulting stream is
discarded.
<div class=new>
<!--l. 221--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx139-184006"></a>to specify that the result of make-broadcast-stream
is always a stream of type broadcast-stream.
                                                                          

                                                                          
</div>
</div>
<div class=defun>
<!--l. 228--><p class="noindent" ><i>[Function]</i><a 
 id="dx139-184007"></a><a 
 id="x139-184008r645"></a><b> make-concatenated-stream</b>  &#x0026;rest  <i>streams</i>
<!--l. 230--><p class="noindent" >This returns a stream that works only in the input direction. Input is taken from
the ﬁrst of the streams until it reaches end-of-ﬁle; then that stream is discarded,
and input is taken from the next of the streams, and so on. If no arguments are
given, the result is a stream with no content; any input attempt will result in
end-of-ﬁle.
<div class=new>
<!--l. 239--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx139-184009"></a>to specify that the result of make-concatenated-stream
is always a stream of type concatenated-stream.
</div>
</div>
<div class=defun>
<!--l. 246--><p class="noindent" ><i>[Function]</i><a 
 id="dx139-184010"></a><a 
 id="x139-184011r646"></a><b> make-two-way-stream</b>  <i>input-stream</i> <i>output-stream</i>
<!--l. 248--><p class="noindent" >This returns a bidirectional stream that gets its input from input-stream and
sends its output to output-stream.
<div class=new>
<!--l. 253--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx139-184012"></a>to specify that the result of make-two-way-stream is
always a stream of type two-way-stream.
</div>
</div>
<div class=defun>
<!--l. 260--><p class="noindent" ><i>[Function]</i><a 
 id="dx139-184013"></a><a 
 id="x139-184014r647"></a><b> make-echo-stream</b>  <i>input-stream</i> <i>output-stream</i>
<!--l. 262--><p class="noindent" >This returns a bidirectional stream that gets its input from input-stream and
sends its output to output-stream. In addition, all input taken from input-stream is
echoed to output-stream.
<div class=new>
<!--l. 268--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx139-184015"></a>to specify that the result of make-echo-stream is
always a stream of type echo-stream.
</div>
<div class=new>
<!--l. 275--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx139-184016"></a>to clarify the interaction of <a 
href="clmse116.html#x143-195015r701">read-char</a>,
<a 
href="clmse116.html#x143-195018r702">unread-char</a>, and <a 
href="clmse116.html#x143-195022r703">peek-char</a> with echo streams. (See the descriptions of those
functions for details.)
<!--l. 281--><p class="indent" >   X3J13 explicitly noted that the bidirectional streams that are the initial values
of *query-io*, *debug-io*, and *terminal-io*, even though they may have some
                                                                          

                                                                          
echoing behavior, conceptually are not necessarily the products of calls to
<a 
href="#x139-184014r647">make-echo-stream</a> and therefore are not subject to the new rules about
echoing on echo streams. Instead, these initial interactive streams may have
implementation-dependent echoing behavior.
</div>
</div>
<div class=defun>
<!--l. 291--><p class="noindent" ><i>[Function]</i><a 
 id="dx139-184017"></a><a 
 id="x139-184018r648"></a><b> make-string-input-stream</b>  <i>string</i> &#x0026;optional  <i>start</i> <i>end</i>
<!--l. 293--><p class="noindent" >This returns an input stream. The input stream will supply, in order, the
characters in the substring of string delimited by start and end; after the last
character has been supplied, the stream will then be at end-of-ﬁle.
<div class=new>
<!--l. 300--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx139-184019"></a>to specify that the result of make-string-input-stream
is always a stream of type string-stream.
</div>
</div>
<div class=obsolete>
<div class=defun>
<!--l. 308--><p class="noindent" ><i>[Function]</i><a 
 id="dx139-184020"></a><a 
 id="x139-184021r649"></a><b> make-string-output-stream</b>
<!--l. 310--><p class="noindent" >This returns an output stream that will accumulate all output given it for the
beneﬁt of the function <a 
href="#x139-184027r651">get-output-stream-string</a>.
</div>
</div>
<div class=newer>
<!--l. 318--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx139-184022"></a>to let <a 
href="#x139-184024r650">make-string-output-stream</a> take an
:element-type argument.
<div class=defun>
<!--l. 321--><p class="noindent" ><i>[Function]</i><a 
 id="dx139-184023"></a><a 
 id="x139-184024r650"></a><b> make-string-output-stream</b>  &#x0026;key  <i>:element-type</i>
<!--l. 323--><p class="noindent" >This returns an output stream that will accumulate all output given it for the
beneﬁt of the function <a 
href="#x139-184027r651">get-output-stream-string</a>.
<!--l. 328--><p class="indent" >   The :element-type argument speciﬁes what characters must be accepted by the
created stream. If the :element-type argument is omitted, the created stream must
accept all characters.
<!--l. 332--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx139-184025"></a>to specify that the result of make-string-output-stream
is always a stream of type string-stream.
</div>
</div>
<div class=defun>
                                                                          

                                                                          
<!--l. 340--><p class="noindent" ><i>[Function]</i><a 
 id="dx139-184026"></a><a 
 id="x139-184027r651"></a><b> get-output-stream-string</b>  <i>string-output-stream</i>
<!--l. 342--><p class="noindent" >Given a stream produced by <a 
href="#x139-184024r650">make-string-output-stream</a>, this returns a string
containing all the characters output to the stream so far. The stream is then reset;
thus each call to <a 
href="#x139-184027r651">get-output-stream-string</a> gets only the characters since the last
such call (or the creation of the stream, if no such previous call has been
made).
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i> <b> with-open-stream </b> <a 
 id="dx139-184028"></a><a 
 id="x139-184029r652"></a>  (var stream)  {declaration }*  { form }*
</td></tr></table>
<!--l. 352--><p class="indent" >
</div>
   The form stream is evaluated and must produce a stream. The variable var is
bound with the stream as its value, and then the forms of the body are executed
as an implicit <a 
href="clmse38.html#x50-82002r80">progn</a>; the results of evaluating the last form are returned as the
value of the <a 
href="#x139-184029r652">with-open-stream</a> form. The stream is automatically closed on exit
from the <a 
href="#x139-184029r652">with-open-stream</a> form, no matter whether the exit is normal or
abnormal; see <a 
href="clmse114.html#x140-185014r661">close</a>. The stream should be regarded as having dynamic
extent.
<div class=new>
   X3J13 voted in January 1989 <a 
 id="dx139-184030"></a>to specify that the stream created by
<a 
href="#x139-184029r652">with-open-stream</a> is always of type ﬁle-stream.
</div>
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i> <b> with-input-from-string </b> <a 
 id="dx139-184031"></a><a 
 id="x139-184032r653"></a>  (var string  {keyword value }* )
</td></tr></table>
<!--l. 374--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration }*  { form }* </td></tr></table>
<!--l. 375--><p class="indent" >
                                                                          

                                                                          
</div>
   The body is executed as an implicit <a 
href="clmse38.html#x50-82002r80">progn</a> with the variable var bound to a
character input stream that supplies successive characters from the value of the
form string. <a 
href="#x139-184032r653">with-input-from-string</a> returns the results from the last form of the
body.
   The input stream is automatically closed on exit from the with-input-from-string
form, no matter whether the exit is normal or abnormal. The stream should be
regarded as having dynamic extent.
<div class=new>
   X3J13 voted in January 1989 <a 
 id="dx139-184033"></a>to specify that the stream created by
<a 
href="#x139-184032r653">with-input-from-string</a> is always of type string-stream.
</div>
   The following keyword options may be used:
         <div class="quotation">
<div class=flushdesc>
      <!--l. 396--><p class="noindent" >
  <div><br /><b>
:index                                                               </b>
The form after the :index keyword should be a place acceptable to <a 
href="clmse36.html#x48-80002r66">setf</a>.
If the <a 
href="#x139-184032r653">with-input-from-string</a> form is exited normally, then the place
will have stored into it the index into the string indicating the ﬁrst
character not read (the length of the string if all characters were used).
The place is not updated as reading progresses, but only at the end of
the operation.
  <br /><b>
:start                                                               </b>
The :start keyword takes an argument indicating, in the manner usual
for sequence functions, the beginning of a substring of string to be used.
  <br /><b>
:end                                                                 </b>
The :end keyword takes an argument indicating, in the manner usual
for sequence functions, the end of a substring of string to be used.</div>
</div>
                                                                          

                                                                          
      </div>
<!--l. 417--><p class="noindent" >Here is an example of the use of <a 
href="#x139-184032r653">with-input-from-string</a>: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(with-input-from-string (s &#x0022;Animal Crackers&#x0022; :index j :start 6)
</td></tr></table>
<!--l. 419--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (read s))  ⇒ crackers</td></tr></table>
<!--l. 421--><p class="indent" >
</div>
</div>
<!--l. 422--><p class="noindent" >As a side eﬀect, the variable j is set to 15.
<!--l. 424--><p class="indent" >   The :start and :index keywords may both specify the same variable, which is a
pointer within the string to be advanced, perhaps repeatedly by some containing
loop.
<div class=new>
<!--l. 429--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx139-184034"></a>to restrict user side eﬀects; see section
<a 
href="clmse43.html#x55-920007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class=obsolete>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i> <b> with-output-to-string </b> <a 
 id="dx139-184035"></a><a 
 id="x139-184036r654"></a>  (var [string])  {declaration }*  { form }*
</td></tr></table>
<!--l. 438--><p class="indent" >
</div>
   The body is executed as an implicit <a 
href="clmse38.html#x50-82002r80">progn</a> with the variable var bound to a
character output stream. All output to that stream is saved in a string. This may
be done in one of two ways.
   If no string argument is provided, then the value of with-output-from-string is
a string containing all the collected output.
   If string is speciﬁed, it must be a string with a ﬁll pointer; the output is
incrementally appended to the string, as if using <a 
href="clmse98.html#x120-162008r590">vector-push-extend</a> if
the string is adjustable, and otherwise as if using <a 
href="clmse98.html#x120-162006r589">vector-push</a>. In this
                                                                          

                                                                          
case <a 
href="#x139-184039r655">with-output-to-string</a> returns the results from the last form of the
body.
   In either case, the output stream is automatically closed on exit from the
with-output-from-string form, no matter whether the exit is normal or abnormal.
The stream should be regarded as having dynamic extent.
</div>
</div>
<div class=newer>
<!--l. 463--><p class="indent" >   X3J13 voted in June 1989 <a 
 id="dx139-184037"></a>to let <a 
href="#x139-184039r655">with-output-to-string</a> take an :element-type
argument.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i> <b> with-output-to-string </b> <a 
 id="dx139-184038"></a><a 
 id="x139-184039r655"></a>  (var [string [:element-type type]])
</td></tr></table>
<!--l. 468--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration }*  { form }* </td></tr></table>
<!--l. 469--><p class="indent" >
</div>
   One may specify <a 
href="clmse31.html#x42-70002r19">nil</a> instead of a string as the string and use the :element-type
argument to specify what characters must be accepted by the created stream. If
no string argument is provided, or if it is <a 
href="clmse31.html#x42-70002r19">nil</a> and no :element-type is speciﬁed, the
created stream must accept all characters.
   X3J13 voted in October 1988 <a 
 id="dx139-184040"></a>to specify that if string is speciﬁed, it must be a
string with a ﬁll pointer; the output is incrementally appended to the string (as if
by use of <a 
href="clmse98.html#x120-162008r590">vector-push-extend</a>).
   In this way output cannot be accidentally lost. This change makes
with-output-to-string behave in the same way that <a 
href="clmse117.html#x144-200003r730">format</a> does when given a
string as its ﬁrst argument.
   X3J13 voted in January 1989 <a 
 id="dx139-184041"></a>to specify that the stream created by
<a 
href="#x139-184039r655">with-output-to-string</a> is always of type string-stream.
   X3J13 voted in January 1989 <a 
 id="dx139-184042"></a>to restrict user side eﬀects; see section
<a 
href="clmse43.html#x55-920007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
                                                                          

                                                                          
   <!--l. 498--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse114.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse112.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse112.html#tailclmse112.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse113.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 498--><p class="indent" >   <a 
 id="tailclmse113.html"></a>  
</body></html> 
