<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Формы циклов</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-12 16:57:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 6038--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse42.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse40.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse40.html#tailclmse40.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse41.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse41.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">7.8   </span> <a 
href="clm.html#QQ2-53-124" id="x53-1160007.8">Формы циклов</a></h3>
<a 
 id="dx53-116001"></a>
<!--l. 6041--><p class="noindent" >Common Lisp предоставляет некоторые конструкции для циклов.
Конструкция <tt><a 
href="#x53-117002r90">loop</a></tt> предоставляет простую функциональность. Она слегка
больше, чем <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>, и имеет ветку для переноса управления снизу вверх.
Конструкции <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> и <tt><a 
href="#x53-119004r92">do*</a></tt> предоставляют общую функциональность для
управления на каждом цикле изменением нескольких переменных. Для
специализированных циклов над элементами списка или <i>n</i> последовательных
чисел предоставляются формы <tt><a 
href="#x53-121002r93">dolist</a></tt> и <tt><a 
href="#x53-122002r94">dotimes</a></tt>. Конструкция <tt><a 
href="#x53-125002r101">tagbody</a></tt>
наиболее общая конструкция, которая внутри себя позволяет использование
выражений <tt><a 
href="#x53-127002r104">go</a></tt>. (Традиционная конструкция <tt><a 
href="#x53-126002r102">prog</a></tt> — это синтез <tt><a 
href="#x53-125002r101">tagbody</a></tt>,
<tt><a 
href="clmse40.html#x52-112002r87">block</a></tt> и <tt><a 
href="clmse38.html#x50-99002r74">let</a></tt>.) Большинство конструкций циклов позволяют определённые
статически нелокальные выходы (смотрите <tt><a 
href="clmse40.html#x52-113002r88">return-from</a></tt> и <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt>).
<!--l. 6054--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.1   </span> <a 
href="clmli1.html#QQ2-53-125" id="x53-1170007.8.1">Бесконечный цикл</a></h4>
<!--l. 6056--><p class="noindent" >Конструкция <tt><a 
href="#x53-117002r90">loop</a></tt> является наипростейшей функциональностью для
итераций. Она не управляет переменными, и просто циклично выполняет
своё тело.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> loop </b><a 
 id="dx53-117001"></a><a 
 id="x53-117002r90"></a> { form}*
</td></tr></table>
<!--l. 6061--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 6061--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-1180007.8.1" id="x53-1180007.8.1"></a></span>
   Каждая форма <i>form</i> выполняется последовательно слева направо. Когда
вычислена последняя форма, тогда вычисляется первая форма и так далее, в
безостановочном цикле. Конструкция <tt><a 
href="#x53-117002r90">loop</a></tt> никогда не возвращает значение.
Её выполнение может быть остановлено явно, с помощью <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt> или <tt><a 
href="clmse43.html#x55-140002r116">throw</a></tt>,
например.
<tt>
<!--l. 6068--><p class="indent" >   <a 
href="#x53-117002r90">loop</a></tt>, как и многие конструкции циклов, устанавливает неявный блок с
именем <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Таким образом, <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt> с заданным результатом может
использоваться для выхода и <tt><a 
href="#x53-117002r90">loop</a></tt>.
</div>
<!--l. 6074--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.2   </span> <a 
href="clmli1.html#QQ2-53-127" id="x53-1190007.8.2">Базовые формы циклов</a></h4>
<!--l. 6076--><p class="noindent" >В отличие от <tt><a 
href="#x53-117002r90">loop</a></tt>, <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> и <tt><a 
href="#x53-119004r92">do*</a></tt> предоставляют мощный механизм для повторных
вычислений большого количества переменных.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> do </b><a 
 id="dx53-119001"></a><a 
 id="x53-119002r91"></a> ( {var | (var [init [step]])}* )
</td></tr></table>
<!--l. 6082--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(end-test  {result}* )</td></tr></table>
<!--l. 6083--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6083--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Макрос]</i><b> do* </b><a 
 id="dx53-119003"></a><a 
 id="x53-119004r92"></a> ( {var | (var [init [step]])}* )</td></tr></table>
<!--l. 6085--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(end-test  {result}* )</td></tr></table>
<!--l. 6086--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6087--><p class="indent" >
</div>
<!--l. 6087--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-1200007.8.2" id="x53-1200007.8.2"></a></span>
   Специальная форма <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> представляет общую функциональность цикла, с
произвольным количеством «переменных-индексов». Эти переменные
связываются при входе в цикл и параллельно наращиваются, как это было
                                                                          

                                                                          
задано. Они могут быть использованы, как для генерации необходимых
последовательных чисел (как, например, последовательные целые
числа), так и для накопления результата. Когда условие окончания
цикла успешно выполнилось, тогда цикл завершается с заданным
значением.
<!--l. 6097--><p class="indent" >   В общем виде <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> выглядит так: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((<i>var1</i> <i>init1</i> <i>step1</i>)
</td></tr></table>
<!--l. 6099--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (<i>var2</i> <i>init2</i> <i>step2</i>)</td></tr></table>
<!--l. 6100--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ...</td></tr></table>
<!--l. 6101--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (<i>varn</i> <i>initn</i> <i>stepn</i>))</td></tr></table>
<!--l. 6102--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (<i>end-test</i> . <i>result</i>)</td></tr></table>
<!--l. 6103--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   {<i><i>declaration</i></i>}* </td></tr></table>
<!--l. 6104--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  . <i>tagbody</i>)</td></tr></table>
<!--l. 6106--><p class="indent" >
</div>
</div>
<!--l. 6107--><p class="noindent" >Цикл <tt><a 
href="#x53-119004r92">do*</a></tt> выглядит также, кроме изменения имени с <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> на <tt><a 
href="#x53-119004r92">do*</a></tt>.
<!--l. 6109--><p class="indent" >   Первый элемент формы является списком нуля и более спецификаторов
переменных-индексов. Каждый спецификатор является списком из имени
переменной <i>var</i>, первоначального значения <i>init</i>, и форма приращения <i>step</i>.
Если <i>init</i> опущен, используется первоначальное значение <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Если <i>step</i>
опущен, <i>var</i> не изменяется на итерациях цикла (но может изменяться в теле
цикла с помощью формы <tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt>).
<!--l. 6117--><p class="indent" >   Спецификатор переменной-индекса может также быть просто именем
переменной. В этом случае переменная будет иметь первоначальное
значение <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> и не будет изменяться при итерациях цикла. В целях стиля,
использовать просто имя переменной рекомендуется, только если
перед первым использованием для неё устанавливается значение с
помощью <tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt>. Если необходимо чтобы первоначальное значение
было <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, а не неопределённое, то лучше указывать это явно, если
нужна ложь так: <tt>(<i>varj</i> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>)</tt> или если нужен пустой список так: <tt>(<i>varj</i>
&#x2019;())</tt>.
<!--l. 6128--><p class="indent" >   Перед первой итерацией вычисляются все формы <i>init</i>, и каждая
переменная <i>var</i> связывается с соответствующим результатом вычислений
                                                                          

                                                                          
<i>init</i>. Используется именно связывание, а не присвоение. Когда цикл
завершается, старые значения этих переменных восстанавливаются. Для <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>,
<i>все</i> формы <i>init</i> вычисляется перед тем, как будут связаны переменные <i>var</i>.
Таким образом все формы могут ссылаться на старые связывания этих
переменных (то есть на значения, которые были видимы до начала
выполнения конструкции <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>). Для <tt><a 
href="#x53-119004r92">do*</a></tt> вычисляется первая форма <i>init</i>, затем
первая переменная связывается с результатом этих вычислений. Затем
вычисляется вторая форма <i>init</i> и вторая переменная <i>var</i> связывается с этим
значением, и так далее. В целом, форма <i>initj</i> может ссылаться на <i>новые</i>
связывания <i>vark</i>, если <span class="math">k &#x003C; j</span>, иначе ссылка происходит на <i>старое</i>
связывание.
<!--l. 6144--><p class="indent" >   Второй элемент конструкции цикла это список из формы предиката-выхода
<i>end-test</i> и нуля и более форм результата <i>result</i>. Этот элемент напоминает
подвыражение <tt><a 
href="clmse39.html#x51-108002r84">cond</a></tt>. В начале каждой итерации, после обработки всех
переменных, вычисляется форма <i>end-test</i>. Если результат <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, выполняется
тело формы <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> (или <tt><a 
href="#x53-119004r92">do*</a></tt>). Если результат не <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, последовательно
вычисляются формы <i>result</i>, как неявный <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>, и затем <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> возвращает
управление. <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> возвращает результаты вычисления последней формы <i>result</i>.
Если таких форм не быть, значением <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> становиться <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Следует отметить,
что аналогия с подвыражениями <tt><a 
href="clmse39.html#x51-108002r84">cond</a></tt> не полная, так как <tt><a 
href="clmse39.html#x51-108002r84">cond</a></tt> в этом случае
возвращает результат формы условия.
<!--l. 6158--><p class="indent" >   Переменные-индексы изменяются в начале каждой непервой итерации
так, как написано далее. Слева направо вычисляются все формы <i>step</i>, и
затем результаты присваиваются переменным-индексам. Если такой формы
<i>step</i> для переменной указано не было, то переменная и не изменяется. Для
<tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>, все формы <i>step</i> вычисляются перед там, как будут изменены переменные.
Присваивания переменным осуществляются параллельно, как в <tt><a 
href="clmse34.html#x46-87002r60">psetq</a></tt>. Так
как <i>все</i> формы <i>step</i> вычисляются перед тем, как будет изменена хоть одна
переменных, форма <i>step</i> при вычислении всегда ссылается на старые
значения <i>всех</i> переменных-индексов, даже если другие формы <i>step</i>
были выполнены. Для <tt><a 
href="#x53-119004r92">do*</a></tt>, вычисляется первая форма <i>step</i>, затем
полученное значение присваивается первой переменной-индексом, затем
вычисляется вторая форма <i>step</i>, и полученное значение присваивается второй
переменной, и так далее. Присваивание происходит последовательно, как в
<tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt>. И для <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>, и для <tt><a 
href="#x53-119004r92">do*</a></tt> после того как переменные были изменены,
вычисляется <i>end-test</i> так, как уже было описано выше. Затем продолжаются
итерации.
<!--l. 6178--><p class="indent" >   Если <i>end-test</i> формы <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> равен <tt><tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt></tt>, тогда предикат всегда ложен. Таким
                                                                          

                                                                          
образом получается «бесконечный цикл»: тело <i>body</i> <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> выполняется
циклично, переменные-индексы изменяются как обычно. (Конструкция <tt><a 
href="#x53-117002r90">loop</a></tt>
также является «бесконечным циклом», только без переменных-индексов.)
Бесконечный цикл может быть остановлен использованием <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt>,
<tt><a 
href="clmse40.html#x52-113002r88">return-from</a></tt>, <tt><a 
href="#x53-127002r104">go</a></tt> на более высокий уровень или <tt><a 
href="clmse43.html#x55-140002r116">throw</a></tt>. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((j 0 (+ j 1)))
</td></tr></table>
<!--l. 6188--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>)                        ;Выполнять вечно</td></tr></table>
<!--l. 6189--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format t &#x0022;~%Input ~D:&#x0022; j)</td></tr></table>
<!--l. 6190--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((item (read)))</td></tr></table>
<!--l. 6191--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (if (null item) (return)     ;Обрабатывать элементы пока не найден <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt></td></tr></table>
<!--l. 6192--><p class="indent" >               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (format t &#x0022;~&#x0026;Output ~D: ~S&#x0022; j (process item)))))</td></tr></table>
<!--l. 6194--><p class="indent" >
</div>
</div>
<!--l. 6196--><p class="indent" >   Оставшаяся часть <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> оборачивается в неявный <tt><a 
href="#x53-125002r101">tagbody</a></tt>. Теги могут
использоваться внутри тела цикла <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> для того, чтобы затем использовать
выражения <tt><a 
href="#x53-127002r104">go</a></tt>. На такие выражения <tt><a 
href="#x53-127002r104">go</a></tt> не могут использоваться в
спецификаторах переменных-индексов, в предикате <i>end-test</i> и в формах
результата <i>result</i>. Когда управление достигает конца тела цикла <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>,
наступает следующая цикл итерации (начинающийся с вычисления форм
<i>step</i>).
<!--l. 6204--><p class="indent" >   Неявный <tt><a 
href="clmse40.html#x52-112002r87">block</a></tt> с именем <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> окружает всю форму <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>. Выражение <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt>
может использоваться в любом месте для немедленного выхода из
цикла.
<!--l. 6208--><p class="indent" >   Формы <tt><a 
href="clmse47.html#x61-149003r123">declare</a></tt> могут использоваться в начала тела <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>. Они применяются
к коду внутри тела <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>, для связываний переменных-индексов, для форм
<i>init</i>, для форм <i>step</i>, для предиката <i>end-test</i> и для форм результата
<i>result</i>.
<!--l. 6213--><p class="indent" >   Вот парочка примеров использования <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((i 0 (+ i 1))     ;Sets every null element of <tt>a-vector</tt> to zero
</td></tr></table>
<!--l. 6215--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (n (length a-vector)))</td></tr></table>
                                                                          

                                                                          
<!--l. 6216--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ((= i n))</td></tr></table>
<!--l. 6217--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (when (null (aref a-vector i))</td></tr></table>
<!--l. 6218--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (setf (aref a-vector i) 0)))</td></tr></table>
<!--l. 6220--><p class="indent" >
</div>
</div>
<!--l. 6221--><p class="noindent" >Конструкция <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((x e (cdr x))
</td></tr></table>
<!--l. 6223--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (oldx x x))</td></tr></table>
<!--l. 6224--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ((null x))</td></tr></table>
<!--l. 6225--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>body</i>)</td></tr></table>
<!--l. 6227--><p class="indent" >
</div>
</div>
<!--l. 6228--><p class="noindent" >использует параллельное присваивание переменным-индексам. На первой
итерации значение <tt>oldx</tt> получает значение <tt>x</tt>, которое было до входа в цикл.
При выходе из цикла <tt>oldx</tt> будет содержать значение <tt>x</tt>, которое было на
предыдущей итерации.
<!--l. 6233--><p class="indent" >   Очень часто алгоритм цикла может быть по большей части выражен в
формах <i>step</i> и тело при этом останется пустым. Например, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(do ((x foo (cdr x))
</td></tr></table>
<!--l. 6237--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (y bar (cdr y))</td></tr></table>
<!--l. 6238--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (z &#x2019;() (cons (f (car x) (car y)) z)))</td></tr></table>
<!--l. 6239--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ((or (null x) (null y))</td></tr></table>
<!--l. 6240--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     (nreverse z)))</td></tr></table>
<!--l. 6242--><p class="indent" >
</div>
</div>
<!--l. 6243--><p class="noindent" >делает то же, что и <tt>(mapcar #&#x2019;f foo bar)</tt>. Следует отметить, что вычисление
<i>step</i> для <tt>z</tt> использует тот факт, что переменные переприсваиваются
параллельно. Тело функции пустое. Наконец, использование <tt><a 
href="clmse74.html#x93-194012r353">nreverse</a></tt> в
                                                                          

                                                                          
форме возврата результата, переставляет элементы списка для правильного
результата. Другой пример: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun list-reverse (list)
</td></tr></table>
<!--l. 6250--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (do ((x list (cdr x))</td></tr></table>
<!--l. 6251--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (y &#x2019;() (cons (car x) y)))</td></tr></table>
<!--l. 6252--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           ((endp x) y)))</td></tr></table>
<!--l. 6254--><p class="indent" >
</div>
</div>
<!--l. 6255--><p class="noindent" >Нужно заметить, что используется <tt><a 
href="clmse80.html#x100-201002r425">endp</a></tt> вместо <tt><a 
href="clmse31.html#x42-76002r22">null</a></tt> или <tt><a 
href="clmse31.html#x42-76006r24">atom</a></tt> для проверки
конца списка. Это даёт более надёжный алгоритм.
<!--l. 6258--><p class="indent" >   В качестве примера вложенных циклов, предположим что <tt>env</tt> содержит
список cons-ячеек. <i>car</i> элемента каждой cons-ячейки является списком
символов, и <i>cdr</i> каждой cons-ячейки является списком такой же длины с
соответствующими значениями. Такая структура данных похожа на
ассоциативный список, но она в отличие разделена на «кадры». Общая
структура напоминает грудную клетку. Функция поиска по такой структуре
может быть такой: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun ribcage-lookup (sym ribcage)
</td></tr></table>
<!--l. 6267--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (do ((r ribcage (cdr r)))</td></tr></table>
<!--l. 6268--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           ((null r) <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>)</td></tr></table>
<!--l. 6269--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         (do ((s (caar r) (cdr s))</td></tr></table>
<!--l. 6270--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              (v (cdar r) (cdr v)))</td></tr></table>
<!--l. 6271--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             ((null s))</td></tr></table>
<!--l. 6272--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           (when (eq (car s) sym)</td></tr></table>
<!--l. 6273--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (return-from ribcage-lookup (car v))))))</td></tr></table>
<!--l. 6275--><p class="indent" >
</div>
</div>
<!--l. 6276--><p class="noindent" >(Примечание, использование отступов в примере выше выделяет тела
вложенных циклов.)
                                                                          

                                                                          
<!--l. 6279--><p class="indent" >   Цикл <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> может быть выражен в терминах более примитивных
конструкций <tt><a 
href="clmse40.html#x52-112002r87">block</a></tt>, <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt>, <tt><a 
href="clmse38.html#x50-99002r74">let</a></tt>, <tt><a 
href="#x53-117002r90">loop</a></tt>, <tt><a 
href="#x53-125002r101">tagbody</a></tt> и <tt><a 
href="clmse34.html#x46-87002r60">psetq</a></tt>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(block nil
</td></tr></table>
<!--l. 6283--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((<i>var1</i> <i>init1</i>)</td></tr></table>
<!--l. 6284--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (<i>var2</i> <i>init2</i>)</td></tr></table>
<!--l. 6285--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        ...</td></tr></table>
<!--l. 6286--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (<i>varn</i> <i>initn</i>))</td></tr></table>
<!--l. 6287--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     {<i><i>declaration</i></i>}* </td></tr></table>
<!--l. 6288--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (loop (when <i>end-test</i> (return (progn . <i>result</i>)))</td></tr></table>
<!--l. 6289--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (tagbody . <i>tagbody</i>)</td></tr></table>
<!--l. 6290--><p class="indent" >                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (psetq <i>var1</i> <i>step1</i></td></tr></table>
<!--l. 6291--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 <i>var2</i> <i>step2</i></td></tr></table>
<!--l. 6292--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 ...</td></tr></table>
<!--l. 6293--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 <i>varn</i> <i>stepn</i>))))</td></tr></table>
<!--l. 6295--><p class="indent" >
</div>
</div>
<tt>
<!--l. 6296--><p class="noindent" ><a 
href="#x53-119004r92">do*</a></tt> почти то же, что и <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> за исключением того, что связывание и наращение
переменных происходит последовательно, а не параллельно. Таким образом,
в вышеприведённой конструкции, <tt><a 
href="clmse38.html#x50-99002r74">let</a></tt> будет заменена на <tt><a 
href="clmse38.html#x50-100002r75">let*</a></tt> и <tt><a 
href="clmse34.html#x46-87002r60">psetq</a></tt> на
<tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt>.
</div>
<!--l. 6302--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.3   </span> <a 
href="clmli1.html#QQ2-53-129" id="x53-1210007.8.3">Простые формы циклов</a></h4>
<!--l. 6304--><p class="noindent" >Конструкции <tt><a 
href="#x53-121002r93">dolist</a></tt> и <tt><a 
href="#x53-122002r94">dotimes</a></tt> для каждого значения взятого для одной
переменной выполняют тело один раз. Они хоть и выражаются в терминах
<tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>, но захватывают очень простые шаблоны использования.
<!--l. 6308--><p class="indent" >   И <tt><a 
href="#x53-121002r93">dolist</a></tt> и <tt><a 
href="#x53-122002r94">dotimes</a></tt> циклично выполняют тело. На каждой итерации
заданная переменная связывается с элементом, которая затем может
использоваться в теле. <tt><a 
href="#x53-121002r93">dolist</a></tt> использует элементы списка, и <tt><a 
href="#x53-122002r94">dotimes</a></tt>
использует целые числа от 0 по <span class="math">n− 1</span>, при некотором указанном положительном
                                                                          

                                                                          
целом <i>n</i>.
<!--l. 6313--><p class="indent" >   Результат двух этих конструкций может быть указан с помощью
необязательной формы результата. Если эта форма опущена результат равен
<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<!--l. 6316--><p class="indent" >   Выражение <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt> может быть использовано для немедленного возврата
из форм <tt><a 
href="#x53-121002r93">dolist</a></tt> или <tt><a 
href="#x53-122002r94">dotimes</a></tt>, игнорируя все оставшиеся итерации, которые
должны были быть выполнены. <tt><a 
href="clmse40.html#x52-112002r87">block</a></tt> с именем <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> окружает конструкцию.
Тело цикла неявно обернуто конструкцией <tt><a 
href="#x53-125002r101">tagbody</a></tt>. Таким образом тело
может содержать теги и <tt><a 
href="#x53-127002r104">go</a></tt> выражения. Декларации могут быть указаны
перед телом цикла.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> dolist </b><a 
 id="dx53-121001"></a><a 
 id="x53-121002r93"></a> (var listform [resultform])
</td></tr></table>
<!--l. 6325--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6326--><p class="indent" >
</div>
<!--l. 6326--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-1220007.8.3" id="x53-1220007.8.3"></a></span>
   <tt><a 
href="#x53-121002r93">dolist</a></tt> предоставляет прямой цикл по списку элементов. Сначала <tt><a 
href="#x53-121002r93">dolist</a></tt>
вычисляет форму <i>listform</i>, которая должна вернуть список. Затем для
каждого элемента вычисляется тело цикла. Данный элемент на каждой
итерации связывается с переменной <i>var</i>. Затем вычисляется <i>resultform</i> (одна
форма, <i>не</i> неявный <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>). (Когда вычисляется <i>resultform</i>, переменная <i>var</i>
все ещё связана, и имеет значение <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.) Если <i>resultform</i> опущена, то
результат равен <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(dolist (x &#x2019;(a b c d)) (prin1 x) (princ &#x0022; &#x0022;)) <span class="math"> ⇒</span> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>
</td></tr></table>
<!--l. 6337--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   вывод «<tt>a b c d </tt>» (в том числе пробел в конце)</td></tr></table>
<!--l. 6339--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 6340--><p class="noindent" >Для завершения цикла и возврата заданного значения может использоваться
явное выражение <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt>.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> dotimes </b><a 
 id="dx53-122001"></a><a 
 id="x53-122002r94"></a> (var countform [resultform])
</td></tr></table>
<!--l. 6346--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6347--><p class="indent" >
</div>
<!--l. 6347--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-1230007.8.3" id="x53-1230007.8.3"></a></span>
   <tt><a 
href="#x53-122002r94">dotimes</a></tt> предоставляет цикл над последовательностью целых чисел.
Выражение <tt>(dotimes (<i>var</i> <i>countform</i> <i>resultform</i>) . <i>progbody</i>)</tt>
вычисляет форму <i>countform</i>, которая должна вернуть целое число. Затем
тело цикла выполняется по порядку один раз для каждого число
от нуля (включительно) до <i>count</i> (исключая). При этом переменная
<i>var</i> связывается с текущим целым числом. Если значение <i>countform</i>
отрицательно или равно нулю, тогда <i>progbody</i> не выполняется ни разу.
Наконец выполняется <i>resultform</i> (одна форма, <i>не</i> неявный <tt><a 
href="clmse37.html#x49-95002r71">progn</a></tt>), и
полученный результат возвращается из формы цикла. (Когда <i>result</i>
вычисляется, переменная-индекс <i>var</i> все ещё связана и содержит количество
выполненных итераций.) Если <i>resultform</i> опущена, то результат равен
<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<!--l. 6362--><p class="indent" >   Для завершения цикла и возврата заданного значения может использоваться
выражение <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt>.
<!--l. 6365--><p class="indent" >   Пример использования <tt><a 
href="#x53-122002r94">dotimes</a></tt> для обработки строк: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; True if the speciﬁed subsequence of the string is a
</td></tr></table>
<!--l. 6367--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">;;; palindrome (reads the same forwards and backwards).</td></tr></table>
                                                                          

                                                                          
<!--l. 6368--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6369--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun palindromep (string <tt>&#x0026;optional</tt></td></tr></table>
<!--l. 6370--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                           (start 0)</td></tr></table>
<!--l. 6371--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                           (end (length string)))</td></tr></table>
<!--l. 6372--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (dotimes (k (ﬂoor (- end start) 2) <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>)</td></tr></table>
<!--l. 6373--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (unless (char-equal (char string (+ start k))</td></tr></table>
<!--l. 6374--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                        (char string (- end k 1)))</td></tr></table>
<!--l. 6375--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (return <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>))))</td></tr></table>
<!--l. 6376--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6377--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep &#x0022;Able was I ere I saw Elba&#x0022;) <span class="math"> ⇒</span> <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt></td></tr></table>
<!--l. 6378--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6379--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep &#x0022;A man, a plan, a canal–Panama!&#x0022;) <span class="math"> ⇒</span> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt></td></tr></table>
<!--l. 6380--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6381--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(remove-if-not #&#x2019;alpha-char-p     ;Удалить знаки препинания</td></tr></table>
<!--l. 6382--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">               &#x0022;A man, a plan, a canal–Panama!&#x0022;)</td></tr></table>
<!--l. 6383--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> &#x0022;AmanaplanacanalPanama&#x0022;</td></tr></table>
<!--l. 6384--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6385--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep</td></tr></table>
<!--l. 6386--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> (remove-if-not #&#x2019;alpha-char-p</td></tr></table>
<!--l. 6387--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                &#x0022;A man, a plan, a canal–Panama!&#x0022;)) <span class="math"> ⇒</span> <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt></td></tr></table>
<!--l. 6388--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6389--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep</td></tr></table>
<!--l. 6390--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> (remove-if-not</td></tr></table>
<!--l. 6391--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   #&#x2019;alpha-char-p</td></tr></table>
<!--l. 6392--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   &#x0022;Unremarkable was I ere I saw Elba Kramer, nu?&#x0022;)) <span class="math"> ⇒</span> <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt></td></tr></table>
<!--l. 6393--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 6394--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep</td></tr></table>
<!--l. 6395--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> (remove-if-not</td></tr></table>
<!--l. 6396--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   #&#x2019;alpha-char-p</td></tr></table>
<!--l. 6397--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   &#x0022;A man, a plan, a cat, a ham, a yak,</td></tr></table>
<!--l. 6398--><p class="indent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                   a yam, a hat, a canal–Panama!&#x0022;)) <span class="math"> ⇒</span> <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt></td></tr></table>
<!--l. 6400--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(palindromep</td></tr></table>
<!--l. 6401--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> (remove-if-not</td></tr></table>
<!--l. 6402--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   #&#x2019;alpha-char-p</td></tr></table>
<!--l. 6403--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   &#x0022;Ja-da, ja-da, ja-da ja-da jing jing jing&#x0022;)) <span class="math"> ⇒</span> <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt></td></tr></table>
<!--l. 6405--><p class="indent" >
</div>
                                                                          

                                                                          
</div>
<!--l. 6407--><p class="indent" >   Изменение значения переменной <i>var</i> в теле цикла (с помощью <tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt>
например) будет иметь непредсказуемые последствия, возможно зависящие
от реализации. Компилятор Common Lisp&#x2019;а может вывести предупреждение о
том, что переменная-индекс используется в <tt><a 
href="clmse34.html#x46-86002r59">setq</a></tt>.
</div>
<!--l. 6413--><p class="indent" >   Смотрите также <tt><a 
href="clmse59.html#x75-169004r165">do-symbols</a></tt>, <tt><a 
href="clmse59.html#x75-170002r166">do-external-symbols</a></tt> и <tt><a 
href="clmse59.html#x75-171002r167">do-all-symbols</a></tt>.
<!--l. 6416--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.4   </span> <a 
href="clmli1.html#QQ2-53-132" id="x53-1240007.8.4">Отображение</a></h4>
<a 
 id="dx53-124001"></a>
<!--l. 6419--><p class="noindent" >Отображение — это тип цикла, в котором заданная функция применяется к
частям одной или более последовательностей. Результатом цикла является
последовательность, полученная из результатов выполнения это функции.
Существует несколько опции для указания того, какие части списка будут
использоваться в цикле, и что будет происходить с результатом применения
функции.
<!--l. 6426--><p class="indent" >   Функция <tt><a 
href="clmse75.html#x94-195004r356">map</a></tt> может быть использована для отображения любого
типа последовательности. Следующие же функции оперируют только
списками.
<div class=defun>
<!--l. 6430--><p class="noindent" ><i>[Функция]</i><a 
 id="dx53-124002"></a><a 
 id="x53-124003r95"></a><b> mapcar</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx53-124004"></a><a 
 id="x53-124005r96"></a><b> maplist</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx53-124006"></a><a 
 id="x53-124007r97"></a><b> mapc</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx53-124008"></a><a 
 id="x53-124009r98"></a><b> mapl</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx53-124010"></a><a 
 id="x53-124011r99"></a><b> mapcan</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx53-124012"></a><a 
 id="x53-124013r100"></a><b> mapcon</b>  <i>function</i> <i>list</i> &#x0026;rest  <i>more-lists</i>
<!--l. 6437--><p class="noindent" >Для каждой из этих функций отображения, первый аргумент является
функцией и оставшиеся аргументы должны быть списками. Функция в
первом аргументе должно принимать столько аргументов, сколько было
передано списков в функцию отображения.
<tt>
<!--l. 6443--><p class="indent" >   <a 
href="#x53-124003r95">mapcar</a></tt> последовательно обрабатывает элементы списков. Сначала
функция применяется к <i>car</i> элементу каждого списка, затем к <i>cadr</i> элементу,
и так далее. (Лучше всего, чтобы все переданные списки имели одинаковую
длину. Если это не так, то цикл завершиться, как только закончится самый
                                                                          

                                                                          
короткий список, и все оставшиеся элементы в других списках будут
проигнорированы.) Значение, возвращаемое <tt><a 
href="#x53-124003r95">mapcar</a></tt>, является списком
результатов последовательных вызовов функции из первого параметра.
Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mapcar #&#x2019;abs &#x2019;(3 -4 2 -5 -6)) <span class="math"> ⇒</span> (3 4 2 5 6)
</td></tr></table>
<!--l. 6453--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mapcar #&#x2019;cons &#x2019;(a b c) &#x2019;(1 2 3)) <span class="math"> ⇒</span> ((a . 1) (b . 2) (c . 3))</td></tr></table>
<!--l. 6455--><p class="indent" >
</div>
</div>
<tt>
<!--l. 6457--><p class="indent" >   <a 
href="#x53-124005r96">maplist</a></tt> похожа на <tt><a 
href="#x53-124003r95">mapcar</a></tt> за исключением того, что функция
применяется к спискам и последующим <i>cdr</i> элементам этих списков, а не
последовательно к элементам спискам. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(maplist #&#x2019;(lambda (x) (cons &#x2019;foo x))
</td></tr></table>
<!--l. 6462--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         &#x2019;(a b c d))</td></tr></table>
<!--l. 6463--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> ((foo a b c d) (foo b c d) (foo c d) (foo d))</td></tr></table>
<!--l. 6465--><p class="indent" >
</div>
</div>
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(maplist #&#x2019;(lambda (x) (if (member (car x) (cdr x)) 0 1)))
</td></tr></table>
<!--l. 6468--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         &#x2019;(a b a c d b c))</td></tr></table>
<!--l. 6469--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> (0 0 1 0 1 1 1)</td></tr></table>
<!--l. 6470--><p class="indent" >
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   ;Возвращается <tt>1</tt>, если соответствующий элемент входящего списка</td></tr></table>
<!--l. 6471--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   ;  появлялся последний раз в данном списке.</td></tr></table>
<!--l. 6473--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<tt>
<!--l. 6475--><p class="indent" >   <a 
href="#x53-124009r98">mapl</a></tt> и <tt><a 
href="#x53-124007r97">mapc</a></tt> похожи на <tt><a 
href="#x53-124005r96">maplist</a></tt> и <tt><a 
href="#x53-124003r95">mapcar</a></tt>, соответственно, за исключением
того, что они не накапливают результаты вызова функций.
<!--l. 6478--><p class="indent" >   Эти функции используются, когда функция в первом параметре
предназначена для побочных эффектов, а не для возвращаемого значения.
Значение возвращаемое <tt><a 
href="#x53-124009r98">mapl</a></tt> или <tt><a 
href="#x53-124007r97">mapc</a></tt> является вторым аргументом, то есть
первой последовательностью для отображения.
<tt>
<!--l. 6483--><p class="indent" >   <a 
href="#x53-124011r99">mapcan</a></tt> и <tt><a 
href="#x53-124013r100">mapcon</a></tt> похожи на <tt><a 
href="#x53-124003r95">mapcar</a></tt> и <tt><a 
href="#x53-124005r96">maplist</a></tt> соответственно, за
исключением того, что результат создаётся с помощью функции <tt><a 
href="clmse128.html#x158-320006r783">nconc</a></tt>, а не
<tt><a 
href="clmse80.html#x100-201034r441">list</a></tt>. То есть, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mapcon <i>f </i> <i>x1</i> ... <i>xn</i>)
</td></tr></table>
<!--l. 6487--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (apply #&#x2019;nconc (maplist <i>f </i> <i>x1</i> ... <i>xn</i>))</td></tr></table>
<!--l. 6489--><p class="indent" >
</div>
</div>
<!--l. 6490--><p class="noindent" >Такое же различие между <tt><a 
href="#x53-124011r99">mapcan</a></tt> и <tt><a 
href="#x53-124003r95">mapcar</a></tt>. Концептуально, эти функции
позволяют функции отображения возвращать переменное количество
элементов. Таким образом длина результата может быть не равна длине
входного списка. Это, в частности, полезно для возврата нуля или одного
элемента: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(mapcan #&#x2019;(lambda (x) (and (numberp x) (list x)))
</td></tr></table>
<!--l. 6496--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x2019;(a 1 b c 3 4 d 5))</td></tr></table>
<!--l. 6497--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> (1 3 4 5)</td></tr></table>
<!--l. 6499--><p class="indent" >
</div>
</div>
<!--l. 6500--><p class="noindent" >В этом случае функция действует, как фильтр. Это стандартная Lisp&#x2019;овая
идиома использования <tt><a 
href="#x53-124011r99">mapcan</a></tt>. (Однако, в этом контексте функция
                                                                          

                                                                          
<tt><a 
href="clmse76.html#x95-196010r367">remove-if-not</a></tt> также может быть полезна.) Помните, что <tt><a 
href="clmse128.html#x158-320006r783">nconc</a></tt> деструктивная
операция, следовательно и <tt><a 
href="#x53-124011r99">mapcan</a></tt> и <tt><a 
href="#x53-124013r100">mapcon</a></tt> также деструктивны. Список
возвращаемый функцией <i>function</i> изменяется для соединения и возврата
результата.
<!--l. 6507--><p class="indent" >   Иногда <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt> или прямая последовательная рекурсия удобнее, чем функции
отображения. Однако, функции отображения должны быть использованы
везде, где они действительно необходимы, так как они увеличивают ясность
кода.
<!--l. 6511--><p class="indent" >   Функциональный аргумент функции отображения должен быть
подходящим для функции <tt><a 
href="clmse36.html#x48-94002r68">apply</a></tt>. Он не может быть макросов или
именем специальной формы. Кроме того, в качестве функционального
аргумента можно использовать функцию, имеющую <tt>&#x0026;optional</tt> и <tt>&#x0026;rest</tt>
параметры.
</div>
<!--l. 6517--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.8.5   </span> <a 
href="clmli1.html#QQ2-53-133" id="x53-1250007.8.5">Использование «GOTO»</a></h4>
<!--l. 6519--><p class="noindent" >Реализации Lisp&#x2019;а начиная с Lisp&#x2019;а 1.5 содержат то, что изначально
называлось «the program feature», как будто без этого невозможно писать
программы! Конструкция <tt><a 
href="#x53-126002r102">prog</a></tt> позволяет писать в Algol- или Fortran-
императивном стиле, используя выражения <tt><a 
href="#x53-127002r104">go</a></tt>, которые могут ссылаться на
теги в теле <tt><a 
href="#x53-126002r102">prog</a></tt>. Современный стиль программирования на Lisp&#x2019;е стремится
снизить использование <tt><a 
href="#x53-126002r102">prog</a></tt>. Различные конструкции циклов, как <tt><a 
href="clmse131.html#x161-329002r797">do</a></tt>, имеют
тела с характеристиками <tt><a 
href="#x53-126002r102">prog</a></tt>. (Тем не менее, возможность использовать
выражения <tt><a 
href="#x53-127002r104">go</a></tt> внутри конструкции цикла очень редко используется на
практике.)
<tt>
<!--l. 6529--><p class="indent" >   <a 
href="#x53-126002r102">prog</a></tt> предоставляет три различные операции: связывание локальный
переменных, использование выражения <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt> и использование выражения
<tt><a 
href="#x53-127002r104">go</a></tt>. В Common Lisp&#x2019;е эти три операции были разделены на три конструкции:
<tt><a 
href="clmse38.html#x50-99002r74">let</a></tt>, <tt><a 
href="clmse40.html#x52-112002r87">block</a></tt> и <tt><a 
href="#x53-125002r101">tagbody</a></tt>. Эти три конструкции могут использоваться
независимо, как строительные кирпичики для других типов конструкций.
<div class=defspec>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> tagbody </b><a 
 id="dx53-125001"></a><a 
 id="x53-125002r101"></a> {tag | statement}*
</td></tr></table>
<!--l. 6540--><p class="indent" >
</div>
<!--l. 6540--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-1260007.8.5" id="x53-1260007.8.5"></a></span>
   Часть <tt><a 
href="#x53-125002r101">tagbody</a></tt> после списка переменные называется <i>телом</i>. Элемент тела
может быть символов или целым числом, и называться в этом случае <i>тег</i>.
Также элемент тела может быть списком, и называться в этом случае
<i>выражением</i>.
<!--l. 6546--><p class="indent" >   Каждый элемент тела обрабатывается слева направо. <i>Теги</i> игнорируются.
<i>Выражения</i> вычисляются и их результаты игнорируются. Если управление
достигает конца тела, <tt><a 
href="#x53-125002r101">tagbody</a></tt> возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<!--l. 6551--><p class="indent" >   Если вычисляется форма <tt>(go <i>tag</i>)</tt>, управление перемещается на часть
тела, обозначенную <i>тегом</i>.
<!--l. 6554--><p class="indent" >   Область видимости тегов, устанавливаемых в <tt><a 
href="#x53-125002r101">tagbody</a></tt>, является
лексической. Продолжительность видимости тегов динамическая. Когда
управление вышло из конструкции <tt><a 
href="#x53-125002r101">tagbody</a></tt>, ссылка <tt><a 
href="#x53-127002r104">go</a></tt> на теги в её теле
невозможны. Существует возможность для <tt><a 
href="#x53-127002r104">go</a></tt> прыжка в <tt><a 
href="#x53-125002r101">tagbody</a></tt>,
которая не находится внутри конструкции <tt><a 
href="#x53-125002r101">tagbody</a></tt>, которая и содержала
этот <tt><a 
href="#x53-127002r104">go</a></tt>. То есть возможны прыжки в родительский <tt><a 
href="#x53-125002r101">tagbody</a></tt>. Теги
устанавливаемые <tt><a 
href="#x53-125002r101">tagbody</a></tt> будут только скрывать другие одноимённые
теги.
<!--l. 6563--><p class="indent" >   Лексическая область видимости для тегов (целей <tt><a 
href="#x53-127002r104">go</a></tt>) полностью
полноправно и последствия могут быть сюрпризом для пользователей и
разработчиков других Lisp систем. Например, <tt><a 
href="#x53-127002r104">go</a></tt> в следующем примере,
работает в Common Lisp так, как это и ожидается: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(tagbody
</td></tr></table>
<!--l. 6569--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (catch &#x2019;stuﬀ</td></tr></table>
<!--l. 6570--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (mapcar #&#x2019;(lambda (x) (if (numberp x)</td></tr></table>
<!--l. 6571--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                (hairyfun x)</td></tr></table>
<!--l. 6572--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                (go lose)))</td></tr></table>
<!--l. 6573--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              items))</td></tr></table>
                                                                          

                                                                          
<!--l. 6574--><p class="indent" >                                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (return)</td></tr></table>
<!--l. 6575--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> lose</td></tr></table>
<!--l. 6576--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   (error &#x0022;I lost big!&#x0022;))</td></tr></table>
<!--l. 6578--><p class="indent" >
</div>
</div>
<!--l. 6579--><p class="noindent" >В зависимости от ситуации, <tt><a 
href="#x53-127002r104">go</a></tt> в Common Lisp&#x2019;е не обязательно похож на
простую машинную инструкцию «jump». Если необходимо, <tt><a 
href="#x53-127002r104">go</a></tt> может
перепрыгивать ловушки исключений. Возможно так, что «замыкание»,
созданное с помощью <tt><a 
href="clmse34.html#x46-84002r52">function</a></tt>, для лямбда-выражения ссылается на тег
(цель <tt><a 
href="#x53-127002r104">go</a></tt>) так долго, сколько лексически доступен данный тег. Смотрите <a 
href="clmch3.html#x24-420003">3<!--tex4ht:ref: SCOPE --></a>
для понимания этого примера.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> prog </b><a 
 id="dx53-126001"></a><a 
 id="x53-126002r102"></a> ( {var | (var [init])}* )  {declaration}*  {tag | statement}*
</td></tr></table>
<!--l. 6588--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Макрос]</i><b> prog* </b><a 
 id="dx53-126003"></a><a 
 id="x53-126004r103"></a> ( {var | (var [init])}* )  {declaration}*  {tag | statement}* </td></tr></table>
<!--l. 6590--><p class="indent" >
</div>
<!--l. 6590--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-1270007.8.5" id="x53-1270007.8.5"></a></span>
   Конструкция <tt><a 
href="#x53-126002r102">prog</a></tt> является синтезом <tt><a 
href="clmse38.html#x50-99002r74">let</a></tt>, <tt><a 
href="clmse40.html#x52-112002r87">block</a></tt> и <tt><a 
href="#x53-125002r101">tagbody</a></tt>, позволяющая
связывать переменные, использовать <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt> и <tt><a 
href="#x53-127002r104">go</a></tt> в одной конструкции.
Обычно конструкция <tt><a 
href="#x53-126002r102">prog</a></tt> выглядит так: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(prog (<i>var1</i> <i>var2</i> (<i>var3</i> <i>init3</i>) <i>var4</i> (<i>var5</i> <i>init5</i>))
</td></tr></table>
<!--l. 6595--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       {<i><i>declaration</i></i>}* </td></tr></table>
<!--l. 6596--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement1</i></td></tr></table>
<!--l. 6597--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>tag1</i></td></tr></table>
<!--l. 6598--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement2</i></td></tr></table>
                                                                          

                                                                          
<!--l. 6599--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement3</i></td></tr></table>
<!--l. 6600--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement4</i></td></tr></table>
<!--l. 6601--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>tag2</i></td></tr></table>
<!--l. 6602--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      <i>statement5</i></td></tr></table>
<!--l. 6603--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ...</td></tr></table>
<!--l. 6604--><p class="indent" >                                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      )</td></tr></table>
<!--l. 6606--><p class="indent" >
</div>
</div>
<!--l. 6607--><p class="noindent" >Список после ключевого символа <tt><a 
href="#x53-126002r102">prog</a></tt> является множеством спецификаторов
для связывания переменных <i>var1</i>, <i>var2</i>. Этот список обрабатывается так же,
как и в выражении <tt><a 
href="clmse38.html#x50-99002r74">let</a></tt>: сначала слева направо выполняются все формы <i>init</i>
(если формы нет, берётся значение <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>), и затем переменные параллельно
связываются с полученными ранее значениями. Возможно использовать
<i>декларации</i> в начале дела <tt><a 
href="#x53-126002r102">prog</a></tt> так же, как и в <tt><a 
href="clmse38.html#x50-99002r74">let</a></tt>.
<!--l. 6616--><p class="indent" >   Тело <tt><a 
href="#x53-126002r102">prog</a></tt> выполняется, как обернутое в <tt><a 
href="#x53-125002r101">tagbody</a></tt>. Таким образом, для
перемещения управления к <i>тегу</i> могут использоваться выражения
<tt><a 
href="#x53-127002r104">go</a></tt>.
<tt>
<!--l. 6619--><p class="indent" >   <a 
href="#x53-126002r102">prog</a></tt> неявно устанавливает вокруг тела <tt><a 
href="clmse40.html#x52-112002r87">block</a></tt> с именем <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Это значит,
можно в любое время использовать <tt><a 
href="clmse131.html#x161-330002r799">return</a></tt> для выхода из конструкции
<tt><a 
href="#x53-126002r102">prog</a></tt>.
<!--l. 6622--><p class="indent" >   Вот небольшой пример того, что можно сделать с помощью <tt><a 
href="#x53-126002r102">prog</a></tt>:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun king-of-confusion (w)
</td></tr></table>
<!--l. 6624--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  &#x0022;Take a cons of two lists and make a list of conses.</td></tr></table>
<!--l. 6625--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   Think of this function as being like a zipper.&#x0022;</td></tr></table>
<!--l. 6626--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (prog (x y z)     ;Инициализировать <tt>x</tt>, <tt>y</tt>, <tt>z</tt> в <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt></td></tr></table>
<!--l. 6627--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq y (car w) z (cdr w))</td></tr></table>
<!--l. 6628--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   loop</td></tr></table>
<!--l. 6629--><p class="indent" >                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (cond ((null y) (return x))</td></tr></table>
<!--l. 6630--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              ((null z) (go err)))</td></tr></table>
<!--l. 6631--><p class="indent" >                                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   rejoin</td></tr></table>
<!--l. 6632--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq x (cons (cons (car y) (car z)) x))</td></tr></table>
                                                                          

                                                                          
<!--l. 6633--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq y (cdr y) z (cdr z))</td></tr></table>
<!--l. 6634--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (go loop)</td></tr></table>
<!--l. 6635--><p class="indent" >                                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   err</td></tr></table>
<!--l. 6636--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (cerror &#x0022;Will self-pair extraneous items&#x0022;</td></tr></table>
<!--l. 6637--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                &#x0022;Mismatch - gleep!  S&#x0022; y)</td></tr></table>
<!--l. 6638--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (setq z y)</td></tr></table>
<!--l. 6639--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (go rejoin)))</td></tr></table>
<!--l. 6641--><p class="indent" >
</div>
</div>
<!--l. 6642--><p class="noindent" >которые делает то же, что и: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun prince-of-clarity (w)
</td></tr></table>
<!--l. 6644--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  &#x0022;Take a cons of two lists and make a list of conses.</td></tr></table>
<!--l. 6645--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   Think of this function as being like a zipper.&#x0022;</td></tr></table>
<!--l. 6646--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (do ((y (car w) (cdr y))</td></tr></table>
<!--l. 6647--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (z (cdr w) (cdr z))</td></tr></table>
<!--l. 6648--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (x &#x2019;() (cons (cons (car y) (car z)) x)))</td></tr></table>
<!--l. 6649--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      ((null y) x)</td></tr></table>
<!--l. 6650--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (when (null z)</td></tr></table>
<!--l. 6651--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (cerror &#x0022;Will self-pair extraneous items&#x0022;</td></tr></table>
<!--l. 6652--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">              &#x0022;Mismatch - gleep!  S&#x0022; y)</td></tr></table>
<!--l. 6653--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (setq z y))))</td></tr></table>
<!--l. 6655--><p class="indent" >
</div>
</div>
<!--l. 6657--><p class="indent" >   Конструкция <tt><a 
href="#x53-126002r102">prog</a></tt> может быть выражена в терминах более простых
конструкций <tt><a 
href="clmse40.html#x52-112002r87">block</a></tt>, <tt><a 
href="clmse38.html#x50-99002r74">let</a></tt> и <tt><a 
href="#x53-125002r101">tagbody</a></tt>: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(prog <i>variable-list</i> {<i><i>declaration</i></i>}*  . <i>body</i>)
</td></tr></table>
<!--l. 6660--><p class="indent" >       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (block nil (let <i>variable-list</i> {<i><i>declaration</i></i>}*  (tagbody . <i>body</i>)))</td></tr></table>
<!--l. 6662--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 6664--><p class="indent" >   Специальная форма <tt><a 
href="#x53-126004r103">prog*</a></tt> очень похожа на <tt><a 
href="#x53-126002r102">prog</a></tt>. Одно отличие в том, что
связывание и инициализация переменных осуществляется <i>последовательно</i>,
тем самым форма <i>init</i> использовать значения ранее связанных переменных.
Таким образом <tt><a 
href="#x53-126004r103">prog*</a></tt> относится к <tt><a 
href="#x53-126002r102">prog</a></tt>, как <tt><a 
href="clmse38.html#x50-100002r75">let*</a></tt> к <tt><a 
href="clmse38.html#x50-99002r74">let</a></tt>. Например,
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(prog* ((y z) (x (car y)))
</td></tr></table>
<!--l. 6670--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       (return x))</td></tr></table>
<!--l. 6672--><p class="indent" >
</div>
</div>
<!--l. 6673--><p class="noindent" >возвращает <i>car</i> элемент значения <tt>z</tt>.
</div>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> go </b><a 
 id="dx53-127001"></a><a 
 id="x53-127002r104"></a> tag
</td></tr></table>
<!--l. 6678--><p class="indent" >
</div>
<!--l. 6678--><p class="noindent" ><span class="paragraphHead"><a 
href="#x53-1280007.8.5" id="x53-1280007.8.5"></a></span>
   Специальная форма <tt>(go <i>tag</i>)</tt> используется для применения «goto»
внутри конструкции <tt><a 
href="#x53-125002r101">tagbody</a></tt>. <i>tag</i> должен быть символов или целым
числом. <i>tag</i> не вычисляется. <tt><a 
href="#x53-127002r104">go</a></tt> переносит управление на точку тела,
которая была помечена тегом равным <tt><a 
href="clmse32.html#x43-77004r45">eql</a></tt> заданному. Если такого тега в
теле нет, поиск осуществляется в лексически доступном теле другой
конструкции <tt><a 
href="#x53-125002r101">tagbody</a></tt>. Использоваться <tt><a 
href="#x53-127002r104">go</a></tt> с тегом, которого нет, является
ошибкой.
<!--l. 6687--><p class="indent" >   Форма <tt><a 
href="#x53-127002r104">go</a></tt> никогда не возвращает значение.
                                                                          

                                                                          
<!--l. 6689--><p class="indent" >   В целях стиля, рекомендуется дважды подумать, прежде чем использовать
<tt><a 
href="#x53-127002r104">go</a></tt>. Большинство функций <tt><a 
href="#x53-127002r104">go</a></tt> могут быть заменены циклами, вложенными
условными формами или <tt><a 
href="clmse40.html#x52-113002r88">return-from</a></tt>. Если использование <tt><a 
href="#x53-127002r104">go</a></tt> неизбежно,
рекомендуется управляющую структуру реализованную с помощью <tt><a 
href="#x53-127002r104">go</a></tt>
«упаковать» в определении макроса.
</div>
                                                                          

                                                                          
<!--l. 6696--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse42.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse40.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse40.html#tailclmse40.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse41.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse41.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse41.html"></a>   </div> </div> 
</body></html> 
