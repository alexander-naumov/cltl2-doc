<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>How to Use Defstruct</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-02-20 00:42:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 148--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse105.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse103.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse103.html#tailclmse103.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse104.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse104.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">19.2   </span> <a 
 id="x128-17000019.2"></a>How to Use Defstruct</h3>
<!--l. 150--><p class="noindent" >All structures are deﬁned through the <i>defstruct</i> construct. A call to <i>defstruct</i>
deﬁnes a new data type whose instances have named slots.
<div class=defmac>
<!--l. 155--><p class="noindent" ><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> defstruct </b> <a 
 id="dx128-170001"></a><a 
 id="x128-170002r618"></a>   name-and-options  [ <i>doc-string</i>]   {<i>slot − description</i>}+
</td></tr></table>
<!--l. 156--><p class="indent" >
</div>
   <div class=new>X3J13 voted in June 1988 ⟨<b>?</b>⟩ to allow a <i>defstruct</i> deﬁnition to have no
slot-description at all; in other words, the occurrence of  {<i>slot-description</i>}+  in the
preceding header line would be replaced by  {<i>slot-description</i>}∗ .
   Such structure deﬁnitions are particularly useful if the <i>:include</i> option is used,
perhaps with other options; for example, one can have two structures that are
exactly alike except that they print diﬀerently (having diﬀerent <i>:print-function</i>
options).
   Implementors are encouraged to permit this simple extension as soon as
convenient. Users, however, may wish to maximize portability of their code by
avoiding the use of this extension unless and until it is adopted as part of the
ANSI standard.
</div>
   This deﬁnes a record-structure data type. A general call to <i>defstruct</i> looks like
the following example. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defstruct (name option-1 option-2 ... option-m)
</td></tr></table>
<!--l. 179--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           doc-string</td></tr></table>
<!--l. 180--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           slot-description-1</td></tr></table>
                                                                          

                                                                          
<!--l. 181--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           slot-description-2</td></tr></table>
<!--l. 182--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           ...</td></tr></table>
<!--l. 183--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">           slot-description-n)</td></tr></table>
<!--l. 184--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 185--><p class="indent" >
</div>
</div>
<!--l. 186--><p class="noindent" >The name must be a symbol; it becomes the name of a new data type consisting of all
instances of the structure. The function <i>typep</i> will accept and use this
name as appropriate. The name is returned as the value of the defstruct
form.
<!--l. 192--><p class="indent" >   Usually no options are needed at all. If no options are speciﬁed, then one may
write simply name instead of <i>(name)</i> after the word <i>defstruct</i>. The syntax of
options and the options provided are discussed in section <a 
href="clmse107.html#x131-17300019.5">19.5<!--tex4ht:ref: DEFSTRUCT-OPTIONS --></a>.
<!--l. 197--><p class="indent" >   If the optional documentation string doc-string is present, then it is
attached to the name as a documentation string of type <i>structure</i>; see
<i>documentation</i>.
<!--l. 201--><p class="indent" >   Each slot-description-j is of the form <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(slot-name default-init
</td></tr></table>
<!--l. 203--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     slot-option-name-1 slot-option-value-1</td></tr></table>
<!--l. 204--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     slot-option-name-2 slot-option-value-2</td></tr></table>
<!--l. 205--><p class="indent" >                                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ...</td></tr></table>
<!--l. 206--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     slot-option-name-k<sub>j</sub> slot-option-value-k<sub>j</sub>)</td></tr></table>
<!--l. 208--><p class="indent" >
</div>
</div>
<!--l. 209--><p class="noindent" >Each slot-name must be a symbol; an access function is deﬁned for each slot. If no
options and no default-init are speciﬁed, then one may write simply slot-name
instead of <i>(slot-name)</i> as the slot description.
<div class=obsolete>
<!--l. 215--><p class="indent" >   The default-init is a form that is evaluated each time a structure is to be
constructed; the value is used as the initial value of the slot.
</div>
<div class=newer>
                                                                          

                                                                          
<!--l. 221--><p class="indent" >   X3J13 voted in October 1988 ⟨<b>?</b>⟩ to clarify that a default-init form
is evaluated only if the corresponding argument is not supplied to the
constructor function. The preceding sentence should therefore read as
follows:
<!--l. 226--><p class="indent" >   The default-init is a form that is evaluated each time its value is to be used as
the initial value of the slot.
</div> If no default-init is speciﬁed, then the initial contents of the slot are undeﬁned
and implementation-dependent. The available slot-options are described in
section <a 
href="clmse106.html#x130-17200019.4">19.4<!--tex4ht:ref: Defstruct-Slot-Options --></a>.
<div class=incompatibility>
<!--l. 236--><p class="noindent" ><b>Compatibility note:</b> Slot-options are not currently provided in Lisp Machine Lisp, but
this is an upward-compatible extension.
</div>
<div class=new>
<!--l. 243--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that it is an error for two slots to
have the same name; more precisely, no two slots may have names for
whose print names <i>string=</i> would be true. Under this interpretation <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defstruct lotsa-slots slot slot)
</td></tr></table>
<!--l. 251--><p class="indent" >
</div>
</div>
<!--l. 252--><p class="noindent" >obviously is incorrect but the following one is also in error, even assuming that
the symbols <i>coin:slot</i> and <i>blot:slot</i> really are distinct (non-<i>eql</i>) symbols: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defstruct no-dice coin:slot blot:slot)
</td></tr></table>
<!--l. 257--><p class="indent" >
</div>
</div>
<!--l. 258--><p class="noindent" >To illustrate another case, the ﬁrst <i>defstruct</i> form below is correct, but the second
one is in error. <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defstruct one-slot slot)
</td></tr></table>
<!--l. 261--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defstruct (two-slots (:include one-slot)) slot)</td></tr></table>
<!--l. 263--><p class="indent" >
</div>
</div>
<div class=rationale>
<!--l. 266--><p class="noindent" ><b>Rationale:</b> Print names are the criterion for slot-names being the same, rather
than the symbols themselves, because <i>defstruct</i> constructs names of accessor
functions from the print names and interns the resulting new names in the current
package.
</div>
<!--l. 275--><p class="indent" >   X3J13 recommended that expanding a <i>defstruct</i> form violating this restriction
should signal an error and noted, with an eye to the Common Lisp Object System
⟨<b>?</b>⟩, that the restriction applies only to the operation of the <i>defstruct</i>
macro as such and not to the <i>structure-class</i> or structures deﬁned with
<i>defclass</i>.
</div>
<div class=newer>
<!--l. 285--><p class="indent" >   X3J13 voted in March 1989 ⟨<b>?</b>⟩ to clarify that, while deﬁning forms
normally appear at top level, it is meaningful to place them in non-top-level
contexts; <i>defstruct</i> must treat slot default-init forms and any initialization
                                                                          

                                                                          
forms within the speciﬁcation of a by-position constructor function as
occurring within the enclosing lexical environment, not within the global
environment.
</div>
<i>
<!--l. 296--><p class="indent" >   defstruct</i> not only deﬁnes an access function for each slot, but also arranges for
<i>setf </i> to work properly on such access functions, deﬁnes a predicate named
<i>name-p</i>, deﬁnes a constructor function named <i>make-name</i>, and deﬁnes a
copier function named <i>copy-name</i>. All names of automatically created
functions are interned in whatever package is current at the time the
<i>defstruct</i> form is processed (see <i>*package*</i>). Also, all such functions may
be declared <i>inline</i> at the discretion of the implementation to improve
eﬃciency; if you do not want some function declared <i>inline</i>, follow the
<i>defstruct</i> form with a <i>notinline</i> declaration to override any automatic <i>inline</i>
declaration.
<div class=newer>
<!--l. 311--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that the results of redeﬁning a
<i>defstruct</i> structure (that is, evaluating more than one <i>defstruct</i> structure for the
same name) are undeﬁned.
<!--l. 316--><p class="indent" >   The problem is that if instances have been created under the old deﬁnition and
then remain accessible after the new deﬁnition has been evaluated, the accessors
and other functions for the new deﬁnition may be incompatible with the old
instances. Conversely, functions associated with the old deﬁnition may have been
declared <i>inline</i> and compiled into code that remains accessible after the new
deﬁnition has been evaluated; such code may be incompatible with the new
instances.
<!--l. 324--><p class="indent" >   In practice this restriction aﬀects the development and debugging process
rather than production runs of fully developed code. The <i>defstruct</i> feature is
intended to provide “the most eﬃcient” structure class. CLOS classes
deﬁned by <i>defclass</i> allow much more ﬂexible structures to be deﬁned and
redeﬁned.
<!--l. 331--><p class="indent" >   Programming environments are allowed and encouraged to permit <i>defstruct</i>
redeﬁnition, perhaps with warning messages about possible interactions with
other parts of the programming environment or memory state. It is beyond the
scope of the Common Lisp language standard to deﬁne those interactions except
to note that they are not portable.
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 340--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse105.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse103.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse103.html#tailclmse103.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse104.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 340--><p class="indent" >   <a 
 id="tailclmse104.html"></a>  
</body></html> 
