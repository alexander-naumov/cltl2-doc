<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Список свойств</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 23:44:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 524--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse55.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#tailclmch10.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse54.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#clmse54.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">10.1   </span> <a 
href="clm.html#QQ2-69-951" id="x69-94200010.1">Список
свойств</a></h3>
<!--l. 526--><p class="noindent" >Начиная с самого создания, Lisp для каждого символа ассоциирует
табличную структуру данных, называемую <i>список свойств</i> (для краткости
<i>plist</i>). Список свойств содержит ноль и более элементов. Каждый элемент
содержит ключ (называемым <i>индикатором</i>), который чаще всего является
символом, и ассоциированным с ним значением (называемым иногда
<i>свойством</i>), которое может быть любым Lisp&#x2019;овым объектом. Среди
индикаторов не может быть дубликатов. Список свойств может иметь только
одно свойство для данного имени. Таким образом, значение может получено
с помощью двух символов: исходного символа и индикатора.
<!--l. 536--><p class="indent" >   Список свойств по целевому назначению очень похож на ассоциативный
список. Различие в том, что список свойств является единственно подлинным
объектом. Операции добавления и удаления элементов деструктивны, то есть
при их использовании изменяется старый список, и нового списка свойств
не создаётся. Ассоциативные список, наоборот, обычно изменяются
недеструктивно (без побочных эффектов) с помощью добавления в начало
новых элементов (смотрите <tt><a 
href="clmli7.html#x196-3479074r74">acons</a></tt> и <tt><a 
href="clmli7.html#x196-3479695r695">pairlis</a></tt>).
<!--l. 544--><p class="indent" >   Список свойств реализуется, как ячейка памяти, содержащая список с
чётным (возможно нулевым) количеством аргументов. (Обычно эта ячейка
памяти является ячейкой списка свойств в символе, но в принципе подходит
любая ячейка памяти, к которой можно применить <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>) Каждая пара
элементов в списке составляет строку. Первый в паре это индикатор, а
второй — значение. Так как функции для списка свойств используют
символ, а не сам список, то изменения этого списка свойств может быть
записаны сохранением обратно в ячейку списка свойств символа.
FIXME
<!--l. 553--><p class="indent" >   Когда создаётся символ, его список свойств пуст. Свойства создаются с
помощью <tt><a 
href="clmli7.html#x196-3479444r444">get</a></tt> внутри формы <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>.
<!--l. 556--><p class="indent" >   Common Lisp не использует список свойств символа так интенсивно, как
это делали ранние реализации Lisp&#x2019;а. В Common Lisp&#x2019;е нечасто используемые
данные, такие как отладочная информация, информация для компилятора и
документация, хранятся в списках свойств.
<div class="defun">
<!--l. 561--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx69-942001"></a><a 
 id="x69-942002r145"></a><b> get</b>  <i>symbol</i> <i>indicator</i> &#x0026;optional  <i>default</i>
</div>
                                                                          

                                                                          
<!--l. 563--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-94300010.1" id="x69-94300010.1"></a></span>
<tt>
   <a 
href="clmli7.html#x196-3479444r444">get</a></tt> ищет в списке свойств символа <i>symbol</i> индикатор равный <tt><a 
href="clmli7.html#x196-3479367r367">eq</a></tt>
индикатору <i>indicator</i>. Первый аргумент должен быть символом. Если такое
свойство найдено, возвращается её значение. Иначе возвращается значение
<i>default</i>.
<!--l. 570--><p class="indent" >   Если <i>default</i> не указано, тогда для значения по-умолчанию используется
<tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>.
<!--l. 573--><p class="indent" >   Следует отметить, что способа отличить значения по-умолчанию и такое
же значение свойства нет: <div class="lisp"><div class="tabbing">
(get x y) <span class="math"> ≡</span> (getf (symbol-plist x) y)
   <br>
<!--l. 577--><p class="noindent" ></div>
<!--l. 577--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-94400010.1" id="x69-94400010.1"></a></span>
<!--l. 577--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-94500010.1" id="x69-94500010.1"></a></span>
</div>
<!--l. 578--><p class="indent" >   Допустим, что список свойств символа <tt>foo</tt> является <tt>(bar t baz 3 hunoz
&#x0022;Huh?&#x0022;)</tt>. Тогда, например: <div class="lisp"><div class="tabbing">
(get &#x2019;foo &#x2019;baz) <span class="math"> ⇒</span> 3
   <br>                                                         (get &#x2019;foo &#x2019;hunoz) <span class="math"> ⇒</span> &#x0022;Huh?&#x0022;<br>
(get &#x2019;foo &#x2019;zoo) <span class="math"> ⇒</span> <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt><br>
<!--l. 585--><p class="noindent" ></div>
<!--l. 585--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-94600010.1" id="x69-94600010.1"></a></span>
                                                                          

                                                                          
<!--l. 585--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-94700010.1" id="x69-94700010.1"></a></span>
</div>
<tt>
<!--l. 587--><p class="indent" >   <a 
href="clmli7.html#x196-3479840r840">setf</a></tt> может использоваться вместе с <tt><a 
href="clmli7.html#x196-3479444r444">get</a></tt> для создания новой пары
свойства, возможно замещая старую пару с тем же именем. Например:
<div class="lisp"><div class="tabbing">
(get &#x2019;clyde &#x2019;species) <span class="math"> ⇒</span> <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>
   <br>                    (setf (get &#x2019;clyde &#x2019;species) &#x2019;elephant) <span class="math"> ⇒</span> elephant<br>
и теперь (get &#x2019;clyde &#x2019;species) <span class="math"> ⇒</span> elephant<br>
<!--l. 594--><p class="noindent" ></div>
<!--l. 594--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-94800010.1" id="x69-94800010.1"></a></span>
<!--l. 594--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-94900010.1" id="x69-94900010.1"></a></span>
</div>
<!--l. 595--><p class="indent" >   В данном контексте может быть указан аргумент <i>default</i>. Он игнорируется в
<tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>, но может быть полезен в таких макросах, как <tt><a 
href="clmli7.html#x196-3479751r751">push</a></tt>, которые связаны с
<tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>: <div class="lisp"><div class="tabbing">
(push item (get sym &#x2019;token-stack &#x2019;(initial-item)))
   <br>
<!--l. 600--><p class="noindent" ></div>
<!--l. 600--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95000010.1" id="x69-95000010.1"></a></span>
<!--l. 600--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95100010.1" id="x69-95100010.1"></a></span>
</div>
<!--l. 601--><p class="indent" >   означает то же, что и <div class="lisp"><div class="tabbing">
                                                                          

                                                                          
(setf (get sym &#x2019;token-stack &#x2019;(initial-item))
   <br>                           (cons item (get sym &#x2019;token-stack &#x2019;(initial-item))))<br>
<!--l. 605--><p class="noindent" ></div>
<!--l. 605--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95200010.1" id="x69-95200010.1"></a></span>
<!--l. 605--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95300010.1" id="x69-95300010.1"></a></span>
</div>
<!--l. 606--><p class="indent" >   а если упростить, то <div class="lisp"><div class="tabbing">
(setf (get sym &#x2019;token-stack)
   <br>                           (cons item (get sym &#x2019;token-stack &#x2019;(initial-item))))<br>
<!--l. 610--><p class="noindent" ></div>
<!--l. 610--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95400010.1" id="x69-95400010.1"></a></span>
<!--l. 610--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95500010.1" id="x69-95500010.1"></a></span>
</div>
<div class="newer">
<!--l. 613--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx69-955001"></a>to clarify the permissible side eﬀects of certain
operations; <tt>(setf (get <i>symbol</i> <i>indicator</i>) <i>newvalue</i>)</tt> is required to behave
exactly the same as <tt>(setf (getf (symbol-plist <i>symbol</i>) <i>indicator</i>)
<i>newvalue</i>)</tt>.
</div>
</div>
<div class="defun">
<!--l. 621--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx69-955002"></a><a 
 id="x69-955003r146"></a><b> remprop</b>  <i>symbol</i> <i>indicator</i>
</div>
                                                                          

                                                                          
<!--l. 623--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95600010.1" id="x69-95600010.1"></a></span>
   Эта функция удаляет из символа <i>symbol</i> свойство с индикатором, равным
<tt><a 
href="clmli7.html#x196-3479367r367">eq</a></tt> индикатору <i>indicator</i>. Индикатор свойства и соответствующее значение
удаляется из списка деструктивной склейкой списка свойств. Она возвращает
<tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>, если указанного свойства не было, или не-<tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>, если свойство было.
<div class="lisp"><div class="tabbing">
(remprop x y) <span class="math"> ≡</span> (remf (symbol-plist x) y)
   <br>
<!--l. 631--><p class="noindent" ></div>
<!--l. 631--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95700010.1" id="x69-95700010.1"></a></span>
<!--l. 631--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95800010.1" id="x69-95800010.1"></a></span>
</div>
<!--l. 632--><p class="indent" >   Например, если список свойств <tt>foo</tt> равен <div class="lisp"><div class="tabbing">
(color blue height 6.3 near-to bar)
   <br>
<!--l. 635--><p class="noindent" ></div>
<!--l. 635--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-95900010.1" id="x69-95900010.1"></a></span>
<!--l. 635--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-96000010.1" id="x69-96000010.1"></a></span>
</div>
<!--l. 636--><p class="indent" >   тогда вызов <div class="lisp"><div class="tabbing">
(remprop &#x2019;foo &#x2019;height)
   <br>
<!--l. 639--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 639--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-96100010.1" id="x69-96100010.1"></a></span>
<!--l. 639--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-96200010.1" id="x69-96200010.1"></a></span>
</div>
<!--l. 640--><p class="indent" >   вернёт значение не-<tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>, после изменения списка свойств символа <tt>foo</tt> на
<div class="lisp"><div class="tabbing">
(color blue near-to bar)
   <br>
<!--l. 643--><p class="noindent" ></div>
<!--l. 643--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-96300010.1" id="x69-96300010.1"></a></span>
<!--l. 643--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-96400010.1" id="x69-96400010.1"></a></span>
</div>
<div class="newer">
<!--l. 645--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx69-964001"></a>to clarify the permissible side eﬀects of certain
operations; <tt>(remprop <i>symbol</i> <i>indicator</i>)</tt> is required to behave exactly the
same as <tt>(remf (symbol-plist <i>symbol</i>) <i>indicator</i>)</tt>.
</div>
</div>
<div class="defun">
<!--l. 653--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx69-964002"></a><a 
 id="x69-964003r147"></a><b> symbol-plist</b>  <i>symbol</i>
</div>
<!--l. 655--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-96500010.1" id="x69-96500010.1"></a></span>
   Эта функция возвращает список, который содержит пары свойств для
символа <i>symbol</i>. Извлекается содержимое ячейки списка свойств и
возвращается в качестве результата.
<!--l. 660--><p class="indent" >   Следует отметить, что использование <tt><a 
href="clmli7.html#x196-3479444r444">get</a></tt> с результатом <tt><a 
href="clmli7.html#x196-3479931r931">symbol-plist</a></tt> <i>не</i>
будет работать. Необходимо передавать в <tt><a 
href="clmli7.html#x196-3479444r444">get</a></tt> символ, или же использовать
<tt><a 
href="clmli7.html#x196-3479455r455">getf</a></tt>.
                                                                          

                                                                          
<!--l. 664--><p class="indent" >   С <tt><a 
href="clmli7.html#x196-3479931r931">symbol-plist</a></tt> может использоваться <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt> для деструктивной замены
списка свойств символа. Это относительно опасная операция, так как может
уничтожить важную информацию, которую, возможно, хранила там
реализация. Также, позаботьтесь о том, чтобы новый список свойств
содержал чётное количество элементов.
</div>
<div class="defun">
<!--l. 671--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx69-965001"></a><a 
 id="x69-965002r148"></a><b> getf</b>  <i>place</i> <i>indicator</i> &#x0026;optional  <i>default</i>
</div>
<!--l. 673--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-96600010.1" id="x69-96600010.1"></a></span>
<tt>
   <a 
href="clmli7.html#x196-3479455r455">getf</a></tt> ищет индикатор равный <tt><a 
href="clmli7.html#x196-3479367r367">eq</a></tt> <i>indicator</i> в списке свойств, находящимся
в <i>place</i>. Если он найден, тогда возвращается соответствующее значение.
Иначе возвращается <i>default</i>. Если <i>default</i> не задан, то значение по-умолчанию
используется <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>. Следует отметить, что метода определения, вернулось
ли значение по умолчанию или это значение свойства, нет. Часто
<i>place</i> вычисляется из обобщённой переменной, принимаемой функцией
<tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>.
<tt>
<!--l. 683--><p class="indent" >   <a 
href="clmli7.html#x196-3479840r840">setf</a></tt> может использоваться вместе <tt><a 
href="clmli7.html#x196-3479455r455">getf</a></tt>, и в этом случае <i>place</i> должно
быть обобщённым, чтобы его можно было передать в <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>. Целью является
добавление новой пары свойства, или изменению уже существующей пары, в
списке свойств, хранящимся в <i>place</i>. В данном контексте может быть
использован аргумент <i>default</i>. Он игнорируется функцией <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>, но может
быть полезен в таких макросах, как <tt><a 
href="clmli7.html#x196-3479751r751">push</a></tt>, которые связаны с <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>. Смотрите
описание <tt><a 
href="clmli7.html#x196-3479444r444">get</a></tt> для примера. <div class="newer"> X3J13 voted in March 1989 <a 
 id="dx69-966001"></a>to clarify the
permissible side eﬀects of certain operations; <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt> used with <tt><a 
href="clmli7.html#x196-3479455r455">getf</a></tt> is permitted to
perform a <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt> on the <i>place</i> or on any part, <i>car</i> or <i>cdr</i>, of the top-level list
structure held by that <i>place</i>.
</div>
<div class="newer">
<!--l. 700--><p class="indent" >   X3J13 voted in March 1988 <a 
 id="dx69-966002"></a>to clarify order of evaluation (see section <a 
href="clmse36.html#x48-4740007.2">7.2<!--tex4ht:ref: SETF-SECTION --></a>).
</div>
</div>
<div class="defmac">
<div class="defmacheader">
                                                                          

                                                                          
<!--l. 706--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i><b> remf </b> <a 
 id="dx69-966003"></a><a 
 id="x69-966004r149"></a> place indicator
   <br>
<!--l. 707--><p class="noindent" ></div>
<!--l. 707--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-96700010.1" id="x69-96700010.1"></a></span>
</div>
<!--l. 708--><p class="indent" >   Эта функция в списке свойств, хранящимся в <i>place</i>, удаляет свойства,
индикатор которого равен <tt><a 
href="clmli7.html#x196-3479367r367">eq</a></tt> аргументу <i>indicator</i>. Индикатор свойства и
соответствующее значение удаляется из списка деструктивной склейкой. <tt><a 
href="clmli7.html#x196-3479780r780">remf</a></tt>
возвращает <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>, если свойства не было в списке, и некоторое не-<tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt> значение,
если свойство было. Форма <i>place</i> может быть любой обобщённой переменной,
принимаемой <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>. Смотрите <tt><a 
href="clmli7.html#x196-3479787r787">remprop</a></tt>.
<div class="newer">
<!--l. 718--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx69-967001"></a>to clarify the permissible side eﬀects of
certain operations; <tt><a 
href="clmli7.html#x196-3479780r780">remf</a></tt> is permitted to perform a <tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt> on the <i>place</i>
or on any part, <i>car</i> or <i>cdr</i>, of the top-level list structure held by that
<i>place</i>.
</div>
<div class="newer">
<!--l. 726--><p class="indent" >   X3J13 voted in March 1988 <a 
 id="dx69-967002"></a>to clarify order of evaluation (see section <a 
href="clmse36.html#x48-4740007.2">7.2<!--tex4ht:ref: SETF-SECTION --></a>).
</div>
</div>
<div class="defun">
<!--l. 731--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx69-967003"></a><a 
 id="x69-967004r150"></a><b> get-properties</b>  <i>place</i> <i>indicator-list</i>
</div>
<!--l. 733--><p class="noindent" ><span class="paragraphHead"><a 
href="#x69-96800010.1" id="x69-96800010.1"></a></span>
<tt>
   <a 
href="clmli7.html#x196-3479451r451">get-properties</a></tt> похожа на <tt><a 
href="clmli7.html#x196-3479455r455">getf</a></tt> за исключением того, что второй
аргумент является списком индикаторов. <tt><a 
href="clmli7.html#x196-3479451r451">get-properties</a></tt> ищет первый
встретившийся индикатор, который есть в списке индикаторов. Обычно <i>place</i>
вычисляется из обобщённой переменной, которая может использоваться в
<tt><a 
href="clmli7.html#x196-3479840r840">setf</a></tt>.
                                                                          

                                                                          
<tt>
<!--l. 739--><p class="indent" >   <a 
href="clmli7.html#x196-3479451r451">get-properties</a></tt> возвращает три значения. Если было найдено свойство,
то первые два значения являются индикатором и значением для первого
свойства, чей индикатор присутствовал в списке <i>indicator-list</i>, и третье
значение является остатком списка свойств, <i>car</i> элемент которого был
индикатором (и соответственно <i>cadr</i> элемент — значением). Если ни одного
свойства не было найдено, то все три значения равны <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>. Третье значение
является флагом успешности или неудачи, и позволяет продолжить поиск
свойств в оставшемся списке.
</div>
                                                                          

                                                                          
<!--l. 750--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse55.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#tailclmch10.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse54.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch10.html#clmse54.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse54.html"></a>  </div> </div> 
</body></html> 
