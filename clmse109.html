<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Создание новых потоков</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 00:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 828--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse110.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse108.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse108.html#tailclmse108.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse109.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse109.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">21.2   </span> <a 
href="clm.html#QQ2-135-1671" id="x135-166200021.2">Создание новых
потоков</a></h3>
<!--l. 830--><p class="noindent" >Пожалуй самые важные конструкции для создания новых потоков это то,
которые открывают файлы. Смотрите <tt><a 
href="clmse116.html#x144-2136009r718">with-open-file</a></tt> и <tt><a 
href="clmse116.html#x144-2135002r717">open</a></tt>. Следующие
функции создают потоки без ссылок на файловую систему.
<div class="defun">
<!--l. 834--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx135-1662001"></a><a 
 id="x135-1662002r603"></a><b> make-synonym-stream</b>  <i>symbol</i>
</div>
<!--l. 836--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-166300021.2" id="x135-166300021.2"></a></span>
<tt>
   <a 
href="#x135-1662002r603">make-synonym-stream</a></tt> создаёт и возвращает поток-синоним. Любые
операции на новом потоке будут проделаны на потоке, являющемся
значением динамической переменной с именем <i>symbol</i>. Если значение этой
переменной изменится или будет пересвязано, то поток-синоним будет
воздействовать на новый установленный поток.
</div>
<div class="defun">
<!--l. 844--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx135-1663001"></a><a 
 id="x135-1663002r604"></a><b> make-broadcast-stream</b>  &#x0026;rest  <i>streams</i>
</div>
<!--l. 846--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-166400021.2" id="x135-166400021.2"></a></span>
   Эта функция возвращает поток, который работает только для записи.
Любая выходная информация, посланная в этот поток, будет отослана в все
указанные потоки <i>streams</i>. Множество операций, которые могут быть
выполнены на новом потоке, является пересечением множеств операций
для указанных потоков. Результаты, возвращаемые операциями над
новым потоком, являются результатами возвращёнными операциями на
последнем потоке из списка <i>streams</i>. Результаты полученные в ходе
выполнения функции над всеми, кроме последнего, потоками игнорируются.
Если не было передано ни одного потока в аргументе <i>streams</i>, тогда
результат является «кусочком клоаки». Вся выводимая информация будет
игнорироваться.
                                                                          

                                                                          
</div>
<div class="defun">
<!--l. 861--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx135-1664001"></a><a 
 id="x135-1664002r605"></a><b> make-concatenated-stream</b>  &#x0026;rest  <i>streams</i>
</div>
<!--l. 863--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-166500021.2" id="x135-166500021.2"></a></span>
   Данная функция возвращает поток, который работает только для чтения.
Входная информация берётся из первого потоки из списка <i>streams</i> пока
указатель не достигнет конца-файла end-of-ﬁle, затем данный поток
откладывается, и входная информация берётся из следующего, и так
далее. Если список потоков <i>stream</i> был пуст, то возвращается поток без
содержимого. Любая попытка чтения будет возвращать конец-файла
end-of-ﬁle.
</div>
<div class="defun">
<!--l. 872--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx135-1665001"></a><a 
 id="x135-1665002r606"></a><b> make-two-way-stream</b>  <i>input-stream</i> <i>output-stream</i>
</div>
<!--l. 874--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-166600021.2" id="x135-166600021.2"></a></span>
   Данная функция возвращает поток для чтения и записи, который
входную информацию получает из <i>input-stream</i> и посылает выходную
информацию в <i>output-stream</i>.
</div>
<div class="defun">
<!--l. 879--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx135-1666001"></a><a 
 id="x135-1666002r607"></a><b> make-echo-stream</b>  <i>input-stream</i> <i>output-stream</i>
</div>
<!--l. 881--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-166700021.2" id="x135-166700021.2"></a></span>
   Данная функция возвращает поток для чтения и записи, который
получает входную информацию из <i>input-stream</i> и отсылает выходную в
<i>output-stream</i>. В дополнение, входная информация посылается в <i>output-stream</i>
(эхо).
</div>
<div class="defun">
<!--l. 887--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx135-1667001"></a><a 
 id="x135-1667002r608"></a><b> make-string-input-stream</b>  <i>string</i> &#x0026;optional  <i>start</i> <i>end</i>
</div>
                                                                          

                                                                          
<!--l. 889--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-166800021.2" id="x135-166800021.2"></a></span>
   Данная функция возвращает поток для чтения. Данный поток
последовательно будет сохранять строковые символы в подстроке в строке
<i>string</i> ограниченной с помощью <i>start</i> и <i>end</i>. После того, как будет достигнут
последний символ, поток вернёт конец-файла.
</div>
<div class="defun">
<!--l. 896--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx135-1668001"></a><a 
 id="x135-1668002r609"></a><b> make-string-output-stream</b>  &#x0026;key  <i>:element-type</i>
</div>
<!--l. 898--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-166900021.2" id="x135-166900021.2"></a></span>
   Данная функция возвращает поток для записи, который будет
аккумулировать всю полученную информацию в строку, которая может быть
получена с помощью функции <tt><a 
href="#x135-1669002r610">get-output-stream-string</a></tt>.
<!--l. 903--><p class="indent" >   Аргумент <tt>:element-type</tt> указывает, какие символы могут приниматься
потоком. Если аргумент <tt>:element-type</tt> опущен, созданный поток должен
принимать все символы.
<!--l. 907--><p class="indent" >   Результатом <tt><a 
href="#x135-1668002r609">make-string-output-stream</a></tt> всегда является поток типа
<tt>string-stream</tt>.
</div>
<div class="defun">
<!--l. 911--><p class="noindent" ><div class="defunheader"> <i>[Функция]</i><a 
 id="dx135-1669001"></a><a 
 id="x135-1669002r610"></a><b> get-output-stream-string</b>  <i>string-output-stream</i>
</div>
<!--l. 913--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-167000021.2" id="x135-167000021.2"></a></span>
   Данная функция возвращает строку, для потока, возвращённого
функцией <tt><a 
href="#x135-1668002r609">make-string-output-stream</a></tt>, которая содержит все записанную в
данный поток информацию. После этого поток сбрасывается. Таким
образом каждый вызов <tt><a 
href="#x135-1669002r610">get-output-stream-string</a></tt> возвращает только те
символы, которые были записаны с момента предыдущего вызова этой
функции (или создания потока, если предыдущего вызова ещё не
было).
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 923--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
 <i>[Макрос]</i><b> with-open-stream </b><a 
 id="dx135-1670001"></a><a 
 id="x135-1670002r611"></a> (var stream) {declaration}* {form}*
   <br>
<!--l. 924--><p class="noindent" ></div>
<!--l. 924--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-167100021.2" id="x135-167100021.2"></a></span>
</div>
<!--l. 925--><p class="indent" >   Форма <i>stream</i> вычисляется и должна вернуть поток. Переменная <i>var</i>
связывается с этим потоком, и затем выполняются формы тела как неявный
<tt><a 
href="clmse38.html#x50-580002r76">progn</a></tt>. Результатом выполнения <tt><a 
href="#x135-1670002r611">with-open-stream</a></tt> является значение
последней формы. Поток автоматически закрывается при выходе из формы
<tt><a 
href="#x135-1670002r611">with-open-stream</a></tt>, вне зависимости от типа выхода. Смотрите <tt><a 
href="clmse110.html#x136-1683002r619">close</a></tt>. Поток
следует рассматривать, как имеющий динамическую продолжительность
видимости.
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 936--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i><b> with-input-from-string </b><a 
 id="dx135-1671001"></a><a 
 id="x135-1671002r612"></a> (var string {keyword value}*)
   <br>                                                               {declaration}* {form}*<br>
<!--l. 938--><p class="noindent" ></div>
<!--l. 938--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-167200021.2" id="x135-167200021.2"></a></span>
</div>
<!--l. 939--><p class="indent" >   Тело выполняется как неявный <tt><a 
href="clmse38.html#x50-580002r76">progn</a></tt> с переменной <i>var</i> связанной с
потоком символов для чтения, который последовательно предоставляет
символы из значения формы <i>string</i>. <tt><a 
href="#x135-1671002r612">with-input-from-string</a></tt> возвращает
результат выполнения последней формы <i>form</i> тела.
<!--l. 944--><p class="indent" >   В параметрах могут использоваться следующие имена:
      <div class="quotation">
<div class="flushdesc">
      <!--l. 947--><p class="noindent" >
                                                                          

                                                                          
     <ul><li><b>
<tt>:index</tt> </b></li>Форма  после  <tt>:index</tt> должна  быть  <i>местом</i>,  в  которое
     можно  осуществить  запись  с  помощью  <tt><a 
href="clmse36.html#x48-474002r64">setf</a></tt>.  Если  форма
     <tt><a 
href="#x135-1671002r612">with-input-from-string</a></tt> завершается  нормально,  то  <i>место</i>
     будет содержать позицию первого не прочитанного символа
     из строки <i>string</i> (или длину строки, если все символы были
     прочитаны). <i>Место</i> не изменяется в процессе чтения, а только
     во время выхода.
     <li><b>
<tt>:start</tt> </b></li><tt>:start</tt> принимает  аргумент,  указывающий  позицию  с
     которой  необходимо  начинать  чтение  символов  из  строки
     <i>string</i>.
     <li><b>
<tt>:end</tt> </b></li>The <tt>:end</tt> keyword takes an argument indicating, in the manner
     usual for sequence functions, the end of a substring of <i>string</i> to
     be used. <tt>:end</tt> принимает аргумент, указывающий на позицию
     на которой необходимо завершить чтение символов из строки
     <i>string</i>
     </ul>
</div>
      </div>
<!--l. 969--><p class="indent" >   The <tt>:start</tt> and <tt>:index</tt> keywords may both specify the same variable, which
is a pointer within the string to be advanced, perhaps repeatedly by some
containing loop.
<!--l. 973--><p class="indent" >   Вот простой пример использования <tt><a 
href="#x135-1671002r612">with-input-from-string</a></tt>: <div class="lisp"><div class="tabbing">
(with-input-from-string (s &#x0022;Animal Crackers&#x0022; :index j :start 6)
   <br>                                                                  (read s)) <span class="math"> ⇒</span> crackers<br>
<!--l. 977--><p class="noindent" ></div>
<!--l. 977--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-167300021.2" id="x135-167300021.2"></a></span>
                                                                          

                                                                          
<!--l. 977--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-167400021.2" id="x135-167400021.2"></a></span>
</div>
<!--l. 978--><p class="indent" >   В качестве побочного эффекта переменная <tt>j</tt> будет установлена в
<tt>15</tt>.
<tt>
<!--l. 980--><p class="indent" >   :start</tt> и <tt>:index</tt> могут оба содержать одну переменную, указывающую
позицию в строке, возможно, внутри цикла.
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 985--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i><b> with-output-to-string </b><a 
 id="dx135-1674001"></a><a 
 id="x135-1674002r613"></a> (var [string [<span class="math">: element − type!type]])</span>
   <br>                                                               {declaration}* {form}*<br>
<!--l. 987--><p class="noindent" ></div>
<!--l. 987--><p class="noindent" ><span class="paragraphHead"><a 
href="#x135-167500021.2" id="x135-167500021.2"></a></span>
</div>
<!--l. 988--><p class="indent" >   Можно указать <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt> вместо строки <i>string</i> и использовать аргумент
<tt>:element-type</tt> для указания, какие символы должны приниматься
созданным потоком. Если аргумент <i>string</i> не указан или он <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt> и не
указан <tt>:element-type</tt>, то созданный поток должен принимать все
символы.
</div>
                                                                          

                                                                          
<!--l. 994--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse110.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse108.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse108.html#tailclmse108.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse109.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse109.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse109.html"></a>   </div> </div> 
</body></html> 
