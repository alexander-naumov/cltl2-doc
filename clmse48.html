<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Синтаксис декларации</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-20 20:04:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1323--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse49.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#tailclmch9.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse48.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse48.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">9.1   </span> <a 
href="clm.html#QQ2-62-157" id="x62-1500009.1">Синтаксис декларации</a></h3>
<!--l. 1326--><p class="noindent" >Конструкция <a 
href="#x62-150003r123">declare</a> используется для встраивания деклараций внутрь
выполняемого кода. Глобальные декларации и декларации, вычисленные
программой, устанавливаются конструкцией <a 
href="#x62-151002r124">proclaim</a>.
<div class=newer>
<!--l. 1331--><p class="indent" >   X3J13 проголосовал в июне 1989 <a 
 id="dx62-150001"></a>ввести новый макрос <a 
href="#x62-151004r125">declaim</a>, который
гарантированно распознаётся компилятором, и часто более удобен, чем
<a 
href="#x62-151002r124">proclaim</a> для установки глобальных деклараций. FIXME
</div>
<div class=defspec>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> declare </b><a 
 id="dx62-150002"></a><a 
 id="x62-150003r123"></a> {decl-spec}*
</td></tr></table>
<!--l. 1340--><p class="indent" >
</div>
<!--l. 1340--><p class="noindent" ><span class="paragraphHead"><a 
href="#x62-1510009.1" id="x62-1510009.1"></a></span>
   Форма <a 
href="#x62-150003r123">declare</a> известна как <i>декларация</i>. Декларации могут использоваться
только в начале тел соответствующих специальных форм. То есть
декларация может использоваться в этой специальной форме, как
выражение, и все предыдущие выражение (если есть) также должны быть
формами <a 
href="#x62-150003r123">declare</a> (или, в некоторых случаях, строками документации).
Декларации могут использоваться в лямбда-выражениях и перечисленных
ниже формах. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">deﬁne-setf-method             </td><td  
class="tabbing"><a 
href="clmse39.html#x51-103004r78">labels</a>
</td></tr></table>
<!--l. 1349--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse45.html#x58-144004r118">defmacro</a>                         </td><td  
class="tabbing"><a 
href="clmse39.html#x51-100002r74">let</a></td></tr></table>
<!--l. 1350--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">defsetf                            </td><td  
class="tabbing"><a 
href="clmse39.html#x51-101002r75">let*</a></td></tr></table>
<!--l. 1351--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse24.html#x33-51002r6">deftype</a>                           </td><td  
class="tabbing">locally</td></tr></table>
<!--l. 1352--><p class="indent" >                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse30.html#x40-67002r13">defun</a>                              </td><td  
class="tabbing"><a 
href="clmse39.html#x51-103006r79">macrolet</a></td></tr></table>
<!--l. 1353--><p class="indent" >                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse137.html#x168-342002r837">do</a>                                  </td><td  
class="tabbing"><a 
href="clmse43.html#x55-134002r111">multiple-value-bind</a></td></tr></table>
<!--l. 1354--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse42.html#x54-120004r92">do*</a>                                </td><td  
class="tabbing"><a 
href="clmse42.html#x54-127002r102">prog</a></td></tr></table>
<!--l. 1355--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse60.html#x76-172002r167">do-all-symbols</a>                  </td><td  
class="tabbing"><a 
href="clmse42.html#x54-127004r103">prog*</a></td></tr></table>
<!--l. 1356--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse60.html#x76-171002r166">do-external-symbols</a>           </td><td  
class="tabbing"><a 
href="clmse108.html#x134-243002r612">with-input-from-string</a></td></tr></table>
<!--l. 1357--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse60.html#x76-170004r165">do-symbols</a>                      </td><td  
class="tabbing"><a 
href="clmse115.html#x143-278012r725">with-open-ﬁle</a></td></tr></table>
<!--l. 1358--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse42.html#x54-122002r93">dolist</a>                              </td><td  
class="tabbing"><a 
href="clmse108.html#x134-242018r611">with-open-stream</a></td></tr></table>
<!--l. 1359--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing"><a 
href="clmse42.html#x54-123002r94">dotimes</a>                           </td><td  
class="tabbing"><a 
href="clmse108.html#x134-244002r613">with-output-to-string</a></td></tr></table>
<!--l. 1360--><p class="indent" >                                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><a 
href="clmse39.html#x51-103002r77">ﬂet</a></td></tr></table>
<!--l. 1362--><p class="indent" >
</div>
</div>
<!--l. 1364--><p class="indent" >   Вычисление декларации является ошибкой. Специальные формы,
которые позволяют использовать декларации, явно проверяют их
наличие.
                                                                          

                                                                          
<!--l. 1367--><p class="indent" >   Макровызовы могут раскрываться в декларации, при условии, что
макровызов указан в том месте, где могут быть указаны декларации.
(Однако, макровызов не может использоваться в форме declare на месте
<i>decl-spec</i>.)
<!--l. 1371--><p class="indent" >   Каждая форма <i>decl-spec</i> является списком, у которого <i>car</i> элемент это
символ, указывающий на тип декларации. Декларации могут быть разделены
на два класса: одни относятся к связыванию переменных, другие нет.
(Декларация special является исключением, она попадает в оба класса, это
будет описано ниже.) Те, которые касаются связываний переменных,
применяются только к связываниям, созданным в форме, в которой они
используются. Например, в <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x)
</td></tr></table>
<!--l. 1379--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (type ﬂoat x)) ...</td></tr></table>
<!--l. 1380--><p class="indent" >                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((x &#x2019;a)) ...)</td></tr></table>
<!--l. 1381--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 1383--><p class="indent" >
</div>
</div>
<!--l. 1384--><p class="noindent" >декларация type применяется только для внешнего связывания x, а не для
связывания, созданного в <a 
href="clmse39.html#x51-100002r74">let</a>.
<!--l. 1387--><p class="indent" >   Декларации, которые не воздействуют на связывания переменных,
воздействуют на весь код тела в специальной форме. Например, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x y) (declare (notinline ﬂoor)) ...)
</td></tr></table>
<!--l. 1392--><p class="indent" >
</div>
</div>
<!--l. 1393--><p class="noindent" >рекомендует, что везде внутри тела функции foo, <a 
href="clmse66.html#x83-184012r219">ﬂoor</a> должна быть вызвана как
отдельная подпрограмма, а не встроена в код.
<!--l. 1396--><p class="indent" >   Некоторые специальные формы содержат части кода, которые,
правильнее говоря, на являются телом этой формы. Это например код
инициализации переменных и форма результата для циклов. Во всех
                                                                          

                                                                          
случаях, такой дополнительный код оказывается под воздействием
всеобъемлемых деклараций, которые указаны перед телом специальной
формы. Невсеобъемлемые декларации не оказывают воздействия на этот код,
за исключением (конечно) ситуаций, когда код находится в области
действия переменной, для которой использовалась декларация. Например:
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun few (x &#x0026;optional (y *print-circle*))
</td></tr></table>
<!--l. 1406--><p class="indent" >                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (special *print-circle*))</td></tr></table>
<!--l. 1407--><p class="indent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ...)</td></tr></table>
<!--l. 1409--><p class="indent" >
</div>
</div>
<!--l. 1410--><p class="noindent" >Ссылка на *print-circle* в первой строке примера является специальной, так как
указана соответствующая декларация. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun nonsense (k x z)
</td></tr></table>
<!--l. 1413--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (foo z x)               ;Первый вызов foo</td></tr></table>
<!--l. 1414--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((j (foo k x))     ;Второй вызов foo</td></tr></table>
<!--l. 1415--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (x (* k k)))</td></tr></table>
<!--l. 1416--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (declare (inline foo) (special x z))</td></tr></table>
<!--l. 1417--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (foo x j z)))         ;Третий вызов foo</td></tr></table>
<!--l. 1419--><p class="indent" >
</div>
</div>
<!--l. 1420--><p class="noindent" >В этом примере, декларация inline применяется только ко второму и
третьему вызову foo. Декларация special для переменной x указывает,
что форма <a 
href="clmse39.html#x51-100002r74">let</a> создаст специальное связывание для x и тем самым
ссылки в теле формы также будут специальными. Ссылка на x во
втором вызове foo является специальной. Ссылка на x в первом вызове
foo является локальной, а не специальной. Декларация special для z
указывает на то, что ссылка в вызове foo будет специальной. Это значит
ссылка не будет указывать на параметр функции nonsense, так как
                                                                          

                                                                          
для параметра декларации special не указано. (Декларация special
переменной z указывается не в теле <a 
href="clmse30.html#x40-67002r13">defun</a>, а в теле внутренней конструкции
<a 
href="clmse39.html#x51-100002r74">let</a>. Таким образом она не воздействует на связывание параметра
функции.)
</div>
<div class=defun>
<!--l. 1436--><p class="noindent" ><i>[Функция]</i><a 
 id="dx62-151001"></a><a 
 id="x62-151002r124"></a><b> proclaim</b>  <i>decl-spec</i>
<!--l. 1438--><p class="noindent" >Функция <a 
href="#x62-151002r124">proclaim</a> в качестве аргумента принимает <i>decl-spec</i>, и применяет
указания в глобальном пространстве. (Такие глобальные декларации
называются <i>прокламации</i>.) Так как <a 
href="#x62-151002r124">proclaim</a> является функцией, то её
аргумент вычисляется всегда. Это позволяет программам вычислять
декларацию и затем для применения помещать её в вызов <a 
href="#x62-151002r124">proclaim</a>.
<!--l. 1446--><p class="indent" >   Любые упоминаемые имена переменных указывают на значения
динамических переменных. Например, выполненная прокламация
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(type ﬂoat tolerance))
</td></tr></table>
<!--l. 1450--><p class="indent" >
</div>
</div>
<!--l. 1451--><p class="noindent" >указывает на то, что динамическое значение tolerance должно быть всегда
числом с плавающей точкой. Подобным образом, любые упоминаемые имена
функций указывают на глобальные определения функций.
<!--l. 1456--><p class="indent" >   Прокламации содержат универсальные декларации, которые всегда
действуют, кроме случаев сокрытия их локальными декларациями.
Например, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(inline ﬂoor))
</td></tr></table>
<!--l. 1460--><p class="indent" >
</div>
</div>
<!--l. 1461--><p class="noindent" >рекомендует то, что <a 
href="clmse66.html#x83-184012r219">ﬂoor</a> должна быть встроена в места её вызова. Но в
ситуации <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x y) (declare (notinline ﬂoor)) ...)
</td></tr></table>
<!--l. 1465--><p class="indent" >
</div>
</div>
<!--l. 1466--><p class="noindent" ><a 
href="clmse66.html#x83-184012r219">ﬂoor</a> будет вызываться как отдельная функция, так как локальная декларация
скрыла прокламацию.
<!--l. 1469--><p class="indent" >   Специальный случай, когда <a 
href="#x62-151002r124">proclaim</a> обрабатывает special, то <i>decl-spec</i>
применяется ко всем связываниям и ссылкам на упомянутую переменную.
Например, после <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(proclaim &#x2019;(special x))
</td></tr></table>
<!--l. 1475--><p class="indent" >
</div>
</div>
<!--l. 1476--><p class="noindent" >в определении функции <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun example (x) ...)
</td></tr></table>
<!--l. 1479--><p class="indent" >
</div>
</div>
<!--l. 1480--><p class="noindent" >параметр x будет связан, как специальная (динамическая) переменная, а не
лексическая (статическая). Такой приём должен использоваться аккуратно.
Обычный способ определить глобальную специальную переменную это
использовать <a 
href="clmse30.html#x40-69002r14">defvar</a> или <a 
href="clmse30.html#x40-69004r15">defparameter</a>.
</div>
<div class=newer>
<div class=defmac>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> declaim </b><a 
 id="dx62-151003"></a><a 
 id="x62-151004r125"></a> {decl-spec}*
</td></tr></table>
<!--l. 1490--><p class="indent" >
</div>
<!--l. 1490--><p class="noindent" ><span class="paragraphHead"><a 
href="#x62-1520009.1" id="x62-1520009.1"></a></span>
   Этот макрос синтаксически похож на <a 
href="#x62-150003r123">declare</a> и семантически на <a 
href="#x62-151002r124">proclaim</a>.
Это выполняемая форма и она может использоваться везде, где может
<a 
href="#x62-151002r124">proclaim</a>. Однако, формы <i>decl-spec</i> не вычисляются.
<!--l. 1495--><p class="indent" >   Если вызов этого макроса произошёл на верхнем уровне в файле,
обрабатываемом компилятором, то прокламации также будут выполнены во
время компиляции. As with other deﬁning macros, it is unspeciﬁed whether or
not the compile-time side eﬀects of a <a 
href="#x62-151004r125">declaim</a> persist after the ﬁle has been
compiled (see section <a 
href="clmse122.html#x152-29400025.1">25.1<!--tex4ht:ref: COMPILER-SECTION --></a>). FIXME
</div>
</div>
                                                                          

                                                                          
   <!--l. 1504--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse49.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#tailclmch9.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse48.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch9.html#clmse48.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 1504--><p class="indent" >   <a 
 id="tailclmse48.html"></a>  
</body></html> 
