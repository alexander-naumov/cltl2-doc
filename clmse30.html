<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Top-Level Forms Формы верхнего уровня</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-06 23:16:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1337--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch6.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse29.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse29.html#tailclmse29.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse30.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch5.html#clmse30.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">5.3   </span> <a 
 id="x40-1250005.3"></a>Top-Level Forms Формы верхнего уровня</h3>
<!--l. 1339--><p class="noindent" >The standard way for the user to interact with a Common Lisp implementation is
via a <i>read-eval-print loop</i>: the system repeatedly reads a form from some input
source (such as a keyboard or a disk ﬁle), evaluates it, and then prints the
value(s) to some output sink (such as a display screen or another disk ﬁle). Any
form (evaluable data object) is acceptable; however, certain special forms are
speciﬁcally designed to be convenient for use as <i>top-level</i> forms, rather than as
forms embedded within other forms in the way that (+ 3 4) is embedded within
(if p (+ 3 4) 6). These top-level special forms may be used to deﬁne globally
named functions, to deﬁne macros, to make declarations, and to deﬁne global
values for special variables.
<!--l. 1353--><p class="indent" >   Стандартный путь взаимодействия с реализацией Common Lisp через
<i>read-eval-print loop</i> <i>цикл чтение-выполнение-печать</i>: система повторно
читает форму из некоторого источника ввода (клавиатура, файл), выполняет
ее, затем выводит результат(ы) в некоторое устройство вывода (дисплей,
другой файл). Допускается любая форма (выполняемый объект данных),
однако существуют некоторые формы разработанные для удобного
применения в качестве форм <i>верхнего уровня</i>. Эти специальные формы
верхнего уровня могут использоваться для определения глобальных функции
(globally named functions), макросов, создания деклараций и определения
глобальных значений для специальных переменных.
<div class=obsolete>
<!--l. 1365--><p class="indent" >   It is not illegal to use these forms at other than top level, but whether it is
meaningful to do so depends on context. Compilers, for example, may
not recognize these forms properly in other than top-level contexts. (As
a special case, however, if a <a 
href="clmse38.html#x50-158002r80">progn</a> form appears at top level, then all
forms within that <a 
href="clmse38.html#x50-158002r80">progn</a> are considered by the compiler to be top-level
forms.)
</div>
<!--l. 1374--><p class="indent" >
                                                                          

                                                                          
<div class=newer>
<!--l. 1377--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx40-125001"></a>to clarify that, while deﬁning forms normally
appear at top level, it is meaningful to place them in non-top-level contexts. All
deﬁning forms that create functional objects from code appearing as argument
forms must ensure that such argument forms refer to the enclosing lexical
environment. Compilers must handle deﬁning forms properly in all situations, not
just top-level contexts. However, certain compile-time side eﬀects of these deﬁning
forms are performed only when the deﬁning forms occur at top level (see
section <a 
href="clmse127.html#x157-77100025.1">25.1<!--tex4ht:ref: COMPILER-SECTION --></a>).
</div>
<div class=incompatibility>
<!--l. 1390--><p class="noindent" ><span class="paragraphHead"><a 
 id="x40-1260005.3"></a></span>
   <b>Compatibility note:</b> In MacLisp, a top-level <a 
href="clmse38.html#x50-158002r80">progn</a> is considered to contain
top-level forms only if the ﬁrst form is (quote compile). This odd marker is
unnecessary in Common Lisp.
<!--l. 1394--><p class="noindent" ><span class="paragraphHead"><a 
 id="x40-1270005.3"></a>
<!--l. 1394--><p class="indent" >   </span>
   incompatibility
</div>
<!--l. 1397--><p class="indent" >   Macros are usually deﬁned by using the special form <a 
href="clmse46.html#x59-220002r137">defmacro</a>. This facility is
fairly complicated; it is described in chapter <a 
href="clmch8.html#x58-2170008">8<!--tex4ht:ref: MACROS --></a>.
<!--l. 1400--><p class="indent" >   Макросы обычно определяются с помощью специальной формы
<a 
href="clmse46.html#x59-220002r137">defmacro</a>. Этот механизм достаточно сложен. Для подробностей смотрите
главу <a 
href="clmch8.html#x58-2170008">8<!--tex4ht:ref: MACROS --></a>.
<!--l. 1404--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.3.1   </span> <a 
 id="x40-1280005.3.1"></a>Deﬁning Named Functions Определение именованных функций</h4>
<!--l. 1406--><p class="noindent" >The <a 
href="#x40-78002r13">defun</a> special form is the usual means of deﬁning named functions.
<!--l. 1408--><p class="indent" >   Специальная форма <a 
href="#x40-78002r13">defun</a> обычно обозначает определение именованных
функций.
<div class=defmac>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> defun </b><a 
 id="dx40-128001"></a><a 
 id="x40-128002r13"></a> name lambda-list  [[ {declaration}*  | doc-string]]  { form}*
</td></tr></table>
<!--l. 1412--><p class="indent" >
</div>
<!--l. 1412--><p class="noindent" ><span class="paragraphHead"><a 
 id="x40-1290005.3.1"></a></span>
   Evaluating a <a 
href="#x40-78002r13">defun</a> form causes the symbol <i>name</i> to be a global name for the
function speciﬁed by the lambda-expression <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(lambda <i>lambda-list</i> {<i><i>declaration</i> | <i>doc-string</i></i>}*  {<i><i> form</i></i>}* )
</td></tr></table>
<!--l. 1417--><p class="indent" >
</div>
</div>
<!--l. 1418--><p class="noindent" >deﬁned in the lexical environment in which the <a 
href="#x40-78002r13">defun</a> form was executed. Because
<a 
href="#x40-78002r13">defun</a> forms normally appear at top level, this is normally the null lexical
environment.
<!--l. 1422--><p class="indent" >   Выполнение формы <a 
href="#x40-78002r13">defun</a> приводит к тому, что символ <i>name</i> становиться
глобальным именем для функции определенной лямбда-выражением. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(lambda <i>lambda-list</i> {<i><i>declaration</i> | <i>doc-string</i></i>}*  {<i><i> form</i></i>}* )
</td></tr></table>
<!--l. 1426--><p class="indent" >
</div>
</div>
<!--l. 1427--><p class="noindent" >определеяется в лексическом окружении, в котором выполнялась форма
<a 
href="#x40-78002r13">defun</a>. А так как формы <a 
href="#x40-78002r13">defun</a> обычно выполняются на самом верхнем
уровне, лямбда-выражение обычно выполняется в нулевом лексическом
окружении.
<div class=newer>
                                                                          

                                                                          
<!--l. 1432--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx40-129001"></a>to clarify that, while deﬁning forms normally
appear at top level, it is meaningful to place them in non-top-level contexts; <a 
href="#x40-78002r13">defun</a>
must deﬁne the function within the enclosing lexical environment, not within the
null lexical environment.
</div>
<div class=newer>
<!--l. 1441--><p class="indent" >   X3J13 voted in March 1989 <a 
 id="dx40-129002"></a>to extend <a 
href="#x40-78002r13">defun</a> to accept any function-name (a
symbol or a list whose <i>car</i> is <a 
href="clmse36.html#x48-142002r66">setf</a>—see section <a 
href="clmse35.html#x47-1270007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>) as a <i>name</i>. Thus one may write
<div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun (setf cadr) ...)
</td></tr></table>
<!--l. 1448--><p class="indent" >
</div>
</div>
<!--l. 1449--><p class="noindent" >to deﬁne a <a 
href="clmse36.html#x48-142002r66">setf</a> expansion function for <a 
href="clmse86.html#x106-460004r447">cadr</a> (although it may be much more
convenient to use <a 
href="clmse36.html#x48-147003r71">defsetf</a> or <a 
href="clmse36.html#x48-146006r70">deﬁne-modify-macro</a>).
<!--l. 1454--><p class="indent" >   <a 
href="#x40-78002r13">defun</a> была расширена для того, чтобы могла принимать любое имя
функции (символ или список, car которого равен <a 
href="clmse36.html#x48-142002r66">setf</a>—смотрите раздел <a 
href="clmse35.html#x47-1270007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>) в
качестве <i>name</i>. Так теперь можно записать <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun (setf cadr) ...)
</td></tr></table>
<!--l. 1460--><p class="indent" >
</div>
</div>
<!--l. 1461--><p class="noindent" >для определения <a 
href="clmse36.html#x48-142002r66">setf</a>-определения для функции <a 
href="clmse86.html#x106-460004r447">cadr</a>. Это более удобно, чем
использование <a 
href="clmse36.html#x48-147003r71">defsetf</a> или <a 
href="clmse36.html#x48-146006r70">deﬁne-modify-macro</a>.
</div>
<!--l. 1465--><p class="indent" >
                                                                          

                                                                          
<!--l. 1467--><p class="indent" >   If the optional documentation string <i>doc-string</i> is present, then it is attached
to the <i>name</i> as a documentation string of type <a 
href="clmse35.html#x47-129006r54">function</a>; see <a 
href="clmse151.html#x184-949017r932">documentation</a>. If
<i>doc-string</i> is not followed by a declaration, it may be present only if at least one
<i>form</i> is also speciﬁed, as it is otherwise taken to be a <i>form</i>. It is an error if more
than one <i>doc-string</i> is present.
<!--l. 1476--><p class="indent" >   Если указана необязательная строка документации <i>doc-string</i>, тогда они
присоединяется к символу <i>name</i> в качестве строки документации типа
<a 
href="clmse35.html#x47-129006r54">function</a>, смотрите <a 
href="clmse151.html#x184-949017r932">documentation</a>. Если после <i>doc-string</i> нет деклараций,
строка документации может быть использована только при условии
существования хотя бы одной формы после нее, иначе она будет использована в
качестве <i>form</i> функции. Указывать более чем одну <i>doc-string</i> является
ошибкой.
<!--l. 1483--><p class="indent" >   The <i>forms</i> constitute the body of the deﬁned function; they are executed as an
implicit <a 
href="clmse38.html#x50-158002r80">progn</a>.
<i>
<!--l. 1486--><p class="indent" >   forms</i> составляют тело определяемой функции. Они выполняются как
неявный <a 
href="clmse38.html#x50-158002r80">progn</a>.
<!--l. 1488--><p class="indent" >   The body of the deﬁned function is implicitly enclosed in a <a 
href="clmse41.html#x53-180002r103">block</a> construct
whose name is the same as the <i>name</i> of the function. Therefore <a 
href="clmse41.html#x53-181002r104">return-from</a> may
be used to exit from the function.
<!--l. 1493--><p class="indent" >   Тело оперделяемой функции неявно заключается в конструкцию <a 
href="clmse41.html#x53-180002r103">block</a>,
имя которой совпадает с <i>именем (name)</i> функции. Таким образом <a 
href="clmse41.html#x53-181002r104">return-from</a>
может быть использовано для выхода из функции.
<!--l. 1497--><p class="indent" >   Other implementation-dependent bookkeeping actions may be taken as
well by <a 
href="#x40-78002r13">defun</a>. The <i>name</i> is returned as the value of the <a 
href="#x40-78002r13">defun</a> form. For
example:
<!--l. 1502--><p class="indent" >   Другие учетные действия специальные для некоторой реализации могут
также выполнятся в <a 
href="#x40-78002r13">defun</a>. <i>name</i> возвращается в качестве значения формы
<a 
href="#x40-78002r13">defun</a>. Например:
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun discriminant (a b c)
</td></tr></table>
<!--l. 1508--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (number a b c))</td></tr></table>
<!--l. 1509--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  &#x0022;Compute the discriminant for a quadratic equation.</td></tr></table>
<!--l. 1510--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   Given a, b, and c, the value b̂2-4*a*c is calculated.</td></tr></table>
                                                                          

                                                                          
<!--l. 1511--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   The quadratic equation a*x̂2+b*x+c=0 has real, multiple,</td></tr></table>
<!--l. 1512--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   or complex roots depending on whether this calculated</td></tr></table>
<!--l. 1513--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   value is positive, zero, or negative, respectively.&#x0022;</td></tr></table>
<!--l. 1514--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (- (* b b) (* 4 a c)))</td></tr></table>
<!--l. 1515--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ discriminant</td></tr></table>
<!--l. 1516--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   and now (discriminant 1 2/3 -2)  ⇒ 76/9</td></tr></table>
<!--l. 1518--><p class="indent" >
</div>
</div>
<div class=new>
<!--l. 1520--><p class="noindent" >The documentation string in this example neglects to mention that the coeﬃcients a,
b, and c must be real for the discrimination criterion to hold. Here is an improved
version: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  &#x0022;Compute the discriminant for a quadratic equation.
</td></tr></table>
<!--l. 1525--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   Given a, b, and c, the value b̂2-4*a*c is calculated.</td></tr></table>
<!--l. 1526--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   If the coeﬃcients a, b, and c are all real (that is,</td></tr></table>
<!--l. 1527--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   not complex), then the quadratic equation a*x̂2+b*x+c=0</td></tr></table>
<!--l. 1528--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   has real, multiple, or complex roots depending on</td></tr></table>
<!--l. 1529--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   whether this calculated value is positive, zero, or</td></tr></table>
<!--l. 1530--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   negative, respectively.&#x0022;</td></tr></table>
<!--l. 1532--><p class="indent" >
</div>
</div>
</div>
<!--l. 1535--><p class="indent" >   It is permissible to use <a 
href="#x40-78002r13">defun</a> to redeﬁne a function, to install a corrected
version of an incorrect deﬁnition, for example. It is permissible to redeﬁne a macro
as a function. It is an error to attempt to redeﬁne the name of a special form (see
table <a 
href="clmse28.html#x38-690011">5.1<!--tex4ht:ref: SPECIAL-FORM-TABLE --></a>) as a function.
<!--l. 1541--><p class="indent" >   Пользователю разрешено использовать <a 
href="#x40-78002r13">defun</a> для переопределения
функции, например, для установки корректной версии некорректного
определения. Пользователю также разрешено переопределять макрос на
функцию. Однако является ошибкой, попытка переопределить имя
специальной формы (смотрите таблицу <a 
href="clmse28.html#x38-690011">5.1<!--tex4ht:ref: SPECIAL-FORM-TABLE --></a>) на функцию.
</div>
                                                                          

                                                                          
   <h4 class="subsectionHead"><span class="titlemark">5.3.2   </span> <a 
 id="x40-1300005.3.2"></a>Declaring Global Variables and Named Constants Определение
глобальных переменных и констант</h4>
<!--l. 1551--><p class="noindent" >The <a 
href="#x40-80002r14">defvar</a> and <a 
href="#x40-80004r15">defparameter</a> special forms are the usual means of specifying
globally deﬁned variables. The <a 
href="#x40-80006r16">defconstant</a> special form is used for deﬁning named
constants.
<!--l. 1555--><p class="indent" >   Специальные формы <a 
href="#x40-80002r14">defvar</a> и <a 
href="#x40-80004r15">defparameter</a> используются для определения
глобально определенных переменных. Специальная форма <a 
href="#x40-80006r16">defconstant</a>
используется для определения констант.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Macro]</i><b> defvar </b><a 
 id="dx40-130001"></a><a 
 id="x40-130002r14"></a> name [initial-value [documentation]]
</td></tr></table>
<!--l. 1560--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i><b> defparameter </b><a 
 id="dx40-130003"></a><a 
 id="x40-130004r15"></a> name initial-value [documentation]</td></tr></table>
<!--l. 1561--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i><b> defconstant </b><a 
 id="dx40-130005"></a><a 
 id="x40-130006r16"></a> name initial-value [documentation]</td></tr></table>
<!--l. 1563--><p class="indent" >
</div>
<!--l. 1563--><p class="noindent" ><span class="paragraphHead"><a 
 id="x40-1310005.3.2"></a></span>
   <a 
href="#x40-80002r14">defvar</a> is the recommended way to declare the use of a special variable in a
program. <a 
href="#x40-80002r14">defvar</a> рекомендуется для декларации использования в программе
специальных переменных. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar <i>variable</i>)
</td></tr></table>
<!--l. 1570--><p class="indent" >
</div>
</div>
<!--l. 1571--><p class="noindent" >proclaims <i>variable</i> to be special (see <a 
href="clmse51.html#x65-243002r156">proclaim</a>), and may perform other
system-dependent bookkeeping actions.
<!--l. 1574--><p class="indent" >   указывает на то, что переменная <i>variable</i> будет специальной (special)
(смотрите <a 
href="clmse51.html#x65-243002r156">proclaim</a>), и может выполнять некоторые учетные действия,
зависимые от реализации.
                                                                          

                                                                          
<div class=newer>
<!--l. 1579--><p class="indent" >   X3J13 voted in June 1987 <a 
 id="dx40-131001"></a>to clarify that if no <i>initial-value</i> form is
provided, <a 
href="#x40-80002r14">defvar</a> does not change the value of the <i>variable</i>; if no <i>initial-value</i>
form is provided and the variable has no value, <a 
href="#x40-80002r14">defvar</a> does not give it a
value.
</div> If a second argument form is supplied,
<!--l. 1587--><p class="indent" >   Если для формы указан второй аргумент, <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar <i>variable</i> <i>initial-value</i>)
</td></tr></table>
<!--l. 1590--><p class="indent" >
</div>
</div>
<!--l. 1591--><p class="noindent" >then <i>variable</i> is initialized to the result of evaluating the form <i>initial-value</i> unless it
already has a value. The <i>initial-value</i> form is not evaluated unless it is used; this
fact is useful if evaluation of the <i>initial-value</i> form does something expensive like
creating a large data structure.
<!--l. 1597--><p class="indent" >   тогда переменная <i>variable</i>, если она еще не была проинициализирована,
инициализируется результатом выполнения формы <i>initial-value</i>. Форма
<i>initial-value</i> не выполняется, если в этом нет необходимости. Это полезно,
если форма <i>initial-value</i> выполняет что-то трудоемкое, как, например,
создание большого структуры данных.
<div class=newer>
<!--l. 1604--><p class="indent" >   X3J13 voted in June 1987 <a 
 id="dx40-131002"></a>to clarify that evaluation of the <i>initial-value</i> and the
initialization of the variable occur, if at all, at the time the <a 
href="#x40-80002r14">defvar</a> form is
executed, and that the <i>initial-value</i> form is evaluated if and only if the <i>variable</i>
does not already have a value.
</div> The initialization is performed by assignment and thus assigns a global value to
the variable unless there are currently special bindings of that variable. Normally
there should not be any such special bindings.
<!--l. 1615--><p class="indent" >   Инициализация производится присвоением глобального значения
переменной, если только не существует специального связывания этой
переменной. Обычно, такого связывания быть не должно. FIXME.
<!--l. 1619--><p class="indent" >   <a 
href="#x40-80002r14">defvar</a> also provides a good place to put a comment describing the meaning of
the variable, whereas an ordinary special proclamation oﬀers the temptation to
declare several variables at once and not have room to describe them
all.
                                                                          

                                                                          
<!--l. 1625--><p class="indent" >   <a 
href="#x40-80002r14">defvar</a> также предоставляют хорошее место для комметария описывающего
значение переменной, тогда как обычное special указание соблазняет
задекларировать несколько переменных за один раз и не предоставляет
возможности прокомментировать их.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *visible-windows* 0
</td></tr></table>
<!--l. 1631--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  &#x0022;Number of windows at least partially visible on the screen&#x0022;)</td></tr></table>
<!--l. 1633--><p class="indent" >
</div>
</div>
<!--l. 1635--><p class="indent" >   <a 
href="#x40-80004r15">defparameter</a> is similar to <a 
href="#x40-80002r14">defvar</a>, but <a 
href="#x40-80004r15">defparameter</a> requires an <i>initial-value</i>
form, always evaluates the form, and assigns the result to the variable. The
semantic distinction is that <a 
href="#x40-80002r14">defvar</a> is intended to declare a variable changed by the
program, whereas <a 
href="#x40-80004r15">defparameter</a> is intended to declare a variable that is normally
constant but can be changed (possibly at run time), where such a change is
considered a change <i>to</i> the program. <a 
href="#x40-80004r15">defparameter</a> therefore does not
indicate that the quantity <i>never</i> changes; in particular, it does not license
the compiler to build assumptions about the value into programs being
compiled.
<!--l. 1647--><p class="indent" >   <a 
href="#x40-80004r15">defparameter</a> подобен <a 
href="#x40-80002r14">defvar</a>, но <a 
href="#x40-80004r15">defparameter</a> требует обязательной формы
<i>initial-value</i>, и всего выполняет эту форму, и присваивает результат
переменной. Семантическое различие заключается в том, что <a 
href="#x40-80002r14">defvar</a>
предназначена декларировать переменную, изменяемую программой, тогда
как <a 
href="#x40-80004r15">defparameter</a> предназначена для декларации переменной, как константы,
которая может быть изменена (и во время выполнения программы), для
изменения поведения программы. Таким образом <a 
href="#x40-80004r15">defparameter</a> не указывает,
что количество никогда не изменяется, в частности, она не разрешает
компилятору предположить то, что значение может быть вкомпилировано в
программу.
<!--l. 1658--><p class="indent" >   <a 
href="#x40-80006r16">defconstant</a> is like <a 
href="#x40-80004r15">defparameter</a> but <i>does</i> assert that the value of the variable
<i>name</i> is ﬁxed and does license the compiler to build assumptions about the value
into programs being compiled. (However, if the compiler chooses to replace
references to the name of the constant by the value of the constant in
                                                                          

                                                                          
code to be compiled, perhaps in order to allow further optimization, the
compiler must take care that such “copies” appear to be <a 
href="clmse33.html#x44-118003r47">eql</a> to the object
that is the actual value of the constant. For example, the compiler may
freely make copies of numbers but must exercise care when the value is a
list.)
<!--l. 1669--><p class="indent" >   <a 
href="#x40-80006r16">defconstant</a> похожа на <a 
href="#x40-80004r15">defparameter</a>, но в отличие от последней, указывает,
что значение переменной <i>name</i> фиксировано и позволяет компилятору
предположить, что значение может быть вкомпилировано в программу.
Однако, если компилятор выбирает путь замены ссылок на имя константы на
значения этой константы в компилируемом коде для оптимизации, он
должен позаботиться о том, чтобы такие «копии» были эквивалентны <a 
href="clmse33.html#x44-118003r47">eql</a>
объектам-значениям констант. Например, компилятор может спокойно
копировать числа, но должен позаботиться об этом правиле, если значение
константы является списком.
<!--l. 1679--><p class="indent" >   It is an error if there are any special bindings of the variable at the time the
<a 
href="#x40-80006r16">defconstant</a> form is executed (but implementations may or may not check for
this).
<!--l. 1683--><p class="indent" >   Если для переменной на момент вызова формы <a 
href="#x40-80006r16">defconstant</a> существует
специальные связывания, то возникает ошибка (но реализации могут
проверять, а могут и не проверять этот факт).
<!--l. 1687--><p class="indent" >   Once a name has been declared by <a 
href="#x40-80006r16">defconstant</a> to be constant, any further
assignment to or binding of that special variable is an error. This is the case for
such system-supplied constants as <a 
href="clmse31.html#x42-87002r20">t</a> and <a 
href="clmse75.html#x92-383002r321">most-positive-ﬁxnum</a>. A compiler may
also choose to issue warnings about bindings of the lexical variable of the same
name.
<!--l. 1694--><p class="indent" >   Если имя задекларировано с помощью <a 
href="#x40-80006r16">defconstant</a> быть константой,
последующие присваивания и связывания данной специальной переменной
будут являются ошибкой. Это справедливо для системозависимых
констант, например, <a 
href="clmse31.html#x42-87002r20">t</a> и <a 
href="clmse75.html#x92-383002r321">most-positive-ﬁxnum</a>. Компилятор может также
сигнализировать о связывании лексической переменной с одинаковым
именем.
<div class=new>
<!--l. 1702--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx40-131003"></a>to clarify the preceding paragraph by specifying
that it is an error to rebind constant symbols as either lexical or special variables.
Consequently, a valid reference to a symbol declared with <a 
href="#x40-80006r16">defconstant</a> always
refers to its global value. (Unfortunately, this violates the principle of referential
transparency, for one cannot always choose names for lexical variables without
regard to surrounding context.)
                                                                          

                                                                          
</div>
<!--l. 1714--><p class="indent" >   For any of these constructs, the documentation should be a string. The string
is attached to the name of the variable, parameter, or constant under the variable
documentation type; see the <a 
href="clmse151.html#x184-949017r932">documentation</a> function.
<!--l. 1720--><p class="indent" >   Для любой из этих конструкций, документация должна быть строкой.
Строка присоединяется к имени переменной, параметра или константы как
тип документации variable, смотрите функцию <a 
href="clmse151.html#x184-949017r932">documentation</a>.
<div class=new>
<!--l. 1725--><p class="indent" >   X3J13 voted in March 1988 <a 
 id="dx40-131004"></a>to clarify that the <i>documentation-string</i> is not
evaluated but must appear as a literal string when the <a 
href="#x40-80002r14">defvar</a>, <a 
href="#x40-80004r15">defparameter</a>, or
<a 
href="#x40-80006r16">defconstant</a> form is evaluated.
<!--l. 1731--><p class="indent" >   For example, the form
<!--l. 1734--><p class="indent" >   Например, форма
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *avoid-registers* nil &#x0022;Compilation control switch #43&#x0022;)
</td></tr></table>
<!--l. 1738--><p class="indent" >
</div>
</div>
<!--l. 1740--><p class="indent" >   is legitimate, but
<!--l. 1742--><p class="indent" >   законна, но
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *avoid-registers* nil
</td></tr></table>
<!--l. 1745--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format nil &#x0022;Compilation control switch #~D&#x0022;</td></tr></table>
<!--l. 1746--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (incf *compiler-switch-number*)))</td></tr></table>
<!--l. 1748--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 1750--><p class="indent" >   is erroneous because the call to <a 
href="clmse117.html#x144-694003r730">format</a> is not a literal string.
<!--l. 1752--><p class="indent" >   ошибочна, так как вызов <a 
href="clmse117.html#x144-694003r730">format</a> не является дословно строкой.
<!--l. 1754--><p class="indent" >   (On the other hand, the form
<!--l. 1756--><p class="indent" >   С другой стороны, форма
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *avoid-registers* nil
</td></tr></table>
<!--l. 1759--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  #.(format nil &#x0022;Compilation control switch #~D&#x0022;</td></tr></table>
<!--l. 1760--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (incf *compiler-switch-number*)))</td></tr></table>
<!--l. 1762--><p class="indent" >
</div>
</div>
<!--l. 1764--><p class="indent" >   might be used to accomplish the same purpose, because the call to <a 
href="clmse117.html#x144-694003r730">format</a> is
evaluated at <a 
href="clmse116.html#x143-664003r696">read</a> time; when the <a 
href="#x40-80002r14">defvar</a> form is evaluated, only the result of the
call to <a 
href="clmse117.html#x144-694003r730">format</a>, a string, appears in the <a 
href="#x40-80002r14">defvar</a> form.)
<!--l. 1769--><p class="indent" >   Может использоваться для вышеназванной цели, потому что вызов
<a 
href="clmse117.html#x144-694003r730">format</a> выполняется на во время чтения кода <a 
href="clmse116.html#x143-664003r696">read</a>, когда форма <a 
href="#x40-80002r14">defvar</a>
выполняется, в ней указана строка, которая являлась результатом вызова
<a 
href="clmse117.html#x144-694003r730">format</a>.
</div>
<!--l. 1776--><p class="indent" >   These constructs are normally used only as top-level forms. The value returned
by each of these constructs is the <i>name</i> declared.
<!--l. 1779--><p class="indent" >   Эти конструкции обычно используются только как формы верхнего
уровня. Значения возвращаемые каждой из этих конструкций это
задекларированные имена <i>name</i>.
</div>
<!--l. 1783--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.3.3   </span> <a 
 id="x40-1320005.3.3"></a>Control of Time of Evaluation Контроль времени выполнения</h4>
<div class=obsolete>
<!--l. 1786--><p class="noindent" >The <a 
href="#x40-83003r18">eval-when</a> special form allows pieces of code to be executed only at compile
time, only at load time, or when interpreted but not compiled. Its uses are
                                                                          

                                                                          
relatively esoteric.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> eval-when </b><a 
 id="dx40-132001"></a><a 
 id="x40-132002r17"></a> ( {situation}* )  { form}*
</td></tr></table>
<!--l. 1792--><p class="indent" >
</div>
<!--l. 1792--><p class="noindent" ><span class="paragraphHead"><a 
 id="x40-1330005.3.3"></a></span>
   The body of an <a 
href="#x40-83003r18">eval-when</a> form is processed as an implicit <a 
href="clmse38.html#x50-158002r80">progn</a>, but only in
the situations listed. Each <i>situation</i> must be a symbol, either <a 
href="clmse127.html#x157-771003r797">compile</a>, <a 
href="clmse122.html#x150-745002r778">load</a>, or
<a 
href="clmse110.html#x135-586002r620">eval</a>.
<!--l. 1797--><p class="indent" >   <a 
href="clmse110.html#x135-586002r620">eval</a> speciﬁes that the interpreter should process the body. <a 
href="clmse127.html#x157-771003r797">compile</a> speciﬁes
that the compiler should evaluate the body at compile time in the compilation
context. <a 
href="clmse122.html#x150-745002r778">load</a> speciﬁes that the compiler should arrange to evaluate the
forms in the body when the compiled ﬁle containing the <a 
href="#x40-83003r18">eval-when</a> form is
loaded.
<!--l. 1804--><p class="indent" >   The <a 
href="#x40-83003r18">eval-when</a> construct may be more precisely understood in terms of a
model of how the compiler processes forms in a ﬁle to be compiled. Successive
forms are read from the ﬁle using the function <a 
href="clmse116.html#x143-664003r696">read</a>. These top-level forms are
normally processed in what we shall call <i>not-compile-time</i> mode. There is another
mode called <i>compile-time-too</i> mode. The <a 
href="#x40-83003r18">eval-when</a> special form controls which of
these two modes to use.
<!--l. 1813--><p class="indent" >   Every form is processed as follows:
      <ul class="itemize1">
      <li class="itemize">If the form is an <a 
href="#x40-83003r18">eval-when</a> form:
           <ul class="itemize2">
           <li class="itemize">If the situation <a 
href="clmse122.html#x150-745002r778">load</a> is speciﬁed:
               <ul class="itemize3">
               <li class="itemize">If  the  situation  <a 
href="clmse127.html#x157-771003r797">compile</a>  is  speciﬁed,  <i>or</i>  if  the  current
               processing mode is <i>compile-time-too</i> and the situation <a 
href="clmse110.html#x135-586002r620">eval</a>
               is speciﬁed, then process each of the forms in the body in
               <i>compile-time-too</i> mode.
                                                                          

                                                                          
               </li>
               <li class="itemize">Otherwise,  process  each  of  the  forms  in  the  body  in
               <i>not-compile-time</i> mode.</li></ul>
           </li>
           <li class="itemize">If the situation <a 
href="clmse122.html#x150-745002r778">load</a> is not speciﬁed:
               <ul class="itemize3">
               <li class="itemize">If  the  situation  <a 
href="clmse127.html#x157-771003r797">compile</a>  is  speciﬁed,  <i>or</i>  if  the  current
               processing mode is <i>compile-time-too</i> and the situation <a 
href="clmse110.html#x135-586002r620">eval</a> is
               speciﬁed, then evaluate each of the forms in the body in the
               compiler&#x2019;s executing environment.
               </li>
               <li class="itemize">Otherwise, ignore the <a 
href="#x40-83003r18">eval-when</a> form entirely.</li></ul>
           </li></ul>
      </li>
      <li class="itemize">If the form is not an <a 
href="#x40-83003r18">eval-when</a> form, then do two things. First, if the
      current processing mode is <i>compile-time-too</i> mode, evaluate the form in the
      compiler&#x2019;s executing environment. Second, perform normal compiler
      processing of the form (compiling functions deﬁned by <a 
href="#x40-78002r13">defun</a> forms, and so
      on).</li></ul>
<!--l. 1853--><p class="indent" >   One example of the use of <a 
href="#x40-83003r18">eval-when</a> is that if the compiler is to be able to
properly read a ﬁle that uses user-deﬁned reader macro characters, it is necessary
to write <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (compile load eval)
</td></tr></table>
<!--l. 1858--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (set-macro-character #\$ #&#x2019;(lambda (stream char)</td></tr></table>
<!--l. 1859--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                               (declare (ignore char))</td></tr></table>
<!--l. 1860--><p class="indent" >         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                               (list &#x2019;dollar (read stream)))))</td></tr></table>
<!--l. 1862--><p class="indent" >
</div>
</div>
<!--l. 1863--><p class="noindent" >This causes the call to <a 
href="clmse115.html#x142-646004r678">set-macro-character</a> to be executed in the compiler&#x2019;s execution
environment, thereby modifying its reader syntax table.
</div>
                                                                          

                                                                          
</div>
<div class=newer>
<!--l. 1870--><p class="noindent" >X3J13 voted in March 1989 <a 
 id="dx40-133001"></a>to completely redesign the <a 
href="#x40-83003r18">eval-when</a> construct to
solve some problems concerning its treatment in other than top-level contexts.
The new deﬁnition is upward compatible with the old deﬁnition, but the old
keywords are deprecated.
<!--l. 1876--><p class="indent" >   <a 
href="#x40-83003r18">eval-when</a> была переработан для разрешения некоторых проблем,
касательно ее использования в отличных от контекста верхнего уровня.
Новое определение совместимо со старым, но старые ключевые символы были
упразднены.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Special form]</i><b> eval-when </b><a 
 id="dx40-133002"></a><a 
 id="x40-133003r18"></a> ( {situation}* )  { form}*
</td></tr></table>
<!--l. 1882--><p class="indent" >
</div>
<!--l. 1882--><p class="noindent" ><span class="paragraphHead"><a 
 id="x40-1340005.3.3"></a></span>
   The body of an <a 
href="#x40-83003r18">eval-when</a> form is processed as an implicit <a 
href="clmse38.html#x50-158002r80">progn</a>, but only in
the situations listed. Each <i>situation</i> must be a symbol, either :compile-toplevel,
:load-toplevel, or :execute.
<!--l. 1889--><p class="indent" >   Тело формы <a 
href="#x40-83003r18">eval-when</a> выполняется как неявный <a 
href="clmse38.html#x50-158002r80">progn</a>, но только в ниже
перечисленных ситуациях. Каждая ситуация <i>situatuon</i> должна быть одним
символов, :compile-toplevel, :load-toplevel или :execute.
<!--l. 1893--><p class="indent" >   The use of :compile-toplevel and :load-toplevel controls whether and when
processing occurs for top-level forms. The use of :execute controls whether
processing occurs for non-top-level forms.
<!--l. 1899--><p class="indent" >   Использование :compile-toplevel и :load-toplevel контролирует, что и
когда выполняется для форм верхнего уровня. Использование :execute
контролирует будет ли производится выполнения форм не верхнего
уровня.
<!--l. 1904--><p class="indent" >   The <a 
href="#x40-83003r18">eval-when</a> construct may be more precisely understood in terms of a
model of how the ﬁle compiler, <a 
href="clmse127.html#x157-773003r799">compile-ﬁle</a>, processes forms in a ﬁle to be
compiled.
                                                                          

                                                                          
<!--l. 1909--><p class="indent" >   Конструкция <a 
href="#x40-83003r18">eval-when</a> может быть более понятна в терминах модели
того, как компилятор файлов, <a 
href="clmse127.html#x157-773003r799">compile-ﬁle</a>, выполняет формы в файле для
компиляции.
<!--l. 1914--><p class="indent" >   Successive forms are read from the ﬁle by the ﬁle compiler using <a 
href="clmse116.html#x143-664003r696">read</a>. These
top-level forms are normally processed in what we call “not-compile-time” mode.
There is one other mode, called “compile-time-too” mode, which can come into
play for top-level forms. The <a 
href="#x40-83003r18">eval-when</a> special form is used to annotate a program
in a way that allows the program doing the processing to select the appropriate
mode.
<!--l. 1923--><p class="indent" >   Формы следующие друг за другом читаются из файла с помощью
компилятора файла используя <a 
href="clmse116.html#x143-664003r696">read</a>. Эти формы верхнего уровня обычно
обрабатываются в том, что мы называем режим «времени некомпиляции
(not-compile-time mode)». Существует и другой режим, называемый режим
«времени-компиляции (compile-time-too mode)», которые вступает в игру для
форм верхнего уровня. Специальная форма <a 
href="#x40-83003r18">eval-when</a> используется для
аннотации программы таким образом, чтобы предоставить программе,
осуществлять выбор режима.
<!--l. 1931--><p class="indent" >   Processing of top-level forms in the ﬁle compiler works as follows:
<!--l. 1934--><p class="indent" >   Обработка форм верхнего уровня в компиляторе файла работает так, как
рассказано ниже:
      <ul class="itemize1">
      <li class="itemize">If the form is a macro call, it is expanded and the result is processed
      as a top-level form in the same processing mode (compile-time-too or
      not-compile-time).
      </li>
      <li class="itemize">Если          форма          является          макровызовом,          она
      разворачивается и результат обрабатывается, как форма верхнего
      уровня  в  том  же  режиме  обработки  (времени-компиляции  или
      времени-некомпиляции, (compile-time-too или not-compile-time).
      </li>
      <li class="itemize">If the form is a <a 
href="clmse38.html#x50-158002r80">progn</a> (or <a 
href="clmse51.html#x65-242004r155">locally</a> <a 
 id="dx40-134001"></a>) form, each of its body forms is
      sequentially processed as top-level forms in the same processing mode.
      </li>
      <li class="itemize">Если  форма  <a 
href="clmse38.html#x50-158002r80">progn</a>  (или  <a 
href="clmse51.html#x65-242004r155">locally</a>),  каждая  из  форм  из  их  тел
                                                                          

                                                                          
      обрабатываются, как формы верхнего уровня в том же режиме
      обработки.
      </li>
      <li class="itemize">If the form is a <a 
href="clmse39.html#x51-167003r88">compiler-let</a>, <a 
href="clmse39.html#x51-170010r95">macrolet</a>, or <a 
href="clmse39.html#x51-171002r96">symbol-macrolet</a>, the ﬁle
      compiler makes the appropriate bindings and recursively processes the
      body forms as an implicit top-level <a 
href="clmse38.html#x50-158002r80">progn</a> with those bindings in eﬀect,
      in the same processing mode.
      </li>
      <li class="itemize">Если форма <a 
href="clmse39.html#x51-167003r88">compiler-let</a>, <a 
href="clmse39.html#x51-170010r95">macrolet</a> или <a 
href="clmse39.html#x51-171002r96">symbol-macrolet</a>, компилятор
      файла                          создает                          соотвествующие
      связывания и рекурсивно обрабатывает тела форм, как неявный
      <a 
href="clmse38.html#x50-158002r80">progn</a> верхнего уровня в контексте установленных связей в том же
      режиме обработки.
      </li>
      <li class="itemize">If the form is an <a 
href="#x40-83003r18">eval-when</a> form, it is handled according to the following
      table:
      <div class="flushleft" 
>
<!--l. 1967--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" > LT</td><td align="left" >CT</td><td align="left" >EX</td><td align="left" >CTTM</td><td align="left" >Action                                           </td></tr><tr><td align="left" > yes</td> <td align="left" >yes</td> <td align="left" > – </td> <td align="left" > – </td> <td align="left" >process body in compile-time-too mode</td>
</tr><tr><td align="left" > yes</td><td align="left" > no </td><td align="left" >yes</td><td align="left" >   yes   </td><td align="left" >process body in compile-time-too mode</td>
</tr><tr><td align="left" > yes</td><td align="left" > no </td><td align="left" > – </td><td align="left" >   no   </td><td align="left" >process body in not-compile-time mode</td>
</tr><tr><td align="left" > yes</td><td align="left" > no </td><td align="left" > no </td><td align="left" >    –    </td><td align="left" >process body in not-compile-time mode</td>
</tr><tr><td align="left" > no</td><td align="left" >yes</td><td align="left" > – </td><td align="left" >    –    </td><td align="left" >evaluate body                                 </td>
</tr><tr><td align="left" > no</td><td align="left" > no </td><td align="left" >yes</td><td align="left" >   yes   </td><td align="left" >evaluate body                                 </td>
</tr><tr><td align="left" > no</td><td align="left" > no </td><td align="left" > – </td><td align="left" >   no   </td><td align="left" >do nothing                                      </td>
</tr><tr><td align="left" > no</td><td align="left" > no </td><td align="left" > no </td><td align="left" >    –    </td><td align="left" >do nothing                                      </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr><td align="left" >  </td>
</tr></table></div></div>
      <!--l. 1981--><p class="noindent" >In the preceding table the column LT asks whether :load-toplevel is one of
      the situations speciﬁed in the <a 
href="#x40-83003r18">eval-when</a> form; CT similarly refers to
      :compile-toplevel and EX to :execute. The column CTTM asks whether the
      <a 
href="#x40-83003r18">eval-when</a> form was encountered while in compile-time-too mode. The
      phrase “process body” means to process the body as an implicit top-level
      <a 
href="clmse38.html#x50-158002r80">progn</a> in the indicated mode, and “evaluate body” means to evaluate the
      body forms sequentially as an implicit <a 
href="clmse38.html#x50-158002r80">progn</a> in the dynamic execution
      context of the compiler and in the lexical environment in which the
      <a 
href="#x40-83003r18">eval-when</a> appears.
                                                                          

                                                                          
      </li>
      <li class="itemize">Если форма <a 
href="#x40-83003r18">eval-when</a>, она обрабатывается в соответствии со
      следующей таблицей:
      <div class="flushleft" 
>
<!--l. 1994--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" > LT</td><td align="left" >CT</td><td align="left" >EX</td><td align="left" >CTTM</td><td align="left" >Action                                                         </td></tr><tr><td align="left" > yes</td> <td align="left" >yes</td> <td align="left" > – </td> <td align="left" > – </td> <td align="left" >обработать тело в режиме время-компиляции</td>
</tr><tr><td align="left" > yes</td><td align="left" > no </td><td align="left" >yes</td><td align="left" >   yes   </td><td align="left" >обработать тело в режиме время-компиляции   </td>
</tr><tr><td align="left" > yes</td><td align="left" > no </td><td align="left" > – </td><td align="left" >   no   </td><td align="left" >обработать тело в режиме время-некомпиляции</td>
</tr><tr><td align="left" > yes</td><td align="left" > no </td><td align="left" > no </td><td align="left" >    –    </td><td align="left" >обработать тело в режиме время-некомпиляции</td></tr><tr><td align="left" >  no </td> <td align="left" >yes</td> <td align="left" > – </td> <td align="left" > – </td> <td align="left" >выполнить тело</td>
</tr><tr><td align="left" > no</td><td align="left" > no </td><td align="left" >yes</td><td align="left" >   yes   </td><td align="left" >выполнить тело                                            </td></tr><tr><td align="left" >  no </td> <td align="left" > no </td> <td align="left" > – </td> <td align="left" > no </td> <td align="left" >ничего не делать</td>
</tr><tr><td align="left" > no</td><td align="left" > no </td><td align="left" > no </td><td align="left" >    –    </td><td align="left" >ничего не делать                                           </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr><td align="left" >  </td>
</tr></table></div></div>
      <!--l. 2008--><p class="noindent" >В этой таблице столбец LT спрашивает присутствует ли :load-toplevel в
      ситуациях указанных в форме <a 
href="#x40-83003r18">eval-when</a>. CT соответственно указывает
      на :compile-toplevel и EX на :execute. Столбец CTTM спрашивает
      встречается ли форма <a 
href="#x40-83003r18">eval-when</a> в режиме времени-компиляции.
      Фраза «обработка тела» означает обработку последовательно
      форм тела, как неявного <a 
href="clmse38.html#x50-158002r80">progn</a> верхнего уровня в указанном
      режиме, и «выполнение тела» означает выполнение форм тела
      последовательно, как неявный <a 
href="clmse38.html#x50-158002r80">progn</a> в динамическом контексте
      выполнения компилятора и в лексическом окружении, в котором
      встретилась <a 
href="#x40-83003r18">eval-when</a>.
      </li>
      <li class="itemize">Otherwise, the form is a top-level form that is not one of the special cases. If
      in compile-time-too mode, the compiler ﬁrst evaluates the form and then
      performs normal compiler processing on it. If in not-compile-time mode,
      only normal compiler processing is performed (see section <a 
href="clmse127.html#x157-77100025.1">25.1<!--tex4ht:ref: COMPILER-SECTION --></a>). Any
      subforms are treated as non-top-level forms.
      </li>
      <li class="itemize">В противном случае, форма верхнего уровня, которая не представлена в
      специальных случаях. Если в режиме времени-компиляции, компилятор
      сначала выполняет форму и затем выполняет обычную обработку
      компилятором. Если установлен режим времени-некомпиляции,
      выполняется только обычная обработка компилятором (смотрите
      раздел <a 
href="clmse127.html#x157-77100025.1">25.1<!--tex4ht:ref: COMPILER-SECTION --></a>). Любые подформы обрабатываются как формы не
      верхнего уровня.</li></ul>
                                                                          

                                                                          
<!--l. 2033--><p class="indent" >   Note that top-level forms are guaranteed to be processed in the order in which
they textually appear in the ﬁle, and that each top-level form read by the
compiler is processed before the next is read. However, the order of processing
(including, in particular, macro expansion) of subforms that are not top-level
forms is unspeciﬁed.
<!--l. 2039--><p class="indent" >   Следует отметить, что формы верхнего уровня обрабатываются
гарантированно в порядке, в котором они текстово представлены в файле, и
каждая форма верхнего уровня прочтенная компилятором обрабатывается
перед тем, как следующая будет прочтена. Однако, порядок обработки
(включая, в частности, раскрытие макросов) подформ, которые не являются
формами верхнего уровня, не определен.
<!--l. 2046--><p class="indent" >   For an <a 
href="#x40-83003r18">eval-when</a> form that is not a top-level form in the ﬁle compiler (that is,
either in the interpreter, in <a 
href="clmse127.html#x157-771003r797">compile</a>, or in the ﬁle compiler but not at top level), if
the :execute situation is speciﬁed, its body is treated as an implicit <a 
href="clmse38.html#x50-158002r80">progn</a>.
Otherwise, the body is ignored and the <a 
href="#x40-83003r18">eval-when</a> form has the value
<a 
href="clmse31.html#x42-86002r19">nil</a>.
<!--l. 2052--><p class="indent" >   Для формы <a 
href="#x40-83003r18">eval-when</a>, которая не является формой верхнего уровня в
компиляторе файлов (то есть либо в интерпретаторе, либо <a 
href="clmse127.html#x157-771003r797">compile</a>,
либо в компиляторе файлов, но не на верхнем уровне), если указана
ситуация :execute, тело формы обрабатывается как неявный <a 
href="clmse38.html#x50-158002r80">progn</a>. В
противном случае, тело игнорируется и форма <a 
href="#x40-83003r18">eval-when</a> имеет значение
<a 
href="clmse31.html#x42-86002r19">nil</a>.
<!--l. 2058--><p class="indent" >   For the sake of backward compatibility, a <i>situation</i> may also be <a 
href="clmse127.html#x157-771003r797">compile</a>, <a 
href="clmse122.html#x150-745002r778">load</a>,
or <a 
href="clmse110.html#x135-586002r620">eval</a>. Within a top-level <a 
href="#x40-83003r18">eval-when</a> form these have the same meaning
as :compile-toplevel, :load-toplevel, and :execute, respectively; but their
eﬀect is undeﬁned when used in an <a 
href="#x40-83003r18">eval-when</a> form that is not at top
level.
<!--l. 2065--><p class="indent" >   Для сохранения обратной совместимости, <i>situation</i> может также быть
<a 
href="clmse127.html#x157-771003r797">compile</a>, <a 
href="clmse122.html#x150-745002r778">load</a> или <a 
href="clmse110.html#x135-586002r620">eval</a>. Внутри формы верхнего уровня <a 
href="#x40-83003r18">eval-when</a>, они имеют
значения :compile-toplevel, :load-toplevel и :execute соответственно. Однако их
поведение не определено при использовании в <a 
href="#x40-83003r18">eval-when</a> не верхнего
уровня.
<!--l. 2072--><p class="indent" >   The following eﬀects are logical consequences of the preceding speciﬁcation:
<!--l. 2074--><p class="indent" >   Следующие правила являются логическим продолжением предыдущих
определений:
      <ul class="itemize1">
                                                                          

                                                                          
      <li class="itemize">It is never the case that the execution of a single <a 
href="#x40-83003r18">eval-when</a> expression
      will execute the body code more than once.
      </li>
      <li class="itemize">Никогда  не  случится  так,  что  выполнение  одного  <a 
href="#x40-83003r18">eval-when</a>
      выражения приведет к выполнению тела более чем один раз.
      </li>
      <li class="itemize">The old keyword <a 
href="clmse110.html#x135-586002r620">eval</a> was a misnomer because execution of the body need
      not be done by <a 
href="clmse110.html#x135-586002r620">eval</a>. For example, when the function deﬁnition <div class=lisp>
      <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defun foo () (eval-when (:execute) (print &#x2019;foo)))
</td></tr></table>
      <!--l. 2088--><p class="noindent" >
</div>
</div>
      <!--l. 2089--><p class="noindent" >is compiled the call to <a 
href="clmse117.html#x144-683004r713">print</a> should be compiled, not evaluated at compile
      time.
      </li>
      <li class="itemize">Старый ключевой символ eval был неправильно использован, потому
      что выполнение тела не нуждается в eval. Например, когда определение
      функции <div class=lisp> <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defun foo () (eval-when (:execute) (print &#x2019;foo)))
</td></tr></table>
      <!--l. 2097--><p class="noindent" >
</div>
</div>
      <!--l. 2098--><p class="noindent" >скомпилируется вызов <a 
href="clmse117.html#x144-683004r713">print</a> должен быть скомпилирован, а не
      выполнен во время компиляции.
                                                                          

                                                                          
      </li>
      <li class="itemize">Macros intended for use in top-level forms should arrange for all side-eﬀects
      to be done by the forms in the macro expansion. The macro-expander itself
      should not perform the side-eﬀects.
<div class=lisp>
<div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defmacro foo ()
</td></tr></table>
      <!--l. 2107--><p class="noindent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  (really-foo)                              ;Wrong</td></tr></table>
      <!--l. 2108--><p class="noindent" >                                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  ‘(really-foo))</td></tr></table>
      <!--l. 2109--><p class="noindent" >                                                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing"></td></tr></table>
      <!--l. 2110--><p class="noindent" >                                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defmacro foo ()</td></tr></table>
      <!--l. 2111--><p class="noindent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  ‘(eval-when (:compile-toplevel</td></tr></table>
      <!--l. 2112--><p class="noindent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">               :load-toplevel :execute)     ;Right</td></tr></table>
      <!--l. 2113--><p class="noindent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">    (really-foo)))</td></tr></table>
      <!--l. 2115--><p class="noindent" >
</div>
</div>
      <!--l. 2117--><p class="noindent" >Adherence to this convention will mean that such macros will behave
      intuitively when called in non-top-level positions.
      </li>
      <li class="itemize">Макросы, предназначенные для использования в качестве форм
      верхнего уровня, должны контролировать все побочные эффекты,
      которые будут сделаны формами в процессе развертывания.
      Разворачиватель макроса сам по себе не должен порождать никаких
      побочных эффектов.
<div class=lisp>
<div class=tabbing>
                                                                          

                                                                          
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defmacro foo ()
</td></tr></table>
      <!--l. 2127--><p class="noindent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  (really-foo)                              ;Wrong</td></tr></table>
      <!--l. 2128--><p class="noindent" >                                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  ‘(really-foo))</td></tr></table>
      <!--l. 2129--><p class="noindent" >                                                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing"></td></tr></table>
      <!--l. 2130--><p class="noindent" >                                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defmacro foo ()</td></tr></table>
      <!--l. 2131--><p class="noindent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  ‘(eval-when (:compile-toplevel</td></tr></table>
      <!--l. 2132--><p class="noindent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">               :load-toplevel :execute)     ;Right</td></tr></table>
      <!--l. 2133--><p class="noindent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">    (really-foo)))</td></tr></table>
      <!--l. 2135--><p class="noindent" >
</div>
</div>
      <!--l. 2136--><p class="noindent" >Соблюдение этого правила будет значит, что такие макросы будут вести
      себя интуитивно понятно при вызовах в формах не верхнего
      уровня.
      </li>
      <li class="itemize">Placing a variable binding around an <a 
href="#x40-83003r18">eval-when</a> reliably captures the
      binding because the “compile-time-too” mode cannot occur (because the
      <a 
href="#x40-83003r18">eval-when</a> could not be a top-level form). For example, <div class=lisp> <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(let ((x 3))
</td></tr></table>
      <!--l. 2145--><p class="noindent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  (eval-when (:compile-toplevel :load-toplevel :execute)</td></tr></table>
      <!--l. 2146--><p class="noindent" >                                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">    (print x)))</td></tr></table>
      <!--l. 2148--><p class="noindent" >
</div>
</div>
                                                                          

                                                                          
      <!--l. 2149--><p class="noindent" >will print 3 at execution (that is, load) time and will not print anything at
      compile time. This is important so that expansions of <a 
href="#x40-78002r13">defun</a> and <a 
href="clmse46.html#x59-220002r137">defmacro</a>
      can be done in terms of <a 
href="#x40-83003r18">eval-when</a> and can correctly capture the lexical
      environment. For example, an implementation might expand a <a 
href="#x40-78002r13">defun</a> form
      such as <div class=lisp> <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defun bar (x) (defun foo () (+ x 3)))
</td></tr></table>
      <!--l. 2157--><p class="noindent" >
</div>
</div>
      <!--l. 2158--><p class="noindent" >into <div class=lisp> <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(progn (eval-when (:compile-toplevel)
</td></tr></table>
      <!--l. 2160--><p class="noindent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (compiler::notice-function &#x2019;bar &#x2019;(x)))</td></tr></table>
      <!--l. 2161--><p class="noindent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">       (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2162--><p class="noindent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (setf (symbol-function &#x2019;bar)</td></tr></table>
      <!--l. 2163--><p class="noindent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">               #&#x2019;(lambda (x)</td></tr></table>
      <!--l. 2164--><p class="noindent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                   (progn (eval-when (:compile-toplevel)</td></tr></table>
      <!--l. 2165--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            (compiler::notice-function &#x2019;foo</td></tr></table>
      <!--l. 2166--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                                                       &#x2019;()))</td></tr></table>
      <!--l. 2167--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                          (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2168--><p class="noindent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            (setf (symbol-function &#x2019;foo)</td></tr></table>
      <!--l. 2169--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                                  #&#x2019;(lambda () (+ x 3)))))))))</td></tr></table>
      <!--l. 2171--><p class="noindent" >
</div>
</div>
      <!--l. 2172--><p class="noindent" >which by the preceding rules would be treated the same as <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(progn (eval-when (:compile-toplevel)
</td></tr></table>
      <!--l. 2174--><p class="noindent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (compiler::notice-function &#x2019;bar &#x2019;(x)))</td></tr></table>
      <!--l. 2175--><p class="noindent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">       (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2176--><p class="noindent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (setf (symbol-function &#x2019;bar)</td></tr></table>
      <!--l. 2177--><p class="noindent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">               #&#x2019;(lambda (x)</td></tr></table>
      <!--l. 2178--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                   (progn (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2179--><p class="noindent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            (setf (symbol-function &#x2019;foo)</td></tr></table>
      <!--l. 2180--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                                  #&#x2019;(lambda () (+ x 3)))))))))</td></tr></table>
      <!--l. 2182--><p class="noindent" >
</div>
</div>
      </li>
      <li class="itemize">Расположение связывания переменной окруженной <a 
href="#x40-83003r18">eval-when</a>
      захватывает связывание, потому что режим «время-компиляции» не
      может случиться (потому что <a 
href="#x40-83003r18">eval-when</a> не может быть формой
      верхнего уровня) <div class=lisp> <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(let ((x 3))
</td></tr></table>
      <!--l. 2188--><p class="noindent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  (eval-when (:compile-toplevel :load-toplevel :execute)</td></tr></table>
      <!--l. 2189--><p class="noindent" >                                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">    (print x)))</td></tr></table>
      <!--l. 2191--><p class="noindent" >
</div>
</div>
      <!--l. 2192--><p class="noindent" >выведет 3 во время выполнения (в данном случае загрузки) и не будет
      ничего выводить во время компиляции. Разворачивание <a 
href="#x40-78002r13">defun</a> и
      <a 
href="clmse46.html#x59-220002r137">defmacro</a> может быть выполнено в контексте <a 
href="#x40-83003r18">eval-when</a> и могут
      корректно захватывать лесическое окружение. Например, реализация
      может разворачивать форму <a 
href="#x40-78002r13">defun</a>, такую как: <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defun bar (x) (defun foo () (+ x 3)))
</td></tr></table>
      <!--l. 2199--><p class="noindent" >
</div>
</div>
      <!--l. 2200--><p class="noindent" >в <div class=lisp> <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(progn (eval-when (:compile-toplevel)
</td></tr></table>
      <!--l. 2202--><p class="noindent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (compiler::notice-function &#x2019;bar &#x2019;(x)))</td></tr></table>
      <!--l. 2203--><p class="noindent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">       (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2204--><p class="noindent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (setf (symbol-function &#x2019;bar)</td></tr></table>
      <!--l. 2205--><p class="noindent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">               #&#x2019;(lambda (x)</td></tr></table>
      <!--l. 2206--><p class="noindent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                   (progn (eval-when (:compile-toplevel)</td></tr></table>
      <!--l. 2207--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            (compiler::notice-function &#x2019;foo</td></tr></table>
      <!--l. 2208--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                                                       &#x2019;()))</td></tr></table>
      <!--l. 2209--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                          (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2210--><p class="noindent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            (setf (symbol-function &#x2019;foo)</td></tr></table>
      <!--l. 2211--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                                  #&#x2019;(lambda () (+ x 3)))))))))</td></tr></table>
      <!--l. 2213--><p class="noindent" >
</div>
</div>
      <!--l. 2214--><p class="noindent" >которая по предыдущим правилам будет обработана также, как и <div class=lisp>
      <div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(progn (eval-when (:compile-toplevel)
</td></tr></table>
                                                                          

                                                                          
      <!--l. 2216--><p class="noindent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (compiler::notice-function &#x2019;bar &#x2019;(x)))</td></tr></table>
      <!--l. 2217--><p class="noindent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">       (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2218--><p class="noindent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (setf (symbol-function &#x2019;bar)</td></tr></table>
      <!--l. 2219--><p class="noindent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">               #&#x2019;(lambda (x)</td></tr></table>
      <!--l. 2220--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                   (progn (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2221--><p class="noindent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            (setf (symbol-function &#x2019;foo)</td></tr></table>
      <!--l. 2222--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                                  #&#x2019;(lambda () (+ x 3)))))))))</td></tr></table>
      <!--l. 2224--><p class="noindent" >
</div>
</div>
      </li></ul>
<!--l. 2228--><p class="indent" >   Here are some additional examples.
<!--l. 2230--><p class="indent" >   Вот несколько дополнительных примеров. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((x 1))
</td></tr></table>
<!--l. 2232--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (eval-when (:execute :load-toplevel :compile-toplevel)</td></tr></table>
<!--l. 2233--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (setf (symbol-function &#x2019;foo1) #&#x2019;(lambda () x))))</td></tr></table>
<!--l. 2235--><p class="indent" >
</div>
</div>
<!--l. 2236--><p class="noindent" >The <a 
href="#x40-83003r18">eval-when</a> in the preceding expression is not at top level, so only the :execute
keyword is considered. At compile time, this has no eﬀect. At load time (if the <a 
href="clmse39.html#x51-163003r84">let</a>
is at top level), or at execution time (if the <a 
href="clmse39.html#x51-163003r84">let</a> is embedded in some other form
which does not execute until later), this sets (symbol-function &#x2019;foo1) to a function
that returns 1.
<!--l. 2244--><p class="indent" >   <a 
href="#x40-83003r18">eval-when</a> в предыдущем выражении не является формой верхнего уровня,
таким образом только ключевой символ :execute берется во внимаение. В
время компиляции, это не будет иметь эффекта. В время загрузки (если <a 
href="clmse39.html#x51-163003r84">let</a>
форма верхнего уровня) или во время выполнения (если форма <a 
href="clmse39.html#x51-163003r84">let</a> вложена в
какую-либо другую форму, которая еще не была выполнена), этот
код установит в (symbol-function &#x2019;foo1) функцию которая возвращает
1.
                                                                          

                                                                          
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:execute :load-toplevel :compile-toplevel)
</td></tr></table>
<!--l. 2252--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((x 2))</td></tr></table>
<!--l. 2253--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (eval-when (:execute :load-toplevel :compile-toplevel)</td></tr></table>
<!--l. 2254--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (setf (symbol-function &#x2019;foo2) #&#x2019;(lambda () x)))))</td></tr></table>
<!--l. 2256--><p class="indent" >
</div>
</div>
<!--l. 2258--><p class="indent" >   If the preceding expression occurs at the top level of a ﬁle to be compiled, it
has <i>both</i> a compile time <i>and</i> a load-time eﬀect of setting (symbol-function &#x2019;foo2)
to a function that returns 2.
<!--l. 2262--><p class="indent" >   Если предыдущее выражение находилось на верхнем уровне в
компилируемом файле, оно будет выполнятся в обоих случаях, и во время
компиляции и во время загрузки. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:execute :load-toplevel :compile-toplevel)
</td></tr></table>
<!--l. 2265--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setf (symbol-function &#x2019;foo3) #&#x2019;(lambda () 3)))</td></tr></table>
<!--l. 2267--><p class="indent" >
</div>
</div>
<!--l. 2268--><p class="noindent" >If the preceding expression occurs at the top level of a ﬁle to be compiled, it has <i>both</i>
a compile time <i>and</i> a load-time eﬀect of setting the function cell of foo3 to a
function that returns 3.
<!--l. 2273--><p class="indent" >   Если предыдущее выражение находилось на верхнем уровне в
компилируемом файле, оно будет выполняться в обоих случаях, и во время
компиляции и во время загрузки. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:compile-toplevel)
</td></tr></table>
<!--l. 2276--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (eval-when (:compile-toplevel)</td></tr></table>
                                                                          

                                                                          
<!--l. 2277--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (print &#x2019;foo4)))</td></tr></table>
<!--l. 2279--><p class="indent" >
</div>
</div>
<!--l. 2280--><p class="noindent" >The preceding expression always does nothing; it simply returns <a 
href="clmse31.html#x42-86002r19">nil</a>.
<!--l. 2282--><p class="indent" >   Предыдущее выражение ничего не делает, оно просто возвращает
<a 
href="clmse31.html#x42-86002r19">nil</a>.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:compile-toplevel)
</td></tr></table>
<!--l. 2285--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (eval-when (:execute)</td></tr></table>
<!--l. 2286--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (print &#x2019;foo5)))</td></tr></table>
<!--l. 2288--><p class="indent" >
</div>
</div>
<!--l. 2289--><p class="noindent" >If the preceding form occurs at the top level of a ﬁle to be compiled, foo5 is printed at
compile time. If this form occurs in a non-top-level position, nothing is printed at
compile time. Regardless of context, nothing is ever printed at load time or
execution time.
<!--l. 2295--><p class="indent" >   Если предыдущее выражение находилось на верхнем уровне в
компилируемом файле, foo5 будет выведено во время компиляции. Если эта
форма была не на верхнем уровне, ничего не будет выведено во время
компиляции. Вне зависимости от контекста, ничего не будет выведено во
время загрузки или выполнения.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:execute :load-toplevel)
</td></tr></table>
<!--l. 2301--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (eval-when (:compile-toplevel)</td></tr></table>
<!--l. 2302--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (print &#x2019;foo6)))</td></tr></table>
<!--l. 2304--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 2306--><p class="indent" >   If the preceding form occurs at the top level of a ﬁle to be compiled, foo6 is
printed at compile time. If this form occurs in a non-top-level position, nothing is
printed at compile time. Regardless of context, nothing is ever printed at load
time or execution time.
<!--l. 2312--><p class="indent" >   Если предыдущая форма находилась на верхнем уровне в компилируемом
файле, foo6 будет выведено во время компиляции. Если форма была не на
верхнем уровне, ничего не будет выведено во время компиляции. Вне
зависимости от контекста, ничего не будет выведение во время загрузки или
выполнения кода.
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 6--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch6.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse29.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse29.html#tailclmse29.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse30.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch5.html#clmse30.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 6--><p class="indent" >   <a 
 id="tailclmse30.html"></a>   
</body></html> 
