<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Формы верхнего уровня</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-28 14:08:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1959--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch6.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse29.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse29.html#tailclmse29.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse30.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch5.html#clmse30.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">5.3   </span> <a 
href="clm.html#QQ2-40-73" id="x40-660005.3">Формы верхнего уровня</a></h3>
<!--l. 1961--><p class="noindent" >Стандартный путь взаимодействия с реализацией Common Lisp через
<i>read-eval-print loop</i> <i>цикл чтение-выполнение-печать</i>: система повторно
читает форму из некоторого источника ввода (клавиатура, файл), выполняет
её, затем выводит результат(ы) в некоторое устройство вывода (дисплей,
другой файл). Допускается любая форма (выполняемый объект данных),
однако существуют некоторые формы разработанные для удобного
применения в качестве форм <i>верхнего уровня</i>. Эти специальные формы
верхнего уровня могут использоваться для определения глобальных функции
(globally named functions), макросов, создания деклараций и определения
глобальных значений для специальных переменных.
<!--l. 1972--><p class="indent" >   Макросы обычно определяются с помощью специальной формы
<a 
href="clmse45.html#x58-144004r118">defmacro</a>. Этот механизм достаточно сложен. Для подробностей смотрите
главу <a 
href="clmch8.html#x57-1430008">8<!--tex4ht:ref: MACROS --></a>.
<!--l. 1975--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.3.1   </span> <a 
href="clmli1.html#QQ2-40-74" id="x40-670005.3.1">Определение именованных функций</a></h4>
<!--l. 1977--><p class="noindent" >Специальная форма <a 
href="#x40-67002r13">defun</a> обычно обозначает определение именованных
функций.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> defun </b><a 
 id="dx40-67001"></a><a 
 id="x40-67002r13"></a> name lambda-list  [[ {declaration}*  | doc-string]]  { form}*
</td></tr></table>
<!--l. 1981--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 1981--><p class="noindent" ><span class="paragraphHead"><a 
href="#x40-680005.3.1" id="x40-680005.3.1"></a></span>
   Выполнение формы <a 
href="#x40-67002r13">defun</a> приводит к тому, что символ <i>name</i> становиться
глобальным именем для функции определённой лямбда-выражением.
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(lambda <i>lambda-list</i> {<i><i>declaration</i> | <i>doc-string</i></i>}*  {<i><i> form</i></i>}* )
</td></tr></table>
<!--l. 1986--><p class="indent" >
</div>
</div>
<!--l. 1987--><p class="noindent" >определяется в лексическом окружении, в котором выполнялась форма
<a 
href="#x40-67002r13">defun</a>. А так как формы <a 
href="#x40-67002r13">defun</a> обычно выполняются на самом верхнем
уровне, лямбда-выражение обычно выполняется в нулевом лексическом
окружении.
<div class=newer>
<!--l. 1992--><p class="indent" >   X3J13 проголосовал в марте 1989 <a 
 id="dx40-68001"></a>расширить <a 
href="#x40-67002r13">defun</a> до принятия любого
имени функции (символ или список, у которого <i>car</i> элемент равен
<a 
href="clmse36.html#x48-90002r64">setf</a>—смотрите раздел <a 
href="clmse35.html#x47-830007.1">7.1<!--tex4ht:ref: FUNCTION-NAME-SECTION --></a>), в качестве параметра <i>name</i>.
<!--l. 1997--><p class="indent" >   Так теперь можно записать <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun (setf cadr) ...)
</td></tr></table>
<!--l. 2000--><p class="indent" >
</div>
</div>
<!--l. 2001--><p class="noindent" >для определения <a 
href="clmse36.html#x48-90002r64">setf</a>-определения для функции <a 
href="clmse80.html#x100-201008r396">cadr</a>. Это более удобно, чем
использование defsetf или deﬁne-modify-macro.
</div>
<!--l. 2005--><p class="indent" >   Если указана необязательная строка документации <i>doc-string</i>, тогда они
присоединяется к символу <i>name</i> в качестве строки документации типа
<a 
href="clmse35.html#x47-85002r52">function</a>, смотрите <a 
href="clmse144.html#x177-415017r857">documentation</a>. Если после <i>doc-string</i> нет деклараций,
строка документации может быть использована только при условии
существования хотя бы одной формы после неё, иначе она будет использована в
качестве <i>form</i> функции. Указывать более чем одну <i>doc-string</i> является
ошибкой.
                                                                          

                                                                          
<i>
<!--l. 2012--><p class="indent" >   forms</i> составляют тело определяемой функции. Они выполняются как
неявный <a 
href="clmse38.html#x50-96002r71">progn</a>.
<!--l. 2014--><p class="indent" >   Тело определяемой функции неявно заключается в конструкцию <a 
href="clmse41.html#x53-113002r87">block</a>,
имя которой совпадает с <i>именем (name)</i> функции. Таким образом <a 
href="clmse41.html#x53-114002r88">return-from</a>
может быть использовано для выхода из функции.
<!--l. 2018--><p class="indent" >   Другие учётные действия специальные для некоторой реализации могут
также выполнятся в <a 
href="#x40-67002r13">defun</a>. <i>name</i> возвращается в качестве значения формы
<a 
href="#x40-67002r13">defun</a>. Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun discriminant (a b c)
</td></tr></table>
<!--l. 2023--><p class="indent" >                                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (declare (number a b c))</td></tr></table>
<!--l. 2024--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  &#x0022;Compute the discriminant for a quadratic equation.</td></tr></table>
<!--l. 2025--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   Given a, b, and c, the value b̂2-4*a*c is calculated.</td></tr></table>
<!--l. 2026--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   The quadratic equation a*x̂2+b*x+c=0 has real, multiple,</td></tr></table>
<!--l. 2027--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   or complex roots depending on whether this calculated</td></tr></table>
<!--l. 2028--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   value is positive, zero, or negative, respectively.&#x0022;</td></tr></table>
<!--l. 2029--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (- (* b b) (* 4 a c)))</td></tr></table>
<!--l. 2030--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> discriminant</td></tr></table>
<!--l. 2031--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   and now (discriminant 1 2/3 -2) <span class="math"> ⇒</span> 76/9</td></tr></table>
<!--l. 2033--><p class="indent" >
</div>
</div>
<!--l. 2035--><p class="indent" >   Пользователю разрешено использовать <a 
href="#x40-67002r13">defun</a> для переопределения
функции, например, для установки корректной версии некорректного
определения. Пользователю также разрешено переопределять макрос на
функцию. Однако является ошибкой, попытка переопределить имя
специальной формы (смотрите таблицу ??) на функцию.
</div>
<!--l. 2042--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.3.2   </span> <a 
href="clmli1.html#QQ2-40-76" id="x40-690005.3.2">Определение глобальных переменных и констант</a></h4>
<!--l. 2044--><p class="noindent" >Специальные формы <a 
href="#x40-69002r14">defvar</a> и <a 
href="#x40-69004r15">defparameter</a> используются для определения
глобальных переменных. Специальная форма <a 
href="#x40-69006r16">defconstant</a> используется для
                                                                          

                                                                          
определения констант.
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Макрос]</i><b> defvar </b><a 
 id="dx40-69001"></a><a 
 id="x40-69002r14"></a> name [initial-value [documentation]]
</td></tr></table>
<!--l. 2049--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Макрос]</i><b> defparameter </b><a 
 id="dx40-69003"></a><a 
 id="x40-69004r15"></a> name initial-value [documentation]</td></tr></table>
<!--l. 2050--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Макрос]</i><b> defconstant </b><a 
 id="dx40-69005"></a><a 
 id="x40-69006r16"></a> name initial-value [documentation]</td></tr></table>
<!--l. 2052--><p class="indent" >
</div>
<!--l. 2052--><p class="noindent" ><span class="paragraphHead"><a 
href="#x40-700005.3.2" id="x40-700005.3.2"></a></span>
   <a 
href="#x40-69002r14">defvar</a> рекомендуется для декларации использования в программе
специальных переменных. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar <i>variable</i>)
</td></tr></table>
<!--l. 2057--><p class="indent" >
</div>
</div>
<!--l. 2058--><p class="noindent" >указывает на то, что переменная <i>variable</i> будет специальной (special) (смотрите
<a 
href="clmse48.html#x62-151002r124">proclaim</a>), и может выполнять некоторые учётные действия, зависимые от
реализации.
<!--l. 2063--><p class="indent" >   Если для формы указан второй аргумент, <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar <i>variable</i> <i>initial-value</i>)
</td></tr></table>
<!--l. 2066--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 2067--><p class="noindent" >тогда переменная <i>variable</i>, если она ещё не была проинициализирована,
инициализируется результатом выполнения формы <i>initial-value</i>. Форма
<i>initial-value</i> не выполняется, если в этом нет необходимости. Это полезно,
если форма <i>initial-value</i> выполняет что-то трудоёмкое, как, например,
создание большого структуры данных.
<!--l. 2073--><p class="indent" >   Инициализация производится присвоением глобального значения
переменной, если только не существует специального связывания этой
переменной. Обычно, такого связывания быть не должно. FIXME.
<!--l. 2078--><p class="indent" >   <a 
href="#x40-69002r14">defvar</a> также предоставляют хорошее место для комментария описывающего
значение переменной, тогда как обычное special указание соблазняет
задекларировать несколько переменных за один раз и не предоставляет
возможности прокомментировать их. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *visible-windows* 0
</td></tr></table>
<!--l. 2083--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  &#x0022;Number of windows at least partially visible on the screen&#x0022;)</td></tr></table>
<!--l. 2085--><p class="indent" >
</div>
</div>
<!--l. 2087--><p class="indent" >   <a 
href="#x40-69004r15">defparameter</a> подобен <a 
href="#x40-69002r14">defvar</a>, но <a 
href="#x40-69004r15">defparameter</a> требует обязательной формы
<i>initial-value</i>, и всего выполняет эту форму, и присваивает результат
переменной. Семантическое различие заключается в том, что <a 
href="#x40-69002r14">defvar</a>
предназначена декларировать переменную, изменяемую программой, тогда
как <a 
href="#x40-69004r15">defparameter</a> предназначена для декларации переменной, как константы,
которая может быть изменена (и во время выполнения программы), для
изменения поведения программы. Таким образом <a 
href="#x40-69004r15">defparameter</a> не указывает,
что количество никогда не изменяется, в частности, она не разрешает
компилятору предположить то, что значение может быть вкомпилировано в
программу.
<!--l. 2098--><p class="indent" >   <a 
href="#x40-69006r16">defconstant</a> похожа на <a 
href="#x40-69004r15">defparameter</a>, но в отличие от последней, указывает,
что значение переменной <i>name</i> фиксировано и позволяет компилятору
предположить, что значение может быть вкомпилировано в программу.
Однако, если компилятор выбирает путь замены ссылок на имя константы на
значения этой константы в компилируемом коде для оптимизации, он
должен позаботиться о том, чтобы такие «копии» были эквивалентны <a 
href="clmse33.html#x44-78004r45">eql</a>
объектам-значениям констант. Например, компилятор может спокойно
копировать числа, но должен позаботиться об этом правиле, если значение
                                                                          

                                                                          
константы является списком.
<!--l. 2108--><p class="indent" >   Если для переменной на момент вызова формы <a 
href="#x40-69006r16">defconstant</a> существует
специальные связывания, то возникает ошибка (но реализации могут
проверять, а могут и не проверять этот факт).
<!--l. 2112--><p class="indent" >   Если имя задекларировано с помощью <a 
href="#x40-69006r16">defconstant</a> быть константой,
последующие присваивания и связывания данной специальной переменной
будут являются ошибкой. Это справедливо для системозависимых
констант, например, <a 
href="clmse31.html#x42-74004r19">t</a> и <a 
href="clmse70.html#x87-188002r284">most-positive-ﬁxnum</a>. Компилятор может также
сигнализировать о связывании лексической переменной с одинаковым
именем.
<!--l. 2119--><p class="indent" >   Для любой из этих конструкций, документация должна быть строкой.
Строка присоединяется к имени переменной, параметра или константы как
тип документации variable, смотрите функцию <a 
href="clmse144.html#x177-415017r857">documentation</a>.
<div class=new>
<!--l. 2124--><p class="indent" >   X3J13 проголосовал в марте 1988 <a 
 id="dx40-70001"></a>для уточнения того, что <i>documentation-string</i>
не выполняется и должна представлять строку, когда выполняется <a 
href="#x40-69002r14">defvar</a>,
<a 
href="#x40-69004r15">defparameter</a> или <a 
href="#x40-69006r16">defconstant</a>.
<!--l. 2130--><p class="indent" >   Например, форма <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *avoid-registers* nil &#x0022;Compilation control switch #43&#x0022;)
</td></tr></table>
<!--l. 2133--><p class="indent" >
</div>
</div>
<!--l. 2134--><p class="noindent" >законна, но <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *avoid-registers* nil
</td></tr></table>
<!--l. 2136--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format nil &#x0022;Compilation control switch #~D&#x0022;</td></tr></table>
<!--l. 2137--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          (incf *compiler-switch-number*)))</td></tr></table>
<!--l. 2139--><p class="indent" >
</div>
</div>
<!--l. 2140--><p class="noindent" >ошибочна, так как вызов <a 
href="clmse111.html#x138-262003r666">format</a> не является дословно строкой.
<!--l. 2142--><p class="indent" >   С другой стороны, форма <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defvar *avoid-registers* nil
</td></tr></table>
<!--l. 2144--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  #.(format nil &#x0022;Compilation control switch #~D&#x0022;</td></tr></table>
<!--l. 2145--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">            (incf *compiler-switch-number*)))</td></tr></table>
<!--l. 2147--><p class="indent" >
</div>
</div>
<!--l. 2148--><p class="noindent" >Может использоваться для вышеназванной цели, потому что вызов <a 
href="clmse111.html#x138-262003r666">format</a>
выполняется на во время чтения кода <a 
href="clmse110.html#x137-256003r634">read</a>, когда форма <a 
href="#x40-69002r14">defvar</a> выполняется,
в ней указана строка, которая являлась результатом вызова <a 
href="clmse111.html#x138-262003r666">format</a>.
</div>
<!--l. 2154--><p class="indent" >   Эти конструкции обычно используются только как формы верхнего
уровня. Значения возвращаемые каждой из этих конструкций это
задекларированные имена <i>name</i>.
</div>
<!--l. 2158--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.3.3   </span> <a 
href="clmli1.html#QQ2-40-78" id="x40-710005.3.3">Контроль времени выполнения</a></h4>
<div class=newer>
<!--l. 2161--><p class="noindent" >X3J13 проголосовал в марте 1989 <a 
 id="dx40-71001"></a>полностью переработать <a 
href="#x40-71003r17">eval-when</a> для
разрешения некоторых проблем, касательно её использования в отличных от
контекста верхнего уровня. Новое определение совместимо со старым, но
старые ключевые символы были упразднены.
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> <i>[Специальная форма]</i><b> eval-when </b><a 
 id="dx40-71002"></a><a 
 id="x40-71003r17"></a> ( {situation}* )  { form}*
</td></tr></table>
<!--l. 2168--><p class="indent" >
</div>
                                                                          

                                                                          
<!--l. 2168--><p class="noindent" ><span class="paragraphHead"><a 
href="#x40-720005.3.3" id="x40-720005.3.3"></a></span>
   Тело формы <a 
href="#x40-71003r17">eval-when</a> выполняется как неявный <a 
href="clmse38.html#x50-96002r71">progn</a>, но только в ниже
перечисленных ситуациях. Каждая ситуация <i>situation</i> должна быть одним
символов, :compile-toplevel, :load-toplevel или :execute.
<!--l. 2174--><p class="indent" >   Использование :compile-toplevel и :load-toplevel контролирует, что и
когда выполняется для форм верхнего уровня. Использование :execute
контролирует будет ли производится выполнения форм не верхнего
уровня.
<!--l. 2178--><p class="indent" >   Конструкция <a 
href="#x40-71003r17">eval-when</a> может быть более понятна в терминах модели
того, как компилятор файлов, <a 
href="clmse121.html#x151-293009r726">compile-ﬁle</a>, выполняет формы в файле для
компиляции.
<!--l. 2182--><p class="indent" >   Формы следующие друг за другом читаются из файла с помощью
компилятора файла используя <a 
href="clmse110.html#x137-256003r634">read</a>. Эти формы верхнего уровня обычно
обрабатываются в том, что мы называем режим «времени некомпиляции
(not-compile-time mode)». Существует и другой режим, называемый режим
«времени-компиляции (compile-time-too mode)», которые вступает в игру для
форм верхнего уровня. Специальная форма <a 
href="#x40-71003r17">eval-when</a> используется для
аннотации программы таким образом, чтобы предоставить программе,
осуществлять выбор режима.
<!--l. 2190--><p class="indent" >   Обработка форм верхнего уровня в компиляторе файла работает так, как
рассказано ниже:
      <ul class="itemize1">
      <li class="itemize">Если          форма          является          макровызовом,          она
      разворачивается и результат обрабатывается, как форма верхнего
      уровня  в  том  же  режиме  обработки  (времени-компиляции  или
      времени-некомпиляции, (compile-time-too или not-compile-time).
      </li>
      <li class="itemize">Если  форма  <a 
href="clmse38.html#x50-96002r71">progn</a>  (или  locally),  каждая  из  форм  из  их  тел
      обрабатываются, как формы верхнего уровня в том же режиме
      обработки.
      </li>
      <li class="itemize">Если                форма                compiler-let,                <a 
href="clmse39.html#x51-103006r79">macrolet</a>
      или <a 
href="clmse39.html#x51-104002r80">symbol-macrolet</a>, компилятор файла создаёт соответствующие
      связывания и рекурсивно обрабатывает тела форм, как неявный
      <a 
href="clmse38.html#x50-96002r71">progn</a> верхнего уровня в контексте установленных связей в том же
                                                                          

                                                                          
      режиме обработки.
      </li>
      <li class="itemize">Если форма <a 
href="#x40-71003r17">eval-when</a>, она обрабатывается в соответствии со
      следующей таблицей:
      <div class="flushleft" 
>
<!--l. 2209--><p class="noindent" >
 <!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" > LT</td><td align="left" >CT</td><td align="left" >EX</td><td align="left" >CTTM</td><td align="left" >Action                                                         </td></tr><tr><td align="left" > yes</td> <td align="left" >yes</td> <td align="left" > – </td> <td align="left" > – </td> <td align="left" >обработать тело в режиме время-компиляции</td>
</tr><tr><td align="left" > yes</td><td align="left" > no </td><td align="left" >yes</td><td align="left" >   yes   </td><td align="left" >обработать тело в режиме время-компиляции   </td>
</tr><tr><td align="left" > yes</td><td align="left" > no </td><td align="left" > – </td><td align="left" >   no   </td><td align="left" >обработать тело в режиме время-некомпиляции</td>
</tr><tr><td align="left" > yes</td><td align="left" > no </td><td align="left" > no </td><td align="left" >    –    </td><td align="left" >обработать тело в режиме время-некомпиляции</td></tr><tr><td align="left" >  no </td> <td align="left" >yes</td> <td align="left" > – </td> <td align="left" > – </td> <td align="left" >выполнить тело</td>
</tr><tr><td align="left" > no</td><td align="left" > no </td><td align="left" >yes</td><td align="left" >   yes   </td><td align="left" >выполнить тело                                            </td></tr><tr><td align="left" >  no </td> <td align="left" > no </td> <td align="left" > – </td> <td align="left" > no </td> <td align="left" >ничего не делать</td>
</tr><tr><td align="left" > no</td><td align="left" > no </td><td align="left" > no </td><td align="left" >    –    </td><td align="left" >ничего не делать                                           </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr><td align="left" >  </td>
</tr></table></div></div>
      <!--l. 2223--><p class="noindent" >В этой таблице столбец LT спрашивает присутствует ли :load-toplevel в
      ситуациях указанных в форме <a 
href="#x40-71003r17">eval-when</a>. CT соответственно указывает
      на :compile-toplevel и EX на :execute. Столбец CTTM спрашивает
      встречается ли форма <a 
href="#x40-71003r17">eval-when</a> в режиме времени-компиляции.
      Фраза «обработка тела» означает обработку последовательно
      форм тела, как неявного <a 
href="clmse38.html#x50-96002r71">progn</a> верхнего уровня в указанном
      режиме, и «выполнение тела» означает выполнение форм тела
      последовательно, как неявный <a 
href="clmse38.html#x50-96002r71">progn</a> в динамическом контексте
      выполнения компилятора и в лексическом окружении, в котором
      встретилась <a 
href="#x40-71003r17">eval-when</a>.
      </li>
      <li class="itemize">В противном случае, форма верхнего уровня, которая не представлена в
      специальных случаях. Если в режиме времени-компиляции, компилятор
      сначала выполняет форму и затем выполняет обычную обработку
      компилятором. Если установлен режим времени-некомпиляции,
      выполняется только обычная обработка компилятором (смотрите
      раздел <a 
href="clmse121.html#x151-29300025.1">25.1<!--tex4ht:ref: COMPILER-SECTION --></a>). Любые подформы обрабатываются как формы не
      верхнего уровня.</li></ul>
<!--l. 2241--><p class="indent" >   Следует отметить, что формы верхнего уровня обрабатываются
гарантированно в порядке, в котором они в тексте в файле, и каждая форма
верхнего уровня прочтённая компилятором обрабатывается перед тем, как
                                                                          

                                                                          
следующая будет прочтена. Однако, порядок обработки (включая, в
частности, раскрытие макросов) подформ, которые не являются формами
верхнего уровня, не определён.
<!--l. 2248--><p class="indent" >   Для формы <a 
href="#x40-71003r17">eval-when</a>, которая не является формой верхнего уровня в
компиляторе файлов (то есть либо в интерпретаторе, либо <a 
href="clmse121.html#x151-293003r725">compile</a>,
либо в компиляторе файлов, но не на верхнем уровне), если указана
ситуация :execute, тело формы обрабатывается как неявный <a 
href="clmse38.html#x50-96002r71">progn</a>. В
противном случае, тело игнорируется и форма <a 
href="#x40-71003r17">eval-when</a> имеет значение
<a 
href="clmse31.html#x42-74002r18">nil</a>.
<!--l. 2254--><p class="indent" >   Для сохранения обратной совместимости, <i>situation</i> может также быть
<a 
href="clmse121.html#x151-293003r725">compile</a>, <a 
href="clmse116.html#x144-280002r707">load</a> или <a 
href="clmse104.html#x129-237002r562">eval</a>. Внутри формы верхнего уровня <a 
href="#x40-71003r17">eval-when</a>, они имеют
значения :compile-toplevel, :load-toplevel и :execute соответственно. Однако их
поведение не определено при использовании в <a 
href="#x40-71003r17">eval-when</a> не верхнего
уровня.
<!--l. 2261--><p class="indent" >   Следующие правила являются логическим продолжением предыдущих
определений:
      <ul class="itemize1">
      <li class="itemize">Никогда  не  случится  так,  что  выполнение  одного  <a 
href="#x40-71003r17">eval-when</a>
      выражения приведён к выполнению тела более чем один раз.
      </li>
      <li class="itemize">Старый ключевой символ eval был неправильно использован, потому
      что выполнение тела не нуждается в eval. Например, когда определение
      функции <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defun foo () (eval-when (:execute) (print &#x2019;foo)))
</td></tr></table>
      <!--l. 2273--><p class="noindent" >
</div>
</div>
      <!--l. 2274--><p class="noindent" >скомпилируется, вызов <a 
href="clmse111.html#x138-259008r650">print</a> должен быть скомпилирован, а не
      выполнен во время компиляции.
                                                                          

                                                                          
      </li>
      <li class="itemize">Макросы, предназначенные для использования в качестве форм
      верхнего уровня, должны контролировать все побочные эффекты,
      которые будут сделаны формами в процессе развёртывания.
      Разворачиватель макроса сам по себе не должен порождать никаких
      побочных эффектов.
<div class=lisp>
<div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defmacro foo ()
</td></tr></table>
      <!--l. 2285--><p class="noindent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  (really-foo)                              ;Wrong</td></tr></table>
      <!--l. 2286--><p class="noindent" >                                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  ‘(really-foo))</td></tr></table>
      <!--l. 2287--><p class="noindent" >                                                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing"></td></tr></table>
      <!--l. 2288--><p class="noindent" >                                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defmacro foo ()</td></tr></table>
      <!--l. 2289--><p class="noindent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  ‘(eval-when (:compile-toplevel</td></tr></table>
      <!--l. 2290--><p class="noindent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">               :load-toplevel :execute)     ;Right</td></tr></table>
      <!--l. 2291--><p class="noindent" >                                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">    (really-foo)))</td></tr></table>
      <!--l. 2293--><p class="noindent" >
</div>
</div>
      <!--l. 2294--><p class="noindent" >Соблюдение этого правила будет значит, что такие макросы будут вести
      себя интуитивно понятно при вызовах в формах не верхнего
      уровня.
      </li>
      <li class="itemize">Расположение связывания переменной окружённой <a 
href="#x40-71003r17">eval-when</a>
      захватывает связывание, потому что режим «время-компиляции» не
      может случиться (потому что <a 
href="#x40-71003r17">eval-when</a> не может быть формой
      верхнего уровня) <div class=lisp><div class=tabbing>
                                                                          

                                                                          
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(let ((x 3))
</td></tr></table>
      <!--l. 2301--><p class="noindent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">  (eval-when (:compile-toplevel :load-toplevel :execute)</td></tr></table>
      <!--l. 2302--><p class="noindent" >                                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">    (print x)))</td></tr></table>
      <!--l. 2304--><p class="noindent" >
</div>
</div>
      <!--l. 2305--><p class="noindent" >выведет 3 во время выполнения (в данном случае загрузки) и не будет
      ничего выводить во время компиляции. Разворачивание <a 
href="#x40-67002r13">defun</a> и
      <a 
href="clmse45.html#x58-144004r118">defmacro</a> может быть выполнено в контексте <a 
href="#x40-71003r17">eval-when</a> и могут
      корректно захватывать лексическое окружение. Например, реализация
      может разворачивать форму <a 
href="#x40-67002r13">defun</a>, такую как: <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(defun bar (x) (defun foo () (+ x 3)))
</td></tr></table>
      <!--l. 2312--><p class="noindent" >
</div>
</div>
      <!--l. 2313--><p class="noindent" >в <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(progn (eval-when (:compile-toplevel)
</td></tr></table>
      <!--l. 2315--><p class="noindent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (compiler::notice-function &#x2019;bar &#x2019;(x)))</td></tr></table>
      <!--l. 2316--><p class="noindent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">       (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2317--><p class="noindent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (setf (symbol-function &#x2019;bar)</td></tr></table>
      <!--l. 2318--><p class="noindent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">               #&#x2019;(lambda (x)</td></tr></table>
      <!--l. 2319--><p class="noindent" >             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                   (progn (eval-when (:compile-toplevel)</td></tr></table>
      <!--l. 2320--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            (compiler::notice-function &#x2019;foo</td></tr></table>
                                                                          

                                                                          
      <!--l. 2321--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                                                       &#x2019;()))</td></tr></table>
      <!--l. 2322--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                          (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2323--><p class="noindent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            (setf (symbol-function &#x2019;foo)</td></tr></table>
      <!--l. 2324--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                                  #&#x2019;(lambda () (+ x 3)))))))))</td></tr></table>
      <!--l. 2326--><p class="noindent" >
</div>
</div>
      <!--l. 2327--><p class="noindent" >которая по предыдущим правилам будет обработана также, как и
      <div class=lisp><div class=tabbing>
      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">(progn (eval-when (:compile-toplevel)
</td></tr></table>
      <!--l. 2329--><p class="noindent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (compiler::notice-function &#x2019;bar &#x2019;(x)))</td></tr></table>
      <!--l. 2330--><p class="noindent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">       (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2331--><p class="noindent" >                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">         (setf (symbol-function &#x2019;bar)</td></tr></table>
      <!--l. 2332--><p class="noindent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">               #&#x2019;(lambda (x)</td></tr></table>
      <!--l. 2333--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                   (progn (eval-when (:load-toplevel :execute)</td></tr></table>
      <!--l. 2334--><p class="noindent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                            (setf (symbol-function &#x2019;foo)</td></tr></table>
      <!--l. 2335--><p class="noindent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:44;" 
class="tabbing"></td><td  
class="tabbing">                                  #&#x2019;(lambda () (+ x 3)))))))))</td></tr></table>
      <!--l. 2337--><p class="noindent" >
</div>
</div>
      </li></ul>
<!--l. 2341--><p class="indent" >   Вот несколько дополнительных примеров. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(let ((x 1))
</td></tr></table>
<!--l. 2343--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (eval-when (:execute :load-toplevel :compile-toplevel)</td></tr></table>
<!--l. 2344--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (setf (symbol-function &#x2019;foo1) #&#x2019;(lambda () x))))</td></tr></table>
<!--l. 2346--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 2347--><p class="noindent" ><a 
href="#x40-71003r17">eval-when</a> в предыдущем выражении не является формой верхнего уровня, таким
образом только ключевой символ :execute берётся во внимание. В время
компиляции, это не будет иметь эффекта. В время загрузки (если <a 
href="clmse39.html#x51-100002r74">let</a> форма
верхнего уровня) или во время выполнения (если форма <a 
href="clmse39.html#x51-100002r74">let</a> вложена в
какую-либо другую форму, которая ещё не была выполнена), этот код
установит в (symbol-function &#x2019;foo1) функцию которая возвращает 1.
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:execute :load-toplevel :compile-toplevel)
</td></tr></table>
<!--l. 2354--><p class="indent" >                                                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (let ((x 2))</td></tr></table>
<!--l. 2355--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (eval-when (:execute :load-toplevel :compile-toplevel)</td></tr></table>
<!--l. 2356--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">      (setf (symbol-function &#x2019;foo2) #&#x2019;(lambda () x)))))</td></tr></table>
<!--l. 2358--><p class="indent" >
</div>
</div>
<!--l. 2360--><p class="indent" >   Если предыдущее выражение находилось на верхнем уровне в
компилируемом файле, оно будет выполнятся в обоих случаях, и во время
компиляции и во время загрузки. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:execute :load-toplevel :compile-toplevel)
</td></tr></table>
<!--l. 2363--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (setf (symbol-function &#x2019;foo3) #&#x2019;(lambda () 3)))</td></tr></table>
<!--l. 2365--><p class="indent" >
</div>
</div>
<!--l. 2367--><p class="indent" >   Если предыдущее выражение находилось на верхнем уровне в
компилируемом файле, оно будет выполняться в обоих случаях, и во время
компиляции и во время загрузки. <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:compile-toplevel)
</td></tr></table>
<!--l. 2370--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (eval-when (:compile-toplevel)</td></tr></table>
                                                                          

                                                                          
<!--l. 2371--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (print &#x2019;foo4)))</td></tr></table>
<!--l. 2373--><p class="indent" >
</div>
</div>
<!--l. 2375--><p class="indent" >   Предыдущее выражение ничего не делает, оно просто возвращает
<a 
href="clmse31.html#x42-74002r18">nil</a>.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:compile-toplevel)
</td></tr></table>
<!--l. 2378--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (eval-when (:execute)</td></tr></table>
<!--l. 2379--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (print &#x2019;foo5)))</td></tr></table>
<!--l. 2381--><p class="indent" >
</div>
</div>
<!--l. 2383--><p class="indent" >   Если предыдущее выражение находилось на верхнем уровне в
компилируемом файле, foo5 будет выведено во время компиляции. Если эта
форма была не на верхнем уровне, ничего не будет выведено во время
компиляции. Вне зависимости от контекста, ничего не будет выведено во
время загрузки или выполнения.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(eval-when (:execute :load-toplevel)
</td></tr></table>
<!--l. 2389--><p class="indent" >                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (eval-when (:compile-toplevel)</td></tr></table>
<!--l. 2390--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    (print &#x2019;foo6)))</td></tr></table>
<!--l. 2392--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 2394--><p class="indent" >   Если предыдущая форма находилась на верхнем уровне в компилируемом
файле, foo6 будет выведено во время компиляции. Если форма была не на
верхнем уровне, ничего не будет выведено во время компиляции. Вне
зависимости от контекста, ничего не будет выведение во время загрузки или
выполнения кода.
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 1095--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch6.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse29.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse29.html#tailclmse29.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse30.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch5.html#clmse30.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 1095--><p class="indent" >   <a 
 id="tailclmse30.html"></a>   
</body></html> 
