<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Substitution of Expressions</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-06 23:16:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 812--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse90.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse88.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse88.html#tailclmse88.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse89.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch15.html#clmse89.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">15.4   </span> <a 
 id="x109-69500015.4"></a>Substitution of Expressions</h3>
<a 
 id="dx109-695001"></a>
<!--l. 815--><p class="noindent" >A number of functions are provided for performing substitutions within a tree. All
take a tree and a description of old subexpressions to be replaced by new ones.
They come in non-destructive and destructive varieties and specify substitution
either by two arguments or by an association list.
<!--l. 821--><p class="indent" >   The naming conventions for these functions and for their keyword arguments
generally follow the conventions for the generic sequence functions. See
chapter <a 
href="clmch14.html#x99-42400014">14<!--tex4ht:ref: KSEQUE --></a>.
<div class=defun>
<!--l. 825--><p class="noindent" ><i>[Function]</i><a 
 id="dx109-695002"></a><a 
 id="x109-695003r511"></a><b> subst</b>  <i>new</i> <i>old</i> <i>tree</i> &#x0026;key  <i>:test</i> <i>:test-not</i> <i>:key</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx109-695004"></a><a 
 id="x109-695005r512"></a><b> subst-if</b>  <i>new</i> <i>test</i> <i>tree</i> &#x0026;key  <i>:key</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx109-695006"></a><a 
 id="x109-695007r513"></a><b> subst-if-not</b>  <i>new</i> <i>test</i> <i>tree</i> &#x0026;key  <i>:key</i>
<!--l. 829--><p class="noindent" ><span class="paragraphHead"><a 
 id="x109-696000513"></a></span>
   (subst new old tree) makes a copy of tree, substituting new for every subtree or
leaf of tree (whether the subtree or leaf is a car or a cdr of its parent) such that
old and the subtree or leaf satisfy the test. It returns the modiﬁed copy of tree.
The original tree is unchanged, but the result tree may share with parts of the
argument tree.
<div class=incompatibility>
<!--l. 839--><p class="noindent" ><span class="paragraphHead"><a 
 id="x109-69700015.4"></a></span>
   <b>Compatibility note:</b> In MacLisp, <a 
href="#x109-492003r511">subst</a> is guaranteed not to share with the
tree argument, and the idiom (subst <a 
href="clmse31.html#x42-86002r19">nil</a> <a 
href="clmse31.html#x42-86002r19">nil</a> x) was used to copy a tree x. In
Common Lisp, the function <a 
href="clmse87.html#x107-478002r499">copy-tree</a> should be used to copy a tree, as the <a 
href="#x109-492003r511">subst</a>
idiom will not work.
<!--l. 844--><p class="noindent" ><span class="paragraphHead"><a 
 id="x109-69800015.4"></a>
                                                                          

                                                                          
<!--l. 844--><p class="indent" >   </span>
   incompatibility
</div>
<!--l. 847--><p class="indent" >   For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(subst &#x2019;tempest &#x2019;hurricane
</td></tr></table>
<!--l. 849--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       &#x2019;(shakespeare wrote (the hurricane)))</td></tr></table>
<!--l. 850--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ (shakespeare wrote (the tempest))</td></tr></table>
<!--l. 851--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 852--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(subst &#x2019;foo &#x2019;<a 
href="clmse31.html#x42-86002r19">nil</a> &#x2019;(shakespeare wrote (twelfth night)))</td></tr></table>
<!--l. 853--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ (shakespeare wrote (twelfth night . foo) . foo)</td></tr></table>
<!--l. 854--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 855--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(subst &#x2019;(a . cons) &#x2019;(old . pair)</td></tr></table>
<!--l. 856--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       &#x2019;((old . spice) ((old . shoes) old . pair) (old . pair))</td></tr></table>
<!--l. 857--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">       :test #&#x2019;equal)</td></tr></table>
<!--l. 858--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ ((old . spice) ((old . shoes) a . cons) (a . cons))</td></tr></table>
<!--l. 860--><p class="indent" >
</div>
</div>
<!--l. 861--><p class="noindent" >This function is not destructive; that is, it does not change the car or cdr
of any already existing list structure. One possible deﬁnition of <a 
href="#x109-492003r511">subst</a>: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun subst (old new tree &#x0026;rest x &#x0026;key test test-not key)
</td></tr></table>
<!--l. 865--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (cond ((satisﬁes-the-test old tree :test test</td></tr></table>
<!--l. 866--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                             :test-not test-not :key key)</td></tr></table>
<!--l. 867--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">         new)</td></tr></table>
<!--l. 868--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        ((atom tree) tree)</td></tr></table>
<!--l. 869--><p class="indent" >                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        (t (let ((a (apply #&#x2019;subst old new (car tree) x))</td></tr></table>
<!--l. 870--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (d (apply #&#x2019;subst old new (cdr tree) x)))</td></tr></table>
<!--l. 871--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">             (if (and (eql a (car tree))</td></tr></table>
<!--l. 872--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                      (eql d (cdr tree)))</td></tr></table>
<!--l. 873--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 tree</td></tr></table>
<!--l. 874--><p class="indent" >                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                 (cons a d))))))</td></tr></table>
                                                                          

                                                                          
<!--l. 876--><p class="indent" >
</div>
</div>
<!--l. 877--><p class="noindent" >See also <a 
href="clmse83.html#x102-445004r424">substitute</a>, which substitutes for top-level elements of a sequence.
<div class=new>
<!--l. 881--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx109-698001"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-2000007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class=defun>
<!--l. 887--><p class="noindent" ><i>[Function]</i><a 
 id="dx109-698002"></a><a 
 id="x109-698003r514"></a><b> nsubst</b>  <i>new</i> <i>old</i> <i>tree</i> &#x0026;key  <i>:test</i> <i>:test-not</i> <i>:key</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx109-698004"></a><a 
 id="x109-698005r515"></a><b> nsubst-if</b>  <i>new</i> <i>test</i> <i>tree</i> &#x0026;key  <i>:key</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx109-698006"></a><a 
 id="x109-698007r516"></a><b> nsubst-if-not</b>  <i>new</i> <i>test</i> <i>tree</i> &#x0026;key  <i>:key</i>
<!--l. 891--><p class="noindent" ><span class="paragraphHead"><a 
 id="x109-699000516"></a></span>
   <a 
href="#x109-493003r514">nsubst</a> is a destructive version of <a 
href="#x109-492003r511">subst</a>. The list structure of tree is altered by
destructively replacing with new each leaf or subtree of the tree such that old and
the leaf or subtree satisfy the test.
<div class=new>
<!--l. 898--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx109-699001"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-2000007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class=defun>
<!--l. 904--><p class="noindent" ><i>[Function]</i><a 
 id="dx109-699002"></a><a 
 id="x109-699003r517"></a><b> sublis</b>  <i>alist</i> <i>tree</i> &#x0026;key  <i>:test</i> <i>:test-not</i> <i>:key</i>
<!--l. 906--><p class="noindent" ><span class="paragraphHead"><a 
 id="x109-700000517"></a></span>
   <a 
href="#x109-494003r517">sublis</a> makes substitutions for objects in a tree (a structure of conses). The
ﬁrst argument to <a 
href="#x109-494003r517">sublis</a> is an association list. The second argument is the tree in
which substitutions are to be made, as for <a 
href="#x109-492003r511">subst</a>. <a 
href="#x109-494003r517">sublis</a> looks at all subtrees and
leaves of the tree; if a subtree or leaf appears as a key in the association list (that
is, the key and the subtree or leaf satisfy the test), it is replaced by the object
with which it is associated. This operation is non-destructive. In eﬀect,
<a 
href="#x109-494003r517">sublis</a> can perform several <a 
href="#x109-492003r511">subst</a> operations simultaneously. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(sublis &#x2019;((x . 100) (z . zprime))
</td></tr></table>
                                                                          

                                                                          
<!--l. 920--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x2019;(plus x (minus g z x p) 4 . x))</td></tr></table>
<!--l. 921--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ (plus 100 (minus g zprime 100 p) 4 . 100)</td></tr></table>
<!--l. 922--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 923--><p class="indent" >                             <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(sublis &#x2019;(((+ x y) . (- x y)) ((- x y) . (+ x y)))</td></tr></table>
<!--l. 924--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        &#x2019;(* (/ (+ x y) (+ x p)) (- x y))</td></tr></table>
<!--l. 925--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        :test #&#x2019;equal)</td></tr></table>
<!--l. 926--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ (* (/ (- x y) (+ x p)) (+ x y))</td></tr></table>
<!--l. 928--><p class="indent" >
</div>
</div>
<div class=new>
<!--l. 931--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx109-700001"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-2000007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
<div class=defun>
<!--l. 937--><p class="noindent" ><i>[Function]</i><a 
 id="dx109-700002"></a><a 
 id="x109-700003r518"></a><b> nsublis</b>  <i>alist</i> <i>tree</i> &#x0026;key  <i>:test</i> <i>:test-not</i> <i>:key</i>
<!--l. 939--><p class="noindent" ><span class="paragraphHead"><a 
 id="x109-701000518"></a></span>
   <a 
href="#x109-495003r518">nsublis</a> is like <a 
href="#x109-494003r517">sublis</a> but destructively modiﬁes the relevant parts of the
tree.
<div class=new>
<!--l. 944--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx109-701001"></a>to restrict user side eﬀects; see section <a 
href="clmse43.html#x55-2000007.9">7.9<!--tex4ht:ref: STRUCTURE-TRAVERSAL-SECTION --></a>.
</div>
</div>
                                                                          

                                                                          
   <!--l. 950--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse90.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse88.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse88.html#tailclmse88.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse89.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch15.html#clmse89.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 950--><p class="indent" >   <a 
 id="tailclmse89.html"></a>  
</body></html> 
