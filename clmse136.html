<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Format Directive Interface</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-12 16:57:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 714--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse137.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse135.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse135.html#tailclmse135.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse136.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch26.html#clmse136.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">26.4   </span> <a 
href="clm.html#QQ2-167-366" id="x167-34400026.4">Format Directive
Interface</a></h3>
<!--l. 717--><p class="noindent" >The primary interface to operations for dynamically determining the arrangement
of output is provided through the functions above. However, an additional
interface is provided via a set of format directives because, as shown by the
examples in this section and the next, <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> strings are typically a much more
compact way to specify pretty printing. In addition, without such an interface,
one would have to abandon the use of <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> when interacting with the pretty
printer.
<div class=flushdesc>
<!--l. 726--><p class="indent" >
      <ul><li><b>
  <tt>~W</tt> </b></li><i>Write.</i>  An  <i>arg</i>,  any  Lisp  object,  is  printed  obeying  <i>every</i>  printer
      control  variable  (as  by  <tt><a 
href="clmse110.html#x137-258004r648">write</a></tt>).  In  addition,  <tt>~W</tt> interacts  correctly
      with depth abbreviation by not resetting the depth counter to zero.
      <tt>~W</tt> does  not  accept  parameters.  If  given  the  colon  modiﬁer,  <tt>~W</tt>
      binds  <tt><a 
href="clmse108.html#x135-252036r624">*print-pretty*</a></tt> to  <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt>.  If  given  the  atsign  modiﬁer,  <tt>~W</tt> binds
      <tt>*print-level*</tt> and <tt>*print-length*</tt> to <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
<tt>
      <!--l. 735--><p class="noindent" >~W</tt>  provides   automatic   support   for   circularity   detection.   If
      <tt><a 
href="clmse108.html#x135-252039r625">*print-circle*</a></tt> (and possibly also <tt>*print-shared*</tt>) is not <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> and
      <tt>~W</tt> is applied to an argument that is a circular (or shared) reference, an
      appropriate “<tt>#<i>n</i>#</tt>” marker is inserted in the output instead of printing
      the argument.
      <li><b>
  <tt>~_</tt> </b></li><i>Conditional  newline.</i>  Without  any  modiﬁers,  <tt>~_</tt> is  equivalent  to
      <tt>(pprint-newline :linear)</tt>.  The  directive  <tt>~@_</tt>  is  equivalent  to
      <tt>(pprint-newline :miser)</tt>.   The   directive   <tt>~:_</tt>  is   equivalent   to
      <tt>(pprint-newline :fill)</tt>.   The   directive   <tt>~:@_</tt>  is   equivalent   to
      <tt>(pprint-newline :mandatory)</tt>.
                                                                          

                                                                          
      <li><b>
<tt>~&#x003C;<i>str</i>~:&#x003E;</tt> </b></li><i>Logical  block.</i>  If  <tt>~:&#x003E;</tt> is  used  to  terminate  a  <tt>~&#x003C;...</tt> directive,
      the directive is equivalent to a call on <tt><a 
href="clmse135.html#x166-340005r809">pprint-logical-block</a></tt>. The
      <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> argument corresponding to the <tt>~&#x003C;...~:&#x003E;</tt> directive is treated
      in  the  same  way  as  the  <i>list</i>  argument  to  <tt><a 
href="clmse135.html#x166-340005r809">pprint-logical-block</a></tt>,
      thereby providing automatic support for non-list arguments and the
      detection of circularity, sharing, and depth abbreviation. The portion
      of  the  <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> control  string  nested  within  the  <tt>~&#x003C;...~:&#x003E;</tt> speciﬁes
      the  <tt>:prefix</tt> (or  <tt>:per-line-prefix</tt>),  <tt>:suffix</tt>,  and  body  of  the
      <tt><a 
href="clmse135.html#x166-340005r809">pprint-logical-block</a></tt>.
      <!--l. 764--><p class="noindent" >The <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> string portion enclosed by <tt>~&#x003C;...~:&#x003E;</tt> can be divided into
      segments  <tt>~&#x003C;<i>prefix</i>~;<i>body</i>~;suﬃx~:&#x003E;</tt> by  <tt>~;</tt> directives.  If  the  ﬁrst
      section is terminated by <tt>~@;</tt>, it speciﬁes a per-line preﬁx rather than a
      simple preﬁx. The preﬁx and suﬃx cannot contain <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> directives.
      An error is signaled if either the preﬁx or suﬃx fails to be a constant
      string  or  if  the  enclosed  portion  is  divided  into  more  than  three
      segments.
      <!--l. 772--><p class="noindent" >If the enclosed portion is divided into only two segments, the suﬃx
      defaults to the null string. If the enclosed portion consists of only a
      single segment, both the preﬁx and the suﬃx default to the null string.
      If the colon modiﬁer is used (that is, <tt>~:&#x003C;...~:&#x003E;</tt>), the preﬁx and suﬃx
      default to <tt>&#x0022;(&#x0022;</tt> and <tt>&#x0022;)&#x0022;</tt>, respectively, instead of the null string.
      <!--l. 779--><p class="noindent" >The  body  segment  can  be  any  arbitrary  <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> control  string.
      This  <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> control  string  is  applied  to  the  elements  of  the  list
      corresponding  to  the  <tt>~&#x003C;...~:&#x003E;</tt> directive  as  a  whole.  Elements  are
      extracted from this list using <tt><a 
href="clmse135.html#x166-342002r811">pprint-pop</a></tt>, thereby providing automatic
      support for malformed lists and the detection of circularity, sharing,
      and  length  abbreviation.  Within  the  body  segment,  <tt>~̂</tt> acts  like
      <tt><a 
href="clmse135.html#x166-341002r810">pprint-exit-if-list-exhausted</a></tt>.
<tt>
      <!--l. 787--><p class="noindent" >~&#x003C;...~:&#x003E;</tt>    supports      a      feature      not      supported      by
      <tt><a 
href="clmse135.html#x166-340005r809">pprint-logical-block</a></tt>. If <tt>~:@&#x003E;</tt> is used to terminate the directive (that
      is, <tt>~&#x003C;...~:@&#x003E;</tt>), then a ﬁll-style conditional newline is automatically
      inserted after each group of blanks immediately contained in the body
      (except for blanks after a <tt>~&#x003C;newline&#x003E;</tt> directive). This makes it easy to
      achieve the equivalent of paragraph ﬁlling.
                                                                          

                                                                          
      <!--l. 795--><p class="noindent" >If  the  atsign  modiﬁer  is  used  with  <tt>~&#x003C;...~:&#x003E;</tt>,  the  entire  remaining
      argument list is passed to the directive as its argument. All of the
      remaining arguments are always consumed by <tt>~@&#x003C;...~:&#x003E;</tt>, even if they
      are not all used by the <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> string nested in the directive. Other
      than the diﬀerence in its argument, <tt>~@&#x003C;...~:&#x003E;</tt> is exactly the same as
      <tt>~&#x003C;...~:&#x003E;</tt>, except that circularity (and sharing) detection is not applied
      if the <tt>~@&#x003C;...~:&#x003E;</tt> is at top level in a <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> string. This ensures that
      circularity detection is applied only to data lists and not to <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt>
      argument lists.
      <!--l. 806--><p class="noindent" >To a considerable extent, the basic form of the directive <tt>~&#x003C;...~&#x003E;</tt> is
      incompatible with the dynamic control of the arrangement of output
      by <tt>~W</tt>, <tt>~_</tt>, <tt>~&#x003C;...~:&#x003E;</tt>, <tt>~I</tt>, and <tt>~:T</tt>. As a result, an error is signaled if
      any of these directives is nested within <tt>~&#x003C;...~&#x003E;</tt>. Beyond this, an error
      is also signaled if the <tt>~&#x003C;...~:;...~&#x003E;</tt> form of <tt>~&#x003C;...~&#x003E;</tt> is used in the
      same <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> string with <tt>~W</tt>, <tt>~_</tt>, <tt>~&#x003C;...~:&#x003E;</tt>, <tt>~I</tt>, or <tt>~:T</tt>.
      <li><b>
  <tt>~I</tt> </b></li><i>Indent.</i>  <tt>~<i>n</i>I</tt> is  equivalent  to  <tt>(pprint-indent :block <i>n</i>)</tt>.  <tt>~:<i>n</i>I</tt> is
      equivalent to <tt>(pprint-indent :current <i>n</i>)</tt>. In both cases, <i>n</i> defaults
      to zero if it is omitted.
      <li><b>
 <tt>~:T</tt> </b></li><i>Tabulate.</i>  If  the  colon  modiﬁer  is  used  with  the  <tt>~T</tt> directive,  the
      tabbing computation is done relative to the column where the section
      immediately containing the directive begins, rather than with respect to
      column zero. <tt>~<i>n</i>,<i>m</i>:T</tt> is equivalent to <tt>(pprint-tab :section <i>n</i> <i>m</i>)</tt>.
      <tt>~<i>n</i>,<i>m</i>:@T</tt> is  equivalent  to  <tt>(pprint-tab :section-relative <i>n</i> <i>m</i>)</tt>.
      The numerical parameters are both interpreted as being in units of ems
      and both default to 1.
      <li><b>
<tt>~/<i>name</i>/</tt> </b></li><i>Call function.</i> User-deﬁned functions can be called from within
      a <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> string by using the directive <tt>~/<i>name</i>/</tt>. The colon modiﬁer,
      the atsign modiﬁer, and arbitrarily many parameters can be speciﬁed
      with the <tt>~/<i>name</i>/</tt> directive. The <i>name</i> can be any string that does not
      contain “<tt><a 
href="clmse104.html#x129-237016r575">/</a></tt>”. All of the characters in <i>name</i> are treated as if they were
      upper case. If <i>name</i> contains a “<tt>:</tt>” or “<tt>::</tt>”, then everything up to but
      not including the ﬁrst “<tt>:</tt>” or “<tt>::</tt>” is taken to be a string that names a
                                                                          

                                                                          
      package. Everything after the ﬁrst “<tt>:</tt>” or “<tt>::</tt>” (if any) is taken to be a
      string that names a symbol. The function corresponding to a <tt>~/<i>name</i>/</tt>
      directive is obtained by looking up the symbol that has the indicated
      name in the indicated package. If <i>name</i> does not contain a “<tt>:</tt>” or “<tt>::</tt>”,
      then the whole name string is looked up in the <tt>user</tt> package.
      <!--l. 851--><p class="noindent" >When a <tt>~/<i>name</i>/</tt> directive is encountered, the indicated function is
      called with four or more arguments. The ﬁrst four arguments are the
      output stream, the <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt> argument corresponding to the directive,
      the value <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> if the colon modiﬁer was used (<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> otherwise), and the
      value <tt><a 
href="clmse30.html#x41-73004r19">t</a></tt> if the atsign modiﬁer was used (<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> otherwise). The remaining
      arguments consist of any parameters speciﬁed with the directive. The
      function should print the argument appropriately. Any values returned
      by the function are ignored.
      <!--l. 860--><p class="noindent" >The                three                functions                <tt><a 
href="clmse135.html#x166-343008r815">pprint-linear</a></tt>,
      <tt><a 
href="clmse135.html#x166-343006r814">pprint-fill</a></tt>,  and  <tt><a 
href="clmse135.html#x166-343010r816">pprint-tabular</a></tt> are  designed  so  that  they  can
      be called by <tt>~/.../</tt> (that is, <tt>~/pprint-linear/</tt>, <tt>~/pprint-fill/</tt>,
      and  <tt>~/pprint-tabular/</tt>.  In  particular  they  take  colon  and  atsign
      arguments.</ul>
</div>
<!--l. 867--><p class="indent" >   As examples of the convenience of specifying pretty printing with <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt>
strings, consider the functions <tt>pprint-defun</tt> and <tt>pprint-let</tt> used as examples
in the last section. They can be more compactly deﬁned as follows. The
function <tt>pprint-vector</tt> cannot be deﬁned using <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt>, because the
data structure it traverses is not a list. The function <tt><a 
href="clmse135.html#x166-343010r816">pprint-tabular</a></tt> is
inconvenient to deﬁne using <tt><a 
href="clmse110.html#x137-261003r667">format</a></tt>, because of the need to pass its <tt>tabsize</tt>
argument through to a <tt>~:T</tt> directive nested within an iteration over a list.
<div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun pprint-defun (list)
</td></tr></table>
<!--l. 877--><p class="indent" >           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format t &#x0022;~:&#x003C;~W ~@_~:I~W ~:_~W~1I ~_~W~:&#x003E;&#x0022; list))</td></tr></table>
<!--l. 880--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 881--><p class="indent" >                                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun pprint-let (list)</td></tr></table>
<!--l. 882--><p class="indent" >   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (format t &#x0022;~:&#x003C;~W~̂ ~:&#x003C;~@{~:&#x003C;~@{~W~̂ ~_~}~:&#x003E;~̂ ~:_~}~:&#x003E;~1I~</td></tr></table>
<!--l. 886--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                ~@{~̂ ~_~W~}~:&#x003E;&#x0022;</td></tr></table>
<!--l. 887--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">          list))</td></tr></table>
                                                                          

                                                                          
<!--l. 889--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 891--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse137.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse135.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse135.html#tailclmse135.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse136.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch26.html#clmse136.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse136.html"></a>  </div> </div> 
</body></html> 
