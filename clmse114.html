<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Operations on Streams Операции над потоками</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-10 13:43:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 690--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch22.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html#tailclmse113.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse114.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse114.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">21.3   </span> <a 
 id="x140-27000021.3"></a>Operations on Streams Операции над потоками</h3>
<!--l. 692--><p class="noindent" >This section contains discussion of only those operations that are common to all
streams. Input and output is rather complicated and is discussed separately in
chapter <a 
href="clmch22.html#x141-27100022">22<!--tex4ht:ref: IO --></a>. The interface between streams and the ﬁle system is discussed in
chapter <a 
href="clmch23.html#x146-28900023">23<!--tex4ht:ref: FILES --></a>.
<!--l. 698--><p class="indent" >   В этом разделе описаны только те функции, которые работают со всеми
потоки. Ввод и вывод информации слегка сложнее и описаны отдельно в
главе <a 
href="clmch22.html#x141-27100022">22<!--tex4ht:ref: IO --></a>. Интерфейс между потоками и файловой системой описан в
главе <a 
href="clmch23.html#x146-28900023">23<!--tex4ht:ref: FILES --></a>
<div class=defun>
<!--l. 703--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270001"></a><a 
 id="x140-270002r656"></a><b> streamp</b>  <i>object</i>
<!--l. 705--><p class="noindent" ><a 
href="#x140-270002r656">streamp</a> is true if its argument is a stream, and otherwise is false. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(streamp x)  ≡ (typep x &#x2019;stream)
</td></tr></table>
<!--l. 710--><p class="indent" >
</div>
</div>
<!--l. 712--><p class="indent" >   <a 
href="#x140-270002r656">streamp</a> истинен, если его аргумент является потоком, иначе ложен. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(streamp x)  ≡ (typep x &#x2019;stream)
</td></tr></table>
<!--l. 715--><p class="indent" >
</div>
</div>
<div class=new>
                                                                          

                                                                          
<!--l. 718--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx140-270003"></a>to specify that <a 
href="#x140-270002r656">streamp</a> is unaﬀected by
whether its argument, if a stream, is open or closed. In either case it returns
true.
</div>
</div>
<div class=newer>
<div class=defun>
<!--l. 727--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270004"></a><a 
 id="x140-270005r657"></a><b> open-stream-p</b>  <i>stream</i>
<!--l. 729--><p class="noindent" >X3J13 voted in January 1989 <a 
 id="dx140-270006"></a>to add the predicate <a 
href="#x140-270005r657">open-stream-p</a>. It is
true if its argument (which must be a stream) is open, and otherwise is
false.
<!--l. 735--><p class="indent" >   A stream is always created open; it remains open until closed with the
<a 
href="#x140-270014r661">close</a> function. The macros <a 
href="clmse113.html#x139-265029r652">with-open-stream</a>, <a 
href="clmse113.html#x139-266003r653">with-input-from-string</a>,
<a 
href="clmse113.html#x139-268003r655">with-output-to-string</a>, and <a 
href="clmse120.html#x148-302012r769">with-open-ﬁle</a> automatically close the created stream
as control leaves their bodies, in eﬀect imposing dynamic extent on the openness
of the stream.
<!--l. 742--><p class="indent" >   Добавлен предикат <a 
href="#x140-270005r657">open-stream-p</a>. Если аргумент, который должен быть
потоком, открыт, предикат истинен, иначе ложен.
<!--l. 746--><p class="indent" >   Поток всегда создается открытым. Он продолжает быть открытым, пока
не будет закрыт с помощью функции <a 
href="#x140-270014r661">close</a>. Макросы <a 
href="clmse113.html#x139-265029r652">with-open-stream</a>,
<a 
href="clmse113.html#x139-266003r653">with-input-from-string</a>, <a 
href="clmse113.html#x139-268003r655">with-output-to-string</a> и <a 
href="clmse120.html#x148-302012r769">with-open-ﬁle</a> автоматически
закрывают созданный поток, когда управление выходит из их тел, по сути
открытость совпадает с динамической продолжительностью видимости
потока.
</div>
</div>
<div class=defun>
<!--l. 754--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270007"></a><a 
 id="x140-270008r658"></a><b> input-stream-p</b>  <i>stream</i>
<!--l. 756--><p class="noindent" >This predicate is true if its argument (which must be a stream) can handle input
operations, and otherwise is false.
<!--l. 760--><p class="indent" >   Если аргумент, который должен быть потоком, может работать для
чтения, предикат истинен, иначе ложен.
</div>
<div class=defun>
<!--l. 764--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270009"></a><a 
 id="x140-270010r659"></a><b> output-stream-p</b>  <i>stream</i>
<!--l. 766--><p class="noindent" >This predicate is true if its argument (which must be a stream) can handle output
operations, and otherwise is false.
<!--l. 770--><p class="indent" >   Если аргумент, который должен быть потоком, может работать для
                                                                          

                                                                          
записи, предикат истинен, иначе ложен.
</div>
<div class=defun>
<!--l. 775--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270011"></a><a 
 id="x140-270012r660"></a><b> stream-element-type</b>  <i>stream</i>
<!--l. 777--><p class="noindent" >A type speciﬁer is returned to indicate what objects may be read from or
written to the argument <i>stream</i>, which must be a stream. Streams created
by <a 
href="clmse120.html#x148-302002r768">open</a> will have an element type restricted to a subset of <a 
href="clmse79.html#x97-215002r384">character</a> or
integer, but in principle a stream may conduct transactions using any Lisp
objects.
<!--l. 785--><p class="indent" >   Функция возвращает спецификатор типа, который указывает на то, какие
объекты могут быть прочитаны или записаны из/в поток <i>stream</i>. Потоки
созданные с помощью <a 
href="clmse120.html#x148-302002r768">open</a> будут иметь тип элементов, ограниченный
подможеством <a 
href="clmse79.html#x97-215002r384">character</a> или integer. Но в приципе поток может проводить
операции используя любые Lisp&#x2019;овые объекты.
</div>
<div class=defun>
<!--l. 792--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270013"></a><a 
 id="x140-270014r661"></a><b> close</b>  <i>stream</i> &#x0026;key  <i>:abort</i>
<!--l. 794--><p class="noindent" >The argument must be a stream. The stream is closed. No further input/output
operations may be performed on it. However, certain inquiry operations
may still be performed, and it is permissible to close an already closed
stream.
<!--l. 800--><p class="indent" >   Аргумент должен быть потоком. Функцией этот поток закрывается. После
чего операции чтения и записи выполняться над ним не могут. Однако,
конечно, некоторые операци все еще могут выполняться. Допускается
повторное закрытие уже закрытого потока.
<div class=newer>
<!--l. 806--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx140-270015"></a>and revised the vote in March 1989 to specify
that if <a 
href="#x140-270014r661">close</a> is called on an open stream, the stream is closed and <a 
href="clmse31.html#x42-77004r20">t</a> is returned;
but if <a 
href="#x140-270014r661">close</a> is called on a closed stream, it succeeds without error and returns an
unspeciﬁed value. (The rationale for not specifying the value returned for a closed
stream is that in some implementations closing certain streams does not really
have an eﬀect on them—for example, closing the <a 
href="clmse112.html#x138-264012r641">*terminal-io*</a> stream might not
“really” close it—and it is not desirable to force such implementations to keep
otherwise unnecessary state. Portable programs will of course not rely on such
behavior.)
<!--l. 821--><p class="indent" >   X3J13 also voted in January 1989 to specify exactly which inquiry functions
may be applied to closed streams: <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" > <a 
href="#x140-270002r656">streamp</a>             </td><td align="left" ><a 
href="clmse119.html#x147-301056r756">pathname-host</a>      </td><td align="left" ><a 
href="clmse119.html#x147-301069r762">namestring</a>             </td>
</tr><tr><td align="left" > <a 
href="clmse119.html#x147-301005r742">pathname</a>          </td><td align="left" ><a 
href="clmse119.html#x147-301058r757">pathname-device</a>    </td><td align="left" ><a 
href="clmse119.html#x147-301071r763">ﬁle-namestring</a>        </td>
</tr><tr><td align="left" > <a 
href="clmse119.html#x147-301010r743">truename</a>           </td><td align="left" ><a 
href="clmse119.html#x147-301060r758">pathname-directory</a></td><td align="left" ><a 
href="clmse119.html#x147-301073r764">directory-namestring</a></td>
</tr><tr><td align="left" > <a 
href="clmse119.html#x147-301022r745">merge-pathnames</a></td><td align="left" ><a 
href="clmse119.html#x147-301062r759">pathname-name</a>     </td><td align="left" ><a 
href="clmse119.html#x147-301075r765">host-namestring</a>      </td>
</tr><tr><td align="left" > <a 
href="clmse120.html#x148-302002r768">open</a>                 </td><td align="left" ><a 
href="clmse119.html#x147-301064r760">pathname-type</a>      </td><td align="left" ><a 
href="clmse119.html#x147-301077r766">enough-namestring</a>  </td>
</tr><tr><td align="left" > <a 
href="clmse121.html#x149-304012r772">probe-ﬁle</a>           </td><td align="left" ><a 
href="clmse119.html#x147-301066r761">pathname-version</a>   </td><td align="left" ><a 
href="clmse123.html#x151-306002r785">directory</a>                </td>
</tr><tr><td align="left" >                        </td></tr></table>                                                        </div>
</td></tr></table><!--l. 832--><p class="indent" >
</div>
<!--l. 833--><p class="noindent" >See the individual descriptions of these functions for more information on how they
operate on closed streams.
</div>
<div class=new>
<!--l. 838--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx140-270016"></a>to clarify the eﬀect of closing various kinds of
streams. First some terminology:
      <ul class="itemize1">
      <li class="itemize">A         <i>composite</i>        stream         is         one         that         was
      returned by a call to make-synonym-stream, <a 
href="clmse113.html#x139-265005r644">make-broadcast-stream</a>,
      <a 
href="clmse113.html#x139-265008r645">make-concatenated-stream</a>,            make-two-way-stream,            or
      make-echo-stream.
      </li>
      <li class="itemize">The  <i>constituents</i> of  a  composite  stream  are  the  streams  that  were
      given as arguments to the function that constructed it or, in the case
      of make-synonym-stream, the stream that is the <a 
href="clmse35.html#x47-89005r55">symbol-value</a> of the
      symbol that was given as an argument. (The constituent of a synonym
      stream may therefore vary over time.)
      </li>
      <li class="itemize">A <i>constructed</i> stream is either a composite stream or one returned
      by  a  call  to  <a 
href="clmse113.html#x139-265018r648">make-string-input-stream</a>,  <a 
href="clmse113.html#x139-265024r650">make-string-output-stream</a>,
      with-input-from-string, or <a 
href="clmse113.html#x139-268003r655">with-output-to-string</a>.</li></ul>
<!--l. 865--><p class="indent" >   The eﬀect of applying <a 
href="#x140-270014r661">close</a> to a constructed stream is to close that stream
only. No input/output operations are permitted on the constructed stream once it
has been closed (though certain inquiry functions are still permitted, as described
above).
<!--l. 870--><p class="indent" >   Closing a composite stream has no eﬀect on its constituents; any constituents
that are open remain open.
                                                                          

                                                                          
<!--l. 873--><p class="indent" >   If a stream created by <a 
href="clmse113.html#x139-265024r650">make-string-output-stream</a> is closed, the result of then
applying <a 
href="clmse113.html#x139-265027r651">get-output-stream-string</a> to the stream is unspeciﬁed.
</div>
<!--l. 878--><p class="indent" >   If the :abort parameter is not <a 
href="clmse31.html#x42-77002r19">nil</a> (it defaults to <a 
href="clmse31.html#x42-77002r19">nil</a>), it indicates an abnormal
termination of the use of the stream. An attempt is made to clean up any side
eﬀects of having created the stream in the ﬁrst place. For example, if the stream
performs output to a ﬁle that was newly created when the stream was created,
then if possible the ﬁle is deleted and any previously existing ﬁle is not
superseded.
<!--l. 885--><p class="indent" >   Если параметр :abort не-<a 
href="clmse31.html#x42-77002r19">nil</a> (а по-умолчанию он <a 
href="clmse31.html#x42-77002r19">nil</a>), то он указывает на
ненормальное завершение использования потока. Осуществляется попытка
убрать все побочные эффекты, созданные потоком. Например, если поток
выполнял вывод в файл, который был создан вместе с потоком, тогда, если
возможно, файл удаляется и любой ранее существовавший файл не
заменяется.
</div>
<div class=new>
<!--l. 894--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx140-270017"></a>to add the following accessor functions for
obtaining information about streams.
<div class=defun>
<!--l. 900--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270018"></a><a 
 id="x140-270019r662"></a><b> broadcast-stream-streams</b>  <i>broadcast-stream</i>
<!--l. 902--><p class="noindent" >The argument must be of type broadcast-stream. A list of the constituent output
streams (whether open or not) is returned.
<!--l. 906--><p class="indent" >   Аргумент должен быть типа broadcast-stream. Функцией возвращается
список потоков для записи (и открытых, и нет).
</div>
<div class=defun>
<!--l. 911--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270020"></a><a 
 id="x140-270021r663"></a><b> concatenated-stream-streams</b>  <i>concatenated-stream</i>
<!--l. 913--><p class="noindent" >The argument must be of type concatenated-stream. A list of constituent streams
(whether open or not) is returned. This list represents the ordered set of input
streams from which the concatenated stream may yet read; the stream from which
it is currently reading is ﬁrst in the list. The list may be empty if no more streams
remain to be read.
<!--l. 921--><p class="indent" >   Аргумент должен быть типа concatenated-stream. Функцией возвращается
список потоков (и открытых, и нет). Этот список отображает упорядоченное
множество потоков для чтения, из которых поток <i>concatenated-stream</i> все еще
может получать данные. Поток, из которого в данный момент читались
данные, находится в начале списока. Если потоков для чтения нет, список
                                                                          

                                                                          
может быть пустым.
</div>
<div class=defun>
<!--l. 930--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270022"></a><a 
 id="x140-270023r664"></a><b> echo-stream-input-stream</b>  <i>echo-stream</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx140-270024"></a><a 
 id="x140-270025r665"></a><b> echo-stream-output-stream</b>  <i>echo-stream</i>
<!--l. 933--><p class="noindent" >The argument must be of type echo-stream. The function <a 
href="#x140-270023r664">echo-stream-input-stream</a>
returns the constituent input stream; <a 
href="#x140-270025r665">echo-stream-output-stream</a> returns the
constituent output stream.
<!--l. 939--><p class="indent" >   Аргумент должен быть типа echo-stream. Функция <a 
href="#x140-270023r664">echo-stream-input-stream</a>
возвращает список потоков для чтения. <a 
href="#x140-270025r665">echo-stream-output-stream</a> возвращает
список потоков для записи.
</div>
<div class=defun>
<!--l. 945--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270026"></a><a 
 id="x140-270027r666"></a><b> synonym-stream-symbol</b>  <i>synonym-stream</i>
<!--l. 947--><p class="noindent" >The argument must be of type synonym-stream. This function returns the symbol
for whose value the <i>synonym-stream</i> is a synonym.
<!--l. 951--><p class="indent" >   Аргумент должен быть типа synonyn-stream. Эта функция возвращает
символ, значение которого является потоком для потока-синонима
<i>synonym-stream</i>.
</div>
<div class=defun>
<!--l. 956--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270028"></a><a 
 id="x140-270029r667"></a><b> two-way-stream-input-stream</b>  <i>two-way-stream</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx140-270030"></a><a 
 id="x140-270031r668"></a><b> two-way-stream-output-stream</b>  <i>two-way-stream</i>
<!--l. 959--><p class="noindent" >The argument must be of type two-way-stream. The function
<a 
href="#x140-270029r667">two-way-stream-input-stream</a> returns the constituent input stream;
<a 
href="#x140-270031r668">two-way-stream-output-stream</a> returns the constituent output stream.
<!--l. 965--><p class="indent" >   Аргумент должен быть типа two-way-stream. Функция
<a 
href="#x140-270029r667">two-way-stream-input-stream</a> возвращает список потоков для чтения.
<a 
href="#x140-270031r668">two-way-stream-output-stream</a> возвращает список потоков для записи.
</div>
</div>
<div class=newer>
<div class=defun>
<!--l. 972--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270032"></a><a 
 id="x140-270033r669"></a><b> interactive-stream-p</b>  <i>stream</i>
<!--l. 974--><p class="noindent" >X3J13 voted in June 1989 <a 
 id="dx140-270034"></a>to add the predicate <a 
href="#x140-270033r669">interactive-stream-p</a>, which
returns <a 
href="clmse31.html#x42-77004r20">t</a> if the <i>stream</i> is interactive and otherwise returns <a 
href="clmse31.html#x42-77002r19">nil</a>. A type-error error
is signalled if the argument is not of type stream.
<!--l. 980--><p class="indent" >   The precise meaning of <a 
href="#x140-270033r669">interactive-stream-p</a> is implementation-dependent and
                                                                          

                                                                          
may depend on the underlying operating system. The intent is to distinguish
between interactive and batch (background, command-ﬁle) operations. Some
characteristics that might distinguish a stream as interactive:
      <ul class="itemize1">
      <li class="itemize">The stream is connected to a person (or the equivalent) in such a way
      that the program can prompt for information and expect to receive
      input that might depend on the prompt.
      </li>
      <li class="itemize">The program is expected to prompt for input and to support “normal
      input editing protocol” for that operating environment.
      </li>
      <li class="itemize">A call to <a 
href="clmse116.html#x143-281015r701">read-char</a> might hang waiting for the user to type something
      rather than quickly returning a character or an end-of-ﬁle indication.</li></ul>
<!--l. 995--><p class="noindent" >The value of <a 
href="clmse112.html#x138-264012r641">*terminal-io*</a> might or might not be interactive.
</div>
</div>
<div class=newer>
<div class=defun>
<!--l. 1000--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-270035"></a><a 
 id="x140-270036r670"></a><b> stream-external-format</b>  <i>stream</i>
<!--l. 1002--><p class="noindent" >X3J13 voted in June 1989 <a 
 id="dx140-270037"></a>to add the function <a 
href="#x140-270036r670">stream-external-format</a>, which
returns a speciﬁer for the implementation-recognized scheme used for representing
characters in the argument <i>stream</i>. See the :external-format argument to
<a 
href="clmse120.html#x148-302002r768">open</a>.
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 7--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch22.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html#tailclmse113.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse114.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse114.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 7--><p class="indent" >   <a 
 id="tailclmse114.html"></a>  
</body></html> 
