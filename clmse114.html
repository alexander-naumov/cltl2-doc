<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Operations on Streams</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-06 23:16:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 498--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch22.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html#tailclmse113.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse114.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse114.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">21.3   </span> <a 
 id="x140-85200021.3"></a>Operations on Streams</h3>
<!--l. 500--><p class="noindent" >This section contains discussion of only those operations that are common to all
streams. Input and output is rather complicated and is discussed separately in
chapter <a 
href="clmch22.html#x141-63300022">22<!--tex4ht:ref: IO --></a>. The interface between streams and the ﬁle system is discussed in
chapter <a 
href="clmch23.html#x146-69900023">23<!--tex4ht:ref: FILES --></a>.
<div class=defun>
<!--l. 506--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-852001"></a><a 
 id="x140-852002r656"></a><b> streamp</b>  <i>object</i>
<!--l. 508--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-853000656"></a></span>
   <a 
href="#x140-619002r656">streamp</a> is true if its argument is a stream, and otherwise is false. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(streamp x)  ≡ (typep x &#x2019;stream)
</td></tr></table>
<!--l. 513--><p class="indent" >
</div>
</div>
<div class=new>
<!--l. 516--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx140-853001"></a>to specify that <a 
href="#x140-619002r656">streamp</a> is unaﬀected by
whether its argument, if a stream, is open or closed. In either case it returns
true.
</div>
</div>
<div class=newer>
<div class=defun>
<!--l. 525--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-853002"></a><a 
 id="x140-853003r657"></a><b> open-stream-p</b>  <i>stream</i>
<!--l. 527--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-854000657"></a></span>
   X3J13 voted in January 1989 <a 
 id="dx140-854001"></a>to add the predicate <a 
href="#x140-620003r657">open-stream-p</a>. It is
                                                                          

                                                                          
true if its argument (which must be a stream) is open, and otherwise is
false.
<!--l. 533--><p class="indent" >   A stream is always created open; it remains open until closed with the
<a 
href="#x140-624002r661">close</a> function. The macros <a 
href="clmse113.html#x139-614002r652">with-open-stream</a>, <a 
href="clmse113.html#x139-615003r653">with-input-from-string</a>,
<a 
href="clmse113.html#x139-617003r655">with-output-to-string</a>, and <a 
href="clmse120.html#x148-734010r769">with-open-ﬁle</a> automatically close the created stream
as control leaves their bodies, in eﬀect imposing dynamic extent on the openness
of the stream.
</div>
</div>
<div class=defun>
<!--l. 542--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-854002"></a><a 
 id="x140-854003r658"></a><b> input-stream-p</b>  <i>stream</i>
<!--l. 544--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-855000658"></a></span>
   This predicate is true if its argument (which must be a stream) can handle
input operations, and otherwise is false.
</div>
<div class=defun>
<!--l. 549--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-855001"></a><a 
 id="x140-855002r659"></a><b> output-stream-p</b>  <i>stream</i>
<!--l. 551--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-856000659"></a></span>
   This predicate is true if its argument (which must be a stream) can handle
output operations, and otherwise is false.
</div>
<div class=defun>
<!--l. 557--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-856001"></a><a 
 id="x140-856002r660"></a><b> stream-element-type</b>  <i>stream</i>
<!--l. 559--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-857000660"></a></span>
   A type speciﬁer is returned to indicate what objects may be read from or
written to the argument stream, which must be a stream. Streams created
by <a 
href="clmse120.html#x148-733002r768">open</a> will have an element type restricted to a subset of <a 
href="clmse79.html#x97-412002r384">character</a> or
integer, but in principle a stream may conduct transactions using any Lisp
objects.
</div>
<div class=defun>
<!--l. 568--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-857001"></a><a 
 id="x140-857002r661"></a><b> close</b>  <i>stream</i> &#x0026;key  <i>:abort</i>
                                                                          

                                                                          
<!--l. 570--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-858000661"></a></span>
   The argument must be a stream. The stream is closed. No further
input/output operations may be performed on it. However, certain inquiry
operations may still be performed, and it is permissible to close an already closed
stream.
<div class=newer>
<!--l. 577--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx140-858001"></a>and revised the vote in March 1989 to specify
that if <a 
href="#x140-624002r661">close</a> is called on an open stream, the stream is closed and <a 
href="clmse31.html#x42-87002r20">t</a> is returned;
but if <a 
href="#x140-624002r661">close</a> is called on a closed stream, it succeeds without error and returns an
unspeciﬁed value. (The rationale for not specifying the value returned for a closed
stream is that in some implementations closing certain streams does not really
have an eﬀect on them—for example, closing the *terminal-io* stream might not
“really” close it—and it is not desirable to force such implementations to keep
otherwise unnecessary state. Portable programs will of course not rely on such
behavior.)
<!--l. 592--><p class="indent" >   X3J13 also voted in January 1989 to specify exactly which inquiry functions
may be applied to closed streams: <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" > <a 
href="#x140-619002r656">streamp</a>             </td><td align="left" ><a 
href="clmse119.html#x147-729006r756">pathname-host</a>      </td><td align="left" ><a 
href="clmse119.html#x147-730003r762">namestring</a>             </td>
</tr><tr><td align="left" > <a 
href="clmse119.html#x147-720005r742">pathname</a>          </td><td align="left" ><a 
href="clmse119.html#x147-729008r757">pathname-device</a>    </td><td align="left" ><a 
href="clmse119.html#x147-730005r763">ﬁle-namestring</a>        </td>
</tr><tr><td align="left" > <a 
href="clmse119.html#x147-721005r743">truename</a>           </td><td align="left" ><a 
href="clmse119.html#x147-729010r758">pathname-directory</a></td><td align="left" ><a 
href="clmse119.html#x147-730007r764">directory-namestring</a></td>
</tr><tr><td align="left" > <a 
href="clmse119.html#x147-723005r745">merge-pathnames</a></td><td align="left" ><a 
href="clmse119.html#x147-729012r759">pathname-name</a>     </td><td align="left" ><a 
href="clmse119.html#x147-730009r765">host-namestring</a>      </td>
</tr><tr><td align="left" > <a 
href="clmse120.html#x148-733002r768">open</a>                 </td><td align="left" ><a 
href="clmse119.html#x147-729014r760">pathname-type</a>      </td><td align="left" ><a 
href="clmse119.html#x147-730011r766">enough-namestring</a>  </td>
</tr><tr><td align="left" > <a 
href="clmse121.html#x149-738005r772">probe-ﬁle</a>           </td><td align="left" ><a 
href="clmse119.html#x147-729016r761">pathname-version</a>   </td><td align="left" ><a 
href="clmse123.html#x151-753002r785">directory</a>                </td>
</tr><tr><td align="left" >                        </td></tr></table>                                                        </div>
</td></tr></table><!--l. 603--><p class="indent" >
</div>
<!--l. 604--><p class="noindent" >See the individual descriptions of these functions for more information on how they
operate on closed streams.
</div>
<div class=new>
<!--l. 609--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx140-858002"></a>to clarify the eﬀect of closing various kinds of
streams. First some terminology:
      <ul class="itemize1">
      <li class="itemize">A         composite        stream         is         one         that         was
      returned by a call to make-synonym-stream, <a 
href="clmse113.html#x139-606003r644">make-broadcast-stream</a>,
      <a 
href="clmse113.html#x139-607003r645">make-concatenated-stream</a>,            make-two-way-stream,            or
      make-echo-stream.
                                                                          

                                                                          
      </li>
      <li class="itemize">The  constituents of  a  composite  stream  are  the  streams  that  were
      given as arguments to the function that constructed it or, in the case
      of make-synonym-stream, the stream that is the <a 
href="clmse35.html#x47-130005r55">symbol-value</a> of the
      symbol that was given as an argument. (The constituent of a synonym
      stream may therefore vary over time.)
      </li>
      <li class="itemize">A  constructed stream  is  either  a  composite  stream  or  one  returned
      by  a  call  to  <a 
href="clmse113.html#x139-610004r648">make-string-input-stream</a>,  <a 
href="clmse113.html#x139-612003r650">make-string-output-stream</a>,
      with-input-from-string, or <a 
href="clmse113.html#x139-617003r655">with-output-to-string</a>.</li></ul>
<!--l. 636--><p class="indent" >   The eﬀect of applying <a 
href="#x140-624002r661">close</a> to a constructed stream is to close that stream
only. No input/output operations are permitted on the constructed stream once it
has been closed (though certain inquiry functions are still permitted, as described
above).
<!--l. 641--><p class="indent" >   Closing a composite stream has no eﬀect on its constituents; any constituents
that are open remain open.
<!--l. 644--><p class="indent" >   If a stream created by <a 
href="clmse113.html#x139-612003r650">make-string-output-stream</a> is closed, the result of then
applying <a 
href="clmse113.html#x139-613003r651">get-output-stream-string</a> to the stream is unspeciﬁed.
</div>
<!--l. 649--><p class="indent" >   If the :abort parameter is not <a 
href="clmse31.html#x42-86002r19">nil</a> (it defaults to <a 
href="clmse31.html#x42-86002r19">nil</a>), it indicates an abnormal
termination of the use of the stream. An attempt is made to clean up any side
eﬀects of having created the stream in the ﬁrst place. For example, if the stream
performs output to a ﬁle that was newly created when the stream was created,
then if possible the ﬁle is deleted and any previously existing ﬁle is not
superseded.
</div>
<div class=new>
<!--l. 659--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx140-858003"></a>to add the following accessor functions for
obtaining information about streams.
<div class=defun>
<!--l. 665--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-858004"></a><a 
 id="x140-858005r662"></a><b> broadcast-stream-streams</b>  <i>broadcast-stream</i>
<!--l. 667--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-859000662"></a></span>
   The argument must be of type broadcast-stream. A list of the constituent
output streams (whether open or not) is returned.
</div>
                                                                          

                                                                          
<div class=defun>
<!--l. 673--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-859001"></a><a 
 id="x140-859002r663"></a><b> concatenated-stream-streams</b>  <i>concatenated-stream</i>
<!--l. 675--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-860000663"></a></span>
   The argument must be of type concatenated-stream. A list of constituent
streams (whether open or not) is returned. This list represents the ordered set of
input streams from which the concatenated stream may yet read; the stream from
which it is currently reading is ﬁrst in the list. The list may be empty if no more
streams remain to be read.
</div>
<div class=defun>
<!--l. 685--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-860001"></a><a 
 id="x140-860002r664"></a><b> echo-stream-input-stream</b>  <i>echo-stream</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx140-860003"></a><a 
 id="x140-860004r665"></a><b> echo-stream-output-stream</b>  <i>echo-stream</i>
<!--l. 688--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-861000665"></a></span>
   The argument must be of type echo-stream. The function echo-stream-input-stream
returns the constituent input stream; echo-stream-output-stream returns the
constituent output stream.
</div>
<div class=defun>
<!--l. 696--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-861001"></a><a 
 id="x140-861002r666"></a><b> synonym-stream-symbol</b>  <i>synonym-stream</i>
<!--l. 698--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-862000666"></a></span>
   The argument must be of type synonym-stream. This function returns the
symbol for whose value the synonym-stream is a synonym.
</div>
<div class=defun>
<!--l. 704--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-862001"></a><a 
 id="x140-862002r667"></a><b> two-way-stream-input-stream</b>  <i>two-way-stream</i><br 
class="newline" /><i>[Function]</i><a 
 id="dx140-862003"></a><a 
 id="x140-862004r668"></a><b> two-way-stream-output-stream</b>  <i>two-way-stream</i>
<!--l. 707--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-863000668"></a></span>
   The argument must be of type two-way-stream. The function
two-way-stream-input-stream returns the constituent input stream;
two-way-stream-output-stream returns the constituent output stream.
</div>
</div>
<div class=newer>
                                                                          

                                                                          
<div class=defun>
<!--l. 716--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-863001"></a><a 
 id="x140-863002r669"></a><b> interactive-stream-p</b>  <i>stream</i>
<!--l. 718--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-864000669"></a></span>
   X3J13 voted in June 1989 <a 
 id="dx140-864001"></a>to add the predicate <a 
href="#x140-630002r669">interactive-stream-p</a>, which
returns <a 
href="clmse31.html#x42-87002r20">t</a> if the stream is interactive and otherwise returns <a 
href="clmse31.html#x42-86002r19">nil</a>. A type-error error
is signalled if the argument is not of type stream.
<!--l. 724--><p class="indent" >   The precise meaning of <a 
href="#x140-630002r669">interactive-stream-p</a> is implementation-dependent and
may depend on the underlying operating system. The intent is to distinguish
between interactive and batch (background, command-ﬁle) operations. Some
characteristics that might distinguish a stream as interactive:
      <ul class="itemize1">
      <li class="itemize">The stream is connected to a person (or the equivalent) in such a way
      that the program can prompt for information and expect to receive
      input that might depend on the prompt.
      </li>
      <li class="itemize">The program is expected to prompt for input and to support “normal
      input editing protocol” for that operating environment.
      </li>
      <li class="itemize">A call to <a 
href="clmse116.html#x143-669002r701">read-char</a> might hang waiting for the user to type something
      rather than quickly returning a character or an end-of-ﬁle indication.</li></ul>
<!--l. 739--><p class="noindent" >The value of *terminal-io* might or might not be interactive.
</div>
</div>
<div class=newer>
<div class=defun>
<!--l. 744--><p class="noindent" ><i>[Function]</i><a 
 id="dx140-864002"></a><a 
 id="x140-864003r670"></a><b> stream-external-format</b>  <i>stream</i>
<!--l. 746--><p class="noindent" ><span class="paragraphHead"><a 
 id="x140-865000670"></a></span>
   X3J13 voted in June 1989 <a 
 id="dx140-865001"></a>to add the function <a 
href="#x140-631003r670">stream-external-format</a>, which
returns a speciﬁer for the implementation-recognized scheme used for representing
characters in the argument stream. See the :external-format argument to
<a 
href="clmse120.html#x148-733002r768">open</a>.
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 7--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch22.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html#tailclmse113.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse114.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse114.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 7--><p class="indent" >   <a 
 id="tailclmse114.html"></a>  
</body></html> 
