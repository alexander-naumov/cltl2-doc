<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Operations on Streams</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-02-22 17:23:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 498--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch22.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html#tailclmse113.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse114.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse114.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">21.3   </span> <a 
 id="x140-18500021.3"></a>Operations on Streams</h3>
<!--l. 500--><p class="noindent" >This section contains discussion of only those operations that are common to all
streams. Input and output is rather complicated and is discussed separately in
chapter <a 
href="clmch22.html#x141-18600022">22<!--tex4ht:ref: IO --></a>. The interface between streams and the ﬁle system is discussed in
chapter <a 
href="clmch23.html#x146-20200023">23<!--tex4ht:ref: FILES --></a>.
<div class=defun>
<!--l. 506--><p class="noindent" > <i>[Function]</i>   <b>streamp</b> <a 
 id="dx140-185001"></a><a 
 id="x140-185002r654"></a>   <i>object</i>
<!--l. 508--><p class="noindent" ><a 
href="#x140-185002r654">streamp</a> is true if its argument is a stream, and otherwise is false. <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(streamp x)  ≡ (typep x &#x2019;stream)
</td></tr></table>
<!--l. 513--><p class="indent" >
</div>
</div>
<div class=new>
<!--l. 516--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to specify that <a 
href="#x140-185002r654">streamp</a> is unaﬀected by
whether its argument, if a stream, is open or closed. In either case it returns
true.
</div>
</div>
<div class=newer>
<div class=defun>
<!--l. 525--><p class="noindent" > <i>[Function]</i>   <b>open-stream-p</b> <a 
 id="dx140-185003"></a><a 
 id="x140-185004r655"></a>   <i>stream</i>
<!--l. 527--><p class="noindent" >X3J13 voted in January 1989 ⟨<b>?</b>⟩ to add the predicate <a 
href="#x140-185004r655">open-stream-p</a>. It is
true if its argument (which must be a stream) is open, and otherwise is
false.
<!--l. 533--><p class="indent" >   A stream is always created open; it remains open until closed with the
<a 
href="#x140-185012r659">close</a> function. The macros <a 
href="clmse113.html#x139-184020r650">with-open-stream</a>, <a 
href="clmse113.html#x139-184022r651">with-input-from-string</a>,
<a 
href="clmse113.html#x139-184026r653">with-output-to-string</a>, and <a 
href="clmse120.html#x148-215004r767">with-open-ﬁle</a> automatically close the created stream
as control leaves their bodies, in eﬀect imposing dynamic extent on the openness
                                                                          

                                                                          
of the stream.
</div>
</div>
<div class=defun>
<!--l. 542--><p class="noindent" > <i>[Function]</i>   <b>input-stream-p</b> <a 
 id="dx140-185005"></a><a 
 id="x140-185006r656"></a>   <i>stream</i>
<!--l. 544--><p class="noindent" >This predicate is true if its argument (which must be a stream) can handle input
operations, and otherwise is false.
</div>
<div class=defun>
<!--l. 549--><p class="noindent" > <i>[Function]</i>   <b>output-stream-p</b> <a 
 id="dx140-185007"></a><a 
 id="x140-185008r657"></a>   <i>stream</i>
<!--l. 551--><p class="noindent" >This predicate is true if its argument (which must be a stream) can handle output
operations, and otherwise is false.
</div>
<div class=defun>
<!--l. 557--><p class="noindent" > <i>[Function]</i>   <b>stream-element-type</b> <a 
 id="dx140-185009"></a><a 
 id="x140-185010r658"></a>   <i>stream</i>
<!--l. 559--><p class="noindent" >A type speciﬁer is returned to indicate what objects may be read from or
written to the argument stream, which must be a stream. Streams created
by <a 
href="clmse120.html#x148-215002r766">open</a> will have an element type restricted to a subset of <a 
href="clmse79.html#x97-139002r382">character</a> or
integer, but in principle a stream may conduct transactions using any Lisp
objects.
</div>
<div class=defun>
<!--l. 568--><p class="noindent" > <i>[Function]</i>   <b>close</b> <a 
 id="dx140-185011"></a><a 
 id="x140-185012r659"></a>   <i>stream</i>  <b>&#x0026;key</b>  :abort
<!--l. 570--><p class="noindent" >The argument must be a stream. The stream is closed. No further input/output
operations may be performed on it. However, certain inquiry operations
may still be performed, and it is permissible to close an already closed
stream.
<div class=newer>
<!--l. 577--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ and revised the vote in March 1989 to
specify that if <a 
href="#x140-185012r659">close</a> is called on an open stream, the stream is closed and <a 
href="clmse31.html#x42-70004r20">t</a> is
returned; but if <a 
href="#x140-185012r659">close</a> is called on a closed stream, it succeeds without error and
returns an unspeciﬁed value. (The rationale for not specifying the value returned
for a closed stream is that in some implementations closing certain streams does
not really have an eﬀect on them—for example, closing the <i>*terminal-io*</i> stream
might not “really” close it—and it is not desirable to force such implementations to
keep otherwise unnecessary state. Portable programs will of course not rely on
such behavior.)
<!--l. 592--><p class="indent" >   X3J13 also voted in January 1989 to specify exactly which inquiry functions
                                                                          

                                                                          
may be applied to closed streams: <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" > <a 
href="#x140-185002r654">streamp</a>             </td><td align="left" ><a 
href="clmse119.html#x147-214030r754">pathname-host</a>      </td><td align="left" ><a 
href="clmse119.html#x147-214042r760">namestring</a>             </td>
</tr><tr><td align="left" > <a 
href="clmse119.html#x147-214002r740">pathname</a>          </td><td align="left" ><a 
href="clmse119.html#x147-214032r755">pathname-device</a>    </td><td align="left" ><a 
href="clmse119.html#x147-214044r761">ﬁle-namestring</a>        </td>
</tr><tr><td align="left" > <a 
href="clmse119.html#x147-214004r741">truename</a>           </td><td align="left" ><a 
href="clmse119.html#x147-214034r756">pathname-directory</a></td><td align="left" ><a 
href="clmse119.html#x147-214046r762">directory-namestring</a></td>
</tr><tr><td align="left" > <a 
href="clmse119.html#x147-214008r743">merge-pathnames</a></td><td align="left" ><a 
href="clmse119.html#x147-214036r757">pathname-name</a>     </td><td align="left" ><a 
href="clmse119.html#x147-214048r763">host-namestring</a>      </td>
</tr><tr><td align="left" > <a 
href="clmse120.html#x148-215002r766">open</a>                 </td><td align="left" ><a 
href="clmse119.html#x147-214038r758">pathname-type</a>      </td><td align="left" ><a 
href="clmse119.html#x147-214050r764">enough-namestring</a>  </td>
</tr><tr><td align="left" > <a 
href="clmse121.html#x149-216006r770">probe-ﬁle</a>           </td><td align="left" ><a 
href="clmse119.html#x147-214040r759">pathname-version</a>   </td><td align="left" ><a 
href="clmse123.html#x151-218002r783">directory</a>                </td>
</tr><tr><td align="left" >                        </td></tr></table>                                                        </div>
</td></tr></table><!--l. 603--><p class="indent" >
</div>
<!--l. 604--><p class="noindent" >See the individual descriptions of these functions for more information on how they
operate on closed streams.
</div>
<div class=new>
<!--l. 609--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to clarify the eﬀect of closing various kinds of
streams. First some terminology:
      <ul class="itemize1">
      <li class="itemize">A         composite        stream         is         one         that         was
      returned by a call to <i>make-synonym-stream</i>, <a 
href="clmse113.html#x139-184004r642">make-broadcast-stream</a>,
      <a 
href="clmse113.html#x139-184006r643">make-concatenated-stream</a>,            <i>make-two-way-stream</i>,            or
      <i>make-echo-stream</i>.
      </li>
      <li class="itemize">The  constituents of  a  composite  stream  are  the  streams  that  were
      given as arguments to the function that constructed it or, in the case
      of <i>make-synonym-stream</i>, the stream that is the <a 
href="clmse35.html#x47-78007r55">symbol-value</a> of the
      symbol that was given as an argument. (The constituent of a synonym
      stream may therefore vary over time.)
      </li>
      <li class="itemize">A  constructed stream  is  either  a  composite  stream  or  one  returned
      by  a  call  to  <a 
href="clmse113.html#x139-184012r646">make-string-input-stream</a>,  <a 
href="clmse113.html#x139-184016r648">make-string-output-stream</a>,
      <i>with-input-from-string</i>, or <a 
href="clmse113.html#x139-184026r653">with-output-to-string</a>.</li></ul>
<!--l. 636--><p class="indent" >   The eﬀect of applying <a 
href="#x140-185012r659">close</a> to a constructed stream is to close that stream
only. No input/output operations are permitted on the constructed stream once it
has been closed (though certain inquiry functions are still permitted, as described
above).
                                                                          

                                                                          
<!--l. 641--><p class="indent" >   Closing a composite stream has no eﬀect on its constituents; any constituents
that are open remain open.
<!--l. 644--><p class="indent" >   If a stream created by <a 
href="clmse113.html#x139-184016r648">make-string-output-stream</a> is closed, the result of then
applying <a 
href="clmse113.html#x139-184018r649">get-output-stream-string</a> to the stream is unspeciﬁed.
</div>
<!--l. 649--><p class="indent" >   If the <i>:abort</i> parameter is not <a 
href="clmse31.html#x42-70002r19">nil</a> (it defaults to <a 
href="clmse31.html#x42-70002r19">nil</a>), it indicates an abnormal
termination of the use of the stream. An attempt is made to clean up any side
eﬀects of having created the stream in the ﬁrst place. For example, if the stream
performs output to a ﬁle that was newly created when the stream was created,
then if possible the ﬁle is deleted and any previously existing ﬁle is not
superseded.
</div>
<div class=new>
<!--l. 659--><p class="indent" >   X3J13 voted in January 1989 ⟨<b>?</b>⟩ to add the following accessor functions for
obtaining information about streams.
<div class=defun>
<!--l. 665--><p class="noindent" > <i>[Function]</i>   <b>broadcast-stream-streams</b> <a 
 id="dx140-185013"></a><a 
 id="x140-185014r660"></a>   <i>broadcast-stream</i>
<!--l. 667--><p class="noindent" >The argument must be of type broadcast-stream. A list of the constituent output
streams (whether open or not) is returned.
</div>
<div class=defun>
<!--l. 673--><p class="noindent" > <i>[Function]</i>   <b>concatenated-stream-streams</b> <a 
 id="dx140-185015"></a><a 
 id="x140-185016r661"></a>   <i>concatenated-stream</i>
<!--l. 675--><p class="noindent" >The argument must be of type concatenated-stream. A list of constituent streams
(whether open or not) is returned. This list represents the ordered set of input
streams from which the concatenated stream may yet read; the stream from which
it is currently reading is ﬁrst in the list. The list may be empty if no more streams
remain to be read.
</div>
<div class=defun>
<!--l. 685--><p class="noindent" > <i>[Function]</i>   <b>echo-stream-input-stream</b> <a 
 id="dx140-185017"></a><a 
 id="x140-185018r662"></a>   <i>echo-stream</i> <br 
class="newline" /><i>[Function]</i>   <b>echo-stream-output-stream</b> <a 
 id="dx140-185019"></a><a 
 id="x140-185020r663"></a>   <i>echo-stream</i>
<!--l. 688--><p class="noindent" >The argument must be of type echo-stream. The function <i>echo-stream-input-stream</i>
returns the constituent input stream; <i>echo-stream-output-stream</i> returns the
constituent output stream.
</div>
<div class=defun>
<!--l. 696--><p class="noindent" > <i>[Function]</i>   <b>synonym-stream-symbol</b> <a 
 id="dx140-185021"></a><a 
 id="x140-185022r664"></a>   <i>synonym-stream</i>
<!--l. 698--><p class="noindent" >The argument must be of type synonym-stream. This function returns the symbol
                                                                          

                                                                          
for whose value the synonym-stream is a synonym.
</div>
<div class=defun>
<!--l. 704--><p class="noindent" > <i>[Function]</i>   <b>two-way-stream-input-stream</b> <a 
 id="dx140-185023"></a><a 
 id="x140-185024r665"></a>   <i>two-way-stream</i> <br 
class="newline" /><i>[Function]</i>   <b>two-way-stream-output-stream</b> <a 
 id="dx140-185025"></a><a 
 id="x140-185026r666"></a>   <i>two-way-stream</i>
<!--l. 707--><p class="noindent" >The argument must be of type two-way-stream. The function
<i>two-way-stream-input-stream</i> returns the constituent input stream;
<i>two-way-stream-output-stream</i> returns the constituent output stream.
</div>
</div>
<div class=newer>
<div class=defun>
<!--l. 716--><p class="noindent" > <i>[Function]</i>   <b>interactive-stream-p</b> <a 
 id="dx140-185027"></a><a 
 id="x140-185028r667"></a>   <i>stream</i>
<!--l. 718--><p class="noindent" >X3J13 voted in June 1989 ⟨<b>?</b>⟩ to add the predicate <a 
href="#x140-185028r667">interactive-stream-p</a>, which
returns <a 
href="clmse31.html#x42-70004r20">t</a> if the stream is interactive and otherwise returns <a 
href="clmse31.html#x42-70002r19">nil</a>. A <i>type-error</i> error
is signalled if the argument is not of type stream.
<!--l. 724--><p class="indent" >   The precise meaning of <a 
href="#x140-185028r667">interactive-stream-p</a> is implementation-dependent and
may depend on the underlying operating system. The intent is to distinguish
between interactive and batch (background, command-ﬁle) operations. Some
characteristics that might distinguish a stream as interactive:
      <ul class="itemize1">
      <li class="itemize">The stream is connected to a person (or the equivalent) in such a way
      that the program can prompt for information and expect to receive
      input that might depend on the prompt.
      </li>
      <li class="itemize">The program is expected to prompt for input and to support “normal
      input editing protocol” for that operating environment.
      </li>
      <li class="itemize">A call to <a 
href="clmse116.html#x143-195012r699">read-char</a> might hang waiting for the user to type something
      rather than quickly returning a character or an end-of-ﬁle indication.</li></ul>
<!--l. 739--><p class="noindent" >The value of <i>*terminal-io*</i> might or might not be interactive.
</div>
</div>
<div class=newer>
<div class=defun>
                                                                          

                                                                          
<!--l. 744--><p class="noindent" > <i>[Function]</i>   <b>stream-external-format</b> <a 
 id="dx140-185029"></a><a 
 id="x140-185030r668"></a>   <i>stream</i>
<!--l. 746--><p class="noindent" >X3J13 voted in June 1989 ⟨<b>?</b>⟩ to add the function <a 
href="#x140-185030r668">stream-external-format</a>, which
returns a speciﬁer for the implementation-recognized scheme used for representing
characters in the argument stream. See the <i>:external-format</i> argument to
<a 
href="clmse120.html#x148-215002r766">open</a>.
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 7--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch22.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse113.html#tailclmse113.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse114.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch21.html#clmse114.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 7--><p class="indent" >   <a 
 id="tailclmse114.html"></a>  
</body></html> 
