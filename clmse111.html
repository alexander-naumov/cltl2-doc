<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>The Top-Level Loop</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-08 00:30:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 253--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch21.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html#tailclmse110.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse111.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse111.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">20.2   </span> <a 
 id="x136-26200020.2"></a>The Top-Level Loop</h3>
<!--l. 255--><p class="noindent" >Normally one interacts with Lisp through a “top-level <a 
href="clmse116.html#x143-281003r696">read</a>-<a 
href="clmse110.html#x135-261002r620">eval</a>-<a 
href="clmse117.html#x144-284010r713">print</a> loop,” so
called because it is the highest level of control and consists of an endless loop that
reads an expression, evaluates it, and prints the results. One has an eﬀect
on the state of the Lisp system only by invoking actions that have side
eﬀects.
<!--l. 262--><p class="indent" >   The precise nature of the top-level loop for Common Lisp is purposely not
rigorously speciﬁed here so that implementors can experiment to improve
the user interface. For example, an implementor may choose to require
line-at-a-time input, or may provide a fancy editor or complex graphics-display
interface. An implementor may choose to provide explicit prompts for input,
or may choose (as MacLisp does) not to clutter up the transcript with
prompts.
<!--l. 272--><p class="indent" >   The top-level loop is required to trap all throws and recover gracefully. It is
also required to print all values resulting from evaluation of a form, perhaps on
separate lines. If a form returns zero values, as little as possible should be
printed.
<!--l. 277--><p class="indent" >   The following variables are maintained by the top-level loop as a limited safety
net, in case the user forgets to save an interesting input expression or output
value. (Note that the names of some of these variables violate the convention that
names of global variables begin and end with an asterisk.) These are intended
primarily for user interaction, which is why they have short names. Use of these
variables should be avoided in programs.
<div class=defun>
<!--l. 284--><p class="noindent" ><i>[Variable]</i><a 
 id="dx136-262001"></a><a 
 id="x136-262002r626"></a><b> +</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx136-262003"></a><a 
 id="x136-262004r627"></a><b> ++</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx136-262005"></a><a 
 id="x136-262006r628"></a><b> +++</b>
<!--l. 288--><p class="noindent" >While a form is being evaluated by the top-level loop, the variable <a 
href="#x136-262002r626">+</a> is bound to
the previous form read by the loop. The variable <a 
href="#x136-262004r627">++</a> holds the previous value of
<a 
href="#x136-262002r626">+</a> (that is, the form evaluated two interactions ago), and <a 
href="#x136-262006r628">+++</a> holds the previous
value of <a 
href="#x136-262004r627">++</a>.
                                                                          

                                                                          
</div>
<div class=defun>
<!--l. 296--><p class="noindent" ><i>[Variable]</i><a 
 id="dx136-262007"></a><a 
 id="x136-262008r629"></a><b> -</b>
<!--l. 298--><p class="noindent" >While a form is being evaluated by the top-level loop, the variable <a 
href="#x136-262008r629">-</a> is bound to
the form itself; that is, it is the value about to be given to <a 
href="#x136-262002r626">+</a> once this interaction
is done. <div class=new>Notice of correction. In the ﬁrst edition, the name of the variable <a 
href="#x136-262008r629">-</a> was
inadvertently omitted.
</div>
</div>
<div class=defun>
<!--l. 311--><p class="noindent" ><i>[Variable]</i><a 
 id="dx136-262009"></a><a 
 id="x136-262010r630"></a><b> *</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx136-262011"></a><a 
 id="x136-262012r631"></a><b> **</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx136-262013"></a><a 
 id="x136-262014r632"></a><b> ***</b>
<!--l. 315--><p class="noindent" >While a form is being evaluated by the top-level loop, the variable <a 
href="#x136-262010r630">*</a> is bound to
the result printed at the end of the last time through the loop; that is, it is
the value produced by evaluating the form in <a 
href="#x136-262002r626">+</a>. If several values were
produced, <a 
href="#x136-262010r630">*</a> contains the ﬁrst value only; <a 
href="#x136-262010r630">*</a> contains <a 
href="clmse31.html#x42-77002r19">nil</a> if zero values
were produced. The variable <a 
href="#x136-262012r631">**</a> holds the previous value of <a 
href="#x136-262010r630">*</a> (that is, the
result printed two interactions ago), and <a 
href="#x136-262014r632">***</a> holds the previous value of
<a 
href="#x136-262012r631">**</a>.
<!--l. 326--><p class="indent" >   If the evaluation of <a 
href="#x136-262002r626">+</a> is aborted for some reason, then the values associated
with <a 
href="#x136-262010r630">*</a>, <a 
href="#x136-262012r631">**</a>, and <a 
href="#x136-262014r632">***</a> are not updated; they are updated only if the printing of
values is at least begun (though not necessarily completed).
</div>
<div class=defun>
<!--l. 332--><p class="noindent" ><i>[Variable]</i><a 
 id="dx136-262015"></a><a 
 id="x136-262016r633"></a><b> /</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx136-262017"></a><a 
 id="x136-262018r634"></a><b> //</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx136-262019"></a><a 
 id="x136-262020r635"></a><b> ///</b>
<!--l. 336--><p class="noindent" >While a form is being evaluated by the top-level loop, the variable <a 
href="#x136-262016r633">/</a> is bound to a
list of the results printed at the end of the last time through the loop; that is, it is
a list of all values produced by evaluating the form in <a 
href="#x136-262002r626">+</a>. The value of <a 
href="#x136-262010r630">*</a>
should always be the same as the car of the value of <a 
href="#x136-262016r633">/</a>. The variable //
holds the previous value of <a 
href="#x136-262016r633">/</a> (that is, the results printed two interactions
ago), and /// holds the previous value of //. Therefore the value of <a 
href="#x136-262012r631">**</a>
should always be the same as the car of //, and similarly for <a 
href="#x136-262014r632">***</a> and
///.
<!--l. 347--><p class="indent" >   If the evaluation of <a 
href="#x136-262002r626">+</a> is aborted for some reason, then the values associated
with <a 
href="#x136-262016r633">/</a>, //, and /// are not updated; they are updated only if the printing of
                                                                          

                                                                          
values is at least begun (though not necessarily completed).
</div>
<!--l. 353--><p class="indent" >   As an example of the processing of these variables, consider the following
possible transcript, where <a 
href="clmse68.html#x85-199008r213">&#x003E;</a> is a prompt by the top-level loop for user input: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(cons - -)                      </td><td  
class="tabbing">;Interaction 1
</td></tr></table>
<!--l. 358--><p class="indent" >                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">((CONS - -) CONS - -)      </td><td  
class="tabbing">;Cute, huh?</td></tr></table>
<!--l. 359--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 360--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(values)                        </td><td  
class="tabbing">;Interaction 2</td></tr></table>
<!--l. 361--><p class="indent" >                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                ;Nothing to print</td></tr></table>
<!--l. 362--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(cons &#x2019;a &#x2019;b)                    </td><td  
class="tabbing">;Interaction 3</td></tr></table>
<!--l. 363--><p class="indent" >                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">(A . B)                           </td><td  
class="tabbing">;There is a single value</td></tr></table>
<!--l. 364--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 365--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(hairy-loop)̂G               </td><td  
class="tabbing">;Interaction 4</td></tr></table>
<!--l. 366--><p class="indent" >                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">### QUIT to top level.    </td><td  
class="tabbing">;(User aborts the computation.)</td></tr></table>
<!--l. 367--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 368--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(ﬂoor 13 4)                    </td><td  
class="tabbing">;Interaction 5</td></tr></table>
<!--l. 369--><p class="indent" >                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">3                                   </td><td  
class="tabbing">;There are two values</td></tr></table>
<!--l. 370--><p class="indent" >                                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">1</td></tr></table>
<!--l. 372--><p class="indent" >
</div>
</div>
<!--l. 373--><p class="noindent" >At this point we have: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" >+++  ⇒ (cons &#x2019;a &#x2019;b) </td><td align="left" >***  ⇒ NIL   </td><td align="left" >///  ⇒ ()        </td>
</tr><tr><td align="left" >++  ⇒ (hairy-loop)   </td><td align="left" >**  ⇒ (A . B)</td><td align="left" >//  ⇒ ((A . B))</td>
</tr><tr><td align="left" >+  ⇒ (ﬂoor 13 4)      </td><td align="left" >*  ⇒ 3          </td><td align="left" >/  ⇒ (3 1)       </td></tr></table>                      </div>
</td></tr></table><!--l. 380--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 6--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch21.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse110.html#tailclmse110.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse111.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse111.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 6--><p class="indent" >   <a 
 id="tailclmse111.html"></a>  
</body></html> 
