<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>End-Test Control</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 23:44:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 1017--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse132.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse130.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse130.html#tailclmse130.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse131.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch25.html#clmse131.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">25.7   </span> <a 
href="clm.html#QQ2-161-2555" id="x161-251200025.7">End-Test
Control</a></h3>
<!--l. 1020--><p class="noindent" >The loop keywords <tt><a 
href="clmli7.html#x196-3479084r84">always</a></tt>, <tt><a 
href="clmli7.html#x196-3479646r646">never</a></tt>, <tt><a 
href="clmli7.html#x196-3479944r944">thereis</a></tt>, <tt><a 
href="clmli7.html#x196-3479970r970">until</a></tt>, and <tt><a 
href="clmli7.html#x196-3479995r995">while</a></tt> designate
constructs that use a single test condition to determine when loop iteration should
terminate.
<!--l. 1024--><p class="indent" >   The constructs <tt><a 
href="clmli7.html#x196-3479084r84">always</a></tt>, <tt><a 
href="clmli7.html#x196-3479646r646">never</a></tt>, and <tt><a 
href="clmli7.html#x196-3479944r944">thereis</a></tt> provide speciﬁc values to be
returned when a loop terminates. Using <tt><a 
href="clmli7.html#x196-3479084r84">always</a></tt>, <tt><a 
href="clmli7.html#x196-3479646r646">never</a></tt>, or <tt><a 
href="clmli7.html#x196-3479944r944">thereis</a></tt> with
value-returning accumulation clauses can produce unpredictable results.
In all other respects these constructs behave like the <tt><a 
href="clmli7.html#x196-3479995r995">while</a></tt> and <tt><a 
href="clmli7.html#x196-3479970r970">until</a></tt>
constructs.
<!--l. 1031--><p class="indent" >   The macro <tt><a 
href="clmli7.html#x196-3479559r559">loop-finish</a></tt> can be used at any time to cause normal termination.
In normal termination, <tt><a 
href="clmli7.html#x196-3479398r398">finally</a></tt> clauses are executed and default return values are
returned.
<!--l. 1035--><p class="indent" >   End-test control constructs can be used anywhere within the loop
body. The termination conditions are tested in the order in which they
appear.
<div class="defmacheader">
<!--l. 1040--><p class="indent" >   <div class="tabbing">
 <i>[Выражение цикла]</i><b> while </b> <a 
 id="dx161-2512001"></a><a 
 id="x161-2512002r802"></a> expr
   <br>
<!--l. 1040--><p class="noindent" ></div>
<!--l. 1040--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-251300025.7" id="x161-251300025.7"></a></span>
</div>
<div class="defmacheader">
<!--l. 1040--><p class="indent" >   <div class="tabbing">
 <i>[Выражение цикла]</i><b> until </b> <a 
 id="dx161-2513001"></a><a 
 id="x161-2513002r803"></a> expr
   <br>
                                                                          

                                                                          
<!--l. 1042--><p class="noindent" ></div>
<!--l. 1042--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-251400025.7" id="x161-251400025.7"></a></span>
</div>
<!--l. 1043--><p class="indent" >   The <tt><a 
href="clmli7.html#x196-3479995r995">while</a></tt> construct allows iteration to continue until the speciﬁed expression
<i>expr</i> evaluates to <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>. The expression is re-evaluated at the location of the <tt><a 
href="clmli7.html#x196-3479995r995">while</a></tt>
clause.
<!--l. 1047--><p class="indent" >   The <tt><a 
href="clmli7.html#x196-3479970r970">until</a></tt> construct is equivalent to <tt><a 
href="clmli7.html#x196-3479995r995">while</a></tt> (<tt><a 
href="clmli7.html#x196-3479656r656">not</a></tt> <i>expr</i>). If the value of the
speciﬁed expression is non-<tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>, iteration terminates.
<!--l. 1051--><p class="indent" >   You can use <tt><a 
href="clmli7.html#x196-3479995r995">while</a></tt> and <tt><a 
href="clmli7.html#x196-3479970r970">until</a></tt> at any point in a loop. If a <tt><a 
href="clmli7.html#x196-3479995r995">while</a></tt> or <tt><a 
href="clmli7.html#x196-3479970r970">until</a></tt>
clause causes termination, any clauses that precede it in the source are still
evaluated.
<!--l. 1056--><p class="indent" >   Examples: <div class="lisp"><div class="tabbing">
;;; A classic &#x0022;while-loop&#x0022;.
   <br>                                                     (loop while (hungry-p) do (eat))<br>
<br>                                  ;;; UNTIL NOT is equivalent to WHILE.<br>
(loop until (not (hungry-p)) do (eat))<br>                                     <br>
;;; Collect the length and the items of STACK.<br>   (let ((stack &#x2019;(a b c d e f)))<br>
  (loop while stack<br>            for item = (length stack) then (pop stack)<br>
        collect item))<br>                              <span class="math"> ⇒</span> (6 A B C D E F)<br>
<br>                ;;; Use WHILE to terminate a loop that otherwise wouldn&#x2019;t<br>
;;; terminate. Note that WHILE occurs after the WHEN.<br>
(loop for i ﬁxnum from 3<br>      when (oddp i) collect i<br>      while (&#x003C; i 5))<br>
   <span class="math"> ⇒</span> (3 5)<br>
<!--l. 1077--><p class="noindent" ></div>
<!--l. 1077--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-251500025.7" id="x161-251500025.7"></a></span>
<!--l. 1077--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-251600025.7" id="x161-251600025.7"></a></span>
</div>
<div class="defmacheader">
<!--l. 1082--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
 <i>[Выражение цикла]</i><b> always </b> <a 
 id="dx161-2516001"></a><a 
 id="x161-2516002r804"></a> expr
   <br>
<!--l. 1082--><p class="noindent" ></div>
<!--l. 1082--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-251700025.7" id="x161-251700025.7"></a></span>
</div>
<div class="defmacheader">
<!--l. 1082--><p class="indent" >   <div class="tabbing">
 <i>[Выражение цикла]</i><b> never </b> <a 
 id="dx161-2517001"></a><a 
 id="x161-2517002r805"></a> expr
   <br>
<!--l. 1083--><p class="noindent" ></div>
<!--l. 1083--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-251800025.7" id="x161-251800025.7"></a></span>
</div>
<div class="defmacheader">
<!--l. 1083--><p class="indent" >   <div class="tabbing">
 <i>[Выражение цикла]</i><b> thereis </b> <a 
 id="dx161-2518001"></a><a 
 id="x161-2518002r806"></a> expr
   <br>
<!--l. 1085--><p class="noindent" ></div>
<!--l. 1085--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-251900025.7" id="x161-251900025.7"></a></span>
</div>
<!--l. 1086--><p class="indent" >   The <tt><a 
href="clmli7.html#x196-3479084r84">always</a></tt> construct takes one form and terminates the loop if the form ever
evaluates to <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>; in this case, it returns <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>. Otherwise, it provides a default
return value of <tt><a 
href="clmli7.html#x196-3479935r935">t</a></tt>.
<!--l. 1090--><p class="indent" >   The <tt><a 
href="clmli7.html#x196-3479646r646">never</a></tt> construct takes one form and terminates the loop if the form ever
evaluates to non-<tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>; in this case, it returns <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>. Otherwise, it provides a default
return value of <tt><a 
href="clmli7.html#x196-3479935r935">t</a></tt>.
                                                                          

                                                                          
<!--l. 1094--><p class="indent" >   The <tt><a 
href="clmli7.html#x196-3479944r944">thereis</a></tt> construct takes one form and terminates the loop if the form
ever evaluates to non-<tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>; in this case, it returns that value.
<!--l. 1098--><p class="indent" >   If the <tt><a 
href="clmli7.html#x196-3479995r995">while</a></tt> or <tt><a 
href="clmli7.html#x196-3479970r970">until</a></tt> construct causes termination, control is passed to the
loop epilogue, where any <tt><a 
href="clmli7.html#x196-3479398r398">finally</a></tt> clauses will be executed. Since <tt><a 
href="clmli7.html#x196-3479084r84">always</a></tt>, <tt><a 
href="clmli7.html#x196-3479646r646">never</a></tt>,
and <tt><a 
href="clmli7.html#x196-3479944r944">thereis</a></tt> use the Common Lisp macro <tt><a 
href="clmli7.html#x196-3479798r798">return</a></tt> to terminate iteration, any
<tt><a 
href="clmli7.html#x196-3479398r398">finally</a></tt> clause that is speciﬁed is not evaluated.
<!--l. 1105--><p class="indent" >   Examples: <div class="lisp"><div class="tabbing">
;;; Make sure I is always less than 11 (two ways).
   <br>                                   ;;; The FOR construct terminates these loops.<br>
<!--l. 1109--><p class="noindent" ></div>
<!--l. 1109--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252000025.7" id="x161-252000025.7"></a></span>
<!--l. 1109--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252100025.7" id="x161-252100025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1110--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>                                                                      always (&#x003C; i 11))<br>
   <span class="math"> ⇒</span> T<br>
<!--l. 1114--><p class="noindent" ></div>
<!--l. 1114--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252200025.7" id="x161-252200025.7"></a></span>
<!--l. 1114--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252300025.7" id="x161-252300025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1115--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
(loop for i from 0 to 10
   <br>                                                                        never (&#x003E; i 11))<br>
   <span class="math"> ⇒</span> T<br>
<!--l. 1119--><p class="noindent" ></div>
<!--l. 1119--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252400025.7" id="x161-252400025.7"></a></span>
<!--l. 1119--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252500025.7" id="x161-252500025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1120--><p class="indent" >   <div class="tabbing">
;;; If I exceeds 10, return I; otherwise, return NIL.
   <br>                               ;;; The THEREIS construct terminates this loop.<br>
<!--l. 1123--><p class="noindent" ></div>
<!--l. 1123--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252600025.7" id="x161-252600025.7"></a></span>
<!--l. 1123--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252700025.7" id="x161-252700025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1124--><p class="indent" >   <div class="tabbing">
(loop for i from 0
   <br>                                                         thereis (when (&#x003E; i 10) i) )<br>
   <span class="math"> ⇒</span> 11<br>
<!--l. 1128--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 1128--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252800025.7" id="x161-252800025.7"></a></span>
<!--l. 1128--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-252900025.7" id="x161-252900025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1129--><p class="indent" >   <div class="tabbing">
;;; The FINALLY clause is not evaluated in these examples.
   <br>
<!--l. 1131--><p class="noindent" ></div>
<!--l. 1131--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253000025.7" id="x161-253000025.7"></a></span>
<!--l. 1131--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253100025.7" id="x161-253100025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1132--><p class="indent" >   <div class="tabbing">
(loop for i from 0 to 10
   <br>           always (&#x003C; i 9)<br>           ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> NIL<br>
<!--l. 1137--><p class="noindent" ></div>
<!--l. 1137--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253200025.7" id="x161-253200025.7"></a></span>
<!--l. 1137--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253300025.7" id="x161-253300025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1138--><p class="indent" >   <div class="tabbing">
                                                                          

                                                                          
(loop never t
   <br>                                             ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> NIL<br>
<!--l. 1142--><p class="noindent" ></div>
<!--l. 1142--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253400025.7" id="x161-253400025.7"></a></span>
<!--l. 1142--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253500025.7" id="x161-253500025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1143--><p class="indent" >   <div class="tabbing">
(loop thereis &#x0022;Here is my value&#x0022;
   <br>                                             ﬁnally (print &#x0022;you won&#x2019;t see this&#x0022;))<br>
   <span class="math"> ⇒</span> &#x0022;Here is my value&#x0022;<br>
<!--l. 1147--><p class="noindent" ></div>
<!--l. 1147--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253600025.7" id="x161-253600025.7"></a></span>
<!--l. 1147--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253700025.7" id="x161-253700025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1148--><p class="indent" >   <div class="tabbing">
;;; The FOR construct terminates this loop,
   <br>                                           ;;; so the FINALLY clause is evaluated.<br>
<!--l. 1151--><p class="noindent" ></div>
                                                                          

                                                                          
<!--l. 1151--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253800025.7" id="x161-253800025.7"></a></span>
<!--l. 1151--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-253900025.7" id="x161-253900025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1152--><p class="indent" >   <div class="tabbing">
(loop for i from 1 to 10
   <br>                                                                       thereis (&#x003E; i 11)<br>
      ﬁnally (print i))                                       ;Prints 1 line<br>
11<br>                                                                <span class="math"> ⇒</span> NIL<br>
<!--l. 1158--><p class="noindent" ></div>
<!--l. 1158--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-254000025.7" id="x161-254000025.7"></a></span>
<!--l. 1158--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-254100025.7" id="x161-254100025.7"></a></span>
</div>
<div class="lisp">
<!--l. 1160--><p class="indent" >   <div class="tabbing">
(defstruct mountain height diﬃculty (why &#x0022;because it is there&#x0022;))
   <br>                   (setq everest (make-mountain :height &#x2019;(2.86e-13 parsecs)))<br>
(setq chocorua (make-mountain :height &#x2019;(1059180001 microns)))<br>
(defstruct desert area (humidity 0))<br>(setq sahara (make-desert :area &#x2019;(212480000 square furlongs)))<br>
       ;First there is a mountain, then there is no mountain, then there is <span class="math">…</span><br>
(loop for x in (list everest sahara chocorua)                        ; —GLS<br>
      thereis (and (mountain-p x) (mountain-height x)))<br>
   <span class="math"> ⇒</span> (2.86E-13 PARSECS)<br>                                             <br>
;;; If you could use this code to ﬁnd a counterexample to<br>
;;; Fermat&#x2019;s last theorem, it would still not return the value<br>
;;; of the counterexample because all of the THEREIS clauses<br>
                                                                          

                                                                          
;;; in this example return only T.   Of course, this code has<br>
;;; never been observed to terminate.<br>                                      <br>
(loop for z upfrom 2<br>                                               thereis<br>
        (loop for n upfrom 3 below (log z 2)<br>                    thereis<br>
                (loop for x below z<br>                          thereis<br>
                        (loop for y below z<br>
                              thereis (= (+ (expt x n)<br>
                                            (expt y n))<br>
                                         (expt z n))))))<br>
<!--l. 1187--><p class="noindent" ></div>
<!--l. 1187--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-254200025.7" id="x161-254200025.7"></a></span>
<!--l. 1187--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-254300025.7" id="x161-254300025.7"></a></span>
</div>
<div class="defmac">
<div class="defmacheader">
<!--l. 1191--><p class="indent" >   <div class="tabbing">
 <i>[Макрос]</i><b> loop-ﬁnish </b> <a 
 id="dx161-2543001"></a><a 
 id="x161-2543002r807"></a> <span class="math"> !</span>
   <br>
<!--l. 1192--><p class="noindent" ></div>
<!--l. 1192--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-254400025.7" id="x161-254400025.7"></a></span>
</div>
<!--l. 1193--><p class="indent" >   The macro <tt><a 
href="clmli7.html#x196-3479559r559">loop-finish</a></tt> terminates iteration normally and returns any
accumulated result. If speciﬁed, a <tt><a 
href="clmli7.html#x196-3479398r398">finally</a></tt> clause is evaluated.
<!--l. 1197--><p class="indent" >   In most cases it is not necessary to use <tt><a 
href="clmli7.html#x196-3479559r559">loop-finish</a></tt> because other loop
control clauses terminate the loop. Use <tt><a 
href="clmli7.html#x196-3479559r559">loop-finish</a></tt> to provide a normal exit
from a nested condition inside a loop.
<!--l. 1202--><p class="indent" >   You can use <tt><a 
href="clmli7.html#x196-3479559r559">loop-finish</a></tt> inside nested Lisp code to provide a normal exit
from a loop. Since <tt><a 
href="clmli7.html#x196-3479559r559">loop-finish</a></tt> transfers control to the loop epilogue, using
<tt><a 
href="clmli7.html#x196-3479559r559">loop-finish</a></tt> within a <tt><a 
href="clmli7.html#x196-3479398r398">finally</a></tt> expression can cause inﬁnite looping.
                                                                          

                                                                          
<!--l. 1209--><p class="indent" >   Implementations are allowed to provide this construct as a local macro by
using <tt><a 
href="clmli7.html#x196-3479568r568">macrolet</a></tt>.
<!--l. 1212--><p class="indent" >   Examples: <div class="lisp"><div class="tabbing">
;;; Print a date in February, but exclude leap day.
   <br>
;;; LOOP-FINISH exits from the nested condition.<br>(loop for date in date-list<br>
      do (case date<br>                     (29 (when (eq month &#x2019;february)<br>
                     (loop-ﬁnish))<br>
             (format t &#x0022;~:@(~A~) ~A&#x0022; month date))))<br>
<br>                  ;;; Terminate the loop, but return the accumulated count.<br>
(loop for i in &#x2019;(1 2 3 stop-here 4 5 6)<br>
      when (symbolp i) do (loop-ﬁnish)<br>           count i)<br>        <span class="math"> ⇒</span> 3<br>
<br>                   ;;; This loop works just as well as the previous example.<br>
(loop for i in &#x2019;(1 2 3 stop-here 4 5 6)<br>      until (symbolp i)<br>      count i)<br>
   <span class="math"> ⇒</span> 3<br>
<!--l. 1233--><p class="noindent" ></div>
<!--l. 1233--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-254500025.7" id="x161-254500025.7"></a></span>
<!--l. 1233--><p class="noindent" ><span class="paragraphHead"><a 
href="#x161-254600025.7" id="x161-254600025.7"></a></span>
</div>
</div>
                                                                          

                                                                          
<!--l. 1236--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse132.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse130.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse130.html#tailclmse130.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse131.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch25.html#clmse131.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse131.html"></a>   </div> </div> 
</body></html> 
