<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Цикл взаимодействия с пользователем</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 00:55:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 556--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmch21.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse106.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse106.html#tailclmse106.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse107.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse107.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">20.2   </span> <a 
href="clm.html#QQ2-132-1653" id="x132-164400020.2">Цикл взаимодействия
с пользователем</a></h3>
<!--l. 558--><p class="noindent" >С Lisp&#x2019;ом можно работать через специальный цикл вида «<tt><a 
href="clmse112.html#x139-1882002r652">read</a></tt>-<tt><a 
href="clmse106.html#x131-1633002r580">eval</a></tt>-<tt><a 
href="clmse113.html#x140-1919004r669">print</a></tt> и
сначала». Изменять состояние Lisp системы можно вызовом в этом цикле
действий, имеющих побочные эффекты.
<!--l. 563--><p class="indent" >   Точное определение такого цикла для Common Lisp&#x2019;а не указывается
здесь специально, оставляя разработчикам поле для творчества. Например,
они могут сделать командную строку, или простой текстовый редактор, или
сложный графический интерфейс. Разработчики могут предоставлять
явный запрос ввода, или (как в MacLisp&#x2019;е) не загромождать экран
подсказками.
<!--l. 569--><p class="indent" >   Цикл взаимодействия с пользователем должен ловить все исключения и
изящно их обрабатывать. Он должен также выводить все результаты
вычисления форм, возможно в отдельных строках. Если форма вернула ноль
значений, это также должно быть отображено.
<!--l. 574--><p class="indent" >   Следующие переменные управляются циклом взаимодействия с
пользователем, для удобства работы, например в случае, если пользователь
забыл сохранить интересное введённое выражение или выведенное значение.
(Следует отметить, что имена некоторых этих переменных нарушают
нотацию глобальных переменных в использовании звёздочек в начале и конце
имени.) Эти переменные в основном используются для взаимодействия с
пользователем, поэтому имеют короткие имена. Использование этих
переменных в программах следует избегать.
<div class="defun">
<!--l. 582--><p class="noindent" ><div class="defunheader"> <i>[Переменная]</i><a 
 id="dx132-1644001"></a><a 
 id="x132-1644002r586"></a><b> +</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx132-1644003"></a><a 
 id="x132-1644004r587"></a><b> ++</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx132-1644005"></a><a 
 id="x132-1644006r588"></a><b> +++</b>
</div>
<!--l. 586--><p class="noindent" ><span class="paragraphHead"><a 
href="#x132-164500020.2" id="x132-164500020.2"></a></span>
   Когда форма вычисляется в цикле взаимодействия, переменная <tt><a 
href="#x132-1644002r586">+</a></tt>
связывается с предыдущим прочитанным выражением. Переменная <tt><a 
href="#x132-1644004r587">++</a></tt>
хранит предыдущее относительно значения <tt><a 
href="#x132-1644002r586">+</a></tt> (то есть, форма вычисленная
                                                                          

                                                                          
два шага назад), и <tt><a 
href="#x132-1644006r588">+++</a></tt> хранит предыдущее значение относительно
<tt><a 
href="#x132-1644004r587">++</a></tt>.
</div>
<div class="defun">
<!--l. 594--><p class="noindent" ><div class="defunheader"> <i>[Переменная]</i><a 
 id="dx132-1645001"></a><a 
 id="x132-1645002r589"></a><b> -</b>
</div>
<!--l. 596--><p class="noindent" ><span class="paragraphHead"><a 
href="#x132-164600020.2" id="x132-164600020.2"></a></span>
   Когда формы выполняется в цикле взаимодействия, переменная <tt><a 
href="#x132-1645002r589">-</a></tt> связана
с этой формой. Это значение, которое получит переменная <tt><a 
href="#x132-1644002r586">+</a></tt> на следующей
итерации цикла.
</div>
<div class="defun">
<!--l. 602--><p class="noindent" ><div class="defunheader"> <i>[Переменная]</i><a 
 id="dx132-1646001"></a><a 
 id="x132-1646002r590"></a><b> *</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx132-1646003"></a><a 
 id="x132-1646004r591"></a><b> **</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx132-1646005"></a><a 
 id="x132-1646006r592"></a><b> ***</b>
</div>
<!--l. 606--><p class="noindent" ><span class="paragraphHead"><a 
href="#x132-164700020.2" id="x132-164700020.2"></a></span>
   Во время вычисления формы в цикле взаимодействия, переменная <tt><a 
href="#x132-1646002r590">*</a></tt>
связана с результатом выполнения предыдущей формы, то есть значения
формы, которая хранится в <tt><a 
href="#x132-1644002r586">+</a></tt>. Если результат той формы содержал
несколько значений, в <tt><a 
href="#x132-1646002r590">*</a></tt> будет только первое. Если было возвращено ноль
значений, <tt><a 
href="#x132-1646002r590">*</a></tt> будет содержать <tt><a 
href="clmse31.html#x42-312002r18">nil</a></tt>. Переменная <tt><a 
href="#x132-1646004r591">**</a></tt> хранит предыдущее
значение относительно <tt><a 
href="#x132-1646002r590">*</a></tt>. То есть, результат вычисления формы из <tt><a 
href="#x132-1646004r591">**</a></tt>. <tt><a 
href="#x132-1646006r592">***</a></tt>
хранит предыдущее значение относительно <tt><a 
href="#x132-1646006r592">***</a></tt>.
<!--l. 616--><p class="indent" >   Если выполнение <tt><a 
href="#x132-1644002r586">+</a></tt> было по каким-то причинам прервано, тогда значения
<tt><a 
href="#x132-1646002r590">*</a></tt>, <tt><a 
href="#x132-1646004r591">**</a></tt> и <tt><a 
href="#x132-1646006r592">***</a></tt> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
</div>
<div class="defun">
<!--l. 622--><p class="noindent" ><div class="defunheader"> <i>[Переменная]</i><a 
 id="dx132-1647001"></a><a 
 id="x132-1647002r593"></a><b> /</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx132-1647003"></a><a 
 id="x132-1647004r594"></a><b> //</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx132-1647005"></a><a 
 id="x132-1647006r595"></a><b> ///</b>
</div>
<!--l. 626--><p class="noindent" ><span class="paragraphHead"><a 
href="#x132-164800020.2" id="x132-164800020.2"></a></span>
                                                                          

                                                                          
   Во время вычисления формы в цикле взаимодействия, переменная <tt><a 
href="#x132-1647002r593">/</a></tt>
связана со списком результатов выведенных на предыдущей итерации. То
есть это список всех значений выполнения формы <tt><a 
href="#x132-1644002r586">+</a></tt>. Значение <tt><a 
href="#x132-1646002r590">*</a></tt> должно
всегда совпадать со значением <i>car</i> элемента значения <tt><a 
href="#x132-1647002r593">/</a></tt>. Переменная <tt><a 
href="#x132-1647004r594">//</a></tt>
хранит предыдущий список значений относительно <tt><a 
href="#x132-1647002r593">/</a></tt> (то есть, результат
вычисленный две итерации назад), и <tt><a 
href="#x132-1647006r595">///</a></tt> содержит предыдущий список
значений относительно <tt><a 
href="#x132-1647006r595">///</a></tt>. Таким образом, значение <tt><a 
href="#x132-1646004r591">**</a></tt> должно всегда
совпадать со значением <i>car</i> элемента списка <tt><a 
href="#x132-1647004r594">//</a></tt>, а <tt><a 
href="#x132-1646006r592">***</a></tt> с с <i>car</i> элементом
<tt><a 
href="#x132-1647006r595">///</a></tt>.
<!--l. 638--><p class="indent" >   Если выполнение <tt><a 
href="#x132-1644002r586">+</a></tt> было по каким-то причинам прервано, тогда значения
<tt><a 
href="#x132-1647002r593">/</a></tt>, <tt><a 
href="#x132-1647004r594">//</a></tt> и <tt><a 
href="#x132-1647006r595">///</a></tt> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
</div>
<!--l. 644--><p class="indent" >   В качестве примера работы с этими переменным, рассмотрим следующую
возможную работу с системой, где <tt><a 
href="clmse65.html#x82-951008r193">&#x003E;</a></tt> приглашение ввода: <div class="lisp"><div class="tabbing">
&#x003E;(cons - -)                      ;Итерация 1
   <br>                                       ((CONS - -) CONS - -)      ;Очаровашка?<br>
<br>                                  &#x003E;(values)                        ;Итерация 2<br>
                                ;Ничего не выводится<br>
&#x003E;(cons &#x2019;a &#x2019;b)                    ;Итерация 3<br>
(A . B)                           ;Это одно значение<br>
<br>                                  &#x003E;(hairy-loop)̂G               ;Итерация 4<br>
### QUIT to top level.    ;(Пользователь прервал вычисления.)<br>
<br>                                  &#x003E;(ﬂoor 13 4)                    ;Итерация 5<br>
3                                   ;Вернулось два значения<br>                    1<br>
<!--l. 662--><p class="noindent" ></div>
<!--l. 662--><p class="noindent" ><span class="paragraphHead"><a 
href="#x132-164900020.2" id="x132-164900020.2"></a></span>
<!--l. 662--><p class="noindent" ><span class="paragraphHead"><a 
href="#x132-165000020.2" id="x132-165000020.2"></a></span>
</div>
<!--l. 663--><p class="indent" >   В этой точке мы имеем: <div class="lisp"><div class="tabbing">
                                                                          

                                                                          
<!--tex4ht:inline--><div class="tabular"><table width="100%" class="tabular"><tr><td align="left" >+++ <span class="math"> ⇒</span> (cons &#x2019;a &#x2019;b) </td><td align="left" >*** <span class="math"> ⇒</span> NIL   </td><td align="left" >/// <span class="math"> ⇒</span> ()        </td>
</tr><tr><td align="left" >++ <span class="math"> ⇒</span> (hairy-loop)   </td><td align="left" >** <span class="math"> ⇒</span> (A . B)</td><td align="left" >// <span class="math"> ⇒</span> ((A . B))</td>
</tr><tr><td align="left" >+ <span class="math"> ⇒</span> (ﬂoor 13 4)      </td><td align="left" >* <span class="math"> ⇒</span> 3          </td><td align="left" >/ <span class="math"> ⇒</span> (3 1)       </td></tr></table>                      </div>
   <br>
<!--l. 670--><p class="noindent" ></div>
<!--l. 670--><p class="noindent" ><span class="paragraphHead"><a 
href="#x132-165100020.2" id="x132-165100020.2"></a></span>
<!--l. 670--><p class="noindent" ><span class="paragraphHead"><a 
href="#x132-165200020.2" id="x132-165200020.2"></a></span>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
<!--l. 713--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmch21.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse106.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse106.html#tailclmse106.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse107.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse107.html"></a>   </div> </div> 
</body></html> 
