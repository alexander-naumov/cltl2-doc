<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Multiple Values</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-01 16:01:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 4411--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse45.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse43.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse43.html#tailclmse43.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse44.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse44.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">7.10   </span> <a 
 id="x56-930007.10"></a>Multiple Values</h3>
<a 
 id="dx56-93001"></a>
<!--l. 4414--><p class="noindent" >Ordinarily the result of calling a Lisp function is a single Lisp object. Sometimes,
however, it is convenient for a function to compute several objects and return
them. Common Lisp provides a mechanism for handling multiple values
directly. This mechanism is cleaner and more eﬃcient than the usual
tricks involving returning a list of results or stashing results in global
variables.
<!--l. 4422--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.10.1   </span> <a 
 id="x56-940007.10.1"></a>Constructs for Handling Multiple Values</h4>
<!--l. 4424--><p class="noindent" >Normally multiple values are not used. Special forms are required both to <i>produce</i>
multiple values and to <i>receive</i> them. If the caller of a function does not
request multiple values, but the called function produces multiple values,
then the ﬁrst value is given to the caller and all others are discarded;
if the called function produces zero values, then the caller gets <a 
href="clmse31.html#x42-70002r19">nil</a> as a
value.
<!--l. 4432--><p class="indent" >   The primary primitive for producing multiple values is <a 
href="#x56-94002r123">values</a>, which takes any
number of arguments and returns that many values. If the last form in the body
of a function is a <a 
href="#x56-94002r123">values</a> with three arguments, then a call to that function will
return three values. Other special forms also produce multiple values,
but they can be described in terms of <a 
href="#x56-94002r123">values</a>. Some built-in Common
Lisp functions, such as <a 
href="clmse71.html#x88-130012r256">ﬂoor</a>, return multiple values; those that do are so
documented.
<!--l. 4440--><p class="indent" >   The special forms and macros for receiving multiple values are as follows: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">multiple-value-list
</td></tr></table>
                                                                          

                                                                          
<!--l. 4442--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">multiple-value-call</td></tr></table>
<!--l. 4443--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">multiple-value-prog1</td></tr></table>
<!--l. 4444--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">multiple-value-bind</td></tr></table>
<!--l. 4445--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">multiple-value-setq</td></tr></table>
<!--l. 4447--><p class="indent" >
</div>
</div>
<!--l. 4448--><p class="noindent" >These specify a form to evaluate and an indication of where to put the values
returned by that form.
<div class=defun>
<!--l. 4451--><p class="noindent" ><i>[Function]</i><a 
 id="dx56-94001"></a><a 
 id="x56-94002r123"></a><b> values</b>  &#x0026;rest  <i>args</i>
<!--l. 4453--><p class="noindent" >All of the arguments are returned, in order, as values. For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun polar (x y)
</td></tr></table>
<!--l. 4457--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (values (sqrt (+ (* x x) (* y y))) (atan y x)))</td></tr></table>
<!--l. 4458--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 4459--><p class="indent" >                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(multiple-value-bind (r theta) (polar 3.0 4.0)</td></tr></table>
<!--l. 4460--><p class="indent" >                                                        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (vector r theta))</td></tr></table>
<!--l. 4461--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ #(5.0 0.9272952)</td></tr></table>
<!--l. 4463--><p class="indent" >
</div>
</div>
<!--l. 4465--><p class="indent" >   The expression (values) returns zero values. This is the standard idiom for
returning no values from a function.
<!--l. 4468--><p class="indent" >   Sometimes it is desirable to indicate explicitly that a function will return
exactly one value. For example, the function <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x y)
</td></tr></table>
<!--l. 4471--><p class="indent" >                                                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (ﬂoor (+ x y) y))</td></tr></table>
<!--l. 4473--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
<!--l. 4474--><p class="noindent" >will return two values because <a 
href="clmse71.html#x88-130012r256">ﬂoor</a> returns two values. It may be that the second
value makes no sense, or that for eﬃciency reasons it is desired not to compute
the second value. The <a 
href="#x56-94002r123">values</a> function is the standard idiom for indicating that
only one value is to be returned, as shown in the following example. <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun foo (x y)
</td></tr></table>
<!--l. 4481--><p class="indent" >                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (values (ﬂoor (+ x y) y)))</td></tr></table>
<!--l. 4483--><p class="indent" >
</div>
</div>
<!--l. 4484--><p class="noindent" >This works because <a 
href="#x56-94002r123">values</a> returns exactly <i>one</i> value for each of its argument forms;
as for any function call, if any argument form to <a 
href="#x56-94002r123">values</a> produces more than one
value, all but the ﬁrst are discarded.
<!--l. 4489--><p class="indent" >   There is absolutely no way in Common Lisp for a caller to distinguish between
returning a single value in the ordinary manner and returning exactly one
“multiple value.” For example, the values returned by the expressions
(+ 1 2) and (values (+ 1 2)) are identical in every respect: the single value
3.
</div>
<div class=defun>
<!--l. 4496--><p class="noindent" ><i>[Constant]</i><a 
 id="dx56-94003"></a><a 
 id="x56-94004r124"></a><b> multiple-values-limit</b>
<!--l. 4498--><p class="noindent" >The value of <a 
href="#x56-94004r124">multiple-values-limit</a> is a positive integer that is the upper
exclusive bound on the number of values that may be returned from a
function. This bound depends on the implementation but will not be smaller
than 20. (Implementors are encouraged to make this limit as large as
practicable without sacriﬁcing performance.) See <a 
href="clmse29.html#x39-64008r12">lambda-parameters-limit</a> and
<a 
href="clmse37.html#x49-81008r79">call-arguments-limit</a>.
</div>
<div class=defun>
<!--l. 4508--><p class="noindent" ><i>[Function]</i><a 
 id="dx56-94005"></a><a 
 id="x56-94006r125"></a><b> values-list</b>  <i>list</i>
<!--l. 4510--><p class="noindent" >All of the elements of <i>list</i> are returned as multiple values. For example: <div class=lisp>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(values-list (list a b c))  ≡ (values a b c)
</td></tr></table>
<!--l. 4515--><p class="indent" >
</div>
</div>
<!--l. 4516--><p class="noindent" >In general, <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(values-list <i>list</i>)  ≡ (apply #&#x2019;values <i>list</i>)
</td></tr></table>
<!--l. 4519--><p class="indent" >
</div>
</div>
<!--l. 4520--><p class="noindent" >but <a 
href="#x56-94006r125">values-list</a> may be clearer or more eﬃcient.
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i><b> multiple-value-list </b><a 
 id="dx56-94007"></a><a 
 id="x56-94008r126"></a> form
</td></tr></table>
<!--l. 4525--><p class="indent" >
</div>
   <a 
href="#x56-94008r126">multiple-value-list</a> evaluates <i>form</i> and returns a list of the multiple values it
returned. For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(multiple-value-list (ﬂoor -3 4))  ⇒ (-1 1)
</td></tr></table>
<!--l. 4531--><p class="indent" >
</div>
</div>
<!--l. 4532--><p class="noindent" ><a 
href="#x56-94008r126">multiple-value-list</a> and <a 
href="#x56-94006r125">values-list</a> are therefore inverses of each other.
</div>
<div class=defspec>
<div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Special form]</i><b> multiple-value-call </b><a 
 id="dx56-94009"></a><a 
 id="x56-94010r127"></a> function  { form}*
</td></tr></table>
<!--l. 4538--><p class="indent" >
</div>
   <a 
href="#x56-94010r127">multiple-value-call</a> ﬁrst evaluates <i>function</i> to obtain a function and then
evaluates all of the <i>form</i>s. All the values of the <i>form</i>s are gathered together (not
just one value from each) and are all given as arguments to the function. The
result of <a 
href="#x56-94010r127">multiple-value-call</a> is whatever is returned by the function. For example: <div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(+ (ﬂoor 5 3) (ﬂoor 19 4))
</td></tr></table>
<!--l. 4546--><p class="indent" >                                                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ≡ (+ 1 4)  ⇒ 5</td></tr></table>
<!--l. 4547--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(multiple-value-call #&#x2019;+ (ﬂoor 5 3) (ﬂoor 19 4))</td></tr></table>
<!--l. 4548--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ≡ (+ 1 2 4 3)  ⇒ 10</td></tr></table>
<!--l. 4549--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(multiple-value-list <i>form</i>)  ≡ (multiple-value-call #&#x2019;list <i>form</i>)</td></tr></table>
<!--l. 4551--><p class="indent" >
</div>
</div>
</div>
<div class=defspec>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Special form]</i><b> multiple-value-prog1 </b><a 
 id="dx56-94011"></a><a 
 id="x56-94012r128"></a> form  { form}*
</td></tr></table>
<!--l. 4556--><p class="indent" >
</div>
   multiple-value-prog1 evaluates the ﬁrst <i>form</i> and saves all the values
produced by that form. It then evaluates the other <i>form</i>s from left to
right, discarding their values. The values produced by the ﬁrst <i>form</i> are
returned by multiple-value-prog1. See prog1, which always returns a single
value.
</div>
                                                                          

                                                                          
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i><b> multiple-value-bind </b><a 
 id="dx56-94013"></a><a 
 id="x56-94014r129"></a> ( {var}* ) values-form
</td></tr></table>
<!--l. 4566--><p class="indent" >                                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"> {declaration}*  { form}* </td></tr></table>
<!--l. 4567--><p class="indent" >
</div>
   The <i>values-form</i> is evaluated, and each of the variables <i>var</i> is bound to the
respective value returned by that form. If there are more variables than values
returned, extra values of <a 
href="clmse31.html#x42-70002r19">nil</a> are given to the remaining variables. If there are more
values than variables, the excess values are simply discarded. The variables are
bound to the values over the execution of the forms, which make up an implicit
<a 
href="clmse38.html#x50-82002r80">progn</a>. For example: <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(multiple-value-bind (x) (ﬂoor 5 3) (list x))  ⇒ (1)
</td></tr></table>
<!--l. 4576--><p class="indent" >                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(multiple-value-bind (x y) (ﬂoor 5 3) (list x y))  ⇒ (1 2)</td></tr></table>
<!--l. 4577--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(multiple-value-bind (x y z) (ﬂoor 5 3) (list x y z))</td></tr></table>
<!--l. 4578--><p class="indent" >                                                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">    ⇒ (1 2 <a 
href="clmse31.html#x42-70002r19">nil</a>)</td></tr></table>
<!--l. 4580--><p class="indent" >
</div>
</div>
</div>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i><b> multiple-value-setq </b><a 
 id="dx56-94015"></a><a 
 id="x56-94016r130"></a> variables form
</td></tr></table>
<!--l. 4585--><p class="indent" >
</div>
                                                                          

                                                                          
   The <i>variables</i> must be a list of variables. The <i>form</i> is evaluated, and the
variables are <i>set</i> (not bound) to the values returned by that form. If there are
more variables than values returned, extra values of <a 
href="clmse31.html#x42-70002r19">nil</a> are assigned to the
remaining variables. If there are more values than variables, the excess values are
simply discarded.
<div class=incompatibility>
   <b>Compatibility note:</b> In Lisp Machine Lisp this is called multiple-value. The added
clarity of the name <a 
href="#x56-94016r130">multiple-value-setq</a> in Common Lisp was deemed worth the
incompatibility with Lisp Machine Lisp.
</div>
                                                                          

                                                                          
   <a 
href="#x56-94016r130">multiple-value-setq</a> always returns a single value, which is the ﬁrst value
returned by <i>form</i>, or <a 
href="clmse31.html#x42-70002r19">nil</a> if <i>form</i> produces zero values.
<div class=newer>
   X3J13 voted in March 1989 <a 
 id="dx56-94017"></a>to specify that if any <i>var</i> refers not to an
ordinary variable but to a binding made by <a 
href="clmse39.html#x51-83036r96">symbol-macrolet</a>, then that
<i>var</i> is handled as if <a 
href="clmse35.html#x47-79002r61">setq</a> were used to assign the appropriate value to
it.
</div>
</div>
<div class=new>
<div class=defmac>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  <i>[Macro]</i><b> nth-value </b><a 
 id="dx56-94018"></a><a 
 id="x56-94019r131"></a> n form
</td></tr></table>
<!--l. 4618--><p class="indent" >
</div>
   X3J13 voted in January 1989 <a 
 id="dx56-94020"></a>to add a new macro named <a 
href="#x56-94019r131">nth-value</a>. The
argument forms <i>n</i> and <i>form</i> are both evaluated. The value of <i>n</i> must be a
non-negative integer, and the <i>form</i> may produce any number of values. The
integer <i>n</i> is used as a zero-based index into the list of values. Value <i>n</i> of the <i>form</i>
is returned as the single value of the <a 
href="#x56-94019r131">nth-value</a> form; <a 
href="clmse31.html#x42-70002r19">nil</a> is returned if the <i>form</i>
produces no more than <i>n</i> values.
   As an example, <a 
href="clmse71.html#x88-130020r260">mod</a> could be deﬁned as <div class=lisp> <div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defun mod (number divisor)
</td></tr></table>
<!--l. 4633--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  (nth-value 1 (ﬂoor number divisor)))</td></tr></table>
<!--l. 4635--><p class="indent" >
</div>
</div>
<!--l. 4636--><p class="noindent" >Value number 1 is the <i>second</i> value returned by <a 
href="clmse71.html#x88-130012r256">ﬂoor</a>, the ﬁrst value being value
number 0.
<!--l. 4639--><p class="indent" >   One could deﬁne <a 
href="#x56-94019r131">nth-value</a> simply as <div class=lisp> <div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(defmacro nth-value (n form)
</td></tr></table>
<!--l. 4641--><p class="indent" >                                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">  ‘(nth ,n (multiple-value-list ,form)))</td></tr></table>
<!--l. 4643--><p class="indent" >
</div>
</div>
<!--l. 4644--><p class="noindent" >but the clever implementor will doubtless ﬁnd an implementation technique for
<a 
href="#x56-94019r131">nth-value</a> that avoids constructing an intermediate list of all the values of the
<i>form</i>.
</div>
</div>
   <h4 class="subsectionHead"><span class="titlemark">7.10.2   </span> <a 
 id="x56-950007.10.2"></a>Rules Governing the Passing of Multiple Values</h4>
<!--l. 4652--><p class="noindent" >It is often the case that the value of a special form or macro call is deﬁned to be
the value of one of its subforms. For example, the value of a <a 
href="clmse40.html#x52-84008r100">cond</a> is the value of
the last form in the selected clause.
<!--l. 4658--><p class="indent" >   In most such cases, if the subform produces multiple values, then the original
form will also produce all of those values. This <i>passing back</i> of multiple values of
course has no eﬀect unless eventually one of the special forms for receiving
multiple values is reached.
<!--l. 4664--><p class="indent" >   To be explicit, multiple values can result from a special form under precisely
these circumstances:
<div class=flushdesc>
<!--l. 4668--><p class="indent" >
  <div><br /><b>
<i>Evaluation and application</i>                                                </b>
     <ul class="itemize1">
     <li class="itemize"><a 
href="clmse110.html#x135-180002r620">eval</a> returns multiple values if the form given it to evaluate produces
     multiple values.
     </li>
     <li class="itemize"><a 
href="clmse37.html#x49-81002r77">apply</a>, <a 
href="clmse37.html#x49-81005r78">funcall</a>, and <a 
href="#x56-94010r127">multiple-value-call</a> pass back multiple values from
     the function applied or called.</li></ul>
                                                                          

                                                                          
  <br /><b>
<i>Implicit <a 
href="clmse38.html#x50-82002r80">progn</a> contexts</i>                                                    </b>
     <ul class="itemize1">
     <li class="itemize">The  special  form  <a 
href="clmse38.html#x50-82002r80">progn</a>  passes  back  multiple  values  resulting  from
     evaluation of the last subform. Other situations referred to as “implicit
     <a 
href="clmse38.html#x50-82002r80">progn</a>,”  where several forms are evaluated and the results of all but
     the last form are discarded, also pass back multiple values from the
     last form. These situations include the body of a lambda-expression,
     in particular those constructed by <a 
href="clmse30.html#x40-66002r13">defun</a>, <a 
href="clmse46.html#x59-98007r137">defmacro</a>, and <a 
href="clmse24.html#x33-51002r6">deftype</a>. Also
     included are bodies of the constructs <a 
href="clmse30.html#x40-68005r18">eval-when</a>, <a 
href="clmse39.html#x51-83018r89">progv</a>, <a 
href="clmse39.html#x51-83005r84">let</a>, let*, <a 
href="clmse141.html#x172-248004r879">when</a>,
     <a 
href="clmse141.html#x172-248006r880">unless</a>, <a 
href="clmse41.html#x53-85002r103">block</a>, <a 
href="#x56-94014r129">multiple-value-bind</a>, and <a 
href="clmse45.html#x57-96006r132">catch</a>, as well as clauses in such
     conditional constructs as <a 
href="clmse40.html#x52-84010r101">case</a>, <a 
href="clmse40.html#x52-84012r102">typecase</a>, <a 
href="clmse155.html#x189-337006r998">ecase</a>, <a 
href="clmse155.html#x189-337002r996">etypecase</a>, <a 
href="clmse155.html#x189-337008r999">ccase</a>, and
     <a 
href="clmse155.html#x189-337004r997">ctypecase</a>.</li></ul>
</div>
</div>
<div class=new>
<!--l. 4704--><p class="indent" >   X3J13 has voted to add many new constructs to the language that contain
implicit <a 
href="clmse38.html#x50-82002r80">progn</a> contexts. I won&#x2019;t attempt to list them all here. Of particular
interest, however, is <a 
href="clmse51.html#x65-104016r155">locally</a>, which may be regarded as simply a version of
<a 
href="clmse38.html#x50-82002r80">progn</a> that permits declarations before its body. This provides a useful
building block for constructing macros that permit declarations (but not
documentation strings) before their bodies and pass back any multiple
values produced by the last sub-form of a body. (If a body can contain a
documentation string, most likely lambda is the correct building block to
use.)
</div>
<div class=flushdesc>
<!--l. 4716--><p class="indent" >
  <div><br /><b>
<i>Conditional constructs</i>                                                    </b>
     <ul class="itemize1">
     <li class="itemize"><a 
href="clmse141.html#x172-248002r878">if</a> passes back multiple values from whichever subform is selected (the
     <i>then</i> form or the <i>else</i> form).
     </li>
     <li class="itemize"><a 
href="clmse34.html#x45-75004r51">and</a> and <a 
href="clmse34.html#x45-75006r52">or</a> pass back multiple values from the last subform but not
                                                                          

                                                                          
     from subforms other than the last.
     </li>
     <li class="itemize"><a 
href="clmse40.html#x52-84008r100">cond</a> passes back multiple values from the last subform of the implicit
     <a 
href="clmse38.html#x50-82002r80">progn</a> of the selected clause. If, however, the clause selected is a singleton
     clause, then only a single value (the non-<a 
href="clmse31.html#x42-70002r19">nil</a> predicate value) is returned.
     This is true even if the singleton clause is the last clause of the <a 
href="clmse40.html#x52-84008r100">cond</a>.
     It is <i>not</i> permitted to treat a ﬁnal clause (x) as being the same as (t x)
     for this reason; the latter passes back multiple values from the form x.</li></ul>
  <br /><b>
<i>Returning from a block</i>                                                    </b>
     <ul class="itemize1">
     <li class="itemize">The <a 
href="clmse41.html#x53-85002r103">block</a> construct passes back multiple values from its last subform
     when it exits normally. If <a 
href="clmse41.html#x53-85004r104">return-from</a> (or <a 
href="clmse142.html#x173-249006r883">return</a>) is used to terminate
     the <a 
href="clmse41.html#x53-85002r103">block</a> prematurely, then <a 
href="clmse41.html#x53-85004r104">return-from</a> passes back multiple values
     from its subform as the values of the terminated <a 
href="clmse41.html#x53-85002r103">block</a>. Other constructs
     that create implicit blocks, such as <a 
href="clmse142.html#x173-249002r881">do</a>, <a 
href="clmse42.html#x54-89002r111">dolist</a>, <a 
href="clmse42.html#x54-89005r112">dotimes</a>, <a 
href="clmse42.html#x54-91004r120">prog</a>, and prog*,
     also pass back multiple values speciﬁed by <a 
href="clmse41.html#x53-85004r104">return-from</a> (or <a 
href="clmse142.html#x173-249006r883">return</a>).
     </li>
     <li class="itemize"><a 
href="clmse142.html#x173-249002r881">do</a> passes back multiple values from the last form of the exit clause,
     exactly as if the exit clause were a <a 
href="clmse40.html#x52-84008r100">cond</a> clause. Similarly, <a 
href="clmse42.html#x54-89002r111">dolist</a> and
     <a 
href="clmse42.html#x54-89005r112">dotimes</a> pass back multiple values from the <i>resultform</i> if that is executed.
     These situations are all examples of implicit uses of <a 
href="clmse41.html#x53-85004r104">return-from</a>.</li></ul>
  <br /><b>
<i>Throwing out of a catch</i>                                                   </b>
     <ul class="itemize1">
     <li class="itemize">The <a 
href="clmse45.html#x57-96006r132">catch</a> construct returns multiple values if the result form in a <a 
href="clmse45.html#x57-96013r134">throw</a>
     exiting from such a catch produces multiple values.</li></ul>
  <br /><b>
<i>Miscellaneous situations</i>                                                  </b>
     <ul class="itemize1">
     <li class="itemize">multiple-value-prog1 passes back multiple values from its ﬁrst subform.
     However, prog1 always returns a single value.
     </li>
                                                                          

                                                                          
     <li class="itemize"><a 
href="clmse45.html#x57-96010r133">unwind-protect</a> returns multiple values if the form it protects returns
     multiple values.
     </li>
     <li class="itemize"><a 
href="clmse53.html#x67-106002r158">the</a>  returns  multiple  values  if  the  form  it  contains  returns  multiple
     values.</li></ul>
</div>
</div>
<!--l. 4782--><p class="indent" >   Among special forms that <i>never</i> pass back multiple values are prog1, prog2,
<a 
href="clmse35.html#x47-79002r61">setq</a>, and <a 
href="#x56-94016r130">multiple-value-setq</a>. The conventional way to force only one value to be
returned from a form x is to write (values x).
<!--l. 4788--><p class="indent" >   The most important rule about multiple values is: <b>No matter how many
values a form produces, if the form is an argument form in a function
call, then exactly one value (the ﬁrst one) is used.</b>
<!--l. 4793--><p class="indent" >   For example, if you write (cons (ﬂoor x)), then <a 
href="clmse86.html#x106-148062r474">cons</a> will always receive <i>exactly</i>
one argument (which is of course an error), even though <a 
href="clmse71.html#x88-130012r256">ﬂoor</a> returns two values.
To pass both values from <a 
href="clmse71.html#x88-130012r256">ﬂoor</a> to <a 
href="clmse86.html#x106-148062r474">cons</a>, one must write something like
(multiple-value-call #&#x2019;cons (ﬂoor x)). In an ordinary function call, each argument
form produces exactly <i>one</i> argument; if such a form returns zero values, <a 
href="clmse31.html#x42-70002r19">nil</a> is
used for the argument, and if more than one value, all but the ﬁrst are
discarded. Similarly, conditional constructs such as <a 
href="clmse141.html#x172-248002r878">if</a> that test the value of a
form will use exactly one value, the ﬁrst one, from that form and discard
the rest; such constructs will use <a 
href="clmse31.html#x42-70002r19">nil</a> as the test value if zero values are
returned.
                                                                          

                                                                          
   <!--l. 4806--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse45.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse43.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse43.html#tailclmse43.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse44.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch7.html#clmse44.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 4806--><p class="indent" >   <a 
 id="tailclmse44.html"></a>  
</body></html> 
