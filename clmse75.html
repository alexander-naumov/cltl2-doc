<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Объединение, отображение и приведение последовательностей</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-04 00:46:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 1649--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse76.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse74.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse74.html#tailclmse74.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse75.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse75.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">14.2   </span> <a 
href="clm.html#QQ2-94-223" id="x94-19500014.2">Объединение, отображение и приведение последовательностей</a></h3>
<!--l. 1651--><p class="noindent" >Функции в этом разделе могут обрабатывать произвольное количество
последовательностей за исключением функции <tt><a 
href="#x94-195016r362">reduce</a></tt>, которая была
включена сюда из-за концептуальной связи с функциями отображения.
<div class=defun>
<!--l. 1655--><p class="noindent" ><i>[Функция]</i><a 
 id="dx94-195001"></a><a 
 id="x94-195002r355"></a><b> concatenate</b>  <i>result-type</i> &#x0026;rest  <i>sequences</i>
<!--l. 1657--><p class="noindent" >Результатом является новая последовательность, которая содержит по
порядку все элементы указанных последовательностей. Результат не
содержит связей с аргументами (в этом <tt><a 
href="#x94-195002r355">concatenate</a></tt> отличается от <tt><a 
href="clmse128.html#x158-320002r780">append</a></tt>).
Тип результата указывается в аргументе <i>result-type</i>, который должен быть
подтипом <tt>sequence</tt>, как для функции <tt><a 
href="clmse24.html#x33-52002r7">coerce</a></tt>. Необходимо, чтобы
элементы исходных последовательностей принадлежали указанному типу
<i>result-type</i>.
<!--l. 1666--><p class="indent" >   Если указана только одна последовательность, и она имеет тот же тип,
что указан в <i>result-type</i>, <tt><a 
href="#x94-195002r355">concatenate</a></tt> всё равно копирует аргумент и
возвращает новую последовательность. Если вам не требуется копия, а
просто необходимо преобразовать тип последовательности, лучше
использовать <tt><a 
href="clmse24.html#x33-52002r7">coerce</a></tt>.
</div>
<div class=defun>
<!--l. 1673--><p class="noindent" ><i>[Функция]</i><a 
 id="dx94-195003"></a><a 
 id="x94-195004r356"></a><b> map</b>  <i>result-type</i> <i>function</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i>
<!--l. 1675--><p class="noindent" >Функция <i>function</i> должна принимать только аргументов, сколько
последовательностей было передано в <tt><a 
href="#x94-195004r356">map</a></tt>. Результат функции <tt><a 
href="#x94-195004r356">map</a></tt>
— последовательность, элементы которой являются результатами
применения функции <i>function</i> к соответствующим элементам исходных
последовательностей. Длина итоговой последовательности равна длине самой
короткой исходной.
<!--l. 1683--><p class="indent" >   Если функция <i>function</i> имеет побочные эффекты, она может рассчитывать
на то, что сначала будет вызвана со всеми элементами в <tt>0</tt>-ой позиции, затем
со всеми в <tt>1</tt>-ой и так далее.
<!--l. 1687--><p class="indent" >   Тип итоговой последовательности указывается в аргументе <i>result-type</i> (и
                                                                          

                                                                          
должен быть подтипом <tt>sequence</tt>). Кроме того, для типа можно указать <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>,
и это означает, что результата быть не должно. В таком случае функция
<i>function</i> вызывается только для побочных эффектов, и <tt><a 
href="#x94-195004r356">map</a></tt> возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. В
этом случае <tt><a 
href="#x94-195004r356">map</a></tt> похожа на <tt><a 
href="clmse41.html#x53-124007r97">mapc</a></tt>.
<!--l. 1694--><p class="indent" >   Например: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(map &#x2019;list #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (-1 -2 -3 -4)
</td></tr></table>
<!--l. 1696--><p class="indent" >                                                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(map &#x2019;string</td></tr></table>
<!--l. 1697--><p class="indent" >                              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     #&#x2019;(lambda (x) (if (oddp x) #\1 #\0))</td></tr></table>
<!--l. 1698--><p class="indent" >                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     &#x2019;(1 2 3 4))</td></tr></table>
<!--l. 1699--><p class="indent" >                                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> &#x0022;1010&#x0022;</td></tr></table>
<!--l. 1701--><p class="indent" >
</div>
</div>
</div>
<div class=defun>
<!--l. 1705--><p class="noindent" ><i>[Функция]</i><a 
 id="dx94-195005"></a><a 
 id="x94-195006r357"></a><b> map-into</b>  <i>result-sequence</i> <i>function</i> &#x0026;rest  <i>sequences</i>
<!--l. 1707--><p class="noindent" >Функция <tt><a 
href="#x94-195006r357">map-into</a></tt> вычисляет последовательность с помощью применения
функции <i>function</i> к соответствующим элементам исходных последовательностей
и помещает результат в последовательность <i>result-sequence</i>. Функция
возвращается <i>result-sequence</i>.
<!--l. 1713--><p class="indent" >   Аргументы <i>result-sequence</i> и все <i>sequences</i> должны быть списками или
векторами (одномерными массивами). Функция <i>function</i> должна принимать
столько аргументов, сколько было указано исходных последовательностей.
Если <i>result-sequence</i> и другие аргументы <i>sequences</i> не одинаковой длины, цикл
закончится на самой короткой последовательности. Если <i>result-sequence</i>
является вектором с указателем заполнения, то этот указатель во время
цикла игнорируется, а после завершения устанавливается на то количество
элементов, которые были получены от функции <i>function</i>.
<!--l. 1723--><p class="indent" >   Если функция <i>function</i> имеет побочные эффекты, она может рассчитывать
на то, что сначала будет вызвана со всеми элементами в <tt>0</tt>-ой позиции, затем
со всеми в <tt>1</tt>-ой и так далее.
<!--l. 1727--><p class="indent" >   Функция <tt><a 
href="#x94-195006r357">map-into</a></tt> отличается от <tt><a 
href="#x94-195004r356">map</a></tt> тем, что модифицирует уже
имеющуюся последовательность, а не создаёт новую. Кроме того, <tt><a 
href="#x94-195006r357">map-into</a></tt>
может быть вызвана только с двумя аргументами (<i>result-sequence</i> и <i>function</i>),
тогда как <tt><a 
href="#x94-195004r356">map</a></tt> требует как минимум три параметра.
                                                                          

                                                                          
<!--l. 1732--><p class="indent" >   Если <i>result-sequence</i> является <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, <tt><a 
href="#x94-195006r357">map-into</a></tt> немедленно возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>,
потому что длина <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt> последовательности равняется нулю.
</div>
<div class=defun>
<!--l. 1738--><p class="noindent" ><i>[Функция]</i><a 
 id="dx94-195007"></a><a 
 id="x94-195008r358"></a><b> some</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx94-195009"></a><a 
 id="x94-195010r359"></a><b> every</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx94-195011"></a><a 
 id="x94-195012r360"></a><b> notany</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i><br 
class="newline" /><i>[Функция]</i><a 
 id="dx94-195013"></a><a 
 id="x94-195014r361"></a><b> notevery</b>  <i>predicate</i> <i>sequence</i> &#x0026;rest  <i>more-sequences</i>
<!--l. 1743--><p class="noindent" >Всё это предикаты. Функция <i>predicate</i> должна принимать столько
аргументов, сколько было указано последовательностей. Функция <i>predicate</i>
сначала применяется к элементам <tt>0</tt>-ой позиции, затем, возможно, к
элементам <tt>1</tt>-ой позиции, и так далее, до тех пор пока не сработает условие
завершения цикла или не закончится одна из последовательностей
<i>sequences</i>.
<!--l. 1751--><p class="indent" >   Если <i>predicate</i> имеет побочные эффекты, он может рассчитывать на то,
что сначала будет вызвана со всеми элементами в <tt>0</tt>-ой позиции, затем со
всеми в <tt>1</tt>-ой и так далее.
<tt>
<!--l. 1755--><p class="indent" >   <a 
href="#x94-195008r358">some</a></tt> завершается, как только применение <i>predicate</i> вернёт не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>
значение. Тогда <tt><a 
href="#x94-195008r358">some</a></tt> возвращает значение, на котором произошла остановка.
Если цикл достиг конца последовательности и ни одно применение <i>predicate</i>
не вернуло не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, тогда возвращается значение <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Таким образом, можно
сказать, что предикат <tt><a 
href="#x94-195008r358">some</a></tt> истинен, если <i>какой-либо (some)</i> вызов <i>predicate</i>
истинен.
<tt>
<!--l. 1762--><p class="indent" >   <a 
href="#x94-195010r359">every</a></tt> возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, как только применение <i>predicate</i> возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
Если цикл достиг конца последовательности, <tt><a 
href="#x94-195010r359">every</a></tt> возвращает не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
Таким образом, можно сказать, что предикат <tt><a 
href="#x94-195010r359">every</a></tt> истинен, если <i>каждый
(every)</i> вызов <i>predicate</i> истинен.
<tt>
<!--l. 1768--><p class="indent" >   <a 
href="#x94-195012r360">notany</a></tt> возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, как только применение <i>predicate</i> возвращает
не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Если цикл достиг конца последовательности, <tt><a 
href="#x94-195012r360">notany</a></tt> возвращает
не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Таким образом, можно сказать, что предикат <tt><a 
href="#x94-195012r360">notany</a></tt> истинен, если <i>ни
какой (notany)</i> вызов <i>predicate</i> не истинен.
<tt>
<!--l. 1774--><p class="indent" >   <a 
href="#x94-195014r361">notevery</a></tt> возвращает не-<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>, как только применение <i>predicate</i> возвращает
<tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Если цикл достиг конца последовательности, <tt><a 
href="#x94-195014r361">notevery</a></tt> возвращает <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>.
Таким образом, можно сказать, что предикат <tt><a 
href="#x94-195014r361">notevery</a></tt> истинен, если <i>ни
                                                                          

                                                                          
каждый (notany)</i> вызов <i>predicate</i> истинен.
</div>
<div class=defun>
<!--l. 1781--><p class="noindent" ><i>[Функция]</i><a 
 id="dx94-195015"></a><a 
 id="x94-195016r362"></a><b> reduce</b>  <i>function</i> <i>sequence</i> &#x0026;key  <i>:from-end</i> <i>:start</i> <i>:end</i> <i>:initial-value</i>
<!--l. 1783--><p class="noindent" >Функция <tt><a 
href="#x94-195016r362">reduce</a></tt> объединяет все элементы последовательности использую
заданную (бинарную binary) операцию. Например <tt><a 
href="clmse104.html#x129-237002r568">+</a></tt> может суммировать все
элементы последовательности.
<!--l. 1788--><p class="indent" >   Указанная подпоследовательность последовательности <i>sequence</i>
объединяется или «редуцируется» с помощью функции <i>function</i>, которая
должна принимать два аргумента. Приведение (редуцирование, объединение)
является левоассоциативным, если только <tt>:from-end</tt> не содержит истину, в
последнем случае операция становиться правоассоциативной. По-умолчанию
<tt>:from-end</tt> равно <tt><a 
href="clmse30.html#x41-73002r18">nil</a></tt>. Если задан аргумент <tt>:initial-value</tt>, то он логически
помещается перед подпоследовательностью (или после в случае истинности
<tt>:from-end</tt>) и включается в операцию редуцирования.
<!--l. 1798--><p class="indent" >   Если указанная подпоследовательность содержит только один
элемент и параметр <tt>:initial-value</tt> не задан, тогда этот элемент
возвращается, и функция <i>function</i> ни разу не вызывается. Если заданная
подпоследовательность пуста, и задан параметр <tt>:initial-value</tt>, тогда
возвращается <tt>:initial-value</tt>, и функция <i>function</i> не вызывается.
<!--l. 1804--><p class="indent" >   Если заданная подпоследовательность пуста, и параметр <tt>:initial-value</tt>
не задан, тогда функция <i>function</i> вызывается без аргументов, и <tt><a 
href="#x94-195016r362">reduce</a></tt>
возвращает то, что вернула эта функция. Это единственное исключение из
правила о том, что функция <i>function</i> вызывается с двумя аргументами.
<div class=lisp>
<div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> 10
</td></tr></table>
<!--l. 1810--><p class="indent" >                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;- &#x2019;(1 2 3 4)) <span class="math"> ≡</span> (- (- (- 1 2) 3) 4) <span class="math"> ⇒</span> -8</td></tr></table>
<!--l. 1811--><p class="indent" >          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;- &#x2019;(1 2 3 4) :from-end t)     ;Альтернативная сумма</td></tr></table>
<!--l. 1812--><p class="indent" >                                            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ≡</span> (- 1 (- 2 (- 3 4))) <span class="math"> ⇒</span> -2</td></tr></table>
<!--l. 1813--><p class="indent" >                                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;()) <span class="math"> ⇒</span> 0</td></tr></table>
<!--l. 1814--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;(3)) <span class="math"> ⇒</span> 3</td></tr></table>
<!--l. 1815--><p class="indent" >                                               <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;+ &#x2019;(foo)) <span class="math"> ⇒</span> foo</td></tr></table>
<!--l. 1816--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4)) <span class="math"> ⇒</span> (((1 2) 3) 4)</td></tr></table>
                                                                          

                                                                          
<!--l. 1817--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4) :from-end t) <span class="math"> ⇒</span> (1 (2 (3 4)))</td></tr></table>
<!--l. 1818--><p class="indent" >                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4) :initial-value &#x2019;foo)</td></tr></table>
<!--l. 1819--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> ((((foo 1) 2) 3) 4)</td></tr></table>
<!--l. 1820--><p class="indent" >                                                   <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(reduce #&#x2019;list &#x2019;(1 2 3 4)</td></tr></table>
<!--l. 1821--><p class="indent" >                                    <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">        :from-end t :initial-value &#x2019;foo)</td></tr></table>
<!--l. 1822--><p class="indent" >                                                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">   <span class="math"> ⇒</span> (1 (2 (3 (4 foo))))</td></tr></table>
<!--l. 1824--><p class="indent" >
</div>
</div>
<!--l. 1825--><p class="noindent" >Если функция <i>function</i> имеет побочные эффекта, можно положится на порядок
вызовов функции так, как было продемонстрировано выше.
<!--l. 1828--><p class="indent" >   Имя «reduce» было позаимствовано из APL.
</div>
                                                                          

                                                                          
   <!--l. 1831--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmse76.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse74.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse74.html#tailclmse74.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse75.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch14.html#clmse75.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 1831--><p class="indent" >   <a 
 id="tailclmse75.html"></a>  
</body></html> 
