<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Цикл взаимодействия с пользователем</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-14 15:35:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 562--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch21.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html#tailclmse107.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse108.html">Tail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse108.html" >Up</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">20.2   </span> <a 
 id="x133-24200020.2"></a>Цикл взаимодействия с пользователем</h3>
<!--l. 564--><p class="noindent" >С Lisp&#x2019;ом можно работать через специальный цикл вида «<a 
href="clmse113.html#x140-260003r658">read</a>-<a 
href="clmse107.html#x132-241002r586">eval</a>-<a 
href="clmse114.html#x141-263010r675">print</a> и
сначала». Изменять состояние Lisp системы можно вызовом в этом цикле
действий, имеющих побочные эффекты.
<!--l. 569--><p class="indent" >   Точное определение такого цикла для Common Lisp&#x2019;а не указывается
здесь специально, оставляя разработчикам поле для творчества. Например,
они могут сделать командную строку, или простой текстовый редактор, или
сложный графический интерфейс. Разработчики могут предоставлять
явный запрос ввода, или (как в MacLisp&#x2019;е) не загромождать экран
подсказками.
<!--l. 575--><p class="indent" >   Цикл взаимодействия с пользователем должен ловить все исключения и
изящно их обрабатывать. Он должен также выводить все результаты
вычисления форм, возможно в отдельных строках. Если форма вернула ноль
значений, это также должно быть отображено.
<!--l. 580--><p class="indent" >   Следующие переменные управляются циклом взаимодействия с
пользователем, для удобства работы, например в случае, если пользователь
забыл сохранить интересное введённое выражение или выведенное значение.
(Следует отметить, что имена некоторых этих переменных нарушают
нотацию глобальных переменных в использовании звёздочек в начале и конце
имени.) Эти переменные в основном используются для взаимодействия с
пользователем, поэтому имеют короткие имена. Использование этих
переменных в программах следует избегать.
<div class=defun>
<!--l. 588--><p class="noindent" ><i>[Variable]</i><a 
 id="dx133-242001"></a><a 
 id="x133-242002r592"></a><b> +</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx133-242003"></a><a 
 id="x133-242004r593"></a><b> ++</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx133-242005"></a><a 
 id="x133-242006r594"></a><b> +++</b>
<!--l. 592--><p class="noindent" >Когда форма вычисляется в цикле взаимодействия, переменная <a 
href="#x133-242002r592">+</a>
связывается с предыдущим прочитанным выражением. Переменная <a 
href="#x133-242004r593">++</a>
хранит предыдущее относительно значения <a 
href="#x133-242002r592">+</a> (то есть, форма вычисленная
два шага назад), и <a 
href="#x133-242006r594">+++</a> хранит предыдущее значение относительно
<a 
href="#x133-242004r593">++</a>.
                                                                          

                                                                          
</div>
<div class=defun>
<!--l. 600--><p class="noindent" ><i>[Variable]</i><a 
 id="dx133-242007"></a><a 
 id="x133-242008r595"></a><b> -</b>
<!--l. 602--><p class="noindent" >Когда формы выполняется в цикле взаимодействия, переменная <a 
href="#x133-242008r595">-</a> связана с
этой формой. Это значение, которое получит переменная <a 
href="#x133-242002r592">+</a> на следующей
итерации цикла.
</div>
<div class=defun>
<!--l. 608--><p class="noindent" ><i>[Variable]</i><a 
 id="dx133-242009"></a><a 
 id="x133-242010r596"></a><b> *</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx133-242011"></a><a 
 id="x133-242012r597"></a><b> **</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx133-242013"></a><a 
 id="x133-242014r598"></a><b> ***</b>
<!--l. 612--><p class="noindent" >Во время вычисления формы в цикле взаимодействия, переменная <a 
href="#x133-242010r596">*</a> связана
с результатом выполнения предыдущей формы, то есть значения формы,
которая хранится в <a 
href="#x133-242002r592">+</a>. Если результат той формы содержал несколько
значений, в <a 
href="#x133-242010r596">*</a> будет только первое. Если было возвращено ноль значений, <a 
href="#x133-242010r596">*</a>
будет содержать <a 
href="clmse31.html#x42-74002r18">nil</a>. Переменная <a 
href="#x133-242012r597">**</a> хранит предыдущее значение
относительно <a 
href="#x133-242010r596">*</a>. То есть, результат вычисления формы из <a 
href="#x133-242012r597">**</a>. <a 
href="#x133-242014r598">***</a> хранит
предыдущее значение относительно <a 
href="#x133-242014r598">***</a>.
<!--l. 622--><p class="indent" >   Если выполнение <a 
href="#x133-242002r592">+</a> было по каким-то причинам прервано, тогда значения
<a 
href="#x133-242010r596">*</a>, <a 
href="#x133-242012r597">**</a> и <a 
href="#x133-242014r598">***</a> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
</div>
<div class=defun>
<!--l. 628--><p class="noindent" ><i>[Variable]</i><a 
 id="dx133-242015"></a><a 
 id="x133-242016r599"></a><b> /</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx133-242017"></a><a 
 id="x133-242018r600"></a><b> //</b> <br 
class="newline" /><i>[Variable]</i><a 
 id="dx133-242019"></a><a 
 id="x133-242020r601"></a><b> ///</b>
<!--l. 632--><p class="noindent" >Во время вычисления формы в цикле взаимодействия, переменная <a 
href="#x133-242016r599">/</a> связана
со списком результатов выведенных на предыдущей итерации. То есть
это список всех значений выполнения формы <a 
href="#x133-242002r592">+</a>. Значение <a 
href="#x133-242010r596">*</a> должно
всегда совпадать со значением <i>car</i> элемента значения <a 
href="#x133-242016r599">/</a>. Переменная <a 
href="#x133-242018r600">//</a>
хранит предыдущий список значений относительно <a 
href="#x133-242016r599">/</a> (то есть, результат
вычисленный две итерации назад), и <a 
href="#x133-242020r601">///</a> содержит предыдущий список
значений относительно <a 
href="#x133-242020r601">///</a>. Таким образом, значение <a 
href="#x133-242012r597">**</a> должно всегда
совпадать со значением <i>car</i> элемента списка <a 
href="#x133-242018r600">//</a>, а <a 
href="#x133-242014r598">***</a> с с <i>car</i> элементом
<a 
href="#x133-242020r601">///</a>.
<!--l. 644--><p class="indent" >   Если выполнение <a 
href="#x133-242002r592">+</a> было по каким-то причинам прервано, тогда значения
<a 
href="#x133-242016r599">/</a>, <a 
href="#x133-242018r600">//</a> и <a 
href="#x133-242020r601">///</a> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
                                                                          

                                                                          
</div>
<!--l. 650--><p class="indent" >   В качестве примера работы с этими переменным, рассмотрим следующую
возможную работу с системой, где <a 
href="clmse65.html#x82-180008r181">&#x003E;</a> приглашение ввода: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(cons - -)                      </td><td  
class="tabbing">;Итерация 1
</td></tr></table>
<!--l. 654--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">((CONS - -) CONS - -)      </td><td  
class="tabbing">;Очаровашка?</td></tr></table>
<!--l. 655--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 656--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(values)                        </td><td  
class="tabbing">;Итерация 2</td></tr></table>
<!--l. 657--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                ;Ничего не выводится</td></tr></table>
<!--l. 658--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(cons &#x2019;a &#x2019;b)                    </td><td  
class="tabbing">;Итерация 3</td></tr></table>
<!--l. 659--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">(A . B)                           </td><td  
class="tabbing">;Это одно значение</td></tr></table>
<!--l. 660--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 661--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(hairy-loop)̂G               </td><td  
class="tabbing">;Итерация 4</td></tr></table>
<!--l. 662--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">### QUIT to top level.    </td><td  
class="tabbing">;(Пользователь прервал вычисления.)</td></tr></table>
<!--l. 663--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 664--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(ﬂoor 13 4)                    </td><td  
class="tabbing">;Итерация 5</td></tr></table>
<!--l. 665--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">3                                   </td><td  
class="tabbing">;Вернулось два значения</td></tr></table>
<!--l. 666--><p class="indent" >                                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">1</td></tr></table>
<!--l. 668--><p class="indent" >
</div>
</div>
<!--l. 669--><p class="noindent" >В этой точке мы имеем: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" >+++ ⇒ (cons &#x2019;a &#x2019;b) </td><td align="left" >*** ⇒ NIL   </td><td align="left" >/// ⇒ ()        </td>
</tr><tr><td align="left" >++ ⇒ (hairy-loop)   </td><td align="left" >** ⇒ (A . B)</td><td align="left" >// ⇒ ((A . B))</td>
</tr><tr><td align="left" >+ ⇒ (ﬂoor 13 4)      </td><td align="left" >* ⇒ 3          </td><td align="left" >/ ⇒ (3 1)       </td></tr></table>                        </div>
</td></tr></table><!--l. 676--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 750--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch21.html" >Next</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html" >Prev</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse107.html#tailclmse107.html" >PrevTail</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse108.html" >Front</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse108.html" >Up</a><tt>&#x003E;</tt></p></div>
<!--l. 750--><p class="indent" >   <a 
 id="tailclmse108.html"></a>  
</body></html> 
