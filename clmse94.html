<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Changing the Dimensions of an Array</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,next,charset=utf-8,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-18 01:47:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 867--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch18.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse93.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse93.html#tailclmse93.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse94.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch17.html#clmse94.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">17.6   </span> <a 
 id="x116-22000017.6"></a>Changing the Dimensions of an Array</h3>
<!--l. 869--><p class="noindent" >This function may be used to resize or reshape an array. Its options are similar to
those of <a 
href="clmse89.html#x111-215002r520">make-array</a>.
<div class=defun>
<!--l. 872--><p class="noindent" ><i>[Function]</i><a 
 id="dx116-220001"></a><a 
 id="x116-220002r554"></a><b> adjust-array</b>  <i>array</i> <i>new-dimensions</i> &#x0026;key  <i>:element-type</i>
<i>:initial-element</i> <i>:initial-contents</i> <i>:ﬁll-pointer</i> <i>:displaced-to</i> <i>:displaced-index-oﬀset</i>
<!--l. 874--><p class="noindent" ><a 
href="#x116-220002r554">adjust-array</a> takes an array and a number of other arguments as for <a 
href="clmse89.html#x111-215002r520">make-array</a>.
The number of dimensions speciﬁed by <i>new-dimensions</i> must equal the rank of
<i>array</i>.
<!--l. 879--><p class="indent" >   <a 
href="#x116-220002r554">adjust-array</a> returns an array of the same type and rank as <i>array</i>, with the
speciﬁed <i>new-dimensions</i>. In eﬀect, the <i>array</i> argument itself is modiﬁed to
conform to the new speciﬁcations, but this may be achieved either by modifying
the <i>array</i> or by creating a new array and modifying the <i>array</i> argument to be
<i>displaced</i> to the new array.
<!--l. 886--><p class="indent" >   In the simplest case, one speciﬁes only the <i>new-dimensions</i> and possibly
an :initial-element argument. Those elements of <i>array</i> that are still in
bounds appear in the new array. The elements of the new array that are
not in the bounds of <i>array</i> are initialized to the :initial-element; if this
argument is not provided, then the initial contents of any new elements are
undeﬁned.
<!--l. 894--><p class="indent" >   If :element-type is speciﬁed, then <i>array</i> must be such that it could have
been originally created with that type; otherwise an error is signaled.
Specifying :element-type to <a 
href="#x116-220002r554">adjust-array</a> serves only to require such an error
check.
<!--l. 899--><p class="indent" >   If :initial-contents or :displaced-to is speciﬁed, then it is treated as for
<a 
href="clmse89.html#x111-215002r520">make-array</a>. In this case none of the original contents of <i>array</i> appears in the new
array.
<!--l. 904--><p class="indent" >   If :ﬁll-pointer is speciﬁed, the ﬁll pointer of the <i>array</i> is reset as speciﬁed. An
error is signaled if <i>array</i> had no ﬁll pointer already.
<div class=new>
<!--l. 909--><p class="indent" >   X3J13 voted in June 1988 <a 
 id="dx116-220003"></a>to clarify the treatment of the :ﬁll-pointer argument
                                                                          

                                                                          
as follows.
<!--l. 914--><p class="indent" >   If the :ﬁll-pointer argument is not supplied, then the ﬁll pointer of the <i>array</i> is
left alone. It is an error to try to adjust the <i>array</i> to a total size that is smaller
than its ﬁll pointer.
<!--l. 919--><p class="indent" >   If the :ﬁll-pointer argument is supplied, then its value must be either an
integer, <a 
href="clmse31.html#x42-74004r19">t</a>, or <a 
href="clmse31.html#x42-74002r18">nil</a>. If it is an integer, then it is the new value for the ﬁll
pointer; it must be non-negative and no greater than the new size to
which the <i>array</i> is being adjusted. If it is <a 
href="clmse31.html#x42-74004r19">t</a>, then the ﬁll pointer is set
equal to the new size for the <i>array</i>. If it is <a 
href="clmse31.html#x42-74002r18">nil</a>, then the ﬁll pointer is
left alone; it is as if the argument had not been supplied. Again, it is an
error to try to adjust the <i>array</i> to a total size that is smaller than its ﬁll
pointer.
<!--l. 931--><p class="indent" >   An error is signaled if a non-<a 
href="clmse31.html#x42-74002r18">nil</a> :ﬁll-pointer value is supplied and the <i>array</i> to
be adjusted does not already have a ﬁll pointer.
<!--l. 935--><p class="indent" >   This extended treatment of the :ﬁll-pointer argument to <a 
href="#x116-220002r554">adjust-array</a> is
consistent with the previously existing treatment of the :ﬁll-pointer argument to
<a 
href="clmse89.html#x111-215002r520">make-array</a>.
</div>
<!--l. 940--><p class="indent" >   <a 
href="#x116-220002r554">adjust-array</a> may, depending on the implementation and the arguments,
simply alter the given array or create and return a new one. In the latter case the
given array will be altered so as to be displaced to the new array and have the
given new dimensions.
<div class=obsolete>
<!--l. 946--><p class="indent" >   It is not permitted to call <a 
href="#x116-220002r554">adjust-array</a> on an array that was not created with
the :adjustable option. The predicate <a 
href="clmse91.html#x113-217019r535">adjustable-array-p</a> may be used to
determine whether or not an array is adjustable.
</div>
<div class=newer>
<!--l. 953--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx116-220004"></a>to allow <a 
href="#x116-220002r554">adjust-array</a> to be applied to any array.
If <a 
href="#x116-220002r554">adjust-array</a> is applied to an array that was originally created with :adjustable
true, the array returned is <a 
href="clmse33.html#x44-78002r44">eq</a> to its ﬁrst argument. It is not speciﬁed
whether <a 
href="#x116-220002r554">adjust-array</a> returns an array <a 
href="clmse33.html#x44-78002r44">eq</a> to its ﬁrst argument for any other
arrays. If the array returned by <a 
href="#x116-220002r554">adjust-array</a> is not <a 
href="clmse33.html#x44-78002r44">eq</a> to its ﬁrst argument,
the original array is unchanged and does not share storage with the new
array.
<!--l. 964--><p class="indent" >   Under this new deﬁnition, it is wise to treat <a 
href="#x116-220002r554">adjust-array</a> in the same manner
as <a 
href="clmse78.html#x97-198014r382">delete</a> and <a 
href="clmse134.html#x165-333006r824">nconc</a>: one should carefully retain the returned value, for example by
writing <div class=lisp><div class=tabbing>
                                                                          

                                                                          
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(setq my-array (adjust-array my-array ...))
</td></tr></table>
<!--l. 969--><p class="indent" >
</div>
</div>
<!--l. 970--><p class="noindent" >rather than relying solely on a side eﬀect.
</div>
<!--l. 973--><p class="indent" >   If <a 
href="#x116-220002r554">adjust-array</a> is applied to an <i>array</i> that is displaced to another array <i>x</i>, then
afterwards neither <i>array</i> nor the returned result is displaced to <i>x</i> unless such
displacement is explicitly re-speciﬁed in the call to <a 
href="#x116-220002r554">adjust-array</a>.
<!--l. 978--><p class="indent" >   For example, suppose that the 4-by-4 array m looks like this: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#2A( ( alpha     beta      gamma     delta )
</td></tr></table>
<!--l. 980--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ( epsilon   zeta      eta       theta )</td></tr></table>
<!--l. 981--><p class="indent" >                       <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ( iota      kappa     lambda    mu    )</td></tr></table>
<!--l. 982--><p class="indent" >                      <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ( nu        xi        omicron   pi    ) )</td></tr></table>
<!--l. 984--><p class="indent" >
</div>
</div>
<!--l. 985--><p class="noindent" >Then the result of <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">(adjust-array m &#x2019;(3 5) :initial-element &#x2019;baz)
</td></tr></table>
<!--l. 988--><p class="indent" >
</div>
</div>
<!--l. 989--><p class="noindent" >is a 3-by-5 array with contents <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">#2A( ( alpha     beta      gamma     delta     baz )
</td></tr></table>
<!--l. 991--><p class="indent" >                 <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ( epsilon   zeta      eta       theta     baz )</td></tr></table>
<!--l. 992--><p class="indent" >            <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">     ( iota      kappa     lambda    mu        baz ) )</td></tr></table>
<!--l. 994--><p class="indent" >
                                                                          

                                                                          
</div>
</div>
<!--l. 995--><p class="noindent" >Note that if array a is created displaced to array b and subsequently array b is given
to <a 
href="#x116-220002r554">adjust-array</a>, array a will still be displaced to array b; the eﬀects of this
displacement and the rule of row-major storage order must be taken into
account.
<div class=newer>
<!--l. 1001--><p class="indent" >   X3J13 voted in June 1988 <a 
 id="dx116-220005"></a>to clarify the interaction of <a 
href="#x116-220002r554">adjust-array</a> with array
displacement.
<!--l. 1004--><p class="indent" >   Suppose that an array <i>A</i> is to be adjusted. There are four cases according to
whether or not <i>A</i> was displaced before adjustment and whether or not the result
is displaced after adjustment.
      <ul class="itemize1">
      <li class="itemize">Suppose <i>A</i> is not displaced either before or after. The dimensions of <i>A</i>
      are altered, and the contents are rearranged as appropriate. Additional
      elements of <i>A</i> are taken from the :initial-element argument. However,
      the use of the :initial-contents argument causes all old contents to be
      discarded.
      </li>
      <li class="itemize">Suppose <i>A</i> is not displaced before, but is displaced to array <i>C</i> after.
      None of the original contents of <i>A</i> appears in <i>A</i> afterwards; <i>A</i> now
      contains (some of) the contents of <i>C</i>, without any rearrangement of <i>C</i>.
      </li>
      <li class="itemize">Suppose <i>A</i> is displaced to array B before the call, and is displaced to
      array <i>C</i> after the call. (Note that <i>B</i> and <i>C</i> may be the same array.)
      The contents of <i>B</i> do not appear in <i>A</i> afterwards (unless such contents
      also happen to be in <i>C</i>, as when <i>B</i> and <i>C</i> are the same, for example).
      If :displaced-index-oﬀset is not speciﬁed in the call to <a 
href="#x116-220002r554">adjust-array</a>, it
      defaults to zero; the old oﬀset (into <i>B</i>) is not retained.
      </li>
      <li class="itemize">Suppose <i>A</i> is displaced to array <i>B</i> before the call, but is not displaced
      afterwards.  In  this  case  <i>A</i> gets  a  new  “data  region”  and  (some  of)
      the contents of <i>B</i> are copied into it as appropriate to maintain the
      existing  old  contents.  Additional  elements  of  <i>A</i> are  taken  from  the
      :initial-element  argument.  However,  the  use  of  the  :initial-contents
      argument causes all old contents to be discarded.</li></ul>
                                                                          

                                                                          
<!--l. 1044--><p class="indent" >   If array <i>X</i> is displaced to array <i>Y </i>, and array <i>Y </i> is displaced to array <i>Z</i>, and
array <i>Y </i> is altered by <a 
href="#x116-220002r554">adjust-array</a>, array <i>X</i> must now refer to the adjusted
contents of <i>Y </i>. This means that an implementation may not collapse the chain to
make <i>X</i> refer to <i>Z</i> directly and forget that the chain of reference passes through
array <i>Y </i>. (Caching techniques are of course permitted, as long as they preserve the
semantics speciﬁed here.)
<!--l. 1052--><p class="indent" >   If <i>X</i> is displaced to <i>Y </i>, it is an error to adjust <i>Y </i> in such a way that it no
longer has enough elements to satisfy <i>X</i>. This error may be signaled at the time of
the adjustment, but this is not required.
<!--l. 1056--><p class="indent" >   Note that omitting the :displaced-to argument to <a 
href="#x116-220002r554">adjust-array</a> is equivalent to
specifying :displaced-to nil; in either case, the array is not displaced after the call
regardless of whether it was displaced before the call.
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 481--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch18.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse93.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse93.html#tailclmse93.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse94.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch17.html#clmse94.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 481--><p class="indent" >   <a 
 id="tailclmse94.html"></a>  
</body></html> 
