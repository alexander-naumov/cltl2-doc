<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Функции-конструкторы с позиционными аргументами</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-04-16 23:44:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
<link rel="stylesheet" type="text/css" href="cltl2ed.css"></head><body 
>
<!--l. 1942--><p class="noindent" > <div id="main_container"> <div id="content"> <div id="toplinks"><tt>&#x003C;</tt><a 
href="clmse106.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html#tailclmse104.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse105.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse105.html" >Наверх</a><tt>&#x003E;</tt></div><h3 class="sectionHead"><span class="titlemark">19.6   </span> <a 
href="clm.html#QQ2-129-1818" id="x129-178800019.6">Функции-конструкторы
с позиционными аргументами</a></h3>
<!--l. 1945--><p class="noindent" >Если опция <tt>:constructor</tt> указана так <tt>(<tt>:constructor</tt> <i>name</i> <i>arglist</i>)</tt>, тогда
вместо создания конструктора с именованными параметрами, <tt><a 
href="clmli7.html#x196-3479318r318">defstruct</a></tt>
определит конструктор с позиционными аргументами. Форма <i>arglist</i>
используется для описания того, какие аргументы будет принимать
конструктор. В простейшем случае что-то вроде <tt>(<tt>:constructor</tt> make-foo (a
b c))</tt> определяет функцию <tt>make-foo</tt> с тремя аргументами, которые
используются для инициализации слотов <tt>a</tt>, <tt>b</tt> и <tt>c</tt>.
<!--l. 1953--><p class="indent" >   Кроме того в список аргументов могут использоваться <tt>&#x0026;optional</tt>, <tt>&#x0026;rest</tt> и
<tt>&#x0026;aux</tt>. Они работают так, как и ожидается, но есть несколько тонкостей
достойных объяснения. Рассмотрим пример: <div class="lisp"><div class="tabbing">
(<tt>:constructor</tt> create-foo
   <br>                            (a &#x0026;optional b (c &#x2019;sea) &#x0026;rest d &#x0026;aux e (f &#x2019;eﬀ)))<br>
<!--l. 1959--><p class="noindent" ></div>
<!--l. 1959--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-178900019.6" id="x129-178900019.6"></a></span>
<!--l. 1959--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179000019.6" id="x129-179000019.6"></a></span>
</div>
<!--l. 1960--><p class="indent" >   Эта конструкция определяет конструктор <tt>create-foo</tt> для использования
с одним или более аргументами. Первый аргумент используется для
инициализации слота <tt>a</tt>. Если второй параметр не указан, используется
значение (если указано) по-умолчанию из тела <tt><a 
href="clmli7.html#x196-3479318r318">defstruct</a></tt>. Третий аргумент
используется для инициализации слота <tt>c</tt>. Если третий параметр не указан,
тогда используется символ <tt>sea</tt>. Все параметры после третьего собираются в
список и используются для инициализации слота <tt>d</tt>. Если указано три и
более параметров, тогда в слот <tt>d</tt> помещается значение <tt><a 
href="clmli7.html#x196-3479650r650">nil</a></tt>. Слот <tt>e</tt> <i>не
                                                                          

                                                                          
инициализируется</i>. Его первоначальное значение не определено. Наконец,
слот <tt><a 
href="clmli7.html#x196-3479382r382">f</a></tt> инициализируется символом <tt>eff</tt>.
<!--l. 1971--><p class="indent" >   Действия со слотами <tt>b</tt> и <tt>e</tt> выбраны не случайно, а для того чтобы
показать все возможные случаи использования аргументов. Следует
отметить, что <tt>&#x0026;aux</tt> (вспомогательные) «переменные» могут использоваться
для перекрытия форм инициализации из тела <tt><a 
href="clmli7.html#x196-3479318r318">defstruct</a></tt>.
<!--l. 1976--><p class="indent" >   Следуя этому определению можно записать <div class="lisp"><div class="tabbing">
(create-foo 1 2)
   <br>
<!--l. 1979--><p class="noindent" ></div>
<!--l. 1979--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179100019.6" id="x129-179100019.6"></a></span>
<!--l. 1979--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179200019.6" id="x129-179200019.6"></a></span>
</div>
<!--l. 1980--><p class="indent" >   вместо <div class="lisp"><div class="tabbing">
(make-foo <tt>:a</tt> 1 <tt>:b</tt> 2)
   <br>
<!--l. 1983--><p class="noindent" ></div>
<!--l. 1983--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179300019.6" id="x129-179300019.6"></a></span>
<!--l. 1983--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179400019.6" id="x129-179400019.6"></a></span>
</div>
<!--l. 1984--><p class="indent" >   и, конечно, <tt>create-foo</tt> предоставляет инициализацию отличную от
<tt>make-foo</tt>.
<!--l. 1987--><p class="indent" >   Использовать <tt>:constructor</tt> можно более одного раза. Таким образом вы
можете определить несколько различных функций-конструкторов с
различными аргументами.
                                                                          

                                                                          
<div class="new">
<!--l. 1991--><p class="indent" >   X3J13 voted in January 1989 <a 
 id="dx129-1794001"></a>to allow <tt>&#x0026;key</tt> and <tt>&#x0026;allow-other-keys</tt> in the
parameter list of a “positional” constructor. The initialization of slots
corresponding to keyword parameters is performed in the same manner as for
<tt>&#x0026;optional</tt> parameters. A variant of the example shown above illustrates this:
<div class="lisp"><div class="tabbing">
(<tt>:constructor</tt> create-foo
   <br>                                                             (a &#x0026;optional b (c &#x2019;sea)<br>
         &#x0026;key p (q &#x2019;cue) ((:why y)) ((:you u) &#x2019;ewe)<br>
         &#x0026;aux e (f &#x2019;eﬀ)))<br>
<!--l. 2004--><p class="noindent" ></div>
<!--l. 2004--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179500019.6" id="x129-179500019.6"></a></span>
<!--l. 2004--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179600019.6" id="x129-179600019.6"></a></span>
</div>
<!--l. 2005--><p class="indent" >   The treatment of slots <tt>a</tt>, <tt>b</tt>, <tt>c</tt>, <tt>e</tt>, and <tt><a 
href="clmli7.html#x196-3479382r382">f</a></tt> is the same as in the original
example. In addition, if there is a <tt>:p</tt> keyword argument, it is used to
initialize the <tt>p</tt> slot; if there isn&#x2019;t any <tt>:p</tt> keyword argument, then the
default value given in the body of the <tt><a 
href="clmli7.html#x196-3479318r318">defstruct</a></tt> (if given) is used instead.
Similarly, if there is a <tt>:q</tt> keyword argument, it is used to initialize the <tt>q</tt>
slot; if there isn&#x2019;t any <tt>:q</tt> keyword argument, then the symbol <tt>cue</tt> is used
instead.
<!--l. 2016--><p class="indent" >   In order thoroughly to ﬂog this presumably already dead horse, we further
observe that if there is a <tt>:why</tt> keyword argument, it is used to initialize the <tt>y</tt> slot;
otherwise the default value for slot <tt>y</tt> is used instead. Similarly, if there is a <tt>:you</tt>
keyword argument, it is used to initialize the <tt>u</tt> slot; otherwise the symbol <tt>ewe</tt> is
used instead.
<!--l. 2024--><p class="indent" >   If memory serves me correctly, <tt><a 
href="clmli7.html#x196-3479318r318">defstruct</a></tt> was included in the original design
for Common Lisp some time before keyword arguments were approved. The
failure of positional constructors to accept keyword arguments may well have been
an oversight on my part; there is no logical reason to exclude them. I am grateful
to X3J13 for rectifying this.
                                                                          

                                                                          
<!--l. 2030--><p class="indent" >   A remaining diﬃculty is that the possibility of keyword arguments renders the
term “positional constructor” a misnomer. Worse yet, it ruins the term “BOA
constructor.” I suggest that they continue to be called BOA constructors, as I
refuse to abandon a good pun. (I regret appearing to have more compassion for
puns than for horses.)
<!--l. 2037--><p class="indent" >   As part of the same vote X3J13 also changed <tt><a 
href="clmli7.html#x196-3479318r318">defstruct</a></tt> to allow BOA
constructors to have parameters (including supplied-p parameters) that do not
correspond to any slot. Such parameters may be used in subsequent initialization
forms in the parameter list. Consider this example: <div class="lisp"><div class="tabbing">
(defstruct (ice-cream-factory
   <br>                                                (:constructor fabricate-factory<br>
               (&#x0026;key (capacity 5)<br>                          location<br>
                      (local-ﬂavors<br>                        (case location<br>
                          ((hawaii) &#x2019;(pineapple macadamia guava))<br>
                          ((massachusetts) &#x2019;(lobster baked-bean))<br>
                          ((california) &#x2019;(ginger lotus avocado<br>
                                          bean-sprout garlic))<br>
                          ((texas) &#x2019;(jalapeno barbecue))))<br>
                      (ﬂavors (subseq (append local-ﬂavors<br>
                                               &#x2019;(vanilla<br>
                                                 chocolate<br>
                                                 strawberry<br>
                                                 pistachio<br>
                                                 maple-walnut<br>
                                                 peppermint))<br>
                                       0 capacity)))))<br>
  (capacity 3)<br>             (ﬂavors &#x2019;(vanilla chocolate strawberry mango)))<br>
<!--l. 2065--><p class="noindent" ></div>
<!--l. 2065--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179700019.6" id="x129-179700019.6"></a></span>
<!--l. 2065--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179800019.6" id="x129-179800019.6"></a></span>
</div>
                                                                          

                                                                          
<!--l. 2067--><p class="indent" >   The structure type <tt>ice-cream-factory</tt> has two constructors. The standard
constructor, <tt>make-ice-cream-factory</tt>, takes two keyword arguments named
<tt>:capacity</tt> and <tt>:flavors</tt>. For this constructor, the default for the <tt>capacity</tt> slot
is <tt>3</tt> and the default list of <tt>flavors</tt> is America&#x2019;s favorite threesome and a dark
horse (not a dead one). The BOA constructor <tt>fabricate-factory</tt> accepts four
diﬀerent keyword arguments. The <tt>:capacity</tt> argument defaults to <tt>5</tt>, and the
<tt>:flavors</tt> argument defaults in a complicated manner based on the other three.
The <tt>:local-flavors</tt> argument may be speciﬁed directly, or may be allowed to
default based on the <tt>:location</tt> of the factory. Here are examples of various
factories:
<div class="lisp">
<!--l. 2082--><p class="indent" >   <div class="tabbing">
(setq houston (fabricate-factory :capacity 4 :location &#x2019;texas))
   <br>                (setq cambridge (fabricate-factory :location &#x2019;massachusetts))<br>
(setq seattle (fabricate-factory :local-ﬂavors &#x2019;(salmon)))<br>
(setq wheaton (fabricate-factory :capacity 4 :location &#x2019;illinois))<br>
(setq pittsburgh (fabricate-factory :capacity 4))<br>
(setq cleveland (make-factory :capacity 4))<br>
<br>                                        (ice-cream-factory-ﬂavors houston)<br>
 <span class="math"> ⇒</span> (jalapeno barbecue vanilla chocolate)<br>
<!--l. 2092--><p class="noindent" ></div>
<!--l. 2092--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-179900019.6" id="x129-179900019.6"></a></span>
<!--l. 2092--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-180000019.6" id="x129-180000019.6"></a></span>
</div>
<!--l. 2093--><p class="indent" >
                                                                          

                                                                          
<div class="lisp">
<!--l. 2094--><p class="indent" >   <div class="tabbing">
(ice-cream-factory-ﬂavors cambridge)
   <br>                        <span class="math"> ⇒</span> (lobster baked-bean vanilla chocolate strawberry)<br>
<br>                                          (ice-cream-factory-ﬂavors seattle)<br>
 <span class="math"> ⇒</span> (salmon vanilla chocolate strawberry pistachio)<br>
<br>                                        (ice-cream-factory-ﬂavors wheaton)<br>
 <span class="math"> ⇒</span> (vanilla chocolate strawberry pistachio)<br>
<br>                                      (ice-cream-factory-ﬂavors pittsburgh)<br>
 <span class="math"> ⇒</span> (vanilla chocolate strawberry pistachio)<br>
<br>                                       (ice-cream-factory-ﬂavors cleveland)<br>
 <span class="math"> ⇒</span> (vanilla chocolate strawberry mango)<br>
<!--l. 2109--><p class="noindent" ></div>
<!--l. 2109--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-180100019.6" id="x129-180100019.6"></a></span>
<!--l. 2109--><p class="noindent" ><span class="paragraphHead"><a 
href="#x129-180200019.6" id="x129-180200019.6"></a></span>
</div>
</div>
                                                                          

                                                                          
<!--l. 2112--><p class="indent" >   <div id="bottomlinks"><tt>&#x003C;</tt><a 
href="clmse106.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html#tailclmse104.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch19.html#clmse105.html" >Наверх</a><tt>&#x003E;</tt></div><a 
 id="tailclmse105.html"></a>   </div> </div> 
</body></html> 
