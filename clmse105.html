<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Цикл взаимодействия с пользователем</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- 3,index=2,next,fn-in,charset=utf-8,sections+,minitoc<,html --> 
<meta name="src" content="clm.tex"> 
<meta name="date" content="2012-03-28 14:08:00"> 
<link rel="stylesheet" type="text/css" href="clm.css"> 
</head><body 
>
   <!--l. 556--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch21.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html#tailclmse104.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="#tailclmse105.html">В-конец</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse105.html" >Вверх</a><tt>&#x003E;</tt></p></div>
   <h3 class="sectionHead"><span class="titlemark">20.2   </span> <a 
href="clm.html#QQ2-130-267" id="x130-23800020.2">Цикл взаимодействия с пользователем</a></h3>
<!--l. 558--><p class="noindent" >С Lisp&#x2019;ом можно работать через специальный цикл вида «<a 
href="clmse110.html#x137-256003r634">read</a>-<a 
href="clmse104.html#x129-237002r562">eval</a>-<a 
href="clmse111.html#x138-259008r650">print</a> и
сначала». Изменять состояние Lisp системы можно вызовом в этом цикле
действий, имеющих побочные эффекты.
<!--l. 563--><p class="indent" >   Точное определение такого цикла для Common Lisp&#x2019;а не указывается
здесь специально, оставляя разработчикам поле для творчества. Например,
они могут сделать командную строку, или простой текстовый редактор, или
сложный графический интерфейс. Разработчики могут предоставлять
явный запрос ввода, или (как в MacLisp&#x2019;е) не загромождать экран
подсказками.
<!--l. 569--><p class="indent" >   Цикл взаимодействия с пользователем должен ловить все исключения и
изящно их обрабатывать. Он должен также выводить все результаты
вычисления форм, возможно в отдельных строках. Если форма вернула ноль
значений, это также должно быть отображено.
<!--l. 574--><p class="indent" >   Следующие переменные управляются циклом взаимодействия с
пользователем, для удобства работы, например в случае, если пользователь
забыл сохранить интересное введённое выражение или выведенное значение.
(Следует отметить, что имена некоторых этих переменных нарушают
нотацию глобальных переменных в использовании звёздочек в начале и конце
имени.) Эти переменные в основном используются для взаимодействия с
пользователем, поэтому имеют короткие имена. Использование этих
переменных в программах следует избегать.
<div class=defun>
<!--l. 582--><p class="noindent" ><i>[Переменная]</i><a 
 id="dx130-238001"></a><a 
 id="x130-238002r568"></a><b> +</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx130-238003"></a><a 
 id="x130-238004r569"></a><b> ++</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx130-238005"></a><a 
 id="x130-238006r570"></a><b> +++</b>
<!--l. 586--><p class="noindent" >Когда форма вычисляется в цикле взаимодействия, переменная <a 
href="#x130-238002r568">+</a>
связывается с предыдущим прочитанным выражением. Переменная <a 
href="#x130-238004r569">++</a>
хранит предыдущее относительно значения <a 
href="#x130-238002r568">+</a> (то есть, форма вычисленная
два шага назад), и <a 
href="#x130-238006r570">+++</a> хранит предыдущее значение относительно
<a 
href="#x130-238004r569">++</a>.
                                                                          

                                                                          
</div>
<div class=defun>
<!--l. 594--><p class="noindent" ><i>[Переменная]</i><a 
 id="dx130-238007"></a><a 
 id="x130-238008r571"></a><b> -</b>
<!--l. 596--><p class="noindent" >Когда формы выполняется в цикле взаимодействия, переменная <a 
href="#x130-238008r571">-</a> связана с
этой формой. Это значение, которое получит переменная <a 
href="#x130-238002r568">+</a> на следующей
итерации цикла.
</div>
<div class=defun>
<!--l. 602--><p class="noindent" ><i>[Переменная]</i><a 
 id="dx130-238009"></a><a 
 id="x130-238010r572"></a><b> *</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx130-238011"></a><a 
 id="x130-238012r573"></a><b> **</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx130-238013"></a><a 
 id="x130-238014r574"></a><b> ***</b>
<!--l. 606--><p class="noindent" >Во время вычисления формы в цикле взаимодействия, переменная <a 
href="#x130-238010r572">*</a> связана
с результатом выполнения предыдущей формы, то есть значения формы,
которая хранится в <a 
href="#x130-238002r568">+</a>. Если результат той формы содержал несколько
значений, в <a 
href="#x130-238010r572">*</a> будет только первое. Если было возвращено ноль значений, <a 
href="#x130-238010r572">*</a>
будет содержать <a 
href="clmse31.html#x42-74002r18">nil</a>. Переменная <a 
href="#x130-238012r573">**</a> хранит предыдущее значение
относительно <a 
href="#x130-238010r572">*</a>. То есть, результат вычисления формы из <a 
href="#x130-238012r573">**</a>. <a 
href="#x130-238014r574">***</a> хранит
предыдущее значение относительно <a 
href="#x130-238014r574">***</a>.
<!--l. 616--><p class="indent" >   Если выполнение <a 
href="#x130-238002r568">+</a> было по каким-то причинам прервано, тогда значения
<a 
href="#x130-238010r572">*</a>, <a 
href="#x130-238012r573">**</a> и <a 
href="#x130-238014r574">***</a> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
</div>
<div class=defun>
<!--l. 622--><p class="noindent" ><i>[Переменная]</i><a 
 id="dx130-238015"></a><a 
 id="x130-238016r575"></a><b> /</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx130-238017"></a><a 
 id="x130-238018r576"></a><b> //</b> <br 
class="newline" /><i>[Переменная]</i><a 
 id="dx130-238019"></a><a 
 id="x130-238020r577"></a><b> ///</b>
<!--l. 626--><p class="noindent" >Во время вычисления формы в цикле взаимодействия, переменная <a 
href="#x130-238016r575">/</a> связана
со списком результатов выведенных на предыдущей итерации. То есть
это список всех значений выполнения формы <a 
href="#x130-238002r568">+</a>. Значение <a 
href="#x130-238010r572">*</a> должно
всегда совпадать со значением <i>car</i> элемента значения <a 
href="#x130-238016r575">/</a>. Переменная <a 
href="#x130-238018r576">//</a>
хранит предыдущий список значений относительно <a 
href="#x130-238016r575">/</a> (то есть, результат
вычисленный две итерации назад), и <a 
href="#x130-238020r577">///</a> содержит предыдущий список
значений относительно <a 
href="#x130-238020r577">///</a>. Таким образом, значение <a 
href="#x130-238012r573">**</a> должно всегда
совпадать со значением <i>car</i> элемента списка <a 
href="#x130-238018r576">//</a>, а <a 
href="#x130-238014r574">***</a> с с <i>car</i> элементом
<a 
href="#x130-238020r577">///</a>.
<!--l. 638--><p class="indent" >   Если выполнение <a 
href="#x130-238002r568">+</a> было по каким-то причинам прервано, тогда значения
<a 
href="#x130-238016r575">/</a>, <a 
href="#x130-238018r576">//</a> и <a 
href="#x130-238020r577">///</a> не меняются. Они изменяются, если вывод значений как минимум
начался (необязательно, чтобы он закончился).
                                                                          

                                                                          
</div>
<!--l. 644--><p class="indent" >   В качестве примера работы с этими переменным, рассмотрим следующую
возможную работу с системой, где <a 
href="clmse63.html#x80-177008r176">&#x003E;</a> приглашение ввода: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(cons - -)                      </td><td  
class="tabbing">;Итерация 1
</td></tr></table>
<!--l. 648--><p class="indent" >                                <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">((CONS - -) CONS - -)      </td><td  
class="tabbing">;Очаровашка?</td></tr></table>
<!--l. 649--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 650--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(values)                        </td><td  
class="tabbing">;Итерация 2</td></tr></table>
<!--l. 651--><p class="indent" >              <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">                                ;Ничего не выводится</td></tr></table>
<!--l. 652--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(cons &#x2019;a &#x2019;b)                    </td><td  
class="tabbing">;Итерация 3</td></tr></table>
<!--l. 653--><p class="indent" >                           <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">(A . B)                           </td><td  
class="tabbing">;Это одно значение</td></tr></table>
<!--l. 654--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 655--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(hairy-loop)̂G               </td><td  
class="tabbing">;Итерация 4</td></tr></table>
<!--l. 656--><p class="indent" >        <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">### QUIT to top level.    </td><td  
class="tabbing">;(Пользователь прервал вычисления.)</td></tr></table>
<!--l. 657--><p class="indent" >                                                                          <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"></td></tr></table>
<!--l. 658--><p class="indent" >                                  <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">&#x003E;(ﬂoor 13 4)                    </td><td  
class="tabbing">;Итерация 5</td></tr></table>
<!--l. 659--><p class="indent" >                     <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:216;" 
class="tabbing">3                                   </td><td  
class="tabbing">;Вернулось два значения</td></tr></table>
<!--l. 660--><p class="indent" >                                                                         <table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing">1</td></tr></table>
<!--l. 662--><p class="indent" >
</div>
</div>
<!--l. 663--><p class="noindent" >В этой точке мы имеем: <div class=lisp><div class=tabbing>
<table  
cellpadding="0" border="0" cellspacing="0" 
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td  
class="tabbing"><!--tex4ht:inline--><div class="tabular"><table width="100%"><tr><td align="left" >+++ <span class="math"> ⇒</span> (cons &#x2019;a &#x2019;b) </td><td align="left" >*** <span class="math"> ⇒</span> NIL   </td><td align="left" >/// <span class="math"> ⇒</span> ()        </td>
</tr><tr><td align="left" >++ <span class="math"> ⇒</span> (hairy-loop)   </td><td align="left" >** <span class="math"> ⇒</span> (A . B)</td><td align="left" >// <span class="math"> ⇒</span> ((A . B))</td>
</tr><tr><td align="left" >+ <span class="math"> ⇒</span> (ﬂoor 13 4)      </td><td align="left" >* <span class="math"> ⇒</span> 3          </td><td align="left" >/ <span class="math"> ⇒</span> (3 1)       </td></tr></table>                      </div>
</td></tr></table><!--l. 670--><p class="indent" >
</div>
</div>
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
                                                                          

                                                                          
   <!--l. 713--><div class="crosslinks"><p class="noindent"><tt>&#x003C;</tt><a 
href="clmch21.html" >Далее</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html" >Назад</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse104.html#tailclmse104.html" >Назад-и-вниз</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmse105.html" >В-начало</a><tt>&#x003E;</tt><tt>&#x003C;</tt><a 
href="clmch20.html#clmse105.html" >Вверх</a><tt>&#x003E;</tt></p></div>
<!--l. 713--><p class="indent" >   <a 
 id="tailclmse105.html"></a>  
</body></html> 
